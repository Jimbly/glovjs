{"version":3,"sources":["node_modules/browser-pack/_prelude.js","account_ui.js","app.js","img/font/04b03_8x1.json","img/font/04b03_8x2.json","img/font/palanquin32.json","main.js","multiplayer.js","particle_data.js","test_3d.js","../glov/client/bootstrap.js","../glov/client/browser.js","../glov/client/build_ui.js","../glov/client/camera2d.js","../glov/client/chat_ui.js","../glov/client/client_config.ts","../glov/client/cmds.js","../glov/client/color_picker.js","../glov/client/edit_box.js","../glov/client/effects.js","../glov/client/engine.js","../glov/client/environments.ts","../glov/client/error_report.js","../glov/client/fbinstant.js","../glov/client/fetch.js","../glov/client/filewatch.js","../glov/client/font.js","../glov/client/framebuffer.js","../glov/client/geom.js","../glov/client/glb/decode-utf8.js","../glov/client/glb/gltf-type-utils.js","../glov/client/glb/parser.js","../glov/client/glb/unpack-binary-json.js","../glov/client/glb/unpack-glb-buffers.js","../glov/client/hsv.js","../glov/client/in_event.js","../glov/client/input.js","../glov/client/link.js","../glov/client/local_storage.ts","../glov/client/localization.ts","../glov/client/mat43.js","../glov/client/mat4ScaleRotateTranslate.js","../glov/client/models.js","../glov/client/net.js","../glov/client/net_position_manager.js","../glov/client/particles.js","../glov/client/perf.js","../glov/client/pointer_lock.js","../glov/client/polyfill.js","../glov/client/profiler.js","../glov/client/profiler_ui.js","../glov/client/quat.js","../glov/client/rand_fast.js","../glov/client/scroll_area.ts","../glov/client/selection_box.js","../glov/client/settings.js","../glov/client/shader_debug_ui.js","../glov/client/shaders.js","../glov/client/simple_menu.js","../glov/client/slider.js","../glov/client/social.ts","../glov/client/sound.ts","../glov/client/spine.js","../glov/client/spot.js","../glov/client/sprite_animation.js","../glov/client/sprites.js","../glov/client/subscription_manager.js","../glov/client/textures.js","../glov/client/transition.js","../glov/client/ui.js","../glov/client/ui_test.ts","../glov/client/urlhash.js","../glov/client/walltime.js","../glov/client/webfs.js","../glov/client/words/profanity.js","../glov/client/wsclient.js","../glov/common/ack.js","../glov/common/base64.js","../glov/common/chunked_send.js","../glov/common/cmd_parse.js","../glov/common/crc32.js","../glov/common/dot-prop.js","../glov/common/enums.ts","../glov/common/friends_data.ts","../glov/common/md5.js","../glov/common/packet.js","../glov/common/perfcounters.js","../glov/common/rand_alea.js","../glov/common/tiny-events.js","../glov/common/util.js","../glov/common/verify.js","../glov/common/vmath.ts","../glov/common/words/profanity_common.js","../glov/common/wscommon.js"],"names":[],"mappings":"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EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACvB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACvB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACvB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EA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","file":"app.bundle.js","sourceRoot":"","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","// Portions Copyright 2022 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nexport const guest_regex = /^anon\\d+$/;\n\n/* eslint import/order:off */\nconst assert = require('assert');\nconst local_storage = require('glov/client/local_storage.js');\nconst glov_font = require('glov/client/font.js');\nconst { click, KEYS, keyDownEdge } = require('glov/client/input.js');\nconst { linkGetDefaultStyle, linkText } = require('glov/client/link.js');\nconst { random, round } = Math;\nconst net = require('glov/client/net.js');\nconst ui = require('glov/client/ui.js');\nconst { vec4 } = require('glov/common/vmath.js');\n\nexport function formatUserID(user_id, display_name) {\n  if (user_id.match(guest_regex)) {\n    user_id = 'guest';\n  }\n  let name = display_name || user_id;\n  if (user_id.toLowerCase() !== name.toLowerCase()) {\n    name = `${display_name} (${user_id})`;\n  }\n  return name;\n}\n\nfunction AccountUI() {\n  this.edit_box_name = ui.createEditBox({\n    placeholder: 'Username',\n    initial_focus: true,\n    text: local_storage.get('name') || '',\n    autocomplete: 'username',\n  });\n  this.edit_box_password = ui.createEditBox({\n    placeholder: 'Password',\n    type: 'password',\n    text: local_storage.get('name') && local_storage.get('password') || '',\n  });\n  this.edit_box_password_confirm = ui.createEditBox({\n    initial_focus: true,\n    placeholder: 'Confirm',\n    type: 'password',\n    text: '',\n    autocomplete: 'new-password',\n  });\n  this.edit_box_email = ui.createEditBox({\n    placeholder: 'Email',\n    text: '',\n    autocomplete: 'email',\n  });\n  this.edit_box_display_name = ui.createEditBox({\n    placeholder: 'Display',\n    text: '',\n    autocomplete: 'nickname',\n  });\n  this.creation_mode = false;\n}\n\nAccountUI.prototype.logout = function () {\n  this.edit_box_password.setText('');\n  net.subs.logout();\n};\n\nAccountUI.prototype.playAsGuest = function (use_name) {\n  let name;\n  if (use_name && (local_storage.get('name') || '').match(guest_regex)) {\n    name = local_storage.get('name');\n  } else {\n    name = `anon${String(random()).slice(2, 8)}`;\n  }\n  let pass = 'test';\n  local_storage.set('name', name);\n  this.edit_box_name.setText(name);\n  net.subs.login(name, pass, function (err) {\n    if (err) {\n      ui.modalDialog({\n        title: 'Auto-login Failed',\n        text: err,\n        buttons: {\n          'Retry': function () {\n            local_storage.set('did_auto_anon', undefined);\n            local_storage.set('name', undefined);\n          },\n          'Cancel': null,\n        },\n      });\n    } else {\n      net.subs.sendCmdParse('rename_random', (err) => {\n        if (err) {\n          console.log(err);\n        }\n      });\n    }\n  });\n};\n\nAccountUI.prototype.showLogin = function (param) {\n  let {\n    x, y, style, button_height, button_width,\n    prelogout, center,\n    url_tos, url_priv, text_w,\n    font_height, font_height_small, label_w,\n    pad, status_bar,\n  } = param;\n  font_height = font_height || ui.font_height;\n  font_height_small = font_height_small || font_height * 0.75;\n  button_height = button_height || ui.button_height;\n  button_width = button_width || 240;\n  text_w = text_w || 400;\n  label_w = label_w || round(font_height * 140/24);\n  pad = pad || 10;\n  let { edit_box_name, edit_box_password, edit_box_password_confirm, edit_box_email, edit_box_display_name } = this;\n  let login_message;\n  const BOX_H = font_height;\n  let min_h = BOX_H * 2 + pad * 3 + button_height;\n  let calign = center ? glov_font.ALIGN.HRIGHT : glov_font.ALIGN.HLEFT | glov_font.ALIGN.HFIT;\n\n  function showTOS(is_create) {\n    if (url_tos) {\n      assert(url_priv);\n      let terms_height = font_height_small;\n      ui.font.drawSizedAligned(style, x, y, Z.UI, terms_height, glov_font.ALIGN.HCENTER, 0, 0,\n        `By ${is_create ? 'creating an account' : 'logging in'} you agree to our`);\n      y += terms_height;\n      let and_w = ui.font.getStringWidth(style, terms_height, ' and ');\n      ui.font.drawSizedAligned(style, x, y, Z.UI, terms_height, glov_font.ALIGN.HCENTER, 0, 0,\n        'and');\n      linkText({\n        x: x - and_w / 2 - ui.font.getStringWidth(linkGetDefaultStyle(), terms_height, 'Terms of Service'),\n        y,\n        z: Z.UI,\n        font_size: terms_height,\n        url: url_tos,\n        text: 'Terms of Service',\n      });\n      linkText({\n        x: x + and_w / 2,\n        y,\n        z: Z.UI,\n        font_size: terms_height,\n        url: url_priv,\n        text: 'Privacy Policy',\n      });\n      y += BOX_H + pad;\n    }\n  }\n\n  if (!net.client.connected) {\n    login_message = 'Establishing connection...';\n  } else if (net.subs.logging_in) {\n    login_message = 'Logging in...';\n  } else if (net.subs.logging_out) {\n    login_message = 'Logging out...';\n  } else if (!net.subs.loggedIn() && window.FBInstant) {\n    net.subs.loginFacebook(function (err) {\n      if (err) {\n        ui.modalDialog({\n          title: 'Facebook login Failed',\n          text: err,\n          buttons: {\n            'Cancel': null,\n          },\n        });\n      }\n    });\n  } else if (!net.subs.loggedIn() && net.subs.auto_create_user &&\n    !local_storage.get('did_auto_anon') && !local_storage.get('name')\n  ) {\n    login_message = 'Creating guest account...';\n    local_storage.set('did_auto_anon', 'yes');\n    this.playAsGuest(false);\n  } else if (!net.subs.loggedIn()) {\n    let submit = false;\n    let w = text_w / 2;\n    let indent = center ? 0 : label_w;\n    let text_x = center ? x - 8 : x;\n    ui.font.drawSizedAligned(style, text_x, y, Z.UI, font_height, calign, indent - pad, 0, 'Username:');\n    submit = edit_box_name.run({ x: x + indent, y, w, font_height }) === edit_box_name.SUBMIT || submit;\n    y += BOX_H + pad;\n    ui.font.drawSizedAligned(style, text_x, y, Z.UI, font_height, calign, indent - pad, 0, 'Password:');\n    submit = edit_box_password.run({\n      x: x + indent, y, w, font_height,\n      autocomplete: this.creation_mode ? 'new-password' : 'current-password',\n    }) === edit_box_password.SUBMIT || submit;\n    y += BOX_H + pad;\n\n    if (this.creation_mode) {\n      ui.font.drawSizedAligned(style, text_x, y, Z.UI, font_height, calign, indent - pad, 0, 'Confirm Password:');\n      submit = edit_box_password_confirm.run({ x: x + indent, y, w, font_height }) === edit_box_password.SUBMIT ||\n        submit;\n      y += BOX_H + pad;\n\n      ui.font.drawSizedAligned(style, text_x, y, Z.UI, font_height, calign, indent - pad, 0, 'Email Address:');\n      submit = edit_box_email.run({ x: x + indent, y, w, font_height }) === edit_box_password.SUBMIT || submit;\n      y += BOX_H + pad;\n\n      ui.font.drawSizedAligned(style, text_x, y, Z.UI, font_height, calign, indent - pad, 0, 'Display Name:');\n      submit = edit_box_display_name.run({ x: x + indent, y, w, font_height }) === edit_box_password.SUBMIT ||\n        submit;\n\n      if (ui.buttonText({\n        x: x + w + (center ? 0 : label_w) + pad, y, w: button_width * 0.5, h: BOX_H + pad - 2,\n        font_height: font_height_small,\n        text: 'Random',\n      })) {\n        net.client.send('random_name', null, function (ignored, data) {\n          if (data) {\n            edit_box_display_name.setText(data);\n          }\n        });\n      }\n\n      y += BOX_H + pad;\n\n      showTOS(true);\n\n      submit = ui.buttonText({\n        x, y, w: button_width, h: button_height,\n        font_height,\n        text: 'Create User',\n      }) || submit;\n      if (ui.buttonText({\n        x: x + button_width + pad, y, w: button_width, h: button_height,\n        font_height,\n        text: 'Cancel',\n      }) || keyDownEdge(KEYS.ESC)) {\n        this.creation_mode = false;\n      }\n      y += button_height + pad;\n\n      if (submit) {\n        local_storage.set('name', edit_box_name.text);\n        // do creation and log in!\n        net.subs.userCreate({\n          user_id: edit_box_name.text,\n          email: edit_box_email.text,\n          password: edit_box_password.text,\n          password_confirm: edit_box_password_confirm.text,\n          display_name: edit_box_display_name.text,\n        }, (err) => {\n          if (err) {\n            ui.modalDialog({\n              title: 'Login Error',\n              text: err,\n              buttons: {\n                'OK': null,\n              },\n            });\n          } else {\n            this.creation_mode = false;\n            edit_box_password_confirm.setText('');\n            edit_box_email.setText('');\n            edit_box_display_name.setText('');\n          }\n        });\n      }\n\n    } else {\n\n      showTOS(false);\n\n      if (net.subs.auto_create_user) {\n        submit = ui.buttonText({\n          x, y, w: w + label_w, h: button_height,\n          font_height,\n          text: 'Log in / Create user',\n        }) || submit;\n        y += button_height + pad;\n        if (ui.buttonText({\n          x, y, w: w + label_w, h: button_height,\n          font_height,\n          text: 'Play as Guest',\n        })) {\n          this.playAsGuest(true);\n        }\n        // y += button_height + pad;\n      } else {\n        submit = ui.buttonText({\n          x, y, w: button_width, h: button_height,\n          font_height,\n          text: 'Log in',\n        }) || submit;\n        if (center) {\n          y += button_height + pad;\n        }\n        if (ui.buttonText({\n          x: center ? x : x + button_width + pad, y, w: button_width, h: button_height,\n          font_height,\n          text: 'New User',\n        })) {\n          this.creation_mode = true;\n          edit_box_display_name.setText(edit_box_name.text);\n          if (edit_box_name.text && edit_box_password.text) {\n            edit_box_password_confirm.initial_focus = true;\n          } else {\n            edit_box_password_confirm.initial_focus = false;\n            edit_box_name.focus();\n          }\n        }\n      }\n      y += button_height + pad;\n\n      if (submit) {\n        local_storage.set('name', edit_box_name.text);\n        // do log in!\n        net.subs.login(edit_box_name.text, edit_box_password.text, (err) => {\n          if (err) {\n            ui.modalDialog({\n              title: 'Login Error',\n              text: err,\n              buttons: {\n                'OK': null,\n              },\n            });\n          }\n        });\n      }\n    }\n  } else {\n    // FB Users can't logout\n    let show_logout = !window.FBInstant;\n    let user_id = net.subs.loggedIn();\n    let user_channel = net.subs.getChannel(`user.${user_id}`);\n    let display_name = user_channel.getChannelData('public.display_name') || user_id;\n    let name = formatUserID(user_id, display_name);\n\n    if (show_logout) {\n      let logged_in_font_height = font_height_small;\n      if (center) {\n        ui.font.drawSizedAligned(style, x - text_w / 2, y,\n          Z.UI, logged_in_font_height,\n          glov_font.ALIGN.HCENTERFIT,\n          text_w, 0,\n          `Logged in as: ${name}`);\n        if (click({ x: x - text_w / 2, y, w: text_w, h: logged_in_font_height, button: 0 })) {\n          ui.provideUserString('Your User ID', user_id);\n        }\n        y += logged_in_font_height + 8;\n      } else if (status_bar) {\n        ui.font.drawSizedAligned(style, x + button_width + 8, y,\n          Z.UI, logged_in_font_height,\n          glov_font.ALIGN.HFIT | glov_font.ALIGN.VCENTER,\n          text_w, button_height,\n          `Logged in as: ${name}`);\n        if (click({ x: x + button_width + 8, y, w: text_w, h: button_height, button: 0 })) {\n          ui.provideUserString('Your User ID', user_id);\n        }\n      } else {\n        ui.font.drawSizedAligned(style, x + button_width + 8,\n          y + logged_in_font_height * -0.25,\n          Z.UI, logged_in_font_height, calign | glov_font.ALIGN.VCENTER | glov_font.ALIGN.HFIT, text_w, button_height,\n          'Logged in as:');\n        ui.font.drawSizedAligned(style, x + button_width + 8,\n          y + logged_in_font_height * 0.75,\n          Z.UI, logged_in_font_height, calign | glov_font.ALIGN.VCENTER | glov_font.ALIGN.HFIT, text_w, button_height,\n          name);\n        if (click({ x: x + button_width + 8, y, w: text_w, h: logged_in_font_height * 2, button: 0 })) {\n          ui.provideUserString('Your User ID', user_id);\n        }\n      }\n\n      if (ui.buttonText({\n        x: center ? x - button_width / 2 : x,\n        y, w: button_width, h: button_height,\n        font_height,\n        text: 'Log out',\n      })) {\n        if (prelogout) {\n          prelogout();\n        }\n        this.logout();\n      }\n      y += button_height + 8;\n    } else {\n      ui.font.drawSizedAligned(style, center ? x - text_w / 2 : x + button_width + 8, y,\n        Z.UI, font_height,\n        (center ? glov_font.ALIGN.HCENTER : calign) | glov_font.ALIGN.VCENTER | glov_font.ALIGN.HFIT,\n        text_w, button_height,\n        `Logged in as: ${name}`);\n    }\n  }\n  if (login_message) {\n    let w = ui.font.drawSizedAligned(style, center ? x - 400 : x, y, Z.UI, font_height * 1.5,\n      glov_font.ALIGN.HVCENTERFIT,\n      center ? 800 : 400, min_h, login_message);\n    w += 100;\n    ui.drawRect(x - (center ? w / 2 : 50), y, x + (center ? w / 2 : w - 50), y + min_h, Z.UI - 0.5, vec4(0,0,0,0.25));\n    y += min_h;\n  }\n  return y;\n};\n\nexport function createAccountUI() {\n  return new AccountUI();\n}\n","/* eslint global-require:off */\n\n// For debug and used internally in the build/bundling pipeline\nwindow.glov_build_version=BUILD_TIMESTAMP;\n\n// Startup code.\n\nlet called_once = false;\nwindow.onload = function () {\n  if (called_once) {\n    return;\n  }\n  called_once = true;\n  require('glov/client/bootstrap.js');\n  // require('glov/client/worker_comm.js').startup(); // First, so it gets loading quickly (if workers required)\n  if (window.conf_env === 'multiplayer') {\n    require('./multiplayer.js').main();\n  } else {\n    require('./main.js').main();\n  }\n};\n","module.exports={\"font_size\":8,\"imageW\":128,\"imageH\":128,\"spread\":2,\"noFilter\":1,\"channels\":1,\"char_infos\":[{\"c\":32,\"xpad\":4},{\"c\":33,\"x0\":92,\"y0\":2,\"yoffs\":1,\"xpad\":1,\"w\":1,\"h\":5},{\"c\":34,\"x0\":42,\"y0\":63,\"yoffs\":1,\"xpad\":1,\"w\":3,\"h\":2},{\"c\":35,\"x0\":98,\"y0\":2,\"yoffs\":1,\"xpad\":1,\"w\":5,\"h\":5},{\"c\":36,\"x0\":38,\"y0\":2,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":6},{\"c\":37,\"x0\":108,\"y0\":2,\"yoffs\":1,\"xpad\":1,\"w\":5,\"h\":5},{\"c\":38,\"x0\":118,\"y0\":2,\"yoffs\":1,\"xpad\":1,\"w\":5,\"h\":5},{\"c\":39,\"x0\":50,\"y0\":63,\"yoffs\":1,\"xpad\":1,\"w\":1,\"h\":2},{\"c\":40,\"x0\":2,\"y0\":14,\"yoffs\":1,\"xpad\":1,\"w\":2,\"h\":5},{\"c\":41,\"x0\":9,\"y0\":14,\"yoffs\":1,\"xpad\":1,\"w\":2,\"h\":5},{\"c\":42,\"x0\":2,\"y0\":63,\"yoffs\":1,\"xpad\":1,\"w\":3,\"h\":3},{\"c\":43,\"x0\":10,\"y0\":63,\"yoffs\":2,\"xpad\":1,\"w\":3,\"h\":3},{\"c\":44,\"x0\":56,\"y0\":62,\"yoffs\":5,\"xpad\":1,\"w\":2,\"h\":2},{\"c\":45,\"x0\":87,\"y0\":62,\"yoffs\":3,\"xpad\":1,\"w\":3,\"h\":1},{\"c\":46,\"x0\":95,\"y0\":62,\"yoffs\":5,\"xpad\":1,\"w\":1,\"h\":1},{\"c\":47,\"x0\":16,\"y0\":14,\"yoffs\":1,\"xpad\":1,\"w\":5,\"h\":5},{\"c\":48,\"x0\":26,\"y0\":14,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":49,\"x0\":35,\"y0\":14,\"yoffs\":1,\"xpad\":1,\"w\":2,\"h\":5},{\"c\":50,\"x0\":42,\"y0\":13,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":51,\"x0\":51,\"y0\":13,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":52,\"x0\":60,\"y0\":13,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":53,\"x0\":69,\"y0\":13,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":54,\"x0\":78,\"y0\":13,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":55,\"x0\":87,\"y0\":13,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":56,\"x0\":96,\"y0\":12,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":57,\"x0\":105,\"y0\":12,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":58,\"x0\":18,\"y0\":63,\"yoffs\":2,\"xpad\":1,\"w\":1,\"h\":3},{\"c\":59,\"x0\":117,\"y0\":42,\"yoffs\":2,\"xpad\":1,\"w\":1,\"h\":4},{\"c\":60,\"x0\":114,\"y0\":12,\"yoffs\":1,\"xpad\":1,\"w\":3,\"h\":5},{\"c\":61,\"x0\":24,\"y0\":63,\"yoffs\":2,\"xpad\":1,\"w\":3,\"h\":3},{\"c\":62,\"x0\":122,\"y0\":12,\"yoffs\":1,\"xpad\":1,\"w\":3,\"h\":5},{\"c\":63,\"x0\":2,\"y0\":24,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":64,\"x0\":11,\"y0\":24,\"yoffs\":1,\"xpad\":1,\"w\":5,\"h\":5},{\"c\":65,\"x0\":21,\"y0\":24,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":66,\"x0\":30,\"y0\":24,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":67,\"x0\":39,\"y0\":24,\"yoffs\":1,\"xpad\":1,\"w\":3,\"h\":5},{\"c\":68,\"x0\":47,\"y0\":23,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":69,\"x0\":56,\"y0\":23,\"yoffs\":1,\"xpad\":1,\"w\":3,\"h\":5},{\"c\":70,\"x0\":64,\"y0\":23,\"yoffs\":1,\"xpad\":1,\"w\":3,\"h\":5},{\"c\":71,\"x0\":72,\"y0\":23,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":72,\"x0\":81,\"y0\":23,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":73,\"x0\":90,\"y0\":23,\"yoffs\":1,\"xpad\":1,\"w\":3,\"h\":5},{\"c\":74,\"x0\":98,\"y0\":22,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":75,\"x0\":107,\"y0\":22,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":76,\"x0\":116,\"y0\":22,\"yoffs\":1,\"xpad\":1,\"w\":3,\"h\":5},{\"c\":77,\"x0\":2,\"y0\":34,\"yoffs\":1,\"xpad\":1,\"w\":5,\"h\":5},{\"c\":78,\"x0\":12,\"y0\":34,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":79,\"x0\":26,\"y0\":14,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":80,\"x0\":21,\"y0\":34,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":81,\"x0\":47,\"y0\":2,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":6},{\"c\":82,\"x0\":30,\"y0\":34,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":83,\"x0\":39,\"y0\":34,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":84,\"x0\":48,\"y0\":33,\"yoffs\":1,\"xpad\":1,\"w\":3,\"h\":5},{\"c\":85,\"x0\":56,\"y0\":33,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":86,\"x0\":65,\"y0\":33,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":87,\"x0\":74,\"y0\":33,\"yoffs\":1,\"xpad\":1,\"w\":5,\"h\":5},{\"c\":88,\"x0\":84,\"y0\":33,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":89,\"x0\":93,\"y0\":33,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":90,\"x0\":102,\"y0\":32,\"yoffs\":1,\"xpad\":1,\"w\":3,\"h\":5},{\"c\":91,\"x0\":110,\"y0\":32,\"yoffs\":1,\"xpad\":1,\"w\":2,\"h\":5},{\"c\":92,\"x0\":117,\"y0\":32,\"yoffs\":1,\"xpad\":1,\"w\":5,\"h\":5},{\"c\":93,\"x0\":2,\"y0\":44,\"yoffs\":1,\"xpad\":1,\"w\":2,\"h\":5},{\"c\":94,\"x0\":63,\"y0\":62,\"yoffs\":1,\"xpad\":1,\"w\":3,\"h\":2},{\"c\":95,\"x0\":101,\"y0\":62,\"yoffs\":5,\"xpad\":1,\"w\":4,\"h\":1},{\"c\":96,\"x0\":71,\"y0\":62,\"yoffs\":1,\"xpad\":1,\"w\":2,\"h\":2},{\"c\":97,\"x0\":2,\"y0\":54,\"yoffs\":2,\"xpad\":1,\"w\":4,\"h\":4},{\"c\":98,\"x0\":9,\"y0\":44,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":99,\"x0\":11,\"y0\":54,\"yoffs\":2,\"xpad\":1,\"w\":3,\"h\":4},{\"c\":100,\"x0\":18,\"y0\":44,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":101,\"x0\":19,\"y0\":54,\"yoffs\":2,\"xpad\":1,\"w\":4,\"h\":4},{\"c\":102,\"x0\":27,\"y0\":44,\"yoffs\":1,\"xpad\":1,\"w\":3,\"h\":5},{\"c\":103,\"x0\":56,\"y0\":2,\"yoffs\":2,\"xpad\":1,\"w\":4,\"h\":6},{\"c\":104,\"x0\":35,\"y0\":44,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":105,\"x0\":44,\"y0\":44,\"yoffs\":1,\"xpad\":1,\"w\":1,\"h\":5},{\"c\":106,\"x0\":2,\"y0\":2,\"yoffs\":1,\"xpad\":1,\"w\":2,\"h\":7},{\"c\":107,\"x0\":50,\"y0\":43,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":108,\"x0\":59,\"y0\":43,\"yoffs\":1,\"xpad\":1,\"w\":1,\"h\":5},{\"c\":109,\"x0\":28,\"y0\":54,\"yoffs\":2,\"xpad\":1,\"w\":5,\"h\":4},{\"c\":110,\"x0\":38,\"y0\":54,\"yoffs\":2,\"xpad\":1,\"w\":4,\"h\":4},{\"c\":111,\"x0\":47,\"y0\":54,\"yoffs\":2,\"xpad\":1,\"w\":4,\"h\":4},{\"c\":112,\"x0\":65,\"y0\":2,\"yoffs\":2,\"xpad\":1,\"w\":4,\"h\":6},{\"c\":113,\"x0\":74,\"y0\":2,\"yoffs\":2,\"xpad\":1,\"w\":4,\"h\":6},{\"c\":114,\"x0\":56,\"y0\":53,\"yoffs\":2,\"xpad\":1,\"w\":3,\"h\":4},{\"c\":115,\"x0\":64,\"y0\":53,\"yoffs\":2,\"xpad\":1,\"w\":4,\"h\":4},{\"c\":116,\"x0\":65,\"y0\":43,\"yoffs\":1,\"xpad\":1,\"w\":3,\"h\":5},{\"c\":117,\"x0\":73,\"y0\":53,\"yoffs\":2,\"xpad\":1,\"w\":4,\"h\":4},{\"c\":118,\"x0\":82,\"y0\":53,\"yoffs\":2,\"xpad\":1,\"w\":4,\"h\":4},{\"c\":119,\"x0\":91,\"y0\":53,\"yoffs\":2,\"xpad\":1,\"w\":5,\"h\":4},{\"c\":120,\"x0\":101,\"y0\":53,\"yoffs\":2,\"xpad\":1,\"w\":3,\"h\":4},{\"c\":121,\"x0\":83,\"y0\":2,\"yoffs\":2,\"xpad\":1,\"w\":4,\"h\":6},{\"c\":122,\"x0\":109,\"y0\":52,\"yoffs\":2,\"xpad\":1,\"w\":4,\"h\":4},{\"c\":123,\"x0\":73,\"y0\":43,\"yoffs\":1,\"xpad\":1,\"w\":3,\"h\":5},{\"c\":124,\"x0\":59,\"y0\":43,\"yoffs\":1,\"xpad\":1,\"w\":1,\"h\":5},{\"c\":125,\"x0\":81,\"y0\":43,\"yoffs\":1,\"xpad\":1,\"w\":3,\"h\":5},{\"c\":126,\"x0\":78,\"y0\":62,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":2},{\"c\":160,\"xpad\":4},{\"c\":181,\"x0\":89,\"y0\":43,\"yoffs\":2,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":916,\"x0\":118,\"y0\":51,\"yoffs\":2,\"xpad\":1,\"w\":5,\"h\":4},{\"c\":9654,\"x0\":98,\"y0\":43,\"yoffs\":1,\"xpad\":1,\"w\":4,\"h\":5},{\"c\":9660,\"x0\":32,\"y0\":63,\"yoffs\":2,\"xpad\":1,\"w\":5,\"h\":3},{\"c\":9742,\"x0\":9,\"y0\":2,\"yoffs\":1,\"xpad\":1,\"w\":10,\"h\":7},{\"c\":9743,\"x0\":24,\"y0\":2,\"yoffs\":1,\"xpad\":1,\"w\":9,\"h\":7},{\"c\":65533,\"x0\":107,\"y0\":42,\"yoffs\":2,\"xpad\":1,\"w\":5,\"h\":5}]}","module.exports={\"font_size\":16,\"imageW\":1024,\"imageH\":64,\"spread\":2,\"noFilter\":1,\"channels\":1,\"char_infos\":[{\"c\":32,\"x0\":202,\"y0\":17,\"xpad\":7,\"w\":1,\"h\":1},{\"c\":33,\"x0\":137,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":2,\"h\":10},{\"c\":34,\"x0\":111,\"y0\":19,\"yoffs\":3,\"xpad\":2,\"w\":6,\"h\":4},{\"c\":35,\"x0\":144,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":10,\"h\":10},{\"c\":36,\"x0\":59,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":12},{\"c\":37,\"x0\":159,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":10,\"h\":10},{\"c\":38,\"x0\":174,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":10,\"h\":10},{\"c\":39,\"x0\":122,\"y0\":19,\"yoffs\":3,\"xpad\":2,\"w\":2,\"h\":4},{\"c\":40,\"x0\":189,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":4,\"h\":10},{\"c\":41,\"x0\":198,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":4,\"h\":10},{\"c\":42,\"x0\":56,\"y0\":21,\"yoffs\":3,\"xpad\":2,\"w\":6,\"h\":6},{\"c\":43,\"x0\":67,\"y0\":19,\"yoffs\":5,\"xpad\":2,\"w\":6,\"h\":6},{\"c\":44,\"x0\":129,\"y0\":19,\"yoffs\":11,\"xpad\":2,\"w\":4,\"h\":4},{\"c\":45,\"x0\":171,\"y0\":17,\"yoffs\":7,\"xpad\":2,\"w\":6,\"h\":2},{\"c\":46,\"x0\":182,\"y0\":17,\"yoffs\":11,\"xpad\":2,\"w\":2,\"h\":2},{\"c\":47,\"x0\":207,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":10,\"h\":10},{\"c\":48,\"x0\":222,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":49,\"x0\":235,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":4,\"h\":10},{\"c\":50,\"x0\":244,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":51,\"x0\":257,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":52,\"x0\":270,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":53,\"x0\":283,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":54,\"x0\":296,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":55,\"x0\":309,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":56,\"x0\":322,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":57,\"x0\":335,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":58,\"x0\":78,\"y0\":19,\"yoffs\":5,\"xpad\":2,\"w\":2,\"h\":6},{\"c\":59,\"x0\":883,\"y0\":2,\"yoffs\":5,\"xpad\":2,\"w\":2,\"h\":8},{\"c\":60,\"x0\":348,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":6,\"h\":10},{\"c\":61,\"x0\":85,\"y0\":19,\"yoffs\":5,\"xpad\":2,\"w\":6,\"h\":6},{\"c\":62,\"x0\":359,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":6,\"h\":10},{\"c\":63,\"x0\":370,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":64,\"x0\":383,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":10,\"h\":10},{\"c\":65,\"x0\":398,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":66,\"x0\":411,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":67,\"x0\":424,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":6,\"h\":10},{\"c\":68,\"x0\":435,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":69,\"x0\":448,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":6,\"h\":10},{\"c\":70,\"x0\":459,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":6,\"h\":10},{\"c\":71,\"x0\":470,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":72,\"x0\":483,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":73,\"x0\":496,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":6,\"h\":10},{\"c\":74,\"x0\":507,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":75,\"x0\":520,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":76,\"x0\":533,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":6,\"h\":10},{\"c\":77,\"x0\":544,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":10,\"h\":10},{\"c\":78,\"x0\":559,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":79,\"x0\":222,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":80,\"x0\":572,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":81,\"x0\":72,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":12},{\"c\":82,\"x0\":585,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":83,\"x0\":598,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":84,\"x0\":611,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":6,\"h\":10},{\"c\":85,\"x0\":622,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":86,\"x0\":635,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":87,\"x0\":648,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":10,\"h\":10},{\"c\":88,\"x0\":663,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":89,\"x0\":676,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":90,\"x0\":689,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":6,\"h\":10},{\"c\":91,\"x0\":700,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":4,\"h\":10},{\"c\":92,\"x0\":709,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":10,\"h\":10},{\"c\":93,\"x0\":724,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":4,\"h\":10},{\"c\":94,\"x0\":138,\"y0\":17,\"yoffs\":3,\"xpad\":2,\"w\":6,\"h\":4},{\"c\":95,\"x0\":189,\"y0\":17,\"yoffs\":11,\"xpad\":2,\"w\":8,\"h\":2},{\"c\":96,\"x0\":149,\"y0\":17,\"yoffs\":3,\"xpad\":2,\"w\":4,\"h\":4},{\"c\":97,\"x0\":890,\"y0\":2,\"yoffs\":5,\"xpad\":2,\"w\":8,\"h\":8},{\"c\":98,\"x0\":733,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":99,\"x0\":903,\"y0\":2,\"yoffs\":5,\"xpad\":2,\"w\":6,\"h\":8},{\"c\":100,\"x0\":746,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":101,\"x0\":914,\"y0\":2,\"yoffs\":5,\"xpad\":2,\"w\":8,\"h\":8},{\"c\":102,\"x0\":759,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":6,\"h\":10},{\"c\":103,\"x0\":85,\"y0\":2,\"yoffs\":5,\"xpad\":2,\"w\":8,\"h\":12},{\"c\":104,\"x0\":770,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":105,\"x0\":783,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":2,\"h\":10},{\"c\":106,\"x0\":2,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":4,\"h\":14},{\"c\":107,\"x0\":790,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":108,\"x0\":803,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":2,\"h\":10},{\"c\":109,\"x0\":927,\"y0\":2,\"yoffs\":5,\"xpad\":2,\"w\":10,\"h\":8},{\"c\":110,\"x0\":942,\"y0\":2,\"yoffs\":5,\"xpad\":2,\"w\":8,\"h\":8},{\"c\":111,\"x0\":955,\"y0\":2,\"yoffs\":5,\"xpad\":2,\"w\":8,\"h\":8},{\"c\":112,\"x0\":98,\"y0\":2,\"yoffs\":5,\"xpad\":2,\"w\":8,\"h\":12},{\"c\":113,\"x0\":111,\"y0\":2,\"yoffs\":5,\"xpad\":2,\"w\":8,\"h\":12},{\"c\":114,\"x0\":968,\"y0\":2,\"yoffs\":5,\"xpad\":2,\"w\":6,\"h\":8},{\"c\":115,\"x0\":979,\"y0\":2,\"yoffs\":5,\"xpad\":2,\"w\":8,\"h\":8},{\"c\":116,\"x0\":810,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":6,\"h\":10},{\"c\":117,\"x0\":992,\"y0\":2,\"yoffs\":5,\"xpad\":2,\"w\":8,\"h\":8},{\"c\":118,\"x0\":1005,\"y0\":2,\"yoffs\":5,\"xpad\":2,\"w\":8,\"h\":8},{\"c\":119,\"x0\":2,\"y0\":21,\"yoffs\":5,\"xpad\":2,\"w\":10,\"h\":8},{\"c\":120,\"x0\":17,\"y0\":21,\"yoffs\":5,\"xpad\":2,\"w\":6,\"h\":8},{\"c\":121,\"x0\":124,\"y0\":2,\"yoffs\":5,\"xpad\":2,\"w\":8,\"h\":12},{\"c\":122,\"x0\":28,\"y0\":21,\"yoffs\":5,\"xpad\":2,\"w\":8,\"h\":8},{\"c\":123,\"x0\":821,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":6,\"h\":10},{\"c\":124,\"x0\":803,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":2,\"h\":10},{\"c\":125,\"x0\":832,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":6,\"h\":10},{\"c\":126,\"x0\":158,\"y0\":17,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":4},{\"c\":160,\"x0\":202,\"y0\":17,\"xpad\":7,\"w\":1,\"h\":1},{\"c\":181,\"x0\":843,\"y0\":2,\"yoffs\":5,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":916,\"x0\":41,\"y0\":21,\"yoffs\":5,\"xpad\":2,\"w\":10,\"h\":8},{\"c\":9654,\"x0\":856,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":8,\"h\":10},{\"c\":9660,\"x0\":96,\"y0\":19,\"yoffs\":5,\"xpad\":2,\"w\":10,\"h\":6},{\"c\":9742,\"x0\":11,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":20,\"h\":14},{\"c\":9743,\"x0\":36,\"y0\":2,\"yoffs\":3,\"xpad\":2,\"w\":18,\"h\":14},{\"c\":65533,\"x0\":869,\"y0\":2,\"yoffs\":3,\"xpad\":1,\"w\":9,\"h\":10}]}","module.exports={\"font_size\":32,\"imageW\":1024,\"imageH\":512,\"spread\":8,\"channels\":1,\"char_infos\":[{\"c\":13},{\"c\":32,\"xpad\":7.10156},{\"c\":33,\"x0\":436,\"y0\":224,\"yoffs\":4,\"xpad\":1.13281,\"w\":6,\"h\":22},{\"c\":34,\"x0\":914,\"y0\":334,\"yoffs\":4,\"w\":10,\"h\":8},{\"c\":35,\"x0\":704,\"y0\":301,\"yoffs\":10,\"w\":16,\"h\":17},{\"c\":36,\"x0\":215,\"y0\":8,\"yoffs\":1,\"xpad\":1.32031,\"w\":15,\"h\":29},{\"c\":37,\"x0\":933,\"y0\":141,\"yoffs\":4,\"xpad\":0.773438,\"w\":26,\"h\":23},{\"c\":38,\"x0\":976,\"y0\":141,\"yoffs\":4,\"xpad\":0.570313,\"w\":20,\"h\":23},{\"c\":39,\"x0\":941,\"y0\":334,\"yoffs\":4,\"w\":5,\"h\":8},{\"c\":40,\"x0\":8,\"y0\":190,\"yoffs\":5,\"w\":8,\"h\":23},{\"c\":41,\"x0\":33,\"y0\":190,\"yoffs\":5,\"xpad\":0.890625,\"w\":7,\"h\":23},{\"c\":42,\"x0\":680,\"y0\":337,\"yoffs\":2,\"w\":11,\"h\":11},{\"c\":43,\"x0\":737,\"y0\":300,\"yoffs\":9,\"xpad\":0.414063,\"w\":15,\"h\":17},{\"c\":44,\"x0\":963,\"y0\":333,\"yoffs\":22,\"w\":5,\"h\":8},{\"c\":45,\"x0\":283,\"y0\":375,\"yoffs\":16,\"w\":9,\"h\":3},{\"c\":46,\"x0\":187,\"y0\":378,\"yoffs\":22,\"w\":5,\"h\":4},{\"c\":47,\"x0\":57,\"y0\":190,\"yoffs\":4,\"w\":13,\"h\":23},{\"c\":48,\"x0\":459,\"y0\":224,\"yoffs\":5,\"xpad\":0.671875,\"w\":17,\"h\":22},{\"c\":49,\"x0\":442,\"y0\":263,\"yoffs\":5,\"xpad\":5.67188,\"w\":12,\"h\":21},{\"c\":50,\"x0\":471,\"y0\":263,\"yoffs\":5,\"xpad\":1.67188,\"w\":16,\"h\":21},{\"c\":51,\"x0\":493,\"y0\":224,\"yoffs\":5,\"xpad\":1.67188,\"w\":16,\"h\":22},{\"c\":52,\"x0\":504,\"y0\":263,\"yoffs\":5,\"xpad\":0.671875,\"w\":17,\"h\":21},{\"c\":53,\"x0\":526,\"y0\":224,\"yoffs\":5,\"xpad\":1.67188,\"w\":16,\"h\":22},{\"c\":54,\"x0\":559,\"y0\":224,\"yoffs\":5,\"xpad\":0.671875,\"w\":17,\"h\":22},{\"c\":55,\"x0\":538,\"y0\":263,\"yoffs\":5,\"xpad\":1.67188,\"w\":16,\"h\":21},{\"c\":56,\"x0\":593,\"y0\":224,\"yoffs\":5,\"xpad\":0.671875,\"w\":17,\"h\":22},{\"c\":57,\"x0\":627,\"y0\":224,\"yoffs\":5,\"xpad\":0.671875,\"w\":17,\"h\":22},{\"c\":58,\"x0\":436,\"y0\":341,\"yoffs\":12,\"w\":5,\"h\":14},{\"c\":59,\"x0\":682,\"y0\":301,\"yoffs\":12,\"w\":5,\"h\":18},{\"c\":60,\"x0\":867,\"y0\":99,\"yoffs\":4,\"w\":12,\"h\":25},{\"c\":61,\"x0\":882,\"y0\":334,\"yoffs\":14,\"w\":15,\"h\":9},{\"c\":62,\"x0\":896,\"y0\":99,\"yoffs\":4,\"w\":12,\"h\":25},{\"c\":63,\"x0\":661,\"y0\":224,\"yoffs\":4,\"xpad\":0.195313,\"w\":12,\"h\":22},{\"c\":64,\"x0\":87,\"y0\":188,\"yoffs\":7,\"xpad\":1.21094,\"w\":23,\"h\":23},{\"c\":65,\"x0\":571,\"y0\":263,\"yoffs\":5,\"w\":19,\"h\":21},{\"c\":66,\"x0\":607,\"y0\":263,\"yoffs\":5,\"xpad\":0.882813,\"w\":18,\"h\":21},{\"c\":67,\"x0\":690,\"y0\":223,\"yoffs\":5,\"xpad\":0.945313,\"w\":17,\"h\":22},{\"c\":68,\"x0\":642,\"y0\":263,\"yoffs\":5,\"xpad\":1.01563,\"w\":20,\"h\":21},{\"c\":69,\"x0\":679,\"y0\":263,\"yoffs\":5,\"xpad\":0.617188,\"w\":16,\"h\":21},{\"c\":70,\"x0\":712,\"y0\":262,\"yoffs\":5,\"w\":15,\"h\":21},{\"c\":71,\"x0\":724,\"y0\":223,\"yoffs\":5,\"xpad\":1.75,\"w\":18,\"h\":22},{\"c\":72,\"x0\":744,\"y0\":262,\"yoffs\":5,\"xpad\":2.53906,\"w\":18,\"h\":21},{\"c\":73,\"x0\":779,\"y0\":262,\"yoffs\":5,\"xpad\":2.54688,\"w\":6,\"h\":21},{\"c\":74,\"x0\":759,\"y0\":223,\"yoffs\":5,\"xpad\":2.75781,\"w\":6,\"h\":22},{\"c\":75,\"x0\":802,\"y0\":262,\"yoffs\":5,\"w\":19,\"h\":21},{\"c\":76,\"x0\":838,\"y0\":262,\"yoffs\":5,\"w\":16,\"h\":21},{\"c\":77,\"x0\":871,\"y0\":262,\"yoffs\":5,\"xpad\":2.27344,\"w\":21,\"h\":21},{\"c\":78,\"x0\":909,\"y0\":262,\"yoffs\":5,\"xpad\":2.74219,\"w\":19,\"h\":21},{\"c\":79,\"x0\":127,\"y0\":186,\"yoffs\":4,\"xpad\":1.22656,\"w\":21,\"h\":23},{\"c\":80,\"x0\":945,\"y0\":261,\"yoffs\":5,\"xpad\":0.828125,\"w\":17,\"h\":21},{\"c\":81,\"x0\":165,\"y0\":186,\"yoffs\":4,\"xpad\":1.22656,\"w\":21,\"h\":23},{\"c\":82,\"x0\":979,\"y0\":260,\"yoffs\":5,\"w\":19,\"h\":21},{\"c\":83,\"x0\":203,\"y0\":186,\"yoffs\":4,\"xpad\":1.32031,\"w\":15,\"h\":23},{\"c\":84,\"x0\":8,\"y0\":309,\"yoffs\":5,\"w\":17,\"h\":21},{\"c\":85,\"x0\":782,\"y0\":223,\"yoffs\":5,\"xpad\":2.04688,\"w\":19,\"h\":22},{\"c\":86,\"x0\":42,\"y0\":309,\"yoffs\":5,\"w\":19,\"h\":21},{\"c\":87,\"x0\":78,\"y0\":309,\"yoffs\":5,\"w\":30,\"h\":21},{\"c\":88,\"x0\":818,\"y0\":223,\"yoffs\":5,\"w\":20,\"h\":22},{\"c\":89,\"x0\":125,\"y0\":307,\"yoffs\":5,\"w\":18,\"h\":21},{\"c\":90,\"x0\":160,\"y0\":305,\"yoffs\":5,\"xpad\":0.226563,\"w\":17,\"h\":21},{\"c\":91,\"x0\":925,\"y0\":99,\"yoffs\":4,\"w\":9,\"h\":25},{\"c\":92,\"x0\":235,\"y0\":186,\"yoffs\":4,\"w\":13,\"h\":23},{\"c\":93,\"x0\":951,\"y0\":99,\"yoffs\":4,\"xpad\":1.70313,\"w\":7,\"h\":25},{\"c\":94,\"x0\":985,\"y0\":333,\"yoffs\":14,\"xpad\":0.1875,\"w\":13,\"h\":8},{\"c\":95,\"x0\":309,\"y0\":375,\"yoffs\":23,\"xpad\":0.4375,\"w\":12,\"h\":3},{\"c\":96,\"x0\":88,\"y0\":380,\"yoffs\":3,\"w\":6,\"h\":6},{\"c\":97,\"x0\":769,\"y0\":300,\"yoffs\":10,\"xpad\":1.29688,\"w\":14,\"h\":17},{\"c\":98,\"x0\":265,\"y0\":184,\"yoffs\":4,\"xpad\":0.890625,\"w\":16,\"h\":23},{\"c\":99,\"x0\":800,\"y0\":300,\"yoffs\":10,\"xpad\":0.273438,\"w\":14,\"h\":17},{\"c\":100,\"x0\":298,\"y0\":184,\"yoffs\":4,\"xpad\":2.07031,\"w\":15,\"h\":23},{\"c\":101,\"x0\":831,\"y0\":300,\"yoffs\":10,\"xpad\":1.04688,\"w\":15,\"h\":17},{\"c\":102,\"x0\":855,\"y0\":223,\"yoffs\":4,\"w\":10,\"h\":22},{\"c\":103,\"x0\":330,\"y0\":184,\"yoffs\":10,\"xpad\":2.07031,\"w\":15,\"h\":23},{\"c\":104,\"x0\":882,\"y0\":223,\"yoffs\":4,\"xpad\":1.10156,\"w\":16,\"h\":22},{\"c\":105,\"x0\":194,\"y0\":305,\"yoffs\":5,\"xpad\":1.34375,\"w\":6,\"h\":21},{\"c\":106,\"x0\":78,\"y0\":55,\"yoffs\":5,\"xpad\":1.07031,\"w\":7,\"h\":28},{\"c\":107,\"x0\":915,\"y0\":222,\"yoffs\":4,\"xpad\":0.171875,\"w\":15,\"h\":22},{\"c\":108,\"x0\":947,\"y0\":222,\"yoffs\":4,\"xpad\":1.46875,\"w\":6,\"h\":22},{\"c\":109,\"x0\":85,\"y0\":347,\"yoffs\":10,\"xpad\":1.14063,\"w\":25,\"h\":16},{\"c\":110,\"x0\":127,\"y0\":345,\"yoffs\":10,\"xpad\":2.03906,\"w\":15,\"h\":16},{\"c\":111,\"x0\":863,\"y0\":300,\"yoffs\":10,\"xpad\":0.828125,\"w\":16,\"h\":17},{\"c\":112,\"x0\":362,\"y0\":184,\"yoffs\":10,\"xpad\":0.890625,\"w\":16,\"h\":23},{\"c\":113,\"x0\":395,\"y0\":184,\"yoffs\":10,\"xpad\":2.07031,\"w\":15,\"h\":23},{\"c\":114,\"x0\":219,\"y0\":343,\"yoffs\":11,\"xpad\":0.203125,\"w\":10,\"h\":15},{\"c\":115,\"x0\":896,\"y0\":300,\"yoffs\":10,\"xpad\":0.28125,\"w\":13,\"h\":17},{\"c\":116,\"x0\":584,\"y0\":301,\"yoffs\":7,\"xpad\":0.234375,\"w\":10,\"h\":20},{\"c\":117,\"x0\":159,\"y0\":345,\"yoffs\":11,\"xpad\":1.64844,\"w\":15,\"h\":16},{\"c\":118,\"x0\":246,\"y0\":343,\"yoffs\":11,\"w\":15,\"h\":15},{\"c\":119,\"x0\":278,\"y0\":343,\"yoffs\":11,\"w\":23,\"h\":15},{\"c\":120,\"x0\":318,\"y0\":343,\"yoffs\":11,\"w\":16,\"h\":15},{\"c\":121,\"x0\":970,\"y0\":221,\"yoffs\":11,\"w\":15,\"h\":22},{\"c\":122,\"x0\":351,\"y0\":341,\"yoffs\":11,\"xpad\":0.851563,\"w\":13,\"h\":15},{\"c\":123,\"x0\":1002,\"y0\":221,\"yoffs\":6,\"w\":9,\"h\":22},{\"c\":124,\"x0\":8,\"y0\":8,\"w\":7,\"h\":32},{\"c\":125,\"x0\":8,\"y0\":270,\"yoffs\":6,\"xpad\":0.460938,\"w\":8,\"h\":22},{\"c\":126,\"x0\":158,\"y0\":378,\"yoffs\":16,\"xpad\":0.3125,\"w\":12,\"h\":5},{\"c\":144,\"x0\":8,\"y0\":381,\"yoffs\":-5,\"w\":14,\"h\":8},{\"c\":160,\"xpad\":7.10156},{\"c\":161,\"x0\":33,\"y0\":270,\"yoffs\":4,\"xpad\":1.13281,\"w\":6,\"h\":22},{\"c\":162,\"x0\":427,\"y0\":184,\"yoffs\":7,\"xpad\":0.273438,\"w\":14,\"h\":23},{\"c\":163,\"x0\":217,\"y0\":305,\"yoffs\":5,\"xpad\":0.304688,\"w\":14,\"h\":21},{\"c\":164,\"x0\":611,\"y0\":301,\"yoffs\":9,\"xpad\":0.328125,\"w\":20,\"h\":20},{\"c\":165,\"x0\":248,\"y0\":305,\"yoffs\":5,\"w\":18,\"h\":21},{\"c\":166,\"x0\":458,\"y0\":184,\"yoffs\":4,\"xpad\":2.10156,\"w\":6,\"h\":23},{\"c\":167,\"x0\":102,\"y0\":55,\"yoffs\":2,\"xpad\":1.25,\"w\":17,\"h\":28},{\"c\":168,\"x0\":209,\"y0\":376,\"yoffs\":4,\"xpad\":0.453125,\"w\":9,\"h\":4},{\"c\":169,\"x0\":481,\"y0\":184,\"yoffs\":4,\"xpad\":0.625,\"w\":25,\"h\":23},{\"c\":170,\"x0\":586,\"y0\":338,\"yoffs\":4,\"xpad\":0.296875,\"w\":10,\"h\":12},{\"c\":171,\"x0\":708,\"y0\":335,\"yoffs\":13,\"xpad\":0.140625,\"w\":11,\"h\":11},{\"c\":172,\"x0\":764,\"y0\":334,\"yoffs\":13,\"xpad\":0.382813,\"w\":15,\"h\":10},{\"c\":173,\"xpad\":3.94531},{\"c\":174,\"x0\":283,\"y0\":305,\"yoffs\":1,\"xpad\":0.3125,\"w\":22,\"h\":21},{\"c\":175,\"x0\":235,\"y0\":375,\"yoffs\":4,\"w\":9,\"h\":4},{\"c\":176,\"x0\":63,\"y0\":381,\"yoffs\":4,\"w\":8,\"h\":7},{\"c\":177,\"x0\":926,\"y0\":300,\"yoffs\":9,\"w\":14,\"h\":17},{\"c\":178,\"x0\":458,\"y0\":339,\"yoffs\":2,\"xpad\":0.890625,\"w\":11,\"h\":14},{\"c\":179,\"x0\":191,\"y0\":343,\"yoffs\":2,\"xpad\":1.52344,\"w\":11,\"h\":16},{\"c\":180,\"x0\":111,\"y0\":380,\"yoffs\":3,\"w\":6,\"h\":6},{\"c\":181,\"x0\":56,\"y0\":270,\"yoffs\":11,\"xpad\":1.85938,\"w\":15,\"h\":22},{\"c\":182,\"x0\":322,\"y0\":303,\"yoffs\":5,\"xpad\":0.5,\"w\":26,\"h\":21},{\"c\":183,\"x0\":261,\"y0\":375,\"yoffs\":16,\"w\":5,\"h\":4},{\"c\":184,\"x0\":39,\"y0\":381,\"yoffs\":25,\"xpad\":0.0703125,\"w\":7,\"h\":8},{\"c\":185,\"x0\":486,\"y0\":339,\"yoffs\":2,\"xpad\":0.6875,\"w\":10,\"h\":14},{\"c\":186,\"x0\":613,\"y0\":338,\"yoffs\":4,\"xpad\":0.625,\"w\":11,\"h\":12},{\"c\":187,\"x0\":736,\"y0\":335,\"yoffs\":13,\"xpad\":0.140625,\"w\":11,\"h\":11},{\"c\":188,\"x0\":247,\"y0\":8,\"yoffs\":2,\"xpad\":0.0546875,\"w\":25,\"h\":29},{\"c\":189,\"x0\":136,\"y0\":55,\"yoffs\":2,\"xpad\":1.22656,\"w\":25,\"h\":28},{\"c\":190,\"x0\":289,\"y0\":8,\"yoffs\":2,\"xpad\":0.109375,\"w\":26,\"h\":29},{\"c\":191,\"x0\":88,\"y0\":270,\"yoffs\":6,\"xpad\":0.09375,\"w\":13,\"h\":22},{\"c\":192,\"x0\":178,\"y0\":55,\"yoffs\":-2,\"w\":19,\"h\":28},{\"c\":193,\"x0\":214,\"y0\":55,\"yoffs\":-2,\"w\":19,\"h\":28},{\"c\":194,\"x0\":250,\"y0\":54,\"yoffs\":-2,\"w\":19,\"h\":28},{\"c\":195,\"x0\":648,\"y0\":99,\"w\":19,\"h\":26},{\"c\":196,\"x0\":252,\"y0\":99,\"yoffs\":-1,\"w\":19,\"h\":27},{\"c\":197,\"x0\":286,\"y0\":54,\"yoffs\":-2,\"w\":19,\"h\":28},{\"c\":198,\"x0\":365,\"y0\":303,\"yoffs\":5,\"xpad\":0.28125,\"w\":27,\"h\":21},{\"c\":199,\"x0\":322,\"y0\":54,\"yoffs\":5,\"xpad\":0.945313,\"w\":17,\"h\":28},{\"c\":200,\"x0\":356,\"y0\":54,\"yoffs\":-2,\"xpad\":0.617188,\"w\":16,\"h\":28},{\"c\":201,\"x0\":389,\"y0\":54,\"yoffs\":-2,\"xpad\":0.617188,\"w\":16,\"h\":28},{\"c\":202,\"x0\":422,\"y0\":54,\"yoffs\":-2,\"xpad\":0.617188,\"w\":16,\"h\":28},{\"c\":203,\"x0\":288,\"y0\":99,\"yoffs\":-1,\"xpad\":0.617188,\"w\":16,\"h\":27},{\"c\":204,\"x0\":455,\"y0\":54,\"yoffs\":-2,\"xpad\":1.54688,\"w\":7,\"h\":28},{\"c\":205,\"x0\":479,\"y0\":54,\"yoffs\":-2,\"xpad\":0.546875,\"w\":8,\"h\":28},{\"c\":206,\"x0\":504,\"y0\":54,\"yoffs\":-2,\"w\":11,\"h\":28},{\"c\":207,\"x0\":321,\"y0\":99,\"yoffs\":-1,\"w\":9,\"h\":27},{\"c\":208,\"x0\":409,\"y0\":303,\"yoffs\":5,\"xpad\":1.22656,\"w\":20,\"h\":21},{\"c\":209,\"x0\":684,\"y0\":99,\"xpad\":2.74219,\"w\":19,\"h\":26},{\"c\":210,\"x0\":332,\"y0\":8,\"yoffs\":-2,\"xpad\":1.22656,\"w\":21,\"h\":29},{\"c\":211,\"x0\":370,\"y0\":8,\"yoffs\":-2,\"xpad\":1.22656,\"w\":21,\"h\":29},{\"c\":212,\"x0\":408,\"y0\":8,\"yoffs\":-2,\"xpad\":1.22656,\"w\":21,\"h\":29},{\"c\":213,\"x0\":347,\"y0\":99,\"xpad\":1.22656,\"w\":21,\"h\":27},{\"c\":214,\"x0\":532,\"y0\":54,\"yoffs\":-1,\"xpad\":1.22656,\"w\":21,\"h\":28},{\"c\":215,\"x0\":381,\"y0\":341,\"yoffs\":11,\"xpad\":0.359375,\"w\":15,\"h\":15},{\"c\":216,\"x0\":523,\"y0\":184,\"yoffs\":4,\"xpad\":1.22656,\"w\":21,\"h\":23},{\"c\":217,\"x0\":446,\"y0\":8,\"yoffs\":-2,\"xpad\":2.04688,\"w\":19,\"h\":29},{\"c\":218,\"x0\":482,\"y0\":8,\"yoffs\":-2,\"xpad\":2.04688,\"w\":19,\"h\":29},{\"c\":219,\"x0\":518,\"y0\":8,\"yoffs\":-2,\"xpad\":2.04688,\"w\":19,\"h\":29},{\"c\":220,\"x0\":570,\"y0\":54,\"yoffs\":-1,\"xpad\":2.04688,\"w\":19,\"h\":28},{\"c\":221,\"x0\":606,\"y0\":54,\"yoffs\":-2,\"w\":18,\"h\":28},{\"c\":222,\"x0\":446,\"y0\":301,\"yoffs\":5,\"xpad\":1.00781,\"w\":17,\"h\":21},{\"c\":223,\"x0\":480,\"y0\":301,\"yoffs\":5,\"xpad\":1.30469,\"w\":17,\"h\":21},{\"c\":224,\"x0\":69,\"y0\":147,\"yoffs\":3,\"xpad\":1.29688,\"w\":14,\"h\":24},{\"c\":225,\"x0\":100,\"y0\":145,\"yoffs\":3,\"xpad\":1.29688,\"w\":14,\"h\":24},{\"c\":226,\"x0\":131,\"y0\":145,\"yoffs\":3,\"xpad\":1.29688,\"w\":14,\"h\":24},{\"c\":227,\"x0\":561,\"y0\":184,\"yoffs\":4,\"xpad\":1.29688,\"w\":14,\"h\":23},{\"c\":228,\"x0\":592,\"y0\":184,\"yoffs\":4,\"xpad\":1.29688,\"w\":14,\"h\":23},{\"c\":229,\"x0\":975,\"y0\":99,\"yoffs\":2,\"xpad\":1.29688,\"w\":14,\"h\":25},{\"c\":230,\"x0\":957,\"y0\":299,\"yoffs\":10,\"xpad\":0.960938,\"w\":24,\"h\":17},{\"c\":231,\"x0\":623,\"y0\":184,\"yoffs\":10,\"xpad\":0.273438,\"w\":14,\"h\":23},{\"c\":232,\"x0\":162,\"y0\":145,\"yoffs\":3,\"xpad\":1.04688,\"w\":15,\"h\":24},{\"c\":233,\"x0\":194,\"y0\":145,\"yoffs\":3,\"xpad\":1.04688,\"w\":15,\"h\":24},{\"c\":234,\"x0\":226,\"y0\":145,\"yoffs\":3,\"xpad\":1.04688,\"w\":15,\"h\":24},{\"c\":235,\"x0\":654,\"y0\":184,\"yoffs\":4,\"xpad\":1.04688,\"w\":15,\"h\":23},{\"c\":236,\"x0\":686,\"y0\":183,\"yoffs\":3,\"xpad\":1.34375,\"w\":6,\"h\":23},{\"c\":237,\"x0\":709,\"y0\":183,\"yoffs\":3,\"w\":8,\"h\":23},{\"c\":238,\"x0\":734,\"y0\":183,\"yoffs\":3,\"w\":11,\"h\":23},{\"c\":239,\"x0\":118,\"y0\":268,\"yoffs\":4,\"w\":9,\"h\":22},{\"c\":240,\"x0\":762,\"y0\":183,\"yoffs\":4,\"xpad\":1.53125,\"w\":15,\"h\":23},{\"c\":241,\"x0\":144,\"y0\":266,\"yoffs\":4,\"xpad\":2.03906,\"w\":15,\"h\":22},{\"c\":242,\"x0\":258,\"y0\":143,\"yoffs\":3,\"xpad\":0.828125,\"w\":16,\"h\":24},{\"c\":243,\"x0\":291,\"y0\":143,\"yoffs\":3,\"xpad\":0.828125,\"w\":16,\"h\":24},{\"c\":244,\"x0\":324,\"y0\":143,\"yoffs\":3,\"xpad\":0.828125,\"w\":16,\"h\":24},{\"c\":245,\"x0\":794,\"y0\":183,\"yoffs\":4,\"xpad\":0.828125,\"w\":16,\"h\":23},{\"c\":246,\"x0\":827,\"y0\":183,\"yoffs\":4,\"xpad\":0.828125,\"w\":16,\"h\":23},{\"c\":247,\"x0\":513,\"y0\":339,\"yoffs\":11,\"xpad\":0.453125,\"w\":14,\"h\":14},{\"c\":248,\"x0\":998,\"y0\":298,\"yoffs\":10,\"xpad\":0.828125,\"w\":16,\"h\":17},{\"c\":249,\"x0\":357,\"y0\":143,\"yoffs\":3,\"xpad\":1.64844,\"w\":15,\"h\":24},{\"c\":250,\"x0\":389,\"y0\":143,\"yoffs\":3,\"xpad\":1.64844,\"w\":15,\"h\":24},{\"c\":251,\"x0\":421,\"y0\":143,\"yoffs\":3,\"xpad\":1.64844,\"w\":15,\"h\":24},{\"c\":252,\"x0\":860,\"y0\":183,\"yoffs\":4,\"xpad\":1.64844,\"w\":15,\"h\":23},{\"c\":253,\"x0\":64,\"y0\":8,\"yoffs\":3,\"w\":15,\"h\":30},{\"c\":254,\"x0\":554,\"y0\":8,\"yoffs\":4,\"xpad\":0.890625,\"w\":16,\"h\":29},{\"c\":255,\"x0\":587,\"y0\":8,\"yoffs\":4,\"w\":15,\"h\":29},{\"c\":256,\"x0\":720,\"y0\":99,\"w\":19,\"h\":26},{\"c\":257,\"x0\":892,\"y0\":182,\"yoffs\":4,\"xpad\":1.29688,\"w\":14,\"h\":23},{\"c\":258,\"x0\":385,\"y0\":99,\"yoffs\":-1,\"w\":19,\"h\":27},{\"c\":259,\"x0\":453,\"y0\":143,\"yoffs\":3,\"xpad\":1.29688,\"w\":14,\"h\":24},{\"c\":260,\"x0\":641,\"y0\":54,\"yoffs\":5,\"w\":21,\"h\":28},{\"c\":261,\"x0\":923,\"y0\":182,\"yoffs\":10,\"w\":16,\"h\":23},{\"c\":262,\"x0\":619,\"y0\":8,\"yoffs\":-2,\"xpad\":0.945313,\"w\":17,\"h\":29},{\"c\":263,\"x0\":484,\"y0\":143,\"yoffs\":3,\"xpad\":0.273438,\"w\":14,\"h\":24},{\"c\":268,\"x0\":653,\"y0\":8,\"yoffs\":-2,\"xpad\":0.945313,\"w\":17,\"h\":29},{\"c\":269,\"x0\":515,\"y0\":143,\"yoffs\":3,\"xpad\":0.273438,\"w\":14,\"h\":24},{\"c\":270,\"x0\":679,\"y0\":54,\"yoffs\":-2,\"xpad\":1.01563,\"w\":20,\"h\":28},{\"c\":271,\"x0\":956,\"y0\":181,\"yoffs\":4,\"w\":22,\"h\":23},{\"c\":272,\"x0\":409,\"y0\":303,\"yoffs\":5,\"xpad\":1.22656,\"w\":20,\"h\":21},{\"c\":273,\"x0\":995,\"y0\":181,\"yoffs\":4,\"xpad\":0.0703125,\"w\":17,\"h\":23},{\"c\":274,\"x0\":756,\"y0\":99,\"xpad\":0.617188,\"w\":16,\"h\":26},{\"c\":275,\"x0\":8,\"y0\":230,\"yoffs\":4,\"xpad\":1.04688,\"w\":15,\"h\":23},{\"c\":278,\"x0\":421,\"y0\":99,\"yoffs\":-1,\"xpad\":0.617188,\"w\":16,\"h\":27},{\"c\":279,\"x0\":40,\"y0\":230,\"yoffs\":4,\"xpad\":1.04688,\"w\":15,\"h\":23},{\"c\":280,\"x0\":716,\"y0\":54,\"yoffs\":5,\"xpad\":0.617188,\"w\":16,\"h\":28},{\"c\":281,\"x0\":72,\"y0\":230,\"yoffs\":10,\"xpad\":1.04688,\"w\":15,\"h\":23},{\"c\":282,\"x0\":749,\"y0\":54,\"yoffs\":-2,\"xpad\":0.617188,\"w\":16,\"h\":28},{\"c\":283,\"x0\":546,\"y0\":143,\"yoffs\":3,\"xpad\":1.04688,\"w\":15,\"h\":24},{\"c\":286,\"x0\":782,\"y0\":54,\"yoffs\":-1,\"xpad\":1.75,\"w\":18,\"h\":28},{\"c\":287,\"x0\":96,\"y0\":8,\"yoffs\":3,\"xpad\":2.07031,\"w\":15,\"h\":30},{\"c\":290,\"x0\":817,\"y0\":54,\"yoffs\":5,\"xpad\":1.75,\"w\":18,\"h\":28},{\"c\":291,\"x0\":32,\"y0\":8,\"yoffs\":2,\"xpad\":2.07031,\"w\":15,\"h\":31},{\"c\":298,\"x0\":789,\"y0\":99,\"w\":9,\"h\":26},{\"c\":299,\"x0\":176,\"y0\":266,\"yoffs\":4,\"w\":9,\"h\":22},{\"c\":302,\"x0\":852,\"y0\":54,\"yoffs\":5,\"xpad\":0.546875,\"w\":8,\"h\":28},{\"c\":303,\"x0\":877,\"y0\":54,\"yoffs\":5,\"w\":8,\"h\":28},{\"c\":304,\"x0\":454,\"y0\":99,\"yoffs\":-1,\"xpad\":1.54688,\"w\":7,\"h\":27},{\"c\":305,\"x0\":413,\"y0\":341,\"yoffs\":11,\"xpad\":1.34375,\"w\":6,\"h\":15},{\"c\":310,\"x0\":687,\"y0\":8,\"yoffs\":5,\"w\":19,\"h\":29},{\"c\":311,\"x0\":128,\"y0\":8,\"yoffs\":4,\"xpad\":0.171875,\"w\":15,\"h\":30},{\"c\":313,\"x0\":902,\"y0\":54,\"yoffs\":-2,\"w\":16,\"h\":28},{\"c\":314,\"x0\":815,\"y0\":99,\"w\":8,\"h\":26},{\"c\":315,\"x0\":723,\"y0\":8,\"yoffs\":5,\"w\":16,\"h\":29},{\"c\":316,\"x0\":160,\"y0\":8,\"yoffs\":4,\"xpad\":1.46875,\"w\":6,\"h\":30},{\"c\":317,\"x0\":202,\"y0\":266,\"yoffs\":4,\"w\":16,\"h\":22},{\"c\":318,\"x0\":235,\"y0\":266,\"yoffs\":4,\"w\":12,\"h\":22},{\"c\":321,\"x0\":514,\"y0\":301,\"yoffs\":5,\"xpad\":0.046875,\"w\":16,\"h\":21},{\"c\":322,\"x0\":264,\"y0\":266,\"yoffs\":4,\"w\":11,\"h\":22},{\"c\":323,\"x0\":935,\"y0\":54,\"yoffs\":-2,\"xpad\":2.74219,\"w\":19,\"h\":28},{\"c\":324,\"x0\":104,\"y0\":228,\"yoffs\":3,\"xpad\":2.03906,\"w\":15,\"h\":23},{\"c\":325,\"x0\":756,\"y0\":8,\"yoffs\":5,\"xpad\":2.74219,\"w\":19,\"h\":29},{\"c\":326,\"x0\":578,\"y0\":143,\"yoffs\":10,\"xpad\":2.03906,\"w\":15,\"h\":24},{\"c\":327,\"x0\":971,\"y0\":54,\"yoffs\":-2,\"xpad\":2.74219,\"w\":19,\"h\":28},{\"c\":328,\"x0\":136,\"y0\":226,\"yoffs\":3,\"xpad\":2.03906,\"w\":15,\"h\":23},{\"c\":332,\"x0\":478,\"y0\":99,\"xpad\":1.22656,\"w\":21,\"h\":27},{\"c\":333,\"x0\":168,\"y0\":226,\"yoffs\":4,\"xpad\":0.828125,\"w\":16,\"h\":23},{\"c\":336,\"x0\":792,\"y0\":8,\"yoffs\":-2,\"xpad\":1.22656,\"w\":21,\"h\":29},{\"c\":337,\"x0\":610,\"y0\":143,\"yoffs\":3,\"xpad\":0.828125,\"w\":16,\"h\":24},{\"c\":338,\"x0\":292,\"y0\":264,\"yoffs\":5,\"xpad\":0.390625,\"w\":29,\"h\":22},{\"c\":339,\"x0\":8,\"y0\":347,\"yoffs\":10,\"xpad\":0.65625,\"w\":25,\"h\":17},{\"c\":340,\"x0\":8,\"y0\":103,\"yoffs\":-2,\"w\":19,\"h\":28},{\"c\":341,\"x0\":201,\"y0\":226,\"yoffs\":3,\"xpad\":0.203125,\"w\":10,\"h\":23},{\"c\":342,\"x0\":830,\"y0\":8,\"yoffs\":5,\"w\":19,\"h\":29},{\"c\":343,\"x0\":228,\"y0\":226,\"yoffs\":11,\"xpad\":0.203125,\"w\":10,\"h\":23},{\"c\":344,\"x0\":44,\"y0\":102,\"yoffs\":-2,\"w\":19,\"h\":28},{\"c\":345,\"x0\":255,\"y0\":226,\"yoffs\":3,\"xpad\":0.203125,\"w\":10,\"h\":23},{\"c\":346,\"x0\":866,\"y0\":8,\"yoffs\":-2,\"xpad\":1.32031,\"w\":15,\"h\":29},{\"c\":347,\"x0\":643,\"y0\":143,\"yoffs\":3,\"xpad\":0.28125,\"w\":13,\"h\":24},{\"c\":350,\"x0\":898,\"y0\":8,\"yoffs\":4,\"xpad\":1.32031,\"w\":15,\"h\":29},{\"c\":351,\"x0\":282,\"y0\":224,\"yoffs\":10,\"xpad\":0.28125,\"w\":13,\"h\":23},{\"c\":352,\"x0\":930,\"y0\":8,\"yoffs\":-2,\"xpad\":1.32031,\"w\":15,\"h\":29},{\"c\":353,\"x0\":673,\"y0\":142,\"yoffs\":3,\"xpad\":0.28125,\"w\":13,\"h\":24},{\"c\":354,\"x0\":80,\"y0\":100,\"yoffs\":5,\"w\":17,\"h\":28},{\"c\":355,\"x0\":840,\"y0\":99,\"yoffs\":7,\"xpad\":0.234375,\"w\":10,\"h\":26},{\"c\":356,\"x0\":114,\"y0\":100,\"yoffs\":-2,\"w\":17,\"h\":28},{\"c\":357,\"x0\":312,\"y0\":224,\"yoffs\":4,\"w\":15,\"h\":23},{\"c\":362,\"x0\":516,\"y0\":99,\"xpad\":2.04688,\"w\":19,\"h\":27},{\"c\":363,\"x0\":344,\"y0\":224,\"yoffs\":4,\"xpad\":1.64844,\"w\":15,\"h\":23},{\"c\":366,\"x0\":962,\"y0\":8,\"yoffs\":-2,\"xpad\":2.04688,\"w\":19,\"h\":29},{\"c\":367,\"x0\":8,\"y0\":148,\"yoffs\":2,\"xpad\":1.64844,\"w\":15,\"h\":25},{\"c\":368,\"x0\":8,\"y0\":57,\"yoffs\":-2,\"xpad\":2.04688,\"w\":19,\"h\":29},{\"c\":369,\"x0\":703,\"y0\":142,\"yoffs\":3,\"xpad\":1.64844,\"w\":15,\"h\":24},{\"c\":370,\"x0\":148,\"y0\":100,\"yoffs\":5,\"xpad\":2.04688,\"w\":19,\"h\":28},{\"c\":371,\"x0\":338,\"y0\":264,\"yoffs\":11,\"w\":17,\"h\":22},{\"c\":376,\"x0\":552,\"y0\":99,\"yoffs\":-1,\"w\":18,\"h\":27},{\"c\":377,\"x0\":184,\"y0\":100,\"yoffs\":-2,\"xpad\":0.226563,\"w\":17,\"h\":28},{\"c\":378,\"x0\":376,\"y0\":224,\"yoffs\":3,\"xpad\":0.851563,\"w\":13,\"h\":23},{\"c\":379,\"x0\":587,\"y0\":99,\"yoffs\":-1,\"xpad\":0.226563,\"w\":17,\"h\":27},{\"c\":380,\"x0\":372,\"y0\":264,\"yoffs\":4,\"xpad\":0.851563,\"w\":13,\"h\":22},{\"c\":381,\"x0\":218,\"y0\":100,\"yoffs\":-2,\"xpad\":0.226563,\"w\":17,\"h\":28},{\"c\":382,\"x0\":406,\"y0\":224,\"yoffs\":3,\"xpad\":0.851563,\"w\":13,\"h\":23},{\"c\":402,\"x0\":40,\"y0\":148,\"yoffs\":4,\"w\":12,\"h\":25},{\"c\":536,\"x0\":183,\"y0\":8,\"yoffs\":4,\"xpad\":1.32031,\"w\":15,\"h\":30},{\"c\":537,\"x0\":735,\"y0\":142,\"yoffs\":10,\"xpad\":0.28125,\"w\":13,\"h\":24},{\"c\":538,\"x0\":44,\"y0\":56,\"yoffs\":5,\"w\":17,\"h\":29},{\"c\":539,\"x0\":621,\"y0\":99,\"yoffs\":7,\"xpad\":0.234375,\"w\":10,\"h\":27},{\"c\":916,\"x0\":402,\"y0\":264,\"yoffs\":4,\"xpad\":3.88281,\"w\":23,\"h\":22},{\"c\":8226,\"x0\":134,\"y0\":378,\"yoffs\":13,\"xpad\":0.28125,\"w\":7,\"h\":6},{\"c\":8482,\"x0\":641,\"y0\":338,\"yoffs\":5,\"xpad\":0.882813,\"w\":22,\"h\":12},{\"c\":8592,\"x0\":796,\"y0\":334,\"yoffs\":11,\"xpad\":0.882813,\"w\":26,\"h\":10},{\"c\":8593,\"x0\":765,\"y0\":142,\"yoffs\":4,\"xpad\":7.88281,\"w\":19,\"h\":24},{\"c\":8594,\"x0\":839,\"y0\":334,\"yoffs\":11,\"xpad\":0.882813,\"w\":26,\"h\":10},{\"c\":8595,\"x0\":801,\"y0\":142,\"yoffs\":4,\"xpad\":7.88281,\"w\":19,\"h\":24},{\"c\":8734,\"x0\":544,\"y0\":339,\"yoffs\":11,\"xpad\":0.6875,\"w\":25,\"h\":14},{\"c\":9654,\"x0\":648,\"y0\":301,\"yoffs\":6,\"w\":17,\"h\":19},{\"c\":9660,\"x0\":50,\"y0\":347,\"yoffs\":7,\"w\":18,\"h\":17},{\"c\":9742,\"x0\":837,\"y0\":142,\"yoffs\":4,\"w\":31,\"h\":24},{\"c\":9743,\"x0\":885,\"y0\":141,\"yoffs\":4,\"w\":31,\"h\":24},{\"c\":65533,\"x0\":547,\"y0\":301,\"yoffs\":5,\"w\":20,\"h\":21}]}","/*eslint global-require:off*/\n// eslint-disable-next-line import/order\nconst local_storage = require('glov/client/local_storage.js');\nlocal_storage.setStoragePrefix('glovjs-perf'); // Before requiring anything else that might load from this\n\nimport * as engine from 'glov/client/engine.js';\nimport * as glov_font from 'glov/client/font.js';\nimport * as input from 'glov/client/input.js';\nconst { floor, sin } = Math;\nimport * as net from 'glov/client/net.js';\nimport * as particles from 'glov/client/particles.js';\nimport * as settings from 'glov/client/settings.js';\nimport { slider } from 'glov/client/slider.js';\nimport { FADE_IN, FADE_OUT, soundLoad, soundPlay, soundPlayMusic } from 'glov/client/sound.js';\nimport { spineCreate } from 'glov/client/spine.js';\nimport { createSpriteAnimation } from 'glov/client/sprite_animation.js';\nimport * as glov_sprites from 'glov/client/sprites.js';\nimport { createSprite } from 'glov/client/sprites.js';\nimport * as transition from 'glov/client/transition.js';\nimport * as ui from 'glov/client/ui.js';\nimport { uiHandlingNav } from 'glov/client/ui.js';\nimport * as ui_test from 'glov/client/ui_test.js';\nimport { v4clone, v4copy, vec2, vec4 } from 'glov/common/vmath.js';\nimport * as particle_data from './particle_data.js';\nimport { test3D } from './test_3d.js';\n\nwindow.Z = window.Z || {};\nZ.BACKGROUND = 1;\nZ.SPRITES = 10;\nZ.PARTICLES = 20;\nZ.UI_TEST = 200;\n\n// let app = exports;\n// Virtual viewport for our game logic\nexport const game_width = 320;\nexport const game_height = 240;\n\nexport let sprites = {};\n\nconst music_file = 'music_test.webm';\n\n// Persistent flags system for testing parameters\nlet flags = {};\nfunction flagGet(key, dflt) {\n  if (flags[key] === undefined) {\n    flags[key] = local_storage.getJSON(`flag_${key}`, dflt) || false;\n  }\n  return flags[key];\n}\nfunction flagToggle(key) {\n  flags[key] = !flagGet(key);\n  local_storage.setJSON(`flag_${key}`, flags[key]);\n}\nfunction flagSet(key, value) {\n  flags[key] = value;\n  local_storage.setJSON(`flag_${key}`, flags[key]);\n}\n\nconst color_white = vec4(1, 1, 1, 1);\nconst colors_active = ui.makeColorSet(vec4(0.5, 1, 0.5, 1));\nconst colors_inactive = ui.makeColorSet(vec4(0.5, 0.5, 0.5, 1));\n\nfunction perfTestSprites() {\n  if (!sprites.test) {\n    sprites.test = [\n      createSprite({ name: 'test', size: vec2(1, 1), origin: vec2(0.5, 0.5) }),\n      createSprite({ url: 'img/test.png?1', size: vec2(1, 1), origin: vec2(0.5, 0.5) }),\n    ];\n  }\n\n  let mode = 4;\n  let count = [\n    80000, // one sprite, pre-sorted\n    40000, // one sprite, unsorted\n    20000, // two sprites, unsorted, small batches\n    60000, // two sprites, sorted, bigger batches, sprite API\n    60000, // two sprites, sorted, bigger batches, raw API\n  ][mode];\n  if (mode === 3 || mode === 4) {\n    let z = 0;\n    for (let ii = 0; ii < count;) {\n      let subc = floor(500 + Math.random() * 100);\n      let idx = mode <= 1 ? 0 : Math.round(Math.random());\n      let sprite = sprites.test[idx];\n      for (let jj = 0; jj < subc; ++jj) {\n        if (mode === 4) {\n          // glov_sprites.queueraw(sprite.texs,\n          //   Math.random() * game_width - 3, Math.random() * game_height - 3, z,\n          //   6, 6, 0, 0, 1, 1, color_white);\n          glov_sprites.queuesprite(sprite,\n            Math.random() * game_width, Math.random() * game_height, z,\n            6 * sprite.size[0], 6 * sprite.size[1], 0, sprite.uvs, color_white);\n        } else {\n          sprites.test[idx].draw({\n            x: Math.random() * game_width,\n            y: Math.random() * game_height,\n            z,\n            w: 6, h: 6,\n          });\n        }\n        z+=0.01;\n      }\n      ii += subc;\n    }\n  } else {\n    for (let ii = 0; ii < count; ++ii) {\n      let idx = mode <= 1 ? 0 : Math.round(Math.random());\n      sprites.test[idx].draw({\n        x: Math.random() * game_width,\n        y: Math.random() * game_height,\n        z: mode === 0 ? ii : Math.random(),\n        w: 6, h: 6,\n      });\n    }\n  }\n}\n\nconst color_black = vec4(0,0,0,1);\nlet line_precise = 1;\nfunction lineTest() {\n  const line_len = 20;\n  let y_values = [\n    20, 25.25, 30.5, 35.667,\n    45 + sin(engine.frame_timestamp * 0.001) * 5\n  ];\n  let widths = [0.5, 1, 1.5, 2, 4];\n  let z = Z.UI;\n  line_precise = slider(line_precise, { x: 2, y: 2, min: 0, max: 1 });\n  for (let widx = 0; widx < widths.length; ++widx) {\n    let width = widths[widx];\n    let x0 = 10 + widx * (line_len + 4);\n    for (let jj = 0; jj < y_values.length; ++jj) {\n      let x = x0 + jj * 2;\n      let y = y_values[jj];\n      ui.drawLine(x, y, x + line_len, y, z, width, line_precise, color_black,\n        ui.LINE_ALIGN|ui.LINE_CAP_SQUARE);\n      z += 0.1;\n      ui.drawLine(x, y, x + line_len, y + 4.5, z, width, line_precise, color_black,\n        ui.LINE_ALIGN|ui.LINE_CAP_ROUND);\n      z += 0.1;\n      ui.drawLine(x, y, x, y + line_len / 2, z, width, line_precise, color_black,\n        ui.LINE_ALIGN|ui.LINE_CAP_SQUARE);\n      z += 0.1;\n    }\n  }\n  ui.drawLine(50, 72, 250, 200, z, 20, line_precise, color_black, ui.LINE_CAP_ROUND);\n}\n\nexport function main() {\n  if (engine.DEBUG) {\n    // Enable auto-reload, etc\n    net.init({ engine });\n  }\n\n  const font_info_04b03x2 = require('./img/font/04b03_8x2.json');\n  const font_info_04b03x1 = require('./img/font/04b03_8x1.json');\n  const font_info_palanquin32 = require('./img/font/palanquin32.json');\n  let pixely = flagGet('pixely', 'off');\n  let font;\n  if (pixely === 'strict') {\n    font = { info: font_info_04b03x1, texture: 'font/04b03_8x1' };\n  } else if (pixely && pixely !== 'off') {\n    font = { info: font_info_04b03x2, texture: 'font/04b03_8x2' };\n  } else {\n    font = { info: font_info_palanquin32, texture: 'font/palanquin32' };\n  }\n\n  if (!engine.startup({\n    game_width,\n    game_height,\n    pixely,\n    font,\n    viewport_postprocess: false,\n  })) {\n    return;\n  }\n  font = engine.font;\n\n  // const font = engine.font;\n\n  // Perfect sizes for pixely modes\n  ui.scaleSizes(13 / 32);\n  ui.setFontHeight(8);\n\n  settings.set('show_profiler', 1);\n  settings.set('max_fps', 0);\n  settings.set('show_fps', 4);\n  settings.set('fps_window', 10);\n\n  const color_red = vec4(1, 0, 0, 1);\n  const color_yellow = vec4(1, 1, 0, 1);\n\n  // Cache KEYS\n  const KEYS = input.KEYS;\n  const PAD = input.PAD;\n\n  const sprite_size = 64;\n  function initGraphics() {\n    particles.preloadParticleData(particle_data);\n\n    soundLoad('test');\n\n    sprites.white = createSprite({ url: 'white' });\n\n    sprites.test_tint = createSprite({\n      name: 'tinted',\n      ws: [16, 16, 16, 16],\n      hs: [16, 16, 16],\n      size: vec2(sprite_size, sprite_size),\n      layers: 2,\n      origin: vec2(0.5, 0.5),\n    });\n    sprites.animation = createSpriteAnimation({\n      idle_left: {\n        frames: [0,1],\n        times: [200, 500],\n      },\n      idle_right: {\n        frames: [3,2],\n        times: [200, 500],\n      },\n    });\n    sprites.animation.setState('idle_left');\n\n    sprites.game_bg = createSprite({\n      url: 'white',\n      size: vec2(game_width, game_height),\n    });\n  }\n\n  let spine_inited = false;\n  let spine_anim;\n  function spineInit() {\n    spine_inited = true;\n\n    spine_anim = spineCreate({\n      skel: 'spine/dino.skel',\n      atlas: 'spine/dino.atlas',\n      mix: {\n        idle: {\n          run: 0.25,\n        },\n        idle_left: {\n          run_left: 0.25,\n        },\n      },\n      anim: 'idle',\n    });\n  }\n\n  let last_particles = 0;\n\n  function test(dt) {\n    uiHandlingNav(); // register nav focus handler first in frame\n    gl.clearColor(0, 0.72, 1, 1);\n    if (1) {\n      return;\n    }\n    if (!test.color_sprite) {\n      test.color_sprite = v4clone(color_white);\n      test.character = {\n        x: (Math.random() * (game_width - sprite_size - 200) + (sprite_size * 0.5) + 200),\n        y: (Math.random() * (game_height - sprite_size) + (sprite_size * 0.5)),\n      };\n    }\n\n    if (flagGet('ui_test')) {\n      // let clip_test = 30;\n      // glov_sprites.clip(Z.UI_TEST - 10, Z.UI_TEST + 10, clip_test, clip_test, 320-clip_test * 2, 240-clip_test * 2);\n      ui_test.run(10, 10, Z.UI_TEST);\n    }\n    if (flagGet('font_test')) {\n      ui_test.runFontTest(105, 20);\n    }\n    if (flagGet('lines')) {\n      lineTest();\n    }\n\n    test.character.dx = 0;\n    test.character.dy = 0;\n    if (!uiHandlingNav()) {\n      test.character.dx -= input.keyDown(KEYS.LEFT) + input.keyDown(KEYS.A) + input.padButtonDown(PAD.LEFT);\n      test.character.dx += input.keyDown(KEYS.RIGHT) + input.keyDown(KEYS.D) + input.padButtonDown(PAD.RIGHT);\n      test.character.dy -= input.keyDown(KEYS.UP) + input.keyDown(KEYS.W) + input.padButtonDown(PAD.UP);\n      test.character.dy += input.keyDown(KEYS.DOWN) + input.keyDown(KEYS.S) + input.padButtonDown(PAD.DOWN);\n    }\n    if (test.character.dx < 0) {\n      sprites.animation.setState('idle_left');\n      if (spine_anim) {\n        spine_anim.setAnimation(0, 'run_left', true);\n      }\n    } else if (test.character.dx > 0) {\n      sprites.animation.setState('idle_right');\n      if (spine_anim) {\n        spine_anim.setAnimation(0, 'run', true);\n      }\n    } else if (spine_anim) {\n      if (spine_anim.getAnimation(0) === 'run') {\n        spine_anim.setAnimation(0, 'idle', true);\n      } else if (spine_anim.getAnimation(0) === 'run_left') {\n        spine_anim.setAnimation(0, 'idle_left', true);\n      }\n    }\n\n    test.character.x += test.character.dx * 0.05;\n    test.character.y += test.character.dy * 0.05;\n    let bounds = {\n      x: test.character.x - sprite_size/2,\n      y: test.character.y - sprite_size/2,\n      w: sprite_size,\n      h: sprite_size,\n    };\n    if (input.mouseDown(bounds)) {\n      v4copy(test.color_sprite, color_yellow);\n    } else if (input.click(bounds)) {\n      v4copy(test.color_sprite, (test.color_sprite[2] === 0) ? color_white : color_red);\n      soundPlay('test');\n    } else if (input.mouseOver(bounds)) {\n      v4copy(test.color_sprite, color_white);\n      test.color_sprite[3] = 0.5;\n    } else {\n      v4copy(test.color_sprite, color_white);\n      test.color_sprite[3] = 1;\n    }\n\n    // sprites.game_bg.draw({\n    //   x: 0, y: 0, z: Z.BACKGROUND,\n    //   color: [0, 0.72, 1, 1]\n    // });\n    if (flagGet('spine')) {\n      if (!spine_inited) {\n        spineInit();\n      }\n      spine_anim.update(dt * 2);\n      spine_anim.draw({\n        x: test.character.x, y: test.character.y, z: Z.SPRITES,\n        scale: 0.25,\n      });\n    } else {\n      sprites.test_tint.drawDualTint({\n        x: test.character.x,\n        y: test.character.y,\n        z: Z.SPRITES,\n        color: [1, 1, 0, 1],\n        color1: [1, 0, 1, 1],\n        frame: sprites.animation.getFrame(dt),\n      });\n    }\n\n    if (flagGet('4color')) {\n      sprites.test_tint.draw4Color({\n        x: test.character.x,\n        y: test.character.y + 64,\n        z: Z.SPRITES,\n        c0: [1, 0, 0, 1],\n        c1: [0, 1, 0, 1],\n        c2: [0, 0, 1, 1],\n        c3: [1, 0, 1, 1],\n        frame: sprites.animation.getFrame(),\n      });\n    }\n\n    let font_test_idx = 0;\n\n    ui.print(glov_font.styleColored(null, 0x000000ff),\n      test.character.x, test.character.y + (++font_test_idx * 20), Z.SPRITES,\n      'TEXT!');\n    let font_style = glov_font.style(null, {\n      outline_width: 1.0,\n      outline_color: 0x800000ff,\n      glow_xoffs: 3.25,\n      glow_yoffs: 3.25,\n      glow_inner: -2.5,\n      glow_outer: 5,\n      glow_color: 0x000000ff,\n    });\n    ui.print(font_style,\n      test.character.x, test.character.y + (++font_test_idx * ui.font_height), Z.SPRITES,\n      'Outline and Drop Shadow');\n\n    let x = ui.button_height;\n    let button_spacing = ui.button_height + 2;\n    let y = game_height - 10 - button_spacing * 7;\n    let mini_button_w = floor((ui.button_width - 2) / 2);\n\n    function miniButton(text, tooltip, active) {\n      let ret = ui.buttonText({\n        x, y, text, tooltip,\n        w: mini_button_w,\n        colors: active ? colors_active : colors_inactive,\n      });\n      x += 2 + mini_button_w;\n      if (x >= ui.button_width) {\n        x = ui.button_height;\n        y += button_spacing;\n      }\n      return ret;\n    }\n\n    if (ui.buttonText({ x, y, text: `Pixely: ${flagGet('pixely') || 'Off'}`,\n      tooltip: 'Toggles pixely or regular mode (requires reload)' })\n    ) {\n      if (flagGet('pixely') === 'strict') {\n        flagSet('pixely', false);\n      } else if (flagGet('pixely') === 'on') {\n        flagSet('pixely', 'strict');\n      } else {\n        flagSet('pixely', 'on');\n      }\n      if (document.location.reload) {\n        document.location.reload();\n      } else {\n        document.location = String(document.location);\n      }\n    }\n    y += button_spacing;\n\n    let rs3d_disabled = !flagGet('3d_test') || engine.render_width;\n    if (ui.buttonText({ x, y, text: `RenderScale3D: ${rs3d_disabled ? '' : settings.render_scale}`,\n      tooltip: 'Changes render_scale',\n      disabled: rs3d_disabled })\n    ) {\n      if (settings.render_scale === 1) {\n        settings.set('render_scale', 0.25);\n      } else {\n        settings.set('render_scale', 1);\n      }\n    }\n    y += button_spacing;\n\n    if (ui.buttonText({ x, y, text: `RenderScaleAll: ${settings.render_scale_all}`,\n      tooltip: 'Changes render_scale_all' })\n    ) {\n      if (settings.render_scale_all === 1) {\n        settings.set('render_scale_all', 0.5);\n      } else {\n        settings.set('render_scale_all', 1);\n      }\n    }\n    y += button_spacing;\n\n    font.drawSizedAligned(null, x, y, Z.UI, ui.font_height, font.ALIGN.HCENTER, ui.button_width, 0, 'Tests');\n    y += ui.font_height + 1;\n\n    let do_3d = flagGet('3d_test'); // before the toggle, so transition looks good\n    if (miniButton('3D', 'Toggles visibility of a 3D test', flagGet('3d_test'))) {\n      flagToggle('3d_test');\n      transition.queue(Z.TRANSITION_FINAL, transition.fade(500));\n    }\n\n    if (miniButton('Font', 'Toggles visibility of general Font tests', flagGet('font_test'))) {\n      flagToggle('font_test');\n      transition.queue(Z.TRANSITION_FINAL, transition.randomTransition());\n    }\n\n    if (miniButton('UI', 'Toggles visibility of general UI tests', flagGet('ui_test'))) {\n      flagToggle('ui_test');\n      if (flagGet('ui_test')) {\n        flagSet('lines', false);\n      }\n    }\n\n    if (miniButton('Lines', 'Toggles line drawing', flagGet('lines'))) {\n      flagToggle('lines');\n      if (flagGet('lines')) {\n        flagSet('ui_test', false);\n      }\n    }\n\n    if (miniButton('FX', 'Toggles particles', flagGet('particles'))) {\n      flagToggle('particles');\n    }\n\n    if (miniButton('Music', 'Toggles playing a looping background music track', flagGet('music'))) {\n      flagToggle('music');\n      if (flagGet('music')) {\n        soundPlayMusic(music_file, 1, FADE_IN);\n      } else {\n        soundPlayMusic(music_file, 0, FADE_OUT);\n      }\n    }\n\n    if (miniButton('Spine', 'Toggles Spine animation testing', flagGet('spine'))) {\n      flagToggle('spine');\n    }\n\n    if (flagGet('particles')) {\n      if (engine.getFrameTimestamp() - last_particles > 1000) {\n        last_particles = engine.getFrameTimestamp();\n        engine.glov_particles.createSystem(particle_data.defs.explosion,\n          //[test.character.x, test.character.y, Z.PARTICLES]\n          [100 + Math.random() * 120, 100 + Math.random() * 140, Z.PARTICLES]\n        );\n      }\n    }\n\n    if (flagGet('perf_test')) {\n      perfTestSprites();\n    }\n\n    if (do_3d) {\n      test3D();\n    }\n\n\n    // Debuggin full canvas stretching\n    // const camera2d = require('glov/client/camera2d.js');\n    // ui.drawLine(camera2d.x0(), camera2d.y0(), camera2d.x1(), camera2d.y1(), Z.BORDERS + 1, 1, 0.95,[1,0,1,0.5]);\n    // ui.drawLine(camera2d.x1(), camera2d.y0(), camera2d.x0(), camera2d.y1(), Z.BORDERS + 1, 1, 0.95,[1,0,1,0.5]);\n\n    // Debugging touch state on mobile\n    // const glov_camera2d = require('glov/client/camera2d.js');\n    // engine.font.drawSizedWrapped(engine.fps_style, glov_camera2d.x0(), glov_camera2d.y0(), Z.FPSMETER,\n    //   glov_camera2d.w(), 0, 22, JSON.stringify({\n    //     last_touch_state: input.last_touch_state,\n    //     touch_state: input.touch_state,\n    //   }, undefined, 2));\n  }\n\n  function testInit(dt) {\n    engine.setState(test);\n    if (flagGet('music')) {\n      soundPlayMusic(music_file);\n    }\n    test(dt);\n  }\n\n  initGraphics();\n  engine.setState(testInit);\n}\n","/*eslint global-require:off*/\n// eslint-disable-next-line import/order\nimport * as local_storage from 'glov/client/local_storage.js';\nlocal_storage.setStoragePrefix('glovjs-multiplayer'); // Before requiring anything else that might load from this\n\nimport * as assert from 'assert';\nimport { cmd_parse } from 'glov/client/cmds.js';\nimport * as engine from 'glov/client/engine.js';\nimport * as glov_font from 'glov/client/font.js';\nimport * as input from 'glov/client/input.js';\nconst { atan2, random } = Math;\nimport * as net from 'glov/client/net.js';\nimport * as net_position_manager from 'glov/client/net_position_manager.js';\nimport * as particles from 'glov/client/particles.js';\nimport * as shaders from 'glov/client/shaders.js';\nimport { socialInit } from 'glov/client/social.js';\nimport { soundLoad, soundPlay } from 'glov/client/sound.js';\nimport * as sprite_animation from 'glov/client/sprite_animation.js';\nimport * as glov_sprites from 'glov/client/sprites.js';\nimport * as ui from 'glov/client/ui.js';\nimport { uiHandlingNav } from 'glov/client/ui.js';\nimport { toNumber } from 'glov/common/util.js';\n\nimport { v2sub, v4copy, vec2, vec3, vec4 } from 'glov/common/vmath.js';\nimport { createAccountUI } from './account_ui.js';\nimport * as particle_data from './particle_data.js';\n\nwindow.Z = window.Z || {};\nZ.BACKGROUND = 1;\nZ.SPRITES = 10;\nZ.PARTICLES = 20;\n\nlet app = exports;\nwindow.app = app; // for debugging\n\nconst pos_manager = net_position_manager.create({ n: 3, dim_pos: 2, dim_rot: 1 });\n\nconst ROOM_REQUIRES_LOGIN = true;\n\n// Virtual viewport for our game logic\nexport const game_width = 1280;\nexport const game_height = 960;\n\nexport let sprites = {};\n\ncmd_parse.register({\n  cmd: 'bin_get',\n  func: function (str, resp_func) {\n    app.chat_ui.channel.pak('bin_get').send(function (err, pak) {\n      if (err) {\n        return void resp_func(err);\n      }\n      resp_func(null, pak.readBuffer(false).join(','));\n    });\n  },\n});\n\ncmd_parse.register({\n  cmd: 'bin_set',\n  func: function (str, resp_func) {\n    let pak = app.chat_ui.channel.pak('bin_set');\n    pak.writeBuffer(new Uint8Array(str.split(' ').map(toNumber)));\n    pak.send(resp_func);\n  },\n});\n\nexport function main() {\n  net.init({\n    engine,\n    cmd_parse,\n    auto_create_user: false,\n  });\n\n  if (!engine.startup({\n    game_width,\n    game_height,\n    pixely: false,\n    font: {\n      info: require('./img/font/palanquin32.json'),\n      texture: 'font/palanquin32',\n    },\n    safearea_ignore_bottom: true, // We keep the chat button out of the bottom center safe area trouble spot\n    ui_sounds: {\n      msg_err: 'msg_err',\n      msg_in: 'msg_in',\n      msg_out: 'msg_out',\n      msg_out_err: 'msg_out_err',\n      user_join: 'user_join',\n      user_leave: 'user_leave',\n    },\n  })) {\n    return;\n  }\n\n  // Init friends subsystem, just to register handler, not used in demo,\n  // alternatively, set DefaultUserWorker.prototype.rich_presence = false on the server.\n  socialInit();\n\n  const test_shader = shaders.create('shaders/test.fp');\n\n  // const font = engine.font;\n\n\n  const createSprite = glov_sprites.create;\n  const createAnimation = sprite_animation.create;\n\n  app.account_ui = createAccountUI();\n  app.chat_ui = require('glov/client/chat_ui.js').create({ max_len: 1000 });\n\n  const color_white = vec4(1, 1, 1, 1);\n  const color_gray = vec4(0.5, 0.5, 0.5, 1);\n  const color_red = vec4(1, 0, 0, 1);\n  const color_yellow = vec4(1, 1, 0, 1);\n\n  // Cache KEYS\n  const KEYS = input.KEYS;\n  const PAD = input.PAD;\n\n  const sprite_size = 64;\n  function initGraphics() {\n    particles.preloadParticleData(particle_data);\n\n    soundLoad('test');\n\n    sprites.white = createSprite({ url: 'white' });\n\n    sprites.test = createSprite({\n      name: 'test',\n      size: vec2(sprite_size, sprite_size),\n      origin: vec2(0.5, 0.5),\n    });\n    sprites.test_tint = createSprite({\n      name: 'tinted',\n      ws: [16, 16, 16, 16],\n      hs: [16, 16, 16],\n      size: vec2(sprite_size, sprite_size),\n      layers: 2,\n      origin: vec2(0.5, 0.5),\n    });\n    sprites.animation = createAnimation({\n      idle_left: {\n        frames: [0,1],\n        times: [200, 500],\n      },\n      idle_right: {\n        frames: [3,2],\n        times: [200, 500],\n      },\n    });\n    sprites.animation.setState('idle_left');\n\n    sprites.game_bg = createSprite({\n      url: 'white',\n      size: vec2(game_width, game_height),\n    });\n  }\n\n\n  let test_room;\n  let test;\n\n  function playerMotion(dt) {\n    // Network send\n    if (pos_manager.checkNet((pos) => {\n      test.character.x = pos[0];\n      test.character.y = pos[1];\n      test.character.rot = pos[2];\n    })) {\n      return;\n    }\n\n    if (uiHandlingNav()) {\n      return;\n    }\n\n    test.character.dx = 0;\n    test.character.dx -= input.keyDown(KEYS.LEFT) + input.keyDown(KEYS.A) + input.padButtonDown(PAD.LEFT);\n    test.character.dx += input.keyDown(KEYS.RIGHT) + input.keyDown(KEYS.D) + input.padButtonDown(PAD.RIGHT);\n    test.character.dy = 0;\n    test.character.dy -= input.keyDown(KEYS.UP) + input.keyDown(KEYS.W) + input.padButtonDown(PAD.UP);\n    test.character.dy += input.keyDown(KEYS.DOWN) + input.keyDown(KEYS.S) + input.padButtonDown(PAD.DOWN);\n    if (test.character.dx < 0) {\n      sprites.animation.setState('idle_left');\n    } else if (test.character.dx > 0) {\n      sprites.animation.setState('idle_right');\n    }\n\n    test.character.x += test.character.dx * 0.2;\n    test.character.y += test.character.dy * 0.2;\n    let bounds = {\n      x: test.character.x - sprite_size/2,\n      y: test.character.y - sprite_size/2,\n      w: sprite_size,\n      h: sprite_size,\n    };\n    if (input.mouseDown(bounds)) {\n      v4copy(test.color_sprite, color_yellow);\n    } else if (input.click(bounds)) {\n      v4copy(test.color_sprite, (test.color_sprite[2] === 0) ? color_white : color_red);\n      soundPlay('test');\n    } else if (input.mouseOver(bounds)) {\n      v4copy(test.color_sprite, color_white);\n      test.color_sprite[3] = 0.5;\n    } else {\n      v4copy(test.color_sprite, color_white);\n      test.color_sprite[3] = 1;\n    }\n\n    let aim = v2sub(vec2(), input.mousePos(), [test.character.x, test.character.y]);\n    test.character.rot = atan2(aim[0], -aim[1]);\n\n    // Network send\n    pos_manager.updateMyPos(new Float64Array([test.character.x, test.character.y, test.character.rot]), 'idle');\n  }\n\n  function getRoom() {\n    if (!test_room) {\n      test_room = net.subs.getChannel('test.test', true);\n      pos_manager.reinit({\n        channel: test_room,\n        default_pos: vec3(\n          (random() * (game_width - sprite_size) + (sprite_size * 0.5)),\n          (random() * (game_height - sprite_size) + (sprite_size * 0.5)),\n          0\n        ),\n      });\n      app.chat_ui.setChannel(test_room);\n    }\n  }\n\n  function preLogout() {\n    if (test_room) {\n      assert(test_room.subscriptions);\n      net.subs.unsubscribe(test_room.channel_id);\n      app.chat_ui.setChannel(null);\n      test_room = null;\n      if (!ROOM_REQUIRES_LOGIN) {\n        setTimeout(getRoom, 1);\n      }\n    }\n  }\n\n  test = function (dt) {\n    app.chat_ui.run();\n    app.account_ui.showLogin({\n      x: 0, y: 0,\n      prelogout: preLogout, center: false,\n      style: glov_font.style(null, {\n        outline_width: 2,\n        outline_color: 0xFFFFFFff,\n        color: 0x000000ff,\n      }),\n    });\n\n    if (!test.color_sprite) {\n      test.color_sprite = v4copy(vec4(), color_white);\n      test.character = { x: 0, y: 0, rot: 0 };\n    }\n\n    if (test_room && test_room.subscriptions) {\n      playerMotion(dt);\n\n      sprites.game_bg.draw({\n        x: 0, y: 0, z: Z.BACKGROUND,\n        color: [0.5, 0.6, 0.7, 1],\n        shader: test_shader,\n        shader_params: {\n          params: [1.0, 1.0, 1.0, engine.getFrameTimestamp() * 0.0005 % 1000],\n        },\n      });\n\n      sprites.test_tint.drawDualTint({\n        x: test.character.x,\n        y: test.character.y,\n        z: Z.SPRITES,\n        rot: test.character.rot,\n        color: [1, 1, 0, 1],\n        color1: [1, 0, 1, 1],\n        size: [sprite_size, sprite_size],\n        frame: sprites.animation.getFrame(dt),\n      });\n\n      // Draw other users\n      let room_clients = test_room.getChannelData('public.clients', {});\n      for (let client_id in room_clients) {\n        let other_client = room_clients[client_id];\n        if (other_client.pos && other_client.ids) {\n          let pcd = pos_manager.updateOtherClient(client_id, dt);\n          if (pcd) {\n            let pos = pcd.pos;\n            sprites.test.draw({\n              x: pos[0], y: pos[1], z: Z.SPRITES - 1,\n              rot: pos[2],\n              color: color_gray,\n            });\n            ui.font.drawSizedAligned(glov_font.styleColored(null, 0x00000080),\n              pos[0], pos[1] - 64, Z.SPRITES - 1,\n              ui.font_height, glov_font.ALIGN.HCENTER, 0, 0,\n              other_client.ids.display_name || `client_${client_id}`);\n          }\n        }\n      }\n    }\n\n    app.chat_ui.runLate();\n  };\n\n  function testInit(dt) {\n    engine.setState(test);\n    if (!ROOM_REQUIRES_LOGIN) {\n      getRoom();\n    }\n\n    net.subs.onLogin(getRoom);\n\n    test(dt);\n  }\n\n  initGraphics();\n  engine.setState(testInit);\n}\n","export let defs = {};\n\ndefs.explosion = {\n  particles: {\n    part0: {\n      blend: 'alpha',\n      texture: 'particles/circle64',\n      color: [1,1,1,1], // multiplied by animation track, default 1,1,1,1, can be omitted\n      color_track: [\n        // just values, NOT random range\n        { t: 0.0, v: [1,1,1,0] },\n        { t: 0.2, v: [1,1,1,1] },\n        { t: 0.4, v: [1,1,0.5,0.5] },\n        { t: 1.0, v: [1,0,0,0] },\n      ],\n      size: [[48,8], [48,8]], // multiplied by animation track\n      size_track: [\n        // just values, NOT random range\n        { t: 0.0, v: [1,1] },\n        { t: 0.2, v: [2,2] },\n        { t: 0.4, v: [1,1] },\n        { t: 1.0, v: [1.5,1.5] },\n      ],\n      accel: [0,0,0],\n      rot: [0,360], // degrees\n      rot_vel: [10,2], // degrees per second\n      lifespan: [2500,0], // milliseconds\n      kill_time_accel: 5,\n    },\n  },\n  emitters: {\n    part0: {\n      particle: 'part0',\n      // Random ranges affect each emitted particle:\n      pos: [[-16,32], [-16,32], 0],\n      vel: [0,0,0],\n      emit_rate: [15,0], // emissions per second\n      // Random ranges only calculated upon instantiation:\n      emit_time: [0,1000],\n      emit_initial: 10,\n      max_parts: Infinity,\n    },\n  },\n  system_lifespan: 2500,\n};\n","import * as mat4LookAt from 'gl-mat4/lookAt';\nimport * as engine from 'glov/client/engine.js';\nimport * as mat4ScaleRotateTranslate from 'glov/client/mat4ScaleRotateTranslate.js';\nimport * as models from 'glov/client/models.js';\nimport { qRotateZ, quat } from 'glov/client/quat.js';\nimport * as textures from 'glov/client/textures.js';\nimport { mat4, zaxis, zero_vec } from 'glov/common/vmath.js';\n\nlet mat_view = mat4();\nlet mat_obj = mat4();\nlet rot = quat();\n\nexport function test3D() {\n  if (!models.models.box) {\n    models.startup();\n  }\n  engine.start3DRendering();\n  mat4LookAt(mat_view, [5,4,3], zero_vec, zaxis);\n  engine.setGlobalMatrices(mat_view);\n  qRotateZ(rot, rot, engine.frame_dt * 0.001);\n  textures.bind(0, textures.textures.error);\n  mat4ScaleRotateTranslate(mat_obj, 1, rot, [1,1,0.03]);\n  models.models.box.draw(mat_obj);\n  mat4ScaleRotateTranslate(mat_obj, 1, rot, [0,0,0]);\n  models.models.box.draw(mat_obj);\n  mat4ScaleRotateTranslate(mat_obj, 1, rot, [1,0,0.01]);\n  models.models.box.draw(mat_obj);\n  mat4ScaleRotateTranslate(mat_obj, 1, rot, [0,1,0.02]);\n  models.models.box.draw(mat_obj);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// Things that should be done before requiring or running any user-level code or other engine code\n\nrequire('./polyfill.js');\n\nlet debug = document.getElementById('debug');\nwindow.onerror = function (e, file, line, col, errorobj) {\n  let msg = String(e);\n  if (msg === '[object Object]') {\n    try {\n      msg = JSON.stringify(e);\n    } catch (ignored) {\n      // ignored\n    }\n    msg = msg.slice(0, 600); // Not too huge\n  }\n  if (file || line > 0 || col > 0) {\n    msg += `\\n  at ${file}(${line}:${col})`;\n  }\n  if (errorobj && errorobj.stack) {\n    msg = `${errorobj.stack}`;\n    if (errorobj.message) {\n      if (msg.indexOf(errorobj.message) === -1) {\n        msg = `${errorobj.message}\\n${msg}`;\n      }\n    }\n    let origin = document.location.origin || '';\n    if (origin) {\n      if (origin.slice(-1) !== '/') {\n        origin += '/';\n      }\n      msg = msg.split(origin).join(''); // replace\n    }\n    // fixup weird Firefox weirdness\n    msg = msg.replace(/\\[\\d+\\]<\\/?/g, '') // remove funny [123]/ at start of stack lines\n      .replace(/\\/</g, '') // remove funny /<s, they mess up people's copy and paste, look funny\n      .replace(/<?\\/<?/g, '/') // remove funny </s, they mess up people's copy and paste\n      .replace(/\\n\\//g, '\\n') // remove preceding slashes, not sure where those come from\n      .replace(/\\n([^ ])/g, '\\n  $1'); // add indentation if missing\n  }\n  if (msg.indexOf('Error:') === -1) {\n    msg = `Error: ${msg}`;\n  }\n  if (errorobj && errorobj.type) {\n    if (errorobj.type === 'unhandledrejection') {\n      msg = `Uncaught (in promise) ${msg}`;\n    }\n  }\n  let show = true;\n  if (window.glov_error_report) {\n    show = window.glov_error_report(msg, file, line, col);\n  }\n  if (show) {\n    debug.innerText = `${msg}\\n\\nPlease report this error to the developer,` +\n      ' and then reload this page or restart the app.';\n  }\n};\nwindow.addEventListener('unhandledrejection', function (event) {\n  let errorobj = event.reason;\n  if (!errorobj) {\n    // Can't possibly get anything useful from this? `reject()` causes this, though, still useful to know?\n    return;\n  }\n  if (!errorobj || typeof errorobj !== 'object') {\n    errorobj = { stack: errorobj };\n  }\n  errorobj.type = event.type;\n  window.onerror(event.reason, undefined, 0, 0, errorobj);\n});\nwindow.debugmsg = function (msg, clear) {\n  if (clear) {\n    debug.innerText = msg;\n  } else {\n    debug.innerText += `${msg}\\n`;\n  }\n};\n\n// Placeholder profiler functions (in case shared/startup code calls them) until\n//   profiler is initialized/enabled.\n// eslint-disable-next-line @typescript-eslint/no-empty-function, func-name-matching\nwindow.profilerStart = window.profilerStop = window.profilerStopStart = function nop() {};\n","let ua = window.navigator.userAgent;\nexport let is_mac_osx = ua.match(/Mac OS X/);\nexport let is_ios = !window.MSStream && ua.match(/iPad|iPhone|iPod/);\nexport let is_windows_phone = ua.match(/windows phone/i);\nexport let is_android = !is_windows_phone && ua.match(/android/i);\nexport let is_webkit = ua.match(/WebKit/i);\nexport let is_ios_safari = is_ios && is_webkit && !ua.match(/CriOS/i);\nexport let is_firefox = ua.match(/Firefox/i);\n\nexport let is_discrete_gpu = false;\n\nfunction init() {\n  try {\n    let canvas = document.createElement('canvas');\n    canvas.width = 4;\n    canvas.height = 4;\n    let gltest = canvas.getContext('webgl');\n    if (gltest) {\n      let debug_info = gltest.getExtension('WEBGL_debug_renderer_info');\n      if (debug_info) {\n        let renderer_unmasked = gltest.getParameter(debug_info.UNMASKED_RENDERER_WEBGL);\n        is_discrete_gpu = Boolean(renderer_unmasked && renderer_unmasked.match(/nvidia|radeon/i));\n      }\n    }\n  } catch (e) {\n    // ignored\n  }\n}\ninit();\n","/* eslint-disable import/order */\nconst camera2d = require('./camera2d.js');\nconst engine = require('./engine.js');\nconst glov_font = require('./font.js');\nconst { min } = Math;\nconst { scrollAreaCreate } = require('./scroll_area.js');\nconst ui = require('./ui.js');\nconst net = require('./net.js');\nconst { plural } = require('glov/common/util.js');\nconst { vec4 } = require('glov/common/vmath.js');\n\nlet gbstate;\nlet server_error;\n\nZ.BUILD_ERRORS = Z.BUILD_ERRORS || 9900;\n\nfunction onGBState(state) {\n  gbstate = state;\n}\n\nfunction onServerError(err) {\n  server_error = err;\n}\n\nconst PAD = 4;\nconst color_panel = vec4(0,0,0,1);\nconst style_title = glov_font.styleColored(null, 0xFF2020ff);\nconst style = glov_font.styleColored(null, 0xDDDDDDff);\nconst style_task = glov_font.styleColored(null, 0x00DDDDff);\nconst style_job = glov_font.styleColored(null, 0x2020FFff);\nconst color_line = vec4(1,1,1,1);\n// eslint-disable-next-line no-control-regex\nconst strip_ansi = /\\u001b\\[(?:[0-9;]*)[0-9A-ORZcf-nqry=><]/g;\nlet scroll_area;\nfunction buildUITick() {\n  if (!gbstate && !server_error) {\n    return;\n  }\n  const x0 = camera2d.x0() + PAD;\n  const y0 = camera2d.y0() + PAD;\n  let z = Z.BUILD_ERRORS;\n  const w = camera2d.w() * 0.75;\n  const { font, title_font, font_height } = ui;\n  let x = x0;\n  let y = y0;\n\n  let error_count = (gbstate?.error_count || 0) + (server_error ? 1 : 0);\n  let warning_count = gbstate?.warning_count || 0;\n  title_font.drawSizedAligned(style_title, x, y, z, font_height, font.ALIGN.HCENTERFIT, w, 0,\n    `${error_count} ${plural(error_count, 'error')}, ` +\n    `${warning_count} ${plural(warning_count, 'warning')}`);\n  y += font_height + 1;\n  ui.drawLine(x0 + w * 0.3, y, x0 + w * 0.7, y, z, 0.5, true, color_line);\n  y += PAD;\n\n  if (!scroll_area) {\n    scroll_area = scrollAreaCreate({\n      z,\n      background_color: null,\n      auto_hide: true,\n    });\n  }\n\n  const max_h = camera2d.y1() - PAD - y;\n  let scroll_y_start = y;\n  scroll_area.begin({\n    x, y, w, h: max_h,\n  });\n  const sub_w = w - PAD - scroll_area.barWidth();\n  y = 0;\n  z = Z.UI;\n\n  function printLine(type, str) {\n    str = str.replace(strip_ansi, '');\n    y += font.drawSizedWrapped(style, x, y, z, sub_w, 0, font_height,\n      `${type}: ${str}`);\n  }\n\n  if (gbstate) {\n    for (let task_name in gbstate.tasks) {\n      let task = gbstate.tasks[task_name];\n      x = 0;\n      font.drawSizedAligned(style_task, x, y, z, font_height, font.ALIGN.HLEFT, sub_w, 0,\n        `${task_name}:`);\n      y += font_height;\n      x += font_height;\n      let printed_any = false;\n      for (let job_name in task.jobs) {\n        let job = task.jobs[job_name];\n        let { warnings, errors } = job;\n        if (job_name !== 'all') {\n          if (job_name.startsWith('source:')) {\n            job_name = job_name.slice(7);\n          }\n          y += font.drawSizedWrapped(style_job, x, y, z, sub_w, 0, font_height,\n            job_name);\n        }\n        if (warnings) {\n          for (let ii = 0; ii < warnings.length; ++ii) {\n            printLine('Warning', warnings[ii]);\n            printed_any = true;\n          }\n        }\n        if (errors) {\n          for (let ii = 0; ii < errors.length; ++ii) {\n            printLine('Error', errors[ii]);\n            printed_any = true;\n          }\n        }\n      }\n      if (!printed_any && task.err) {\n        printLine('Error', task.err);\n      }\n      y += PAD;\n    }\n  }\n\n  if (server_error) {\n    x = 0;\n    font.drawSizedAligned(style_task, x, y, z, font_height, font.ALIGN.HLEFT, sub_w, 0,\n      'Server Error:');\n    y += font_height;\n    x += font_height;\n    printLine('Server error', server_error);\n  }\n\n  scroll_area.end(y);\n  y = scroll_y_start + min(max_h, y);\n\n  if (ui.buttonText({\n    x: x0 + w - ui.button_height,\n    y: y0, z: Z.BUILD_ERRORS + 1,\n    w: ui.button_height,\n    text: 'X',\n  })) {\n    gbstate = null;\n    server_error = null;\n  }\n\n  ui.panel({\n    x: x0 - PAD, y: y0 - PAD, z: Z.BUILD_ERRORS - 1,\n    w: w + PAD * 2, h: y - y0 + PAD * 2,\n    color: color_panel,\n  });\n\n}\n\nexport function buildUIStartup() {\n  if (net.client && engine.DEBUG) {\n    net.client.onMsg('gbstate', onGBState);\n    net.client.onMsg('server_error', onServerError);\n    net.subs.on('connect', function () {\n      let pak = net.client.pak('gbstate_enable');\n      pak.writeBool(true);\n      pak.send();\n    });\n    engine.addTickFunc(buildUITick);\n  }\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint @typescript-eslint/no-shadow:off */\n\nconst engine = require('./engine.js');\n\nconst { max, round } = Math;\n\nconst safearea_pad = new Float32Array(4); // left, right, top, bottom\n// 0: x0_real\n// 1: y0_real\n// 2: x1_real\n// 3: y1_real\n// 4: x_scale\n// 5: y_scale\n// 6: dom_to_canvas_ratio\n// 7: inverse viewport x_scale\n// 8: inverse viewport y_scale\n// 9: x0\n// 10: y0\n// 11: x1\n// 12: y1\nexport const data = new Float32Array(13);\n\nlet screen_width;\nlet screen_height;\n// Note: render_* not used by FRVR at this time\nlet render_width;\nlet render_height;\nexport let render_viewport_w;\nexport let render_viewport_h;\nexport let render_offset_x;\nlet render_offset_y_top;\nexport let render_offset_y_bottom;\n\nfunction reapply() {\n  if (render_width) {\n    data[4] = render_width / (data[2] - data[0]);\n    data[5] = render_height / (data[3] - data[1]);\n    data[7] = (data[2] - data[0]) / render_viewport_w;\n    data[8] = (data[3] - data[1]) / render_viewport_h;\n  } else {\n    data[4] = screen_width / (data[2] - data[0]);\n    data[5] = screen_height / (data[3] - data[1]);\n  }\n}\n\n// To get to coordinates used by OpenGL / canvas\nexport function virtualToCanvas(dst, src) {\n  dst[0] = (src[0] - data[0]) * data[4];\n  dst[1] = (src[1] - data[1]) * data[5];\n}\n\nexport function canvasToVirtual(dst, src) {\n  dst[0] = src[0] / data[4] + data[0];\n  dst[1] = src[1] / data[5] + data[1];\n}\n\nfunction safeScreenWidth() {\n  return max(1, screen_width - safearea_pad[0] - safearea_pad[1]);\n}\n\nfunction safeScreenHeight() {\n  return max(1, screen_height - safearea_pad[2] - safearea_pad[3]);\n}\n\n// Sets the 2D \"camera\" used to translate sprite positions to screen space.  Affects sprites queued\n//  after this call\nexport function set(x0, y0, x1, y1, ignore_safe_area) {\n  if (ignore_safe_area || render_width) {\n    data[9] = data[0] = x0;\n    data[10] = data[1] = y0;\n    data[11] = data[2] = x1;\n    data[12] = data[3] = y1;\n  } else {\n    data[9] = x0;\n    data[10] = y0;\n    data[11] = x1;\n    data[12] = y1;\n    let wscale = (x1 - x0) / safeScreenWidth();\n    let hscale = (y1 - y0) / safeScreenHeight();\n    data[0] = x0 - safearea_pad[0] * wscale;\n    data[1] = y0 - safearea_pad[2] * hscale;\n    data[2] = x1 + safearea_pad[1] * wscale;\n    data[3] = y1 + safearea_pad[3] * hscale;\n  }\n\n  reapply();\n}\n\nexport function setSafeAreaPadding(left, right, top, bottom) {\n  safearea_pad[0] = round(left);\n  safearea_pad[1] = round(right);\n  safearea_pad[2] = round(top);\n  safearea_pad[3] = round(bottom);\n  // Called while updating screen width/height, reapply() should get called later\n}\n\nexport function safeAreaPadding() {\n  return safearea_pad;\n}\n\nconst stack = [];\nexport function push() {\n  stack.push(data.slice(0));\n}\nexport function pop() {\n  let old = stack.pop();\n  for (let ii = 0; ii < old.length; ++ii) {\n    data[ii] = old[ii];\n  }\n  reapply();\n}\n\nexport function domToCanvasRatio() {\n  return data[6];\n}\n\nexport function screenAspect() {\n  return safeScreenWidth() /\n    safeScreenHeight();\n}\n\n// Drawing area 0,0-w,h\n// But keep the aspect ratio of those things drawn to be correct\n// This may create a padding or margin on either top and bottom or sides of the screen\n// User users constant values in this range for consistent UI on all devices\nexport function setAspectFixed(w, h) {\n  let pa = render_width ? 1 : engine.pixel_aspect;\n  let inv_aspect = h / pa / w;\n  let inv_desired_aspect;\n  if (render_width) {\n    inv_desired_aspect = render_height / render_width;\n  } else {\n    inv_desired_aspect = 1 / screenAspect();\n  }\n  if (inv_aspect > inv_desired_aspect) {\n    let margin = (h / pa / inv_desired_aspect - w) / 2;\n    set(-margin, 0, w + margin, h, false);\n  } else {\n    let margin = (w * pa * inv_desired_aspect - h) / 2;\n    set(0, -margin, w, h + margin, false);\n  }\n}\n\n// Primary drawing area at least W x H\n// But keep the aspect ratio of those things drawn to be correct\n// Similar to setAspectFixed() but keeps (0,0) in the upper left (all padding\n//   is added to right and bottom)\n// Requires users to use camera2d.w()/ and camera2d.h() to determine reasonable\n//   UI positioning\nexport function setAspectFixed2(w, h) {\n  let pa = render_width ? 1 : engine.pixel_aspect;\n  let inv_aspect = h / pa / w;\n  let inv_desired_aspect;\n  if (render_width) {\n    inv_desired_aspect = render_height / render_width;\n  } else {\n    inv_desired_aspect = 1 / screenAspect();\n  }\n  if (inv_aspect > inv_desired_aspect) {\n    let margin = (h / pa / inv_desired_aspect - w);\n    set(0, 0, w + margin, h, false);\n  } else {\n    let margin = (w * pa * inv_desired_aspect - h);\n    set(0, 0, w, h + margin, false);\n  }\n}\n\nexport function zoom(x, y, factor) {\n  let inv_factor = 1.0 / factor;\n  set(\n    x - (x - data[0]) * inv_factor,\n    y - (y - data[1]) * inv_factor,\n    x + (data[2] - x) * inv_factor,\n    y + (data[3] - y) * inv_factor, true);\n}\n\nexport function shift(dx, dy) {\n  set(data[0] + dx, data[1] + dy, data[2] + dx, data[3] + dy, true);\n}\n\n// returns [x0,y0,x1,y1] to use as parameters set() such that src_rect in the\n// current view is now addressable by dest_rect (presumably something like\n// [0,0,vw,vh])\nexport function calcMap(out, src_rect, dest_rect) {\n  let cur_w = data[11] - data[9];\n  let cur_h = data[12] - data[10];\n  let vx0 = (src_rect[0] - data[0]) / cur_w;\n  let vy0 = (src_rect[1] - data[1]) / cur_h;\n  let vx1 = (src_rect[2] - data[0]) / cur_w;\n  let vy1 = (src_rect[3] - data[1]) / cur_h;\n  let vw = vx1 - vx0;\n  let vh = vy1 - vy0;\n  let dest_vw = dest_rect[2] - dest_rect[0];\n  let dest_vh = dest_rect[3] - dest_rect[1];\n  out[0] = dest_rect[0] - dest_vw / vw * vx0;\n  out[1] = dest_rect[1] - dest_vh / vh * vy0;\n  out[2] = dest_rect[2] + dest_vw / vw * (1 - vx1);\n  out[3] = dest_rect[3] + dest_vh / vh * (1 - vy1);\n  return out;\n}\n\nexport function setNormalized() {\n  set(0, 0, 1, 1, true);\n}\n\n// Sets virtual viewport equal to (DPI-aware) screen pixels\n//   (generally a bad idea, will not scale well without lots of app work)\nexport function setScreen(no_dpi_aware) {\n  if (render_width) {\n    set(0, 0, render_width, render_height);\n  } else if (no_dpi_aware) {\n    set(0, 0, safeScreenWidth(), safeScreenHeight());\n  } else {\n    set(0, 0, safeScreenWidth() / engine.dom_to_canvas_ratio, safeScreenHeight() / engine.dom_to_canvas_ratio);\n  }\n}\n\n// Sets virtual viewport equal to DOM coordinates, for debugging input events/etc\nexport function setDOMMapped() {\n  if (render_width) {\n    set(render_offset_x, render_offset_y_top,\n      screen_width - render_offset_x, screen_height - render_offset_y_top, true);\n  } else {\n    set(0, 0, screen_width / engine.dom_to_canvas_ratio, screen_height / engine.dom_to_canvas_ratio, true);\n  }\n}\n\nexport function x0Real() {\n  return data[0];\n}\nexport function y0Real() {\n  return data[1];\n}\nexport function x1Real() {\n  return data[2];\n}\nexport function y1Real() {\n  return data[3];\n}\nexport function wReal() {\n  return data[2] - data[0];\n}\nexport function hReal() {\n  return data[3] - data[1];\n}\nexport function x0() {\n  return data[9];\n}\nexport function y0() {\n  return data[10];\n}\nexport function x1() {\n  return data[11];\n}\nexport function y1() {\n  return data[12];\n}\nexport function w() {\n  return data[11] - data[9];\n}\nexport function h() {\n  return data[12] - data[10];\n}\nexport function xScale() {\n  return data[4];\n}\nexport function yScale() {\n  return data[5];\n}\n\nexport function htmlPos(x, y) {\n  if (render_width) {\n    return [\n      100 * (((x - data[0]) / data[7] + render_offset_x) / screen_width),\n      100 * (((y - data[1]) / data[8] + render_offset_y_top) / screen_height),\n    ];\n  } else {\n    return [\n      100 * (x - data[0]) / (data[2] - data[0]),\n      100 * (y - data[1]) / (data[3] - data[1]),\n    ];\n  }\n}\nexport function htmlSize(w, h) {\n  if (render_width) {\n    return [\n      100 * w / data[7] / screen_width,\n      100 * h / data[8] / screen_height,\n    ];\n  } else {\n    return [100 * w / (data[2] - data[0]), 100 * h / (data[3] - data[1])];\n  }\n}\n\nlet input_clipping;\nexport function setInputClipping(xywh) {\n  input_clipping = xywh;\n}\n\nexport function domToVirtual(dst, src) {\n  let ret = true;\n  if (input_clipping) {\n    if (src[0] < input_clipping[0] || src[0] > input_clipping[0] + input_clipping[2] ||\n      src[1] < input_clipping[1] || src[1] > input_clipping[1] + input_clipping[3]\n    ) {\n      ret = false;\n    }\n  }\n  if (render_width) {\n    dst[0] = (src[0] * data[6] - render_offset_x) * data[7] + data[0];\n    dst[1] = (src[1] * data[6] - render_offset_y_top) * data[8] + data[1];\n  } else {\n    dst[0] = src[0] * data[6] / data[4] + data[0];\n    dst[1] = src[1] * data[6] / data[5] + data[1];\n  }\n  return ret;\n}\n\nexport function domDeltaToVirtual(dst, src) {\n  if (render_width) {\n    dst[0] = src[0] * data[6] * data[7];\n    dst[1] = src[1] * data[6] * data[8];\n  } else {\n    dst[0] = src[0] * data[6] / data[4];\n    dst[1] = src[1] * data[6] / data[5];\n  }\n}\n\nlet input_clipping_virtual = new Float32Array(4);\nfunction updateVirtualInputClipping() {\n  domToVirtual(input_clipping_virtual, input_clipping);\n  //domDeltaToVirtual(input_clipping_virtual.slice(2), input_clipping.slice(2)) :\n  if (render_width) {\n    input_clipping_virtual[2] = input_clipping[2] * data[6] * data[7];\n    input_clipping_virtual[3] = input_clipping[3] * data[6] * data[8];\n  } else {\n    input_clipping_virtual[2] = input_clipping[2] * data[6] / data[4];\n    input_clipping_virtual[3] = input_clipping[3] * data[6] / data[5];\n  }\n}\n\n\n// To get to coordinates used by mouse events\nexport function virtualToDom(dst, src) {\n  if (render_width) {\n    dst[0] = (render_offset_x + (src[0] - data[0]) / data[7]) / data[6];\n    dst[1] = (render_offset_y_top + (src[1] - data[1]) / data[8]) / data[6];\n  } else {\n    dst[0] = (src[0] - data[0]) * data[4] / data[6];\n    dst[1] = (src[1] - data[1]) * data[5] / data[6];\n  }\n}\n\nexport function virtualToFontSize(height) {\n  if (render_width) {\n    return height / (data[6] * data[8]) * 0.84;\n  } else {\n    return height * data[5] / data[6] * 0.84;\n  }\n}\n\n// dst/src are x/y/w/h objects (e.g. from input system)\nexport function virtualToDomPosParam(dst, src) {\n  if (render_width) {\n    dst.x = (render_offset_x + (src.x - data[0]) / data[7]) / data[6];\n    dst.w = src.w / data[7] / data[6];\n    dst.y = (render_offset_y_top + (src.y - data[1]) / data[8]) / data[6];\n    dst.h = src.h / data[8] / data[6];\n  } else {\n    dst.x = (src.x - data[0]) * data[4] / data[6];\n    dst.w = src.w * data[4] / data[6];\n    dst.y = (src.y - data[1]) * data[5] / data[6];\n    dst.h = src.h * data[5] / data[6];\n  }\n  if (input_clipping) {\n    if (dst.x < input_clipping[0]) {\n      dst.w = max(0, dst.w - (input_clipping[0] - dst.x));\n      dst.x = input_clipping[0];\n    }\n    if (dst.y < input_clipping[1]) {\n      dst.h = max(0, dst.h - (input_clipping[1] - dst.y));\n      dst.y = input_clipping[1];\n    }\n    if (dst.x > input_clipping[0] + input_clipping[2]) {\n      dst.w = 0;\n    }\n    if (dst.y > input_clipping[1] + input_clipping[3]) {\n      dst.h = 0;\n    }\n  }\n}\n\nexport function clipTestRect(rect) {\n  if (!input_clipping) {\n    return true;\n  }\n  updateVirtualInputClipping();\n  let icv = input_clipping_virtual;\n  if (rect.x > icv[0] + icv[2] ||\n    rect.x + rect.w < icv[0] ||\n    rect.y > icv[1] + icv[3] ||\n    rect.y + rect.h < icv[1]\n  ) {\n    // fully clipped\n    return false;\n  }\n  if (rect.x < icv[0]) {\n    rect.w -= icv[0] - rect.x;\n    rect.x = icv[0];\n  }\n  if (rect.y < icv[1]) {\n    rect.h -= icv[1] - rect.y;\n    rect.y = icv[1];\n  }\n  if (rect.x + rect.w > icv[0] + icv[2]) {\n    rect.w = icv[0] + icv[2] - rect.x;\n  }\n  if (rect.y + rect.h > icv[1] + icv[3]) {\n    rect.h = icv[1] + icv[3] - rect.y;\n  }\n  return true;\n}\n\nexport function tickCamera2D() {\n  data[6] = engine.dom_to_canvas_ratio; /* dom_to_canvas_ratio */\n  screen_width = engine.width;\n  screen_height = engine.height;\n  let viewport = [0, 0, screen_width, screen_height];\n  if (engine.render_width) { // Note: render_* not used by FRVR at this time\n    render_width = engine.render_width;\n    render_height = engine.render_height;\n    // Find an offset so this rendered viewport is centered while preserving aspect ratio, just like setAspectFixed\n    let pa = engine.pixel_aspect;\n    let inv_aspect = render_height / pa / render_width;\n    let eff_screen_width = safeScreenWidth();\n    let eff_screen_height = safeScreenHeight();\n    let inv_desired_aspect = eff_screen_height / eff_screen_width;\n    if (inv_aspect > inv_desired_aspect) {\n      let margin = (render_height / inv_desired_aspect - render_width * pa) / 2 *\n        eff_screen_height / render_height;\n      render_offset_x = safearea_pad[0] + round(margin);\n      render_offset_y_top = safearea_pad[2];\n      render_offset_y_bottom = safearea_pad[3];\n      render_viewport_w = round(eff_screen_width - margin * 2);\n      render_viewport_h = eff_screen_height;\n    } else {\n      let margin = (render_width * inv_desired_aspect - render_height / pa) / 2 *\n        eff_screen_width / render_width;\n      render_offset_x = safearea_pad[0];\n      render_offset_y_top = safearea_pad[2] + round(margin);\n      render_offset_y_bottom = safearea_pad[3] + round(margin);\n      render_viewport_w = eff_screen_width;\n      render_viewport_h = round(eff_screen_height - margin * 2);\n    }\n    viewport[2] = render_width;\n    viewport[3] = render_height;\n  } else {\n    render_width = render_height = 0;\n    render_offset_x = 0;\n    render_offset_y_top = 0;\n    render_offset_y_bottom = 0;\n  }\n\n  reapply();\n\n  // let screen_width = engine.width;\n  // let screen_height = engine.height;\n  // let screen_aspect = screen_width / screen_height;\n  // let view_aspect = game_width / game_height;\n  // if (screen_aspect > view_aspect) {\n  //   let viewport_width = game_height * screen_aspect;\n  //   let half_diff = (viewport_width - game_width) / 2;\n  //   viewportRectangle = [-half_diff, 0, game_width + half_diff, game_height];\n  // } else {\n  //   let viewport_height = game_width / screen_aspect;\n  //   let half_diff = (viewport_height - game_height) / 2;\n  //   viewportRectangle = [0, -half_diff, game_width, game_height + half_diff];\n  // }\n\n  engine.setViewport(viewport);\n}\n\nexport function startup() {\n  screen_width = engine.width;\n  screen_height = engine.height;\n  set(0, 0, engine.width, engine.height);\n  tickCamera2D();\n}\n","// Portions Copyright 2020 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst { asyncParallel } = require('glov-async');\nconst camera2d = require('./camera2d.js');\nconst { cmd_parse } = require('./cmds.js');\nconst engine = require('./engine.js');\nconst glov_font = require('./font.js');\nconst { isFriend } = require('./social.js');\nconst input = require('./input.js');\nconst { link } = require('./link.js');\nconst local_storage = require('./local_storage.js');\nconst { getStringIfLocalizable } = require('./localization.js');\nconst { ceil, floor, max, min, round } = Math;\nconst { netClient, netClientId, netSubs, netUserId } = require('./net.js');\nconst { profanityFilter, profanityStartup } = require('./words/profanity.js');\nconst { scrollAreaCreate } = require('./scroll_area.js');\nconst settings = require('./settings.js');\nconst { spotUnfocus } = require('./spot.js');\nconst ui = require('./ui.js');\nconst { clamp, matchAll } = require('glov/common/util.js');\nconst { vec4, v3copy } = require('glov/common/vmath.js');\n\nconst FLAG_EMOTE = 1;\nconst FLAG_USERCHAT = 2;\n\nZ.CHAT = Z.CHAT || 500;\nZ.CHAT_FOCUSED = Z.CHAT_FOCUSED || Z.CHAT;\n\nconst color_user_rollover = vec4(1,1,1,0.5);\n\nconst MAX_PER_STYLE = {\n  join_leave: 3,\n};\n\nsettings.register({\n  chat_auto_unfocus: {\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n    help: 'Automatically unfocus chat after sending a message',\n  },\n  chat_show_join_leave: {\n    default_value: 1,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n    label: 'Show join/leave messages',\n    help: 'Show join/leave messages',\n  },\n  profanity_filter: {\n    default_value: 1,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n    help: 'Filter profanity in chat',\n  },\n});\n\nfunction CmdHistory() {\n  assert(local_storage.getStoragePrefix() !== 'demo'); // wrong initialization order\n  this.entries = new Array(50);\n  this.idx = local_storage.getJSON('console_idx'); // where we will next insert\n  if (typeof this.idx !== 'number' || this.idx < 0 || this.idx >= this.entries.length) {\n    this.idx = 0;\n  } else {\n    for (let ii = 0; ii < this.entries.length; ++ii) {\n      this.entries[ii] = local_storage.getJSON(`console_e${ii}`);\n    }\n  }\n  this.resetPos();\n}\nCmdHistory.prototype.setHist = function (idx, text) {\n  this.entries[idx] = text;\n  local_storage.setJSON(`console_e${idx}`, text);\n};\nCmdHistory.prototype.add = function (text) {\n  if (!text) {\n    return;\n  }\n  let idx = this.entries.indexOf(text);\n  if (idx !== -1) {\n    // already in there, just re-order\n    let target = (this.idx - 1 + this.entries.length) % this.entries.length;\n    while (idx !== target) {\n      let next = (idx + 1) % this.entries.length;\n      this.setHist(idx, this.entries[next]);\n      idx = next;\n    }\n    this.setHist(target, text);\n    return;\n  }\n  this.setHist(this.idx, text);\n  this.idx = (this.idx + 1) % this.entries.length;\n  local_storage.setJSON('console_idx', this.idx);\n  this.resetPos();\n};\nCmdHistory.prototype.unadd = function (text) {\n  // upon error, do not store this string in our history\n  let idx = (this.idx - 1 + this.entries.length) % this.entries.length;\n  if (this.entries[idx] !== text) {\n    return;\n  }\n  this.idx = idx;\n  local_storage.setJSON('console_idx', this.idx);\n  this.resetPos();\n};\nCmdHistory.prototype.resetPos = function () {\n  this.hist_idx = this.idx;\n  this.edit_line = '';\n};\nCmdHistory.prototype.prev = function (cur_text) {\n  if (this.hist_idx === this.idx) {\n    // if first time goine backwards, stash the current edit line\n    this.edit_line = cur_text;\n  }\n  let idx = (this.hist_idx - 1 + this.entries.length) % this.entries.length;\n  let text = this.entries[idx];\n  if (idx === this.idx || !text) {\n    // wrapped around, or got to empty\n    return this.entries[this.hist_idx] || '';\n  }\n  this.hist_idx = idx;\n  return text || '';\n};\nCmdHistory.prototype.next = function (cur_text) {\n  if (this.hist_idx === this.idx) {\n    return cur_text || '';\n  }\n  let idx = (this.hist_idx + 1) % this.entries.length;\n  this.hist_idx = idx;\n  if (this.hist_idx === this.idx) {\n    // just got back to head\n    let ret = this.edit_line;\n    this.edit_line = '';\n    return ret || '';\n  }\n  return this.entries[idx] || '';\n};\n\nfunction defaultGetRoles() {\n  let user_public_data;\n  if (netUserId() && netClient().connected) {\n    let user_channel = netSubs().getMyUserChannel();\n    user_public_data = user_channel.data && user_channel.data.public;\n    if (user_public_data?.permissions?.sysadmin) {\n      return { sysadmin: 1 };\n    }\n  }\n  return {};\n}\n\nfunction ChatUI(params) {\n  assert.equal(typeof params, 'object');\n  assert.equal(typeof params.max_len, 'number');\n  this.edit_text_entry = ui.createEditBox({\n    placeholder: 'Chat',\n    initial_focus: false,\n    auto_unfocus: true,\n    spatial_focus: false,\n    max_len: params.max_len,\n    text: '',\n  });\n  this.channel = null;\n\n  this.on_join = this.onMsgJoin.bind(this);\n  this.on_leave = this.onMsgLeave.bind(this);\n  this.on_chat = this.onMsgChat.bind(this);\n  this.on_chat_cb = null;\n  this.handle_cmd_parse = this.handleCmdParse.bind(this);\n  this.handle_cmd_parse_error = this.handleCmdParseError.bind(this);\n  cmd_parse.setDefaultHandler(this.handle_cmd_parse_error);\n  this.clearChat();\n  this.max_lines = params.max_lines || 8; // Max shown when chat not active\n  this.max_messages = params.max_messages || 1000; // Size of history kept\n  this.max_len = params.max_len;\n  this.font_height = params.font_height || ui.font_height;\n  this.hide_disconnected_message = params.hide_disconnected_message || false;\n  this.disconnected_message_top = params.disconnected_message_top || false;\n  this.scroll_area = scrollAreaCreate({\n    background_color: null,\n    auto_scroll: true,\n  });\n  this.w = params.w || engine.game_width / 2;\n  this.h = params.h || engine.game_height / 2; // excluding text entry\n  this.inner_width_adjust = params.inner_width_adjust || 0;\n  this.border = params.border || undefined;\n  this.volume_join_leave = params.volume_join_leave || 0.15;\n  this.volume_in = params.volume_in || 0.5;\n  this.volume_out = params.volume_out || 0.5;\n  this.msg_out_err_delay = params.msg_out_err_delay || 0; // Delay when playing msg_out_err after msg_out.\n  this.history = new CmdHistory();\n  this.get_roles = defaultGetRoles; // returns object for testing cmd access permissions\n  this.url_match = params.url_match; // runs `/url match[1]` if clicked\n  this.url_info = params.url_info; // Optional for grabbing the interesting portion of the URL for tooltip and /url\n  this.user_context_cb = params.user_context_cb; // Cb called with { user_id } on click\n\n  this.fade_start_time = params.fade_start_time || [10000, 1000];\n  this.fade_time = params.fade_time || [1000, 500];\n\n  this.setActiveSize(this.font_height, this.w);\n  let outline_width = params.outline_width || 1;\n\n  this.styles = {\n    def: glov_font.style(null, {\n      color: 0xEEEEEEff,\n      outline_width,\n      outline_color: 0x000000ff,\n    }),\n    system: glov_font.style(null, {\n      color: 0xAAAAAAff,\n      outline_width,\n      outline_color: 0x000000ff,\n    }),\n    error: glov_font.style(null, {\n      color: 0xDD0000ff,\n      outline_width,\n      outline_color: 0x000000ff,\n    }),\n    link: glov_font.style(null, {\n      color: 0x5040FFff,\n      outline_width,\n      outline_color: 0x000000ff,\n    }),\n    link_hover: glov_font.style(null, {\n      color: 0x0000FFff,\n      outline_width,\n      outline_color: 0x000000ff,\n    }),\n  };\n  this.styles.join_leave = this.styles.system;\n\n  netSubs().on('chat_broadcast', this.onChatBroadcast.bind(this));\n}\n\nChatUI.prototype.setActiveSize = function (font_height, w) {\n  let wrap_w = w - this.scroll_area.barWidth();\n  if (this.active_font_height !== font_height || this.wrap_w !== wrap_w) {\n    this.active_font_height = font_height;\n    this.indent = round(this.active_font_height/24 * 40);\n    this.wrap_w = wrap_w;\n    // recalc numlines\n    this.total_lines = 0;\n    for (let ii = 0; ii < this.msgs.length; ++ii) {\n      let elem = this.msgs[ii];\n      elem.numlines = ui.font.numLines(this.styles[elem.style] || this.styles.def,\n        this.wrap_w, this.indent, this.active_font_height, elem.msg_text);\n      this.total_lines += elem.numlines;\n    }\n  }\n};\n\nChatUI.prototype.clearChat = function () {\n  this.msgs = [];\n  this.total_lines = 0;\n};\n\nfunction notHidden(msg) {\n  return !msg.hidden;\n}\n\nChatUI.prototype.addMsgInternal = function (elem) {\n  elem.timestamp = elem.timestamp || Date.now();\n  if (elem.flags & FLAG_USERCHAT) {\n    if (elem.flags & FLAG_EMOTE) {\n      elem.msg_text = `${elem.display_name} ${elem.msg}`;\n    } else {\n      elem.msg_text = `[${elem.display_name}] ${elem.msg}`;\n    }\n  } else {\n    elem.msg_text = elem.msg;\n  }\n  elem.numlines = ui.font.numLines(this.styles[elem.style] || this.styles.def,\n    this.wrap_w, this.indent, this.active_font_height, elem.msg_text);\n  this.total_lines += elem.numlines;\n  this.msgs.push(elem);\n  let max_msgs = MAX_PER_STYLE[elem.style];\n  if (max_msgs) {\n    // Remove any more than max\n    // Also remove any for the same ID (want for 'join_leave', maybe not others?)\n    for (let ii = this.msgs.length - 2; ii >= 0; --ii) {\n      let elem2 = this.msgs[ii];\n      if (elem2.style === elem.style && !elem2.hidden) {\n        if (elem.id && elem2.id === elem.id) {\n          elem2.hidden = true;\n          this.total_lines -= elem2.numlines;\n          elem2.numlines = 0;\n        } else {\n          --max_msgs;\n          if (max_msgs <= 0) {\n            elem2.hidden = true;\n            this.total_lines -= elem2.numlines;\n            elem2.numlines = 0;\n            break;\n          }\n        }\n      }\n    }\n  }\n  if (this.msgs.length > this.max_messages * 1.25) {\n    this.msgs = this.msgs.filter(notHidden);\n    if (this.msgs.length > this.max_messages * 1.25) {\n      this.msgs.splice(0, this.msgs.length - this.max_messages);\n      this.total_lines = 0;\n      for (let ii = 0; ii < this.msgs.length; ++ii) {\n        this.total_lines += this.msgs[ii].numlines;\n      }\n    }\n  }\n};\n\nfunction toStr(val) {\n  val = getStringIfLocalizable(val);\n  return typeof val === 'string' ? val : JSON.stringify(val);\n}\n\nChatUI.prototype.addChat = function (msg, style) {\n  msg = toStr(msg);\n  console.log(msg);\n  this.addMsgInternal({ msg, style });\n};\nChatUI.prototype.addChatFiltered = function (data) {\n  data.msg = toStr(data.msg);\n  console.log(`Chat from ${data.id}: ${data.msg}`);\n  if (settings.profanity_filter && data.id !== (netUserId() || netClientId())) {\n    data.msg = profanityFilter(data.msg);\n  }\n  this.addMsgInternal(data);\n};\nChatUI.prototype.onMsgJoin = function (data) {\n  if (!settings.chat_show_join_leave) {\n    return;\n  }\n  if (data.client_id !== netClientId()) {\n    if (this.volume_join_leave) {\n      ui.playUISound('user_join', this.volume_join_leave);\n    }\n    this.addChatFiltered({\n      id: data.user_id || data.client_id,\n      display_name: data.display_name || data.client_id,\n      flags: FLAG_EMOTE|FLAG_USERCHAT,\n      msg: 'joined the channel',\n      style: 'join_leave',\n    });\n  }\n};\nChatUI.prototype.onMsgLeave = function (data) {\n  if (!settings.chat_show_join_leave) {\n    return;\n  }\n  if (this.volume_join_leave) {\n    ui.playUISound('user_leave', this.volume_join_leave);\n  }\n  this.addChatFiltered({\n    id: data.user_id || data.client_id,\n    display_name: data.display_name || data.client_id,\n    flags: FLAG_EMOTE|FLAG_USERCHAT,\n    msg: 'left the channel',\n    style: 'join_leave',\n  });\n};\n\nChatUI.prototype.registerOnMsgChatCB = function (cb) {\n  assert(!this.on_chat_cb);\n  this.on_chat_cb = cb;\n};\n\nChatUI.prototype.onMsgChat = function (data) {\n  if (this.on_chat_cb) {\n    this.on_chat_cb(data);\n  }\n  let { msg, id, client_id, display_name, flags, ts, quiet } = data;\n  if (!quiet && client_id !== netClientId()) {\n    if (this.volume_in) {\n      ui.playUISound('msg_in', this.volume_in);\n    }\n  }\n  display_name = display_name || id;\n  flags = (flags || 0) | FLAG_USERCHAT;\n  this.addChatFiltered({\n    id,\n    display_name,\n    msg,\n    flags,\n    timestamp: ts,\n    quiet,\n  });\n};\nChatUI.prototype.onChatBroadcast = function (data) {\n  let { msg, src } = data;\n  ui.playUISound('msg_err');\n  this.addChatFiltered({\n    msg: `[${src}] ${msg}`,\n    style: 'error',\n  });\n};\n\nChatUI.prototype.runLate = function () {\n  this.did_run_late = true;\n  if (input.keyDownEdge(input.KEYS.RETURN)) {\n    this.edit_text_entry.focus();\n  }\n  if (input.keyDownEdge(input.KEYS.SLASH) ||\n    input.keyDownEdge(input.KEYS.NUMPAD_DIVIDE)\n  ) {\n    this.edit_text_entry.focus();\n    this.edit_text_entry.setText('/');\n  }\n};\n\nChatUI.prototype.addChatError = function (err) {\n  this.addChat(`[error] ${toStr(err)}`, 'error');\n};\n\nChatUI.prototype.handleCmdParseError = function (err, resp) {\n  if (err) {\n    this.addChatError(err);\n  }\n};\n\nChatUI.prototype.handleCmdParse = function (err, resp) {\n  if (err) {\n    this.addChatError(err);\n  } else if (resp) {\n    this.addChat(`[system] ${toStr(resp)}`, 'system');\n  }\n};\n\nChatUI.prototype.setGetRoles = function (fn) {\n  this.get_roles = fn;\n};\n\nlet access_dummy = { access: null };\nChatUI.prototype.getAccessObj = function () {\n  access_dummy.access = this.get_roles();\n  return access_dummy;\n};\n\nChatUI.prototype.cmdParse = function (str, cb) {\n  let handleResult = cb ?\n    (err, resp) => {\n      this.handle_cmd_parse(err, resp);\n      if (cb) {\n        cb(err);\n      }\n    } :\n    this.handle_cmd_parse;\n  cmd_parse.handle(this.getAccessObj(), str, function (err, resp) {\n    if (err && cmd_parse.was_not_found) {\n      // forward to server\n      netSubs().sendCmdParse(str, handleResult);\n    } else {\n      handleResult(err, resp);\n    }\n  });\n};\n\nChatUI.prototype.cmdParseInternal = function (str) {\n  cmd_parse.handle(this.getAccessObj(), str, this.handle_cmd_parse_error);\n};\n\nfunction pad2(str) {\n  return `0${str}`.slice(-2);\n}\nfunction conciseDate(dt) {\n  return `${pad2(dt.getMonth() + 1)}-${pad2(dt.getDate())} ${pad2(dt.getHours())\n  }:${pad2(dt.getMinutes())}:${pad2(dt.getSeconds())}`;\n}\nlet help_font_style = glov_font.styleColored(null, 0x000000ff);\nlet help_font_style_cmd = glov_font.style(help_font_style, {\n  outline_width: 0.5,\n  outline_color: 0x000000FF,\n});\nlet help_rollover_color = vec4(0, 0, 0, 0.25);\nlet help_rollover_color2 = vec4(0, 0, 0, 0.125);\nconst TOOLTIP_MIN_PAGE_SIZE = 20;\nlet tooltip_page = 0;\nlet tooltip_last = '';\nlet tooltip_panel_color = vec4();\nfunction drawHelpTooltip(param) {\n  assert(Array.isArray(param.tooltip));\n  let tooltip = param.tooltip;\n  let num_pages = 1;\n  let h = param.font_height;\n  let eff_tooltip_pad = ui.tooltip_pad * 0.5;\n  let num_per_page = min(TOOLTIP_MIN_PAGE_SIZE, max(1, floor((param.y - camera2d.y0() - eff_tooltip_pad) / h) - 1));\n  if (tooltip.length > 20) {\n    let text = tooltip.join('\\n');\n    if (text !== tooltip_last) {\n      tooltip_page = 0;\n      tooltip_last = text;\n    }\n    num_pages = ceil(tooltip.length / num_per_page);\n    tooltip = tooltip.slice(tooltip_page * num_per_page, (tooltip_page + 1) * num_per_page);\n  } else {\n    tooltip_page = 0;\n    tooltip_last = '';\n  }\n  let w = param.tooltip_width;\n  let x = param.x;\n  let z = param.z || (Z.TOOLTIP + 5);\n  let text_x = x + eff_tooltip_pad;\n  let text_w = w - eff_tooltip_pad * 2;\n  let tooltip_y1 = param.y;\n\n  let alpha = 1;\n  let vis_h = eff_tooltip_pad * 2 + h * tooltip.length;\n  if (!param.do_selection && num_pages === 1 && input.mouseOver({\n    x,\n    y: tooltip_y1 - vis_h,\n    w,\n    h: vis_h,\n  })) {\n    alpha = 0.15;\n  }\n  let style = help_font_style;\n  if (alpha !== 1) {\n    style = glov_font.styleAlpha(style, alpha);\n  }\n\n  let y = tooltip_y1 - eff_tooltip_pad;\n  let ret = null;\n  if (num_pages > 1) {\n    y -= h;\n    ui.font.drawSizedAligned(help_font_style,\n      text_x, y, z+1, h, glov_font.ALIGN.HCENTER,\n      text_w, 0,\n      `Page ${tooltip_page + 1} / ${num_pages}`);\n    let pos = { x, y, w, h };\n    if (input.mouseUpEdge(pos)) { // up instead of down to prevent canvas capturing focus\n      tooltip_page = (tooltip_page + 1) % num_pages;\n    } else if (input.mouseOver(pos)) {\n      ui.drawRect(x, y, x + w, y + h, z + 0.5, help_rollover_color);\n    }\n  }\n  for (let ii = tooltip.length - 1; ii >= 0; --ii) {\n    let line = tooltip[ii];\n    y -= h;\n    let idx = line.indexOf(' ');\n    if (line[0] === '/' && idx !== -1 && param.do_selection) {\n      // is a command\n      let cmd = line.slice(0, idx);\n      let help = line.slice(idx);\n      let cmd_w = ui.font.drawSized(help_font_style_cmd,\n        text_x, y, z+1, h, cmd);\n      ui.font.drawSizedAligned(help_font_style,\n        text_x + cmd_w, y, z+2, h, glov_font.ALIGN.HFIT,\n        text_w - cmd_w, 0,\n        help);\n      let pos = { x, y, w, h };\n      if (input.mouseUpEdge(pos)) { // up instead of down to prevent canvas capturing focus\n        ret = cmd.slice(1);\n      } else if (input.mouseOver(pos)) {\n        ui.drawRect(x, y, text_x + cmd_w + 4, y + h, z + 0.5, help_rollover_color);\n        ui.drawRect(text_x + cmd_w + 4, y, x + w, y + h, z + 0.5, help_rollover_color2);\n      }\n    } else {\n      ui.font.drawSizedAligned(style,\n        text_x, y, z+1, h, glov_font.ALIGN.HFIT,\n        text_w, 0,\n        line);\n    }\n  }\n  y -= eff_tooltip_pad;\n  let pixel_scale = ui.tooltip_panel_pixel_scale * 0.5;\n\n  v3copy(tooltip_panel_color, ui.color_panel);\n  tooltip_panel_color[3] = alpha;\n  ui.panel({\n    x, y, z, w,\n    h: tooltip_y1 - y,\n    pixel_scale,\n    color: tooltip_panel_color,\n  });\n  return ret;\n}\n\nChatUI.prototype.isFocused = function () {\n  return this.edit_text_entry && this.edit_text_entry.isFocused();\n};\n\nChatUI.prototype.sendChat = function (flags, text) {\n  if (!netClient().connected) {\n    this.addChatError('Cannot chat: Disconnected');\n  } else if (!this.channel || !netSubs().loggedIn() && !netSubs().allow_anon) {\n    this.addChatError('Cannot chat: Must be logged in');\n  } else if (text.length > this.max_len) {\n    this.addChatError('Chat message too long');\n  } else {\n    let pak = this.channel.pak('chat');\n    pak.writeInt(flags);\n    pak.writeString(text);\n    pak.send((err, data) => {\n      if (err) {\n        if (err === 'ERR_ECHO') {\n          this.onMsgChat({\n            msg: text,\n            id: netUserId(),\n            client_id: netClientId(),\n            display_name: netSubs().logged_in_display_name,\n            flags,\n          });\n        } else {\n          this.addChatError(err);\n          if (!this.edit_text_entry.getText()) {\n            this.edit_text_entry.setText(text);\n          }\n        }\n      }\n    });\n  }\n};\n\nChatUI.prototype.run = function (opts) {\n  const UI_SCALE = ui.font_height / 24;\n  opts = opts || {};\n  const border = opts.border || this.border || (8 * UI_SCALE);\n  const SPACE_ABOVE_ENTRY = border;\n  const scroll_grow = opts.scroll_grow || 0;\n  if (netClient().disconnected && !this.hide_disconnected_message) {\n    ui.font.drawSizedAligned(\n      glov_font.style(null, {\n        outline_width: 2,\n        outline_color: 0x000000ff,\n        color: 0xDD2020ff\n      }),\n      camera2d.x0(),\n      this.disconnected_message_top ? engine.game_height * 0.80 : camera2d.y0(),\n      Z.DEBUG,\n      ui.font_height,\n      this.disconnected_message_top ? glov_font.ALIGN.HCENTER : glov_font.ALIGN.HVCENTER,\n      camera2d.w(), camera2d.h() * 0.20,\n      `Connection lost, attempting to reconnect (${(netClient().timeSinceDisconnect()/1000).toFixed(0)})...`);\n  }\n\n  // Test sending a stream of chat\n  // if (engine.defines.CHATTER) {\n  //   this.chatter_countdown = (this.chatter_countdown || 0) - engine.frame_dt;\n  //   if (this.chatter_countdown < 0) {\n  //     this.sendChat(0, `Something random ${Math.random()}`);\n  //     this.chatter_countdown = 1000 * Math.random();\n  //   }\n  // }\n\n  if (!this.did_run_late) {\n    this.runLate();\n  }\n  this.did_run_late = false;\n  const x0 = opts.x === undefined ? camera2d.x0() : opts.x;\n  const y0 = opts.y === undefined ? camera2d.y1() - this.h : opts.y;\n  const y1 = y0 + this.h;\n  let x = x0 + border;\n  let y = y1;\n  let outer_w = this.w;\n  let was_focused = this.isFocused();\n  let z = was_focused ? Z.CHAT_FOCUSED : Z.CHAT;\n  let is_focused = false;\n  let font_height = this.font_height;\n  let anything_visible = false;\n  let hide_light = (opts.hide || engine.defines.NOUI || !netSubs().loggedIn()) &&\n    !was_focused ?\n    1 : // must be numerical, used to index fade values\n    0;\n  let hide_text_input = ui.modal_dialog || ui.menu_up || hide_light;\n  if (!hide_text_input && was_focused && input.touch_mode) {\n    // expand chat when focused on touch devices\n    outer_w = camera2d.x1() - x0 - 24 * UI_SCALE;\n    let font_scale = 4;\n    let aspect = camera2d.screenAspect();\n    if (aspect > 2) { // scale up to font scale of 8\n      font_scale = 4 + 4 * min((aspect - 2) / 8, 1);\n    }\n    font_height *= font_scale;\n  }\n  const inner_w = outer_w - border + this.inner_width_adjust;\n  this.setActiveSize(font_height, inner_w); // may recalc numlines on each elem; updates wrap_w\n  if (!hide_text_input) {\n    anything_visible = true;\n    y -= border + font_height + 1;\n    if (!was_focused && opts.pointerlock && input.pointerLocked()) {\n      // do not show edit box\n      ui.font.drawSizedAligned(this.styles.def, x, y, z + 1, font_height, glov_font.ALIGN.HFIT, inner_w, 0,\n        '<Press Enter to chat>');\n    } else {\n      if (was_focused) {\n        // Do auto-complete logic *before* edit box, so we can eat TAB without changing focus\n        // Eat tab even if there's nothing to complete, for consistency\n        let pressed_tab = !input.keyDown(input.KEYS.SHIFT) && input.keyDownEdge(input.KEYS.TAB);\n        if (pressed_tab) {\n          this.edit_text_entry.focus();\n        }\n        let cur_text = this.edit_text_entry.getText();\n        if (cur_text) {\n          if (cur_text[0] === '/') {\n            // do auto-complete\n            let autocomplete = cmd_parse.autoComplete(cur_text.slice(1), this.getAccessObj().access);\n            if (autocomplete && autocomplete.length) {\n              let first = autocomplete[0];\n              let auto_text = [];\n              for (let ii = 0; ii < autocomplete.length; ++ii) {\n                let elem = autocomplete[ii];\n                auto_text.push(`/${elem.cmd} - ${elem.help}`);\n              }\n              let do_selection = false; // should we allow clicking in the tooltip?\n              if (autocomplete.length === 1 &&\n                first.cname &&\n                cmd_parse.canonical(cur_text.slice(1)).slice(0, first.cname.length) === first.cname\n              ) {\n                // we've typed something that matches the first one\n                if (first.usage) {\n                  auto_text = first.usage.split('\\n');\n                } else {\n                  auto_text = [first.help];\n                }\n              } else {\n                do_selection = true;\n              }\n              let tooltip_y = y;\n              // check if last message is an error, if so, tooltip above that.\n              let last_msg = this.msgs[this.msgs.length - 1];\n              if (last_msg) {\n                let msg = last_msg.msg;\n                if (msg && !(last_msg.flags & FLAG_USERCHAT) && msg.slice(0, 7) === '[error]') {\n                  let numlines = last_msg.numlines;\n                  tooltip_y -= font_height * numlines + SPACE_ABOVE_ENTRY;\n                }\n              }\n\n              let selected = drawHelpTooltip({\n                x, y: tooltip_y,\n                tooltip_width: max(inner_w, engine.game_width * 0.8),\n                tooltip: auto_text,\n                do_selection,\n                font_height: min(font_height, camera2d.w() / 30),\n              });\n              if (do_selection) {\n                // auto-completes to something different than we have typed\n                // Do not use ENTER as well, because sometimes a hidden command is a sub-string of a shown command?\n                if (pressed_tab || selected) {\n                  this.edit_text_entry.setText(`/${selected || first.cmd} `);\n                }\n              }\n            }\n          }\n        } else {\n          this.history.resetPos();\n        }\n        if (input.keyDownEdge(input.KEYS.UP)) {\n          this.edit_text_entry.setText(this.history.prev(cur_text));\n        }\n        if (input.keyDownEdge(input.KEYS.DOWN)) {\n          this.edit_text_entry.setText(this.history.next(cur_text));\n        }\n        this.scroll_area.keyboardScroll();\n      }\n      let input_height = font_height;\n      let input_width = inner_w - (opts.cuddly_scroll ? this.scroll_area.barWidth() + 1 + border : border);\n      if (input.touch_mode && !was_focused) {\n        y -= font_height * 2;\n        input_height = font_height * 3;\n        input_width = font_height * 6;\n      }\n      let res = this.edit_text_entry.run({\n        x, y, w: input_width, font_height: input_height, pointer_lock: opts.pointerlock\n      });\n      is_focused = this.isFocused();\n      if (res === this.edit_text_entry.SUBMIT) {\n        this.scroll_area.scrollToEnd();\n        let text = this.edit_text_entry.getText().trim();\n        if (text) {\n          let start_time = Date.now();\n          this.edit_text_entry.setText('');\n          if (text[0] === '/') {\n            if (text[1] === '/') { // common error of starting with //foo because chat was already focused\n              text = text.slice(1);\n            }\n            this.history.add(text);\n            if (netSubs()) {\n              netSubs().serverLog('cmd', text);\n            }\n            this.cmdParse(text.slice(1), (err) => {\n              if (!err) {\n                return;\n              }\n              if (this.volume_out) {\n                setTimeout(\n                  () => ui.playUISound('msg_out_err', this.volume_out),\n                  max(0, this.msg_out_err_delay * 1000 - (Date.now() - start_time))\n                );\n              }\n              if (!this.edit_text_entry.getText()) {\n                // this.history.unadd(text);\n                this.edit_text_entry.setText(text);\n              }\n              if (!is_focused) { // was auto-unfocused\n                this.edit_text_entry.focus();\n              }\n            });\n          } else {\n            this.sendChat(0, text);\n          }\n          if (this.volume_out) {\n            ui.playUISound('msg_out', this.volume_out); // after cmdParse may have adjust volume\n          }\n          if (settings.chat_auto_unfocus) {\n            is_focused = false;\n            spotUnfocus();\n          }\n        } else {\n          is_focused = false;\n          spotUnfocus();\n        }\n      }\n    }\n  }\n  y -= SPACE_ABOVE_ENTRY;\n\n  let { url_match, url_info, styles, wrap_w, user_context_cb } = this;\n  let self = this;\n  let do_scroll_area = is_focused || opts.always_scroll;\n  let bracket_width = 0;\n  let name_width = {};\n  // Slightly hacky: uses `x` and `y` from the higher scope\n  function drawChatLine(msg, alpha) {\n    if (msg.hidden) {\n      return;\n    }\n    let line = msg.msg_text;\n    let numlines = msg.numlines;\n    let is_url = do_scroll_area && url_match && matchAll(line, url_match);\n    is_url = is_url && is_url.length === 1 && is_url[0];\n    let url_label = is_url;\n    if (is_url && url_info) {\n      let m = is_url.match(url_info);\n      if (m) {\n        url_label = m[1];\n      }\n    }\n    let h = font_height * numlines;\n    let do_mouseover = do_scroll_area && !input.mousePosIsTouch() && (!msg.style || msg.style === 'def' || is_url);\n    let text_w;\n    let mouseover = false;\n    if (do_mouseover) {\n      text_w = ui.font.getStringWidth(styles.def, font_height, line);\n      // mouseOver peek because we're doing it before checking for clicks\n      mouseover = input.mouseOver({ x, y, w: min(text_w, wrap_w), h, peek: true });\n    }\n    let user_mouseover = false;\n    let user_indent = 0;\n    let did_user_context = false;\n    if ((msg.flags & FLAG_USERCHAT) && user_context_cb && msg.id && do_scroll_area) {\n      let nw = name_width[msg.display_name];\n      if (!nw) {\n        nw = name_width[msg.display_name] = ui.font.getStringWidth(styles.def, font_height, msg.display_name);\n      }\n      if (!(msg.flags & FLAG_EMOTE)) {\n        if (!bracket_width) {\n          bracket_width = ui.font.getStringWidth(styles.def, font_height, '[]');\n        }\n        nw += bracket_width;\n      }\n      user_indent = nw;\n      let pos_param = {\n        x, y, w: min(nw, wrap_w), h: font_height, button: 0, peek: true,\n        z: z + 0.5,\n        color: color_user_rollover,\n      };\n      if (input.click(pos_param)) {\n        did_user_context = true;\n        user_context_cb({\n          user_id: msg.id, // Need any other msg. params?\n          // x: pos_param.x + pos_param.w,\n          // y: pos_param.y,\n        });\n      } else {\n        user_mouseover = input.mouseOver(pos_param);\n        if (user_mouseover) {\n          ui.drawRect2(pos_param);\n        }\n      }\n    }\n    let click;\n    if (is_url) {\n      click = link({ x: x + user_indent, y, w: wrap_w - user_indent, h, url: is_url, internal: true });\n    }\n\n    let style = styles[msg.style || (is_url ? mouseover && !user_mouseover ? 'link_hover' : 'link' : 'def')];\n\n    // Draw the actual text\n    ui.font.drawSizedWrapped(glov_font.styleAlpha(style, alpha), x, y, z + 1, wrap_w, self.indent, font_height, line);\n\n    if (mouseover && (!do_scroll_area || y > self.scroll_area.getScrollPos() - font_height) &&\n      // Only show tooltip for user messages or links\n      (!msg.style || msg.style === 'def' || is_url)\n    ) {\n      ui.drawTooltip({\n        x, y, z: Z.TOOLTIP,\n        tooltip_above: true,\n        tooltip_width: 450 * UI_SCALE,\n        tooltip_pad: round(ui.tooltip_pad * 0.5),\n        tooltip: is_url && !user_mouseover ?\n          `Click to open ${url_label}` :\n          `Received${msg.id ? ` from \"${msg.id}\"` : ''} at ${conciseDate(new Date(msg.timestamp))}\\n` +\n          'Right-click to copy message' +\n          `${(user_mouseover ? '\\nClick to view user info' : '')}`,\n        pixel_scale: ui.tooltip_panel_pixel_scale * 0.5,\n      });\n    }\n    // Previously: mouseDownEdge because by the time the Up happens, the chat text might not be here anymore\n    click = click || input.click({ x, y, w: wrap_w, h });\n    if (did_user_context) {\n      click = null;\n    }\n    if (click) {\n      if (click.button === 2) {\n        ui.provideUserString('Chat Text', is_url || line);\n      } else if (is_url) {\n        self.cmdParseInternal(`url ${url_label}`);\n      }\n    }\n    anything_visible = true;\n  }\n\n\n  let now = Date.now();\n  if (do_scroll_area) {\n    // within scroll area, just draw visible parts\n    let scroll_internal_h = this.total_lines * font_height;\n    if (opts.cuddly_scroll) {\n      let new_y = y1 - border;\n      scroll_internal_h += new_y - y;\n      y = new_y;\n    }\n    scroll_internal_h += scroll_grow;\n    y += scroll_grow;\n    let scroll_y0 = opts.always_scroll ? y0 + border - scroll_grow : y - min(this.h, scroll_internal_h);\n    let scroll_external_h = y - scroll_y0;\n    let clip_offs = 1; // for font outline\n    this.scroll_area.begin({\n      x: x - clip_offs,\n      y: scroll_y0, z,\n      w: inner_w + clip_offs,\n      h: scroll_external_h,\n      focusable_elem: this.edit_text_entry,\n      auto_hide: this.total_lines <= 2,\n    });\n    let x_save = x;\n    let y_save = y;\n    x = clip_offs;\n    y = 0;\n    let y_min = this.scroll_area.getScrollPos();\n    let y_max = y_min + scroll_external_h;\n    for (let ii = 0; ii < this.msgs.length; ++ii) {\n      let msg = this.msgs[ii];\n      let h = font_height * msg.numlines;\n      if (y <= y_max && y + h >= y_min) {\n        drawChatLine(msg, 1);\n      }\n      y += h;\n    }\n    this.scroll_area.end(scroll_internal_h);\n    x = x_save;\n    y = y_save - scroll_external_h + scroll_grow;\n    // Eat mouse events (not handled by above) in the scroll area to prevent unfocusing\n    input.mouseDownEdge({ x: x0, y: y - border, w: outer_w, h: y1 - y + border });\n    // But a click should dismiss it (important on fullscreen touch UI!)\n    if (input.mouseUpEdge({ x: x0, y: y - border, w: outer_w, h: y1 - y + border,\n      in_event_cb: opts.pointerlock ? input.pointerLockEnter : null })\n    ) {\n      spotUnfocus();\n      is_focused = false;\n    }\n    // Also prevent mouseover from going to anything beneat it\n    input.mouseOver({ x: x0, y: y - border, w: outer_w, h: y1 - y + border });\n    // Also a mouse down anywhere outside of the chat UI should dismiss it\n    if (input.mouseDownEdge({ peek: true })) {\n      // On touch, tapping doesn't always remove focus from the edit box!\n      // Maybe this logic should be in the editbox logic?\n      spotUnfocus();\n      is_focused = false;\n    }\n  } else {\n    // Just recent entries, fade them out over time\n    let { max_lines } = this;\n    for (let ii = 0; ii < this.msgs.length; ++ii) {\n      let msg = this.msgs[this.msgs.length - ii - 1];\n      let age = now - msg.timestamp;\n      let alpha = 1 - clamp((age - this.fade_start_time[hide_light]) / this.fade_time[hide_light], 0, 1);\n      if (!alpha || msg.quiet) {\n        break;\n      }\n      let numlines = msg.numlines;\n      if (numlines > max_lines && ii) {\n        break;\n      }\n      max_lines -= numlines;\n      let h = font_height * numlines;\n      y -= h;\n      drawChatLine(msg, alpha);\n    }\n  }\n\n  if (opts.pointerlock && is_focused && input.pointerLocked()) {\n    // Gained focus undo pointerlock\n    input.pointerLockExit();\n  }\n\n  if (!anything_visible && (ui.modal_dialog || ui.menu_up || hide_light)) {\n    return;\n  }\n  ui.drawRect(x0, y - border, x0 + outer_w, y1, z, [0.3,0.3,0.3,0.75]);\n};\n\nChatUI.prototype.setChannel = function (channel) {\n  if (channel === this.channel) {\n    return;\n  }\n  if (this.channel) {\n    if (!channel) {\n      this.addChat(`Left channel ${this.channel.channel_id}`);\n    }\n    this.channel.removeMsgHandler('chat', this.on_chat);\n    this.channel.removeMsgHandler('join', this.on_join);\n    this.channel.removeMsgHandler('leave', this.on_leave);\n  }\n  this.channel = channel;\n  if (!this.channel) {\n    return;\n  }\n  // joining a new one, clear first\n  this.clearChat();\n  channel.onMsg('chat', this.on_chat);\n  channel.onMsg('join', this.on_join);\n  channel.onMsg('leave', this.on_leave);\n  let chat_history;\n  let here = [];\n  let here_map = {};\n  let friends = [];\n  asyncParallel([\n    (next) => {\n      channel.send('chat_get', null, (err, data) => {\n        if (!err && data && data.msgs && data.msgs.length) {\n          chat_history = data;\n        }\n        next();\n      });\n    },\n    (next) => {\n      channel.onceSubscribe((data) => {\n        let clients = data && data.public && data.public.clients;\n        if (clients) {\n          for (let client_id in clients) {\n            let client = clients[client_id];\n            let user_id = client.ids && client.ids.user_id;\n            let already_in_list = false;\n            if (user_id && client.ids.display_name) {\n              if (here_map[user_id]) {\n                already_in_list = true;\n              } else {\n                here_map[user_id] = client.ids.display_name;\n              }\n            }\n            if (client_id === netClientId() || already_in_list) {\n              continue;\n            }\n            if (client.ids) {\n              if (user_id && isFriend(user_id)) {\n                friends.push(client.ids.display_name || user_id || client_id);\n              } else {\n                here.push(client.ids.display_name || user_id || client_id);\n              }\n            }\n          }\n        }\n        next();\n      });\n    },\n  ], () => {\n    if (!this.channel) {\n      // disconnected/left already\n      return;\n    }\n    // First display chat history\n    if (chat_history) {\n      let messages_pre = this.msgs.slice(0);\n      if (messages_pre.length) {\n        this.msgs = [];\n      }\n      for (let ii = 0; ii < chat_history.msgs.length; ++ii) {\n        let idx = (chat_history.idx + ii) % chat_history.msgs.length;\n        let elem = chat_history.msgs[idx];\n        if (elem && elem.msg) {\n          elem.quiet = true;\n          if (here_map[elem.id]) {\n            elem.display_name = here_map[elem.id];\n          }\n          this.onMsgChat(elem);\n        }\n      }\n      if (messages_pre.length) {\n        // Sort the history so it is before any other messages received in the meantime\n        this.msgs = this.msgs.concat(messages_pre);\n      }\n    }\n\n    // Then join message\n    this.addChat(`Joined channel ${this.channel.channel_id}`, 'join_leave');\n    // Then who's here now\n    if (here.length || friends.length) {\n      let msg = [];\n      if (here.length) {\n        if (here.length > 10) {\n          msg.push(`Other users already here: ${here.slice(0, 10).join(', ')} (and ${here.length - 10} more...)`);\n        } else {\n          msg.push(`Other users already here: ${here.join(', ')}`);\n        }\n      }\n      if (friends.length) {\n        msg.push(`Friends already here: ${friends.join(', ')}`);\n      }\n      this.addChatFiltered({\n        msg: msg.join('\\n'),\n        style: 'join_leave',\n      });\n    }\n  });\n};\n\nexport function create(params) {\n  profanityStartup();\n  let chat_ui = new ChatUI(params);\n  function emote(str, resp_func) {\n    if (!str) {\n      return void resp_func(null, 'Usage: /me does something.');\n    }\n\n    if (params.emote_cb) {\n      params.emote_cb(str);\n    }\n\n    chat_ui.sendChat(FLAG_EMOTE, str);\n  }\n  cmd_parse.registerValue('volume_chat_joinleave', {\n    type: cmd_parse.TYPE_FLOAT,\n    label: 'Join/Leave chat message volume',\n    range: [0,1],\n    get: () => chat_ui.volume_join_leave,\n    set: (v) => (chat_ui.volume_join_leave = v),\n    store: true,\n  });\n  cmd_parse.registerValue('volume_chat_in', {\n    type: cmd_parse.TYPE_FLOAT,\n    label: 'Incoming chat message volume',\n    range: [0,1],\n    get: () => chat_ui.volume_in,\n    set: (v) => (chat_ui.volume_in = v),\n    store: true,\n  });\n  cmd_parse.registerValue('volume_chat_out', {\n    type: cmd_parse.TYPE_FLOAT,\n    label: 'Outgoing chat message volume',\n    range: [0,1],\n    get: () => chat_ui.volume_out,\n    set: (v) => (chat_ui.volume_out = v),\n    store: true,\n  });\n  cmd_parse.register({\n    cmd: 'me',\n    help: 'Emote',\n    usage: '$HELP\\n  Example: /me jumps up and down!',\n    func: emote,\n  });\n  // Also alias /em\n  cmd_parse.register({\n    access_show: ['hidden'],\n    cmd: 'em',\n    func: emote,\n  });\n  cmd_parse.register({\n    cmd: 'echo',\n    help: 'Echo text locally',\n    func: (str, resp_func) => {\n      chat_ui.addChatFiltered({ msg: str });\n      resp_func();\n    },\n  });\n  return chat_ui;\n}\n","import assert from 'assert';\nimport { Platform, isValidPlatform } from 'glov/common/enums';\n\n// Platform\nassert(isValidPlatform(window.conf_platform));\nexport const PLATFORM = window.conf_platform as Platform;\nexport const PLATFORM_WEB = PLATFORM === Platform.Web;\nexport const PLATFORM_FBINSTANT = PLATFORM === Platform.FBInstant;\nexport const PLATFORM_ANDROID = PLATFORM === Platform.Android;\nexport const PLATFORM_IOS = PLATFORM === Platform.IOS;\nexport const PLATFORM_MOBILE = PLATFORM_ANDROID || PLATFORM_IOS;\n\nassert(PLATFORM_WEB || PLATFORM_FBINSTANT || PLATFORM_ANDROID || PLATFORM_IOS);\n\n// Type\n// TODO: Allow other platforms to set MODE_DEVELOPMENT through a parameter\nexport const MODE_DEVELOPMENT = (PLATFORM_WEB || PLATFORM_FBINSTANT) &&\n  Boolean(String(document.location).match(/^https?:\\/\\/localhost/));\nexport const MODE_PRODUCTION = !MODE_DEVELOPMENT;\n\nif (MODE_DEVELOPMENT) {\n  assert(PLATFORM_WEB || !window.FB);\n  assert(PLATFORM_FBINSTANT || !window.FBInstant);\n  assert(PLATFORM_ANDROID === Boolean(window.androidwrapper));\n  assert(PLATFORM_IOS === Boolean(window.webkit?.messageHandlers?.iosWrapper));\n}\n\n// Abilities\nlet ability_reload = PLATFORM_WEB;\nexport function getAbilityReload(): boolean {\n  return ability_reload;\n}\nexport function setAbilityReload(value: boolean): void {\n  ability_reload = PLATFORM_WEB && value;\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/* eslint-disable import/order */\nconst cmd_parse_mod = require('glov/common/cmd_parse.js');\nconst local_storage = require('./local_storage.js');\nexport let cmd_parse = cmd_parse_mod.create({ storage: local_storage });\n\nconst engine = require('./engine.js');\nconst { errorReportDetailsString } = require('./error_report.js');\nconst net = require('./net.js');\nconst { netClient, netDisconnected } = net;\nconst textures = require('./textures.js');\nconst { netDelayGet, netDelaySet } = require('glov/common/wscommon.js');\n\nwindow.cmd = function (str) {\n  cmd_parse.handle(null, str, cmd_parse_mod.defaultHandler);\n};\n\nfunction byteFormat(bytes) {\n  if (bytes > 850000) {\n    return `${(bytes/(1024*1024)).toFixed(2)}MB`;\n  }\n  if (bytes > 850) {\n    return `${(bytes/1024).toFixed(2)}KB`;\n  }\n  return `${bytes}B`;\n}\n\ncmd_parse.register({\n  cmd: 'texmem',\n  help: 'Displays texture memory usage',\n  func: function (str, resp_func) {\n    let keys = Object.keys(textures.textures);\n    keys = keys.filter((a) => textures.textures[a].gpu_mem > 1024);\n    keys.sort((a, b) => textures.textures[a].gpu_mem - textures.textures[b].gpu_mem);\n    resp_func(null, keys.map((a) => `${byteFormat(textures.textures[a].gpu_mem)} ${a}`).join('\\n'));\n  }\n});\n\ncmd_parse.register({\n  cmd: 'gpumem',\n  help: 'Displays GPU memory usage summary',\n  func: function (str, resp_func) {\n    let { gpu_mem } = engine.perf_state;\n    resp_func(null, `${byteFormat(gpu_mem.geom)} Geo\\n${byteFormat(gpu_mem.tex)} Tex\\n${\n      byteFormat(gpu_mem.geom + gpu_mem.tex)} Total`);\n  }\n});\n\ncmd_parse.register({\n  cmd: 'd',\n  help: 'Toggles a debug define',\n  func: function (str, resp_func) {\n    str = str.toUpperCase().trim();\n    if (!str) {\n      let any_changed = false;\n      for (let key in engine.defines) {\n        engine.defines[key] = false;\n        any_changed = true;\n      }\n      if (any_changed) {\n        engine.definesChanged();\n        return void resp_func(null, 'All debug defines cleared');\n      } else {\n        return void resp_func(null, 'No debug defines active');\n      }\n    }\n    engine.defines[str] = !engine.defines[str];\n    resp_func(null, `D=${str} now ${engine.defines[str]?'SET':'unset'}`);\n    engine.definesChanged();\n  }\n});\n\ncmd_parse.register({\n  cmd: 'renderer',\n  help: 'Displays current renderer',\n  func: function (str, resp_func) {\n    resp_func(null, `Renderer=WebGL${engine.webgl2?2:1}`);\n  }\n});\n\ncmd_parse.register({\n  cmd: 'csr',\n  access_run: ['sysadmin'],\n  help: '(Admin) Run a command as another user',\n  usage: '$HELP\\n  /csr UserID command\\n' +\n    'Example: /csr jimbly gems -100',\n  func: function (str, resp_func) {\n    let idx = str.indexOf(' ');\n    if (idx === -1) {\n      return void resp_func('Invalid number of arguments');\n    }\n    let user_id = str.slice(0, idx);\n    let cmd = str.slice(idx + 1);\n    let pak = net.subs.getChannelImmediate(`user.${user_id}`).pak('csr_admin_to_user');\n    pak.writeJSON(cmd_parse.last_access);\n    pak.writeString(cmd);\n    pak.send(resp_func);\n  }\n});\n\nfunction cmdDesc(cmd_data) {\n  return `/${cmd_data.cmd} - ${cmd_data.help}`;\n}\n\ncmd_parse.register({\n  cmd: 'help',\n  help: 'Searches commands',\n  func: function (str, resp_func) {\n    let list = cmd_parse.autoComplete('', this && this.access);\n    if (str) {\n      let str_cname = cmd_parse.canonical(str);\n      let str_lc = str.toLowerCase();\n      list = list.filter((cmd_data) => cmd_data.cname.indexOf(str_cname) !== -1 ||\n          cmd_data.help.toLowerCase().indexOf(str_lc) !== -1);\n    }\n    if (!list.length) {\n      return void resp_func(null, `No commands found matching \"${str}\"`);\n    }\n    resp_func(null, list.map(cmdDesc).join('\\n'));\n  }\n});\n\nexport let safearea = [-1,-1,-1,-1];\ncmd_parse.registerValue('safe_area', {\n  label: 'Safe Area',\n  type: cmd_parse.TYPE_STRING,\n  usage: 'Safe Area value: Use -1 for auto based on browser environment,\\n' +\n    'or 0-25 for percentage of screen size\\n' +\n    '  Usage: /safe_area [value]\\n' +\n    '  Usage: /safe_area horizontal,vertical\\n' +\n    '  Usage: /safe_area left,right,top,bottom',\n  default_value: '-1',\n  get: () => (safearea[0] === -1 ? '-1 (auto)' : safearea.join(',')),\n  set: (v) => {\n    v = String(v);\n    let keys = v.split(',');\n    if (v && keys.length === 1) {\n      safearea[0] = safearea[1] = safearea[2] = safearea[3] = Number(v);\n    } else if (keys.length === 2) {\n      safearea[0] = safearea[1] = Number(keys[0]);\n      safearea[2] = safearea[3] = Number(keys[1]);\n    } else if (keys.length === 4) {\n      for (let ii = 0; ii < 4; ++ii) {\n        safearea[ii] = Number(keys[ii]);\n      }\n    } else {\n      // error, ignore?\n    }\n    for (let ii = 0; ii < 4; ++ii) {\n      if (!isFinite(safearea[ii])) {\n        safearea[ii] = -1;\n      }\n    }\n  },\n  store: true,\n});\n\ncmd_parse.register({\n  cmd: 'webgl2_auto',\n  help: 'Resets WebGL2 auto-detection',\n  func: function (str, resp_func) {\n    let disable_data = local_storage.getJSON('webgl2_disable');\n    if (!disable_data) {\n      return resp_func(null, 'WebGL2 is already being auto-detected');\n    }\n    local_storage.setJSON('webgl2_disable', undefined);\n    return resp_func(null, 'WebGL2 was disabled, will attempt to use it again on the next load');\n  },\n});\n\ncmd_parse.registerValue('postprocessing', {\n  label: 'Postprocessing',\n  type: cmd_parse.TYPE_INT,\n  help: 'Enables/disables postprocessing',\n  get: () => (engine.postprocessing ? 1 : 0),\n  set: (v) => engine.postprocessingAllow(v),\n});\n\ncmd_parse.register({\n  cmd: 'net_delay',\n  help: 'Sets/shows network delay values',\n  usage: '$HELP\\n/net_delay time_base time_rand',\n  func: function (str, resp_func) {\n    if (str) {\n      let params = str.split(' ');\n      netDelaySet(Number(params[0]), Number(params[1]) || 0);\n    }\n    let cur = netDelayGet();\n    resp_func(null, `Client NetDelay: ${cur[0]}+${cur[1]}`);\n  }\n});\n\ncmd_parse.register({\n  cmd: 'error_report_details',\n  help: 'Shows details submitted with any error report',\n  access_show: ['hidden'],\n  func: function (str, resp_func) {\n    resp_func(null, errorReportDetailsString());\n  },\n});\n\ncmd_parse.register({\n  cmd: 'disconnect',\n  help: 'Forcibly disconnect WebSocket connection (Note: will auto-reconnect)',\n  func: function (str, resp_func) {\n    let socket = netClient()?.socket;\n    if (!socket) {\n      return void resp_func('No socket');\n    }\n    if (netDisconnected()) {\n      return void resp_func('Not connected');\n    }\n    socket.close();\n    resp_func();\n  },\n});\n","// Portions Copyright 2021 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/* eslint-disable import/order */\nconst camera2d = require('./camera2d.js');\nconst { hsvToRGB, rgbToHSV } = require('./hsv.js');\nconst input = require('./input.js');\nconst { min } = Math;\nconst ui = require('./ui.js');\nconst { LINE_CAP_SQUARE } = ui;\nconst { clipped, clipPause, clipResume, createSprite } = require('./sprites.js');\nconst textures = require('./textures.js');\nconst { clamp } = require('glov/common/util.js');\nconst { vec3, v3copy, vec4 } = require('glov/common/vmath.js');\n\nlet color_black = vec4(0,0,0,1);\n\nfunction colorPickerOpen(state) {\n  state.open = true;\n  if (!state.color_hs) {\n    state.color_hs = vec4(0,0,0,1);\n    state.color_v = vec4(0,0,0,1);\n    state.hsv = vec3();\n  }\n\n  rgbToHSV(state.hsv, state.rgba);\n}\n\nfunction colorPickerAlloc(param) {\n  let state ={\n    open: false,\n    rgba: vec4(0,0,0,1),\n  };\n  v3copy(state.rgba, param.color);\n  return state;\n}\n\nlet picker_sprite_hue_sat;\nlet picker_sprite_val;\nfunction initTextures() {\n  const HS_SIZE = 32;\n  let data = new Uint8Array(HS_SIZE * HS_SIZE * 3);\n  let rgb = vec3();\n  let idx = 0;\n  for (let j = 0; j < HS_SIZE; j++) {\n    let sat = 1 - j / (HS_SIZE - 1);\n    for (let i = 0; i < HS_SIZE; i++) {\n      let hue = i * 360 / (HS_SIZE - 1);\n      hsvToRGB(rgb, hue, sat, 1);\n      data[idx++] = rgb[0] * 255;\n      data[idx++] = rgb[1] * 255;\n      data[idx++] = rgb[2] * 255;\n    }\n  }\n  picker_sprite_hue_sat = createSprite({\n    url: 'cpicker_hs',\n    width: HS_SIZE, height: HS_SIZE,\n    format: textures.format.RGB8,\n    data,\n    filter_min: gl.LINEAR,\n    filter_mag: gl.LINEAR,\n    wrap_s: gl.CLAMP_TO_EDGE,\n    wrap_t: gl.CLAMP_TO_EDGE,\n  });\n\n  data = new Uint8Array(32);\n  for (let ii = 0; ii < data.length; ++ii) {\n    data[ii] = 255 - ii * 255 / (data.length - 1);\n  }\n  picker_sprite_val = createSprite({\n    url: 'cpicker_v',\n    width: 1, height: data.length,\n    format: textures.format.R8,\n    data,\n    filter_min: gl.LINEAR,\n    filter_mag: gl.LINEAR,\n    wrap_s: gl.CLAMP_TO_EDGE,\n    wrap_t: gl.CLAMP_TO_EDGE,\n  });\n}\n\nexport function colorPicker(param) {\n  let state = ui.getUIElemData('colorpicker', param, colorPickerAlloc);\n  let icon_h = param.icon_h || ui.button_height;\n  let icon_w = param.icon_w || icon_h;\n  let picker_h = param.picker_h || ui.button_height * 4;\n  let pad = param.pad || 3;\n  let { x, y, z } = param;\n\n  if (!state.open) {\n    v3copy(state.rgba, param.color);\n  }\n\n  if (ui.buttonImage({\n    x, y, z,\n    w: icon_w, h: icon_h,\n    img: ui.sprites.white,\n    color: state.rgba,\n  })) {\n    if (!state.open) {\n      colorPickerOpen(state);\n    } else {\n      state.open = false;\n    }\n  }\n  let handled = ui.button_mouseover;\n\n  if (state.open) {\n    let clip_pause = clipped();\n    if (clip_pause) {\n      clipPause();\n    }\n\n    if (!picker_sprite_hue_sat) {\n      initTextures();\n    }\n\n    y = min(y, camera2d.y1() - picker_h);\n    z+=2;\n    x += icon_w + pad;\n    let x0 = x;\n    let y0 = y;\n\n    let { hsv } = state;\n    let hue_sat_w = picker_h;\n    let val_w = picker_h * 0.1;\n    hsvToRGB(state.color_v, 0, 0, hsv[2]);\n    let hue_sat_param = {\n      x, y, z,\n      w: hue_sat_w, h: picker_h,\n      color: state.color_v,\n      max_dist: Infinity,\n    };\n    picker_sprite_hue_sat.draw(hue_sat_param);\n    let drag = input.drag(hue_sat_param) || input.click(hue_sat_param);\n    if (drag) {\n      handled = true;\n      let pos = drag.cur_pos || drag.pos;\n      hsv[0] = clamp((pos[0] - x) / hue_sat_param.w * 360, 0, 360);\n      hsv[1] = clamp(1 - (pos[1] - y) / hue_sat_param.h, 0, 1);\n    }\n    let hs_x = x + hsv[0]*hue_sat_w/360;\n    let hs_y = y + (1-hsv[1])*picker_h;\n    ui.drawLine(hs_x - pad, hs_y, hs_x + pad, hs_y, z + 1, 1, 1, color_black, LINE_CAP_SQUARE);\n    ui.drawLine(hs_x, hs_y - pad, hs_x, hs_y + pad, z + 1, 1, 1, color_black, LINE_CAP_SQUARE);\n    x += hue_sat_w + pad;\n\n    hsvToRGB(state.color_hs, hsv[0], hsv[1], 1);\n    let val_param = {\n      x, y, z,\n      w: val_w, h: picker_h,\n      color: state.color_hs,\n      max_dist: Infinity,\n    };\n    picker_sprite_val.draw(val_param);\n    drag = input.drag(val_param) || input.click(val_param);\n    if (drag) {\n      handled = true;\n      let pos = drag.cur_pos || drag.pos;\n      hsv[2] = clamp(1 - (pos[1] - y) / val_param.h, 0, 1);\n    }\n    let v_y = y + (1-hsv[2])*picker_h;\n    ui.drawLine(x, v_y, x + val_w, v_y, z + 1, 1, 1, color_black, LINE_CAP_SQUARE);\n    x += val_w;\n\n    hsvToRGB(state.rgba, state.hsv[0], state.hsv[1], state.hsv[2]);\n\n    // eat mouseover/clicks/drags\n    let panel_param = { x: x0 - pad, y: y0 - pad, w: x - x0 + pad * 2, h: picker_h + pad * 2, z: z-1 };\n    if (input.mouseOver(panel_param)) {\n      handled = true;\n    }\n    input.drag(panel_param);\n    ui.panel(panel_param);\n\n    if (clip_pause) {\n      clipResume();\n    }\n\n    if (input.click({ peek: true }) || !handled && input.mouseDown({ peek: true })) {\n      state.open = false;\n    }\n  }\n\n  v3copy(param.color, state.rgba);\n\n  // return state; Maybe useful for getting at HSV, open, etc?\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nexports.create = editBoxCreate; // eslint-disable-line no-use-before-define\n\nconst assert = require('assert');\nconst camera2d = require('./camera2d.js');\nconst engine = require('./engine.js');\nconst {\n  KEYS,\n  eatAllKeyboardInput,\n  mouseConsumeClicks,\n  keyUpEdge,\n  pointerLockEnter,\n  pointerLockExit,\n  pointerLocked,\n  inputClick,\n} = require('./input.js');\nconst {\n  SPOT_NAV_LEFT,\n  SPOT_NAV_RIGHT,\n  spotFocusCheck,\n  spotFocusSteal,\n  spotUnfocus,\n  spotlog,\n} = require('./spot.js');\nconst glov_ui = require('./ui.js');\nconst { uiGetDOMElem } = require('./ui.js');\n\nlet form_hook_registered = false;\nlet active_edit_box;\nlet active_edit_box_frame;\n\nlet this_frame_edit_boxes = [];\nlet last_frame_edit_boxes = [];\n\nexport function editBoxTick() {\n  let expected_last_frame = engine.frame_index - 1;\n  for (let ii = 0; ii < last_frame_edit_boxes.length; ++ii) {\n    let edit_box = last_frame_edit_boxes[ii];\n    if (edit_box.last_frame < expected_last_frame) {\n      edit_box.unrun();\n    }\n  }\n  last_frame_edit_boxes = this_frame_edit_boxes;\n  this_frame_edit_boxes = [];\n}\n\nfunction setActive(edit_box) {\n  active_edit_box = edit_box;\n  active_edit_box_frame = engine.frame_index;\n}\n\nfunction formHook(ev) {\n  ev.preventDefault();\n\n  if (!active_edit_box || active_edit_box_frame < engine.frame_index - 1) {\n    return;\n  }\n  active_edit_box.submitted = true;\n  active_edit_box.updateText();\n  if (active_edit_box.pointer_lock && !active_edit_box.text) {\n    pointerLockEnter('edit_box_submit');\n  }\n}\n\nlet last_key_id = 0;\n\nclass GlovUIEditBox {\n  constructor(params) {\n    this.key = `eb${++last_key_id}`;\n    this.x = 0;\n    this.y = 0;\n    this.z = Z.UI; // actually in DOM, so above everything!\n    this.w = glov_ui.button_width;\n    this.type = 'text';\n    // this.h = glov_ui.button_height;\n    this.font_height = glov_ui.font_height;\n    this.text = '';\n    this.placeholder = '';\n    this.max_len = 0;\n    this.zindex = null;\n    this.uppercase = false;\n    this.initial_focus = false;\n    this.onetime_focus = false;\n    this.auto_unfocus = false;\n    this.initial_select = false;\n    this.spellcheck = true;\n    this.esc_clears = true;\n    this.multiline = 0;\n    this.autocomplete = false;\n    this.custom_nav = {\n      // We want left/right to be handled by the input element, not used to change focus.\n      [SPOT_NAV_LEFT]: null,\n      [SPOT_NAV_RIGHT]: null,\n    };\n    this.sticky_focus = true;\n    this.applyParams(params);\n    assert.equal(typeof this.text, 'string');\n\n    this.last_autocomplete = null;\n    this.is_focused = false;\n    this.elem = null;\n    this.input = null;\n    this.submitted = false;\n    this.pointer_lock = false;\n    this.last_frame = 0;\n    this.out = {}; // Used by spotFocusCheck\n  }\n  applyParams(params) {\n    if (!params) {\n      return;\n    }\n    for (let f in params) {\n      this[f] = params[f];\n    }\n    if (this.text === undefined) {\n      // do not trigger assert if `params` has a `text: undefined` member\n      this.text = '';\n    }\n    this.h = this.font_height;\n  }\n  updateText() {\n    this.text = this.input.value;\n    if (this.max_len > 0) {\n      this.text = this.text.slice(0, this.max_len);\n    }\n  }\n  getText() {\n    return this.text;\n  }\n  setText(new_text) {\n    new_text = String(new_text);\n    if (this.input) {\n      this.input.value = new_text;\n    }\n    this.text = new_text;\n  }\n  focus() {\n    if (this.input) {\n      this.input.focus();\n      setActive(this);\n    } else {\n      this.onetime_focus = true;\n    }\n    spotFocusSteal(this);\n    this.is_focused = true;\n    if (this.pointer_lock && pointerLocked()) {\n      pointerLockExit();\n    }\n  }\n  unfocus() {\n    spotUnfocus();\n  }\n  isFocused() { // call after .run()\n    return this.is_focused;\n  }\n\n  updateFocus() {\n    let was_glov_focused = this.is_focused;\n    let spot_ret = spotFocusCheck(this);\n    let { focused } = spot_ret;\n    let dom_focused = this.input && document.activeElement === this.input;\n    if (was_glov_focused !== focused) {\n      // something external (from clicks/keys in GLOV) changed, apply it if it doesn't match\n      if (focused && !dom_focused && this.input) {\n        spotlog('GLOV focused, DOM not, focusing', this);\n        this.input.focus();\n      }\n      if (!focused && dom_focused) {\n        spotlog('DOM focused, GLOV not, and changed, blurring', this);\n        this.input.blur();\n      }\n    } else if (dom_focused && !focused) {\n      spotlog('DOM focused, GLOV not, stealing', this);\n      spotFocusSteal(this);\n      focused = true;\n    } else if (!dom_focused && focused) {\n      // Leave it alone, it may be a browser pop-up such as for passwords\n    }\n\n    if (focused) {\n      setActive(this);\n      let key_opt = (this.pointer_lock && !this.text) ? { in_event_cb: pointerLockEnter } : null;\n      if (keyUpEdge(KEYS.ESC, key_opt)) {\n        if (this.text && this.esc_clears) {\n          this.setText('');\n        } else {\n          spotUnfocus();\n          if (this.input) {\n            this.input.blur();\n          }\n          focused = false;\n          this.canceled = true;\n        }\n      }\n    }\n    this.is_focused = focused;\n    return spot_ret;\n  }\n\n  run(params) {\n    this.applyParams(params);\n\n    if (this.last_frame !== engine.frame_index - 1) {\n      // it's been more than a frame, we must have not been running, discard async events\n      this.submitted = false;\n    }\n    this.last_frame = engine.frame_index;\n\n    this.canceled = false;\n    let { allow_focus, focused } = this.updateFocus();\n\n    this_frame_edit_boxes.push(this);\n    let elem = allow_focus && uiGetDOMElem(this.elem, true);\n    if (elem !== this.elem) {\n      if (elem) {\n        // new DOM element, initialize\n        if (!form_hook_registered) {\n          form_hook_registered = true;\n          let form = document.getElementById('dynform');\n          if (form) {\n            form.addEventListener('submit', formHook, true);\n          }\n        }\n        elem.textContent = '';\n        let input = document.createElement(this.multiline ? 'textarea' : 'input');\n        input.setAttribute('type', this.type);\n        input.setAttribute('placeholder', this.placeholder);\n        if (this.max_len) {\n          input.setAttribute('maxLength', this.max_len);\n        }\n        if (this.multiline) {\n          input.setAttribute('rows', this.multiline);\n        }\n        input.setAttribute('tabindex', 2);\n        elem.appendChild(input);\n        let span = document.createElement('span');\n        span.setAttribute('tabindex', 3);\n        elem.appendChild(span);\n        input.value = this.text;\n        if (this.uppercase) {\n          input.style['text-transform'] = 'uppercase';\n        }\n        this.input = input;\n        if (this.initial_focus || this.onetime_focus) {\n          input.focus();\n          setActive(this);\n          this.onetime_focus = false;\n        }\n        if (this.initial_select) {\n          input.select();\n        }\n      } else {\n        this.input = null;\n      }\n      this.submitted = false;\n      this.elem = elem;\n    } else {\n      if (this.input) {\n        this.updateText();\n      }\n    }\n    if (elem) {\n      let pos = camera2d.htmlPos(this.x, this.y);\n      if (!this.spellcheck) {\n        elem.spellcheck = false;\n      }\n      elem.style.left = `${pos[0]}%`;\n      elem.style.top = `${pos[1]}%`;\n      let size = camera2d.htmlSize(this.w, 0);\n      elem.style.width = `${size[0]}%`;\n      let old_fontsize = elem.style.fontSize || '?px';\n      let new_fontsize = `${camera2d.virtualToFontSize(this.font_height).toFixed(0)}px`;\n      if (new_fontsize !== old_fontsize) {\n        elem.style.fontSize = new_fontsize;\n      }\n      if (this.zindex) {\n        elem.style['z-index'] = this.zindex;\n      }\n      if (this.last_autocomplete !== this.autocomplete) {\n        this.last_autocomplete = this.autocomplete;\n        this.input.setAttribute('autocomplete', this.autocomplete || `auto_off_${Math.random()}`);\n      }\n    }\n\n    if (focused) {\n      if (this.auto_unfocus) {\n        if (inputClick({ peek: true })) {\n          spotUnfocus();\n        }\n      }\n      // keyboard input is handled by the INPUT element, but allow mouse events to trickle\n      eatAllKeyboardInput();\n    }\n    // Eat mouse events going to the edit box\n    mouseConsumeClicks({ x: this.x, y: this.y, w: this.w, h: this.h });\n\n    if (this.submitted) {\n      this.submitted = false;\n      return this.SUBMIT;\n    }\n    if (this.canceled) {\n      this.canceled = false;\n      return this.CANCEL;\n    }\n    return null;\n  }\n  unrun() {\n    // remove from DOM or hide\n    this.elem = null;\n    this.input = null;\n  }\n}\nGlovUIEditBox.prototype.SUBMIT = 'submit';\nGlovUIEditBox.prototype.CANCEL = 'cancel';\n\nexport function editBoxCreate(params) {\n  return new GlovUIEditBox(params);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n// Some code from Turbulenz: Copyright (c) 2012-2013 Turbulenz Limited\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst engine = require('./engine.js');\nconst { renderWidth, renderHeight } = engine;\nconst { framebufferEnd, framebufferStart, framebufferTopOfFrame } = require('./framebuffer.js');\nconst geom = require('./geom.js');\nconst shaders = require('./shaders.js');\nconst sprites = require('./sprites.js');\nconst textures = require('./textures.js');\nconst { vec2, vec3, vec4, v4set } = require('glov/common/vmath.js');\n\nconst shader_data = {\n  vp_copy: {\n    vp: 'shaders/effects_copy.vp',\n  },\n  copy: {\n    fp: 'shaders/effects_copy.fp',\n  },\n  pixely_expand: {\n    fp: 'shaders/pixely_expand.fp',\n  },\n  gaussian_blur: {\n    fp: 'shaders/effects_gaussian_blur.fp',\n  },\n  // bloom_merge: {\n  //   fp: 'shaders/effects_bloom_merge.fp',\n  // },\n  // bloom_threshold: {\n  //   fp: 'shaders/effects_bloom_threshold.fp',\n  // },\n  color_matrix: {\n    fp: 'shaders/effects_color_matrix.fp',\n  },\n  // distort: {\n  //   fp: 'shaders/effects_distort.fp',\n  // },\n};\n\nexport function registerShader(key, obj) {\n  shader_data[key] = obj;\n}\n\nfunction getShader(key) {\n  let elem = shader_data[key];\n  if (!elem.shader) {\n    if (elem.fp) {\n      elem.shader = shaders.create(elem.fp);\n    } else {\n      elem.shader = shaders.create(elem.vp);\n    }\n  }\n  return elem.shader;\n}\n\n\nlet inited = false;\nlet clip_space = vec4(2, 2, -1, -1);\nlet copy_uv_scale = vec2(1, 1);\nlet shader_params_default = {\n  clip_space,\n  copy_uv_scale,\n};\n// let shader_params_distort;\nlet shader_params_color_matrix;\n// let shader_params_bloom;\n// let shader_params_bloom_merge;\nlet shader_params_gaussian_blur;\nlet shader_params_pixely_expand;\nlet quad_geom;\nfunction startup() {\n  inited = true;\n\n  quad_geom = geom.create(\n    [[shaders.semantic.POSITION, gl.FLOAT, 2, false]],\n    new Float32Array([\n      0, 0,\n      1, 0,\n      1, 1,\n      0, 1,\n    ]), null, geom.QUADS); // TODO: use gl.TRIANGLE_STRIP instead, save index buffer binding\n\n  // shader_params_distort = {\n  //   clip_space,\n  //   copy_uv_scale,\n  //   strength: vec2(0, 0),\n  //   transform: new Float32Array([0, 0, 0, 0, 0, 0]),\n  //   invTransform: vec4(0, 0, 0, 0),\n  // };\n\n  shader_params_color_matrix = {\n    clip_space,\n    copy_uv_scale,\n    colorMatrix: new Float32Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]),\n  };\n\n  // shader_params_bloom = {\n  //   clip_space,\n  //   copy_uv_scale,\n  //   bloomThreshold: 0,\n  //   thresholdCuttoff: 0,\n  // };\n\n  // shader_params_bloom_merge = {\n  //   clip_space,\n  //   copy_uv_scale,\n  //   bloomIntensity: 0,\n  //   bloomSaturation: 0,\n  //   originalIntensity: 0,\n  //   originalSaturation: 0,\n  // };\n\n  // Gaussian Blur effect (also used by bloom)\n  shader_params_gaussian_blur = {\n    clip_space,\n    copy_uv_scale,\n    sampleRadius: vec3(1, 1, 1),\n    Gauss: new Float32Array([0.93, 0.8, 0.7, 0.6, 0.5, 0.4, 0.3, 0.2, 0.1]),\n  };\n\n  shader_params_pixely_expand = {\n    clip_space,\n    copy_uv_scale,\n    orig_pixel_size: vec4(),\n  };\n}\n\nlet num_passes = 0;\nexport function effectsPassAdd() {\n  ++num_passes;\n}\nexport function effectsPassConsume() {\n  assert(num_passes);\n  --num_passes;\n}\n\nfunction doEffect(fn) {\n  effectsPassConsume();\n  fn();\n}\n\nexport function effectsQueue(z, fn) {\n  effectsPassAdd();\n  sprites.queuefn(z, doEffect.bind(null, fn));\n}\n\nexport function effectsTopOfFrame() {\n  // In case of crash on previous frame\n  num_passes = 0;\n  framebufferTopOfFrame();\n}\n\nexport function effectsReset() {\n  assert.equal(num_passes, 0); // otherwise probably still have a framebuffer bound\n}\n\nexport function effectsIsFinal() {\n  return !num_passes;\n}\n\nexport function grayScaleMatrix(dst) {\n  dst[0] = 0.2126;\n  dst[1] = 0.2126;\n  dst[2] = 0.2126;\n  dst[3] = 0.7152;\n  dst[4] = 0.7152;\n  dst[5] = 0.7152;\n  dst[6] = 0.0722;\n  dst[7] = 0.0722;\n  dst[8] = 0.0722;\n  dst[9] = dst[10] = dst[11] = 0;\n}\n\nexport function sepiaMatrix(dst) {\n  dst[0] = 0.393;\n  dst[1] = 0.349;\n  dst[2] = 0.272;\n  dst[3] = 0.769;\n  dst[4] = 0.686;\n  dst[5] = 0.534;\n  dst[6] = 0.189;\n  dst[7] = 0.168;\n  dst[8] = 0.131;\n  dst[9] = dst[10] = dst[11] = 0;\n}\n\nexport function negativeMatrix(dst) {\n  dst[0] = dst[4] = dst[8] = -1;\n  dst[1] = dst[2] = dst[3] = dst[5] = dst[6] = dst[7] = 0;\n  dst[9] = dst[10] = dst[11] = 1;\n}\n\nexport function saturationMatrix(dst, saturationScale) {\n  let is = (1 - saturationScale);\n  dst[0] = (is * 0.2126) + saturationScale;\n  dst[1] = (is * 0.2126);\n  dst[2] = (is * 0.2126);\n  dst[3] = (is * 0.7152);\n  dst[4] = (is * 0.7152) + saturationScale;\n  dst[5] = (is * 0.7152);\n  dst[6] = (is * 0.0722);\n  dst[7] = (is * 0.0722);\n  dst[8] = (is * 0.0722) + saturationScale;\n  dst[9] = dst[10] = dst[11] = 0;\n}\n\nexport function hueMatrix(dst, angle) {\n  ////\n  //// Uncomment to calculate new coeffecients should luminance\n  //// values 0.2126 0.7152 0.0722 change.\n  //let lumR = 0.2126;\n  //let lumG = 0.7152;\n  //let lumB = 0.0722;\n  ////\n  //let r23 = Math.sqrt(2 / 3);\n  //let r12 = 1 / Math.sqrt(2);\n  //let r13 = 1 / Math.sqrt(3);\n  //let r16 = 1 / Math.sqrt(6);\n  //let M = [r23, 0, r13, -r16, r12, r13, -r16, -r12, r13, 0, 0, 0];\n  //let zx = (r23 * lumR) - (r16 * lumG) - (r16 * lumB);\n  //let zy =                (r12 * lumG) - (r12 * lumB);\n  //let zz = (r13 * lumR) + (r13 * lumG) + (r13 * lumB);\n  //let x = zx / zz;\n  //let y = zy / zz;\n  //let C = [1, 0, x, 0, 1, y, 0, 0, 1, 0, 0, 0];\n  //m43mul(M, M, C);\n  //console.log(\"Pre transform = \", M);\n  //let E = [1, 0, -x, 0, 1, -y, 0, 0, 1, 0, 0, 0];\n  //let N = [r23, -r16, -r16, 0, r12, -r12, r13, r13, r13, 0, 0, 0];\n  //m43mul(N, E, N);\n  //console.log(\"Post transform = \", N);\n  ////\n  //// Final matrix is then: m43Mul(Pre, [c, s, 0, -s, c, 0, 0, 0, 1, 0, 0, 0, ], Post);\n  //// for c = cos(angle), s = sin(angle)\n  ////\n  //let out = \"\";\n  //out += \"let c = Math.cos(angle);\\n\";\n  //out += \"let s = Math.sin(angle);\\n\";\n  //out += \"dst[0] = (\" + (N[0]*M[0]+N[3]*M[1]) + \" * c) + (\" + (N[3]*M[0]-N[0]*M[1]) + \" * s) + \" + lumR+\";\\n\";\n  //out += \"dst[1] = (\" + (-lumR)               + \" * c) + (\" + (N[4]*M[0]-N[1]*M[1]) + \" * s) + \" + lumR+\";\\n\";\n  //out += \"dst[2] = (\" + (-lumR)               + \" * c) + (\" + (N[5]*M[0]-N[2]*M[1]) + \" * s) + \" + lumR+\";\\n\";\n  //out += \"dst[3] = (\" + (-lumG)               + \" * c) + (\" + (N[3]*M[3]-N[0]*M[4]) + \" * s) + \" + lumG+\";\\n\";\n  //out += \"dst[4] = (\" + (N[1]*M[3]+N[4]*M[4]) + \" * c) + (\" + (N[4]*M[3]-N[1]*M[4]) + \" * s) + \" + lumG+\";\\n\";\n  //out += \"dst[5] = (\" + (-lumG)               + \" * c) + (\" + (N[5]*M[3]-N[2]*M[4]) + \" * s) + \" + lumG+\";\\n\";\n  //out += \"dst[6] = (\" + (-lumB)               + \" * c) + (\" + (N[3]*M[6]-N[0]*M[7]) + \" * s) + \" + lumB+\";\\n\";\n  //out += \"dst[7] = (\" + (-lumB)               + \" * c) + (\" + (N[4]*M[6]-N[1]*M[7]) + \" * s) + \" + lumB+\";\\n\";\n  //out += \"dst[8] = (\" + (N[2]*M[6]+N[5]*M[7]) + \" * c) + (\" + (N[5]*M[6]-N[2]*M[7]) + \" * s) + \" + lumB+\";\\n\";\n  //console.log(out);\n  let c = Math.cos(angle);\n  let s = Math.sin(angle);\n  dst[0] = (0.7874 * c) + (-0.3712362230889293 * s) + 0.2126;\n  dst[1] = (-0.2126 * c) + (0.20611404610069642 * s) + 0.2126;\n  dst[2] = (-0.2126 * c) + (-0.9485864922785551 * s) + 0.2126;\n  dst[3] = (-0.7152 * c) + (-0.4962902913954023 * s) + 0.7152;\n  dst[4] = (0.2848 * c) + (0.08105997779422341 * s) + 0.7152;\n  dst[5] = (-0.7152 * c) + (0.6584102469838492 * s) + 0.7152;\n  dst[6] = (-0.0722 * c) + (0.8675265144843316 * s) + 0.0722;\n  dst[7] = (-0.0722 * c) + (-0.28717402389491986 * s) + 0.0722;\n  dst[8] = (0.9278 * c) + (0.290176245294706 * s) + 0.0722;\n  dst[9] = dst[10] = dst[11] = 0;\n}\n\nexport function brightnessAddMatrix(dst, brightnessOffset) {\n  dst[0] = dst[4] = dst[8] = 1;\n  dst[1] = dst[2] = dst[3] = dst[5] = dst[6] = dst[7] = 0;\n  dst[9] = dst[10] = dst[11] = brightnessOffset;\n}\n\nexport function brightnessScaleMatrix(dst, scale) {\n  dst[0] = dst[4] = dst[8] = scale;\n  dst[1] = dst[2] = dst[3] = dst[5] = dst[6] = dst[7] = 0;\n  dst[9] = dst[10] = dst[11] = 0;\n}\n\nexport function additiveMatrix(dst, additiveRGB) {\n  dst[0] = dst[4] = dst[8] = 1;\n  dst[1] = dst[2] = dst[3] = dst[5] = dst[6] = dst[7] = 0;\n  dst[9] = additiveRGB[0];\n  dst[10] = additiveRGB[1];\n  dst[11] = additiveRGB[2];\n}\n\nexport function contrastMatrix(dst, contrastScale) {\n  dst[0] = dst[4] = dst[8] = contrastScale;\n  dst[1] = dst[2] = dst[3] = dst[5] = dst[6] = dst[7] = 0;\n  dst[9] = dst[10] = dst[11] = 0.5 * (1 - contrastScale);\n}\n\n// effect: { shader, params, texs, final }\nfunction applyEffect(effect, view_w, view_h) {\n  let final = effect.final !== false && effectsIsFinal() || effect.final;\n  if (effect.no_framebuffer) {\n    // neither starting nor ending a framebuffer, presumably something effectively additive\n    let viewport = engine.viewport;\n    let target_w = viewport[2];\n    let target_h = viewport[3];\n    view_w = view_w || target_w;\n    view_h = view_h || target_h;\n    clip_space[0] = 2.0 * view_w / target_w;\n    clip_space[1] = 2.0 * view_h / target_h;\n  } else if (effect.viewport) {\n    let { viewport } = effect;\n    let target_w = viewport[2];\n    let target_h = viewport[3];\n    view_w = view_w || target_w;\n    view_h = view_h || target_h;\n\n    clip_space[0] = 2.0 * view_w / target_w;\n    clip_space[1] = 2.0 * view_h / target_h;\n\n    framebufferStart({\n      clear: effect.clear,\n      clear_all: effect.clear_all,\n      clear_color: effect.clear_color,\n      viewport,\n      final,\n    });\n  } else {\n    clip_space[0] = 2.0;\n    clip_space[1] = 2.0;\n    view_w = view_w || renderWidth();\n    view_h = view_h || renderHeight();\n\n    framebufferStart({\n      width: view_w, height: view_h,\n      final,\n    });\n  }\n  // clip_space[2] = -1.0;\n  // clip_space[3] = -1.0;\n  // copy_uv_scale[0] = target_w / effect.coord_source.width;\n  // copy_uv_scale[1] = target_h / effect.coord_source.height;\n\n  shaders.bind(getShader('vp_copy'), getShader(effect.shader), effect.params);\n  textures.bindArray(effect.texs);\n  quad_geom.draw();\n}\n\n// // TODO: Update for RTBBCTT and port to new GLOV.js\n// function applyBloomTODO(params) {\n//   let source = params.source;\n//   let blur1 = params.blurTarget1;\n//   let blur2 = params.blurTarget2;\n//   let dest = params.destination;\n//   if (!source || !dest || !blur1 || !blur2 || !blur1.colorTexture0 ||\n//     !blur2.colorTexture0 || blur1 === blur2 || blur1 === dest ||\n//     source === blur1.colorTexture0 || source === dest.colorTexture0) {\n//     return false;\n//   }\n//\n//   let effectParams = this.effectParams;\n//   let techparams;\n//\n//   // Threshold copy.\n//   techparams = this.bloomThresholdParameters;\n//   effectParams.technique = this.bloomThresholdTechnique;\n//   effectParams.params = techparams;\n//\n//   techparams.bloomThreshold = (params.bloomThreshold !== undefined) ? params.bloomThreshold : 0.65;\n//   techparams.thresholdCutoff = Math.exp((params.thresholdCutoff !== undefined) ? params.thresholdCutoff : 3);\n//   techparams.inputTexture0 = source;\n//   effectParams.destination = blur1;\n//   this.applyEffect(effectParams);\n//\n//   // Gaussian blur.\n//   techparams = this.gaussianBlurParameters;\n//   effectParams.technique = this.gaussianBlurTechnique;\n//   effectParams.params = techparams;\n//\n//   let sampleRadius = (params.blurRadius || 20);\n//   techparams.sampleRadius[0] = sampleRadius / source.width;\n//   techparams.sampleRadius[1] = 0;\n//   techparams.sampleRadius[2] = 1;\n//   techparams.inputTexture0 = blur1.colorTexture0;\n//   effectParams.destination = blur2;\n//   this.applyEffect(effectParams);\n//\n//   techparams.sampleRadius[0] = 0;\n//   techparams.sampleRadius[1] = sampleRadius / source.height;\n//   techparams.sampleRadius[2] = 1;\n//   techparams.inputTexture0 = blur2.colorTexture0;\n//   effectParams.destination = blur1;\n//   this.applyEffect(effectParams);\n//\n//   // Merge.\n//   techparams = this.bloomMergeParameters;\n//   effectParams.technique = this.bloomMergeTechnique;\n//   effectParams.params = techparams;\n//\n//   techparams.bloomIntensity = (params.bloomIntensity !== undefined) ? params.bloomIntensity : 1.2;\n//   techparams.bloomSaturation = (params.bloomSaturation !== undefined) ? params.bloomSaturation : 1.2;\n//   techparams.originalIntensity = (params.originalIntensity !== undefined) ? params.originalIntensity : 1.0;\n//   techparams.originalSaturation = (params.originalSaturation !== undefined) ? params.originalSaturation : 1.0;\n//   techparams.inputTexture0 = source;\n//   techparams.inputTexture1 = blur1.colorTexture0;\n//   effectParams.destination = dest;\n//   this.applyEffect(effectParams);\n//\n//   return true;\n// }\n\nexport function applyCopy(params) {\n  if (!inited) {\n    startup();\n  }\n  let source = params.source;\n  if (!source) {\n    source = framebufferEnd({ filter_linear: params.filter_linear, need_depth: params.need_depth });\n  }\n  params.shader = params.shader || 'copy';\n  params.params = shader_params_default;\n  if (Array.isArray(source)) {\n    params.texs = source;\n  } else {\n    params.texs = [source];\n  }\n  applyEffect(params);\n}\n\nexport function applyPixelyExpand(params) {\n  if (!inited) {\n    startup();\n  }\n  let source = params.source;\n  assert(!source); // would need linear/non-wrap sampler state set\n  if (!source) {\n    source = framebufferEnd({ filter_linear: true });\n  }\n\n  // do horizontal blur for primary lines\n  let resx = source.width;\n  let resy = source.height;\n  let sampleRadius = (params.hblur || 0.25) / resx;\n  shader_params_gaussian_blur.sampleRadius[0] = sampleRadius;\n  shader_params_gaussian_blur.sampleRadius[1] = 0;\n  shader_params_gaussian_blur.sampleRadius[2] = 1;\n  applyEffect({\n    shader: 'gaussian_blur',\n    params: shader_params_gaussian_blur,\n    texs: [source],\n    final: false,\n  }, resx, resy);\n  let hblur = framebufferEnd({ filter_linear: true });\n\n  // do seperable gaussian blur for scanlines (using horizontal blur from above)\n  sampleRadius = (params.vblur || 0.75) / resy;\n  shader_params_gaussian_blur.sampleRadius[0] = 0;\n  shader_params_gaussian_blur.sampleRadius[1] = sampleRadius;\n  shader_params_gaussian_blur.sampleRadius[2] = 1;\n  applyEffect({\n    shader: 'gaussian_blur',\n    params: shader_params_gaussian_blur,\n    texs: [hblur],\n    final: false,\n  }, resx, resy);\n  let vblur = framebufferEnd({ filter_linear: true });\n\n  // combine at full res\n  v4set(shader_params_pixely_expand.orig_pixel_size,\n    source.width, source.height, 1/source.width, 1/source.height);\n\n  applyEffect({\n    shader: 'pixely_expand',\n    params: shader_params_pixely_expand,\n    texs: [source, hblur, vblur],\n\n    clear: params.clear,\n    clear_all: params.clear_all,\n    clear_color: params.clear_color,\n    viewport: params.viewport,\n  });\n}\n\nexport function applyGaussianBlur(params) {\n  if (!inited) {\n    startup();\n  }\n  let source = framebufferEnd({ filter_linear: true });\n  let max_size = params.max_size || 512;\n  let min_size = params.min_size || 128;\n\n  // Quick shrink down to 512->256->128 (or other specified min/max size)\n  let inputTexture0 = source;\n\n  let viewport = engine.viewport;\n  let res = max_size;\n  while (res > viewport[2] || res > viewport[3]) {\n    res /= 2;\n  }\n\n  while (res > min_size) {\n    applyEffect({\n      shader: params.shader_copy || 'copy',\n      params: shader_params_default,\n      texs: [inputTexture0],\n      final: false,\n    }, res, res);\n    inputTexture0 = framebufferEnd({ filter_linear: true });\n    res /= 2;\n  }\n\n  // Do seperable blur\n  let sampleRadius = (params.blur || 1) / res;\n  shader_params_gaussian_blur.sampleRadius[0] = sampleRadius;\n  shader_params_gaussian_blur.sampleRadius[1] = 0;\n  shader_params_gaussian_blur.sampleRadius[2] = params.glow || 1;\n  applyEffect({\n    shader: 'gaussian_blur',\n    params: shader_params_gaussian_blur,\n    texs: [inputTexture0],\n    final: false,\n  }, res, res);\n  let blur = framebufferEnd({ filter_linear: true });\n\n  shader_params_gaussian_blur.sampleRadius[0] = 0;\n  shader_params_gaussian_blur.sampleRadius[1] = sampleRadius;\n  shader_params_gaussian_blur.sampleRadius[2] = params.glow || 1;\n  applyEffect({\n    shader: 'gaussian_blur',\n    params: shader_params_gaussian_blur,\n    texs: [blur],\n  });\n\n  return true;\n}\n\nexport function applyColorMatrix(params) {\n  if (!inited) {\n    startup();\n  }\n  let source = framebufferEnd({ filter_linear: true });\n\n  let matrix = params.colorMatrix;\n  let mout = shader_params_color_matrix.colorMatrix;\n\n  mout[0] = matrix[0];\n  mout[1] = matrix[3];\n  mout[2] = matrix[6];\n  mout[3] = matrix[9];\n  mout[4] = matrix[1];\n  mout[5] = matrix[4];\n  mout[6] = matrix[7];\n  mout[7] = matrix[10];\n  mout[8] = matrix[2];\n  mout[9] = matrix[5];\n  mout[10] = matrix[8];\n  mout[11] = matrix[11];\n\n  applyEffect({\n    shader: 'color_matrix',\n    params: shader_params_color_matrix,\n    texs: [source],\n  });\n\n  return true;\n}\n\n// // TODO: Update for RTBBCTT and port to new GLOV.js\n// export function applyDistortTODO(params) {\n//   let source = params.source;\n//   let dest = params.destination;\n//   let distort = params.distortion;\n//   if (!source || !dest || !distort || !dest.colorTexture0 ||\n//     source === dest.colorTexture0 || distort === dest.colorTexture0) {\n//     return false;\n//   }\n//\n//   // input transform.\n//   //  a b tx\n//   //  c d ty\n//   let a;\n//   let b;\n//   let c;\n//   let d;\n//   let tx;\n//   let ty;\n//\n//   let transform = params.transform;\n//   if (transform) {\n//     // transform col-major.\n//     a = transform[0];\n//     b = transform[2];\n//     tx = transform[4];\n//     c = transform[1];\n//     d = transform[3];\n//     ty = transform[5];\n//   } else {\n//     a = d = 1;\n//     b = c = 0;\n//     tx = ty = 0;\n//   }\n//\n//   let effectParams = this.effectParams;\n//   let techparams = this.distortParameters;\n//   effectParams.technique = this.distortTechnique;\n//   effectParams.params = techparams;\n//\n//   // TODO: Cache 'transform', 'invTransform', etc in the code below\n//   techparams.transform[0] = a;\n//   techparams.transform[1] = b;\n//   techparams.transform[2] = tx;\n//   techparams.transform[3] = c;\n//   techparams.transform[4] = d;\n//   techparams.transform[5] = ty;\n//\n//   // Compute inverse transform to use in distort texture displacement..\n//   let idet = 1 / (a * d - b * c);\n//   let ia = techparams.invTransform[0] = (idet * d);\n//   let ib = techparams.invTransform[1] = (idet * -b);\n//   let ic = techparams.invTransform[2] = (idet * -c);\n//   let id = techparams.invTransform[3] = (idet * a);\n//\n//   // Compute max pixel offset after transform for normalisation.\n//   let x1 = ((ia + ib) * (ia + ib)) + ((ic + id) * (ic + id));\n//   let x2 = ((ia - ib) * (ia - ib)) + ((ic - id) * (ic - id));\n//   let x3 = ((-ia + ib) * (-ia + ib)) + ((-ic + id) * (-ic + id));\n//   let x4 = ((-ia - ib) * (-ia - ib)) + ((-ic - id) * (-ic - id));\n//   let xmax = 0.5 * Math.sqrt(Math.max(x1, x2, x3, x4));\n//\n//   let strength = (params.strength || 10);\n//   techparams.strength[0] = strength / (source.width * xmax);\n//   techparams.strength[1] = strength / (source.height * xmax);\n//\n//   techparams.inputTexture0 = source;\n//   techparams.distortTexture = distort; // linear / repeat\n//   effectParams.destination = dest;\n//   this.applyEffect(effectParams);\n//\n//   return true;\n// }\n\nexport function clearAlpha() {\n  let old_dt = gl.getParameter(gl.DEPTH_TEST);\n  if (old_dt) {\n    gl.disable(gl.DEPTH_TEST);\n  }\n  gl.colorMask(false, false, false, true);\n  applyCopy({ source: textures.textures.white, no_framebuffer: true });\n  gl.colorMask(true, true, true, true);\n  if (old_dt) {\n    gl.enable(gl.DEPTH_TEST);\n  }\n}\n\nexport function effectsStartup(prelink_effects) {\n  prelink_effects.forEach((name) => {\n    shaders.prelink(getShader('vp_copy'), getShader(name));\n  });\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint-env browser */\n\n/* eslint-disable import/order */\nrequire('./bootstrap.js'); // Just in case it's not in app.js\n\nconst client_config = require('./client_config.js');\nexport let DEBUG = client_config.MODE_DEVELOPMENT;\n\nlet startup_funcs = [];\n\nexports.require = require; // For browser console debugging\n\nrequire('not_worker'); // This module cannot be required from a worker bundle\n\nconst assert = require('assert');\nconst { is_ios_safari } = require('./browser.js');\nconst { buildUIStartup } = require('./build_ui.js');\nconst camera2d = require('./camera2d.js');\nconst cmds = require('./cmds.js');\nconst effects = require('./effects.js');\nconst { effectsReset, effectsTopOfFrame, effectsIsFinal, effectsPassAdd, effectsPassConsume } = effects;\nconst {\n  errorReportDisable,\n  errorReportSetTimeAccum,\n  errorReportSetDetails,\n  glovErrorReport,\n} = require('./error_report.js');\nconst glov_font = require('./font.js');\nconst { framebufferStart, framebufferEndOfFrame } = require('./framebuffer.js');\nconst geom = require('./geom.js');\nconst input = require('./input.js');\nconst local_storage = require('./local_storage.js');\nconst mat3FromMat4 = require('gl-mat3/fromMat4');\nconst mat4Copy = require('gl-mat4/copy');\nconst mat4Invert = require('gl-mat4/invert');\nconst mat4Mul = require('gl-mat4/multiply');\nconst mat4Transpose = require('gl-mat4/transpose');\nconst mat4Perspective = require('gl-mat4/perspective');\nconst { asin, cos, floor, min, max, PI, round, sin, sqrt } = Math;\nconst models = require('./models.js');\nconst perf = require('./perf.js');\nconst { profilerFrameStart, profilerGarbageEstimate } = require('./profiler.js');\nconst { profilerUIStartup } = require('./profiler_ui.js');\nconst { perfCounterTick } = require('glov/common/perfcounters.js');\nconst settings = require('./settings.js');\nconst shaders = require('./shaders.js');\nconst { shaderDebugUIStartup } = require('./shader_debug_ui.js');\nconst { soundLoading, soundStartup, soundTick } = require('./sound.js');\nconst { spotEndInput } = require('./spot.js');\nconst sprites = require('./sprites.js');\nconst { blendModeReset } = sprites;\nconst textures = require('./textures.js');\nconst { texturesTick } = textures;\nconst glov_transition = require('./transition.js');\nconst glov_ui = require('./ui.js');\nconst urlhash = require('./urlhash.js');\nconst { callEach, clamp, defaults, nearSame, ridx } = require('glov/common/util.js');\nconst {\n  mat3, mat4,\n  vec3, vec4, v3mulMat4, v3iNormalize, v4copy, v4same, v4set,\n} = require('glov/common/vmath.js');\n\nexport let canvas;\nexport let webgl2;\nexport let glov_particles;\n\nexport let width;\nexport let height;\nlet width_3d;\nlet height_3d;\nexport let pixel_aspect = 1;\nexport let dom_to_canvas_ratio = window.devicePixelRatio || 1;\nexport let antialias;\nexport let antialias_unavailable;\n\nexport let game_width;\nexport let game_height;\nlet game_aspect;\n\nexport let render_width;\nexport let render_height;\n\n//eslint-disable-next-line no-use-before-define\nexport let defines = urlhash.register({ key: 'D', type: urlhash.TYPE_SET, change: definesChanged });\n\nexport let ZFAR;\nexport let ZNEAR;\nexport let fov_y = 1;\nexport let fov_x = 1;\n\nexport let mat_projection = mat4();\nexport let mat_view = mat4();\nlet mat_m = mat4();\nexport let mat_vp = mat4();\nlet mat_mv = mat4();\nlet mat_mv_no_skew = mat4();\nlet mat_mvp = mat4();\nlet mat_mv_inv_transform = mat3();\nlet mat_inv_view = mat3();\n// let projection_inverse = vec4();\n\nexport let light_diffuse = vec3(0.75, 0.75, 0.75);\nexport let light_ambient = vec3(0.25, 0.25, 0.25);\nexport let light_dir_ws = vec3(-1, -2, -3);\n\nexport let font;\nexport let app_state = null;\nexport const border_color = vec4(0, 0, 0, 1);\nexport let border_clear_color = vec4(0, 0, 0, 1);\n\nlet no_render = false;\n\nexport function disableRender(new_value) {\n  no_render = new_value;\n  if (no_render) {\n    glov_ui.cleanupDOMElems();\n  }\n}\n\nlet view_space_globals = [];\nexport function addViewSpaceGlobal(name) {\n  let ws_name = `${name}_ws`;\n  let ws_vec = shaders.globals[ws_name];\n  assert(ws_vec);\n  assert.equal(ws_vec.length, 3);\n  let vs_name = `${name}_vs`;\n  let vs_vec = vec3();\n  shaders.addGlobal(vs_name, vs_vec);\n  view_space_globals.push({\n    vs: vs_vec,\n    ws: ws_vec,\n  });\n}\n\nlet mat_temp = mat4();\nexport function setGlobalMatrices(_mat_view) {\n  mat4Copy(mat_view, _mat_view);\n  mat4Mul(mat_vp, mat_projection, mat_view);\n  v3iNormalize(light_dir_ws);\n  for (let ii = 0; ii < view_space_globals.length; ++ii) {\n    let vsg = view_space_globals[ii];\n    v3mulMat4(vsg.vs, vsg.ws, mat_view);\n  }\n  mat4Invert(mat_temp, mat_view);\n  mat3FromMat4(mat_inv_view, mat_temp);\n}\n\n// Just set up mat_vp and mat_projection\nexport function setMatVP(_mat_view) {\n  // eslint-disable-next-line no-use-before-define\n  setupProjection(fov_y, width_3d, height_3d, ZNEAR, ZFAR);\n  mat4Copy(mat_view, _mat_view);\n  mat4Mul(mat_vp, mat_projection, mat_view);\n}\n\nexport function setFOV(fov_min) {\n  let w = width_3d;\n  let h = height_3d;\n  let aspect = w / h;\n  if (aspect > game_aspect) {\n    fov_y = fov_min;\n    let rise = sin(fov_y / 2) / cos(fov_y / 2) * aspect;\n    fov_x = 2 * asin(rise / sqrt(rise * rise + 1));\n  } else {\n    // Calculate what fov_x would be if the screen was game_aspect, then derive fov_y from that\n    let rise = sin(fov_min / 2) / cos(fov_min / 2) * game_aspect;\n    fov_x = 2 * asin(rise / sqrt(rise * rise + 1));\n    // Old method, just apply fov to x (it's the same thing, if game_aspect is 1.0)\n    // fov_x = fov_min;\n    let rise2 = sin(fov_x / 2) / cos(fov_x / 2) / aspect;\n    fov_y = 2 * asin(rise2 / sqrt(rise2 * rise2 + 1));\n  }\n}\n\nexport function setGameDims(w, h) {\n  game_width = w;\n  game_height = h;\n  game_aspect = game_width / game_height;\n}\n\n// Didn't need this for a while, but got slow on iOS recently :(\n// Better when using FBOs for postprocessing now, though!\nconst postprocessing_reset_version = '5';\nexport let postprocessing = local_storage.get('glov_no_postprocessing') !== postprocessing_reset_version;\nexport function postprocessingAllow(allow) {\n  local_storage.set('glov_no_postprocessing', allow ? undefined : postprocessing_reset_version);\n  postprocessing = allow;\n}\n\nexport function glCheckError() {\n  let gl_err = gl.getError();\n  if (gl_err) {\n    console.error(gl_err);\n    throw new Error(gl_err);\n  }\n}\n\nexport function releaseCanvas() {\n  try {\n    if (gl) {\n      let ext = gl.getExtension('WEBGL_lose_context');\n      if (ext) {\n        ext.loseContext();\n      }\n    }\n  } catch (ignored) {\n    // nothing, it's fine\n  }\n}\n\nexport function reloadSafe() {\n  // Do not report any errors after this point\n  errorReportDisable();\n  // Release canvas to not leak memory on Firefox\n  releaseCanvas();\n  if (window.FBInstant) {\n    try {\n      window.top.location.reload();\n    } catch (e) {\n      // Not good, but better than the alternatives, I guess\n      window.FBInstant.quit();\n    }\n  } else {\n    document.location.reload();\n  }\n}\nwindow.reloadSafe = reloadSafe;\n\nlet reloading_defines = {};\nexport function defineCausesReload(define) {\n  reloading_defines[define] = defines[define];\n}\ndefineCausesReload('FORCEWEBGL2');\ndefineCausesReload('NOWEBGL2');\nexport function definesChanged() {\n  for (let key in reloading_defines) {\n    if (defines[key] !== reloading_defines[key]) {\n      urlhash.onURLChange(reloadSafe);\n      break;\n    }\n  }\n  shaders.handleDefinesChanged();\n}\n\nfunction normalizeRow(m, idx) {\n  let len = m[idx]*m[idx] + m[idx+1]*m[idx+1] + m[idx+2]*m[idx+2];\n  if (len > 0) {\n    len = 1 / sqrt(len);\n    m[idx] *= len;\n    m[idx+1] *= len;\n    m[idx+2] *= len;\n  }\n}\n\nexport function updateMatrices(mat_model) {\n  // PERFTODO: depending on rendering path, only some of these are needed (m + vp or just mvp)\n  mat4Copy(mat_m, mat_model);\n\n  mat4Mul(mat_mv, mat_view, mat_model);\n  mat4Mul(mat_mvp, mat_projection, mat_mv);\n  // TODO: Can expand and simplify all of this, especially below\n  // Compute the inverse transform of thee model_view matrix, discarding scale,\n  // to be used for getting normals into view space\n  mat4Copy(mat_temp, mat_model);\n  normalizeRow(mat_temp, 0);\n  normalizeRow(mat_temp, 4);\n  normalizeRow(mat_temp, 8);\n  mat4Mul(mat_mv_no_skew, mat_view, mat_temp);\n  mat4Invert(mat_temp, mat_mv_no_skew);\n  mat4Transpose(mat_temp, mat_temp);\n  mat3FromMat4(mat_mv_inv_transform, mat_temp);\n}\nexport let frame_timestamp = 0;\nexport function getFrameTimestamp() {\n  return frame_timestamp;\n}\n\nexport let frame_index = 0;\nexport function getFrameIndex() {\n  return frame_index;\n}\n\nexport let frame_dt = 0;\nexport function getFrameDt() {\n  return frame_dt;\n}\n\nexport let hrtime = 0;\n\n// Wall time, may contain large jumps, may be 0 or negative\nlet this_frame_time_actual = 0;\nexport function getFrameDtActual() {\n  return this_frame_time_actual;\n}\n\nlet after_loading_state = null;\nexport let is_loading = true;\nexport function setState(new_state) {\n  if (is_loading) {\n    after_loading_state = new_state;\n  } else {\n    app_state = new_state;\n  }\n}\n\nexport function stateActive(test_state) {\n  if (is_loading) {\n    return after_loading_state === test_state;\n  } else {\n    return app_state === test_state;\n  }\n}\n\nlet mspf = 1000;\nlet mspf_update_time = 0;\nlet mspf_frame_count = 0;\nlet last_tick_cpu = 0;\nlet mspf_tick = 1000;\n// let net_time = 1000;\nlet mspf_tick_accum = 0;\n// let net_time_accum = 0;\nlet garbage_estimate = 0;\nexport const PERF_HISTORY_SIZE = 128;\nexport let perf_state = window.glov_perf_state = {\n  fpsgraph: {\n    index: 0,\n    history: new Float32Array(PERF_HISTORY_SIZE * 2),\n  },\n  gpu_mem: {\n    tex: 0,\n    geom: 0,\n  },\n};\nlet fpsgraph = perf_state.fpsgraph;\n\nperf.addMetric({\n  name: 'fps',\n  show_stat: 'show_fps', // always, if we're showing any metrics\n  show_graph: 'fps_graph',\n  labels: {\n    'fps: ': () => (1000 / mspf).toFixed(1),\n    'ms/f: ': () => mspf.toFixed(0),\n    'cpu: ': () => mspf_tick.toFixed(0),\n    'gc/f: ': () => (garbage_estimate ? garbage_estimate.toFixed(1) : ''),\n    // 'net: ': () => net_time.toFixed(0),\n  },\n  data: fpsgraph, // contain .index and .history (stride of colors.length)\n  line_scale_top: 50,\n  colors: [\n    // vec4(0.161, 0.678, 1, 1), // net time\n    vec4(1, 0.925, 0.153, 1), // cpu/tick time\n    vec4(0, 0.894, 0.212, 1), // total time (GPU)\n  ],\n}, true);\n\nlet do_borders = true;\nlet do_viewport_postprocess = false;\nlet need_repos = 0;\n\nexport function resizing() {\n  return need_repos;\n}\n\nlet app_tick_functions = [];\nexport function addTickFunc(cb) {\n  app_tick_functions.push(cb);\n}\n\nexport function removeTickFunc(cb) {\n  let idx = app_tick_functions.indexOf(cb);\n  if (idx !== -1) {\n    app_tick_functions.splice(idx, 1);\n    return true;\n  }\n  return false;\n}\n\nlet post_tick = [];\nexport function postTick(opts) {\n  opts.ticks = opts.ticks || 1; // run in how many ticks?\n  opts.inactive = opts.inactive || false; // run even if inactive?\n  assert.equal(typeof opts.fn, 'function');\n  post_tick.push(opts);\n}\n\nlet pre_sprite_render = null;\nexport function preSpriteRender(fn) {\n  if (!pre_sprite_render) {\n    pre_sprite_render = [];\n  }\n  pre_sprite_render.push(fn);\n}\n\nlet post_render = null;\nexport function postRender(fn) {\n  if (!post_render) {\n    post_render = [];\n  }\n  post_render.push(fn);\n}\n\nfunction resetEffects() {\n  effectsReset();\n  framebufferEndOfFrame();\n}\n\nexport function renderWidth() {\n  return render_width || width;\n}\nexport function renderHeight() {\n  return render_height || height;\n}\n\nconst SAFARI_FULLSCREEN_ASPECT = (function () {\n  let screen = window.screen;\n  if (!is_ios_safari || !screen) {\n    return 0;\n  }\n  const SAFARI_DIMS = { // wxh : [fullscreen aspect]\n    // iPhone XR\n    // iPhone 11 Pro Max\n    // iPhone XS Max\n    // iPhone 11\n    '896,414': 896/414,\n    // iPhone 11 Pro\n    // iPhone X (probably)\n    '812,375': 812/375,\n    // iPhone 8 Plus\n    '736,414': 736/414,\n    // iPhone 6s+\n    // iPhone 6+\n    '716,414': 736/414, // (screen.availWidth reports 20 less)\n    // iPhone 8\n    // iPhone 7 (10.1)\n    // iPhone 7 (11.4)\n    '667,375': 667/375,\n    // iPhone 6s\n    // iPhone 6\n    '647,375': 667/375, // (screen.availWidth reports 20 less)\n    // iPhone 5s\n    '548,320': 568/320, // (screen.availWidth reports 20 less)\n  };\n  let key = `${max(screen.availWidth, screen.availHeight)},${min(screen.availWidth, screen.availHeight)}`;\n  return SAFARI_DIMS[key] || 0;\n}());\nfunction safariTopSafeArea(view_w, view_h) {\n  // Detect if the URL bar is hidden, but should be a safe area\n  if (SAFARI_FULLSCREEN_ASPECT && nearSame(view_w/view_h, SAFARI_FULLSCREEN_ASPECT, 0.001)) {\n    // Note: if user has scaling enabled, the padding required might be different\n    //   but the same holds true for the safe area padding detected via CSS!\n    return 50 * (window.devicePixelRatio || 1); // seems to be 50pts on all devices\n  }\n  return 0;\n}\n\n\nlet last_canvas_width;\nlet last_canvas_height;\nlet last_body_height;\nlet safearea_elem;\nlet safearea_ignore_bottom = false;\nlet safearea_values = [0,0,0,0];\nlet last_safearea_values = [0,0,0,0];\nfunction checkResize() {\n  profilerStart('checkResize');\n  // use VisualViewport on at least iOS Safari - deal with tabs and keyboard\n  //   shrinking the viewport without changing the window height\n  let vv = window.visualViewport || {};\n  dom_to_canvas_ratio = window.devicePixelRatio || 1;\n  dom_to_canvas_ratio *= settings.render_scale_all;\n  let view_w = (vv.width || window.innerWidth);\n  let view_h = (vv.height || window.innerHeight);\n  if (view_h !== last_body_height) {\n    // set this *before* getting canvas and safearea_elem dims below\n    last_body_height = view_h;\n    if (document.body) {\n      document.body.style.height = `${view_h}px`;\n    }\n  }\n  let rect = canvas.getBoundingClientRect();\n  let new_width = round(rect.width * dom_to_canvas_ratio) || 1;\n  let new_height = round(rect.height * dom_to_canvas_ratio) || 1;\n\n  if (cmds.safearea[0] === -1) {\n    if (safearea_elem) {\n      let sa_width = safearea_elem.offsetWidth;\n      let sa_height = safearea_elem.offsetHeight;\n      if (sa_width && sa_height) {\n        v4set(safearea_values,\n          safearea_elem.offsetLeft * dom_to_canvas_ratio,\n          new_width - (sa_width + safearea_elem.offsetLeft) * dom_to_canvas_ratio,\n          max(safearea_elem.offsetTop * dom_to_canvas_ratio,\n            safariTopSafeArea(view_w, view_h) * settings.render_scale_all),\n          // Note: Possibly ignoring bottom safe area, it seems not useful on iPhones (does not\n          //  adjust when keyboard is up, only obscured in the middle, if obeying left/right safe area)\n          safearea_ignore_bottom ? 0 : new_height - (sa_height + safearea_elem.offsetTop) * dom_to_canvas_ratio);\n      }\n    }\n  } else {\n    v4set(safearea_values,\n      new_width * clamp(cmds.safearea[0], 0, 25)/100,\n      new_width * clamp(cmds.safearea[1], 0, 25)/100,\n      new_height * clamp(cmds.safearea[2], 0, 25)/100,\n      new_height * clamp(cmds.safearea[3], 0, 25)/100);\n  }\n  if (!v4same(safearea_values, last_safearea_values)) {\n    v4copy(last_safearea_values, safearea_values);\n    camera2d.setSafeAreaPadding(safearea_values[0], safearea_values[1], safearea_values[2], safearea_values[3]);\n    need_repos = max(need_repos, 1);\n  }\n\n  if (new_width !== last_canvas_width || new_height !== last_canvas_height) {\n    window.pixel_scale = dom_to_canvas_ratio; // for debug\n    last_canvas_width = canvas.width = new_width || 1;\n    last_canvas_height = canvas.height = new_height || 1;\n\n    width = canvas.width;\n    height = canvas.height;\n\n    // For the next 10 frames, make sure font size is correct\n    need_repos = 10;\n  }\n  if (is_ios_safari && (window.visualViewport || need_repos)) {\n    // we have accurate view information, or screen was just rotated / resized\n    // force scroll to top\n    window.scroll(0,0);\n  }\n  profilerStop('checkResize');\n}\n\nexport let viewport = vec4(0,0,1,1);\nexport function setViewport(xywh) {\n  v4copy(viewport, xywh);\n  gl.viewport(xywh[0], xywh[1], xywh[2], xywh[3]);\n}\n\nlet frames_requested = 0;\nfunction requestFrame(user_time) {\n  let max_fps = settings.max_fps;\n  let desired_frames = (max_fps >= 250) ? 10 : 1;\n  if (frames_requested >= desired_frames) {\n    return;\n  }\n  if (defines.SLOWLOAD && is_loading) {\n    // Safari on CrossBrowserTesting needs this in order to have some time to load/decode audio data\n    // TODO: Instead, generally, if loading, compare last_tick_cpu vs dt, and if\n    //   we're not idle for at least half of the time and we have *internal*\n    //   loads (textures, sounds, models, NOT user code), delay so that we are.\n    max_fps = 2;\n  }\n  if (desired_frames > 1) {\n    // Ensure we have at least that many frames queued up at any point in time, so they\n    // can fire at less than the normal 4ms browser delay of setTimeout()\n    while (frames_requested < desired_frames) {\n      // eslint-disable-next-line no-use-before-define\n      setTimeout(tick, 1);\n      frames_requested++;\n    }\n  } else if (max_fps) {\n    let desired_delay = max(0, round(1000 / max_fps - (user_time || 0)));\n    frames_requested++;\n    // eslint-disable-next-line no-use-before-define\n    setTimeout(tick, desired_delay);\n  } else {\n    frames_requested++;\n    // eslint-disable-next-line no-use-before-define\n    requestAnimationFrame(tick);\n  }\n}\n\nlet mat_projection_10;\nexport let had_3d_this_frame;\n\nexport function clearHad3DThisFrame() {\n  had_3d_this_frame = false;\n}\n\nexport function setupProjection(use_fov_y, use_width, use_height, znear, zfar) {\n  mat4Perspective(mat_projection, use_fov_y, use_width/use_height, znear, zfar);\n  mat_projection_10 = mat_projection[10];\n  // v4set(projection_inverse,\n  //   2 / (use_width * mat_projection[0]), // projection_matrix.m00),\n  //   2 / (use_height * mat_projection[5]), // projection_matrix.m11),\n  //   -(1 + mat_projection[8]) / mat_projection[0], // projection_matrix.m20) / projection_matrix.m00,\n  //   -(1 + mat_projection[9]) / mat_projection[5] // projection_matrix.m21) / projection_matrix.m11\n  // );\n}\n\nexport function setZRange(znear, zfar) {\n  ZNEAR = znear;\n  ZFAR = zfar;\n  if (had_3d_this_frame) {\n    setupProjection(fov_y, width_3d, height_3d, ZNEAR, ZFAR);\n  }\n}\n\nfunction set3DRenderResolution(w, h) {\n  width_3d = w;\n  height_3d = h;\n}\n\nlet want_render_scale_3d_this_frame;\nlet had_render_scale_3d_this_frame;\nexport function start3DRendering(opts) {\n  opts = opts || {};\n  if (opts.width) {\n    set3DRenderResolution(opts.width, opts.height);\n  }\n  setFOV(opts.fov || (settings.fov * PI / 180));\n  had_3d_this_frame = true;\n  if (!opts.width && want_render_scale_3d_this_frame && !defines.NOCOPY) {\n    had_render_scale_3d_this_frame = true;\n    effectsPassAdd();\n  }\n  blendModeReset(true);\n  gl.enable(gl.BLEND);\n  gl.enable(gl.DEPTH_TEST);\n  gl.depthMask(true);\n  let backbuffer_width = width_3d;\n  let backbuffer_height = height_3d;\n  if (opts.viewport) {\n    // Rendering to a viewport within the backbuffer, and postprocessing must be\n    // UI-level and want to grab the whole thing.\n    backbuffer_width = render_width || width;\n    backbuffer_height = render_height || height;\n  }\n  framebufferStart({\n    width: backbuffer_width,\n    height: backbuffer_height,\n    final: effectsIsFinal(),\n    need_depth: opts.need_depth || true,\n    clear: true,\n    clear_all: opts.clear_all === undefined ? settings.render_scale_clear : opts.clear_all,\n    viewport: opts.viewport,\n  });\n\n  setupProjection(fov_y, width_3d, height_3d, ZNEAR, ZFAR);\n\n  gl.enable(gl.CULL_FACE);\n}\n\nfunction renderScaleFinish() {\n  if (defines.NOCOPY) {\n    gl.disable(gl.SCISSOR_TEST);\n    v4set(viewport, 0, 0, width, height);\n    gl.viewport(viewport[0], viewport[1], viewport[2], viewport[3]);\n  } else {\n    effectsPassConsume();\n    if (settings.render_scale_mode === 2) {\n      effects.applyPixelyExpand({ final: effectsIsFinal(), clear: false });\n    } else {\n      effects.applyCopy({ filter_linear: settings.render_scale_mode === 0 });\n    }\n  }\n}\n\nexport function startSpriteRendering() {\n  gl.disable(gl.CULL_FACE);\n  blendModeReset(true);\n  gl.enable(gl.BLEND);\n  gl.disable(gl.DEPTH_TEST);\n  gl.depthMask(false);\n}\n\nexport function projectionZBias(dist, at_z) {\n  if (!dist) {\n    mat_projection[10] = mat_projection_10;\n    return;\n  }\n  //let e = 2 * ZFAR * ZNEAR / (ZFAR - ZNEAR) * (dist / (at_z * (at_z + dist)));\n  let e = 0.2 * (dist / (at_z * (at_z + dist)));\n  e = max(e, 2e-7);\n  mat_projection[10] = mat_projection_10 + e;\n}\n\nexport function fixNatives(is_startup) {\n  // If any browser extensions have added things to the Array prototype, remove them!\n  let b = [];\n  for (let a in b) {\n    console[is_startup ? 'log' : 'error'](`Found invasive enumerable property \"${a}\" on Array.prototype, removing...`);\n    let old_val = b[a];\n    errorReportSetDetails(`had_native_${a}`, typeof old_val);\n    delete Array.prototype[a];\n    // If this fails to work, perhaps try using Object.preventExtensions(Array.prototype) in an inline header script?\n    // eslint-disable-next-line no-extend-native\n    Object.defineProperty(Array.prototype, a, { value: old_val, enumerable: false });\n  }\n  for (let a in b) {\n    // Failed: code that iterates arrays will fail\n    assert(false, `Array.prototype has unremovable member ${a}`);\n  }\n}\n\nfunction resetState() {\n  // Only geom.geomResetState appears to have been strictly needed to work around\n  //  a bug on Chrome 71, but doing the rest of this to be safe.\n  profilerStart('resetState');\n  profilerStart('textures');\n  textures.texturesResetState();\n  profilerStopStart('shaders');\n  shaders.shadersResetState();\n  profilerStopStart('geom;gl');\n  geom.geomResetState();\n\n  // These should already be true:\n  blendModeReset(true);\n  // gl.disable(gl.BLEND);\n  gl.enable(gl.BLEND);\n  // gl.disable(gl.DEPTH_TEST);\n  gl.enable(gl.DEPTH_TEST);\n  // gl.depthMask(false);\n  gl.depthMask(true);\n  // gl.disable(gl.CULL_FACE);\n  gl.enable(gl.CULL_FACE);\n  // gl.depthFunc(gl.GEQUAL);\n  gl.depthFunc(gl.LEQUAL);\n  // gl.enable(gl.SCISSOR_TEST);\n  gl.disable(gl.SCISSOR_TEST);\n  // gl.cullFace(gl.FRONT);\n  gl.cullFace(gl.BACK);\n  gl.viewport(0, 0, width, height);\n  profilerStop();\n  profilerStop('resetState');\n}\n\nexport const hrnow = window.performance ? window.performance.now.bind(window.performance) : Date.now.bind(Date);\n\nlet last_tick = 0;\nfunction tick(timestamp) {\n  profilerFrameStart();\n  profilerStart('tick');\n  profilerStart('top');\n  frames_requested--;\n  // if (timestamp < 1e12) { // high resolution timer\n  //   this ends up being a value way back in time, relative to what hrnow() returns,\n  //   and even back in time relative to input events already dispatched,\n  //   causing timing confusion, so ignore it, just call hrnow()\n  //   hrtime = timestamp;\n  // } else { // probably integer milliseconds since epoch, or nothing\n  hrtime = hrnow();\n  // }\n  let now = round(hrtime); // Code assumes integer milliseconds\n  if (!last_tick) {\n    last_tick = now;\n  }\n  this_frame_time_actual = now - last_tick;\n  let dt = min(max(this_frame_time_actual, 1), 250);\n  frame_dt = dt;\n  last_tick = now;\n  frame_timestamp += dt;\n  ++frame_index;\n  errorReportSetTimeAccum(frame_timestamp);\n\n  fixNatives(false);\n\n  // let this_net_time = wsclient.getNetTime();\n  // fpsgraph.history[(fpsgraph.index % PERF_HISTORY_SIZE) * 3 + 0] = this_net_time;\n  fpsgraph.history[(fpsgraph.index % PERF_HISTORY_SIZE) * 2 + 1] = this_frame_time_actual;\n  fpsgraph.index++;\n  fpsgraph.history[(fpsgraph.index % PERF_HISTORY_SIZE) * 2 + 0] = 0;\n\n  ++mspf_frame_count;\n  mspf_tick_accum += last_tick_cpu;\n  // net_time_accum += this_net_time;\n  if (now - mspf_update_time > settings.fps_window * 1000) {\n    if (!mspf_update_time) {\n      mspf_update_time = now;\n    } else {\n      mspf = (now - mspf_update_time) / mspf_frame_count;\n      mspf_tick = mspf_tick_accum / mspf_frame_count;\n      mspf_tick_accum = 0;\n      garbage_estimate = profilerGarbageEstimate() / 1024;\n      // net_time = net_time_accum / mspf_frame_count;\n      // net_time_accum = 0;\n      mspf_frame_count = 0;\n      mspf_update_time = now;\n    }\n  }\n\n  perfCounterTick(dt);\n\n  effectsTopOfFrame();\n\n  if (document.hidden || document.webkitHidden || no_render) {\n    resetEffects();\n    input.tickInputInactive();\n    last_tick_cpu = 0;\n    for (let ii = post_tick.length - 1; ii >= 0; --ii) {\n      if (post_tick[ii].inactive && !--post_tick[ii].ticks) {\n        post_tick[ii].fn();\n        ridx(post_tick, ii);\n      }\n    }\n    requestFrame();\n    profilerStop();\n    return profilerStop('tick');\n  }\n\n  checkResize();\n  had_3d_this_frame = false;\n  want_render_scale_3d_this_frame = false;\n  had_render_scale_3d_this_frame = false;\n  if (render_width) {\n    // render_scale not supported with render_width, doesn't make much sense, just use render_width\n    set3DRenderResolution(render_width, render_height);\n    effectsPassAdd();\n  } else {\n    width_3d = max(1, round(width * settings.render_scale));\n    height_3d = max(1, round(height * settings.render_scale));\n    if (width_3d !== width) {\n      want_render_scale_3d_this_frame = true;\n    }\n  }\n\n  resetState();\n\n  textures.bind(0, textures.textures.error);\n\n  camera2d.tickCamera2D();\n  glov_transition.render(dt);\n  camera2d.setAspectFixed(game_width, game_height);\n\n  profilerStopStart('mid');\n\n  soundTick(dt);\n  input.tickInput();\n  glov_ui.tickUI(dt);\n\n  if (need_repos) {\n    --need_repos;\n    let ul = [];\n    camera2d.virtualToDom(ul, [0,0]);\n    let lr = [];\n    camera2d.virtualToDom(lr, [game_width-1,game_height-1]);\n    let viewport2 = [ul[0], ul[1], lr[0], lr[1]];\n    let view_height = viewport2[3] - viewport2[1];\n    // default font size of 16 when at height of game_height\n    let font_size = min(256, max(2, floor(view_height/800 * 16)));\n    let elem_fullscreen = document.getElementById('fullscreen');\n    if (elem_fullscreen) {\n      elem_fullscreen.style['font-size'] = `${font_size}px`;\n    }\n  }\n\n  if (do_borders) {\n    // Borders\n    glov_ui.drawRect(camera2d.x0Real(), camera2d.y0Real(), camera2d.x1Real(), 0, Z.BORDERS, border_color);\n    glov_ui.drawRect(camera2d.x0Real(), game_height, camera2d.x1Real(), camera2d.y1Real(), Z.BORDERS, border_color);\n    glov_ui.drawRect(camera2d.x0Real(), 0, 0, game_height, Z.BORDERS, border_color);\n    glov_ui.drawRect(game_width, 0, camera2d.x1Real(), game_height, Z.BORDERS, border_color);\n  }\n\n  perf.draw();\n\n  profilerStopStart('app_state');\n  for (let ii = 0; ii < app_tick_functions.length; ++ii) {\n    app_tick_functions[ii](dt);\n  }\n  if (app_state) {\n    app_state(dt);\n  }\n\n  profilerStopStart('bottom');\n  spotEndInput();\n  glov_particles.tick(dt); // *after* app_tick, so newly added/killed particles can be queued into the draw list\n\n  if (had_3d_this_frame) {\n    if (had_render_scale_3d_this_frame) {\n      renderScaleFinish();\n    }\n  } else {\n    // delayed clear (and general GL init) until after app_state, app might change clear color\n    if (render_width) {\n      // assert(!effectsIsFinal());\n      framebufferStart({\n        width: render_width,\n        height: render_height,\n        clear: true,\n        clear_all: settings.render_scale_clear, // Not sure if this is ever faster in this case?\n        final: effectsIsFinal(),\n        need_depth: false,\n      });\n    } else {\n      framebufferStart({\n        width,\n        height,\n        clear: true,\n        final: effectsIsFinal(),\n        need_depth: false,\n      });\n    }\n  }\n\n  if (pre_sprite_render) {\n    callEach(pre_sprite_render, pre_sprite_render = null);\n  }\n\n  startSpriteRendering();\n  sprites.draw();\n\n  glov_ui.endFrame();\n\n  if (post_render) {\n    callEach(post_render, post_render = null);\n  }\n\n  if (render_width) {\n    effectsPassConsume();\n    let final_viewport = [\n      camera2d.render_offset_x, camera2d.render_offset_y_bottom,\n      camera2d.render_viewport_w, camera2d.render_viewport_h\n    ];\n    let params = {\n      clear: true,\n      clear_all: true,\n      clear_color: border_clear_color,\n      viewport: final_viewport,\n    };\n    if (do_viewport_postprocess) {\n      effects.applyPixelyExpand(params);\n    } else {\n      effects.applyCopy(params);\n    }\n  }\n\n  input.endFrame();\n  resetEffects();\n  texturesTick();\n\n  for (let ii = post_tick.length - 1; ii >= 0; --ii) {\n    if (!--post_tick[ii].ticks) {\n      post_tick[ii].fn();\n      ridx(post_tick, ii);\n    }\n  }\n\n  last_tick_cpu = hrnow() - now;\n  fpsgraph.history[(fpsgraph.index % PERF_HISTORY_SIZE) * 2 + 0] = last_tick_cpu;\n  requestFrame(hrnow() - hrtime);\n  profilerStop('bottom');\n  return profilerStop('tick');\n}\n\nfunction periodiclyRequestFrame() {\n  requestFrame();\n  setTimeout(periodiclyRequestFrame, 5000);\n}\n\n// Must be called out-of-frame (use setTimeout) if not at startup\nexport function setPixelyStrict(on) {\n  if (on) {\n    render_width = game_width;\n    render_height = game_height;\n  } else {\n    render_width = undefined;\n    render_height = undefined;\n  }\n}\n\nexport function getViewportPostprocess() {\n  return do_viewport_postprocess;\n}\nexport function setViewportPostprocess(viewport_postprocess) {\n  do_viewport_postprocess = viewport_postprocess;\n}\n\nexport function setFonts(new_font, title_font) {\n  font = new_font;\n  glov_ui.setFonts(new_font, title_font);\n}\n\nexport function engineStartupFunc(func) {\n  startup_funcs.push(func);\n}\n\nexport function startup(params) {\n  fixNatives(true);\n\n  canvas = document.getElementById('canvas');\n  safearea_elem = document.getElementById('safearea');\n\n  if (params.error_report !== false) {\n    window.glov_error_report = (msg, file, line, col) => {\n      setTimeout(requestFrame, 1);\n      return glovErrorReport(true, msg, file, line, col);\n    };\n  }\n\n  if (DEBUG && !window.spector) {\n    // Add check to catch common error of `const FOO=10; for (let i=0; i < FOO.length; i++) {}`\n    // eslint-disable-next-line no-extend-native\n    Object.defineProperty(Number.prototype, 'length', {\n      get: function () {\n        assert(false, 'Numbers do not have a length property');\n        return undefined;\n      }\n    });\n  }\n\n  safearea_ignore_bottom = params.safearea_ignore_bottom || false;\n\n  // resize the canvas to fill browser window dynamically\n  window.addEventListener('resize', checkResize, false);\n  checkResize();\n\n  let is_pixely = params.pixely && params.pixely !== 'off';\n  antialias = params.antialias || !is_pixely && params.antialias !== false;\n  let powerPreference = params.high ? 'high-performance' : 'default';\n  let context_names = ['webgl2', 'webgl', 'experimental-webgl'];\n  let force_webgl1 = defines.NOWEBGL2;\n  let disable_data = local_storage.getJSON('webgl2_disable');\n  // Check if a previous, recent run had an error that hinted we should disable WebGL2\n  if (disable_data && disable_data.ua === navigator.userAgent && disable_data.ts > Date.now() - 7*24*60*60*1000) {\n    console.log('Disabling WebGL2 because a previous run encountered a related error');\n    force_webgl1 = true;\n  }\n  if (DEBUG && !defines.FORCEWEBGL2) {\n    let rc = local_storage.getJSON('run_count', 0) + 1;\n    local_storage.setJSON('run_count', rc);\n    if (rc % 2) {\n      force_webgl1 = true;\n    }\n  }\n  if (force_webgl1) {\n    context_names.splice(0, 1);\n  }\n  let context_opts = [\n    { antialias, powerPreference, alpha: false },\n    { powerPreference, alpha: false },\n    { antialias, alpha: false },\n    { alpha: false },\n    {},\n  ];\n  let good = false;\n  webgl2 = false;\n  for (let i = 0; !good && i < context_names.length; i += 1) {\n    for (let jj = 0; !good && jj < context_opts.length; ++jj) {\n      try {\n        window.gl = canvas.getContext(context_names[i], context_opts[jj]);\n        if (window.gl) {\n          if (context_names[i] === 'webgl2') {\n            webgl2 = true;\n          }\n          if (antialias && !context_opts[jj].antialias) {\n            antialias_unavailable = true;\n            antialias = false;\n          }\n          good = true;\n          break;\n        }\n      } catch (e) {\n        // ignore\n      }\n    }\n  }\n  if (!window.requestAnimationFrame) {\n    // SamsungBrowser/1.1 - apparently has WebGL, but not requestAnimationFrame; also not binary WebSockets\n    good = false;\n  }\n  if (!good) {\n    // eslint-disable-next-line no-alert\n    window.alert('Sorry, but your browser does not support WebGL or does not have it enabled.');\n    document.getElementById('loading').style.visibility = 'hidden';\n    document.getElementById('nowebgl').style.visibility = 'visible';\n    return false;\n  }\n  console.log(`Using WebGL${webgl2?2:1}`);\n\n  assert(gl);\n  canvas.focus();\n  setGameDims(params.game_width || 1280, params.game_height || 960);\n  ZNEAR = params.znear || 0.7;\n  ZFAR = params.zfar || 10000;\n  setPixelyStrict(params.pixely === 'strict');\n  if (params.viewport_postprocess) {\n    do_viewport_postprocess = true;\n  }\n  pixel_aspect = params.pixel_aspect || 1;\n\n  gl.depthFunc(gl.LEQUAL);\n  // gl.enable(gl.SCISSOR_TEST);\n  gl.cullFace(gl.BACK);\n  gl.clearColor(0, 0.1, 0.2, 1);\n  gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1); // Allow RGB texture data with non-mult-4 widths\n\n  textures.startup();\n  geom.startup();\n  shaders.startup({\n    light_diffuse,\n    light_dir_ws,\n    ambient: light_ambient,\n    mat_m: mat_m,\n    mat_mv: mat_mv,\n    mat_vp: mat_vp,\n    mvp: mat_mvp,\n    mv_inv_trans: mat_mv_inv_transform,\n    mat_inv_view: mat_inv_view,\n    view: mat_view,\n    projection: mat_projection,\n    // projection_inverse,\n  });\n  addViewSpaceGlobal('light_dir');\n  camera2d.startup();\n  sprites.startup();\n  input.startup(canvas, params);\n  models.startup();\n\n  /* eslint-disable global-require */\n  glov_particles = require('./particles.js').create();\n\n  if (is_pixely) {\n    textures.defaultFilters(gl.NEAREST, gl.NEAREST);\n    settings.runTimeDefault('render_scale_mode', 1);\n    params.ui_sprites = defaults(params.ui_sprites || {}, glov_ui.ui_sprites_pixely);\n  } else {\n    textures.defaultFilters(gl.LINEAR_MIPMAP_LINEAR, gl.LINEAR);\n  }\n\n  assert(params.font);\n  // If not, something like:\n  // const font_info_04b03x2 = require('../img/font/04b03_8x2.json');\n  // const font_info_04b03x1 = require('../img/font/04b03_8x1.json');\n  // const font_info_palanquin32 = require('../img/font/palanquin32.json');\n  // if (params.pixely === 'strict') {\n  //   font = glov_font.create(font_info_04b03x1, 'font/04b03_8x1');\n  // } else if (is_pixely) {\n  //   font = glov_font.create(font_info_04b03x2, 'font/04b03_8x2');\n  // } else {\n  //   font = glov_font.create(font_info_palanquin32, 'font/palanquin32');\n  // }\n  params.font = font = glov_font.create(params.font.info, params.font.texture);\n  if (params.title_font) {\n    params.title_font = glov_font.create(params.title_font.info, params.title_font.texture);\n  }\n  glov_ui.startup(params);\n\n  soundStartup(params.sound);\n  glov_ui.bindSounds(defaults(params.ui_sounds || {}, {\n    button_click: 'button_click',\n    rollover: 'rollover',\n  }));\n\n  buildUIStartup();\n  shaderDebugUIStartup();\n  profilerUIStartup();\n\n  callEach(startup_funcs, startup_funcs = null);\n\n  camera2d.setAspectFixed(game_width, game_height);\n\n  if (params.state) {\n    setState(params.state);\n  }\n  if (params.do_borders !== undefined) {\n    do_borders = params.do_borders;\n  }\n  if (params.show_fps !== undefined) {\n    settings.show_fps = params.show_fps;\n  }\n\n  periodiclyRequestFrame();\n  return true;\n}\n\nexport function loadsPending() {\n  return textures.load_count + soundLoading() + models.load_count;\n}\n\nfunction loading() {\n  let load_count = loadsPending();\n  let elem_loading_text = document.getElementById('loading_text');\n  if (elem_loading_text) {\n    elem_loading_text.innerText = `Loading (${load_count})...`;\n  }\n  if (!load_count) {\n    is_loading = false;\n    app_state = after_loading_state;\n    // Clear after next frame, so something is rendered to the canvas\n    postTick({\n      ticks: 2,\n      fn: function () {\n        let loading_elem = document.getElementById('loading');\n        if (loading_elem) {\n          loading_elem.style.visibility = 'hidden';\n        }\n      }\n    });\n  }\n}\napp_state = loading;\n\nwindow.glov_engine = exports;\n","import assert from 'assert';\nimport { setAbilityReload } from './client_config';\nimport { cmd_parse } from './cmds';\nimport { netForceDisconnect } from './net';\nimport * as urlhash from './urlhash';\n\nexport interface EnvironmentConfig {\n  name: string;\n  link_base?: string;\n  api_path?: string;\n}\n\nlet all_environments: Partial<Record<string, EnvironmentConfig>> = {};\nlet current_environment: EnvironmentConfig | null = null;\nlet default_environment: EnvironmentConfig | null = null;\n\nlet link_base: string;    // Link base like http://foo.bar/ (with trailing slash)\nlet api_path: string;     // API base like http://foo.bar/api/ (with trailing slash)\nlet texture_base: string; // Texture base like http://foo.bar/ (with trailing slash)\n\nfunction applyEnvironment() {\n  link_base = (current_environment && current_environment.link_base) || urlhash.getURLBase();\n  api_path = (current_environment && current_environment.api_path) || `${link_base}api/`;\n  texture_base = link_base.replace('//localhost:', '//127.0.0.1:');\n}\n\n// Default initialization\napplyEnvironment();\n\nexport function getCurrentEnvironment<T extends EnvironmentConfig>(): T | null {\n  return current_environment as (T | null);\n}\nexport function setCurrentEnvironment(environment_name: string | undefined | null): void {\n  let prev_environment = current_environment;\n  current_environment = (environment_name && all_environments[environment_name]) || default_environment;\n  if (current_environment !== prev_environment) {\n    applyEnvironment();\n    setAbilityReload(false);\n    netForceDisconnect();\n  }\n}\n\nexport function getLinkBase(): string {\n  return link_base;\n}\nexport function getAPIPath(): string {\n  return api_path;\n}\nexport function getExternalTextureURL(url: string): string {\n  return url.match(/^.{2,7}:/) ? url : `${texture_base}${url}`;\n}\n\nexport function environmentsInit<T extends EnvironmentConfig>(\n  environments: Array<T>,\n  default_environment_name?: string | undefined | null,\n): void {\n  all_environments = {};\n  let all_names = [];\n  for (let i = 0, len = environments.length; i < len; i++) {\n    let env = environments[i];\n    let env_name = env.name;\n    assert(env_name.length > 0);\n    all_environments[env_name] = env;\n    all_names.push(env_name);\n  }\n\n  current_environment = default_environment =\n    (default_environment_name && all_environments[default_environment_name]) || null;\n  applyEnvironment();\n\n  if (!all_names.some((name) => name.toLowerCase() === 'default')) {\n    all_names.push('default');\n  }\n  cmd_parse.registerValue('environment', {\n    type: cmd_parse.TYPE_STRING,\n    help: 'Display or set the current client environment',\n    usage: 'Display the current client environment\\n  Usage: /environment\\n' +\n      `Set the current client environment (${all_names.join(', ')})\\n  Usage: /environment <environment_name>`,\n    label: 'Environment',\n    get: () => JSON.stringify(getCurrentEnvironment() || 'default', null, 2),\n    set: setCurrentEnvironment,\n    access_show: ['sysadmin'],\n  });\n}\n","/* global location */\n\nexport let session_uid = `${String(Date.now()).slice(-8)}${String(Math.random()).slice(2,8)}`;\n\n/* eslint-disable import/order */\nimport { getAPIPath } from 'glov/client/environments';\n\nconst { fetch } = require('./fetch.js');\nconst { PLATFORM } = require('./client_config.js');\n\nlet error_report_disabled = false;\n\nexport function errorReportDisable() {\n  error_report_disabled = true;\n}\n\nlet ignore_promises = false;\nexport function errorReportIgnoreUncaughtPromises() {\n  ignore_promises = true;\n}\n\nlet error_report_details = {};\nlet error_report_dynamic_details = {};\nexport function errorReportSetDetails(key, value) {\n  if (value) {\n    error_report_details[key] = escape(String(value));\n  } else {\n    delete error_report_details[key];\n  }\n}\nexport function errorReportSetDynamicDetails(key, fn) {\n  error_report_dynamic_details[key] = fn;\n}\n\nerrorReportSetDetails('build', BUILD_TIMESTAMP);\nerrorReportSetDetails('sesuid', session_uid);\nerrorReportSetDetails('platform', PLATFORM);\nconst time_start = Date.now();\nerrorReportSetDetails('time_start', time_start);\nerrorReportSetDynamicDetails('url', function () {\n  return escape(location.href);\n});\nerrorReportSetDynamicDetails('time_up', function () {\n  return Date.now() - time_start;\n});\nlet time_accum = 0;\nexport function errorReportSetTimeAccum(new_value) {\n  time_accum = new_value;\n}\nerrorReportSetDynamicDetails('time_accum', function () {\n  return time_accum;\n});\n\nfunction getDynamicDetail(key) {\n  let value = error_report_dynamic_details[key]();\n  if (!value && value !== 0) {\n    return '';\n  }\n  return `&${key}=${value}`;\n}\nexport function errorReportDetailsString() {\n  return `&${Object.keys(error_report_details)\n    .map((k) => `${k}=${error_report_details[k]}`)\n    .join('&')}` +\n    `${Object.keys(error_report_dynamic_details).map(getDynamicDetail).join('')}`;\n}\n\nlet last_error_time = 0;\nlet crash_idx = 0;\nexport function hasCrashed() {\n  return crash_idx > 0;\n}\n\nexport function errorReportClear() {\n  last_error_time = 0;\n  window.debugmsg('', true);\n}\n\n// Errors from plugins that we don't want to get reported to us, or show the user!\n// The exact phrase \"Script error.\\n  at (0:0)\" comes from our bootstap.js when we\n//   receive the message 'Script Error.' and no stack.  This happens on the Mi Browser on Redmi phones\n//   and doesn't seem to be indicative of any actual problem.\n// Ignoring null at null for similar reasons and because we get nothing useful from the reports.\n// eslint-disable-next-line no-regex-spaces\nlet filtered_errors = /avast_submit|vc_request_action|^Script error\\.\\n  at \\(0:0\\)$|^null\\n  at null\\(null:null\\)$|getElementsByTagName\\('video'\\)|document\\.getElementById\\(\"search\"\\)|change_ua|chrome-extension|setConnectedRobot|Failed to (?:start|stop) the audio device|zaloJSV2|getCookie is not defined|originalPrompt|_AutofillCallbackHandler|sytaxError|bannerNight|privateSpecialRepair/;\nexport function glovErrorReport(is_fatal, msg, file, line, col) {\n  console.error(msg);\n  if (is_fatal) {\n    // Only doing filtering and such on fatal errors, as non-fatal errors are\n    // just logged and should not corrupt state.\n    ++crash_idx;\n    let now = Date.now();\n    let dt = now - last_error_time;\n    last_error_time = now;\n    if (error_report_disabled) {\n      return false;\n    }\n    if (dt < 30*1000) {\n      // Less than 30 seconds since the last error, either we're erroring every\n      // frame, or this is a secondary error caused by the first, do not report it.\n      // Could maybe hash the error message and just report each message once, and\n      // flag errors as primary or secondary.\n      return false;\n    }\n    if (msg.match(filtered_errors)) {\n      return false;\n    }\n  }\n  // Post to an error reporting endpoint that (probably) doesn't exist - it'll get in the logs anyway!\n  let url = getAPIPath(); // base like http://foo.com/bar/ (without index.html)\n  url += `${is_fatal ? 'errorReport' : 'errorLog'}?cidx=${crash_idx}&file=${escape(file)}` +\n    `&line=${line||0}&col=${col||0}` +\n    `&msg=${escape(msg)}${errorReportDetailsString()}`;\n  fetch({ method: 'POST', url }, () => { /* nop */ });\n  if (ignore_promises && msg.match(/Uncaught \\(in promise\\)/)) {\n    return false;\n  }\n  return true;\n}\n","/* globals FBInstant */\n/* eslint-disable import/order */\nconst { registerExternalUserInfoProvider } = require('./social.js');\nconst urlhash = require('./urlhash.js');\nconst local_storage = require('./local_storage.js');\nconst { ID_PROVIDER_FB_INSTANT } = require('glov/common/enums.js');\nconst { errorReportSetDynamicDetails } = require('glov/client/error_report.js');\nconst { callEach, eatPossiblePromise } = require('glov/common/util.js');\n\nlet onreadycallbacks = [];\nexport function onready(callback) {\n  if (!onreadycallbacks) {\n    return void callback();\n  }\n  onreadycallbacks.push(callback);\n}\n\nexport function fbInstantIsReady() {\n  return onreadycallbacks === null;\n}\n\nlet fb_log = [];\nfunction fbInstantLogEvent(event) {\n  FBInstant.logEvent(event);\n  fb_log.push(event);\n  if (fb_log.length > 10) {\n    fb_log.splice(0, 1);\n  }\n}\n\nlet hasSubscribedAlready = false;\nfunction initSubscribe(callback, skipShortcut) {\n\n  skipShortcut = skipShortcut||false;\n\n  function handleSubscribeToBotComplete() {\n    if (callback) {\n      //Prevents the handleSubscribeToBotComplete promise from eating unfreeze event errors\n      setTimeout(callback,1);\n    }\n  }\n\n  function handleSubscribeToBotFailure(e) {\n    if (e && e.code !== 'USER_INPUT') {\n      console.error('handleSubscribeToBotFailure', e);\n    }\n    fbInstantLogEvent('bot_subscribe_failure');\n    handleSubscribeToBotComplete();\n  }\n\n  function subscribeToBot() {\n    console.warn('Window social trying to bot subscribe');\n    if (FBInstant.getSupportedAPIs().indexOf('player.canSubscribeBotAsync') !== -1) {\n      FBInstant.player.canSubscribeBotAsync().then(function (canSubscribe) {\n        if (canSubscribe) {\n          fbInstantLogEvent('bot_subscribe_show');\n          FBInstant.player.subscribeBotAsync().then(function () {\n            fbInstantLogEvent('bot_subscribe_success');\n            handleSubscribeToBotComplete();\n          },handleSubscribeToBotFailure).catch(handleSubscribeToBotFailure);\n        } else {\n          handleSubscribeToBotComplete();\n        }\n      }).catch(handleSubscribeToBotFailure);\n    } else {\n      handleSubscribeToBotComplete();\n    }\n  }\n\n  function handleHomescreenComplete() {\n    subscribeToBot();\n  }\n\n  function handleCreateShortcutFailure(e) {\n    console.error('handleCreateShortcutFailure', e);\n    fbInstantLogEvent('homescreen_install_failure');\n    handleHomescreenComplete();\n  }\n\n  let hasAddedToHomescreen = local_storage.get('instant.hasInstalledShortcut.v2');\n  function createShortcut() {\n    console.warn('Window social trying to create shortcut');\n    if (FBInstant.getSupportedAPIs().indexOf('canCreateShortcutAsync') !== -1 &&\n      !hasAddedToHomescreen &&\n      !hasSubscribedAlready\n    ) {\n      hasSubscribedAlready = true;\n      FBInstant.canCreateShortcutAsync().then(function (canCreateShortcut) {\n        if (canCreateShortcut) {\n          fbInstantLogEvent('homescreen_install_show');\n          FBInstant.createShortcutAsync().then(function () {\n            local_storage.set('instant.hasInstalledShortcut.v2',true);\n            fbInstantLogEvent('homescreen_install_success');\n            handleHomescreenComplete();\n          },function () {\n            fbInstantLogEvent('homescreen_install_useraborted');\n            handleHomescreenComplete();\n          }).catch(handleCreateShortcutFailure);\n        } else {\n          handleHomescreenComplete();\n        }\n      }).catch(handleCreateShortcutFailure);\n    } else {\n      handleHomescreenComplete();\n    }\n  }\n\n  if (skipShortcut) {\n    subscribeToBot();\n  } else {\n    createShortcut();\n  }\n}\n\nlet on_pause = [];\nexport function fbInstantOnPause(cb) {\n  on_pause.push(cb);\n}\n\nlet can_follow_official_page = false;\nlet can_join_official_group = false;\nlet can_get_live_streams_overlay = false;\n\nexport function fbGetLoginInfo(cb) {\n  onready(() => {\n    window.FBInstant.player.getSignedPlayerInfoAsync().then((result) => {\n      if (cb) {\n        cb(null, {\n          signature: result.getSignature(),\n          display_name: window.FBInstant.player.getName(),\n        });\n        cb = null;\n      }\n    }).catch((err) => {\n      if (cb) {\n        cb(err);\n        cb = null;\n      }\n    });\n  });\n}\n\n/// Maps a player to an ExternalUserInfo\nfunction mapPlayerToExternalUserInfo(player) {\n  return { external_id: player.getID(), name: player.getName(), profile_picture_url: player.getPhoto() };\n}\n\n/// Returns an ExternalUserInfo\nfunction fbInstantGetPlayer(cb) {\n  onready(() => {\n    let player = window.FBInstant.player;\n    cb(null, player ? mapPlayerToExternalUserInfo(player) : undefined);\n  });\n}\n\n/// cb receives an error if any occurs and an array of ExternalUserInfo objects\nfunction fbInstantGetFriends(cb) {\n  onready(() => {\n    window.FBInstant.player.getConnectedPlayersAsync().then((players) => {\n      if (cb) {\n        let local_cb = cb;\n        cb = null;\n        local_cb(null, players?.map(mapPlayerToExternalUserInfo));\n      }\n    }).catch((err) => {\n      if (cb) {\n        let local_cb = cb;\n        cb = null;\n        local_cb(err);\n      }\n    });\n  });\n}\n\nexport function fbGetAppScopedUserId(cb) {\n  onready(() => {\n    window.FBInstant.player.getASIDAsync().then((asid) => {\n      if (cb) {\n        cb(null, asid);\n        cb = null;\n      }\n    }).catch((err) => {\n      if (cb) {\n        cb(err);\n        cb = null;\n      }\n    });\n  });\n}\n\nexport function canFollowOfficialPage() {\n  return window.FBInstant && can_follow_official_page;\n}\n\nexport function canJoinOfficialGroup() {\n  return window.FBInstant && can_join_official_group;\n}\n\nexport function canShowLiveStreamOverlay() {\n  return window.FBInstant && can_get_live_streams_overlay;\n}\n\nexport function fbInstantInit() {\n  if (!window.FBInstant) {\n    return;\n  }\n\n  errorReportSetDynamicDetails('fblog', () => fb_log.join(','));\n  registerExternalUserInfoProvider(ID_PROVIDER_FB_INSTANT, fbInstantGetPlayer, fbInstantGetFriends);\n\n  let left = 1;\n  let fake_load_interval = setInterval(function () {\n    left *= 0.9;\n    eatPossiblePromise(FBInstant.setLoadingProgress(100-(left*100)>>0));\n  },100);\n\n  FBInstant.initializeAsync().then(function () {\n    let entryPointData = FBInstant.getEntryPointData()||{};\n    // let entryPointData = { querystring: { w: '4675', wg: '1' } }; // FRVR\n    // let entryPointData = { querystring: { blueprint: 'RKWVAE26XS24Z' } }; // FRVR\n    let querystring = entryPointData.querystring||{};\n    for (let x in querystring) {\n      urlhash.set(x, querystring[x]);\n    }\n\n    clearInterval(fake_load_interval);\n    FBInstant.startGameAsync().then(function () {\n      callEach(onreadycallbacks, onreadycallbacks = null);\n\n      console.log('Initializing FBInstant');\n      initSubscribe(function () {\n        console.log('All done initing FBInstant');\n\n        window.FBInstant.community.canFollowOfficialPageAsync().then(function (state) {\n          can_follow_official_page = state;\n        }).catch(function (err) {\n          console.error(err);\n        });\n\n        window.FBInstant.community.canJoinOfficialGroupAsync().then(function (state) {\n          can_join_official_group = state;\n        }).catch(function (err) {\n          console.error(err);\n        });\n\n        window.FBInstant.community.canGetLiveStreamsAsync().then(function (state) {\n          can_get_live_streams_overlay = state;\n        }).catch(function (err) {\n          console.error(err);\n        });\n      });\n    });\n  }).catch(function (e) {\n    console.warn('FBInstant initializeAsync failed', e);\n  });\n\n  FBInstant.onPause(() => {\n    callEach(on_pause);\n  });\n}\n","/* global XMLHttpRequest */\n\nconst assert = require('assert');\nconst { once } = require('glov/common/util.js');\n\nexport const ERR_CONNECTION = 'ERR_CONNECTION';\n\nconst regex_with_host = /\\/\\/[^/]+\\/([^?#]+)/;\nconst regex_no_host = /([^?#]+)/;\nfunction labelFromURL(url) {\n  let m = url.match(regex_with_host);\n  if (m) {\n    return m[1];\n  }\n  m = url.match(regex_no_host);\n  return m ? m[1] : url;\n}\n\nexport function fetch(params, cb) {\n  cb = once(cb);\n  let { method, url, response_type, label } = params;\n  method = method || 'GET';\n  assert(url);\n  label = label || labelFromURL(url);\n  let xhr = new XMLHttpRequest();\n  xhr.open(method, url, true);\n  if (response_type && response_type !== 'json') {\n    xhr.responseType = response_type;\n  }\n  xhr.onload = function () {\n    profilerStart(`fetch_onload:${label}`);\n    if (xhr.status !== 200 && xhr.status !== 0) {\n      let text;\n      try {\n        text = xhr.responseText;\n      } catch (e) {\n        // ignored\n      }\n      cb(String(xhr.status), text || '');\n    } else {\n      if (response_type === 'json') {\n        let text;\n        let obj;\n        try {\n          text = xhr.responseText;\n          obj = JSON.parse(text);\n        } catch (e) {\n          console.error(`Received invalid JSON response from ${url}: ${text || '<empty response>'}`);\n          // Probably internal server error or such as the server is restarting\n          cb(e);\n          profilerStop();\n          return;\n        }\n        cb(null, obj);\n      } else if (response_type === 'arraybuffer') {\n        if (xhr.response) {\n          cb(null, xhr.response);\n        } else {\n          cb('empty response');\n        }\n      } else {\n        cb(null, xhr.responseText);\n      }\n    }\n    profilerStop();\n  };\n  xhr.onerror = () => {\n    profilerStart(`fetch_onerror:${label}`);\n    cb(ERR_CONNECTION);\n    profilerStop();\n  };\n  xhr.send(null);\n}\n","const assert = require('assert');\n\nlet by_ext = {};\nlet by_match = [];\n\n// cb(filename)\nexport function filewatchOn(ext_or_search, cb) {\n  if (ext_or_search[0] === '.') {\n    assert(!by_ext[ext_or_search]);\n    by_ext[ext_or_search] = cb;\n  } else {\n    by_match.push([ext_or_search, cb]);\n  }\n}\n\nlet message_cb;\n// cb(message)\nexport function filewatchMessageHandler(cb) {\n  message_cb = cb;\n}\n\nfunction onFileChange(filename) {\n  console.log(`FileWatch change: ${filename}`);\n  let ext_idx = filename.lastIndexOf('.');\n  let did_reload = false;\n  if (ext_idx !== -1) {\n    let ext = filename.slice(ext_idx);\n    if (by_ext[ext]) {\n      if (by_ext[ext](filename) !== false) {\n        did_reload = true;\n      }\n    }\n  }\n  for (let ii = 0; ii < by_match.length; ++ii) {\n    if (filename.match(by_match[ii][0])) {\n      if (by_match[ii][1](filename) !== false) {\n        did_reload = true;\n      }\n    }\n  }\n  if (message_cb && did_reload) {\n    message_cb(`Reloading: ${filename}`);\n  }\n}\n\nexport function filewatchTriggerChange(filename) {\n  onFileChange(filename);\n}\n\nexport function filewatchStartup(client) {\n  client.onMsg('filewatch', onFileChange);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint no-bitwise:off, complexity:off, @typescript-eslint/no-shadow:off */\n\nexports.style = fontStyle; // eslint-disable-line no-use-before-define\nexports.styleColored = fontStyleColored; // eslint-disable-line no-use-before-define\nexports.styleAlpha = fontStyleAlpha; // eslint-disable-line no-use-before-define\nexports.create = fontCreate; // eslint-disable-line no-use-before-define\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst camera2d = require('./camera2d.js');\nconst engine = require('./engine.js');\nconst geom = require('./geom.js');\nconst { getStringFromLocalizable } = require('./localization.js');\nconst { max, round } = Math;\n// const settings = require('./settings.js');\nconst shaders = require('./shaders.js');\nconst sprites = require('./sprites.js');\nconst { BLEND_ALPHA, BLEND_PREMULALPHA, spriteChainedStart, spriteChainedStop, queueraw } = sprites;\nconst textures = require('./textures.js');\nconst { clamp } = require('glov/common/util.js');\nconst { v3scale, vec4, v4clone, v4copy, v4scale } = require('glov/common/vmath.js');\n\n/*\n\nfont_style = glov_font.style(null, {\n  color: 0xFFFFFFff,\n  outline_width: 0,\n  outline_color: 0x00000000,\n  glow_xoffs: 0,\n  glow_yoffs: 0,\n  glow_inner: 0,\n  glow_outer: 0,\n  glow_color: 0x000000ff,\n});\n\n */\n\n// typedef struct FontCharInfo {\n//   int c;\n//   float x0;\n//   float y0;\n//   int w;\n//   int h;\n//   int imgIdx;\n// } FontCharInfo;\n\n// typedef struct FontInfo {\n//   AS_NAME(CharInfo) FontCharInfo **char_infos;\n//   int font_size;\n//   float x0;\n//   float y0;\n//   int imageW;\n//   int imageH;\n//   int spread;\n// } FontInfo;\n\n// export const COLOR_MODE = {\n//   SINGLE: 0,\n//   GRADIENT: 1,\n// };\n\nexport const ALIGN = {\n  HLEFT: 0,\n  HCENTER: 1,\n  HRIGHT: 2,\n  HMASK: 3,\n\n  VTOP: 0 << 2,\n  VCENTER: 1 << 2,\n  VBOTTOM: 2 << 2,\n  VMASK: 3 << 2,\n\n  HFIT: 1 << 4,\n  HWRAP: 1 << 5,\n\n  HCENTERFIT: 1 | (1 << 4),\n  HRIGHTFIT: 2 | (1 << 4),\n  HVCENTER: 1 | (1 << 2), // to avoid doing bitwise ops elsewhere\n  HVCENTERFIT: 1 | (1 << 2) | (1 << 4), // to avoid doing bitwise ops elsewhere\n};\n\n\n// typedef struct GlovFontStyle\n// {\n//   // These members will never be changed (safe to initialize with GlovFontStyle foo = {1.0, 0xfff, etc};\n//   float outline_width;\n//   U32 outline_color;\n//   // Glow: can be used for a dropshadow as well\n//   //   inner can be negative to have the glow be less opaque (can also just change the alpha of the glow color)\n//   //   a glow would be e.g. (0, 0, -1, 5)\n//   //   a dropshadow would be e.g. (3.25, 3.25, -2.5, 5)\n//   float glow_xoffs;\n//   float glow_yoffs;\n//   float glow_inner;\n//   float glow_outer;\n//   U32 glow_color;\n//   U32 color; // upper left, or single color\n//   // U32 colorUR; // upper right\n//   // U32 colorLR; // lower right\n//   // U32 colorLL; // lower left\n//   // GlovFontColorMode color_mode;\n// } GlovFontStyle;\n\n/* Default GlovFontStyle:\n  font_style = {\n    outline_width: 0, outline_color: 0x00000000,\n    glow_xoffs: 0, glow_yoffs: 0, glow_inner: 0, glow_outer: 0, glow_color: 0x00000000,\n    color: 0xFFFFFFff\n  };\n\n  // font_style = {\n  //   outline_width: 0, outline_color: 0x00000000,\n  //   glow_xoffs: 0, glow_yoffs: 0, glow_inner: 0, glow_outer: 0, glow_color: 0x00000000,\n  //   // Color gradient: UL, UR, LR, LL\n  //   color: 0xFFFFFFff, colorUR: 0xFFFFFFff, colorLR: 0x000000ff, colorLL: 0x000000ff,\n  //   color_mode: glov_font.COLOR_MODE.GRADIENT,\n  // };\n*/\n\nfunction GlovFontStyle() {\n  // Not calling `vec4()` directly, since this constructor may be called during\n  //   initialization before our local `vec4` has been assigned.\n  this.color_vec4 = new Float32Array([1,1,1,1]); // Matches GlovFontStyle.prototype.color below\n}\nGlovFontStyle.prototype.outline_width = 0;\nGlovFontStyle.prototype.outline_color = 0x00000000;\nGlovFontStyle.prototype.glow_xoffs = 0;\nGlovFontStyle.prototype.glow_yoffs = 0;\nGlovFontStyle.prototype.glow_inner = 0;\nGlovFontStyle.prototype.glow_outer = 0;\nGlovFontStyle.prototype.glow_color = 0x00000000;\nGlovFontStyle.prototype.color = 0xFFFFFFff;\n// GlovFontStyle.prototype.colorUR = 0;\n// GlovFontStyle.prototype.colorLR = 0;\n// GlovFontStyle.prototype.colorLL = 0;\n// GlovFontStyle.prototype.color_mode = COLOR_MODE.SINGLE;\n\nexport const font_shaders = {};\n\nexport function intColorFromVec4Color(v) {\n  return ((v[0] * 255 | 0) << 24) |\n    ((v[1] * 255 | 0) << 16) |\n    ((v[2] * 255 | 0) << 8) |\n    ((v[3] * 255 | 0));\n}\n\nexport function vec4ColorFromIntColor(v, c) {\n  v[0] = ((c >> 24) & 0xFF) / 255;\n  v[1] = ((c >> 16) & 0xFF) / 255;\n  v[2] = ((c >> 8) & 0xFF) / 255;\n  v[3] = (c & 0xFF) / 255;\n}\n\nfunction vec4ColorFromIntColorPreMultiplied(v, c) {\n  let a = v[3] = (c & 0xFF) / 255;\n  a *= (1/255);\n  v[0] = ((c >> 24) & 0xFF) * a;\n  v[1] = ((c >> 16) & 0xFF) * a;\n  v[2] = ((c >> 8) & 0xFF) * a;\n}\n\nexport const glov_font_default_style = new GlovFontStyle();\n\nexport function fontStyle(font_style, fields) {\n  let ret = new GlovFontStyle();\n  let { color_vec4 } = ret;\n  if (font_style) {\n    for (let f in font_style) {\n      ret[f] = font_style[f];\n    }\n  }\n  for (let f in fields) {\n    ret[f] = fields[f];\n  }\n  ret.color_vec4 = color_vec4; // Restore\n  vec4ColorFromIntColor(ret.color_vec4, ret.color);\n  return ret;\n}\n\nexport function fontStyleColored(font_style, color) {\n  return fontStyle(font_style, {\n    color\n  });\n}\n\nfunction colorAlpha(color, alpha) {\n  alpha = clamp(round((color & 0xFF) * alpha), 0, 255);\n  return color & 0xFFFFFF00 | alpha;\n}\n\nexport function fontStyleAlpha(font_style, alpha) {\n  return fontStyle(font_style, {\n    color: colorAlpha((font_style || glov_font_default_style).color, alpha),\n    outline_color: colorAlpha((font_style || glov_font_default_style).outline_color, alpha),\n    glow_color: colorAlpha((font_style || glov_font_default_style).glow_color, alpha),\n  });\n}\n\nlet tech_params = null;\nlet tech_params_dirty = false;\nlet tech_params_cache = [];\nlet tech_params_cache_idx = 0;\nlet temp_color = vec4();\nlet geom_stats;\n\nfunction createTechniqueParameters() {\n  if (tech_params) {\n    return;\n  }\n\n  geom_stats = geom.stats;\n\n  tech_params = {\n    param0: vec4(),\n    outline_color: vec4(),\n    glow_color: vec4(),\n    glow_params: vec4(),\n  };\n}\n\nfunction techParamsSet(param, value) {\n  let tpv = tech_params[param];\n  // not dirty, if anything changes, we need a new object!\n  if (!tech_params_dirty) {\n    if (tpv[0] !== value[0] || tpv[1] !== value[1] || tpv[2] !== value[2] || tpv[3] !== value[3]) {\n      // clone\n      // PERFTODO: Should not be cloning these vec4s every frame!\n      //   Should use a pool of them, but need to reset the tech_param_cache each frame.\n      tech_params = {\n        param0: v4clone(tech_params.param0),\n        outline_color: v4clone(tech_params.outline_color),\n        glow_color: v4clone(tech_params.glow_color),\n        glow_params: v4clone(tech_params.glow_params),\n      };\n      geom_stats.font_params++;\n      tech_params_dirty = true;\n      tpv = tech_params[param];\n    } else {\n      // identical, do nothing\n      return;\n    }\n  }\n  if (tech_params_dirty) {\n    // just set\n    tpv[0] = value[0];\n    tpv[1] = value[1];\n    tpv[2] = value[2];\n    tpv[3] = value[3];\n    // return;\n  }\n}\n\nfunction sameTP(as) {\n  for (let key in tech_params) {\n    let v1 = tech_params[key];\n    let v2 = as[key];\n    for (let ii = 0; ii < 4; ++ii) {\n      if (v1[ii] !== v2[ii]) {\n        return false;\n      }\n    }\n  }\n  return true;\n}\n\nfunction techParamsGet() {\n  if (!tech_params_dirty) {\n    return tech_params;\n  }\n  tech_params_dirty = false;\n  for (let ii = 0; ii < tech_params_cache.length; ++ii) {\n    if (sameTP(tech_params_cache[ii])) {\n      tech_params = tech_params_cache[ii];\n      if (tech_params_cache_idx === ii) {\n        // about to be overwritten\n        tech_params_cache_idx = (tech_params_cache_idx + 1) % 4;\n      }\n      --geom_stats.font_params;\n      return tech_params;\n    }\n  }\n  tech_params_cache[tech_params_cache_idx] = tech_params;\n  tech_params_cache_idx = (tech_params_cache_idx + 1) % 4;\n  return tech_params;\n}\n\nfunction GlovFont(font_info, texture_name) {\n  assert(font_info.font_size !== 0); // Got lost somewhere\n\n  this.texture = textures.load({\n    url: `img/${texture_name}.png`,\n    filter_min: font_info.noFilter ? gl.NEAREST : gl.LINEAR,\n    filter_mag: font_info.noFilter ? gl.NEAREST : gl.LINEAR,\n    wrap_s: gl.CLAMP_TO_EDGE,\n    wrap_t: gl.CLAMP_TO_EDGE,\n  });\n  this.textures = [this.texture];\n\n  this.font_info = font_info;\n  this.shader = font_shaders.font_aa;\n  this.tex_w = font_info.imageW;\n  this.tex_h = font_info.imageH;\n\n  // Calculate inverse scale, fixup 0s\n  for (let ii = 0; ii < font_info.char_infos.length; ++ii) {\n    let char_info = font_info.char_infos[ii];\n    char_info.scale = 1 / (char_info.sc || 1);\n    char_info.w = char_info.w || 0;\n  }\n\n  // build lookup\n  this.char_infos = [];\n  for (let ii = 0; ii < font_info.char_infos.length; ++ii) {\n    let char_info = font_info.char_infos[ii];\n    this.char_infos[font_info.char_infos[ii].c] = char_info;\n    char_info.xpad = char_info.xpad || 0;\n    char_info.yoffs = char_info.yoffs || 0;\n  }\n  this.replacement_character = this.infoFromChar(0xFFFD);\n  if (!this.replacement_character) {\n    this.replacement_character = this.infoFromChar(63); // '?'\n  }\n  this.whitespace_character = this.infoFromChar(13);\n\n  this.default_style = new GlovFontStyle();\n  this.applied_style = new GlovFontStyle();\n\n  createTechniqueParameters();\n}\n\n// General draw functions return width\n// Pass NULL for style to use default style\n// If the function takes a color, this overrides the color on the style\nGlovFont.prototype.drawSizedColor = function (style, x, y, z, size, color, text) {\n  return this.drawSized(fontStyleColored(style, color), x, y, z, size, text);\n};\nGlovFont.prototype.drawSized = function (style, x, y, z, size, text) {\n  return this.drawScaled(style, x, y, z, size / this.font_info.font_size, size / this.font_info.font_size, text);\n};\n\nGlovFont.prototype.drawSizedAligned = function (style, _x, _y, z, size, align, w, h, text) {\n  profilerStartFunc();\n  text = getStringFromLocalizable(text);\n\n  if (align & ALIGN.HWRAP) {\n    let drawn_height = this.drawSizedAlignedWrapped(style, _x, _y, z, 0, size, align & ~ALIGN.HWRAP, w, h, text);\n    profilerStopFunc();\n    return drawn_height;\n  }\n  let x_size = size;\n  let y_size = size;\n  let width = this.getStringWidth(style, x_size, text);\n  if ((align & ALIGN.HFIT) && width > w) {\n    let scale = w / width;\n    x_size *= scale;\n    width = w;\n    // Additionally, if we're really squishing things horizontally, shrink the font size\n    // and offset to be centered.\n    if (scale < 0.5) {\n      if ((align & ALIGN.VMASK) !== ALIGN.VCENTER && (align & ALIGN.VMASK) !== ALIGN.VBOTTOM) {\n        // Offset to be roughly centered in the original line bounds\n        _y += (y_size - (y_size * scale * 2)) / 2;\n      }\n      y_size *= scale * 2;\n    }\n  }\n  let height = y_size;\n  let x;\n  let y;\n  switch (align & ALIGN.HMASK) {\n    case ALIGN.HCENTER:\n      x = _x + (w - width) / 2;\n      if (this.font_info.noFilter) {\n        x |= 0; // ensure integral - TODO: often only want this for pixely = strict modes?\n      }\n      break;\n    case ALIGN.HRIGHT:\n      x = _x + w - width;\n      break;\n    case ALIGN.HLEFT:\n      x = _x;\n      break;\n    default:\n      x = _x;\n  }\n  switch (align & ALIGN.VMASK) {\n    case ALIGN.VCENTER:\n      y = _y + (h - height) / 2;\n      if (this.font_info.noFilter) {\n        y |= 0; // ensure integral\n      }\n      break;\n    case ALIGN.VBOTTOM:\n      y = _y + h - height;\n      break;\n    case ALIGN.VTOP:\n      y = _y;\n      break;\n    default:\n      y = _y;\n  }\n\n  let drawn_width = this.drawScaled(\n    style, x, y, z,\n    x_size / this.font_info.font_size, y_size / this.font_info.font_size,\n    text);\n  profilerStopFunc();\n  return drawn_width;\n};\n\nGlovFont.prototype.drawSizedAlignedWrapped = function (style, x, y, z, indent, size, align, w, h, text) {\n  text = getStringFromLocalizable(text);\n  assert(w > 0);\n  assert(typeof h !== 'string'); // Old API did not have `indent` parameter\n  let lines = [];\n  let line_xoffs = [];\n  lines.length = this.wrapLines(style, w, indent, size, text, align, (xoffs, linenum, line) => {\n    line_xoffs[linenum] = xoffs;\n    lines[linenum] = line;\n  });\n\n  let yoffs = 0;\n  let height = size * lines.length;\n  // eslint-disable-next-line default-case\n  switch (align & ALIGN.VMASK) {\n    case ALIGN.VCENTER:\n      yoffs = (h - height) / 2;\n      if (this.font_info.noFilter) {\n        yoffs |= 0; // ensure integral\n      }\n      break;\n    case ALIGN.VBOTTOM:\n      yoffs = h - height;\n      break;\n  }\n  align &= ~ALIGN.VMASK;\n\n  for (let ii = 0; ii < lines.length; ++ii) {\n    let line = lines[ii];\n    if (line && line.trim()) {\n      this.drawSizedAligned(style, x + line_xoffs[ii], y + yoffs, z, size, align, w - line_xoffs[ii], 0, line);\n    }\n    yoffs += size;\n  }\n  return yoffs;\n};\n\n// returns height\nGlovFont.prototype.drawSizedColorWrapped = function (style, x, y, z, w, indent, size, color, text) {\n  return this.drawScaledWrapped(fontStyleColored(style, color), x, y, z, w,\n    indent, size / this.font_info.font_size, size / this.font_info.font_size, text);\n};\nGlovFont.prototype.drawSizedWrapped = function (style, x, y, z, w, indent, size, text) {\n  return this.drawScaledWrapped(style, x, y, z, w,\n    indent, size / this.font_info.font_size, size / this.font_info.font_size, text);\n};\n\nlet default_size = 24;\nexport function fontSetDefaultSize(h) {\n  default_size = h;\n}\n\nGlovFont.prototype.draw = function (param) {\n  let { style, color, alpha, x, y, z, size, w, h, align, text, indent } = param;\n  if (color) {\n    style = fontStyleColored(style, color);\n  }\n  if (alpha !== undefined) {\n    style = fontStyleAlpha(style, alpha);\n  }\n  indent = indent || 0;\n  size = size || default_size;\n  z = z || Z.UI;\n  if (align) {\n    if (align & ALIGN.HWRAP) {\n      return this.drawSizedAlignedWrapped(style, x, y, z, indent, size, align & ~ALIGN.HWRAP, w, h, text);\n    }\n    return this.drawSizedAligned(style, x, y, z, size, align, w || 0, h || 0, text);\n  } else {\n    return this.drawSized(style, x, y, z, size, text);\n  }\n};\n\n// line_cb(x0, int linenum, const char *line, x1)\nGlovFont.prototype.wrapLines = function (style, w, indent, size, text, align, line_cb) {\n  assert(typeof style !== 'number'); // old API did not have `style` parameter\n  this.applyStyle(style);\n  return this.wrapLinesScaled(w, indent, size / this.font_info.font_size, text, align, line_cb);\n};\n\nGlovFont.prototype.numLines = function (style, w, indent, size, text) {\n  return this.wrapLines(style, w, indent, size, text, 0);\n};\n\nGlovFont.prototype.dims = function (style, w, indent, size, text) {\n  let max_x1 = 0;\n  function lineCallback(ignored1, ignored2, line, x1) {\n    max_x1 = max(max_x1, x1);\n  }\n  let numlines = this.wrapLines(style, w, indent, size, text, 0, lineCallback);\n  return {\n    w: max_x1,\n    h: numlines * size,\n  };\n};\n\nGlovFont.prototype.infoFromChar = function (c) {\n  let ret = this.char_infos[c];\n  if (ret) {\n    return ret;\n  }\n  if (c >= 9 && c <= 13) { // characters that String.trim() strip\n    return this.whitespace_character;\n  }\n  // no char info, not whitespace, show replacement even if ascii, control code\n  return this.replacement_character;\n};\n\nGlovFont.prototype.getCharacterWidth = function (style, x_size, c) {\n  assert.equal(typeof c, 'number');\n  this.applyStyle(style);\n  let char_info = this.infoFromChar(c);\n  let xsc = x_size / this.font_info.font_size;\n  let x_advance = this.calcXAdvance(xsc);\n  if (char_info) {\n    return (char_info.w + char_info.xpad) * xsc * char_info.scale + x_advance;\n  }\n  return 0;\n};\n\nGlovFont.prototype.getStringWidth = function (style, x_size, text) {\n  text = getStringFromLocalizable(text);\n\n  this.applyStyle(style);\n  let ret=0;\n  let xsc = x_size / this.font_info.font_size;\n  let x_advance = this.calcXAdvance(xsc);\n  for (let ii = 0; ii < text.length; ++ii) {\n    let c = text.charCodeAt(ii);\n    let char_info = this.infoFromChar(c);\n    if (char_info) {\n      ret += (char_info.w + char_info.xpad) * xsc * char_info.scale + x_advance;\n    }\n  }\n  return ret;\n};\n\nGlovFont.prototype.getSpaceSize = function (xsc) {\n  let space_info = this.infoFromChar(32); // ' '\n  return (space_info ? (space_info.w + space_info.xpad) * space_info.scale : this.font_info.font_size) * xsc;\n};\n\nfunction endsWord(char_code) {\n  return char_code === 32 || // ' '\n    char_code === 0 || // end of string\n    char_code === 10 || // '\\n'\n    char_code === 9; // '\\t'\n}\n\n// line_cb(x0, int linenum, const char *line, x1)\nGlovFont.prototype.wrapLinesScaled = function (w, indent, xsc, text, align, line_cb) {\n  text = getStringFromLocalizable(text);\n  assert(typeof align !== 'function'); // Old API had one less parameter\n  const len = text.length;\n  const max_word_w = w - indent;\n  // \"fit\" mode: instead of breaking the too-long word, output it on a line of its own\n  const hard_wrap_mode_fit = align & ALIGN.HFIT;\n  const x_advance = this.calcXAdvance(xsc);\n  const space_size = this.getSpaceSize(xsc) + x_advance;\n  let idx = 0;\n  let line_start = 0;\n  let line_x0 = 0;\n  let line_x1 = 0;\n  let line_end = -1;\n  let word_start = 0;\n  let word_x0 = 0;\n  let word_w = 0;\n  let word_slice = -1;\n  let word_slice_w = 0;\n  let linenum = 0;\n\n  function flushLine() {\n    if (line_end !== -1 && line_cb) {\n      line_cb(line_x0, linenum, text.slice(line_start, line_end), line_x1);\n    }\n    linenum++;\n    line_x0 = indent;\n    line_x1 = -1;\n    line_start = word_start;\n    line_end = -1;\n    word_x0 = line_x0;\n  }\n\n  do {\n    let c = idx < len ? text.charCodeAt(idx) || 0xFFFD : 0;\n    if (endsWord(c)) {\n      if (word_start !== idx) {\n        let need_line_flush = false;\n        // flush word, take care of space on next loop\n        if (word_x0 + word_w <= w) {\n          // fits fine, add to line, start new word\n        } else if (word_w > max_word_w && !hard_wrap_mode_fit) {\n          // even just this word alone won't fit, needs a hard wrap\n          // output what fits on this line, then continue to next line\n          need_line_flush = true;\n          if (word_slice === -1) {\n            // not even a single letter fits on this line\n            if (line_end !== -1) {\n              // wrap to a new line if not already\n              flushLine();\n            }\n            // just output one letter, start new word from second letter\n            idx = line_start + 1;\n            word_w = max_word_w; // underestimate\n          } else {\n            // output what fits on this line so far\n            idx = word_slice;\n            word_w = word_slice_w;\n          }\n        } else {\n          // won't fit, but fits on next line, soft wrap\n          if (line_end !== -1) {\n            flushLine();\n          }\n        }\n        //addWord();\n        line_end = idx;\n        line_x1 = word_x0 + word_w;\n        word_x0 = line_x1;\n        word_w = 0;\n        word_start = idx;\n        word_slice = -1;\n\n        if (need_line_flush) {\n          flushLine();\n        }\n\n        // we're now either still pointing at the space, or rewound to an earlier point\n        continue;\n      } else {\n        // process the space\n        word_start = idx + 1;\n        word_x0 += space_size;\n        if (c === 10) { // \\n\n          flushLine();\n        }\n      }\n    } else {\n      let char_info = this.infoFromChar(c);\n      if (char_info) {\n        let char_w = (char_info.w + char_info.xpad) * xsc * char_info.scale + x_advance;\n        word_w += char_w;\n        if (word_x0 + word_w <= w) { // would partially fit up to and including this letter\n          word_slice = idx + 1;\n          word_slice_w = word_w;\n        }\n      }\n    }\n    ++idx;\n  } while (idx <= len);\n  if (line_end !== -1) {\n    flushLine();\n  }\n\n  return linenum;\n};\n\nGlovFont.prototype.drawScaledWrapped = function (style, x, y, z, w, indent, xsc, ysc, text) {\n  if (text === null || text === undefined) {\n    text = '(null)';\n  }\n  assert(w > 0);\n  this.applyStyle(style);\n  // This function returns height instead of width, so leave the maximum width encountered here for caller\n  this.last_width = 0;\n  let num_lines = this.wrapLinesScaled(w, indent, xsc, text, 0, (xoffs, linenum, line, x1) => {\n    let y2 = y + this.font_info.font_size * ysc * linenum;\n    let x2 = x + xoffs;\n    this.drawScaled(style, x2, y2, z, xsc, ysc, line);\n    this.last_width = max(this.last_width, x1);\n  });\n  return num_lines * this.font_info.font_size * ysc;\n};\n\nGlovFont.prototype.calcXAdvance = function (xsc) {\n  // Assume called: applyStyle(style);\n\n  // scale all supplied values by this so that if we swap in a font with twice the resolution (and twice the spread)\n  //   things look almost identical, just crisper\n  let font_texel_scale = this.font_info.font_size / 32;\n  // As a compromise, -2 bias here seems to work well\n  let x_advance = round(xsc * font_texel_scale * max(this.applied_style.outline_width - 2, 0));\n  // As a compromise, there's a -3 bias in there, so it only kicks in under extreme circumstances\n  x_advance = max(x_advance, xsc * font_texel_scale *\n    max(this.applied_style.glow_outer - this.applied_style.glow_xoffs - 3, 0));\n  return x_advance;\n};\n\n//////////////////////////////////////////////////////////////////////////\n// Main implementation\n\nGlovFont.prototype.drawScaled = function (style, _x, y, z, xsc, ysc, text) {\n  profilerStartFunc();\n  text = getStringFromLocalizable(text);\n  let x = _x;\n  assert(isFinite(x));\n  assert(isFinite(y));\n  assert(isFinite(z));\n  let font_info = this.font_info;\n  // Debug: show expect area of glyphs\n  // require('./ui.js').drawRect(_x, y,\n  //   _x + xsc * font_info.font_size * 20, y + ysc * font_info.font_size,\n  //   1000, [1, 0, 1, 0.5]);\n  y += (font_info.y_offset || 0) * ysc;\n  let texs = this.textures;\n  if (text === null || text === undefined) {\n    text = '(null)';\n  }\n  const len = text.length;\n  if (xsc === 0 || ysc === 0) {\n    profilerStopFunc();\n    return 0;\n  }\n\n  geom_stats.font_calls++;\n\n  this.applyStyle(style);\n\n  let blend_mode = engine.defines.NOPREMUL ? BLEND_ALPHA : BLEND_PREMULALPHA;\n\n  const avg_scale_font = (xsc + ysc) * 0.5;\n  const camera_xscale = camera2d.data[4];\n  const camera_yscale = camera2d.data[5];\n  let avg_scale_combined = (xsc * camera_xscale + ysc * camera_yscale) * 0.5;\n  // Not doing this here, because render_scale_all is not currently reflected in camera_x/yscale\n  // avg_scale_combined *= settings.render_scale_all;\n\n  // scale all supplied values by this so that if we swap in a font with twice the resolution (and twice the spread)\n  //   things look almost identical, just crisper\n  let x_advance = this.calcXAdvance(xsc);\n  let font_texel_scale = font_info.font_size / 32;\n  let tile_state = 0;\n\n  let applied_style = this.applied_style;\n\n  // Calculate anti-aliasing values\n  let delta_per_source_pixel = 0.5 / font_info.spread;\n  let delta_per_dest_pixel = delta_per_source_pixel / avg_scale_combined;\n  let value = vec4(\n    1 / delta_per_dest_pixel, // AA Mult and Outline Mult\n    -0.5 / delta_per_dest_pixel + 0.5, // AA Add\n    // Outline Add\n    -0.5 / delta_per_dest_pixel + 0.5 + applied_style.outline_width*font_texel_scale*avg_scale_combined,\n    0, // Unused\n  );\n  if (value[2] > 0) {\n    value[2] = 0;\n  }\n  let padding1 = max(0, applied_style.outline_width*font_texel_scale*avg_scale_font);\n  let padding4 = vec4();\n  const outer_scaled = applied_style.glow_outer*font_texel_scale;\n  padding4[0] = max(outer_scaled*xsc - applied_style.glow_xoffs*font_texel_scale*xsc, padding1);\n  padding4[2] = max(outer_scaled*xsc + applied_style.glow_xoffs*font_texel_scale*xsc, padding1);\n  padding4[1] = max(outer_scaled*ysc - applied_style.glow_yoffs*font_texel_scale*ysc, padding1);\n  padding4[3] = max(outer_scaled*ysc + applied_style.glow_yoffs*font_texel_scale*ysc, padding1);\n\n  techParamsSet('param0', value);\n  let value2 = vec4(\n    0, // filled later\n    0, // filled later\n    // Glow mult\n    1 / ((applied_style.glow_outer - applied_style.glow_inner) * delta_per_source_pixel * font_texel_scale),\n    -(0.5 - applied_style.glow_outer * delta_per_source_pixel * font_texel_scale) / ((applied_style.glow_outer -\n      applied_style.glow_inner) * delta_per_source_pixel * font_texel_scale)\n  );\n  if (value2[3] > 0) {\n    value2[3] = 0;\n  }\n\n  let padding_in_font_space = vec4();\n  v4scale(padding_in_font_space, padding4, 1 / avg_scale_font);\n  for (let ii = 0; ii < 4; ++ii) {\n    if (padding_in_font_space[ii] > font_info.spread) {\n      // Not enough buffer\n      let sc = font_info.spread / padding_in_font_space[ii];\n      padding4[ii] *= sc;\n      padding_in_font_space[ii] *= sc;\n    }\n  }\n\n  // Choose appropriate z advance so that character are drawn left to right (or RTL if the glow is on the other side)\n  // same Z should be drawn in queue order, so not needed\n  const z_advance = applied_style.glow_xoffs < 0 ? -0.0001 : 0; // 0.0001;\n  if (!z_advance) {\n    spriteChainedStart();\n  }\n\n  const has_glow_offs = applied_style.glow_xoffs || applied_style.glow_yoffs;\n  if (!has_glow_offs) {\n    value2[0] = value2[1] = 0;\n    techParamsSet('glow_params', value2);\n    techParamsGet();\n  }\n\n  // For non-1:1 aspect ration rendering, need to scale our coordinates' padding differently in each axis\n  let rel_x_scale = xsc / avg_scale_font;\n  let rel_y_scale = ysc / avg_scale_font;\n\n  let sort_y = (y - camera2d.data[1]) * camera2d.data[5];\n\n  for (let i=0; i<len; i++) {\n    const c = text.charCodeAt(i);\n    if (c === 9) { // '\\t'.charCodeAt(0)) {\n      let tabsize = xsc * font_info.font_size * 4;\n      x = ((((x - _x) / tabsize) | 0) + 1) * tabsize + _x;\n    } else {\n      let char_info = this.infoFromChar(c);\n      if (char_info) {\n        let char_scale = char_info.scale;\n        let xsc2 = xsc * char_scale;\n        if (char_info.w) {\n          let ysc2 = ysc * char_scale;\n          let pad_scale = 1 / char_scale;\n          let tile_width = this.tex_w;\n          let tile_height = this.tex_h;\n          // Lazy update params here\n          if (has_glow_offs && char_scale !== tile_state) {\n            value2[0] = -applied_style.glow_xoffs * font_texel_scale * pad_scale / tile_width;\n            value2[1] = -applied_style.glow_yoffs * font_texel_scale * pad_scale / tile_height;\n            techParamsSet('glow_params', value2);\n            if (!z_advance) {\n              spriteChainedStop();\n              spriteChainedStart();\n            }\n            techParamsGet();\n            tile_state = char_scale;\n          }\n\n          let u0 = (char_info.x0 - padding_in_font_space[0] * pad_scale) / tile_width;\n          let u1 = (char_info.x0 + char_info.w + padding_in_font_space[2] * pad_scale) / tile_width;\n          let v0 = (char_info.y0 - padding_in_font_space[1] * pad_scale) / tile_height;\n          let v1 = (char_info.y0 + char_info.h + padding_in_font_space[3] * pad_scale) / tile_height;\n\n          let w = char_info.w * xsc2 + (padding4[0] + padding4[2]) * rel_x_scale;\n          let h = char_info.h * ysc2 + (padding4[1] + padding4[3]) * rel_y_scale;\n\n          let xx = x - rel_x_scale * padding4[0];\n          let yy = y - rel_y_scale * padding4[2] + char_info.yoffs * ysc2;\n          let elem = queueraw(\n            texs,\n            xx, yy,\n            z + z_advance * i, w, h,\n            u0, v0, u1, v1,\n            applied_style.color_vec4,\n            this.shader, tech_params, blend_mode);\n          elem.y = sort_y;\n\n          // require('./ui.js').drawRect(xx, yy, xx + w, yy + h,\n          //   1000, [i & 1, (i & 2)>>1, (i & 4)>>2, 0.5]);\n        }\n\n        x += (char_info.w + char_info.xpad) * xsc2 + x_advance;\n      }\n    }\n  }\n  if (!z_advance) {\n    spriteChainedStop();\n  }\n  profilerStopFunc();\n  return x - _x;\n};\n\nGlovFont.prototype.determineShader = function () {\n  let outline = this.applied_style.outline_width && (this.applied_style.outline_color & 0xff);\n  let glow = this.applied_style.glow_outer > 0 && (this.applied_style.glow_color & 0xff);\n  if (outline) {\n    if (glow) {\n      this.shader = font_shaders.font_aa_outline_glow;\n    } else {\n      this.shader = font_shaders.font_aa_outline;\n    }\n  } else if (glow) {\n    this.shader = font_shaders.font_aa_glow;\n  } else {\n    this.shader = font_shaders.font_aa;\n  }\n};\n\nGlovFont.prototype.applyStyle = function (style) {\n  if (!style) {\n    style = this.default_style;\n  }\n  if (engine.defines.NOPREMUL) {\n    // outline\n    vec4ColorFromIntColor(temp_color, style.outline_color);\n    techParamsSet('outline_color', temp_color);\n\n    // glow\n    vec4ColorFromIntColor(temp_color, style.glow_color);\n    techParamsSet('glow_color', temp_color);\n  } else {\n    // outline\n    vec4ColorFromIntColorPreMultiplied(temp_color, style.outline_color);\n    techParamsSet('outline_color', temp_color);\n\n    // glow\n    vec4ColorFromIntColorPreMultiplied(temp_color, style.glow_color);\n    techParamsSet('glow_color', temp_color);\n  }\n\n  // everything else\n  this.applied_style.outline_width = style.outline_width;\n  this.applied_style.outline_color = style.outline_color;\n  this.applied_style.glow_xoffs = style.glow_xoffs;\n  this.applied_style.glow_yoffs = style.glow_yoffs;\n  this.applied_style.glow_inner = style.glow_inner;\n  this.applied_style.glow_outer = style.glow_outer;\n  this.applied_style.glow_color = style.glow_color;\n  this.applied_style.color = style.color;\n  if (engine.defines.NOPREMUL) {\n    v4copy(this.applied_style.color_vec4, style.color_vec4);\n  } else {\n    let alpha = this.applied_style.color_vec4[3] = style.color_vec4[3];\n    v3scale(this.applied_style.color_vec4, style.color_vec4, alpha);\n  }\n  // this.applied_style.colorUR = style.colorUR;\n  // this.applied_style.colorLR = style.colorLR;\n  // this.applied_style.colorLL = style.colorLL;\n  // this.applied_style.color_mode = style.color_mode;\n\n  // if (this.applied_style.color_mode === COLOR_MODE.SINGLE) {\n  //   this.applied_style.colorUR = this.applied_style.colorLL = this.applied_style.colorLR = this.applied_style.color;\n  // }\n\n  this.determineShader();\n};\n\n// Replicate constants and utility functions on all font instances as well\n// GlovFont.prototype.COLOR_MODE = COLOR_MODE;\nGlovFont.prototype.ALIGN = ALIGN;\nGlovFont.prototype.style = fontStyle;\nGlovFont.prototype.styleAlpha = fontStyleAlpha;\nGlovFont.prototype.styleColored = fontStyleColored;\n\nfunction fontShadersInit() {\n  if (font_shaders.font_aa) {\n    return;\n  }\n  font_shaders.font_aa = shaders.create('shaders/font_aa.fp');\n  font_shaders.font_aa_glow = shaders.create('shaders/font_aa_glow.fp');\n  font_shaders.font_aa_outline = shaders.create('shaders/font_aa_outline.fp');\n  font_shaders.font_aa_outline_glow = shaders.create('shaders/font_aa_outline_glow.fp');\n  shaders.prelink(sprites.sprite_vshader, font_shaders.font_aa);\n  shaders.prelink(sprites.sprite_vshader, font_shaders.font_aa_glow);\n  shaders.prelink(sprites.sprite_vshader, font_shaders.font_aa_outline);\n  shaders.prelink(sprites.sprite_vshader, font_shaders.font_aa_outline_glow);\n}\n\nexport function fontCreate(font_info, texture_name) {\n  fontShadersInit();\n  return new GlovFont(font_info, texture_name);\n}\n","const assert = require('assert');\nconst { is_ios } = require('./browser.js');\nconst { cmd_parse } = require('./cmds.js');\nconst { applyCopy } = require('./effects.js');\nconst engine = require('./engine.js');\nconst { renderWidth, renderHeight } = engine;\nconst perf = require('./perf.js');\nconst settings = require('./settings.js');\nconst textures = require('./textures.js');\n\nlet last_num_passes = 0;\nlet num_passes = 0;\n\nlet temporary_textures = {};\nlet temporary_depthbuffers = {};\nlet temporary_depthtextures = {};\n\nlet reset_fbos = false;\nfunction resetFBOs() {\n  reset_fbos = true;\n}\n\nlet skip_release = false;\nexport function framebufferSkipRelease() {\n  // Skip releases for one frame, we're making a temporary change for a screenshot/etc\n  skip_release = true;\n}\n\nlet last_temp_idx = 0;\nfunction getTemporaryTexture(w, h, possibly_fbo) {\n  let key = `${w}_${h}`;\n  let is_fbo = possibly_fbo && settings.use_fbos;\n  if (is_fbo) {\n    key += '_fbo';\n  }\n  let temp = temporary_textures[key];\n  if (!temp) {\n    temp = temporary_textures[key] = { list: [], idx: 0 };\n  }\n  if (temp.idx >= temp.list.length) {\n    let tex = textures.createForCapture(`temp_${key}_${++last_temp_idx}`);\n    if (is_fbo) {\n      tex.allocFBO(w, h);\n    }\n    temp.list.push(tex);\n  }\n  let tex = temp.list[temp.idx++];\n  return tex;\n}\n\nfunction bindTemporaryDepthbuffer(w, h) {\n  let key = `${w}_${h}`;\n  let temp = temporary_depthbuffers[key];\n  if (!temp) {\n    temp = temporary_depthbuffers[key] = { list: [], idx: 0 };\n  }\n  if (temp.idx >= temp.list.length) {\n    let depth_buffer = gl.createRenderbuffer();\n    gl.bindRenderbuffer(gl.RENDERBUFFER, depth_buffer);\n    let attachment;\n    if (settings.fbo_depth16) {\n      gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, w, h);\n      attachment = gl.DEPTH_ATTACHMENT;\n    } else {\n      gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_STENCIL, w, h);\n      attachment = gl.DEPTH_STENCIL_ATTACHMENT;\n    }\n    gl.bindRenderbuffer(gl.RENDERBUFFER, null);\n    temp.list.push({ depth_buffer, attachment });\n  }\n  let { depth_buffer, attachment } = temp.list[temp.idx++];\n  gl.framebufferRenderbuffer(gl.FRAMEBUFFER, attachment, gl.RENDERBUFFER, depth_buffer);\n}\n\nfunction bindTemporaryDepthbufferTexture(w, h) {\n  let key = `${w}_${h}`;\n  let temp = temporary_depthtextures[key];\n  if (!temp) {\n    temp = temporary_depthtextures[key] = { list: [], idx: 0 };\n  }\n  if (temp.idx >= temp.list.length) {\n    let tex = textures.createForDepthCapture(`temp_${key}_${++last_temp_idx}`,\n      settings.fbo_depth16 ? textures.format.DEPTH16 : textures.format.DEPTH24);\n    tex.allocDepth(w, h);\n    let attachment = settings.fbo_depth16 ? gl.DEPTH_ATTACHMENT : gl.DEPTH_STENCIL_ATTACHMENT;\n\n    temp.list.push({ tex, attachment });\n  }\n  let { tex, attachment } = temp.list[temp.idx++];\n  gl.framebufferTexture2D(gl.FRAMEBUFFER, attachment, gl.TEXTURE_2D, tex.handle, 0);\n  return tex;\n}\n\nexport function temporaryTextureClaim(tex) {\n  for (let key in temporary_textures) {\n    let temp = temporary_textures[key];\n    let idx = temp.list.indexOf(tex);\n    if (idx !== -1) {\n      temp.list.splice(idx, 1);\n      if (temp.idx > idx) {\n        --temp.idx;\n      }\n      return;\n    }\n  }\n  assert(false);\n}\n\n// Call tex.captureEnd when done\nfunction framebufferCaptureStart(tex, w, h, possibly_fbo) {\n  assert.equal(engine.viewport[0], 0); // maybe allow/require setting viewport *after* starting capture instead?\n  assert.equal(engine.viewport[1], 0);\n  if (!w) {\n    w = renderWidth();\n    h = renderHeight();\n  }\n  if (!tex) {\n    tex = getTemporaryTexture(w, h, possibly_fbo);\n  }\n  tex.captureStart(w, h);\n  return tex;\n}\n\n// Does a capture directly from the framebuffer regardless of current use_fbos setting\n// Warning: Slow on iOS\nexport function framebufferCapture(tex, w, h, filter_linear, wrap) {\n  tex = framebufferCaptureStart(tex, w, h, false);\n  tex.captureEnd(filter_linear, wrap);\n  return tex;\n}\n\n\nlet cur_tex;\nlet cur_depth;\nexport function framebufferStart(opts) {\n  assert(!cur_tex);\n  assert(!cur_depth);\n  let { width, height, viewport, final, clear, need_depth, clear_all, clear_color, force_tex } = opts;\n  ++num_passes;\n  cur_depth = null;\n  if (force_tex) {\n    assert(viewport);\n    cur_tex = force_tex;\n    cur_tex.captureStart();\n  } else if (!final) {\n    cur_tex = framebufferCaptureStart(null, width, height, true);\n    if (settings.use_fbos) {\n      if (need_depth) {\n        if (need_depth === 'texture') {\n          cur_depth = bindTemporaryDepthbufferTexture(width, height);\n        } else {\n          bindTemporaryDepthbuffer(width, height);\n        }\n      } else {\n        // testing: force unbind, in case one was left bound\n        // gl.framebufferRenderbuffer(gl.FRAMEBUFFER, settings.fbo_depth16 ?\n        //   gl.DEPTH_ATTACHMENT : gl.DEPTH_STENCIL_ATTACHMENT, gl.RENDERBUFFER, null);\n      }\n    }\n  }\n  if (clear_color) {\n    gl.clearColor(clear_color[0], clear_color[1], clear_color[2], clear_color[3]);\n  }\n  if (clear && clear_all) {\n    // full clear, before setting viewport\n    gl.disable(gl.SCISSOR_TEST);\n    gl.clear(gl.COLOR_BUFFER_BIT | (need_depth ? gl.DEPTH_BUFFER_BIT : 0));\n  }\n  let need_scissor;\n  if (viewport) {\n    engine.setViewport(viewport);\n    need_scissor = viewport[0] || viewport[1] || viewport[2] !== engine.width || viewport[3] !== engine.height;\n    if (clear_all) { // not sure this logically follows, but we want this anywhere we're clearing all currently\n      need_scissor = false;\n    }\n  } else {\n    engine.setViewport([0, 0, width, height]);\n    need_scissor = width !== engine.width;\n  }\n  if (need_scissor) { // Note: previously `&& !settings.use_fbos`, but that seems wrong, why was it there?\n    gl.enable(gl.SCISSOR_TEST);\n    if (viewport) {\n      gl.scissor(viewport[0], viewport[1], viewport[2], viewport[3]);\n    } else {\n      gl.scissor(0, 0, width, height);\n    }\n  } else {\n    gl.disable(gl.SCISSOR_TEST);\n  }\n  if (clear && !clear_all) {\n    gl.clear(gl.COLOR_BUFFER_BIT | (need_depth ? gl.DEPTH_BUFFER_BIT : 0));\n  }\n}\n\nexport function framebufferEnd(opts) {\n  assert(cur_tex);\n  opts = opts || {};\n  let { filter_linear, wrap, need_depth } = opts;\n  assert.equal(Boolean(cur_depth), need_depth === 'texture');\n\n  cur_tex.captureEnd(filter_linear, wrap);\n  // Capture end for depth texture?  Nope, only works with FBOs in WebGL!\n\n  let ret;\n  if (cur_depth) {\n    ret = [cur_tex, cur_depth];\n  } else {\n    ret = cur_tex;\n  }\n  cur_tex = null;\n  cur_depth = null;\n\n  return ret;\n}\n\nexport function framebufferTopOfFrame() {\n  // In case of crash on previous frame\n  cur_tex = null;\n  cur_depth = null;\n}\n\nexport function framebufferEndOfFrame() {\n  assert(!cur_tex);\n  last_num_passes = num_passes;\n  num_passes = 0;\n  skip_release = skip_release && !reset_fbos;\n\n  for (let key in temporary_textures) {\n    let temp = temporary_textures[key];\n    if (reset_fbos) {\n      // Release all textures\n      temp.idx = 0;\n    }\n    // Release unused textures\n    if (!skip_release) {\n      while (temp.list.length > temp.idx) {\n        temp.list.pop().destroy();\n      }\n    }\n    if (!temp.list.length) {\n      delete temporary_textures[key];\n    } else {\n      temp.idx = 0;\n    }\n  }\n  for (let key in temporary_depthbuffers) {\n    let temp = temporary_depthbuffers[key];\n    if (reset_fbos) {\n      // Release all renderbuffers\n      temp.idx = 0;\n    }\n    // Release unused renderbuffers\n    if (!skip_release) {\n      while (temp.list.length > temp.idx) {\n        let { depth_buffer } = temp.list.pop();\n        // TODO: can this still be bound to a framebuffer? unlikely, but possible?\n        gl.deleteRenderbuffer(depth_buffer);\n      }\n    }\n    if (!temp.list.length) {\n      delete temporary_depthbuffers[key];\n    } else {\n      temp.idx = 0;\n    }\n  }\n  for (let key in temporary_depthtextures) {\n    let temp = temporary_depthtextures[key];\n    if (reset_fbos) {\n      // Release all depth textures\n      temp.idx = 0;\n    }\n    // Release unused depth textures\n    if (!skip_release) {\n      while (temp.list.length > temp.idx) {\n        let { tex } = temp.list.pop();\n        tex.destroy();\n      }\n    }\n    if (!temp.list.length) {\n      delete temporary_depthtextures[key];\n    } else {\n      temp.idx = 0;\n    }\n  }\n  reset_fbos = false;\n  skip_release = false;\n}\n\nexport function framebufferUpdateCanvasForCapture() {\n  if (cur_tex && settings.use_fbos) {\n    let saved_tex = cur_tex;\n    let saved_viewport = engine.viewport.slice(0);\n    // copy to canvas\n    framebufferEnd();\n    applyCopy({\n      source: saved_tex,\n      final: true,\n      viewport: saved_viewport,\n    });\n    // resume rendering to framebuffer\n    framebufferStart({\n      force_tex: saved_tex,\n      viewport: saved_viewport,\n    });\n    return saved_tex; // just for .width/height\n  } else {\n    return { width: engine.viewport[2], height: engine.viewport[3] };\n  }\n}\n\nsettings.register({\n  show_passes: {\n    label: 'Show Postprocessing Passes',\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n  },\n  use_fbos: {\n    label: 'Use Framebuffer Objects for postprocessing',\n    default_value: is_ios ? 1 : 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n    ver: 1,\n  },\n  fbo_depth16: { // This had no effect on performance, tested on iPhone, Xperia or Intel GPU\n    label: 'Use 16-bit depth buffers for offscreen rendering',\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n    on_change: resetFBOs,\n  },\n  fbo_rgba: { // This had no effect on performance, tested on iPhone, Xperia or Intel GPU\n    label: 'Use RGBA color buffers for offscreen rendering',\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n    on_change: resetFBOs,\n  },\n});\nreset_fbos = false; // in case it was flagged while registering settings\n\nperf.addMetric({\n  name: 'passes',\n  show_stat: 'show_passes',\n  labels: {\n    'passes: ': () => last_num_passes.toString(),\n  },\n});\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint no-bitwise:off */\n\nconst assert = require('assert');\nconst { cmd_parse } = require('./cmds.js');\nconst engine = require('./engine.js');\nconst perf = require('./perf.js');\nconst settings = require('./settings.js');\nconst { MAX_SEMANTIC } = require('./shaders.js');\nconst { ceil, max, min } = Math;\n\nexport const TRIANGLES = 4;\nexport const TRIANGLE_FAN = 6;\nexport const QUADS = 7;\n\nconst MAX_VERT_COUNT = 65536 - 4; // WebGL2 treats 65535 as \"primitive restart\" and also dies on iOS 15\n\nsettings.register({\n  show_render_stats: {\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n  },\n});\n\nexport let stats = {\n  draw_calls: 0,\n  draw_calls_geom: 0,\n  draw_calls_sprite: 0,\n  tris: 0,\n  verts: 0,\n  sprites: 0,\n  sprite_sort_elems: 0,\n  sprite_sort_cmps: 0,\n  font_calls: 0,\n  font_params: 0,\n};\nlet last_stats = {};\nlet perf_labels = {};\nfor (let key in stats) {\n  perf_labels[`${key}: `] = () => String(last_stats[key]);\n}\nperf.addMetric({\n  name: 'render_stats',\n  show_stat: 'show_render_stats',\n  show_all: true,\n  labels: perf_labels,\n});\n\n\nconst gl_byte_size = {\n  0x1400: 1, // GL_BYTE\n  0x1401: 1, // GL_UNSIGNED_BYTE\n  0x1402: 2, // GL_SHORT\n  0x1403: 2, // GL_UNSIGNED_SHORT\n  0x1406: 4, // GL_FLOAT\n};\n\n// let unit_buf;\n// let unit_buf_len = 0;\n\nlet bound_geom;\n\nlet bound_array_buf = null;\nlet bound_index_buf = null;\n\nlet quad_index_buf;\nlet quad_index_buf_len = 0;\n\nfunction deleteBuffer(handle) {\n  if (!handle) {\n    return;\n  }\n  if (bound_array_buf === handle) {\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\n    bound_array_buf = null;\n  }\n  if (bound_index_buf === handle) {\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n    bound_index_buf = null;\n  }\n  gl.deleteBuffer(handle);\n}\n\nlet attrib_enabled = 0;\nfunction enableVertexAttribArray(bits) {\n  if (bits === attrib_enabled) {\n    return;\n  }\n  let disable_mask = (attrib_enabled & (~bits));\n  let enable_mask = ((~attrib_enabled) & bits);\n  attrib_enabled = bits;\n\n  if (disable_mask) {\n    let n = 0;\n    do {\n      if (disable_mask & 1) {\n        gl.disableVertexAttribArray(n);\n      }\n      n++;\n      disable_mask >>= 1;\n    } while (disable_mask);\n  }\n\n  if (enable_mask) {\n    let n = 0;\n    do {\n      if (enable_mask & 1) {\n        gl.enableVertexAttribArray(n);\n      }\n      n++;\n      enable_mask >>= 1;\n    } while (enable_mask);\n  }\n}\n\n// function bindUnitBuf(arr_idx, len) {\n//   if (len > unit_buf_len) {\n//     deleteBuffer(unit_buf);\n//     unit_buf = gl.createBuffer();\n//     unit_buf_len = max(ceil(unit_buf_len * 1.5), len);\n//     gl.bindBuffer(gl.ARRAY_BUFFER, unit_buf);\n//     bound_array_buf = unit_buf;\n//     let arr = new Uint8Array(unit_buf_len * 4);\n//     for (let ii = 0; ii < unit_buf_len * 4; ++ii) {\n//       arr[ii] = 255;\n//     }\n//     gl.bufferData(gl.ARRAY_BUFFER, arr, gl.STATIC_DRAW);\n//   } else {\n//     if (bound_array_buf !== unit_buf) {\n//       gl.bindBuffer(gl.ARRAY_BUFFER, unit_buf);\n//       bound_array_buf = unit_buf;\n//     }\n//   }\n//   gl.vertexAttribPointer(arr_idx, 4, gl.UNSIGNED_BYTE, true, 0, 0);\n// }\n\n// Verts should be ordered counter-clockwise from the upper left\nfunction getQuadIndexBuf(quad_count) {\n  assert(quad_count <= MAX_VERT_COUNT/4);\n  // If not, need to split into multiple vertex and index buffers (fairly easy),\n  //   or use the OES_element_index_uint extension (trivial, but probably slower, maybe not supported on mobile?)\n  if (quad_count * 6 > quad_index_buf_len) {\n    if (!quad_index_buf) {\n      quad_index_buf = gl.createBuffer();\n    } else {\n      // freeing old one\n      engine.perf_state.gpu_mem.geom -= quad_index_buf_len * 2;\n    }\n    quad_index_buf_len = min(max(ceil(quad_index_buf_len * 1.5), quad_count * 6), MAX_VERT_COUNT*6/4);\n    if (bound_index_buf !== quad_index_buf) {\n      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, quad_index_buf);\n      bound_index_buf = quad_index_buf;\n    }\n    let arr = new Uint16Array(quad_index_buf_len);\n    let vidx = 0;\n    for (let ii = 0; ii < quad_index_buf_len;) {\n      arr[ii++] = vidx + 1;\n      arr[ii++] = vidx + 3;\n      arr[ii++] = vidx++; // 0\n      arr[ii++] = vidx++; // 1\n      arr[ii++] = vidx++; // 2\n      arr[ii++] = vidx++; // 3\n    }\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, arr, gl.STATIC_DRAW);\n    engine.perf_state.gpu_mem.geom += quad_index_buf_len * 2;\n  }\n  return quad_index_buf;\n}\n\nexport function createIndices(idxs) {\n  let ret = {\n    ibo: gl.createBuffer(),\n    ibo_size: idxs.length,\n  };\n  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ret.ibo);\n  bound_index_buf = ret.ibo;\n  gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, idxs, gl.STATIC_DRAW);\n  engine.perf_state.gpu_mem.geom += idxs.length * 2;\n  return ret;\n}\n\nfunction formatInfo(format) {\n  if (!format.info) {\n    let stride = 0;\n    let elem_count = 0;\n    let used_attribs = 0;\n    let common_byte_size = 0;\n    for (let ii = 0; ii < format.length; ++ii) {\n      let fmt = format[ii];\n      let sem = fmt[0];\n      let gltype = fmt[1];\n      let count = fmt[2];\n      used_attribs |= (1 << sem);\n      let byte_size = gl_byte_size[gltype];\n      assert(byte_size);\n      assert(!common_byte_size || byte_size === common_byte_size);\n      common_byte_size = byte_size;\n      fmt[3] = fmt[3] || false;\n      fmt[4] = byte_size;\n      stride += count * byte_size;\n      elem_count += count;\n    }\n    format.info = {\n      stride, elem_count, used_attribs, common_byte_size\n    };\n  }\n  return format.info;\n}\n\n// format is [shaders.semantic.foo, gl.FLOAT/UNSIGNED_BYTE/etc, count, normalized]\nfunction Geom(format, verts, idxs, mode) {\n  this.mode = mode || TRIANGLES;\n  this.format = format;\n  let info = this.format_info = formatInfo(format);\n  this.stride = info.stride;\n  this.used_attribs = info.used_attribs;\n\n  this.vert_count = verts.length / this.format_info.elem_count;\n  this.vert_gpu_mem = verts.length * this.format_info.common_byte_size;\n  if (verts.length) {\n    this.vbo = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.vbo);\n    bound_array_buf = this.vbo;\n    gl.bufferData(gl.ARRAY_BUFFER, verts, gl.STATIC_DRAW);\n    engine.perf_state.gpu_mem.geom += this.vert_gpu_mem;\n  }\n  this.orig_mode = mode;\n  if (idxs) {\n    if (idxs.ibo) {\n      this.ibo = idxs.ibo;\n      this.ibo_owned = false;\n      this.ibo_size = idxs.ibo_size;\n    } else if (idxs.length) {\n      this.ibo = gl.createBuffer();\n      this.ibo_owned = true;\n      this.ibo_size = idxs.length;\n      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.ibo);\n      bound_index_buf = this.ibo;\n      gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, idxs, gl.STATIC_DRAW);\n      engine.perf_state.gpu_mem.geom += idxs.length * 2;\n    } else {\n      // presumably updated later with .updateIndex\n      this.ibo = null;\n      this.ibo_owned = true;\n      this.ibo_size = 0;\n    }\n  } else if (mode === QUADS) {\n    assert.equal(this.vert_count % 4, 0);\n    let quad_count = this.vert_count / 4;\n    // PERFTODO: Use GL_QUADS_OES extension\n    this.ibo = getQuadIndexBuf(quad_count);\n    this.ibo_owned = false;\n    this.ibo_size = quad_count * 6;\n    this.mode = TRIANGLES;\n  } else if (mode === TRIANGLE_FAN) {\n    this.mode = TRIANGLE_FAN;\n  } else {\n    this.ibo = null;\n    this.ibo_owned = false;\n  }\n  this.updateTriCount();\n}\n\nfunction trianglesFromMode(mode, eff_vert_count) {\n  if (mode === TRIANGLES) {\n    return eff_vert_count / 3;\n  } else if (mode === TRIANGLE_FAN) {\n    return eff_vert_count - 2;\n  } else {\n    assert(!eff_vert_count);\n    return 0;\n  }\n}\n\nGeom.prototype.updateTriCount = function () {\n  let eff_vert_count = this.ibo ? this.ibo_size : this.vert_count;\n  this.tri_count = trianglesFromMode(this.mode, eff_vert_count);\n};\n\nGeom.prototype.updateIndex = function (idxs, num_idxs) {\n  assert.equal(this.ibo_owned, true);\n  if (num_idxs > this.ibo_size) {\n    if (bound_geom === this) {\n      bound_geom = null;\n    }\n    engine.perf_state.gpu_mem.geom -= this.ibo_size * 2;\n    deleteBuffer(this.ibo);\n    this.ibo_size = idxs.length;\n    this.ibo = gl.createBuffer();\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.ibo);\n    bound_index_buf = this.ibo;\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, idxs, gl.DYNAMIC_DRAW);\n    engine.perf_state.gpu_mem.geom += idxs.length * 2;\n  } else {\n    // Fits\n    if (bound_index_buf !== this.ibo) {\n      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.ibo);\n      bound_index_buf = this.ibo;\n    }\n    gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER, 0, idxs.subarray(0, num_idxs));\n  }\n  this.updateTriCount();\n};\n\nGeom.prototype.updateSub = function (offset, verts) {\n  if (bound_array_buf !== this.vbo) {\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.vbo);\n    bound_array_buf = this.vbo;\n  }\n  gl.bufferSubData(gl.ARRAY_BUFFER, offset, verts);\n};\n\nGeom.prototype.update = function (verts, num_verts) {\n  if (num_verts > this.vert_count) {\n    if (bound_geom === this) {\n      bound_geom = null;\n    }\n    engine.perf_state.gpu_mem.geom -= this.vert_gpu_mem;\n    deleteBuffer(this.vbo);\n    // Note: matching size, ignoring num_verts\n    this.vert_count = verts.length / this.format_info.elem_count;\n    this.vert_gpu_mem = verts.length * this.format_info.common_byte_size;\n    this.vbo = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.vbo);\n    bound_array_buf = this.vbo;\n    gl.bufferData(gl.ARRAY_BUFFER, verts, gl.DYNAMIC_DRAW);\n    engine.perf_state.gpu_mem.geom += this.vert_gpu_mem;\n  } else {\n    // Fits\n    if (bound_array_buf !== this.vbo) {\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.vbo);\n      bound_array_buf = this.vbo;\n    }\n    gl.bufferSubData(gl.ARRAY_BUFFER, 0, verts.subarray(0, num_verts * this.format_info.elem_count));\n    // gl.bufferData(gl.ARRAY_BUFFER, verts, gl.DYNAMIC_DRAW);\n  }\n  if (this.orig_mode === QUADS) {\n    assert.equal(this.ibo_owned, false);\n    let quad_count = num_verts / 4;\n    this.ibo = getQuadIndexBuf(quad_count);\n    this.ibo_size = quad_count * 6;\n  }\n  this.updateTriCount();\n};\n\nGeom.prototype.dispose = function () {\n  if (this.ibo_owned) {\n    deleteBuffer(this.ibo);\n  }\n  this.ibo = null;\n  deleteBuffer(this.vbo);\n  this.vbo = null;\n  engine.perf_state.gpu_mem.geom -= this.vert_gpu_mem;\n  this.vert_gpu_mem = 0;\n};\n\nlet bound_attribs = (function () {\n  let r = [];\n  for (let ii = 0; ii < 16; ++ii) {\n    r.push({\n      vbo: null,\n      offset: 0,\n    });\n  }\n  return r;\n}());\n\nexport function geomResetState() {\n  // Resetting this avoids a state management bug on Chrome 71-73 on Redmi 6A -\n  //   it seems the browser was leaving something bound at a low level, perhaps\n  //   from generating mipmaps or something?\n  bound_geom = null;\n  bound_index_buf = null;\n  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n  bound_array_buf = null;\n  gl.bindBuffer(gl.ARRAY_BUFFER, null);\n  for (let ii = 0; ii < MAX_SEMANTIC; ++ii) {\n    gl.disableVertexAttribArray(ii);\n  }\n  attrib_enabled = 0;\n  for (let ii = 0; ii < bound_attribs.length; ++ii) {\n    bound_attribs[ii].vbo = null;\n  }\n  // Also resetting stats for metrics here, but could do that separately if needed\n  stats.draw_calls = stats.draw_calls_geom + stats.draw_calls_sprite;\n  for (let key in stats) {\n    last_stats[key] = stats[key];\n    stats[key] = 0;\n  }\n}\n\nGeom.prototype.bind = function () {\n  if (bound_geom !== this) {\n    bound_geom = this;\n    let vbo = this.vbo;\n\n    let offset = 0;\n    for (let ii = 0; ii < this.format.length; ++ii) {\n      let fmt = this.format[ii];\n      let count = fmt[2];\n      let byte_size = fmt[4];\n      let sem = fmt[0];\n      if (bound_attribs[sem].vbo === vbo) { //  && bound_attribs[sem].offset = offset\n        // already bound\n      } else {\n        if (bound_array_buf !== vbo) {\n          gl.bindBuffer(gl.ARRAY_BUFFER, vbo);\n          bound_array_buf = vbo;\n        }\n        let gltype = fmt[1];\n        let normalized = fmt[3];\n        gl.vertexAttribPointer(sem, count, gltype, normalized, this.stride, offset);\n        bound_attribs[sem].vbo = bound_array_buf;\n        // bound_attribs[sem].offset = offset;\n      }\n      offset += count * byte_size;\n    }\n    // if (!used[1]) { // COLOR\n    //   used_attribs |= 1 << shader.semantics.COLOR;\n    //   bindUnitBuf(1, this.vert_count);\n    // }\n    enableVertexAttribArray(this.used_attribs);\n  }\n\n  if (this.ibo && bound_index_buf !== this.ibo) {\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.ibo);\n    bound_index_buf = this.ibo;\n  }\n};\nGeom.prototype.draw = function () {\n  this.bind();\n  ++stats.draw_calls_geom;\n  stats.tris += this.tri_count;\n  stats.verts += this.vert_count;\n  if (this.ibo) {\n    gl.drawElements(this.mode, this.ibo_size, gl.UNSIGNED_SHORT, 0);\n  } else {\n    gl.drawArrays(this.mode, 0, this.vert_count);\n  }\n};\nGeom.prototype.drawSub = function (start, tri_count) {\n  assert.equal(this.mode, TRIANGLES);\n  this.bind();\n  ++stats.draw_calls_geom;\n  if (this.ibo) {\n    stats.tris += tri_count;\n    stats.verts += tri_count*2; // assumes quads\n    gl.drawElements(this.mode, tri_count * 3, gl.UNSIGNED_SHORT, start * 2);\n  } else {\n    gl.drawArrays(this.mode, start, tri_count * 3);\n  }\n};\n\nfunction GeomMultiQuads(format, verts) {\n  let format_info = formatInfo(format);\n  let ec = format_info.elem_count;\n  let vert_count = verts.length / ec;\n  this.geoms = [];\n  for (let idx = 0; idx < vert_count; idx += MAX_VERT_COUNT) {\n    let num_sub_verts = min(vert_count - idx, MAX_VERT_COUNT);\n    let sub_data = new Uint8Array(verts.buffer, idx * ec, num_sub_verts * ec);\n    this.geoms.push(new Geom(format, sub_data, null, QUADS));\n  }\n}\nGeomMultiQuads.prototype.draw = function () {\n  for (let ii = 0; ii < this.geoms.length; ++ii) {\n    this.geoms[ii].draw();\n  }\n};\nGeomMultiQuads.prototype.dispose = function () {\n  for (let ii = 0; ii < this.geoms.length; ++ii) {\n    this.geoms[ii].dispose();\n  }\n  this.geoms = null;\n};\n\nexport function create(format, verts, idxs, mode) {\n  return new Geom(format, verts, idxs, mode);\n}\n\nexport function createQuads(format, verts, fixed_size) {\n  let format_info = formatInfo(format);\n  assert(fixed_size || verts instanceof Uint8Array); // only one handled by GeomMultiQuads for now\n  let vert_count = verts.length / format_info.elem_count;\n  if (vert_count > MAX_VERT_COUNT) {\n    return new GeomMultiQuads(format, verts);\n  }\n  return new Geom(format, verts, null, QUADS);\n}\n\nexport function startup() {\n  // Nothing for now.\n}\n","/* eslint no-bitwise:off */\n// From https://stackoverflow.com/questions/8936984/uint8array-to-string-in-javascript\n\nlet charCache = new Array(128);  // Preallocate the cache for the common single byte chars\nlet charFromCodePt = String.fromCodePoint || String.fromCharCode;\nlet result = [];\nexport function decode(array) {\n  let codePt;\n  let byte1;\n  let buffLen = array.length;\n\n  result.length = 0;\n\n  for (let i = 0; i < buffLen;) {\n    byte1 = array[i++];\n\n    if (byte1 <= 0x7F) {\n      codePt = byte1;\n    } else if (byte1 <= 0xDF) {\n      codePt = ((byte1 & 0x1F) << 6) | (array[i++] & 0x3F);\n    } else if (byte1 <= 0xEF) {\n      codePt = ((byte1 & 0x0F) << 12) | ((array[i++] & 0x3F) << 6) | (array[i++] & 0x3F);\n    } else if (String.fromCodePoint) {\n      codePt = ((byte1 & 0x07) << 18) | ((array[i++] & 0x3F) << 12) | ((array[i++] & 0x3F) << 6) | (array[i++] & 0x3F);\n    } else {\n      codePt = 63;    // Cannot convert four byte code points, so use \"?\" instead\n      i += 3;\n    }\n\n    result.push(charCache[codePt] || (charCache[codePt] = charFromCodePt(codePt)));\n  }\n\n  return result.join('');\n}\n","// Derived from (MIT Licensed) https://github.com/uber-web/loaders.gl/tree/master/modules/gltf\n\nconst TYPES = ['SCALAR', 'VEC2', 'VEC3', 'VEC4'];\n\nexport function getAccessorTypeFromSize(size) {\n  const type = TYPES[size - 1];\n  return type || TYPES[0];\n}\n\n// glTF ACCESSOR CONSTANTS\n\nexport const ATTRIBUTE_TYPE_TO_COMPONENTS = {\n  SCALAR: 1,\n  VEC2: 2,\n  VEC3: 3,\n  VEC4: 4,\n  MAT2: 4,\n  MAT3: 9,\n  MAT4: 16\n};\n\nexport const ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE = {\n  5120: 1,\n  5121: 1,\n  5122: 2,\n  5123: 2,\n  5125: 4,\n  5126: 4\n};\n\nexport const ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY = {\n  5120: Int8Array,\n  5121: Uint8Array,\n  5122: Int16Array,\n  5123: Uint16Array,\n  5125: Uint32Array,\n  5126: Float32Array\n};\n","// Derived from (MIT Licensed) https://github.com/uber-web/loaders.gl/tree/master/modules/gltf\n/* eslint-env browser */\n\n/* eslint-disable import/order */\nconst assert = require('assert');\n\nconst { unpackGLBBuffers } = require('./unpack-glb-buffers.js');\nconst { unpackBinaryJson } = require('./unpack-binary-json.js');\n\nfunction padTo4Bytes(byteLength) {\n  return (byteLength + 3) & ~3;\n}\n\nconst decode_utf8 = require('./decode-utf8.js');\n\nconst {\n  ATTRIBUTE_TYPE_TO_COMPONENTS,\n  ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE,\n  ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY\n} = require('./gltf-type-utils.js');\n\nconst MAGIC_glTF = 0x676c5446; // glTF in Big-Endian ASCII\n\nconst GLB_FILE_HEADER_SIZE = 12;\nconst GLB_CHUNK_HEADER_SIZE = 8;\n\nconst GLB_CHUNK_TYPE_JSON = 0x4e4f534a;\nconst GLB_CHUNK_TYPE_BIN = 0x004e4942;\n\nconst LE = true; // Binary GLTF is little endian.\nconst BE = false; // Magic needs to be written as BE\n\n// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#glb-file-format-specification\nfunction GLBParser() {\n  // Result\n  this.binaryByteOffset = null;\n  this.packedJson = null;\n  this.json = null;\n}\n\nfunction parseBinary(self) {\n  // GLB Header\n  const dataView = new DataView(self.glbArrayBuffer);\n  const magic1 = dataView.getUint32(0, BE); // Magic number (the ASCII string 'glTF').\n  const version = dataView.getUint32(4, LE); // Version 2 of binary glTF container format\n  const fileLength = dataView.getUint32(8, LE); // Total byte length of generated file\n\n  let valid = magic1 === MAGIC_glTF;\n  if (!valid) {\n    console.warn('Invalid GLB magic string');\n  }\n\n  assert(version === 2, `Invalid GLB version ${version}. Only .glb v2 supported`);\n  assert(fileLength > 20);\n\n  // Write the JSON chunk\n  const jsonChunkLength = dataView.getUint32(12, LE); // Byte length of json chunk\n  const jsonChunkFormat = dataView.getUint32(16, LE); // Chunk format as uint32\n\n  valid = jsonChunkFormat === GLB_CHUNK_TYPE_JSON || jsonChunkFormat === 0; // Back compat\n  assert(valid, `JSON chunk format ${jsonChunkFormat}`);\n\n  // Create a \"view\" of the binary encoded JSON data\n  const jsonChunkOffset = GLB_FILE_HEADER_SIZE + GLB_CHUNK_HEADER_SIZE; // First headers: 20 bytes\n  const jsonChunk = new Uint8Array(self.glbArrayBuffer, jsonChunkOffset, jsonChunkLength);\n\n  // Decode the JSON binary array into clear text\n  const jsonText = decode_utf8.decode(jsonChunk);\n\n  // Parse the JSON text into a JavaScript data structure\n  self.json = JSON.parse(jsonText);\n\n  // TODO - BIN chunk can be optional\n  const binaryChunkStart = jsonChunkOffset + padTo4Bytes(jsonChunkLength);\n  self.binaryByteOffset = binaryChunkStart + GLB_CHUNK_HEADER_SIZE;\n\n  const binChunkFormat = dataView.getUint32(binaryChunkStart + 4, LE); // Chunk format as uint32\n  valid = binChunkFormat === GLB_CHUNK_TYPE_BIN || binChunkFormat === 1; // Back compat\n  assert(valid, `BIN chunk format ${binChunkFormat}`);\n\n  return {\n    arrayBuffer: self.glbArrayBuffer,\n    binaryByteOffset: self.binaryByteOffset,\n    json: self.json\n  };\n}\n\nfunction parseInternal(self) {\n  const result = parseBinary(self);\n  self.packedJson = result.json;\n  self.unpackedBuffers = unpackGLBBuffers(self.glbArrayBuffer, self.json, self.binaryByteOffset);\n  self.json = unpackBinaryJson(self.json, self.unpackedBuffers);\n}\n\nGLBParser.prototype.parseSync = function (arrayBuffer) {\n  // Input\n  this.glbArrayBuffer = arrayBuffer;\n\n  // Only parse once\n  if (this.json === null && this.binaryByteOffset === null) {\n    parseInternal(this);\n  }\n  return this;\n};\n\n// Return the gltf JSON and the original arrayBuffer\nGLBParser.prototype.parse = function (arrayBuffer) {\n  return this.parseSync(arrayBuffer);\n};\n\n// Returns application JSON data stored in `key`\nGLBParser.prototype.getApplicationData = function (key) {\n  return this.json[key];\n};\n\n// Returns JSON envelope\nGLBParser.prototype.getJSON = function () {\n  return this.json;\n};\n\n// Return binary chunk\nGLBParser.prototype.getArrayBuffer = function () {\n  return this.glbArrayBuffer;\n};\n\n// Return index into binary chunk\nGLBParser.prototype.getBinaryByteOffset = function () {\n  return this.binaryByteOffset;\n};\n\n// Unpacks a bufferview into a new Uint8Array that is a view into the binary chunk\nGLBParser.prototype.getBufferView = function (glTFBufferView) {\n  const byteOffset = (glTFBufferView.byteOffset || 0) + this.binaryByteOffset;\n  return new Uint8Array(this.glbArrayBuffer, byteOffset, glTFBufferView.byteLength);\n};\n\n// Unpacks a glTF accessor into a new typed array that is a view into the binary chunk\nGLBParser.prototype.getBuffer = function (glTFAccessor) {\n  // Decode the glTF accessor format\n  const ArrayType = ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY[glTFAccessor.componentType];\n  const components = ATTRIBUTE_TYPE_TO_COMPONENTS[glTFAccessor.type];\n  const bytesPerComponent = ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE[glTFAccessor.componentType];\n  const length = glTFAccessor.count * components;\n  const byteLength = glTFAccessor.count * components * bytesPerComponent;\n\n  // Get the boundaries of the binary sub-chunk for this bufferView\n  const glTFBufferView = this.json.bufferViews[glTFAccessor.bufferView];\n  assert(byteLength >= 0 && glTFAccessor.byteOffset + byteLength <= glTFBufferView.byteLength);\n\n  const byteOffset = glTFBufferView.byteOffset + this.binaryByteOffset + glTFAccessor.byteOffset;\n  return new ArrayType(this.glbArrayBuffer, byteOffset, length);\n};\n\n// Unpacks an image into an HTML image\nGLBParser.prototype.getImageData = function (glTFImage) {\n  return {\n    typedArray: this.getBufferView(glTFImage.bufferView),\n    mimeType: glTFImage.mimeType || 'image/jpeg'\n  };\n};\n\nGLBParser.prototype.getImage = function (glTFImage) {\n  const arrayBufferView = this.getBufferView(glTFImage.bufferView);\n  const mimeType = glTFImage.mimeType || 'image/jpeg';\n  const blob = new Blob([arrayBufferView], { type: mimeType });\n  const urlCreator = window.URL || window.webkitURL;\n  const imageUrl = urlCreator.createObjectURL(blob);\n  const img = new Image();\n  img.src = imageUrl;\n  return img;\n};\n\n// GLBParser.prototype.getImageAsync = function (glTFImage) {\n//   return new Promise(resolve => {\n//     const arrayBufferView = this.getBufferView(glTFImage.bufferView);\n//     const mimeType = glTFImage.mimeType || 'image/jpeg';\n//     const blob = new Blob([arrayBufferView], {type: mimeType});\n//     const urlCreator = window.URL || window.webkitURL;\n//     const imageUrl = urlCreator.createObjectURL(blob);\n//     const img = new Image();\n//     img.onload = () => resolve(img);\n//     img.src = imageUrl;\n//   });\n// };\n\nmodule.exports = GLBParser;\nGLBParser.parse = function (data) {\n  let parser = new GLBParser();\n  return parser.parse(data);\n};\n","// Derived from (MIT Licensed) https://github.com/uber-web/loaders.gl/tree/master/modules/gltf\n\nfunction parseJSONPointer(value) {\n  if (typeof value === 'string') {\n    // Remove escape character\n    if (value.indexOf('##/') === 0) {\n      return value.slice(1);\n    }\n\n    let matches = value.match(/#\\/([a-z]+)\\/([0-9]+)/);\n    if (matches) {\n      const index = parseInt(matches[2], 10);\n      return [matches[1], index];\n    }\n\n    // Legacy: `$$$i`\n    matches = value.match(/\\$\\$\\$([0-9]+)/);\n    if (matches) {\n      const index = parseInt(matches[1], 10);\n      return ['accessors', index];\n    }\n  }\n\n  return null;\n}\n\nfunction decodeJSONPointer(object, buffers) {\n  const pointer = parseJSONPointer(object);\n  if (pointer) {\n    const field = pointer[0];\n    const index = pointer[1];\n    const buffer = buffers[field] && buffers[field][index];\n    if (buffer) {\n      return buffer;\n    }\n    console.error(`Invalid JSON pointer ${object}: #/${field}/${index}`);\n  }\n  return null;\n}\n\n// Recursively unpacks objects, replacing \"JSON pointers\" with typed arrays\nfunction unpackJsonArraysRecursive(json, topJson, buffers, options = {}) {\n  const object = json;\n\n  const buffer = decodeJSONPointer(object, buffers);\n  if (buffer) {\n    return buffer;\n  }\n\n  // Copy array\n  if (Array.isArray(object)) {\n    return object.map((element) => unpackJsonArraysRecursive(element, topJson, buffers, options));\n  }\n\n  // Copy object\n  if (object !== null && typeof object === 'object') {\n    const newObject = {};\n    for (const key in object) {\n      newObject[key] = unpackJsonArraysRecursive(object[key], topJson, buffers, options);\n    }\n    return newObject;\n  }\n\n  return object;\n}\n\nexport function unpackBinaryJson(json, buffers, options = {}) {\n  return unpackJsonArraysRecursive(json, json, buffers, options);\n}\n","// Derived from (MIT Licensed) https://github.com/uber-web/loaders.gl/tree/master/modules/gltf\n\nconst assert = require('assert');\n\nconst {\n  ATTRIBUTE_TYPE_TO_COMPONENTS,\n  ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE,\n  ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY\n} = require('./gltf-type-utils.js');\n\n// Creates a new ArrayBuffer starting at the offset, containing all remaining bytes\n// TODO - should not be needed, see above\nfunction getArrayBufferAtOffset(arrayBuffer, byteOffset) {\n  const length = arrayBuffer.byteLength - byteOffset;\n  const binaryBuffer = new ArrayBuffer(length);\n  const sourceArray = new Uint8Array(arrayBuffer);\n  const binaryArray = new Uint8Array(binaryBuffer);\n  for (let i = 0; i < length; i++) {\n    binaryArray[i] = sourceArray[byteOffset + i];\n  }\n  return binaryBuffer;\n}\n\nfunction getArrayTypeAndLength(accessor, bufferView) {\n  const ArrayType = ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY[accessor.componentType];\n  const components = ATTRIBUTE_TYPE_TO_COMPONENTS[accessor.type];\n  const bytesPerComponent = ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE[accessor.componentType];\n  const length = accessor.count * components;\n  const byteLength = accessor.count * components * bytesPerComponent;\n  assert(byteLength >= 0 && byteLength <= bufferView.byteLength);\n  return { ArrayType, length, byteLength };\n}\n\nfunction unpackAccessors(arrayBuffer, bufferViews, json) {\n  // unpack accessors\n  const accessors = json.accessors || [];\n\n  const accessorBuffers = [];\n\n  for (let i = 0; i < accessors.length; ++i) {\n    const accessor = accessors[i];\n    assert(accessor);\n\n    const bufferView = bufferViews[accessor.bufferView];\n    // Draco encoded meshes don't have bufferView in accessor\n    if (bufferView) {\n      // Create a new typed array as a view into the combined buffer\n      const { ArrayType, length } = getArrayTypeAndLength(accessor, bufferView);\n      const array = new ArrayType(arrayBuffer, bufferView.byteOffset, length);\n      // Store the metadata on the array (e.g. needed to determine number of components per element)\n      array.accessor = accessor;\n      accessorBuffers.push(array);\n    }\n  }\n\n  return accessorBuffers;\n}\n\nfunction unpackImages(arrayBuffer, bufferViews, json) {\n  // unpack images\n  const images = json.images || [];\n\n  const imageBuffers = [];\n\n  for (let i = 0; i < images.length; ++i) {\n    const image = images[i];\n    assert(image);\n\n    if (image.bufferView === undefined) {\n      imageBuffers.push(null);\n      continue;\n    }\n\n    const bufferView = bufferViews[image.bufferView];\n    assert(bufferView);\n\n    // Create a new typed array as a view into the combined buffer\n    const array = new Uint8Array(arrayBuffer, bufferView.byteOffset, bufferView.byteLength);\n    // Store the metadata on the array (e.g. needed to determine number of components per element)\n    array.imate = image;\n    imageBuffers.push(array);\n  }\n\n  return imageBuffers;\n}\n\nexport function unpackGLBBuffers(arrayBuffer, json, binaryByteOffset) {\n  // TODO - really inefficient, should just use the offset into the original array buffer\n  if (binaryByteOffset) {\n    arrayBuffer = getArrayBufferAtOffset(arrayBuffer, binaryByteOffset);\n  }\n\n  const bufferViews = json.bufferViews || [];\n\n  for (let i = 0; i < bufferViews.length; ++i) {\n    const bufferView = bufferViews[i];\n    assert(bufferView.byteLength >= 0);\n  }\n\n  return {\n    // TODO: delete unpackAccessors and use buffer views only?\n    accessors: unpackAccessors(arrayBuffer, bufferViews, json),\n    images: unpackImages(arrayBuffer, bufferViews, json)\n  };\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// From libGlov, MIT Licensed, (c) 2005-2017 Jimb Esser, various authors\n\nconst { max, min, floor } = Math;\n\n// out([0,360), [0,1], [0,1])\n// rgb [0,1](3)\nexports.rgbToHSV = function rgbToHSV(out, rgb) {\n  let r = rgb[0];\n  let g = rgb[1];\n  let b = rgb[2];\n  let mn = min(r, g, b);\n  let mx = max(r, g, b);\n  out[2] = mx;        // v\n  let delta = mx - mn;\n  if (delta !== 0) { // mx == 0 -> delta == 0\n    out[1] = delta / mx;    // s\n  } else {\n    // r = g = b = 0    // s = 0, v is undefined\n    out[1] = 0;\n    out[0] = 0;\n    return;\n  }\n  if (r === mx) {\n    out[0] = (g - b) / delta;    // between yellow & magenta\n  } else if (g === mx) {\n    out[0] = 2 + (b - r) / delta;  // between cyan & yellow\n  } else {\n    out[0] = 4 + (r - g) / delta;  // between magenta & cyan\n  }\n  out[0] *= 60;        // degrees\n  if (out[0] < 0) {\n    out[0] += 360;\n  }\n};\n\n// out [0,1](3)\n// hue [0,360)\n// s [0,1]\n// v [0,1]\nexports.hsvToRGB = function hsvToRGB(out, h, s, v) {\n  if (s === 0) {\n    // achromatic (grey)\n    out[0] = out[1] = out[2] = v;\n    return out;\n  }\n  h /= 60;      // sector 0 to 5\n  if (h>=6) {\n    h-=6;\n  }\n  let i = floor(h);\n  let f = h - i;      // factorial part of h\n  let p = v * (1 - s);\n  let q = v * (1 - s * f);\n  let t = v * (1 - s * (1 - f));\n  switch (i) {\n    case 0:\n      out[0] = v;\n      out[1] = t;\n      out[2] = p;\n      break;\n    case 1:\n      out[0] = q;\n      out[1] = v;\n      out[2] = p;\n      break;\n    case 2:\n      out[0] = p;\n      out[1] = v;\n      out[2] = t;\n      break;\n    case 3:\n      out[0] = p;\n      out[1] = q;\n      out[2] = v;\n      break;\n    case 4:\n      out[0] = t;\n      out[1] = p;\n      out[2] = v;\n      break;\n    default:    // case 5:\n      out[0] = v;\n      out[1] = p;\n      out[2] = q;\n      break;\n  }\n  return out;\n};\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// System for registering callbacks to run in event handlers on the next frame\n// Used to get around restrictions on APIs like pointer lock, fullscreen, or\n// screen orientation.\n\nconst assert = require('assert');\n\nlet cbs = {};\nexport function topOfFrame() {\n  cbs = {};\n}\n\nexport function on(type, code_or_pos, cb) {\n  let list = cbs[type] = cbs[type] || [];\n  if (typeof code_or_pos === 'number') {\n    list[code_or_pos] = cb;\n  } else {\n    list.push([code_or_pos, cb]);\n  }\n}\n\nexport function handle(type, event) {\n  let list = cbs[type];\n  if (!list) {\n    return;\n  }\n  switch (type) {\n    case 'keydown':\n    case 'keyup':\n      if (list[event.keyCode]) {\n        list[event.keyCode](type, event);\n      }\n      break;\n    case 'mouseup':\n    case 'mousedown': {\n      let x = event.pageX;\n      let y = event.pageY;\n      let button = event.button;\n      for (let ii = 0; ii < list.length; ++ii) {\n        let elem = list[ii];\n        let pos = elem[0];\n        if (x >= pos.x && x < pos.x + pos.w &&\n          y >= pos.y && y < pos.y + pos.h &&\n          (pos.button < 0 || pos.button === button)\n        ) {\n          elem[1](type, event);\n          break;\n        }\n      }\n    } break;\n    default:\n      assert(false);\n  }\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n// Some code from Turbulenz: Copyright (c) 2012-2013 Turbulenz Limited\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* global navigator */\n\n/* eslint-disable import/order */\nconst assert = require('assert');\n\nconst UP_EDGE = 0; // only for pads, which use === null as \"up\"\nconst UP = 0; // only for key/mouse\nconst DOWN = 1;\nconst DOWN_EDGE = 2; // only for pads\n\n// per-app overrideable options\nconst TOUCH_AS_MOUSE = true;\nlet map_analog_to_dpad = true;\n\nlet mouse_log = false;\n\nexports.click = mouseUpEdge; // eslint-disable-line no-use-before-define\nexports.inputClick = mouseUpEdge; // eslint-disable-line no-use-before-define\n\nexport const ANY = -2;\nexport const POINTERLOCK = -1;\n\nexport let KEYS = {\n  BACKSPACE: 8,\n  TAB: 9,\n  ENTER: 13,\n  RETURN: 13,\n  SHIFT: 16,\n  CTRL: 17,\n  ALT: 18,\n  ESC: 27,\n  ESCAPE: 27,\n  SPACE: 32,\n  PAGEUP: 33,\n  PAGEDOWN: 34,\n  END: 35,\n  HOME: 36,\n  LEFT: 37,\n  UP: 38,\n  RIGHT: 39,\n  DOWN: 40,\n  INS: 45,\n  DEL: 46,\n  NUMPAD_DIVIDE: 111,\n  EQUALS: 187,\n  COMMA: 188,\n  MINUS: 189,\n  PERIOD: 190,\n  SLASH: 191,\n  TILDE: 192,\n};\n(function () {\n  for (let ii = 1; ii <= 12; ++ii) {\n    KEYS[`F${ii}`] = 111 + ii;\n  }\n  for (let ii = 48; ii <= 90; ++ii) { // 0-9;A-Z\n    KEYS[String.fromCharCode(ii)] = ii;\n  }\n}());\nif (typeof Proxy === 'function') {\n  // Catch referencing keys that are not in our map\n  KEYS = new Proxy(KEYS, {\n    get: function (target, prop) {\n      let ret = target[prop];\n      assert(ret);\n      return ret;\n    }\n  });\n}\nexport const PAD = {\n  A: 0,\n  SELECT: 0, // GLOV name\n  B: 1,\n  CANCEL: 1, // GLOV name\n  X: 2,\n  Y: 3,\n  LB: 4,\n  LEFT_BUMPER: 4,\n  RB: 5,\n  RIGHT_BUMPER: 5,\n  LT: 6,\n  LEFT_TRIGGER: 6,\n  RT: 7,\n  RIGHT_TRIGGER: 7,\n  BACK: 8,\n  START: 9,\n  LEFT_STICK: 10,\n  RIGHT_STICK: 11,\n  UP: 12,\n  DOWN: 13,\n  LEFT: 14,\n  RIGHT: 15,\n  ANALOG_UP: 20,\n  ANALOG_LEFT: 21,\n  ANALOG_DOWN: 22,\n  ANALOG_RIGHT: 23,\n  LSTICK_UP: 20,\n  LSTICK_LEFT: 21,\n  LSTICK_DOWN: 22,\n  LSTICK_RIGHT: 23,\n  RSTICK_UP: 24,\n  RSTICK_LEFT: 25,\n  RSTICK_DOWN: 26,\n  RSTICK_RIGHT: 27,\n};\n\nconst { is_firefox, is_mac_osx } = require('./browser.js');\nconst camera2d = require('./camera2d.js');\nconst { cmd_parse } = require('./cmds.js');\nconst engine = require('./engine.js');\nconst in_event = require('./in_event.js');\nconst local_storage = require('./local_storage.js');\nconst { abs, max, min, sqrt } = Math;\nconst pointer_lock = require('./pointer_lock.js');\nconst settings = require('./settings.js');\nconst { soundResume } = require('./sound.js');\nconst { spotMouseoverHook, BUTTON_ANY } = require('./spot.js');\nconst { vec2, v2add, v2copy, v2lengthSq, v2set, v2scale, v2sub } = require('glov/common/vmath.js');\n\nassert.equal(BUTTON_ANY, ANY);\n\nlet pad_to_touch;\n\nlet canvas;\nlet key_state_new = {};\nlet pad_states = []; // One map per gamepad to pad button states\nlet gamepad_data = []; // Other tracking data per gamepad\nlet mouse_pos = vec2(); // in DOM coordinates, not canvas or virtual\nlet last_mouse_pos = vec2();\nlet mouse_pos_is_touch = false;\nlet mouse_over_captured = false;\nlet mouse_down = [];\nlet wheel_events = [];\nlet movement_questionable_frames = 0;\nconst MOVEMENT_QUESTIONABLE_FRAMES = 2; // Need at least 2\n\nlet input_eaten_kb = false;\nlet input_eaten_mouse = false;\n\nlet touches = {}; // `m${button}` or touch_id -> TouchData\n\nexport let touch_mode = local_storage.getJSON('touch_mode', false);\nexport let pad_mode = !touch_mode && local_storage.getJSON('pad_mode', false);\n\ncmd_parse.registerValue('mouse_log', {\n  type: cmd_parse.TYPE_INT,\n  range: [0, 1],\n  get: () => mouse_log,\n  set: (v) => (mouse_log = v),\n});\n\nexport function inputTouchMode() {\n  return touch_mode;\n}\n\nexport function inputEatenMouse() {\n  return input_eaten_mouse;\n}\n\nfunction eventTimestamp(event) {\n  if (event && event.timeStamp) {\n    // assert((event.timeStamp < 1e12) === (engine.hrtime < 1e12));\n    // Must both be high res times, or both not!\n    if ((event.timeStamp < 1e12) !== (engine.hrtime < 1e12)) {\n      return engine.hrtime;\n    }\n    return event.timeStamp;\n  }\n  return engine.hrtime;\n}\n\nfunction TouchData(pos, touch, button, event) {\n  this.delta = vec2();\n  this.total = 0;\n  this.cur_pos = pos.slice(0);\n  this.start_pos = pos.slice(0);\n  this.touch = touch;\n  this.button = button;\n  this.start_time = Date.now();\n  this.dispatched = false;\n  this.dispatched_drag = false;\n  this.dispatched_drag_over = false;\n  this.was_double_click = false;\n  this.up_edge = 0;\n  this.down_edge = 0;\n  this.state = DOWN;\n  this.down_time = 0;\n  this.origin_time = eventTimestamp(event);\n}\nTouchData.prototype.down = function (event, is_edge) {\n  if (is_edge) {\n    this.down_edge++;\n  }\n  this.state = DOWN;\n  this.origin_time = eventTimestamp(event);\n};\n\nconst MIN_EVENT_TIME_DELTA = 0.01; // fractions of a millisecond\nfunction timeDelta(event, origin_time) {\n  let et = eventTimestamp(event);\n  // timestamps on events are often back in time relative to the last tick time\n  return max(et - origin_time, MIN_EVENT_TIME_DELTA);\n}\n\nfunction KeyData() {\n  this.down_edge = 0;\n  // this.down_start = 0;\n  this.origin_time = 0;\n  this.down_time = 0;\n  this.up_edge = 0;\n  this.state = UP;\n}\nKeyData.prototype.keyUp = function (event) {\n  ++this.up_edge;\n  this.down_time += timeDelta(event, this.origin_time);\n  this.state = UP;\n};\n\nfunction setMouseToMid() {\n  v2set(mouse_pos, engine.width*0.5/camera2d.domToCanvasRatio(), engine.height*0.5/camera2d.domToCanvasRatio());\n}\n\nexport function pointerLocked() {\n  return pointer_lock.isLocked();\n}\nlet pointerlock_touch_id = `m${POINTERLOCK}`;\n// only works reliably when called from an event handler\nexport function pointerLockEnter(when) {\n  pointer_lock.enter(when);\n}\nfunction onPointerLockEnter() {\n  if (touch_mode) {\n    return;\n  }\n  let touch_data = touches[pointerlock_touch_id];\n  setMouseToMid();\n  if (touch_data) {\n    v2copy(touch_data.start_pos, mouse_pos);\n    touch_data.state = DOWN;\n    touch_data.origin_time = engine.hrtime;\n  } else {\n    touch_data = touches[pointerlock_touch_id] = new TouchData(mouse_pos, false, POINTERLOCK, null);\n  }\n  movement_questionable_frames = MOVEMENT_QUESTIONABLE_FRAMES;\n}\nexport function pointerLockExit() {\n  let touch_data = touches[pointerlock_touch_id];\n  if (touch_data) {\n    v2copy(touch_data.cur_pos, mouse_pos);\n    // no UP_EDGE for this\n    touch_data.state = UP;\n  }\n  pointer_lock.exit();\n  movement_questionable_frames = MOVEMENT_QUESTIONABLE_FRAMES;\n}\n\nlet last_event;\nconst skip = { isTrusted: 1, sourceCapabilities: 1, path: 1, currentTarget: 1, view: 1 };\nfunction eventlog(event) {\n  if (event === last_event) {\n    return;\n  }\n  last_event = event;\n  let pairs = [];\n  for (let k in event) {\n    let v = event[k];\n    if (!v || typeof v === 'function' || k.toUpperCase() === k || skip[k]) {\n      continue;\n    }\n    pairs.push(`${k}:${v.id || v}`);\n  }\n  console.log(`${engine.frame_index} ${event.type} ${pointerLocked()?'ptrlck':'unlckd'} ${pairs.join(',')}`);\n}\n\nfunction letEventThrough(event) {\n  return event.target && (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA' ||\n    event.target.tagName === 'LABEL' || String(event.target.className).includes('noglov'));\n}\n\nfunction ignored(event) {\n  // eventlog(event);\n  if (!letEventThrough(event)) {\n    event.preventDefault();\n    event.stopPropagation();\n  }\n}\n\nlet ctrl_checked = false;\nlet unload_protected = false;\nfunction beforeUnload(e) {\n  if (unload_protected && ctrl_checked) {\n    // Exit pointer lock if the browser didn't do that automatically\n    pointerLockExit();\n    // Cancel the event\n    e.preventDefault();\n    // Chrome requires returnValue to be set\n    e.returnValue = 'Are you sure you want to quit?';\n  } else {\n    engine.releaseCanvas();\n  }\n}\nfunction protectUnload(enable) {\n  unload_protected = enable;\n}\n\nlet last_input_time = 0;\nexport function inputLastTime() {\n  return last_input_time;\n}\nfunction onUserInput() {\n  soundResume();\n  last_input_time = Date.now();\n}\n\nfunction releaseAllKeysDown(evt) {\n  for (let code in key_state_new) {\n    let ks = key_state_new[code];\n    if (ks.state === DOWN) {\n      ks.keyUp(evt);\n    }\n  }\n}\n\nfunction onKeyUp(event) {\n  protectUnload(event.ctrlKey);\n  let code = event.keyCode;\n  if (!letEventThrough(event)) {\n    event.stopPropagation();\n    event.preventDefault();\n  }\n\n  if (code === KEYS.ESC && pointerLocked()) {\n    pointerLockExit();\n  }\n  // Letting through to our code regardless of no_stop, because we handle things like ESC in INPUT elements\n\n  let ks = key_state_new[code];\n  if (ks && ks.state === DOWN) {\n    if (is_mac_osx && event.key === 'Meta') {\n      // We don't get keyUp events for any keys released while CMD is held, so we must assume all are released\n      releaseAllKeysDown(event);\n    } else {\n      ks.keyUp(event);\n    }\n  }\n\n  in_event.handle('keyup', event);\n}\n\nfunction onKeyDown(event) {\n  protectUnload(event.ctrlKey);\n  let code = event.keyCode;\n  let no_stop = letEventThrough(event) ||\n    code >= KEYS.F5 && code <= KEYS.F12 || // Chrome debug hotkeys\n    code === KEYS.I && (event.altKey && event.metaKey || event.ctrlKey && event.shiftKey) || // Safari, alternate Chrome\n    code === KEYS.R && event.ctrlKey; // Chrome reload hotkey\n  if (!no_stop) {\n    event.stopPropagation();\n    event.preventDefault();\n  }\n  // console.log(`${event.code} ${event.keyCode}`);\n  onUserInput();\n\n  // Letting through to our code regardless of no_stop, because we handle things like ESC in INPUT elements\n  let ks = key_state_new[code];\n  if (!ks) {\n    ks = key_state_new[code] = new KeyData();\n  }\n  if (ks.state !== DOWN) { // not a repeat event\n    ++ks.down_edge;\n    ks.state = DOWN;\n    ks.origin_time = eventTimestamp(event);\n    // ks.down_start = ks.origin_time;\n\n    in_event.handle('keydown', event);\n  }\n}\n\nlet mouse_move_x = 0;\nexport function debugGetMouseMoveX() {\n  let ret = mouse_move_x;\n  mouse_move_x = 0;\n  return ret;\n}\n\nlet mouse_moved = false;\nlet mouse_button_had_edge = false;\nlet mouse_button_had_up_edge = false;\nlet temp_delta = vec2();\nlet last_abs_move = 0;\nlet last_abs_move_time = 0;\nlet last_move_x = 0;\nlet last_move_y = 0;\nfunction onMouseMove(event, no_stop) {\n  /// eventlog(event);\n  // Don't block mouse button 3, that's the Back button\n  if (!letEventThrough(event) && !no_stop && event.button !== 3) {\n    event.preventDefault();\n    event.stopPropagation();\n    if (touch_mode) {\n      local_storage.setJSON('touch_mode', false);\n      touch_mode = false;\n    }\n    if (pad_mode) {\n      local_storage.setJSON('pad_mode', false);\n      pad_mode = false;\n    }\n  }\n  mouse_moved = true;\n  // offsetX/layerX return position relative to text-entry boxes, not good!\n  // clientX/clientY do not handle weird scrolling that happens on iOS, but\n  //   should not affect mouse events (but maybe on Safari desktop?)\n  mouse_pos[0] = event.pageX;\n  mouse_pos[1] = event.pageY;\n  // if (event.offsetX !== undefined) {\n  //   mouse_pos[0] = event.offsetX;\n  //   mouse_pos[1] = event.offsetY;\n  // } else {\n  //   mouse_pos[0] = event.layerX;\n  //   mouse_pos[1] = event.layerY;\n  // }\n  mouse_pos_is_touch = false;\n\n  let movement_x = event.movementX || event.mozMovementX || event.webkitMovementX || 0;\n  let movement_y = event.movementY || event.mozMovementY || event.webkitMovementY || 0;\n\n  mouse_move_x += movement_x;\n\n  let any_movement = false;\n  if (pointerLocked()) {\n    setMouseToMid();\n    if (movement_x || movement_y) {\n      // Smooth out (ignore) large jumps in movement\n      // This is, I believe, just a bug with Chromium on Windows, as it repositions the hidden mouse cursor\n      let ts = event.timeStamp || Date.now();\n      let abs_x = abs(movement_x);\n      let abs_y = abs(movement_y);\n      let abs_move = abs_x + abs_y;\n      if (abs_move > 200 && (abs_move > 3 * last_abs_move || ts - last_abs_move_time > 1000)) {\n        console.log(`Ignoring mousemove with sudden large delta: ${movement_x},${movement_y}`);\n      } else if (is_firefox && movement_x === last_move_x && movement_y === last_move_y && abs_x < 2 && abs_y < 2) {\n        // Ignoring mousemove similar to previous and with very little delta, due to a Firefox bug\n      } else {\n        v2set(temp_delta, movement_x || 0, movement_y || 0);\n        any_movement = true;\n      }\n      last_abs_move = abs_move;\n      last_abs_move_time = ts;\n      last_move_x = movement_x;\n      last_move_y = movement_y;\n    }\n  } else {\n    v2sub(temp_delta, mouse_pos, last_mouse_pos);\n    if (temp_delta[0] || temp_delta[1]) {\n      any_movement = true;\n    }\n    v2copy(last_mouse_pos, mouse_pos);\n  }\n  if (any_movement && movement_questionable_frames && v2lengthSq(temp_delta) > 100*100) {\n    // giant movement right after entering or exiting pointer lock, ignore (Chrome bug)\n    // We get these unreasonable jumps in both movementXY and the other, presumably\n    // because pointerLocked() is slightly out of sync, though the large .movementX/Y\n    // is clearly erroneous.\n    any_movement = false;\n  }\n  if (any_movement) {\n    for (let button = POINTERLOCK; button < mouse_down.length; ++button) {\n      if (mouse_down[button] || button === POINTERLOCK && pointerLocked()) {\n        let touch_data = touches[`m${button}`];\n        if (touch_data) {\n          v2add(touch_data.delta, touch_data.delta, temp_delta);\n          touch_data.total += abs(temp_delta[0]) + abs(temp_delta[1]);\n          v2copy(touch_data.cur_pos, mouse_pos);\n        }\n      }\n    }\n  }\n}\n\nfunction onMouseDown(event) {\n  if (mouse_log) {\n    eventlog(event);\n  }\n  onMouseMove(event); // update mouse_pos\n  onUserInput();\n  let no_click = letEventThrough(event);\n\n  let button = event.button;\n  mouse_down[button] = true;\n  let touch_id = `m${button}`;\n  if (touches[touch_id]) {\n    v2copy(touches[touch_id].start_pos, mouse_pos);\n  } else {\n    touches[touch_id] = new TouchData(mouse_pos, false, button, event);\n  }\n  touches[touch_id].down(event, !no_click);\n  if (!no_click) {\n    in_event.handle('mousedown', event);\n  }\n  mouse_button_had_edge = true;\n  //This solves input bug when game is running as iframe. E.g. Facebook Instant\n  if (window.focus) {\n    window.focus();\n  }\n}\n\nlet last_up_edges = [{\n  timestamp: 0,\n  pos: vec2(),\n},{\n  timestamp: 0,\n  pos: vec2(),\n}];\nfunction registerMouseUpEdge(touch_data, timestamp) {\n  touch_data.up_edge++;\n  let t = last_up_edges[0];\n  last_up_edges[0] = last_up_edges[1];\n  last_up_edges[1] = t;\n  v2copy(t.pos, touch_data.cur_pos);\n  t.timestamp = timestamp;\n}\n\nfunction onMouseUp(event) {\n  if (mouse_log) {\n    eventlog(event);\n  }\n  onMouseMove(event); // update mouse_pos\n  let no_click = letEventThrough(event);\n  let button = event.button;\n  if (mouse_down[button]) {\n    let touch_id = `m${button}`;\n    let touch_data = touches[touch_id];\n    if (touch_data) {\n      v2copy(touch_data.cur_pos, mouse_pos);\n      if (!no_click) {\n        registerMouseUpEdge(touch_data, eventTimestamp(event));\n      }\n      touch_data.state = UP;\n      touch_data.down_time += timeDelta(event, touch_data.origin_time);\n    }\n    delete mouse_down[button];\n  }\n  mouse_button_had_edge = true;\n  mouse_button_had_up_edge = true;\n  if (!no_click) {\n    in_event.handle('mouseup', event);\n  }\n}\n\nfunction onWheel(event) {\n  let saved = mouse_moved; // don't trigger mouseMoved()\n  onMouseMove(event, true);\n  mouse_moved = saved;\n  let delta = -event.deltaY || event.wheelDelta || -event.detail;\n  wheel_events.push({\n    pos: [event.pageX, event.pageY],\n    delta: delta > 0 ? 1 : -1,\n    dispatched: false,\n  });\n}\n\nlet touch_pos = vec2();\nlet released_touch_id = 0;\nfunction onTouchChange(event) {\n  // eventlog(event);\n  // Using .pageX/Y here because on iOS when a text entry is selected, it scrolls\n  // our canvas offscreen.  Should maybe have the canvas resize and use clientX\n  // instead, but this works well enough.\n  onUserInput();\n  if (!touch_mode) {\n    local_storage.set('touch_mode', true);\n    touch_mode = true;\n  }\n  if (pad_mode) {\n    local_storage.set('pad_mode', false);\n    pad_mode = false;\n  }\n  if (event.cancelable !== false) {\n    event.preventDefault();\n  }\n  let ct = event.touches;\n  let seen = {};\n\n  let new_count = ct.length;\n  let old_count = 0;\n  // Look for press and movement\n  for (let ii = 0; ii < ct.length; ++ii) {\n    let touch = ct[ii];\n    try {\n      if (!isFinite(touch.pageX) || !isFinite(touch.pageY)) {\n        // getting bad touch events sometimes (Moto phones?), simply ignore\n        --new_count;\n        continue;\n      }\n    } catch (e) {\n      // getting \"Permission denied to access property \"pageX\" rarely on Firefox, simply ignore\n      --new_count;\n      continue;\n    }\n\n    let last_touch = touches[touch.identifier];\n    v2set(touch_pos, touch.pageX, touch.pageY);\n    if (!last_touch) {\n      last_touch = touches[touch.identifier] = new TouchData(touch_pos, true, 0, event);\n      last_touch.down(event, true);\n      mouse_button_had_edge = true;\n      in_event.handle('mousedown', touch);\n    } else {\n      ++old_count;\n      v2sub(temp_delta, touch_pos, last_touch.cur_pos);\n      v2add(last_touch.delta, last_touch.delta, temp_delta);\n      last_touch.total += abs(temp_delta[0]) + abs(temp_delta[1]);\n      v2copy(last_touch.cur_pos, touch_pos);\n    }\n\n    seen[touch.identifier] = true;\n    if (TOUCH_AS_MOUSE && new_count === 1) {\n      // Single touch, treat as mouse movement\n      v2copy(mouse_pos, touch_pos);\n      mouse_pos_is_touch = true;\n    }\n  }\n  // Look for release, if releasing exactly one final touch\n  let released_touch;\n  let released_ids = [];\n  for (let id in touches) {\n    if (!seen[id]) {\n      let touch = touches[id];\n      if (touch.touch && touch.state === DOWN) {\n        ++old_count;\n        released_touch = touch;\n        released_ids.push(id);\n        in_event.handle('mouseup', { pageX: touch.cur_pos[0], pageY: touch.cur_pos[1] });\n        registerMouseUpEdge(touch, eventTimestamp(event));\n        mouse_button_had_edge = true;\n        mouse_button_had_up_edge = true;\n        touch.state = UP;\n        touch.down_time += timeDelta(event, touch.origin_time);\n        touch.release = true;\n      }\n    }\n  }\n  for (let ii = 0; ii < released_ids.length; ++ii) {\n    let id = released_ids[ii];\n    let touch = touches[id];\n    // get new id, not overlapping with touch.identifier values,\n    // so that if we get a new touch event before the next tick, we still see the release, etc\n    let new_id = `r${++released_touch_id}`;\n    delete touches[id];\n    touches[new_id] = touch;\n  }\n  if (TOUCH_AS_MOUSE) {\n    if (old_count === 1 && new_count === 0) {\n      delete mouse_down[0];\n      v2copy(mouse_pos, released_touch.cur_pos);\n      mouse_pos_is_touch = true;\n    } else if (new_count === 1) {\n      let touch = ct[0];\n      if (!old_count) {\n        mouse_down[0] = true;\n      }\n      v2set(mouse_pos, touch.pageX, touch.pageY);\n      mouse_pos_is_touch = true;\n    } else if (new_count > 1) {\n      // multiple touches, release mouse_down without emitting click\n      delete mouse_down[0];\n    }\n  }\n}\n\nfunction onBlurOrFocus(evt) {\n  protectUnload(false);\n  releaseAllKeysDown(evt);\n}\n\nlet ANALOG_MAP = {};\nfunction genAnalogMap() {\n  if (map_analog_to_dpad) {\n    ANALOG_MAP[PAD.LEFT] = [PAD.LSTICK_LEFT, PAD.RSTICK_LEFT];\n    ANALOG_MAP[PAD.RIGHT] = [PAD.LSTICK_RIGHT, PAD.RSTICK_RIGHT];\n    ANALOG_MAP[PAD.UP] = [PAD.LSTICK_UP, PAD.RSTICK_UP];\n    ANALOG_MAP[PAD.DOWN] = [PAD.LSTICK_DOWN, PAD.RSTICK_DOWN];\n  }\n}\n\nlet passive_param = false;\nexport function handleTouches(elem) {\n  elem.addEventListener('touchstart', onTouchChange, passive_param);\n  elem.addEventListener('touchmove', onTouchChange, passive_param);\n  elem.addEventListener('touchend', onTouchChange, passive_param);\n  elem.addEventListener('touchcancel', onTouchChange, passive_param);\n}\n\nexport function startup(_canvas, params) {\n  canvas = _canvas;\n  pointer_lock.startup(canvas, onPointerLockEnter);\n  if (params.map_analog_to_dpad !== undefined) {\n    map_analog_to_dpad = params.map_analog_to_dpad;\n  }\n  pad_to_touch = params.pad_to_touch;\n  genAnalogMap();\n\n  try {\n    let opts = Object.defineProperty({}, 'passive', {\n      get: function () {\n        passive_param = { passive: false };\n        return false;\n      }\n    });\n    window.addEventListener('test', null, opts);\n    window.removeEventListener('test', null, opts);\n  } catch (e) {\n    passive_param = false;\n  }\n\n  window.addEventListener('keydown', onKeyDown, false);\n  window.addEventListener('keyup', onKeyUp, false);\n\n  window.addEventListener('click', ignored, false);\n  //window.addEventListener('click', eventlog, false);\n  window.addEventListener('contextmenu', ignored, false);\n  window.addEventListener('mousemove', onMouseMove, false);\n  window.addEventListener('mousedown', onMouseDown, false);\n  window.addEventListener('mouseup', onMouseUp, false);\n  if (window.WheelEvent) {\n    window.addEventListener('wheel', onWheel, passive_param);\n  } else {\n    window.addEventListener('DOMMouseScroll', onWheel, false);\n    window.addEventListener('mousewheel', onWheel, false);\n  }\n\n  window.addEventListener('blur', onBlurOrFocus, false);\n  window.addEventListener('focus', onBlurOrFocus, false);\n\n  handleTouches(canvas);\n\n  // For iOS, this is needed in test_fullscreen, but not here, for some reason\n  //window.addEventListener('gesturestart', ignored, false);\n\n  window.addEventListener('beforeunload', beforeUnload, false);\n}\n\n\nconst DEADZONE = 0.26;\nconst DEADZONE_SQ = DEADZONE * DEADZONE;\nconst NUM_STICKS = 2;\nconst PAD_THRESHOLD = 0.35; // for turning analog motion into digital events\n\nfunction getGamepadData(idx) {\n  let gpd = gamepad_data[idx];\n  if (!gpd) {\n    gpd = gamepad_data[idx] = {\n      id: idx,\n      timestamp: 0,\n      sticks: new Array(NUM_STICKS),\n    };\n    for (let ii = 0; ii < NUM_STICKS; ++ii) {\n      gpd.sticks[ii] = vec2();\n    }\n    pad_states[idx] = {};\n  }\n  return gpd;\n}\n\nfunction updatePadState(gpd, ps, b, padcode) {\n  if (b && !ps[padcode]) {\n    ps[padcode] = DOWN_EDGE;\n    onUserInput();\n    if (touch_mode) {\n      local_storage.set('touch_mode', false);\n      touch_mode = false;\n    }\n    if (!pad_mode) {\n      local_storage.setJSON('pad_mode', true);\n      pad_mode = true;\n    }\n    if (padcode === pad_to_touch) {\n      let touch_id = `g${gpd.id}`;\n      if (touches[touch_id]) {\n        setMouseToMid();\n        v2copy(touches[touch_id].start_pos, mouse_pos);\n      } else {\n        touches[touch_id] = new TouchData(mouse_pos, false, 0, null);\n      }\n      touches[touch_id].down(null, true);\n    }\n  } else if (!b && ps[padcode]) {\n    ps[padcode] = UP_EDGE;\n    if (padcode === pad_to_touch) {\n      let touch_id = `g${gpd.id}`;\n      let touch_data = touches[touch_id];\n      if (touch_data) {\n        setMouseToMid();\n        v2copy(touch_data.cur_pos, mouse_pos);\n        registerMouseUpEdge(touch_data, engine.hrtime);\n        touch_data.state = UP;\n        touch_data.down_time += max(engine.hrtime - touch_data.origin_time, MIN_EVENT_TIME_DELTA);\n      }\n    }\n  }\n}\n\nfunction gamepadUpdate() {\n  let gamepads;\n  try {\n    gamepads = (navigator.gamepads ||\n      navigator.webkitGamepads ||\n      (navigator.getGamepads && navigator.getGamepads()) ||\n      (navigator.webkitGetGamepads && navigator.webkitGetGamepads()));\n  } catch (e) {\n    // Firefox blocks gamepad access sometimes, just ignore it we can't access it\n  }\n\n  if (gamepads) {\n    let numGamePads = gamepads.length;\n    for (let ii = 0; ii < numGamePads; ii++) {\n      let gamepad = gamepads[ii];\n      if (!gamepad) {\n        continue;\n      }\n      let gpd = getGamepadData(ii);\n      let ps = pad_states[ii];\n      // Update button states\n      if (gpd.timestamp < gamepad.timestamp) {\n        let buttons = gamepad.buttons;\n        gpd.timestamp = gamepad.timestamp;\n\n        let numButtons = buttons.length;\n        for (let n = 0; n < numButtons; n++) {\n          let value = buttons[n];\n          if (typeof value === 'object') {\n            value = value.value;\n          }\n          value = value > 0.5;\n          updatePadState(gpd, ps, value, n);\n        }\n      }\n\n      // Update axes states\n      let axes = gamepad.axes;\n      if (axes.length >= NUM_STICKS * 2) {\n        for (let n = 0; n < NUM_STICKS; ++n) {\n          let pair = gpd.sticks[n];\n          v2set(pair, axes[n*2], -axes[n*2 + 1]);\n          let magnitude = v2lengthSq(pair);\n          if (magnitude > DEADZONE_SQ) {\n            magnitude = sqrt(magnitude);\n\n            // Normalize lX and lY\n            v2scale(pair, pair, 1 / magnitude);\n\n            // Clip the magnitude at its max possible value\n            magnitude = min(magnitude, 1);\n\n            // Adjust magnitude relative to the end of the dead zone\n            magnitude = ((magnitude - DEADZONE) / (1 - DEADZONE));\n\n            v2scale(pair, pair, magnitude);\n          } else {\n            v2set(pair, 0, 0);\n          }\n\n          // Apply \"movement\" to drag events\n          if (n <= 1 && pad_to_touch !== undefined) {\n            let touch_data = touches[`g${gpd.id}`];\n            if (touch_data) {\n              v2scale(temp_delta, pair, engine.frame_dt);\n              v2add(touch_data.delta, touch_data.delta, temp_delta);\n              touch_data.total += abs(temp_delta[0]) + abs(temp_delta[1]);\n              setMouseToMid();\n              v2copy(touch_data.cur_pos, mouse_pos);\n            }\n          }\n        }\n\n        // Calculate virtual directional buttons\n        updatePadState(gpd, ps, gpd.sticks[0][0] < -PAD_THRESHOLD, PAD.LSTICK_LEFT);\n        updatePadState(gpd, ps, gpd.sticks[0][0] > PAD_THRESHOLD, PAD.LSTICK_RIGHT);\n        updatePadState(gpd, ps, gpd.sticks[0][1] < -PAD_THRESHOLD, PAD.LSTICK_DOWN);\n        updatePadState(gpd, ps, gpd.sticks[0][1] > PAD_THRESHOLD, PAD.LSTICK_UP);\n\n        updatePadState(gpd, ps, gpd.sticks[1][0] < -PAD_THRESHOLD, PAD.RSTICK_LEFT);\n        updatePadState(gpd, ps, gpd.sticks[1][0] > PAD_THRESHOLD, PAD.RSTICK_RIGHT);\n        updatePadState(gpd, ps, gpd.sticks[1][1] < -PAD_THRESHOLD, PAD.RSTICK_DOWN);\n        updatePadState(gpd, ps, gpd.sticks[1][1] > PAD_THRESHOLD, PAD.RSTICK_UP);\n      }\n    }\n  }\n}\n\nexport function fakeTouchEvent(is_down) {\n  const touch_id = 'faketouch';\n  let touch_data = touches[touch_id];\n  if (touch_data && !is_down) {\n    setMouseToMid();\n    v2copy(touch_data.cur_pos, mouse_pos);\n    registerMouseUpEdge(touch_data, engine.hrtime);\n    touch_data.state = UP;\n    touch_data.down_time += max(engine.hrtime - touch_data.origin_time, MIN_EVENT_TIME_DELTA);\n  } else if (!touch_data && is_down) {\n    setMouseToMid();\n    touches[touch_id] = new TouchData(mouse_pos, false, 0, null);\n  }\n}\n\nexport function tickInput() {\n  // browser frame has occurred since the call to endFrame(),\n  // we should now have `touches` and `key_state` populated with edge events\n  if (movement_questionable_frames) {\n    --movement_questionable_frames;\n  }\n\n  // update timing of key down states\n  let hrtime = engine.hrtime;\n  for (let code in key_state_new) {\n    let ks = key_state_new[code];\n    if (ks.state === DOWN) {\n      ks.down_time += max(hrtime - ks.origin_time, MIN_EVENT_TIME_DELTA);\n      // assert(hrtime >= ks.origin_time); - should be true, but often isn't\n      ks.origin_time = hrtime;\n    }\n  }\n\n  for (let touch_id in touches) {\n    let touch_data = touches[touch_id];\n    if (touch_data.state === DOWN) {\n      touch_data.down_time += max(hrtime - touch_data.origin_time, MIN_EVENT_TIME_DELTA);\n      // assert(hrtime >= touch_data.origin_time); - should be true, but often isn't\n      touch_data.origin_time = hrtime;\n    }\n  }\n\n  mouse_over_captured = false;\n  gamepadUpdate();\n  in_event.topOfFrame();\n  ctrl_checked = false;\n  if (touches[pointerlock_touch_id] && !pointerLocked()) {\n    pointerLockExit();\n  }\n}\n\nfunction endFrameTickMap(map) {\n  Object.keys(map).forEach((keycode) => {\n    switch (map[keycode]) {\n      case DOWN_EDGE:\n        map[keycode] = DOWN;\n        break;\n      case UP_EDGE:\n        delete map[keycode];\n        break;\n      default:\n    }\n  });\n}\nexport function endFrame(skip_mouse) {\n  for (let code in key_state_new) {\n    let ks = key_state_new[code];\n    if (ks.state === UP) {\n      key_state_new[code] = null;\n      delete key_state_new[code];\n    } else {\n      ks.up_edge = 0;\n      ks.down_edge = 0;\n      ks.down_time = 0;\n    }\n  }\n\n  pad_states.forEach(endFrameTickMap);\n  if (!skip_mouse) {\n    for (let touch_id in touches) {\n      let touch_data = touches[touch_id];\n      if (touch_data.state === UP) {\n        // Manually null out touches[touch_id] - some Chrome optimizer bug causes\n        // callers to later get this old value (instead of the newly added on with\n        // the same ID) unless we null it out (then they seem to get the new one).\n        touches[touch_id] = null;\n        delete touches[touch_id];\n      } else {\n        touch_data.delta[0] = touch_data.delta[1] = 0;\n        touch_data.dispatched = false;\n        touch_data.dispatched_drag = false;\n        touch_data.dispatched_drag_over = false;\n        if (touch_data.drag_payload_frame === engine.frame_index - 2) {\n          // Clear this after an entire frame of not being set (usually, things\n          // on the next frame will need to get the payload that was set later\n          // in the previous frame)\n          touch_data.drag_payload = null;\n        }\n        touch_data.up_edge = 0;\n        touch_data.down_edge = 0;\n        touch_data.down_time = 0;\n      }\n    }\n    wheel_events.length = 0;\n    input_eaten_mouse = false;\n    mouse_moved = false;\n    mouse_button_had_edge = false;\n    mouse_button_had_up_edge = false;\n  }\n  input_eaten_kb = false;\n}\n\nexport function tickInputInactive() {\n  in_event.topOfFrame();\n  ctrl_checked = false;\n  endFrame();\n}\n\nexport function eatAllInput(skip_mouse) {\n  // destroy touches, remove all down and up edges\n  endFrame(skip_mouse);\n  if (!skip_mouse) {\n    mouse_over_captured = true;\n    input_eaten_mouse = true;\n  }\n  input_eaten_kb = true;\n}\n\nexport function eatAllKeyboardInput() {\n  eatAllInput(true);\n}\n\n// returns position mapped to current camera view\nexport function mousePos(dst) {\n  dst = dst || vec2();\n  camera2d.domToVirtual(dst, mouse_pos);\n  return dst;\n}\n\nexport function mouseDomPos() {\n  return mouse_pos;\n}\n\nexport function mouseMoved() {\n  return mouse_moved;\n}\n\nexport function mouseButtonHadEdge() {\n  return mouse_button_had_edge;\n}\n\nexport function mouseButtonHadUpEdge() {\n  return mouse_button_had_up_edge;\n}\n\nfunction mousePosParam(param) {\n  param = param || {};\n  return {\n    x: param.x === undefined ? camera2d.x0Real() : param.x,\n    y: param.y === undefined ? camera2d.y0Real() : param.y,\n    w: param.w === undefined ? camera2d.wReal() : param.w,\n    h: param.h === undefined ? camera2d.hReal() : param.h,\n    button: param.button === undefined ? ANY : param.button,\n  };\n}\n\nlet check_pos = vec2();\nfunction checkPos(pos, param) {\n  if (!camera2d.domToVirtual(check_pos, pos)) {\n    return false;\n  }\n  return check_pos[0] >= param.x && (param.w === Infinity || check_pos[0] < param.x + param.w) &&\n    check_pos[1] >= param.y && (param.h === Infinity || check_pos[1] < param.y + param.h);\n}\n\nfunction wasDoubleClick(pos_param) {\n  if (engine.hrtime - last_up_edges[0].timestamp > settings.double_click_time) {\n    return false;\n  }\n  return checkPos(last_up_edges[0].pos, pos_param);\n}\n\nexport function mouseWheel(param) {\n  if (input_eaten_mouse || !wheel_events.length) {\n    return 0;\n  }\n  param = param || {};\n  let pos_param = mousePosParam(param);\n  let ret = 0;\n  for (let ii = 0; ii < wheel_events.length; ++ii) {\n    let data = wheel_events[ii];\n    if (data.dispatched) {\n      continue;\n    }\n    if (checkPos(data.pos, pos_param)) {\n      ret += data.delta;\n      data.dispatched = true;\n    }\n  }\n  return ret;\n}\n\nexport function mouseOverCaptured() {\n  mouse_over_captured = true;\n}\n\nexport function mouseOver(param) {\n  profilerStartFunc();\n  param = param || {};\n  let pos_param = mousePosParam(param);\n  spotMouseoverHook(pos_param, param);\n  if (mouse_over_captured || pointerLocked() && !param.allow_pointerlock) {\n    profilerStopFunc();\n    return false;\n  }\n\n  // eat mouse up/down/drag events\n  if (!param.peek && !param.peek_touch) {\n    for (let id in touches) {\n      let touch = touches[id];\n      if (checkPos(touch.cur_pos, pos_param)) {\n        touch.down_edge = 0;\n        touch.up_edge = 0;\n        if (!param || !param.drag_target) {\n          touch.dispatched = true;\n        }\n      }\n    }\n  }\n\n  let ret = false;\n  if (checkPos(mouse_pos, pos_param)) {\n    if (!param.peek && !param.peek_over) {\n      mouse_over_captured = true;\n    }\n    ret = true;\n  }\n  profilerStopFunc();\n  return ret;\n}\n\nexport function mouseDown(param) {\n  if (input_eaten_mouse) {\n    return null;\n  }\n  param = param || {};\n  let pos_param = mousePosParam(param);\n  let button = pos_param.button;\n  let max_click_dist = Infinity;\n  if (param.do_max_dist) {\n    // Defaulting to the same as mouseUpEdge()\n    max_click_dist = param.max_dist || 50; // TODO: relative to camera distance?\n  }\n\n  for (let touch_id in touches) {\n    let touch_data = touches[touch_id];\n    if (touch_data.state !== DOWN ||\n      !(button === ANY || button === touch_data.button) ||\n      touch_data.total > max_click_dist\n    ) {\n      continue;\n    }\n    if (checkPos(touch_data.cur_pos, pos_param)) {\n      // if (!param.peek) {\n      //   touch_data.up_edge = 0;\n      // }\n      return {\n        button: touch_data.button,\n        pos: check_pos.slice(0),\n        start_time: touch_data.start_time,\n      };\n    }\n  }\n\n  return null;\n}\n\nexport function mousePosIsTouch() {\n  return mouse_pos_is_touch;\n}\n\nexport function numTouches() {\n  return Object.keys(touches).length;\n}\n\nexport function keyDown(keycode) {\n  if (keycode === KEYS.CTRL) {\n    ctrl_checked = true;\n  }\n  if (input_eaten_kb) {\n    return 0;\n  }\n  let ks = key_state_new[keycode];\n  if (!ks) {\n    return 0;\n  }\n  if (ks.state === DOWN) {\n    assert(ks.down_time); // Will fire if we call keyDown() before tickInput()\n  }\n  return ks.down_time;\n}\nexport function keyDownEdge(keycode, opts) {\n  if (input_eaten_kb) {\n    return 0;\n  }\n\n  if (opts && opts.in_event_cb) {\n    in_event.on('keydown', keycode, opts.in_event_cb);\n  }\n\n  let ks = key_state_new[keycode];\n  if (!ks) {\n    return 0;\n  }\n  let r = ks.down_edge;\n  ks.down_edge = 0;\n  return r;\n}\nexport function keyUpEdge(keycode, opts) {\n  if (input_eaten_kb) {\n    return 0;\n  }\n\n  if (opts && opts.in_event_cb) {\n    in_event.on('keyup', keycode, opts.in_event_cb);\n  }\n\n  let ks = key_state_new[keycode];\n  if (!ks) {\n    return 0;\n  }\n  let r = ks.up_edge;\n  ks.up_edge = 0;\n  return r;\n}\n\nexport function padGetAxes(out, stickindex, padindex) {\n  assert(stickindex >= 0 && stickindex < NUM_STICKS);\n  if (padindex === undefined) {\n    let sub = vec2();\n    v2set(out, 0, 0);\n    for (let ii = 0; ii < gamepad_data.length; ++ii) {\n      padGetAxes(sub, stickindex, ii);\n      v2add(out, out, sub);\n    }\n    return;\n  }\n  let sticks = getGamepadData(padindex).sticks;\n  v2copy(out, sticks[stickindex]);\n}\n\nfunction padButtonDownInternal(gpd, ps, padcode) {\n  if (ps[padcode]) {\n    return engine.frame_dt;\n  }\n  return 0;\n}\nfunction padButtonDownEdgeInternal(gpd, ps, padcode) {\n  if (ps[padcode] === DOWN_EDGE) {\n    ps[padcode] = DOWN;\n    return 1;\n  }\n  return 0;\n}\nfunction padButtonUpEdgeInternal(gpd, ps, padcode) {\n  if (ps[padcode] === UP_EDGE) {\n    delete ps[padcode];\n    return 1;\n  }\n  return 0;\n}\n\nfunction padButtonShared(fn, padcode, padindex) {\n  assert(padcode !== undefined);\n  let r = 0;\n  // Handle calling without a specific pad index\n  if (padindex === undefined) {\n    for (let ii = 0; ii < pad_states.length; ++ii) {\n      r += padButtonShared(fn, padcode, ii);\n    }\n    return r;\n  }\n\n  if (input_eaten_mouse) {\n    return 0;\n  }\n  let gpd = gamepad_data[padindex];\n  if (!gpd) {\n    return 0;\n  }\n  let ps = pad_states[padindex];\n\n  let am = ANALOG_MAP[padcode];\n  if (am) {\n    for (let ii = 0; ii < am.length; ++ii) {\n      r += fn(gpd, ps, am[ii]) || 0;\n    }\n  }\n  r += fn(gpd, ps, padcode);\n  return r;\n}\nexport function padButtonDown(padcode, padindex) {\n  return padButtonShared(padButtonDownInternal, padcode, padindex);\n}\nexport function padButtonDownEdge(padcode, padindex) {\n  return padButtonShared(padButtonDownEdgeInternal, padcode, padindex);\n}\nexport function padButtonUpEdge(padcode, padindex) {\n  return padButtonShared(padButtonUpEdgeInternal, padcode, padindex);\n}\n\nlet start_pos = vec2();\nlet cur_pos = vec2();\nlet delta = vec2();\n\nexport function mouseUpEdge(param) {\n  param = param || {};\n  let pos_param = mousePosParam(param);\n  let button = pos_param.button;\n  let max_click_dist = param.max_dist || 50; // TODO: relative to camera distance?\n  let dragged_too_far = false;\n\n  for (let touch_id in touches) {\n    let touch_data = touches[touch_id];\n    if (touch_data.total > max_click_dist) {\n      // Do *not* register in_event_cb, would fire even when we would disregard this click\n      dragged_too_far = true;\n      continue;\n    }\n    if (!touch_data.up_edge) {\n      continue;\n    }\n    if (touch_data.long_press_dispatched) {\n      // If this touch has already triggered a long-press, do not additionally trigger a click\n      continue;\n    }\n    if (!(button === ANY || button === touch_data.button)) {\n      continue;\n    }\n    if (checkPos(touch_data.cur_pos, pos_param)) {\n      if (!param.peek) {\n        touch_data.up_edge = 0;\n      }\n      return {\n        button: touch_data.button,\n        pos: check_pos.slice(0),\n        start_time: touch_data.start_time,\n        was_double_click: wasDoubleClick(pos_param),\n      };\n    }\n  }\n\n  if (param.in_event_cb && !input_eaten_mouse && !mouse_over_captured && !dragged_too_far) {\n    // TODO: Maybe need to also pass along earlier exclusions?  Working okay for now though.\n    if (!param.phys) {\n      param.phys = {};\n    }\n    param.phys.button = typeof param.in_event_button === 'number' ? param.in_event_button : button;\n    camera2d.virtualToDomPosParam(param.phys, pos_param);\n    in_event.on('mouseup', param.phys, param.in_event_cb);\n  }\n  return false;\n}\n\nexport function mouseDownEdge(param) {\n  param = param || {};\n  let pos_param = mousePosParam(param);\n  let button = pos_param.button;\n\n  for (let touch_id in touches) {\n    let touch_data = touches[touch_id];\n    if (!touch_data.down_edge ||\n      !(button === ANY || button === touch_data.button)\n    ) {\n      continue;\n    }\n    if (checkPos(touch_data.cur_pos, pos_param)) {\n      if (!param.peek) {\n        touch_data.down_edge = 0;\n      }\n      return {\n        button: touch_data.button,\n        pos: check_pos.slice(0),\n        start_time: touch_data.start_time,\n      };\n    }\n  }\n\n  if (param.in_event_cb && !input_eaten_mouse && !mouse_over_captured) {\n    // TODO: Maybe need to also pass along earlier exclusions?  Working okay for now though.\n    if (!param.phys) {\n      param.phys = {};\n    }\n    param.phys.button = button;\n    camera2d.virtualToDomPosParam(param.phys, pos_param);\n    in_event.on('mousedown', param.phys, param.in_event_cb);\n  }\n  return false;\n}\n\n// Completely consume any clicks or drags coming from a mouse down event in this\n// area - used to catch focus leaving an edit box without wanting to do what\n// a click would normally do.\nexport function mouseConsumeClicks(param) {\n  param = param || {};\n  let pos_param = mousePosParam(param);\n  let button = pos_param.button;\n  for (let touch_id in touches) {\n    let touch_data = touches[touch_id];\n    // Skipping those that already dispatched a drag this frame, must have been handled, do not consume it!\n    if (!(button === ANY || button === touch_data.button) || touch_data.dispatched_drag) {\n      continue;\n    }\n    if (checkPos(touch_data.start_pos, pos_param)) {\n      touch_data.down_edge = 0;\n      // Set start pos so that it will not pass checkPos\n      touch_data.start_pos[0] = touch_data.start_pos[1] = Infinity;\n      // Set .total so that mouseUpEdge will not detect it as a click\n      touch_data.total = Infinity;\n    }\n  }\n}\n\nexport function drag(param) {\n  param = param || {};\n  let pos_param = mousePosParam(param);\n  let button = pos_param.button;\n  let min_dist = param.min_dist || 0;\n\n  for (let touch_id in touches) {\n    let touch_data = touches[touch_id];\n    if (!(button === ANY || button === touch_data.button) || touch_data.dispatched_drag) {\n      continue;\n    }\n    if (checkPos(touch_data.start_pos, pos_param)) {\n      camera2d.domDeltaToVirtual(delta, [touch_data.total/2, touch_data.total/2]);\n      let total = delta[0] + delta[1];\n      if (total < min_dist) {\n        continue;\n      }\n      if (!param.peek) {\n        touch_data.dispatched_drag = true;\n      }\n      let is_down_edge = touch_data.down_edge;\n      if (param.eat_clicks) {\n        touch_data.down_edge = touch_data.up_edge = 0;\n      }\n      if (param.payload) {\n        touch_data.drag_payload = param.payload;\n        touch_data.drag_payload_frame = engine.frame_index;\n      }\n      camera2d.domToVirtual(start_pos, touch_data.start_pos);\n      camera2d.domToVirtual(cur_pos, touch_data.cur_pos);\n      camera2d.domDeltaToVirtual(delta, touch_data.delta);\n      return {\n        cur_pos,\n        start_pos,\n        delta, // this frame's delta\n        total, // total (linear) distance dragged\n        button: touch_data.button,\n        touch: touch_data.touch,\n        start_time: touch_data.start_time,\n        is_down_edge,\n        down_time: touch_data.down_time,\n      };\n    }\n  }\n  return null;\n}\n\n// a lot like drag(), refactor to share more?\nexport function longPress(param) {\n  param = param || {};\n  let pos_param = mousePosParam(param);\n  let button = pos_param.button;\n  let max_dist = param.long_press_max_dist || 50;\n  let min_time = param.min_time || 500;\n\n  for (let touch_id in touches) {\n    let touch_data = touches[touch_id];\n    if (!(button === ANY || button === touch_data.button) || touch_data.long_press_dispatched) {\n      continue;\n    }\n    if (checkPos(touch_data.start_pos, pos_param)) {\n      camera2d.domDeltaToVirtual(delta, [touch_data.total/2, touch_data.total/2]);\n      let total = delta[0] + delta[1];\n      if (total > max_dist) {\n        continue;\n      }\n      let time = Date.now() - touch_data.start_time;\n      if (time < min_time) {\n        continue;\n      }\n      if (!param.peek) {\n        // ? touch_data.dispatched = true;\n        touch_data.long_press_dispatched = true;\n      }\n      let is_down_edge = touch_data.down_edge;\n      if (param.eat_clicks) {\n        touch_data.down_edge = touch_data.up_edge = 0;\n      }\n      camera2d.domToVirtual(start_pos, touch_data.start_pos);\n      camera2d.domToVirtual(cur_pos, touch_data.cur_pos);\n      camera2d.domDeltaToVirtual(delta, touch_data.delta);\n      return {\n        long_press: true,\n        cur_pos,\n        start_pos,\n        delta, // this frame's delta\n        total, // total (linear) distance dragged\n        button: touch_data.button,\n        touch: touch_data.touch,\n        start_time: touch_data.start_time,\n        is_down_edge,\n        down_time: touch_data.down_time,\n      };\n    }\n  }\n  return null;\n}\n\nexport function dragDrop(param) {\n  param = param || {};\n  let pos_param = mousePosParam(param);\n  let button = pos_param.button;\n\n  for (let touch_id in touches) {\n    let touch_data = touches[touch_id];\n    // Maybe touch_data.dispatched_drag_over instead/as well?\n    if (!(button === ANY || button === touch_data.button) || touch_data.dispatched || !touch_data.drag_payload) {\n      continue;\n    }\n    if (!touch_data.up_edge) {\n      continue;\n    }\n    if (checkPos(touch_data.cur_pos, pos_param)) {\n      if (!param.peek) {\n        // don't want the source (possibly called later this frame) to still think it's dragging\n        touch_data.dispatched_drag_over = true;\n        touch_data.dispatched_drag = true;\n        touch_data.dispatched = true;\n      }\n      return { drag_payload: touch_data.drag_payload };\n    }\n  }\n  return null;\n}\n\nexport function dragOver(param) {\n  param = param || {};\n  let pos_param = mousePosParam(param);\n  let button = pos_param.button;\n\n  for (let touch_id in touches) {\n    let touch_data = touches[touch_id];\n    if (!(button === ANY || button === touch_data.button) ||\n      touch_data.dispatched_drag_over ||\n      !touch_data.drag_payload\n    ) {\n      continue;\n    }\n    if (touch_data.state !== DOWN) {\n      continue;\n    }\n    if (checkPos(touch_data.cur_pos, pos_param)) {\n      // Separate 'dispatched' for dragOver (target) and drag (source) - they both need one dispatch per frame\n      if (!param.peek) {\n        touch_data.dispatched_drag_over = true;\n      }\n      camera2d.domToVirtual(cur_pos, touch_data.cur_pos);\n      return {\n        cur_pos,\n        drag_payload: touch_data.drag_payload\n      };\n    }\n  }\n  return null;\n}\n","// Portions Copyright 2020 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst engine = require('./engine.js');\nconst { style } = require('./font.js');\nconst camera2d = require('./camera2d.js');\nconst in_event = require('./in_event.js');\nconst input = require('./input.js');\nconst { abs } = Math;\nconst { uiGetDOMElem } = require('./ui.js');\nconst ui = require('./ui.js');\nconst settings = require('./settings.js');\nconst { SPOT_DEFAULT_BUTTON, spot, spotFocusSteal, spotKey } = require('./spot.js');\n\nlet style_link_default = style(null, {\n  color: 0x5040FFff,\n  outline_width: 1.0,\n  outline_color: 0x00000020,\n});\nlet style_link_hover_default = style(null, {\n  color: 0x0000FFff,\n  outline_width: 1.0,\n  outline_color: 0x00000020,\n});\n\nexport function linkGetDefaultStyle() {\n  return style_link_default;\n}\n\nlet state_cache = {};\nlet good_url = /https?:\\/\\//;\n\nfunction preventFocus(evt) {\n  evt.preventDefault();\n  if (evt.relatedTarget) {\n    // Revert focus back to previous blurring element (canvas or edit box)\n    evt.relatedTarget.focus();\n  } else {\n    // No previous focus target, blur instead\n    evt.currentTarget.blur();\n  }\n}\n\n// Create an invisible A elem in the DOM so we get all of the good browsery\n// behavior for a link area.\nexport function link(param) {\n  let { x, y, w, h, url, internal, allow_modal } = param;\n  if (!url.match(good_url)) {\n    url = `${document.location.protocol}//${url}`;\n  }\n  let key = spotKey(param);\n  let state = state_cache[key];\n  if (!state) {\n    state = state_cache[key] = { clicked: false };\n  }\n  state.frame = engine.frame_index;\n\n  let rect = { x, y, w, h };\n\n  // TODO: use spot_ret.allow_focus instead of all of this?\n  if (camera2d.clipTestRect(rect) && !(settings.shader_debug || settings.show_profiler)) {\n    // at least some is not clipped\n    let elem = uiGetDOMElem(state.elem, allow_modal);\n    if (elem !== state.elem) {\n      state.elem = elem;\n      if (elem) {\n        // new DOM element, initialize\n        elem.textContent = '';\n        let a_elem = document.createElement('a');\n        a_elem.setAttribute('draggable', false);\n        a_elem.textContent = ' ';\n        a_elem.className = 'glovui_link noglov';\n        a_elem.setAttribute('target', '_blank');\n        a_elem.setAttribute('href', url);\n        // Make the element unfocusable, so that pressing enter at some point\n        //   after clicking a link does not re-activate the link, additionally\n        //   pressing tab should not (in the browser) focus these links.\n        a_elem.setAttribute('tabindex', '-1');\n        a_elem.addEventListener('focus', preventFocus);\n        state.url = url;\n        if (internal) {\n          let down_x;\n          let down_y;\n          input.handleTouches(a_elem);\n          a_elem.onmousedown = function (ev) {\n            down_x = ev.pageX;\n            down_y = ev.pageY;\n          };\n          a_elem.onclick = function (ev) {\n            ev.preventDefault();\n            if (down_x) {\n              let dist = abs(ev.pageX - down_x) + abs(ev.pageY - down_y);\n              if (dist > 50) {\n                return;\n              }\n            }\n            state.clicked = true;\n            in_event.handle('mouseup', ev);\n          };\n        }\n        elem.appendChild(a_elem);\n        state.a_elem = a_elem;\n      }\n    }\n    if (elem) {\n      if (url !== state.url) {\n        state.a_elem.setAttribute('href', url);\n        state.url = url;\n      }\n\n      let pos = camera2d.htmlPos(rect.x, rect.y);\n      elem.style.left = `${pos[0]}%`;\n      elem.style.top = `${pos[1]}%`;\n      let size = camera2d.htmlSize(rect.w, rect.h);\n      elem.style.width = `${size[0]}%`;\n      elem.style.height = `${size[1]}%`;\n    }\n  }\n  let clicked = state.clicked;\n  state.clicked = false;\n  return clicked;\n}\n\nexport function linkText(param) {\n  let { style_link, style_link_hover, x, y, z, font_size, text, url, internal } = param;\n  text = text || url;\n  z = z || Z.UI;\n  font_size = font_size || ui.font_height;\n  // Also: any parameter to link(), e.g. url\n  let w = ui.font.getStringWidth(style_link || style_link_default, font_size, text);\n  let h = font_size;\n  param.w = w;\n  param.h = h;\n  param.def = SPOT_DEFAULT_BUTTON;\n  let spot_ret = spot(param);\n  let style_use = spot_ret.focused ?\n    (style_link_hover || style_link_hover_default) :\n    (style_link || style_link_default);\n  ui.font.drawSized(style_use, x, y, z, font_size, text);\n  let underline_w = 1;\n  ui.drawLine(x, y + h - underline_w, x + w, y + h - underline_w, z - 0.5, underline_w, 1, style_use.color_vec4);\n  let clicked = link(param);\n  if (clicked) {\n    spotFocusSteal(param);\n  }\n  if (spot_ret.ret && !internal) {\n    // activated (via keyboard or gamepad), and an external link, act as if we clicked it\n    let key = spotKey(param);\n    let state = state_cache[key];\n    assert(state);\n    assert(state.a_elem);\n    state.a_elem.click();\n  }\n  return clicked || spot_ret.ret;\n}\n\nexport function linkTick() {\n  for (let key in state_cache) {\n    let state = state_cache[key];\n    if (state.frame !== engine.frame_index - 1) {\n      delete state_cache[key];\n    }\n  }\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint-env browser */\n\nimport assert from 'assert';\n\n// Old API exports\nexports.get = localStorageGet; // eslint-disable-line no-use-before-define\nexports.set = localStorageSet; // eslint-disable-line no-use-before-define\nexports.setJSON = localStorageSetJSON; // eslint-disable-line no-use-before-define\nexports.getJSON = localStorageGetJSON; // eslint-disable-line no-use-before-define\nexports.clearAll = localStorageClearAll; // eslint-disable-line no-use-before-define\n\nlet storage_prefix = 'demo';\n\nlet is_set = false;\nexport function setStoragePrefix(prefix: string): void {\n  if (is_set) {\n    return;\n  }\n  is_set = true;\n  storage_prefix = prefix;\n}\nexport function getStoragePrefix(): string {\n  assert(is_set);\n  return storage_prefix;\n}\n\nlet lsd = (function () {\n  try {\n    localStorage.setItem('test', 'test');\n    localStorage.removeItem('test');\n    return localStorage;\n  } catch (e) {\n    return null; // Use lsd_overlay only instead\n  }\n}());\n\n// Overlay to use if we lose access to localStorage at run-time (Firefox \"quota exceeded\" error)\nlet lsd_overlay: Partial<Record<string, string>> = {};\n\nexport function localStorageGet(key: string): string | undefined {\n  assert(is_set);\n  key = `${storage_prefix}_${key}`;\n  let ret: string | null | undefined = lsd_overlay[key] || (lsd && lsd.getItem(key));\n  if (ret === 'undefined') {\n    ret = undefined;\n  } else if (ret === null) {\n    ret = undefined;\n  }\n  return ret;\n}\n\nexport function localStorageSet(key: string, value: unknown): void {\n  assert(is_set);\n  key = `${storage_prefix}_${key}`;\n  if (value === undefined || value === null) {\n    if (lsd) {\n      lsd.removeItem(key);\n    }\n    delete lsd_overlay[key];\n  } else {\n    let str = String(value);\n    lsd_overlay[key] = str;\n    try {\n      if (lsd) {\n        lsd.setItem(key, str);\n      }\n    } catch (e) {\n      // ignored, it's in the overlay for the current session at least\n      // FireFox throws \"The quota has been exceeded\" errors here\n    }\n  }\n}\n\nexport function localStorageSetJSON(key: string, value: unknown): void {\n  localStorageSet(key, JSON.stringify(value));\n}\n\nexport function localStorageGetJSON<T = unknown>(key: string, def?: T): T | undefined {\n  let value = localStorageGet(key);\n  if (value === undefined) {\n    return def;\n  }\n  try {\n    return JSON.parse(value);\n  } catch (e) {\n    // ignore\n  }\n  return def;\n}\n\nexport function localStorageClearAll(key_prefix?: string): void {\n  let prefix = new RegExp(`^${storage_prefix}_${key_prefix || ''}`, 'u');\n  if (lsd) {\n    let keysToRemove = [];\n    for (let i = 0; i < lsd.length; i++) {\n      let key = lsd.key(i);\n      assert(key);\n      if (key.match(prefix)) {\n        keysToRemove.push(key);\n      }\n    }\n    for (let i = 0; i < keysToRemove.length; i++) {\n      lsd.removeItem(keysToRemove[i]);\n    }\n  }\n  for (let key in lsd_overlay) {\n    if (key.match(prefix)) {\n      delete lsd_overlay[key];\n    }\n  }\n}\n\nexport function localStorageExportAll(): string {\n  let obj: Partial<Record<string, unknown>> = {};\n  let prefix = new RegExp(`^${storage_prefix}_(.*)`, 'u');\n  if (lsd) {\n    for (let i = 0; i < lsd.length; i++) {\n      let key = lsd.key(i);\n      assert(key);\n      let m = key.match(prefix);\n      if (m) {\n        let v = lsd.getItem(key);\n        if (v !== 'undefined') {\n          obj[m[1]] = v;\n        }\n      }\n    }\n  }\n  for (let key in lsd_overlay) {\n    let m = key.match(prefix);\n    if (m) {\n      obj[m[1]] = lsd_overlay[key];\n    }\n  }\n  return JSON.stringify(obj);\n}\n\nexport function localStorageImportAll(serialized: string): void {\n  let obj = JSON.parse(serialized);\n  localStorageClearAll();\n  for (let key in obj) {\n    localStorageSet(key, obj[key]);\n  }\n}\n","export interface LocalizableString {\n  toLocalString(): string;\n}\n\nexport function getStringFromLocalizable(s: string | LocalizableString): string {\n  return s && (s as LocalizableString).toLocalString ?\n    (s as LocalizableString).toLocalString() :\n    (s as string);\n}\n\nexport function getStringIfLocalizable<T>(s: T | LocalizableString): T | string {\n  return s && (s as LocalizableString).toLocalString ?\n    (s as LocalizableString).toLocalString() :\n    (s as T);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n// Some code from Turbulenz: Copyright (c) 2012-2013 Turbulenz Limited\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nexport function mat43() {\n  let r = new Float32Array(12);\n  r[0] = r[4] = r[8] = 1;\n  return r;\n}\n\nexport function m43identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 1;\n  out[5] = 0;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 1;\n  out[9] = 0;\n  out[10] = 0;\n  out[11] = 0;\n}\n\nexport function m43mul(out, a, b) {\n  let a0 = a[0];\n  let a1 = a[1];\n  let a2 = a[2];\n  let a3 = a[3];\n  let a4 = a[4];\n  let a5 = a[5];\n  let a6 = a[6];\n  let a7 = a[7];\n  let a8 = a[8];\n  let a9 = a[9];\n  let a10 = a[10];\n  let a11 = a[11];\n\n  let b0 = b[0];\n  let b1 = b[1];\n  let b2 = b[2];\n  let b3 = b[3];\n  let b4 = b[4];\n  let b5 = b[5];\n  let b6 = b[6];\n  let b7 = b[7];\n  let b8 = b[8];\n\n  out[0] = (b0 * a0 + b3 * a1 + b6 * a2);\n  out[1] = (b1 * a0 + b4 * a1 + b7 * a2);\n  out[2] = (b2 * a0 + b5 * a1 + b8 * a2);\n  out[3] = (b0 * a3 + b3 * a4 + b6 * a5);\n  out[4] = (b1 * a3 + b4 * a4 + b7 * a5);\n  out[5] = (b2 * a3 + b5 * a4 + b8 * a5);\n  out[6] = (b0 * a6 + b3 * a7 + b6 * a8);\n  out[7] = (b1 * a6 + b4 * a7 + b7 * a8);\n  out[8] = (b2 * a6 + b5 * a7 + b8 * a8);\n  out[9] = (b0 * a9 + b3 * a10 + b6 * a11 + b[9]);\n  out[10] = (b1 * a9 + b4 * a10 + b7 * a11 + b[10]);\n  out[11] = (b2 * a9 + b5 * a10 + b8 * a11 + b[11]);\n\n  return out;\n}\n","// Derived from https://github.com/toji/gl-matrix/blob/master/src/mat4.js\n// Under MIT License\n\nmodule.exports = function (out, uniform_scale, quat, pos) {\n  // Quaternion math\n  let x = quat[0];\n  let y = quat[1];\n  let z = quat[2];\n  let w = quat[3];\n  let x2 = x + x;\n  let y2 = y + y;\n  let z2 = z + z;\n\n  let xx = x * x2;\n  let xy = x * y2;\n  let xz = x * z2;\n  let yy = y * y2;\n  let yz = y * z2;\n  let zz = z * z2;\n  let wx = w * x2;\n  let wy = w * y2;\n  let wz = w * z2;\n\n  out[0] = (1 - (yy + zz)) * uniform_scale;\n  out[1] = (xy + wz) * uniform_scale;\n  out[2] = (xz - wy) * uniform_scale;\n  out[3] = 0;\n  out[4] = (xy - wz) * uniform_scale;\n  out[5] = (1 - (xx + zz)) * uniform_scale;\n  out[6] = (yz + wx) * uniform_scale;\n  out[7] = 0;\n  out[8] = (xz + wy) * uniform_scale;\n  out[9] = (yz - wx) * uniform_scale;\n  out[10] = (1 - (xx + yy)) * uniform_scale;\n  out[11] = 0;\n  out[12] = pos[0];\n  out[13] = pos[1];\n  out[14] = pos[2];\n  out[15] = 1;\n\n  return out;\n};\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/*\n  Convert models to GLB with:\n  node_modules\\.bin\\gltf-pipeline.cmd -t -i src/client/models/box.gltf -o src/client/models/box.glb\n  // The -t tells it not to embed the textures, but just leave the URIs\n */\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst geom = require('./geom.js');\nconst glb_parser = require('./glb/parser.js');\nconst { ATTRIBUTE_TYPE_TO_COMPONENTS } = require('./glb/gltf-type-utils.js');\nconst renderer = require('./engine.js');\nconst { fetch } = require('./fetch.js');\nconst shaders = require('./shaders.js');\nconst textures = require('./textures.js');\nconst { vec4 } = require('glov/common/vmath.js');\nconst { webFSGetFile } = require('./webfs.js');\n\nexport let load_count = 0;\n\nexport let models = {};\n\nexport let default_vshader;\nexport let default_fshader;\n\nfunction initShaders() {\n  default_vshader = shaders.create('shaders/default.vp');\n  default_fshader = shaders.create('shaders/default.fp');\n  shaders.prelink(default_vshader, default_fshader);\n}\n\nfunction Model(url) {\n  this.url = url;\n  let idx = url.lastIndexOf('/');\n  if (idx !== -1) {\n    this.base_url = url.slice(0, idx + 1);\n  } else {\n    this.base_url = '';\n  }\n}\n\nModel.prototype.load = function () {\n  ++load_count;\n  fetch({\n    url: this.url,\n    response_type: 'arraybuffer',\n  }, (err, array_buffer) => {\n    --load_count;\n    if (err) {\n      window.onerror('Model loading error', 'models.js', 0, 0, err);\n    } else {\n      try {\n        this.parse(array_buffer);\n      } catch (e) {\n        window.onerror('Model loading error', 'models.js', 0, 0, e);\n      }\n    }\n  });\n};\n\nconst skip_attr = {\n  'TANGENT': true,\n};\n\nModel.prototype.parse = function (glb_data) {\n  let glb = glb_parser.parse(glb_data);\n  if (!glb) {\n    return;\n  }\n  // Make Geoms for each primitives within each mesh\n  let glb_json = glb.getJSON();\n  let objs = [];\n  for (let ii = 0; ii < glb_json.meshes.length; ++ii) {\n    let mesh = glb_json.meshes[ii];\n    for (let jj = 0; jj < mesh.primitives.length; ++jj) {\n      let primitives = mesh.primitives[jj];\n      let material = glb_json.materials[primitives.material];\n      let texture = null;\n      if (material) {\n        // Just grabbing the base color texture, nothing else\n        let bct = (material.pbrMetallicRoughness || {}).baseColorTexture || {};\n        let texture_def = glb_json.textures && glb_json.textures[bct.index] || {};\n        let sampler_def = glb_json.samplers && glb_json.samplers[texture_def.sampler] || {};\n        let image = glb_json.images && glb_json.images[texture_def.source] || {};\n        if (image.uri) {\n          let params = {\n            url: `${this.base_url}${image.uri}`,\n            filter_mag: sampler_def.magFilter,\n            filter_min: sampler_def.minFilter,\n            wrap_s: sampler_def.wrapS,\n            wrap_t: sampler_def.wrapT,\n          };\n          texture = textures.load(params);\n        }\n      }\n      let format = [];\n      let buffers = [];\n      let bidx = [];\n      let total_size = 0;\n      let vert_count = 0;\n      for (let attr in primitives.attributes) {\n        if (skip_attr[attr]) {\n          continue;\n        }\n        assert(shaders.semantic[attr] !== undefined);\n        let accessor = glb_json.accessors[primitives.attributes[attr]];\n        assert.equal(accessor.componentType, 5126); // F32\n        let geom_format = gl.FLOAT;\n        let geom_count = ATTRIBUTE_TYPE_TO_COMPONENTS[accessor.type];\n        assert(geom_count);\n        let my_vert_count = accessor.count/* / geom_count*/;\n        if (!vert_count) {\n          vert_count = my_vert_count;\n        } else {\n          assert.equal(vert_count, my_vert_count);\n        }\n        format.push([shaders.semantic[attr], geom_format, geom_count]);\n        let buffer = glb.getBuffer(accessor);\n        buffers.push(buffer);\n        bidx.push(0);\n        total_size += buffer.length;\n      }\n      // Interleave\n      let verts = new Float32Array(total_size);\n      let idx = 0;\n      for (let vert = 0; vert < vert_count; ++vert) {\n        for (let attr = 0; attr < format.length; ++attr) {\n          for (let kk = 0; kk < format[attr][2]; ++kk) {\n            verts[idx++] = buffers[attr][bidx[attr]++];\n          }\n        }\n      }\n      // Get indices\n      let accessor = glb_json.accessors[primitives.indices];\n      assert(accessor); // must be an indexed primitive set\n      assert.equal(accessor.type, 'SCALAR');\n      let idxs = glb.getBuffer(accessor);\n      if (accessor.componentType === 5125) { // Uint32\n        assert(vert_count < 65535); // Fits in 16-bits, doesn't use index 65535\n        // Just convert to 16-bit\n        idxs = new Uint16Array(idxs);\n      } else {\n        assert.equal(accessor.componentType, 5123); // Uint16\n      }\n      objs.push({\n        geom: geom.create(format, verts, idxs, primitives.mode),\n        texture,\n      });\n    }\n  }\n  // TODO: Something with nodes to tie together and position the meshes\n  this.data = {\n    objs,\n    // glb, - Don't keep this, release it and any unreferenced data/buffers\n  };\n};\n\nModel.prototype.draw = function (mat) {\n  renderer.updateMatrices(mat); // before setting shader\n  shaders.bind(default_vshader, default_fshader, {\n    color: vec4(1, 1, 1, 1),\n  });\n  let objs = this.data.objs;\n  for (let ii = 0; ii < objs.length; ++ii) {\n    let obj = objs[ii];\n    if (obj.texture) {\n      textures.bind(0, obj.texture);\n    }\n    obj.geom.draw();\n  }\n};\n\n// Just draw the geometry, without any other binding\nModel.prototype.drawGeom = function () {\n  let objs = this.data.objs;\n  for (let ii = 0; ii < objs.length; ++ii) {\n    let obj = objs[ii];\n    obj.geom.draw();\n  }\n};\n\nexport function load(url) {\n  if (models[url]) {\n    return models[url];\n  }\n  let model = models[url] = new Model(url);\n  model.data = models.box.data; // stub until loaded\n  model.load();\n  return model;\n}\n\nexport function startup() {\n  initShaders();\n  let model_box = models.box = new Model('box');\n  model_box.parse(webFSGetFile('models/box_textured_embed.glb').buffer);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// eslint-disable-next-line no-use-before-define\nexports.netBuildString = buildString;\n// eslint-disable-next-line no-use-before-define\nexports.netInit = init;\n\n/* eslint-disable import/order */\nconst { filewatchStartup } = require('./filewatch.js');\nconst packet = require('glov/common/packet.js');\nconst subscription_manager = require('./subscription_manager.js');\nconst wsclient = require('./wsclient.js');\nconst wscommon = require('glov/common/wscommon.js');\nconst WSClient = wsclient.WSClient;\n\nlet client;\nlet subs;\n\nexport function init(params) {\n  params = params || {};\n  if (params.ver) {\n    wsclient.CURRENT_VERSION = params.ver;\n  }\n  if (String(document.location).match(/^https?:\\/\\/localhost/)) {\n    console.log('PacketDebug: ON');\n    packet.default_flags |= packet.PACKET_DEBUG;\n    if (!params.no_net_delay) {\n      wscommon.netDelaySet();\n    }\n  }\n  client = new WSClient(params.path);\n  subs = subscription_manager.create(client, params.cmd_parse);\n  subs.auto_create_user = Boolean(params.auto_create_user);\n  subs.no_auto_login = Boolean(params.no_auto_login);\n  subs.allow_anon = Boolean(params.allow_anon);\n  window.subs = subs; // for debugging\n  exports.subs = subs;\n  exports.client = client;\n  filewatchStartup(client);\n\n  if (params.engine) {\n    params.engine.addTickFunc((dt) => {\n      client.checkDisconnect();\n      subs.tick(dt);\n    });\n  }\n}\n\nconst build_timestamp_string = new Date(Number(BUILD_TIMESTAMP))\n  .toISOString()\n  .replace('T', ' ')\n  .slice(5, -8);\nexport function buildString() {\n  return wsclient.CURRENT_VERSION ? `${wsclient.CURRENT_VERSION} (${build_timestamp_string})` : build_timestamp_string;\n}\n\nexport function netDisconnected() {\n  return !client || !client.connected || client.disconnected || subs.logging_in ||\n    !client.socket || client.socket.readyState !== 1;\n}\n\nexport function netForceDisconnect() {\n  if (subs) {\n    subs.was_logged_in = false;\n  }\n  client?.socket?.close?.();\n}\n\nexport function netClient() {\n  return client;\n}\n\nexport function netClientId() {\n  return client.id;\n}\n\nexport function netUserId() {\n  return subs.getUserId();\n}\n\nexport function netSubs() {\n  return subs;\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/* eslint-disable import/order */\nconst { cmd_parse } = require('./cmds.js');\nconst glov_engine = require('./engine.js');\nconst net = require('./net.js');\nconst { netDisconnected } = net;\nconst perf = require('./perf.js');\nconst settings = require('./settings.js');\nconst util = require('glov/common/util.js');\nconst { wsstats, wsstats_out } = require('glov/common/wscommon.js');\nconst { abs, floor, max, min, PI, sqrt } = Math;\nconst TWO_PI = PI * 2;\nconst EPSILON = 0.01;\n\nlet the;\n\nsettings.register({\n  show_ping: {\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n  },\n});\nperf.addMetric({\n  name: 'ping',\n  show_stat: 'show_ping',\n  labels: {\n    'ping: ': () => {\n      if (!the) {\n        return '';\n      }\n      let pt = the.getPing(2000);\n      if (!pt || pt.fade < 0.001) {\n        return '';\n      }\n      return { value: `${pt.ping.toFixed(1)}`, alpha: min(1, pt.fade * 3) };\n    },\n  },\n});\nsettings.register({\n  show_net: {\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,2],\n  },\n});\nlet last_wsstats = { msgs: 0, bytes: 0, time: Date.now(), dm: 0, db: 0 };\nlet last_wsstats_out = { msgs: 0, bytes: 0, time: Date.now(), dm: 0, db: 0 };\nfunction bandwidth(stats, last) {\n  let now = Date.now();\n  if (now - last.time > 1000) {\n    last.dm = stats.msgs - last.msgs;\n    last.db = stats.bytes - last.bytes;\n    last.msgs = stats.msgs;\n    last.bytes = stats.bytes;\n    if (now - last.time > 2000) { // stall\n      last.time = now;\n    } else {\n      last.time += 1000;\n    }\n  }\n  return `${(last.db/1024).toFixed(2)} kb (${last.dm})`;\n}\nperf.addMetric({\n  name: 'net',\n  show_stat: 'show_net',\n  width: 5,\n  labels: {\n    'down: ': bandwidth.bind(null, wsstats, last_wsstats),\n    'up: ': bandwidth.bind(null, wsstats_out, last_wsstats_out),\n  },\n});\n\nconst valid_options = [\n  // Numeric parameters\n  'dim_pos', 'dim_rot', // dimensions\n  'send_time', 'window', 'snap_factor', 'smooth_windows', 'smooth_factor', 'default_pos',\n  // Callbacks\n  'on_pos_update', 'on_state_update',\n];\n\nfunction NetPositionManager(options) {\n  this.on_channel_data = this.onChannelData.bind(this);\n  this.on_subscribe = this.onChannelSubscribe.bind(this);\n  this.reinit(options);\n}\nNetPositionManager.prototype.deinit = function () {\n  if (this.channel) {\n    this.channel.removeListener('channel_data', this.on_channel_data);\n    this.channel.removeListener('subscribe', this.on_subscribe);\n  }\n};\n\nNetPositionManager.prototype.onChannelSubscribe = function (data) {\n  // initial connection or reconnect\n  this.last_send.sending = false; // ignore send on previous, disconnected link\n  this.last_send.time = 0;\n  this.client_id = net.client.id;\n};\n\nNetPositionManager.prototype.onChannelData = function (data, mod_key, mod_value) {\n  if (mod_key) {\n    let m = mod_key.match(/^public\\.clients\\.([^.]+)\\.(.+)$/);\n    if (m) {\n      let client_id = m[1];\n      let field = m[2];\n      if (field === 'pos') {\n        this.otherClientPosChanged(client_id);\n      }\n      if (this.on_client_change) {\n        let pcd = this.per_client_data[client_id];\n        if (pcd) {\n          this.on_client_change(pcd, field);\n        }\n      }\n    }\n    if (!mod_value) {\n      m = mod_key.match(/^public\\.clients\\.([^.]+)$/);\n      if (m) {\n        // other client disconnected\n        delete this.per_client_data[m[1]];\n      }\n    }\n  } else {\n    if (data && data.public && data.public.clients) {\n      for (const client_id in data.public.clients) {\n        const client_data = data.public.clients[client_id];\n        if (client_data.pos) {\n          this.otherClientPosChanged(client_id);\n        }\n      }\n    }\n  }\n};\n\nNetPositionManager.prototype.vec = function (fill) {\n  let r = new Float64Array(this.n);\n  if (fill) {\n    for (let ii = 0; ii < this.n; ++ii) {\n      r[ii] = fill;\n    }\n  }\n  return r;\n};\nNetPositionManager.prototype.vcopy = function (dst, src) {\n  for (let ii = 0; ii < this.n; ++ii) {\n    dst[ii] = src[ii];\n  }\n  return dst;\n};\nNetPositionManager.prototype.arr = function (vec) {\n  let arr = new Array(this.n);\n  for (let ii = 0; ii < this.n; ++ii) {\n    arr[ii] = vec[ii];\n  }\n  return arr;\n};\nNetPositionManager.prototype.vsame = function (a, b) {\n  for (let ii = 0; ii < this.n; ++ii) {\n    if (abs(a[ii] - b[ii]) > EPSILON) {\n      return false;\n    }\n  }\n  return true;\n};\nNetPositionManager.prototype.vlength = function (a) {\n  let r = 0;\n  for (let ii = 0; ii < this.n; ++ii) {\n    let d = a[ii];\n    r += d * d;\n  }\n  return sqrt(r);\n};\nNetPositionManager.prototype.vdist = function (a, b) {\n  this.vsub(this.temp_vec, a, b);\n  for (let ii = 0; ii < this.dim_rot; ++ii) {\n    let jj = this.dim_pos + ii;\n    let d = abs(this.temp_vec[jj]);\n    if (d > PI) {\n      this.temp_vec[jj] = d - floor((d + PI) / TWO_PI) * TWO_PI;\n    }\n  }\n  return this.vlength(this.temp_vec);\n};\nNetPositionManager.prototype.vsub = function (dst, a, b) {\n  for (let ii = 0; ii < this.n; ++ii) {\n    dst[ii] = a[ii] - b[ii];\n  }\n  return dst;\n};\nNetPositionManager.prototype.vscale = function (dst, a, scalar) {\n  for (let ii = 0; ii < this.n; ++ii) {\n    dst[ii] = a[ii] * scalar;\n  }\n};\n\nNetPositionManager.prototype.reinit = function (options) {\n  this.deinit();\n  the = this;\n\n  options = options || {};\n  this.per_client_data = {};\n  for (let ii = 0; ii < valid_options.length; ++ii) {\n    let field = valid_options[ii];\n    if (options[field]) {\n      this[field] = options[field];\n    }\n  }\n\n  this.n = this.dim_pos + this.dim_rot;\n\n  if (!this.default_pos) {\n    this.default_pos = this.vec();\n  }\n  if (!this.temp_vec) {\n    this.temp_vec = this.vec();\n  }\n  if (!this.temp_delta) {\n    this.temp_delta = this.vec();\n  }\n\n  this.channel = options.channel; // Never inheriting this over reinit()\n  this.last_send = {\n    pos: this.vec(-1),\n    sending: false,\n    send_time: 0,\n  };\n  this.sends_to_ignore = 0;\n  this.ever_received_character = false;\n\n  this.on_client_change = options.on_client_change;\n\n  if (this.channel) {\n    this.channel.on('channel_data', this.on_channel_data);\n    this.channel.onSubscribe(this.on_subscribe);\n  }\n};\n\n// cb(client_id, pos[2])\nNetPositionManager.prototype.onPositionUpdate = function (cb) {\n  this.on_pos_update = cb;\n};\n\n// cb(client_id, new_state)\nNetPositionManager.prototype.onStateUpdate = function (cb) {\n  this.on_state_update = cb;\n};\n\nfunction syncPosWithCaller(npm, on_pos_set_cb) {\n  npm.vcopy(npm.last_send.pos, npm.default_pos);\n  let new_pos = on_pos_set_cb(npm.last_send.pos);\n  if (new_pos) {\n    npm.vcopy(npm.last_send.pos, new_pos);\n  }\n}\n\nNetPositionManager.prototype.checkNet = function (on_pos_set_cb) {\n  if (netDisconnected() || !this.channel || !this.channel.data.public) {\n    // Not yet in room, do nothing\n    return true;\n  }\n  if (net.client.id !== this.client_id) {\n    // Haven't yet subscribed to this room under the new client_id\n    return true;\n  }\n\n  const me = this.channel.getChannelData(`public.clients.${this.client_id}`, {});\n  if (!me.pos || !me.pos.cur || typeof me.pos.cur[0] !== 'number') {\n    if (this.ever_received_character) {\n      // we must be reconnecting, use last replicated position\n    } else {\n      // fresh connect, use default position, or ask for it from caller\n      syncPosWithCaller(this, on_pos_set_cb);\n    }\n    this.channel.setChannelData(`public.clients.${this.client_id}.pos`, {\n      cur: this.arr(this.last_send.pos), // Do not send as Float64Array\n    });\n    this.ever_received_character = true;\n  } else if (!this.ever_received_character) {\n    syncPosWithCaller(this, on_pos_set_cb);\n    this.ever_received_character = true;\n  }\n  return false;\n};\n\nNetPositionManager.prototype.updateMyPos = function (character_pos, anim_state, force) {\n  if (!this.vsame(character_pos, this.last_send.pos) || anim_state !== this.last_send.anim_state) {\n    // pos or anim_state changed\n    const now = glov_engine.getFrameTimestamp();\n    if ((!this.last_send.sending && (!this.last_send.time || now - this.last_send.time > this.send_time)) || force) {\n      // do send!\n      if (this.last_send.sending) {\n        ++this.sends_to_ignore;\n      } else {\n        this.last_send.sending = true;\n      }\n      this.last_send.time = now;\n      this.last_send.hrtime = glov_engine.hrnow();\n      this.last_send.speed = 0;\n      if (this.last_send.send_time) {\n        const time = now - this.last_send.send_time;\n        this.last_send.speed = this.vdist(this.last_send.pos, character_pos) / time;\n        if (this.last_send.speed < 0.001) {\n          this.last_send.speed = 0;\n        }\n      }\n      this.last_send.send_time = now;\n      this.vcopy(this.last_send.pos, character_pos);\n      this.last_send.anim_state = anim_state;\n      this.channel.setChannelData(\n        `public.clients.${this.client_id}.pos`, {\n          cur: this.arr(this.last_send.pos), // Do not send as Float64Array\n          state: this.last_send.anim_state, speed: this.last_send.speed,\n          q: 1,\n        }, false, () => {\n          if (!this.sends_to_ignore) {\n            // could avoid needing this response function (and ack packet) if we\n            // instead just watch for the apply_channel_data message containing\n            // (approximately) what we sent\n            this.last_send.sending = false;\n            let end = glov_engine.getFrameTimestamp();\n            let hrend = glov_engine.hrnow();\n            let round_trip = hrend - this.last_send.hrtime;\n            this.ping_time = round_trip;\n            this.ping_time_time = end;\n            if (round_trip > this.send_time) {\n              // hiccup, delay next send\n              this.last_send.time = end;\n            }\n          } else {\n            --this.sends_to_ignore;\n          }\n        }\n      );\n    }\n  }\n};\n\nNetPositionManager.prototype.getPing = function (max_age) {\n  if (!this.ping_time_time) {\n    return null;\n  }\n  let age = glov_engine.getFrameTimestamp() - this.ping_time_time;\n  if (age > max_age) {\n    return null;\n  }\n  return {\n    ping: this.ping_time,\n    fade: 1 - age / max_age,\n  };\n};\n\nNetPositionManager.prototype.getPos = function (client_id) {\n  let pcd = this.per_client_data[client_id];\n  if (!pcd) {\n    return null;\n  }\n  return pcd.pos;\n};\n\nNetPositionManager.prototype.getPCD = function (client_id) {\n  return this.per_client_data[client_id];\n};\n\nNetPositionManager.prototype.otherClientPosChanged = function (client_id) {\n  const client_pos = this.channel.getChannelData(`public.clients.${client_id}.pos`);\n  if (!client_pos || !client_pos.cur || typeof client_pos.cur[0] !== 'number') {\n    return;\n  }\n  // client_pos is { cur, state, speed }\n  let pcd = this.per_client_data[client_id];\n  if (!pcd) {\n    pcd = this.per_client_data[client_id] = {};\n    pcd.pos = this.vcopy(this.vec(), client_pos.cur);\n    pcd.net_speed = 0;\n    pcd.net_pos = this.vec();\n    pcd.impulse = this.vec();\n    pcd.net_state = 'idle_down';\n    pcd.anim_state = 'idle_down';\n  }\n  if (client_pos.state) {\n    pcd.net_state = client_pos.state;\n  }\n  this.vcopy(pcd.net_pos, client_pos.cur);\n  pcd.net_speed = client_pos.speed;\n\n  // Keep pcd.pos[rot] within PI of pcd.net_pos, so interpolation always goes the right way\n  for (let ii = 0; ii < this.dim_rot; ++ii) {\n    let jj = this.dim_pos + ii;\n    while (pcd.pos[jj] > pcd.net_pos[jj] + PI) {\n      pcd.pos[jj] -= TWO_PI;\n    }\n    while (pcd.pos[jj] < pcd.net_pos[jj] - PI) {\n      pcd.pos[jj] += TWO_PI;\n    }\n  }\n\n  // This interpolation logic taken from Splody\n  // Doesn't do great with physics-based jumps though\n  const delta = this.vsub(this.temp_delta, pcd.net_pos, pcd.pos);\n  const dist = this.vlength(delta);\n\n  if (dist > 0) {\n    const time_to_dest = dist / pcd.net_speed;\n    if (time_to_dest < this.send_time + this.window) {\n      // Would get there in the expected time, use this speed\n      this.vscale(pcd.impulse, delta, pcd.net_speed / dist);\n    } else if (time_to_dest < this.send_time + this.window * this.smooth_windows) { // 0.5s\n      // We'll could be there in under half a second, try to catch up smoothly\n      // Using provided speed is too slow, go faster, though no slower than we were going\n      // (in case this is the last of multiple delayed updates and the last update was going a tiny distance slowly)\n      const old_speed = this.vlength(pcd.impulse);\n      const specified_speed = pcd.net_speed;\n      const new_speed = max(specified_speed * this.smooth_factor, old_speed);\n      this.vscale(pcd.impulse, delta, new_speed / dist);\n    } else {\n      // We're way far behind using the provided speed, attempt to get all the way there by the next few\n      // theoretical updates, this basically snaps if this is particularly small\n      this.vscale(pcd.impulse, delta, 1 / (this.send_time + this.window * this.snap_factor));\n    }\n  }\n};\n\nNetPositionManager.prototype.updateOtherClient = function (client_id, dt) {\n  const pcd = this.per_client_data[client_id];\n  if (!pcd) {\n    // Never got a position sent to us, ignore\n    return null;\n  }\n\n  // Apply interpolation (logic from Splody)\n  let stopped = true;\n  for (let ii = 0; ii < this.n; ++ii) {\n    if (pcd.impulse[ii]) {\n      const delta_old = pcd.net_pos[ii] - pcd.pos[ii];\n      const delta_old_sign = util.sign(delta_old);\n      pcd.pos[ii] += pcd.impulse[ii] * dt;\n      const delta_new = pcd.net_pos[ii] - pcd.pos[ii];\n      const delta_new_sign = util.sign(delta_new);\n      if (delta_new_sign !== delta_old_sign) {\n        // made it or passed it\n        pcd.pos[ii] = pcd.net_pos[ii];\n        pcd.impulse[ii] = 0;\n      } else if (ii < this.dim_pos && pcd.impulse[ii] > 0.01) {\n        // If positional (not rotation), we're not stopped\n        stopped = false;\n      }\n    }\n  }\n  if (this.on_pos_update) {\n    this.on_pos_update(client_id, pcd.pos);\n  }\n\n  const cur_is_run = pcd.anim_state[0] === 'f' || pcd.anim_state[0] === 'w';\n  const new_is_idle = pcd.net_state[0] === 'i';\n  if (cur_is_run && new_is_idle && !stopped) {\n    // don't apply yet\n  } else {\n    pcd.anim_state = pcd.net_state;\n    if (this.on_state_update) {\n      this.on_state_update(client_id, pcd.net_state);\n    }\n  }\n  return pcd;\n};\n\nNetPositionManager.prototype.dim_pos = 2; // number of components to be interpolated as-is\nNetPositionManager.prototype.dim_rot = 0; // number of components to be interpolated with 2PI wrapping\nNetPositionManager.prototype.send_time = 200; // how often to send position updates\nNetPositionManager.prototype.window = 200; // maximum expected variation in time between updates; ms\nNetPositionManager.prototype.snap_factor = 1.0; // how many windows to snap in when we think we need to snap\nNetPositionManager.prototype.smooth_windows = 6.5; // how many windows behind we can be and only accelerate a little\nNetPositionManager.prototype.smooth_factor = 1.2; // how much faster to go in the smoothing window\n\n\nexport function create(options) {\n  return new NetPositionManager(options);\n}\n\n\nfunction ScalarInterpolator(tick_time) {\n  this.tick_time = tick_time * 1.25;\n  this.reset();\n}\n\nScalarInterpolator.prototype.reset = function () {\n  this.value = undefined;\n  this.target_value = undefined;\n  this.vel = 0;\n};\n\n// Assume any change happened on the server at frequency tick_time\n// Updates state.value and also returns it\nScalarInterpolator.prototype.update = function (dt, new_value) {\n  if (this.value === undefined) {\n    this.value = new_value;\n    this.target_value = new_value;\n    return;\n  }\n  // TODO: Could figure expected velocity and use logic like in updateOtherClient\n  if (new_value !== this.target_value) {\n    // try to get there in tick_time\n    this.vel = (new_value - this.value) / this.tick_time;\n    this.target_value = new_value;\n  }\n  if (this.value !== this.target_value) {\n    if (this.vel > 0) {\n      this.value = min(this.value + this.vel * dt, this.target_value);\n    } else {\n      this.value = max(this.value + this.vel * dt, this.target_value);\n    }\n  }\n};\n\nScalarInterpolator.prototype.getValue = function () {\n  return this.value;\n};\n\nexport function createScalarInterpolator(tick_time) {\n  return new ScalarInterpolator(tick_time);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n//////////////////////////////////////////////////////////////////////////\n// Particle System Spec\n\n/*\n// Definitions\n// value = number or\n// value = [base, add_max] -> generates a number in the range [base, base + add_max)\nlet def_fire = {\n  particles: {\n    fire: {\n      blend: 'additive',\n      texture: 'fire.png',\n      color: [1,1,1,1], // multiplied by animation track, default 1,1,1,1, can be omitted\n      color_track: [ // just values, NOT random range\n        { t: 0.0, v: [1,0.4,0.4,1] },\n        { t: 0.7, v: [1,0,0,1] },\n        { t: 0.9, v: [0.2,0,0,1] },\n        { t: 1.0, v: [0,0,0,1] },\n      ],\n      size: [[32,16], [32,16]], // multiplied by animation track\n      size_track: [ // just values, NOT random range\n        { t: 0.0, v: [1,1] },\n        { t: 0.4, v: [0.5,0.5] },\n        { t: 0.7, v: [1,1] },\n        { t: 1.0, v: [1.5,1.5] },\n      ],\n      accel: [0,0],\n      rot: [0,360], // degrees\n      rot_vel: [10,2], // degrees per second\n      lifespan: [450,0], // milliseconds\n      kill_time_accel: 5,\n    },\n  },\n  emitters: {\n    fire: {\n      particle: 'fire',\n      // Random ranges affect each emitted particle:\n      pos: [[0,28], [0,28]],\n      vel: [0,0],\n      emit_rate: [60,20], // emissions per second\n      // Random ranges only calculated upon instantiation:\n      emit_time: [0,Infinity],\n      emit_initial: 10,\n    },\n  },\n  system_lifespan: Infinity, // must be manually killed\n};\n\n// Usage\nlet system = glov_engine.glov_particles.createSystem(def_fire, [50, 50, Z.PARTICLES]);\nsystem.updatePos(75, 75);\nsystem.killSoft(); // stops emitting and speeds up particles by kill_time_accel\nsystem.killHard(); // immediately stops drawing\n\n*/\n\n//////////////////////////////////////////////////////////////////////////\n// Implementation\n\nconst assert = require('assert');\nconst {\n  vec2, v2copy, v2lerp, v2mul,\n  vec3, vec4, v3add, v4copy, v4lerp, v4mul,\n} = require('glov/common/vmath.js');\nconst sprites = require('./sprites.js');\nconst textures = require('./textures.js');\n\nconst blend_map = {\n  alpha: sprites.BLEND_ALPHA,\n  additive: sprites.BLEND_ADDITIVE,\n};\n\nexport function preloadParticleData(particle_data) {\n  // Preload all referenced particle textures\n  for (let key in particle_data.defs) {\n    let def = particle_data.defs[key];\n    for (let part_name in def.particles) {\n      let part_def = def.particles[part_name];\n      textures.load({ url: `img/${part_def.texture}.png` });\n    }\n  }\n}\n\n// Expect all values to be a pair of [base, add_max]\nfunction normalizeValue(v) {\n  if (v instanceof Float32Array && v.length >= 2) {\n    return v;\n  } else if (typeof v === 'number') {\n    return vec2(v, 0);\n  } else if (Array.isArray(v) || v instanceof Float32Array) {\n    // already an array, convert to Vec2\n    return vec2(v[0] || 0, v[1] || 0);\n  } else {\n    return assert(false);\n  }\n}\n\nfunction normalizeValueVec(vec, length) {\n  assert(length);\n  assert(Array.isArray(vec) || vec instanceof Float32Array);\n  let ret = new Array(length);\n  for (let ii = 0; ii < length; ++ii) {\n    ret[ii] = normalizeValue(vec[ii]);\n  }\n  return ret;\n}\n\nfunction normalizeParticle(def, particle_manager) {\n  if (!def.normalized) {\n    let norm = def.normalized = {\n      blend: blend_map[def.blend] || sprites.BLEND_ALPHA,\n      texture: textures.load({ url: def.texture ? `img/${def.texture}.png` : 'img/glov/util_circle.png' }),\n      color: normalizeValueVec(def.color || [1,1,1,1], 4),\n      color_track: null,\n      size: normalizeValueVec(def.size || [1,1], 2),\n      size_track: null,\n      accel: normalizeValueVec(def.accel || [0,0,0], 3),\n      rot: normalizeValue(def.rot || 0),\n      rot_vel: normalizeValue(def.rot || 0),\n      lifespan: normalizeValue(def.lifespan || 1000),\n      kill_time_accel: normalizeValue(def.kill_time_accel || 1),\n    };\n    assert(norm.kill_time_accel[0] >= 1); // cannot slow down on kill!\n    if (def.color_track && def.color_track.length) {\n      assert(def.color_track.length > 1);\n      norm.color_track = [];\n      for (let ii = 0; ii < def.color_track.length; ++ii) {\n        let e = def.color_track[ii];\n        assert(typeof e.t === 'number');\n        let arr = new Float32Array(5);\n        arr[0] = e.v[0];\n        arr[1] = e.v[1];\n        arr[2] = e.v[2];\n        arr[3] = e.v[3];\n        arr[4] = e.t;\n        norm.color_track.push(arr);\n      }\n    }\n    if (def.size_track && def.size_track.length) {\n      assert(def.size_track.length > 1);\n      norm.size_track = [];\n      for (let ii = 0; ii < def.size_track.length; ++ii) {\n        let e = def.size_track[ii];\n        assert(typeof e.t === 'number');\n        let arr = new Float32Array(3);\n        arr[0] = e.v[0];\n        arr[1] = e.v[1];\n        arr[2] = e.t;\n        norm.size_track.push(arr);\n      }\n    }\n  }\n  return def.normalized;\n}\n\nfunction findParticle(particles, name) {\n  assert(particles[name] !== undefined);\n  return particles[name];\n}\n\nfunction normalizeEmitter(def, part_map) {\n  if (!def.normalized) {\n    def.normalized = {\n      part_idx: findParticle(part_map, def.particle),\n      pos: normalizeValueVec(def.pos || [0,0,0], 3),\n      vel: normalizeValueVec(def.vel || [0,0,0], 3),\n      emit_rate: normalizeValue(def.emit_rate || 10),\n      emit_time: normalizeValueVec(def.emit_time || [0,Infinity], 2),\n      emit_initial: normalizeValue(def.emit_initial || 1),\n    };\n    // convert particles per second to ms per emission\n    let min = def.normalized.emit_rate[0];\n    let max = def.normalized.emit_rate[0] + def.normalized.emit_rate[1];\n    def.normalized.emit_rate[0] = 1000 / max;\n    def.normalized.emit_rate[1] = 1000 / min;\n    assert(def.normalized.emit_rate[0] > 1); // Not more than 1000 per second, that's ridic'.\n  }\n  return def.normalized;\n}\n\nfunction normalizeDef(def, particle_manager) {\n  if (!def.normalized) {\n    let norm = def.normalized = {\n      system_lifespan: normalizeValue(def.system_lifespan || Infinity),\n      particles: [],\n      emitters: [],\n    };\n    let part_map = {};\n    for (let key in def.particles) {\n      part_map[key] = norm.particles.length;\n      norm.particles.push(normalizeParticle(def.particles[key], particle_manager));\n    }\n    for (let key in def.emitters) {\n      norm.emitters.push(normalizeEmitter(def.emitters[key], part_map));\n    }\n  }\n  return def.normalized;\n}\n\nfunction instValue(v) {\n  return v[0] + Math.random() * v[1];\n}\nfunction instValueVec(v) {\n  let ret = new Float32Array(v.length);\n  for (let ii = 0; ii < v.length; ++ii) {\n    ret[ii] = instValue(v[ii]);\n  }\n  return ret;\n}\n\nlet temp_color = vec4();\nlet temp_color2 = vec4();\nlet temp_size = vec2();\nlet temp_size2 = vec2();\n// let temp_pos = v3allocZero();\n\nclass ParticleSystem {\n  constructor(parent, def_in, pos) {\n    assert(pos.length === 3);\n    this.parent = parent;\n    this.def = normalizeDef(def_in, parent);\n    this.system_lifespan = instValue(this.def.system_lifespan);\n    assert(this.system_lifespan > 0);\n    this.age = 0;\n    this.kill_hard = false;\n    this.kill_soft = false;\n    this.pos = vec3(pos[0], pos[1], pos[2]);\n    this.part_sets = [];\n    for (let ii = 0; ii < this.def.particles.length; ++ii) {\n      let def = this.def.particles[ii];\n      let part_set = {\n        def,\n        parts: [],\n      };\n      this.part_sets.push(part_set);\n    }\n    this.emitters = [];\n    // Instantiate emitters\n    for (let ii = 0; ii < this.def.emitters.length; ++ii) {\n      let def = this.def.emitters[ii];\n      let emitter = {\n        def,\n        emit_time: instValueVec(def.emit_time),\n        countdown: 0,\n        started: false,\n        stopped: false,\n      };\n      this.emitters.push(emitter);\n    }\n    // Do *not* do this here, causes them to be drawn twice on the first frame,\n    //   they'll be ticked as usual.\n    // // do initial tick for things that have an emit_time[0] of 0 and have an emit_initial\n    // this.tick(0);\n  }\n\n  tickParticle(part, dt) { // eslint-disable-line class-methods-use-this\n    let def = part.def;\n    part.age += dt;\n    let age_norm = part.age / part.lifespan;\n    if (age_norm >= 1) {\n      return true;\n    }\n\n    // Pos, vel - incrementally computed\n    let dts = dt / 1000;\n    part.pos[0] += part.vel[0] * dts;\n    part.pos[1] += part.vel[1] * dts;\n    part.pos[2] += part.vel[2] * dts;\n    part.vel[0] += part.accel[0] * dts;\n    part.vel[1] += part.accel[1] * dts;\n    part.vel[2] += part.accel[2] * dts;\n\n    // Color, size, rot - explicitly computed\n    v4copy(temp_color, part.color, temp_color);\n    if (def.color_track) {\n      if (age_norm < def.color_track[0][4]) {\n        v4mul(temp_color, temp_color, def.color_track[0]);\n      } else if (age_norm >= def.color_track[def.color_track.length - 1][4]) {\n        v4mul(temp_color, temp_color, def.color_track[def.color_track.length - 1]);\n      } else {\n        for (let ii = 0; ii < def.color_track.length - 1; ++ii) {\n          if (age_norm >= def.color_track[ii][4] && age_norm < def.color_track[ii + 1][4]) {\n            let weight = (age_norm - def.color_track[ii][4]) / (def.color_track[ii + 1][4] - def.color_track[ii][4]);\n            v4lerp(temp_color2, weight, def.color_track[ii], def.color_track[ii + 1]);\n            v4mul(temp_color, temp_color, temp_color2);\n            break;\n          }\n        }\n      }\n    }\n\n    v2copy(temp_size, part.size);\n    if (def.size_track) {\n      if (age_norm < def.size_track[0][2]) {\n        v2mul(temp_size, temp_size, def.size_track[0]);\n      } else if (age_norm >= def.size_track[def.size_track.length - 1][2]) {\n        v2mul(temp_size, temp_size, def.size_track[def.size_track.length - 1]);\n      } else {\n        for (let ii = 0; ii < def.size_track.length - 1; ++ii) {\n          if (age_norm >= def.size_track[ii][2] && age_norm < def.size_track[ii + 1][2]) {\n            let weight = (age_norm - def.size_track[ii][2]) / (def.size_track[ii + 1][2] - def.size_track[ii][2]);\n            v2lerp(temp_size2, weight, def.size_track[ii], def.size_track[ii + 1]);\n            v2mul(temp_size, temp_size, temp_size2);\n            break;\n          }\n        }\n      }\n    }\n\n    // TODO: let rot = part.rot + part.age * part.rot_vel;\n\n    // TODO: draw using:\n    //   rot\n    let w = temp_size[0];\n    let h = temp_size[1];\n    let x = part.pos[0] - w/2;\n    let y = part.pos[1] - h/2;\n    let z = part.pos[2];\n    sprites.queueraw4color([def.texture],\n      x, y, temp_color, 0, 0,\n      x, y + h, temp_color, 0, 1,\n      x + w, y + h, temp_color, 1, 1,\n      x + w, y, temp_color, 1, 0,\n      z,\n      null, null, def.blend);\n\n    return false;\n  }\n\n  tickPartSet(dt_orig, part_set) {\n    //let def = part_set.def;\n    let parts = part_set.parts;\n    for (let ii = parts.length - 1; ii >= 0; --ii) {\n      let part = parts[ii];\n      let dt = this.kill_soft ? dt_orig * part.kill_time_accel : dt_orig;\n      if (this.tickParticle(part, dt)) {\n        parts[ii] = parts[parts.length - 1];\n        parts.pop();\n      }\n    }\n  }\n\n  emitParticle(init_dt, emitter) {\n    let emitter_def = emitter.def;\n    let part_set = this.part_sets[emitter_def.part_idx];\n    let def = part_set.def;\n    let pos = instValueVec(emitter_def.pos, 3);\n    v3add(pos, pos, this.pos);\n    // PERFTODO: Make the whole Particle just a data[] Float32Array\n    let part = {\n      def,\n      pos,\n      color: instValueVec(def.color, 4),\n      size: instValueVec(def.size, 4),\n      vel: instValueVec(emitter_def.vel, 3),\n      accel: instValueVec(def.accel, 3),\n      rot: instValue(def.rot),\n      rot_vel: instValue(def.rot_vel),\n      lifespan: instValue(def.lifespan),\n      kill_time_accel: instValue(def.kill_time_accel),\n      age: 0,\n    };\n    if (!this.tickParticle(part, init_dt)) {\n      part_set.parts.push(part);\n    }\n  }\n\n  tickEmitter(dt, emitter) {\n    let def = emitter.def;\n    // check for initial emission\n    if (!emitter.started && this.age >= emitter.emit_time[0]) {\n      emitter.started = true;\n      // ignore time before we started emitting\n      dt = this.age - emitter.emit_time[0];\n      let num = instValue(def.emit_initial);\n      for (let ii = 0; ii < num; ++ii) {\n        this.emitParticle(dt, emitter);\n      }\n      emitter.countdown = instValue(def.emit_rate);\n    }\n    if (emitter.started && !emitter.stopped && !this.kill_soft) {\n      // should we stop?\n      let remaining_dt = dt;\n      let emit_dt = dt;\n      if (this.age >= emitter.emit_time[1]) {\n        emitter.stopped = true;\n        // Do not emit during time after we stopped\n        emit_dt -= this.age - emitter.emit_time[1];\n      }\n      // Emit dt's worth of particles\n      while (emit_dt >= emitter.countdown) {\n        emit_dt -= emitter.countdown;\n        remaining_dt -= emitter.countdown;\n        emitter.countdown = instValue(def.emit_rate);\n        this.emitParticle(remaining_dt, emitter);\n      }\n      emitter.countdown -= emit_dt;\n    }\n  }\n\n  tick(dt) {\n    if (this.kill_hard) {\n      return true;\n    }\n    // tick existing particles\n    for (let ii = this.part_sets.length - 1; ii >= 0; --ii) {\n      this.tickPartSet(dt, this.part_sets[ii]);\n    }\n    // advance time and spawn new ones (with partial ticks)\n    this.age += dt;\n    for (let ii = 0; ii < this.emitters.length; ++ii) {\n      this.tickEmitter(dt, this.emitters[ii]);\n    }\n\n    return this.age >= this.system_lifespan; // kill if past lifespan\n  }\n\n  shift(delta) {\n    if (this.def.no_shift) {\n      return;\n    }\n    this.pos[0] += delta[0];\n    this.pos[1] += delta[1];\n    this.pos[2] += delta[2];\n    for (let ii = 0; ii < this.part_sets.length; ++ii) {\n      let parts = this.part_sets[ii].parts;\n      for (let jj = 0; jj < parts.length; ++jj) {\n        let part = parts[jj];\n        part.pos[0] += delta[0];\n        part.pos[1] += delta[1];\n        part.pos[2] += delta[2];\n      }\n    }\n  }\n}\n\nclass ParticleManager {\n  constructor() {\n    this.systems = [];\n  }\n\n  createSystem(def, pos) {\n    let system = new ParticleSystem(this, def, pos);\n    this.systems.push(system);\n    return system;\n  }\n\n  tick(dt) {\n    for (let ii = this.systems.length - 1; ii >= 0; --ii) {\n      if (this.systems[ii].tick(dt)) {\n        this.systems[ii] = this.systems[this.systems.length - 1];\n        this.systems.pop();\n      }\n    }\n  }\n\n  killAll() {\n    this.systems = [];\n  }\n\n  shift(delta) {\n    for (let ii = 0; ii < this.systems.length; ++ii) {\n      this.systems[ii].shift(delta);\n    }\n  }\n}\n\nexport function create() {\n  return new ParticleManager();\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nexport let perf_mem_counters = {};\n\n/* eslint-disable import/order */\nconst engine = require('./engine.js');\nlet metrics = [];\nexport function addMetric(metric, first) {\n  if (metric.show_graph) {\n    metric.num_lines = metric.colors.length;\n    metric.history_size = metric.data.history.length / metric.num_lines;\n  }\n  metric.num_labels = Object.keys(metric.labels).length;\n  if (metric.interactable === undefined) {\n    metric.interactable = engine.DEBUG && (metric.num_labels > 1 && !metric.show_all || metric.show_graph);\n  }\n  if (first) {\n    metrics.splice(0, 0, metric);\n  } else {\n    metrics.push(metric);\n  }\n}\n\n\nconst camera2d = require('./camera2d.js');\nconst { cmd_parse } = require('./cmds.js');\nconst glov_font = require('./font.js');\nconst input = require('./input.js');\nconst { max } = Math;\nconst { netClient, netClientId, netDisconnected } = require('./net.js');\nconst { perfCounterHistory } = require('glov/common/perfcounters.js');\nconst { profilerUI } = require('./profiler_ui.js');\nconst settings = require('./settings.js');\nconst { spriteChainedStart, spriteChainedStop } = require('./sprites.js');\nconst ui = require('./ui.js');\nconst { vec4, v3copy } = require('glov/common/vmath.js');\n\nconst METRIC_PAD = 2;\n\nlet bg_default = vec4(0,0,0,0.5);\nlet bg_mouse_over = vec4(0,0,0,0.75);\nlet bg_fade = vec4();\n\n// referenced in engine.js\nsettings.register({\n  show_metrics: {\n    default_value: 1,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n  },\n  show_fps: {\n    label: 'Show FPS',\n    default_value: engine.DEBUG ? 1 : 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,4],\n  },\n  fps_graph: {\n    label: 'FPS Graph',\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n  },\n  fps_window: {\n    label: 'FPS Time Window (seconds)',\n    default_value: 1,\n    type: cmd_parse.TYPE_FLOAT,\n    range: [0.001, 120],\n  },\n  show_perf_counters: {\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n  },\n  show_perf_memory: {\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n    access_run: ['sysadmin'], // only fetches from server, currently\n  },\n  perf_provider: {\n    default_value: 'client',\n    type: cmd_parse.TYPE_STRING,\n    usage: 'Set the perf provider for /show_perf_counters and /show_perf_memory\\n' +\n      '  CLIENT : show client values\\n' +\n      '  AUTO : automatically determine appropriate server\\n' +\n      '  user.1234 : use server hosting a particular worker',\n    access_run: ['sysadmin'],\n  },\n});\n\ncmd_parse.register({\n  cmd: 'fps',\n  help: 'Toggles FPS display',\n  func: function (str, resp_func) {\n    if (settings.show_fps && settings.show_metrics || str === '0') {\n      settings.set('show_fps', 0);\n    } else {\n      settings.set('show_fps', 1);\n      settings.set('show_metrics', 1);\n    }\n    resp_func();\n  },\n});\n\nlet fps_style = glov_font.style({\n  outline_width: 2, outline_color: 0x00000080,\n  color: 0xFFFFFFff,\n});\n\nfunction friendlyUnit(table, value) {\n  let unit = 0;\n  while (unit < table.length - 1 && value >= table[unit+1][0]) {\n    unit++;\n  }\n  if (unit === 0) {\n    return `${value} ${table[unit][1]}`;\n  }\n  return `${(value/table[unit][0]).toFixed(2)} ${table[unit][1]}`;\n}\nconst UNIT_BYTES = [\n  [1, 'bytes'],\n  [1024, 'KB'],\n  [1024*1024, 'MB'],\n  [1024*1024*1024, 'GB'],\n];\nconst UNIT_COUNT = [\n  [1, ''],\n  [1000, 'k'],\n  [1000*1000, 'm'],\n  [1000*1000*1000, 'g'],\n];\nexport function friendlyBytes(bytes) {\n  return friendlyUnit(UNIT_BYTES, bytes);\n}\nfunction friendlyCount(count) {\n  return friendlyUnit(UNIT_COUNT, count);\n}\n\nfunction showMetric(y, metric) {\n  let font = engine.font;\n  let pad = METRIC_PAD;\n  let line_height = settings.render_scale_all < 1 ? ui.font_height / settings.render_scale_all : ui.font_height;\n  let METRIC_VALUE_WIDTH = line_height * (metric.width || 2.5);\n  let x = camera2d.x1Real() - METRIC_VALUE_WIDTH - pad;\n  let y0 = y;\n  y += pad;\n  let max_label_w = 0;\n  let max_labels = metric.show_all ? Infinity : settings[metric.show_stat];\n  let drew_any = false;\n  let alpha = 1;\n  for (let label in metric.labels) {\n    let value = metric.labels[label]();\n    if (value) {\n      let style = fps_style;\n      if (value.alpha) {\n        alpha = value.alpha;\n        value = value.value;\n        style = glov_font.styleAlpha(fps_style, alpha);\n      }\n      let label_w = font.drawSizedAligned(style, x, y, Z.FPSMETER + 3, line_height,\n        glov_font.ALIGN.HRIGHT, 0, 0, label);\n      max_label_w = max(max_label_w, label_w);\n      font.drawSizedAligned(style, x, y, Z.FPSMETER + 3, line_height,\n        glov_font.ALIGN.HFIT, METRIC_VALUE_WIDTH, 0, value);\n      y += line_height;\n      drew_any = true;\n    }\n    if (!--max_labels) {\n      break;\n    }\n  }\n  let w = METRIC_VALUE_WIDTH + max_label_w + METRIC_PAD;\n  x -= max_label_w + METRIC_PAD;\n\n  if (!drew_any) {\n    return y - pad;\n  }\n\n  y += pad;\n  let bg = bg_default;\n  let pos_param = {\n    x: x - pad,\n    y: y0,\n    w: w + pad * 2,\n    h: y - y0,\n  };\n  if (metric.interactable) {\n    if (input.mouseUpEdge(pos_param)) {\n      if (metric.num_labels > 1 && settings[metric.show_stat] <= 1) {\n        settings.set(metric.show_stat, metric.num_labels);\n      } else if (metric.show_graph && !settings[metric.show_graph]) {\n        settings.set(metric.show_graph, 1);\n      } else {\n        if (metric.show_graph) {\n          settings.set(metric.show_graph, 0);\n        }\n        settings.set(metric.show_stat, 1);\n      }\n    }\n    if (input.mouseOver(pos_param)) {\n      bg = bg_mouse_over;\n    }\n  }\n  if (alpha !== 1) {\n    bg_fade[3] = bg[3] * alpha;\n    bg = v3copy(bg_fade, bg);\n  }\n  ui.drawRect(pos_param.x, pos_param.y, pos_param.x + pos_param.w, y, Z.FPSMETER+2, bg);\n  return y;\n}\n\nfunction showMetricGraph(y, metric) {\n  const small = engine.game_height < 300;\n  const LINE_WIDTH = small ? 1 : 3;\n  const LINE_PAD = small ? 0 : 1;\n  const LINE_HEIGHT = small ? 64 : 128;\n  const NUM_LINES = metric.history_size - 1;\n  let w = (LINE_WIDTH + LINE_PAD) * NUM_LINES;\n  let x = camera2d.x1Real() - w;\n  let h = LINE_HEIGHT + LINE_PAD * 2;\n  let z = Z.FPSMETER;\n  spriteChainedStart();\n  ui.drawRect(x, y - h, x + w, y, z++, bg_default);\n  x += LINE_PAD;\n  y -= LINE_PAD;\n  let history_index = metric.data.index;\n  let line_scale = LINE_HEIGHT / metric.line_scale_top;\n  for (let ii = 0; ii < NUM_LINES; ii++) {\n    let line_index = ((ii + history_index + 1) % metric.history_size) * metric.num_lines;\n    let data = metric.data.history;\n    let bar_max = 0;\n    for (let jj = 0; jj < metric.num_lines; jj++) {\n      let line_jj = data[line_index + jj];\n      let bar_min;\n      if (metric.bars_stack) {\n        bar_min = bar_max;\n        bar_max += line_jj;\n      } else {\n        // bars overlap, figure out how big this bar should be relative to next smallest\n        let lesser = 0;\n        for (let kk = 0; kk < metric.num_lines; kk++) {\n          if (kk === jj) {\n            continue;\n          }\n          let line_kk = data[line_index + kk];\n          if ((line_kk < line_jj || line_kk === line_jj && kk < jj) && line_kk > lesser) {\n            lesser = line_kk;\n          }\n        }\n        bar_min = lesser;\n        bar_max = line_jj;\n      }\n      let color = metric.colors[jj];\n      ui.drawRect(x, y - bar_max * line_scale, x + LINE_WIDTH, y - bar_min * line_scale, z, color);\n    }\n    x += LINE_WIDTH + LINE_PAD;\n  }\n  z += NUM_LINES;\n  y -= LINE_HEIGHT + LINE_PAD;\n  spriteChainedStop();\n  return y;\n}\n\nfunction perfDefaultAutoChannel() {\n  let client_id = netClientId();\n  if (client_id) {\n    return `client.${client_id}`;\n  }\n  return null;\n}\nlet auto_channel_cb = perfDefaultAutoChannel;\nexport function perfSetAutoChannel(cb) {\n  auto_channel_cb = cb;\n}\nconst PERF_NET_CACHE_TIME = 10000;\nconst PERF_NET_CACHE_TIME_MEM = 2500;\nlet perf_provider_data = {\n  last_update: -Infinity,\n  data: null,\n};\nfunction updatePerfProvider() {\n  let cache_time = PERF_NET_CACHE_TIME;\n  let fields = {\n  };\n  if (settings.show_perf_counters) {\n    fields.counters = 1;\n  }\n  if (settings.show_perf_memory) {\n    fields.memory = 1;\n    cache_time = PERF_NET_CACHE_TIME_MEM;\n  }\n  let provider = settings.perf_provider.toLowerCase();\n  if (provider === 'client') {\n    let ret = {\n      source: 'client',\n    };\n    if (fields.counters) {\n      ret.counters = perfCounterHistory();\n    }\n    if (fields.memory) {\n      ret.memory = perf_mem_counters;\n    }\n    return ret;\n  }\n  // Fetch from server\n  if (perf_provider_data.in_flight || netDisconnected()) {\n    return perf_provider_data.data;\n  }\n  let now = engine.frame_timestamp;\n  if (now - perf_provider_data.last_update < cache_time) {\n    return perf_provider_data.data;\n  }\n  let channel_id;\n  if (provider === 'auto') {\n    channel_id = auto_channel_cb();\n  } else if (provider.match(/^[^.]+\\.[^.]+$/)) { // seemingly valid channel ID\n    channel_id = provider;\n  }\n  if (channel_id) {\n    perf_provider_data.in_flight = true;\n    netClient().send('perf_fetch', { channel_id, fields }, function (err, data) {\n      if (err) {\n        console.error(`Error getting perf data: ${Object.keys(fields)}: ${err}`);\n      }\n      perf_provider_data.data = data;\n      perf_provider_data.last_update = engine.frame_timestamp;\n      perf_provider_data.in_flight = false;\n    });\n  }\n  return perf_provider_data.data;\n}\n\nfunction perfMemObjToLines(out, obj, prefix) {\n  for (let key in obj) {\n    let v = obj[key];\n    if (v && typeof v === 'object') {\n      perfMemObjToLines(out, v, `${prefix}${key}.`);\n    } else {\n      if (typeof v === 'number') {\n        if (key.endsWith('bytes') || prefix.includes('data_size')) {\n          v = friendlyBytes(v);\n        } else {\n          v = friendlyCount(v);\n        }\n      }\n      out.push(`${prefix}${key}: ${v}`);\n    }\n  }\n}\n\nlet graph_override = null;\n// `override` is like a `metric` passed to addMetric.  Contains:\n// history_size\n// num_lines\n// data: { history[history_size * num_lines], index }\n// line_scale_top\n// bars_stack : boolean\n// colors : vec4[]\nexport function perfGraphOverride(override) {\n  graph_override = override;\n}\n\nexport function draw() {\n  camera2d.push();\n  profilerUI();\n  camera2d.setAspectFixed(engine.game_width, engine.game_height);\n  if (settings.show_metrics) {\n    let y = camera2d.y0Real();\n    let y_graph = camera2d.y1Real();\n    if (graph_override) {\n      y_graph = showMetricGraph(y_graph, graph_override);\n      y_graph -= METRIC_PAD;\n    }\n    for (let ii = 0; ii < metrics.length; ++ii) {\n      let metric = metrics[ii];\n      if (settings[metric.show_stat]) {\n        y = showMetric(y, metric);\n        y += METRIC_PAD;\n      }\n      if (!graph_override && settings[metric.show_graph]) {\n        y_graph = showMetricGraph(y_graph, metric);\n        y_graph -= METRIC_PAD;\n      }\n    }\n  }\n  if (settings.show_perf_counters || settings.show_perf_memory) {\n    let font = engine.font;\n    let perf_data = updatePerfProvider() || {};\n    let y = camera2d.y0Real();\n    let y0 = y;\n    let line_height = settings.render_scale_all < 1 ? ui.font_height / settings.render_scale_all : ui.font_height;\n    let column_width = line_height * 6;\n    let x0 = camera2d.x0Real();\n    let x = x0 + column_width * 2;\n    let maxx = x + column_width;\n    let z = Z.FPSMETER + 1;\n    let header_x = x0 + column_width;\n    if (perf_data.source) {\n      font.drawSized(fps_style, header_x, y, z, line_height, `Source: ${perf_data.source}`);\n      y += line_height;\n    }\n    if (perf_data.log) {\n      let w = camera2d.wReal() *0.67;\n      maxx = max(maxx, header_x + w);\n      y += font.drawSizedWrapped(fps_style, header_x, y, z, w, 20, line_height, perf_data.log) + 4;\n    }\n\n    if (perf_data.memory && settings.show_perf_memory) {\n      let lines = [];\n      perfMemObjToLines(lines, perf_data.memory, '');\n      for (let ii = 0; ii < lines.length; ++ii) {\n        font.drawSized(fps_style, x, y, z, line_height, lines[ii]);\n        y += line_height;\n      }\n    }\n\n    if (perf_data.counters && settings.show_perf_counters) {\n      let hist = perf_data.counters || [];\n      let by_key = {};\n      for (let ii = 0; ii < hist.length; ++ii) {\n        let set = hist[ii];\n        for (let key in set) {\n          by_key[key] = by_key[key] || [];\n          by_key[key][ii] = set[key];\n        }\n      }\n      let keys = Object.keys(by_key);\n      for (let ii = 0; ii < keys.length; ++ii) {\n        let key = keys[ii];\n        let data = by_key[key];\n        font.drawSizedAligned(fps_style, x - column_width * 2, y, z, line_height,\n          glov_font.ALIGN.HRIGHT|glov_font.ALIGN.HFIT, column_width * 2, 0, `${key}: `);\n        for (let jj = 0; jj < data.length; ++jj) {\n          if (data[jj]) {\n            font.drawSizedAligned(fps_style, x + column_width * jj, y, z, line_height,\n              glov_font.ALIGN.HFIT, column_width, 0, `${data[jj]} `);\n          }\n        }\n        maxx = max(maxx, x + column_width * data.length);\n        y += line_height;\n      }\n    }\n    ui.drawRect(x0, y0, maxx, y, z - 0.1, bg_default);\n  }\n  camera2d.pop();\n  graph_override = null;\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nconst { eatPossiblePromise } = require('glov/common/util.js');\n\nlet user_want_locked = false;\nlet elem;\nlet on_ptr_lock;\n\nexport function isLocked() {\n  return user_want_locked; // Either it's locked, or there's an async attempt to lock it outstanding\n}\n\nfunction pointerLog(msg) {\n  console.log(`PointerLock: ${msg}`); // TODO: Disable this after things settle\n}\n\nexport function exit() {\n  pointerLog('Lock exit requested');\n  user_want_locked = false;\n  eatPossiblePromise(document.exitPointerLock());\n}\n\nexport function enter(when) {\n  user_want_locked = true;\n  on_ptr_lock();\n  pointerLog(`Trying pointer lock in response to ${when}`);\n  eatPossiblePromise(elem.requestPointerLock());\n}\n\nfunction onPointerLockChange() {\n  if (document.pointerLockElement || document.mozPointerLockElement || document.webkitPointerLockElement) {\n    pointerLog('Lock successful');\n    if (!user_want_locked) {\n      pointerLog('User canceled lock');\n      eatPossiblePromise(document.exitPointerLock());\n    }\n  } else {\n    if (user_want_locked) {\n      pointerLog('Lock lost');\n      user_want_locked = false;\n    }\n  }\n}\n\nfunction onPointerLockError(e) {\n  pointerLog('Error');\n  user_want_locked = false;\n}\n\nexport function startup(_elem, _on_ptr_lock) {\n  elem = _elem;\n  on_ptr_lock = _on_ptr_lock;\n\n  elem.requestPointerLock = elem.requestPointerLock || elem.mozRequestPointerLock ||\n    elem.webkitRequestPointerLock || function () { /* nop */ };\n  document.exitPointerLock = document.exitPointerLock || document.mozExitPointerLock ||\n    document.webkitExitPointerLock || function () { /* nop */ };\n\n  document.addEventListener('pointerlockchange', onPointerLockChange, false);\n  document.addEventListener('mozpointerlockchange', onPointerLockChange, false);\n  document.addEventListener('webkitpointerlockchange', onPointerLockChange, false);\n\n  document.addEventListener('pointerlockerror', onPointerLockError, false);\n  document.addEventListener('mozpointerlockerror', onPointerLockError, false);\n  document.addEventListener('webkitpointerlockerror', onPointerLockError, false);\n}\n","/* eslint no-extend-native:off */\n\n// TypedArray.slice, fill, join, sort, etc - not supported on IE, some older Safari, older Android, Chrome 44\nlet typedarrays = [Int8Array, Uint8Array, Int16Array, Uint16Array, Int32Array, Uint32Array, Float32Array];\n\nif (!Uint8Array.prototype.slice) {\n  typedarrays.forEach(function (ArrayType) {\n    Object.defineProperty(ArrayType.prototype, 'slice', {\n      value: function (begin, end) {\n        if (end === undefined) {\n          end = this.length;\n        }\n        if (end < 0) {\n          end = this.length - end;\n        }\n        begin = begin || 0;\n        if (begin >= this.length) {\n          begin = this.length - 1;\n        }\n        if (end > this.length) {\n          end = this.length;\n        }\n        if (end < begin) {\n          end = begin;\n        }\n        let len = end - begin;\n        let ret = new ArrayType(len);\n        for (let ii = 0; ii < len; ++ii) {\n          ret[ii] = this[begin + ii];\n        }\n        return ret;\n      }\n    });\n  });\n}\n\nfunction cmpDefault(a, b) {\n  return a - b;\n}\nlet replacements = {\n  join: function (delim) {\n    return Array.prototype.join.call(this, delim);\n  },\n  fill: function (value, begin, end) {\n    if (end === undefined) {\n      end = this.length;\n    }\n    for (let ii = begin || 0; ii < end; ++ii) {\n      this[ii] = value;\n    }\n    return this;\n  },\n  sort: function (cmp) {\n    Array.prototype.sort.call(this, cmp || cmpDefault);\n  },\n};\n\nfor (let key in replacements) {\n  if (!Uint8Array.prototype[key]) {\n    typedarrays.forEach(function (ArrayType) {\n      Object.defineProperty(ArrayType.prototype, key, {\n        value: replacements[key],\n      });\n    });\n  }\n}\n\nif (!String.prototype.endsWith) {\n  Object.defineProperty(String.prototype, 'endsWith', {\n    value: function (test) {\n      return this.slice(-test.length) === test;\n    },\n  });\n  Object.defineProperty(String.prototype, 'startsWith', {\n    value: function (test) {\n      return this.slice(0, test.length) === test;\n    },\n  });\n}\nif (!String.prototype.includes) {\n  Object.defineProperty(String.prototype, 'includes', {\n    value: function (search, start) {\n      return this.indexOf(search, start) !== -1;\n    },\n  });\n}\n\nif (!Array.prototype.includes) {\n  Object.defineProperty(Array.prototype, 'includes', {\n    value: function (search, start) {\n      return this.indexOf(search, start) !== -1;\n    },\n  });\n}\n\nif (!Object.values) {\n  Object.values = function values(obj) {\n    return Object.keys(obj).map((k) => obj[k]);\n  };\n}\n\nif (!Math.sign) {\n  Math.sign = function sign(a) {\n    return a < 0 ? -1 : a > 0 ? 1 : 0;\n  };\n}\n","// Portions Copyright 2008-2022 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// Initially derived from libGlov:utilPerf.h/GlovPerf.cpp\n// For good memory profiling, Chrome must be launched with --enable-precise-memory-info\n\n// eslint-disable-next-line @typescript-eslint/no-redeclare\n/* globals performance*/\n\nexport const HAS_MEMSIZE = Boolean(window.performance && performance.memory && performance.memory.usedJSHeapSize);\nexport const HIST_SIZE = 128;\nexport const HIST_COMPONENTS = 3; // count, time, dmem\nexport const HIST_TOT = HIST_SIZE * HIST_COMPONENTS;\n// Default `mem_depth` very low, as every profile section with\n//    memory adds about 12µs and 56bytes, compared to 1µs and 24bytes without\nexport const MEM_DEPTH_DEFAULT = 2;\n\nconst assert = require('assert');\nconst engine = require('./engine.js');\nconst { floor, max, min } = Math;\n\n// For profiler_ui.js\nconst { localStorageGetJSON, localStorageSetJSON } = require('./local_storage.js');\nlet profiler_open_keys = localStorageGetJSON('profiler_open_keys', {});\n\nlet last_id = 0;\nfunction ProfilerEntry(parent, name) {\n  this.parent = parent;\n  this.depth = parent ? parent.depth + 1 : 0;\n  this.next = null;\n  this.child = null;\n  this.name = name;\n  this.count = 0;\n  this.time = 0;\n  this.dmem = 0;\n  this.start_time = 0;\n  this.start_mem = 0;\n  this.history = new Float32Array(HIST_TOT);\n  // For profiler_ui.js\n  this.id = ++last_id;\n  this.show_children = !(parent && parent.parent) || profiler_open_keys[this.getKey()] || true;\n  this.color_override = null;\n}\nProfilerEntry.prototype.isEmpty = function () {\n  for (let ii = 0; ii < HIST_TOT; ii+=HIST_COMPONENTS) {\n    if (this.history[ii]) {\n      return false;\n    }\n  }\n  return true;\n};\nProfilerEntry.prototype.toJSON = function () {\n  let { next, child } = this;\n  while (next && next.isEmpty()) {\n    next = next.next;\n  }\n  while (child && child.isEmpty()) {\n    child = child.next;\n  }\n  let ret = {\n    i: this.name,\n    h: Array.prototype.slice.call(this.history), // Float32Array -> Array\n  };\n  if (next) {\n    ret.n = next;\n  }\n  if (child) {\n    ret.c = child;\n  }\n  return ret;\n};\nfunction profilerEntryFromJSON(parent, obj) {\n  let ret = new ProfilerEntry(parent, obj.i);\n  assert.equal(obj.h.length, ret.history.length);\n  for (let ii = 0; ii < obj.h.length; ++ii) {\n    ret.history[ii] = obj.h[ii];\n  }\n  if (obj.n) {\n    ret.next = profilerEntryFromJSON(parent, obj.n);\n  }\n  if (obj.c) {\n    ret.child = profilerEntryFromJSON(ret, obj.c);\n  }\n  return ret;\n}\n\n// For profiler_ui.js\nProfilerEntry.prototype.getKey = function () {\n  if (!this.parent) {\n    return '';\n  } else {\n    return `${this.parent.getKey()}.${this.name}`;\n  }\n};\n// For profiler_ui.js\nProfilerEntry.prototype.toggleShowChildren = function () {\n  this.show_children = !this.show_children;\n  if (this.show_children) {\n    profiler_open_keys[this.getKey()] = 1;\n  } else {\n    delete profiler_open_keys[this.getKey()];\n  }\n  localStorageSetJSON('profiler_open_keys', profiler_open_keys);\n};\n\nlet root = new ProfilerEntry(null, 'root');\n// Add static node to the tree that we will reference later\n// Note: profiler_ui.js assumes this is always `root.child`\nlet node_out_of_tick = new ProfilerEntry(root, 'GPU/idle');\nroot.child = node_out_of_tick;\n// Immediately add `tick` node, so it's always second in the list\nlet node_tick = new ProfilerEntry(root, 'tick');\nnode_out_of_tick.next = node_tick;\n\nlet current = root;\nlet history_index = 0;\nlet paused = false;\nlet mem_depth = MEM_DEPTH_DEFAULT;\nlet total_calls = 0;\nlet last_frame_total_calls = 0;\n\nfunction memSizeChrome() {\n  return performance.memory.usedJSHeapSize;\n}\nfunction memSizeNop() {\n  return 0;\n}\nlet memSize = HAS_MEMSIZE ? memSizeChrome : memSizeNop;\nlet mem_is_high_res = 10;\nconst WARN_CALLS_COUNT = 1000;\nexport function profilerWarning() {\n  if (last_frame_total_calls > WARN_CALLS_COUNT) {\n    return `Warning: Too many per-frame profilerStart() calls (${last_frame_total_calls} > ${WARN_CALLS_COUNT})`;\n  } else if (!HAS_MEMSIZE) {\n    return 'To access memory profiling, run in Chrome';\n  } else if (mem_depth > 1 && mem_is_high_res < 10) {\n    return 'For precise memory profiling, launch Chrome with --enable-precise-memory-info';\n  }\n  return '';\n}\n\nexport function profilerNodeRoot() {\n  return root;\n}\nexport function profilerNodeTick() {\n  return node_tick;\n}\nexport function profilerHistoryIndex() {\n  return history_index;\n}\n\nlet garbage_accum = [0, 0];\nlet garbage_count = [0, 0, 0];\nexport function profilerFrameStart() {\n  last_frame_total_calls = total_calls;\n  total_calls = 0;\n  root.count = 1;\n  let now = performance.now();\n  root.time = now - root.start_time;\n  root.start_time = now;\n  if (mem_depth > 0) {\n    let memnow = memSize();\n    root.dmem = memnow - root.start_mem;\n    root.start_mem = memnow;\n  }\n  node_out_of_tick.count = 1;\n  // Place the unaccounted portion of the root's time in `node_out_of_tick`\n  node_out_of_tick.time = root.time;\n  node_out_of_tick.dmem = root.dmem;\n  for (let walk = root.child; walk; walk = walk.next) {\n    if (walk === node_out_of_tick) {\n      continue;\n    }\n    node_out_of_tick.time -= walk.time;\n    node_out_of_tick.dmem -= walk.dmem;\n    if (mem_depth > 1) {\n      if (walk.count) {\n        // Should basically never see a `0` for dmem, if we do, probably low-precision memory tracking\n        if (walk.dmem) {\n          mem_is_high_res++;\n        } else {\n          mem_is_high_res-=5;\n        }\n      }\n    }\n  }\n  let pos = 0;\n  let neg = 0;\n  for (let walk = root.child; walk; walk = walk.next) {\n    if (walk.dmem < 0) {\n      neg -= walk.dmem;\n    } else {\n      pos += walk.dmem;\n    }\n  }\n  if (pos > neg) {\n    garbage_accum[0] += pos;\n    garbage_count[0]++;\n  } else {\n    garbage_accum[1] += neg;\n    garbage_count[1]++;\n  }\n  if (current !== root) {\n    console.error('Profiler starting new frame but some section was not stopped', current && current.name);\n    current = root;\n  }\n  let walk = root;\n  while (walk) {\n    let recursing_down = true;\n    if (!paused) {\n      walk.history[history_index] = walk.count;\n      walk.history[history_index+1] = walk.time;\n      walk.history[history_index+2] = walk.dmem;\n    }\n    walk.count = 0;\n    walk.time = 0;\n    walk.dmem = 0;\n    do {\n      if (recursing_down && walk.child) {\n        walk = walk.child;\n      } else if (walk.next) {\n        walk = walk.next;\n      } else {\n        walk = walk.parent;\n        recursing_down = false;\n        if (walk) {\n          continue;\n        }\n      }\n      break;\n    } while (true);\n  }\n  if (!paused) {\n    history_index = (history_index + HIST_COMPONENTS) % HIST_TOT;\n  }\n}\n\nfunction profilerStart(name) {\n  ++total_calls;\n\n  // Find us in current's children\n  let last = null;\n  let instance;\n  for (instance = current.child; instance; last = instance, instance = instance.next) {\n    if (instance.name === name) {\n      break;\n    }\n  }\n  if (!instance) {\n    if (!last) {\n      // No children yet\n      assert(!current.child);\n      instance = new ProfilerEntry(current, name);\n      current.child = instance;\n    } else {\n      instance = new ProfilerEntry(current, name);\n      last.next = instance;\n    }\n  } else {\n    assert(instance.parent === current);\n  }\n  // instance is set to us now!\n\n  current = instance;\n  instance.start_time = performance.now();\n  if (instance.depth < mem_depth) {\n    instance.start_mem = memSize();\n  }\n}\n\nfunction profilerStop(old_name) {\n  if (old_name) {\n    assert.equal(old_name, current.name);\n  }\n  current.time += performance.now() - current.start_time;\n  if (current.depth < mem_depth) {\n    current.dmem += memSize() - current.start_mem;\n  }\n  current.count++;\n  current = current.parent;\n}\n\nfunction profilerStopStart(name) {\n  // TODO: only sample timestamp once\n  profilerStop(null);\n  profilerStart(name);\n}\n\nif (window.performance && window.performance.now) {\n  window.profilerStart = profilerStart;\n  window.profilerStop = profilerStop;\n  window.profilerStopStart = profilerStopStart;\n} // else set to `nop` in bootstrap.js\n\nexport function profilerPaused() {\n  return paused;\n}\nexport function profilerPause(new_value) {\n  paused = new_value;\n}\n\nexport function profilerMemDepthGet() {\n  return mem_depth;\n}\n\nexport function profilerMemDepthSet(value) {\n  mem_depth = value;\n}\n\nexport function profilerTotalCalls() {\n  return last_frame_total_calls;\n}\n\nlet bloat_inner = { time: 0, mem: 0 };\nlet bloat_outer = { time: 0, mem: 0 };\nlet bloat = { inner: bloat_inner, outer: bloat_outer };\nconst MEASURE_KEY1 = 'profilerMeasureBloat';\nconst MEASURE_KEY2 = 'profilerMeasureBloat:child';\nconst MEASURE_HIST = 10;\nexport function profilerMeasureBloat() {\n  let mem_depth_saved = mem_depth;\n  if (mem_depth >= 2) {\n    mem_depth = Infinity;\n  }\n  profilerStart(MEASURE_KEY1);\n  profilerStart(MEASURE_KEY2);\n  profilerStopStart(MEASURE_KEY2);\n  profilerStopStart(MEASURE_KEY2);\n  profilerStopStart(MEASURE_KEY2);\n  profilerStop(MEASURE_KEY2);\n  profilerStop(MEASURE_KEY1);\n  mem_depth = mem_depth_saved;\n\n  let walk = null;\n  for (walk = current.child; walk.name !== MEASURE_KEY1; walk = walk.next) {\n    // just walk until we find it, should just be the first entry, though!\n  }\n  let child = walk.child;\n  assert.equal(child.name, MEASURE_KEY2);\n  bloat_inner.time = Infinity;\n  bloat_inner.mem = 0;\n  bloat_outer.time = Infinity;\n  bloat_outer.mem = 0;\n  let count_mem = 0;\n  let idx_start = ((history_index - HIST_COMPONENTS * MEASURE_HIST) + HIST_TOT) % HIST_TOT;\n  for (let offs = 0; offs < MEASURE_HIST; offs++) {\n    let idx = (idx_start + offs * HIST_COMPONENTS) % HIST_TOT;\n    bloat_inner.time = min(bloat_inner.time, child.history[idx+1]);\n    bloat_outer.time = min(bloat_outer.time, walk.history[idx+1]);\n    if (child.history[idx+2] > 0 && walk.history[idx+2] > 0) {\n      bloat_inner.mem += child.history[idx+2];\n      bloat_outer.mem += walk.history[idx+2];\n      ++count_mem;\n    }\n  }\n  bloat_inner.time /= 4;\n  bloat_outer.time = max(0, bloat_outer.time - bloat_inner.time) / 4;\n  let avg_inner_mem = bloat_inner.mem / count_mem / 4;\n  bloat_outer.mem = count_mem ? max(0, floor((bloat_outer.mem / count_mem - avg_inner_mem) / 4)) : 0;\n  bloat_inner.mem = count_mem ? max(0, floor(avg_inner_mem)) : 0;\n  // Code above semi-accurately measures the bloat in small scales, but seems\n  //   to overestimate on the grand scale (possibly some measurements are being\n  //   optimized away?), so, using this default value for memory instead\n  //   as measured Chrome 103 as an average over ~800 profiler calls in a\n  //   real app.\n  // On second consideration, not doing this: memory profiling is most useful when\n  //   looking at the leaf nodes, and the measured values best match the leaf\n  //   node values.\n  // bloat_outer.mem = 56;\n  return bloat;\n}\n\nexport function profilerGarbageEstimate() {\n  let ret;\n  if (garbage_count[0] > garbage_count[1]) {\n    ret = garbage_accum[0] / garbage_count[0];\n  } else {\n    ret = garbage_accum[1] / garbage_count[1];\n  }\n  garbage_count[0] = garbage_count[1] = 0;\n  garbage_accum[0] = garbage_accum[1] = 0;\n  return ret;\n}\n\nexport function profilerWalkTree(use_root, cb) {\n  let depth = 0;\n  let walk = use_root;\n  while (walk) {\n    let recursing_down = true;\n    if (walk !== use_root) {\n      if (!cb(walk, depth)) {\n        recursing_down = false;\n      }\n    }\n    do {\n      if (recursing_down && walk.child) {\n        depth++;\n        walk = walk.child;\n      } else if (walk.next) {\n        walk = walk.next;\n      } else {\n        depth--;\n        walk = walk.parent;\n        recursing_down = false;\n        if (walk) {\n          continue;\n        }\n      }\n      break;\n    } while (true);\n  }\n}\n\nexport function profilerAvgTime(entry) {\n  let sum = 0;\n  for (let ii = 0; ii < HIST_TOT; ii+=HIST_COMPONENTS) {\n    if (entry.history[ii]) {\n      sum += entry.history[ii+1];\n    }\n  }\n  return sum / HIST_SIZE;\n}\n\nexport function profilerMaxMem(entry) {\n  let dmem_max = 0;\n  for (let ii = 0; ii < HIST_TOT; ii+=HIST_COMPONENTS) {\n    if (entry.history[ii]) {\n      dmem_max = max(dmem_max, entry.history[ii+2]);\n    }\n  }\n  return dmem_max;\n}\n\nexport function profilerExport() {\n  let obj = {\n    history_index,\n    root,\n    mem_depth: HAS_MEMSIZE ? mem_depth : 0,\n    calls: last_frame_total_calls,\n    // Include some device info\n    device: {\n      ua: window.navigator.userAgent,\n      vendor: gl.getParameter(gl.VENDOR),\n      renderer: gl.getParameter(gl.RENDERER),\n      webgl: engine.webgl2 ? 2 : 1,\n      width: engine.width,\n      height: engine.height,\n    },\n  };\n  let debug_info = gl.getExtension('WEBGL_debug_renderer_info');\n  if (debug_info) {\n    obj.device.renderer_unmasked = gl.getParameter(debug_info.UNMASKED_RENDERER_WEBGL);\n    obj.device.vendor_unmasked = gl.getParameter(debug_info.UNMASKED_VENDOR_WEBGL);\n  }\n  let str = JSON.stringify(obj);\n  // Round all numbers (in text form) to 3 digits of precision, that's the most\n  //   we're getting from performance.now anyway, and JSON ends up with lots\n  //   of 0.12299999999999 strings otherwise.\n  str = str.replace(/\\d\\.\\d\\d\\d\\d+/g, (a) => {\n    a = a[5]>'4' ? a.slice(0,4) + (Number(a[4])+1) : a.slice(0,5);\n    while (a.slice(-1) === '0' || a.slice(-1) === '.') {\n      a = a.slice(0, -1);\n    }\n    return a;\n  });\n\n  return str;\n}\nexport function profilerImport(text) {\n  let obj;\n  try {\n    obj = JSON.parse(text);\n  } catch (e) {\n    // handled below\n  }\n  if (!obj) {\n    return null;\n  }\n\n  obj.root = profilerEntryFromJSON(null, obj.root);\n  return obj;\n}\n\n// For calling manually in the console for debugging\nexport function profilerDump() {\n  assert(current === root);\n  let lines = ['','','# PROFILER RESULTS'];\n\n  // Using \"% of frame\" and \"average\" equivalent options from profiler_ui\n  let total_frame_time = profilerAvgTime(root);\n\n  profilerWalkTree(root, function (walk, depth) {\n    let time_sum=0;\n    let count_sum=0;\n    let time_max=0;\n    let sum_count=0;\n    let dmem_max=0;\n    for (let ii = 0; ii < HIST_TOT; ii+=HIST_COMPONENTS) {\n      if (walk.history[ii]) {\n        sum_count++;\n        count_sum += walk.history[ii]; // count\n        time_sum += walk.history[ii+1]; // time\n        time_max = max(time_max, walk.history[ii+1]);\n        dmem_max = max(dmem_max, walk.history[ii+2]);\n      }\n    }\n    if (!count_sum) {\n      return true;\n    }\n    let percent = (time_sum/HIST_SIZE) / total_frame_time;\n\n    let ms = time_sum / sum_count;\n    let count = (count_sum / sum_count).toFixed(0);\n\n    let buf = '';\n    for (let ii = 1; ii < depth; ++ii) {\n      buf += '* ';\n    }\n    buf += `${(percent * 100).toFixed(0)}% ${walk.name} `;\n    buf += `${(ms*1000).toFixed(0)} (${count}) max:${(time_max*1000).toFixed(0)}`;\n    if (HAS_MEMSIZE) {\n      buf += ` dmem:${dmem_max}`;\n    }\n    lines.push(buf);\n    return true;\n  });\n  let warning = profilerWarning();\n  if (warning) {\n    lines.push('', warning);\n  }\n  lines.push('', '');\n  console.log(lines.join('\\n'));\n}\n\nwindow.profilerDump = profilerDump;\n","// Portions Copyright 2008-2022 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// Initially derived from libGlov:utilPerf.h/GlovPerf.cpp\n// For good memory profiling, Chrome must be launched with --enable-precise-memory-info\n\n\n/* eslint-disable import/order */\nconst camera2d = require('./camera2d.js');\nconst { cmd_parse } = require('./cmds.js');\nconst engine = require('./engine.js');\nconst { style } = require('./font.js');\nconst input = require('./input.js');\nconst { floor, max, min, round } = Math;\nconst { netClient, netDisconnected } = require('./net.js');\nconst ui = require('./ui.js');\nconst { perfGraphOverride, friendlyBytes } = require('./perf.js');\nconst {\n  HIST_SIZE,\n  HIST_COMPONENTS,\n  HIST_TOT,\n  HAS_MEMSIZE,\n  MEM_DEPTH_DEFAULT,\n  profilerAvgTime,\n  profilerImport,\n  profilerExport,\n  profilerHistoryIndex,\n  profilerMaxMem,\n  profilerMeasureBloat,\n  profilerMemDepthGet,\n  profilerMemDepthSet,\n  profilerNodeTick,\n  profilerNodeRoot,\n  profilerPause,\n  profilerPaused,\n  profilerTotalCalls,\n  profilerWalkTree,\n  profilerWarning,\n} = require('./profiler.js');\nconst settings = require('./settings.js');\nconst { spriteChainedStart, spriteChainedStop } = require('./sprites.js');\nconst { lerp } = require('glov/common/util.js');\nconst { vec2, vec4 } = require('glov/common/vmath.js');\n\nZ.PROFILER = Z.PROFILER || 9950; // above Z.BUILD_ERRORS\nlet color_gpu = vec4(0.5, 0.5, 1, 1);\n\nlet loaded_profile = null;\nlet node_out_of_tick;\nlet root;\n\nfunction useNewRoot(new_root) {\n  root = new_root;\n  node_out_of_tick = root.child;\n  if (node_out_of_tick) {\n    node_out_of_tick.color_override = color_gpu;\n  }\n}\n\nfunction useSavedProfile(text) {\n  let obj = profilerImport(text);\n  if (!obj) {\n    ui.modalDialog({\n      title: 'Error loading profile',\n      text: text || 'No data',\n      buttons: {\n        Ok: null,\n      },\n    });\n    return;\n  }\n  useNewRoot(obj.root);\n  loaded_profile = obj;\n}\n\nfunction useLiveProfile() {\n  useNewRoot(profilerNodeRoot());\n  loaded_profile = null;\n}\n\nfunction profilerToggle(data, resp_func) {\n  useLiveProfile();\n  if (data === '1') {\n    settings.set('show_profiler', 1);\n  } else if (data === '0') {\n    settings.set('show_profiler', 0);\n    profilerMemDepthSet(MEM_DEPTH_DEFAULT);\n  } else {\n    if (settings.show_profiler) {\n      if (profilerPaused()) {\n        profilerPause(false);\n      } else {\n        settings.set('show_profiler', 0);\n        profilerMemDepthSet(MEM_DEPTH_DEFAULT);\n      }\n    } else {\n      settings.set('show_profiler', 1);\n      profilerPause(true);\n    }\n  }\n\n  if (resp_func) {\n    resp_func();\n  }\n}\nconst access_show = engine.DEBUG ? undefined : ['hidden'];\ncmd_parse.register({\n  cmd: 'profiler_toggle',\n  help: 'Show or toggle profiler visibility',\n  access_show,\n  func: profilerToggle,\n});\nconst PROFILER_RELATIVE_LABELS = ['% of user', '% of parent', '% of frame', '% of mem'];\nsettings.register({\n  show_profiler: {\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n    access_show,\n  },\n  profiler_average: {\n    default_value: 1,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n    access_show: ['hidden'],\n  },\n  profiler_relative: {\n    default_value: 1,\n    type: cmd_parse.TYPE_INT,\n    range: [0, PROFILER_RELATIVE_LABELS.length-1],\n    access_show: ['hidden'],\n  },\n  profiler_interactable: {\n    default_value: 1,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n    access_show: ['hidden'],\n  },\n  profiler_graph: {\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n    access_show: ['hidden'],\n  },\n  profiler_mem_depth: {\n    default_value: MEM_DEPTH_DEFAULT,\n    type: cmd_parse.TYPE_INT,\n    range: [0,100],\n    access_show: ['hidden'],\n  },\n  profiler_hide_bloat: {\n    default_value: 1,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n    access_show,\n  },\n});\n\nlet font;\nlet y;\nconst style_time_spike = style(null, {\n  color: 0xFF7F7Fff,\n});\nconst style_number = style(null, {\n  color: 0xFFFFD0ff,\n});\nconst style_percent = style(null, {\n  color: 0xFFFFD0ff,\n});\nconst style_ms = style(null, {\n  color: 0xD0FFFFff,\n});\nconst style_mem = style(null, {\n  color: 0xD0FFD0ff,\n});\nconst style_header = style(null, {\n  color: 0xFFFFFFff,\n  outline_width: 0.8,\n  outline_color: 0xFFFFFFff,\n});\nconst style_name = style(null, {\n  color: 0xFFFFFFff,\n  outline_width: 1,\n  outline_color: 0x00000080,\n});\nconst FONT_SIZE = 22;\nconst LINE_HEIGHT = 24;\nconst LINE_YOFFS = (LINE_HEIGHT - FONT_SIZE)/2;\nlet font_number_scale;\nlet font_size_number;\nlet number_yoffs;\nlet bar_w;\n// Different Zs for better batching\nconst Z_BAR = Z.PROFILER;\nconst Z_GRAPH = Z.PROFILER+1;\nconst Z_TREE = Z.PROFILER+2;\nconst Z_NAMES = Z.PROFILER+3;\nconst Z_NUMBER = Z.PROFILER+4;\nconst Z_MS = Z.PROFILER+5;\nconst MS_W = 58;\nconst COUNT_W = 56;\nconst MSPAIR_W = MS_W + 4 + COUNT_W;\nconst MEM_W = 120;\nconst COL_HEADERS = ['Profiler', 'µs (count)', 'max', 'GC / Δmem'];\nconst COL_W = [400, MSPAIR_W, MS_W, MEM_W];\nconst COL_X = [];\nlet bar_x0;\nCOL_X[0] = 0;\nfor (let ii = 0; ii < COL_W.length; ++ii) {\n  COL_X[ii+1] = COL_X[ii] + COL_W[ii] + 4;\n}\nconst LINE_WIDTH_WITH_MEM = COL_X[COL_W.length];\nconst LINE_WIDTH_NO_MEM = COL_X[COL_W.length-1];\nlet color_hint = vec4(0,0.25,0,0.85);\nlet color_bar = vec4(0,0,0,0.85);\nlet color_bar2 = vec4(0.2,0.2,0.2,0.85);\nlet color_bar_header = vec4(0.3,0.3,0.3,0.85);\nlet color_bar_over = vec4(0,0,0.5,0.85);\nlet color_bar_over2 = vec4(0.2,0.2,0.7,0.85);\nlet color_bar_parent = vec4(0,0,0.3,0.85);\nlet color_bar_parent2 = vec4(0.2,0.2,0.4,0.85);\nlet color_timing = vec4(1, 1, 0.5, 1);\nlet color_bar_highlight = vec4(0,0,0, 0.5);\nconst GRAPH_FRAME_TIME = 16;\nlet GRAPH_MAX_MEM = 4096;\nlet total_frame_time;\nlet total_frame_mem;\nlet show_index_count;\nlet show_index_time;\nlet show_index_mem;\nlet do_average;\nlet history_index;\nlet do_ui;\nlet line_width;\nlet show_mem;\nlet mouseover_elem = {};\nlet mouseover_main_elem;\nlet mouseover_bar_idx;\nlet dmem_max_value = 0;\nlet perf_graph = {\n  history_size: HIST_SIZE,\n  num_lines: 2,\n  data: {\n    history: new Float32Array(HIST_SIZE * 2),\n    index: 0,\n  },\n  line_scale_top: GRAPH_FRAME_TIME,\n  bars_stack: true,\n  colors: [\n    vec4(0.5, 1.0, 0.5, 1),\n    color_gpu,\n  ],\n};\nlet bloat;\nfunction profilerShowEntryEarly(walk, depth) {\n  if (settings.profiler_relative === 0 && walk === node_out_of_tick) {\n    // doesn't make sense to show\n    return false;\n  }\n  let count_sum=0;\n  for (let ii = 0; ii < HIST_TOT; ii+=HIST_COMPONENTS) {\n    count_sum += walk.history[ii];\n  }\n  if (!count_sum) {\n    return true;\n  }\n  if (input.mouseOver({ x: 0, y, w: line_width, h: LINE_HEIGHT, peek: true })) {\n    mouseover_main_elem = walk;\n    mouseover_elem[walk.id] = 1;\n    for (let parent = walk.parent; parent; parent = parent.parent) {\n      mouseover_elem[parent.id] = 2;\n    }\n  }\n  y += LINE_HEIGHT;\n  if (!walk.show_children) {\n    return false;\n  }\n  return true;\n}\nfunction hasActiveChildren(walk) {\n  walk = walk.child;\n  if (!walk) {\n    return false;\n  }\n  while (walk) {\n    for (let ii = 0; ii < HIST_TOT; ii+=HIST_COMPONENTS) {\n      if (walk.history[ii]) {\n        return true;\n      }\n    }\n    walk = walk.next;\n  }\n  return false;\n}\nfunction childCallCount(node, with_mem) {\n  let walk = node.child;\n  let count = 0;\n  while (walk) {\n    if (do_average) {\n      let total = 0;\n      let sum_count = 0;\n      for (let ii = 0; ii < HIST_TOT; ii+=HIST_COMPONENTS) {\n        if (walk.history[ii] && (!with_mem || walk.history[ii+2])) {\n          sum_count++;\n          total += walk.history[ii]; // count\n        }\n      }\n      if (sum_count) {\n        count += round(total / sum_count);\n      }\n    } else {\n      if (!with_mem || walk.history[show_index_mem]) {\n        count += walk.history[show_index_count];\n      }\n    }\n    count += childCallCount(walk, with_mem);\n    walk = walk.next;\n  }\n  return count;\n}\nfunction profilerShowEntry(walk, depth) {\n  if (settings.profiler_relative === 0 && walk === node_out_of_tick) {\n    // doesn't make sense to show\n    return false;\n  }\n  let time_sum=0;\n  let count_sum=0;\n  let time_max=0;\n  let sum_count=0;\n  let dmem_min=Infinity;\n  let dmem_max=-Infinity;\n  for (let ii = 0; ii < HIST_TOT; ii+=HIST_COMPONENTS) {\n    if (walk.history[ii]) {\n      sum_count++;\n      count_sum += walk.history[ii]; // count\n      time_sum += walk.history[ii+1]; // time\n      time_max = max(time_max, walk.history[ii+1]);\n      let dmem = walk.history[ii+2];\n      dmem_max_value = max(dmem_max_value, dmem);\n      dmem_min = min(dmem_min, dmem);\n      dmem_max = max(dmem_max, dmem);\n    }\n  }\n  if (!count_sum) {\n    return true;\n  }\n  let over = mouseover_elem[walk.id] === 1;\n  let parent_over = mouseover_elem[walk.id] === 2;\n  if (do_ui) {\n    if (input.click({ x: 0, y, w: line_width, h: LINE_HEIGHT, button: 0 })) {\n      walk.toggleShowChildren();\n    } else if (input.click({ x: 0, y, w: line_width, h: LINE_HEIGHT, button: 1 })) {\n      walk.parent.toggleShowChildren();\n    }\n  }\n\n  profilerStart('bar graph');\n  spriteChainedStart();\n\n  // Draw background\n  let color_top = over ? color_bar_over : parent_over ? color_bar_parent : color_bar;\n  let color_bot = over ? color_bar_over2 : parent_over ? color_bar_parent2 : color_bar2;\n  if (!engine.defines.NORECTS) {\n    ui.drawRect4Color(0, y, line_width, y + LINE_HEIGHT, Z_BAR,\n      color_top, color_top, color_bot, color_bot);\n  }\n\n  // Draw bar graph\n  let x = bar_x0;\n  let offs = 1 + settings.profiler_graph;\n  let graph_max = settings.profiler_graph ? GRAPH_MAX_MEM : GRAPH_FRAME_TIME;\n  for (let ii = 0; ii < HIST_SIZE; ++ii) {\n    let value = walk.history[(history_index + ii*HIST_COMPONENTS) % HIST_TOT + offs];\n    if (value > 0) {\n      let hv = value / graph_max;\n      let h = min(hv * LINE_HEIGHT, LINE_HEIGHT);\n      if (hv < 1) {\n        color_timing[0] = hv;\n        color_timing[1] = 1;\n      } else {\n        color_timing[0] = 1;\n        color_timing[1] = max(0, 2 - hv);\n      }\n      let color = walk.color_override || color_timing;\n      if (!engine.defines.NORECTS) {\n        let elem = ui.drawRect(x + ii*bar_w, y + LINE_HEIGHT - h, x + (ii + 1)*bar_w, y + LINE_HEIGHT, Z_GRAPH, color);\n        elem.x = elem.y = 0; // no sorting by x/y required\n      }\n    }\n  }\n\n  spriteChainedStop();\n  profilerStop('bar graph');\n\n  y += LINE_YOFFS;\n\n  let prefix;\n  if (hasActiveChildren(walk)) {\n    if (!walk.show_children) {\n      prefix = '▶'; // '+';\n    } else {\n      prefix = '▼'; // '-';\n    }\n  }\n  let percent = 0;\n  if (settings.profiler_relative === 1) {\n    // \"% of parent\"\n    if (walk.parent) {\n      if (do_average) {\n        percent = (time_sum/HIST_SIZE) / profilerAvgTime(walk.parent);\n      } else {\n        percent = walk.history[show_index_time] / walk.parent.history[show_index_time];\n      }\n    }\n  } else if (settings.profiler_relative === 3) {\n    // % of mem\n    if (do_average) {\n      percent = dmem_max / total_frame_mem;\n    } else {\n      percent = walk.history[show_index_mem] / total_frame_mem;\n    }\n  } else {\n    if (do_average) {\n      percent = (time_sum/HIST_SIZE) / total_frame_time;\n    } else {\n      percent = walk.history[show_index_time] / total_frame_time;\n    }\n  }\n  x = depth * FONT_SIZE;\n  if (prefix) {\n    font.drawSized(null, x - 16, y, Z_TREE, FONT_SIZE, prefix);\n  }\n  x += FONT_SIZE*2;\n  font.drawSizedAligned(style_percent, x, y + number_yoffs, Z_NUMBER, font_size_number, font.ALIGN.HRIGHT, 0, 0,\n    `${(percent * 100).toFixed(0)}%`);\n  x += 4;\n  font.drawSized(style_name, x, y, Z_NAMES, FONT_SIZE,\n    walk.name);\n\n  x = COL_X[1];\n  let ms = do_average ? time_sum / sum_count : walk.history[show_index_time];\n  // TODO: removing timing bloat here (and in percents above? much more complicated...)\n  let count = do_average ? (count_sum / sum_count).toFixed(0) : walk.history[show_index_count];\n  font.drawSizedAligned(style_ms, x, y + number_yoffs, Z_MS, font_size_number, font.ALIGN.HRIGHT, MS_W, 0,\n    (ms*1000).toFixed(0));\n  x += MS_W + 4;\n  font.drawSizedAligned(style_number, x, y + number_yoffs, Z_NUMBER, font_size_number, font.ALIGN.HFIT, COUNT_W, 0,\n    `(${count})`);\n\n  x = COL_X[2];\n  let spike = (time_max * 0.25 > (time_sum / sum_count));\n  font.drawSizedAligned(spike ? style_time_spike : style_ms, x, y + number_yoffs, Z_MS, font_size_number,\n    font.ALIGN.HRIGHT, COL_W[2], 0,\n    (time_max*1000).toFixed(0));\n\n  if (show_mem) {\n    x = COL_X[3];\n\n    let mem_value = do_average ? dmem_max : walk.history[show_index_mem];\n    if (mem_value > 0) {\n      if (do_average) {\n        mem_value -= bloat.inner.mem * round(count_sum / sum_count);\n      } else {\n        mem_value -= bloat.inner.mem * walk.history[show_index_count];\n      }\n      let child_count = childCallCount(walk, true);\n      mem_value = max(0, mem_value - bloat.outer.mem * child_count);\n    }\n\n    if (dmem_min < 0) {\n      // Had a GC\n      font.drawSizedAligned(style_time_spike, x, y + number_yoffs, Z_MS, font_size_number,\n        font.ALIGN.HLEFT|font.ALIGN.HFIT, MEM_W/2, 0,\n        `${friendlyBytes(-dmem_min)}`);\n      font.drawSizedAligned(style_mem, x + MEM_W/2, y + number_yoffs, Z_MS, font_size_number,\n        font.ALIGN.HRIGHT|font.ALIGN.HFIT, MEM_W/2, 0,\n        `${mem_value}`);\n    } else {\n      // Just increase\n      font.drawSizedAligned(style_mem, x, y + number_yoffs, Z_MS, font_size_number, font.ALIGN.HRIGHT, MEM_W, 0,\n        `${mem_value}`);\n    }\n  }\n\n  y += FONT_SIZE + LINE_YOFFS;\n  if (!walk.show_children) {\n    return false;\n  }\n  return true;\n}\n\nfunction doZoomedGraph() {\n  if (settings.profiler_graph) {\n    perf_graph.line_scale_top = GRAPH_MAX_MEM;\n    if (!mouseover_main_elem) {\n      mouseover_main_elem = profilerNodeTick();\n    }\n  } else if (!mouseover_main_elem || mouseover_main_elem === node_out_of_tick) {\n    perf_graph.line_scale_top = GRAPH_FRAME_TIME * 2;\n  } else {\n    perf_graph.line_scale_top = GRAPH_FRAME_TIME;\n  }\n  let offs = 1 + settings.profiler_graph;\n  if (mouseover_main_elem) {\n    let elem = mouseover_main_elem;\n    for (let ii = 0; ii < HIST_SIZE; ++ii) {\n      perf_graph.data.history[ii*2] = elem.history[ii*HIST_COMPONENTS + offs];\n      perf_graph.data.history[ii*2+1] = 0;\n    }\n  } else {\n    for (let ii = 0; ii < HIST_SIZE; ++ii) {\n      let idx = ii*HIST_COMPONENTS + offs;\n      perf_graph.data.history[ii*2] = root.history[idx] - node_out_of_tick.history[idx];\n      perf_graph.data.history[ii*2+1] = node_out_of_tick.history[idx];\n    }\n  }\n  perf_graph.data.index = history_index/HIST_COMPONENTS;\n  perfGraphOverride(perf_graph);\n}\n\nconst BUTTON_W = 140;\nconst BUTTON_H = 48;\nconst BUTTON_FONT_HEIGHT = 24;\nlet mouse_pos = vec2();\nlet bloat_none = { inner: { time: 0, mem: 0 }, outer: { time: 0, mem: 0 } };\nfunction profilerUIRun() {\n  profilerStart('profilerUIRun');\n  profilerStart('top+buttons');\n  bloat = bloat_none;\n  if (!loaded_profile && settings.profiler_hide_bloat) {\n    bloat = profilerMeasureBloat();\n  }\n  if (engine.render_width) {\n    let scale = FONT_SIZE / ui.font_height;\n    camera2d.set(0, 0, scale * engine.render_width, scale * engine.render_height);\n    font_number_scale = 1;\n    bar_w = scale;\n  } else {\n    camera2d.setScreen(true);\n    font_number_scale = 0.9;\n    bar_w = 2;\n  }\n  bar_x0 = COL_X[1] - HIST_SIZE*bar_w;\n  font_size_number = FONT_SIZE * font_number_scale;\n  number_yoffs = (FONT_SIZE - font_size_number) / 2;\n\n  if (profilerMemDepthGet() !== settings.profiler_mem_depth) {\n    // First time opening the UI this session, restore previous mem_depth values\n    profilerMemDepthSet(settings.profiler_mem_depth);\n  }\n\n  if (loaded_profile) {\n    history_index = loaded_profile.history_index;\n    show_mem = loaded_profile.mem_depth > 0;\n  } else {\n    history_index = profilerHistoryIndex();\n    show_mem = HAS_MEMSIZE;\n  }\n  line_width = show_mem ? LINE_WIDTH_WITH_MEM : LINE_WIDTH_NO_MEM;\n\n  let z = Z.PROFILER + 10;\n  y = 0;\n  let x = line_width;\n  if (ui.buttonText({\n    x, y, z,\n    w: BUTTON_W, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n    text: settings.profiler_interactable ? 'interactable' : 'overlay',\n  })) {\n    settings.set('profiler_interactable', 1 - settings.profiler_interactable);\n  }\n  do_ui = settings.profiler_interactable;\n  if (do_ui && ui.buttonText({\n    x: x + BUTTON_W, y, z,\n    w: BUTTON_H, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n    text: 'X',\n  })) {\n    settings.set('show_profiler', 0);\n  }\n  y += BUTTON_H;\n\n  let text = loaded_profile ? 'loaded' : profilerPaused() ? 'paused' : 'live';\n  if (do_ui) {\n    if (ui.buttonText({\n      x, y, z,\n      w: BUTTON_W, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n      text,\n    })) {\n      if (loaded_profile) {\n        useLiveProfile();\n      } else {\n        profilerPause(!profilerPaused());\n      }\n    }\n  } else {\n    font.drawSizedAligned(null, x, y, z, FONT_SIZE, font.ALIGN.HVCENTERFIT, BUTTON_W, BUTTON_H, text);\n  }\n  y += BUTTON_H;\n\n  if (do_ui) {\n    if (ui.buttonText({\n      x, y, z,\n      w: BUTTON_W, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n      text: PROFILER_RELATIVE_LABELS[settings.profiler_relative],\n    })) {\n      settings.set('profiler_relative', (settings.profiler_relative + 1) % PROFILER_RELATIVE_LABELS.length);\n    }\n  } else {\n    font.drawSizedAligned(null, x, y, z, FONT_SIZE, font.ALIGN.HVCENTERFIT, BUTTON_W, BUTTON_H,\n      PROFILER_RELATIVE_LABELS[settings.profiler_relative]);\n  }\n  y += BUTTON_H;\n\n  if (do_ui) {\n    if (ui.buttonText({\n      x, y, z,\n      w: BUTTON_W, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n      text: settings.profiler_average ? 'average' : 'last frame',\n    })) {\n      settings.set('profiler_average', 1 - settings.profiler_average);\n    }\n  } else {\n    font.drawSizedAligned(null, x, y, z, FONT_SIZE, font.ALIGN.HVCENTERFIT, BUTTON_W, BUTTON_H,\n      settings.profiler_average ? 'average' : 'last frame');\n  }\n  y += BUTTON_H;\n\n  if (do_ui) {\n    if (ui.buttonText({\n      x, y, z,\n      w: BUTTON_W, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n      text: settings.profiler_graph ? 'graph: mem' : 'graph: CPU',\n    })) {\n      settings.set('profiler_graph', 1 - settings.profiler_graph);\n    }\n  } else {\n    font.drawSizedAligned(null, x, y, z, FONT_SIZE, font.ALIGN.HVCENTERFIT, BUTTON_W, BUTTON_H,\n      settings.profiler_graph ? 'graph: mem' : 'graph: CPU');\n  }\n  y += BUTTON_H;\n\n  if (loaded_profile ? true : HAS_MEMSIZE) {\n    let cur_depth = loaded_profile ? loaded_profile.mem_depth : profilerMemDepthGet();\n    font.drawSizedAligned(null, x, y, z, FONT_SIZE, font.ALIGN.HVCENTERFIT, BUTTON_W, LINE_HEIGHT,\n      'Mem Depth');\n    y += LINE_HEIGHT;\n    if (do_ui) {\n      if (ui.buttonText({\n        x, y, z,\n        w: BUTTON_W/3, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n        text: '-',\n        disabled: loaded_profile || cur_depth === 0,\n      })) {\n        profilerMemDepthSet(cur_depth - 1);\n        settings.set('profiler_mem_depth', profilerMemDepthGet());\n      }\n      if (ui.buttonText({\n        x: x + BUTTON_W/3, y, z,\n        w: BUTTON_W/3, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n        text: `${cur_depth || 'OFF'}`,\n        disabled: loaded_profile,\n      })) {\n        if (cur_depth === MEM_DEPTH_DEFAULT) {\n          profilerMemDepthSet(99);\n        } else {\n          profilerMemDepthSet(MEM_DEPTH_DEFAULT);\n        }\n        settings.set('profiler_mem_depth', profilerMemDepthGet());\n      }\n      if (ui.buttonText({\n        x: x + 2*BUTTON_W/3, y, z,\n        w: BUTTON_W/3, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n        text: '+',\n        disabled: loaded_profile,\n      })) {\n        profilerMemDepthSet(cur_depth + 1);\n        settings.set('profiler_mem_depth', profilerMemDepthGet());\n      }\n    } else {\n      font.drawSizedAligned(null, x, y, z, FONT_SIZE, font.ALIGN.HVCENTERFIT, BUTTON_W, BUTTON_H,\n        `${cur_depth || 'OFF'}`);\n    }\n    y += BUTTON_H;\n  }\n\n  text = settings.max_fps === 1000 ? 'max CPU' : settings.max_fps === 0 ? 'anim frame' : '?';\n  if (do_ui) {\n    if (ui.buttonText({\n      x, y, z,\n      w: BUTTON_W, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n      text,\n    })) {\n      settings.set('max_fps', settings.max_fps === 0 ? 1000 : 0);\n    }\n  } else {\n    font.drawSizedAligned(null, x, y, z, FONT_SIZE, font.ALIGN.HVCENTERFIT, BUTTON_W, BUTTON_H, text);\n  }\n  y += BUTTON_H;\n\n  font.drawSizedAligned(null, x, y, z, FONT_SIZE, font.ALIGN.HVCENTERFIT, BUTTON_W, LINE_HEIGHT,\n    `${loaded_profile ? loaded_profile.calls : profilerTotalCalls()} calls`);\n  y += LINE_HEIGHT;\n\n  if (do_ui) {\n    if (ui.buttonText({\n      x, y, z,\n      w: BUTTON_W/2, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n      text: 'save',\n      disabled: loaded_profile,\n    })) {\n      // Note: doesn't work in IE, but we probably don't care\n      let a = document.createElement('a');\n      a.href = `data:application/json,${encodeURIComponent(profilerExport())}`;\n      a.setAttribute('download', 'profile.json');\n      a.click();\n    }\n    if (ui.buttonText({\n      x: x + BUTTON_W/2, y, z,\n      w: BUTTON_W/2, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n      text: 'load',\n    })) {\n      let input_elem = document.createElement('input');\n      input_elem.setAttribute('type', 'file');\n      let reader = new FileReader();\n      reader.onload = () => {\n        if (reader.readyState === 2) {\n          useSavedProfile(reader.error || reader.result);\n        }\n      };\n      input_elem.onchange = () => {\n        reader.readAsText(input_elem.files[0]);\n      };\n      input_elem.click();\n    }\n    y += BUTTON_H;\n  }\n\n  ui.drawRect(x, 0, x + BUTTON_W, y, z-1, color_bar);\n\n  y = 0;\n\n  font.drawSizedAligned(style_header, COL_X[0], y, z, FONT_SIZE, font.ALIGN.HLEFT, COL_W[0], 0, COL_HEADERS[0]);\n  for (let ii = 1; ii < COL_HEADERS.length - (show_mem ? 0 : 1); ++ii) {\n    font.drawSizedAligned(style_header, COL_X[ii], y, z, FONT_SIZE, font.ALIGN.HCENTER, COL_W[ii], 0, COL_HEADERS[ii]);\n  }\n  ui.drawRect(0, y, line_width, y + LINE_HEIGHT, z-1, color_bar_header);\n  y += LINE_HEIGHT;\n\n  let y0 = y;\n\n  // first determine mouseover tree\n  mouseover_main_elem = null;\n  mouseover_bar_idx = -1;\n  if (do_ui) {\n    mouseover_elem = {};\n    profilerWalkTree(root, profilerShowEntryEarly);\n    if (mouseover_main_elem) {\n      let xx = input.mousePos(mouse_pos)[0] - bar_x0;\n      mouseover_bar_idx = floor(xx / bar_w);\n      if (mouseover_bar_idx < 0 || mouseover_bar_idx >= HIST_SIZE) {\n        mouseover_bar_idx = -1;\n      }\n      // Just use this one elem's values\n      dmem_max_value = 0;\n      for (let ii = 0; ii < HIST_TOT; ii+=HIST_COMPONENTS) {\n        if (mouseover_main_elem.history[ii]) {\n          dmem_max_value = max(dmem_max_value, mouseover_main_elem.history[ii+2]);\n        }\n      }\n    }\n  }\n\n  if (dmem_max_value < GRAPH_MAX_MEM * 0.25 || dmem_max_value > GRAPH_MAX_MEM) {\n    GRAPH_MAX_MEM = lerp(0.1, GRAPH_MAX_MEM, dmem_max_value);\n  }\n  dmem_max_value = 0;\n  do_average = settings.profiler_average;\n  show_index_count = (history_index - HIST_COMPONENTS + HIST_TOT) % HIST_TOT;\n\n  if (mouseover_bar_idx !== -1) {\n    // override do_average if the mouse is over a particular frame in the bar graph\n    do_average = false;\n    show_index_count = (show_index_count - (HIST_SIZE - mouseover_bar_idx - 1) * HIST_COMPONENTS + HIST_TOT) % HIST_TOT;\n  }\n\n  show_index_time = show_index_count + 1;\n  show_index_mem = show_index_count + 2;\n\n  if (do_average) {\n    // use average for percents and timing\n    if (settings.profiler_relative === 0) {\n      // \"% of user\"\n      total_frame_time = 0;\n      let walk = root.child;\n      while (walk) {\n        if (walk !== node_out_of_tick) {\n          total_frame_time += profilerAvgTime(walk);\n        }\n        walk = walk.next;\n      }\n      total_frame_time = max(total_frame_time, 0.001);\n    } else if (settings.profiler_relative === 2) {\n      // \"% of frame\"\n      total_frame_time = profilerAvgTime(root);\n    } else if (settings.profiler_relative === 3) {\n      total_frame_mem = profilerMaxMem(root);\n    }\n  } else {\n    // use last frame for percents\n    if (settings.profiler_relative === 0) {\n      // \"% of user\"\n      total_frame_time = 0;\n      let walk = root.child;\n      while (walk) {\n        if (walk !== node_out_of_tick) {\n          total_frame_time += walk.history[show_index_time];\n        }\n        walk = walk.next;\n      }\n      total_frame_time = max(total_frame_time, 0.001);\n    } else if (settings.profiler_relative === 2) {\n      // \"% of frame\"\n      total_frame_time = root.history[show_index_time];\n    } else if (settings.profiler_relative === 3) {\n      total_frame_mem = root.history[show_index_mem];\n      if (total_frame_mem < 0) {\n        // sum positive children instead, for better estimate\n        let walk = root.child;\n        total_frame_mem = 0;\n        while (walk) {\n          total_frame_mem += max(0, walk.history[show_index_mem]);\n          walk = walk.next;\n        }\n      }\n    }\n  }\n\n  profilerStopStart('interface');\n\n  // then render / do UI\n  y = y0;\n  profilerWalkTree(root, profilerShowEntry);\n  let hint = !loaded_profile && profilerWarning();\n  if (hint) {\n    font.drawSizedAligned(style_name, FONT_SIZE, y, Z_NAMES, FONT_SIZE,\n      font.ALIGN.HVCENTERFIT, line_width - FONT_SIZE*2, LINE_HEIGHT*1.5,\n      hint);\n    ui.drawRect(0, y,\n      line_width, y + LINE_HEIGHT*1.5, Z_NAMES - 0.5,\n      color_hint);\n  }\n\n  // profilerStopStart('bottom'); // nothing\n\n  if (mouseover_bar_idx !== -1) {\n    ui.drawRect(bar_x0 + mouseover_bar_idx * bar_w, y0,\n      bar_x0 + (mouseover_bar_idx + 1) * bar_w, y, Z_GRAPH + 0.5,\n      color_bar_highlight);\n  }\n\n  if (do_ui) {\n    // consume mouseover regardless\n    input.mouseOver({ x: 0, y: 0, w: line_width, h: y });\n  }\n\n  doZoomedGraph();\n\n  profilerStop();\n  profilerStop('profilerUIRun');\n}\n\nexport function profilerUIStartup() {\n  ({ font } = ui);\n  useLiveProfile();\n}\n\nexport function profilerUI() {\n  if (engine.DEBUG && input.keyUpEdge(input.KEYS.F7)) {\n    profilerToggle();\n  }\n  if (settings.show_profiler) {\n    profilerUIRun();\n  }\n  if (engine.DEBUG || settings.show_profiler) {\n    // TODO: warn if more than some number of profiler calls per frame\n  }\n}\n\ncmd_parse.register({\n  cmd: 'profile',\n  help: 'Captures a performance profile for developer investigation',\n  prefix_usage_with_help: true,\n  usage: 'Optionally delays for DELAY seconds before capturing the profile.\\n' +\n    'Usage: /profile [DELAY]',\n  func: function (str, resp_func) {\n    function doit() {\n      let profile = profilerExport();\n      if (netDisconnected()) {\n        ui.provideUserString('Profiler Snapshot', profile);\n        resp_func();\n      } else {\n        netClient().send('profile', profile, function (err, data) {\n          if (data?.id) {\n            ui.provideUserString('Profile submitted', `ID=${data.id}`);\n            resp_func(null, `Profile submitted with ID=${data.id}`);\n          } else {\n            resp_func(err, data);\n          }\n        });\n      }\n    }\n    if (Number(str)) {\n      setTimeout(doit, Number(str) * 1000);\n    } else {\n      doit();\n    }\n  },\n});\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// Vector math functions required by the rest of the engine taken piecemeal from\n// gl-matrix and related, as well as some generic math utilities\n\n// Source of some: https://github.com/toji/gl-matrix/blob/master/src/quat.js\n\nconst { vec4 } = require('glov/common/vmath.js');\nconst { acos, cos, sin, sqrt } = Math;\n\nconst EPSILON = 0.000001;\n\nexports.unit_quat = vec4(0, 0, 0, -1);\n\nexport function quat() {\n  return vec4(0, 0, 0, -1);\n}\nexports.createQuat = quat;\n\n// qi == \"quaterion in-place\" operation\n\n// Not completely sure we need this part of normalizing?  Some libraries have it, others do not\nexport function qiNegW(q) {\n  if (q[3] > 0) {\n    q[0] *= -1;\n    q[1] *= -1;\n    q[2] *= -1;\n    q[3] *= -1;\n  }\n}\n\nexport function qiNormalize(q) {\n  let l = sqrt(q[0] * q[0] + q[1] * q[1] +\n                    q[2] * q[2] + q[3] * q[3]);\n  if (l !== 0) {\n    let il = 1.0 / l;\n    q[0] *= il;\n    q[1] *= il;\n    q[2] *= il;\n    q[3] *= il;\n  }\n  qiNegW(q);\n}\n\n// axis must be normalized\nexport function qFromAxisAngle(out, axis, angle) {\n  angle *= 0.5;\n  let s = sin(angle);\n  out[0] = s * axis[0];\n  out[1] = s * axis[1];\n  out[2] = s * axis[2];\n  out[3] = cos(angle);\n  qiNegW(out);\n  return out;\n}\n\nexport function qFromYPR(out, yaw, pitch, roll) {\n  let s_pitch = sin(pitch*0.5);\n  let c_pitch = cos(pitch*0.5);\n  let s_yaw = sin(yaw*0.5);\n  let c_yaw = cos(yaw*0.5);\n  let s_roll = sin(roll*0.5);\n  let c_roll = cos(roll*0.5);\n  let c_pitch_c_yaw = c_pitch*c_yaw;\n  let s_pitch_s_yaw = s_pitch*s_yaw;\n  let s_pitch_c_yaw = s_pitch*c_yaw;\n  let c_pitch_s_yaw = c_pitch*s_yaw;\n\n  out[0] = s_pitch_c_yaw * c_roll - c_pitch_s_yaw * s_roll;\n  out[1] = s_pitch_s_yaw * c_roll + c_pitch_c_yaw * s_roll;\n  out[2] = c_pitch_s_yaw * c_roll + s_pitch_c_yaw * s_roll;\n  out[3] = c_pitch_c_yaw * c_roll - s_pitch_s_yaw * s_roll;\n\n  qiNormalize(out);\n  return out;\n}\n\n// export function qToYPR(ypr, q) {\n//   let xx = q[0] * q[0];\n//   let yy = q[1] * q[1];\n//   let zz = q[2] * q[2];\n//   let asinparam = 2 * (q[3] * q[0] + q[1] * q[2]);\n//   let y;\n//   let p;\n//   let r;\n//   if (abs(asinparam) > 0.99999) {\n//     let sign = (asinparam < 0) ? -1 : 1;\n//     y = sign * 2 * atan2(q[2], q[0]);\n//     p = sign * PI/2;\n//     r = 0;\n//     if (y < -PI) {\n//       y += 2 * PI;\n//     }\n//     if (y > PI) {\n//       y -= 2 * PI;\n//     }\n//   } else {\n//     y = atan2(\n//       2 * (q[3] * q[2] - q[0] * q[1]),\n//       1 - 2 * (xx + zz)\n//     );\n//     p = asin(asinparam);\n//     r = atan2(\n//       2 * (q[3] * q[1] - q[0] * q[2]),\n//       1 - 2 * (xx + yy)\n//     );\n//   }\n//   v3set(ypr, y, p, r);\n// }\n\nexport function qRotateX(out, a, rad) {\n  rad *= 0.5;\n\n  let ax = a[0];\n  let ay = a[1];\n  let az = a[2];\n  let aw = a[3];\n  let bx = sin(rad);\n  let bw = cos(rad);\n\n  out[0] = ax * bw + aw * bx;\n  out[1] = ay * bw + az * bx;\n  out[2] = az * bw - ay * bx;\n  out[3] = aw * bw - ax * bx;\n  return out;\n}\n\nexport function qRotateY(out, a, rad) {\n  rad *= 0.5;\n\n  let ax = a[0];\n  let ay = a[1];\n  let az = a[2];\n  let aw = a[3];\n  let by = sin(rad);\n  let bw = cos(rad);\n\n  out[0] = ax * bw - az * by;\n  out[1] = ay * bw + aw * by;\n  out[2] = az * bw + ax * by;\n  out[3] = aw * bw - ay * by;\n  return out;\n}\n\nexport function qRotateZ(out, a, rad) {\n  rad *= 0.5;\n\n  let ax = a[0];\n  let ay = a[1];\n  let az = a[2];\n  let aw = a[3];\n  let bz = sin(rad);\n  let bw = cos(rad);\n\n  out[0] = ax * bw + ay * bz;\n  out[1] = ay * bw - ax * bz;\n  out[2] = az * bw + aw * bz;\n  out[3] = aw * bw - az * bz;\n  return out;\n}\n\n\nexport function qSlerp(out, t, a, b) {\n  // benchmarks:\n  //    http://jsperf.com/quaternion-slerp-implementations\n  let ax = a[0];\n  let ay = a[1];\n  let az = a[2];\n  let aw = a[3];\n  let bx = b[0];\n  let by = b[1];\n  let bz = b[2];\n  let bw = b[3];\n\n  let scale0;\n  let scale1;\n\n  // calc cosine\n  let cosom = ax * bx + ay * by + az * bz + aw * bw;\n  // adjust signs (if necessary)\n  if (cosom < 0.0) {\n    cosom = -cosom;\n    bx = -bx;\n    by = -by;\n    bz = -bz;\n    bw = -bw;\n  }\n  // calculate coefficients\n  if ((1.0 - cosom) > EPSILON) {\n    // standard case (slerp)\n    let omega = acos(cosom);\n    let sinom = sin(omega);\n    scale0 = sin((1.0 - t) * omega) / sinom;\n    scale1 = sin(t * omega) / sinom;\n  } else {\n    // \"from\" and \"to\" quaternions are very close\n    //  ... so we can do a linear interpolation\n    scale0 = 1.0 - t;\n    scale1 = t;\n  }\n  // calculate final values\n  out[0] = scale0 * ax + scale1 * bx;\n  out[1] = scale0 * ay + scale1 * by;\n  out[2] = scale0 * az + scale1 * bz;\n  out[3] = scale0 * aw + scale1 * bw;\n\n  return out;\n}\n\nexport function qTransformVec3(out, a, q) {\n  let qx = q[0];\n  let qy = q[1];\n  let qz = q[2];\n  let qw = q[3];\n  let x = a[0];\n  let y = a[1];\n  let z = a[2];\n  // var qvec = [qx, qy, qz];\n  // var uv = vec3.cross([], qvec, a);\n  let uvx = qy * z - qz * y;\n  let uvy = qz * x - qx * z;\n  let uvz = qx * y - qy * x;\n  // var uuv = vec3.cross([], qvec, uv);\n  let uuvx = qy * uvz - qz * uvy;\n  let uuvy = qz * uvx - qx * uvz;\n  let uuvz = qx * uvy - qy * uvx;\n  // vec3.scale(uv, uv, 2 * w);\n  let w2 = qw * 2;\n  uvx *= w2;\n  uvy *= w2;\n  uvz *= w2;\n  // vec3.scale(uuv, uuv, 2);\n  uuvx *= 2;\n  uuvy *= 2;\n  uuvz *= 2;\n  // return vec3.add(out, a, vec3.add(out, uv, uuv));\n  out[0] = x + uvx + uuvx;\n  out[1] = y + uvy + uuvy;\n  out[2] = z + uvz + uuvz;\n  return out;\n}\n\nexport function qMult(out, a, b) {\n  let ax = a[0];\n  let ay = a[1];\n  let az = a[2];\n  let aw = a[3];\n  let bx = b[0];\n  let by = b[1];\n  let bz = b[2];\n  let bw = b[3];\n\n  out[0] = ax * bw + aw * bx + ay * bz - az * by;\n  out[1] = ay * bw + aw * by + az * bx - ax * bz;\n  out[2] = az * bw + aw * bz + ax * by - ay * bx;\n  out[3] = aw * bw - ax * bx - ay * by - az * bz;\n  return out;\n}\n\nexport function qInvert(out, a) {\n  let a0 = a[0];\n  let a1 = a[1];\n  let a2 = a[2];\n  let a3 = a[3];\n  let denom = a0 * a0 + a1 * a1 + a2 * a2 + a3 * a3;\n  let scale = denom ? 1.0 / denom : 0;\n\n  out[0] = -a0 * scale;\n  out[1] = -a1 * scale;\n  out[2] = -a2 * scale;\n  out[3] = a3 * scale;\n  return out;\n}\n\n\nexport function qLerp(out, t, v0, v1) {\n\n  qiNormalize(v0);\n  qiNormalize(v1);\n  let d = v0[0] * v1[0] + v0[1] * v1[1] + v0[2] * v1[2] + v0[3] * v1[3];\n  let v0_t = (d < 0 ? -1 : 1) * (1 - t);\n\n  out[0] =v0[0]*v0_t+v1[0]*t;\n  out[1] =v0[1]*v0_t+v1[1]*t;\n  out[2] =v0[2]*v0_t+v1[2]*t;\n  out[3] =v0[3]*v0_t+v1[3]*t;\n\n  qiNormalize(out);\n  return out;\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// RandSeed2\n// Derived from libGlov, MIT Licensed\n// Super-simple RNG.  2-3x faster than Alea, but probably some correlation in\n//   anything but 1D.\n// Allows for fast, direct manipulation of rand.seed (if correlation between adjacent seeds is acceptable)\n\n//const MAX_INT2 = 0xFFFFFFFF;\n\n// Initialize with two steps past the seed, otherwise close seeds (e.g. 0 and 1) produce very close first results\nfunction step2(seed) {\n  seed = (seed >>> 0) || 0x532f638c2; // arbitrary non-zero\n  seed ^= seed << 13;\n  seed ^= seed >>> 17;\n  seed ^= seed << 5;\n  seed ^= seed << 13;\n  seed ^= seed >>> 17;\n  seed ^= seed << 5;\n  return seed >>> 0;\n}\n\nfunction RandSeed2(seed) {\n  this.seed = step2(seed);\n}\nRandSeed2.prototype.reseed = function (seed) {\n  this.seed = step2(seed);\n};\nRandSeed2.prototype.step = function () { // as long as seed is never === 0, this never returns 0\n  let seed = this.seed;\n  seed ^= seed << 13;\n  seed ^= seed >>> 17;\n  seed ^= seed << 5;\n  return (this.seed = (seed >>> 0)) - 1;\n};\nRandSeed2.prototype.uint32 = RandSeed2.prototype.step;\n// returns [0,range-1]\nRandSeed2.prototype.range = function (range) {\n  // slightly slower (esp before opt): return (this.step() * range / MAX_INT2) | 0; // faster than this.step() % range\n  // slower: return this.step() % range;\n  return (this.step() * range * 2.3283064376e-10) | 0; // 1/MAX_INT2 - largest float such that 0xFFFFFFFE*f < 1.0\n};\n// returns [0,1)\nRandSeed2.prototype.random = function () {\n  // slower: return this.step() / MAX_INT2\n  return this.step() * 2.3283064376e-10; // 1/MAX_INT2 - largest float such that 0xFFFFFFFE*f < 1.0\n};\nRandSeed2.prototype.floatBetween = function (a, b) {\n  return a + (b - a) * this.random();\n};\n\nexport function randFastCreate(seed) {\n  return new RandSeed2(seed);\n}\n\n// from https://www.shadertoy.com/view/wsXfDM\nconst RND_A = 134775813;\nconst RND_B = 1103515245;\nexport function randSimpleSpatial(seed, x, y, z) {\n  y += z * 10327;\n\n  return (((((x ^ y) * RND_A) ^ (seed + x)) * (((RND_B * x) << 16) ^ (RND_B * y) - RND_A)) >>> 0) / 4294967295;\n}\n","// Portions Copyright 2022 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nimport assert from 'assert';\nimport { clamp, merge } from 'glov/common/util.js';\nimport verify from 'glov/common/verify.js';\nimport { Vec4, vec2, vec4 } from 'glov/common/vmath';\nimport * as camera2d from './camera2d.js';\nimport * as engine from './engine.js';\nimport * as input from './input.js';\nimport { KEYS, PAD } from './input.js';\nimport {\n  SPOT_DEFAULT_BUTTON,\n  SPOT_STATE_DOWN,\n  SPOT_STATE_FOCUSED,\n  spot,\n  spotSubBegin,\n  spotSubEnd,\n  spotUnfocus,\n} from './spot.js';\nimport { clipPop, clipPush } from './sprites.js';\nimport * as ui from './ui.js';\n\nconst { max, min, round } = Math;\n\n// TODO: move FocusableElement to appropriate TS file after conversion (probably input)\ninterface FocusableElement {\n  focus: () => void;\n  is_focused: boolean;\n}\n\nconst MAX_OVERSCROLL = 50;\nconst OVERSCROLL_DELAY_WHEEL = 180;\n\nfunction darken(color: Vec4, factor: number): Vec4 {\n  return vec4(color[0] * factor, color[1] * factor, color[2] * factor, color[3]);\n}\n\nlet default_pixel_scale = 1;\nexport function scrollAreaSetPixelScale(scale: number): void {\n  default_pixel_scale = scale;\n}\n\ninterface ScrollAreaOptsAll {\n  // configuration options\n  x: number;\n  y: number;\n  z: number;\n  w: number;\n  h: number; // height of visible area, not scrolled area\n  rate_scroll_click: number;\n  pixel_scale: number;\n  top_pad: boolean; // set to false it the top/bottom \"buttons\" don't look like buttons\n  color: Vec4;\n  background_color: Vec4 | null;\n  auto_scroll: boolean; // If true, will scroll to the bottom if the height changes and we're not actively scrolling\n  auto_hide: boolean; // If true, will hide the scroll bar when the scroll area does not require it\n  no_disable: boolean; // Use with auto_hide=false to always do scrolling actions (overscroll, mousewheel)\n  focusable_elem: FocusableElement | null; // Another element to call .focus() on if we think we are focused\n  min_dist: number | undefined; // Minimum drag distance for background drag\n  disabled: boolean;\n\n  // Calculated (only once) if not set\n  rate_scroll_wheel: number;\n  rollover_color: Vec4;\n  rollover_color_light: Vec4;\n  disabled_color: Vec4;\n}\n\nexport type ScrollAreaOpts = Partial<ScrollAreaOptsAll>;\n\nexport interface ScrollArea extends Readonly<ScrollAreaOptsAll> {\n  barWidth(): number;\n  isFocused(): boolean;\n  consumedClick(): boolean;\n  isVisible(): boolean;\n  begin(params?: ScrollAreaOpts): void;\n  // Includes overscroll - actual visible scroll pos for this frame\n  getScrollPos(): number;\n  keyboardScroll(): void;\n  end(h: number): void;\n}\n\nlet temp_pos = vec2();\nlet last_scroll_area_id = 0;\nclass ScrollAreaInternal implements ScrollArea {\n  id = `sa:${++last_scroll_area_id}`;\n  x = 0;\n  y = 0;\n  z = Z.UI;\n  w = 10;\n  h = 10;\n  rate_scroll_click = ui.font_height;\n  pixel_scale = default_pixel_scale;\n  top_pad = true;\n  color = vec4(1,1,1,1);\n  background_color: Vec4 | null = vec4(0.4, 0.4, 0.4, 1);\n  auto_scroll = false;\n  auto_hide = false;\n  no_disable = false;\n  focusable_elem: FocusableElement | null = null;\n  min_dist: number | undefined;\n  disabled = false;\n\n  // Calculated (only once) if not set\n  rate_scroll_wheel;\n  rollover_color;\n  rollover_color_light;\n  disabled_color;\n\n  // run-time state\n  scroll_pos = 0;\n  overscroll = 0; // overscroll beyond beginning or end\n  overscroll_delay = 0;\n  grabbed_pos = 0;\n  grabbed = false;\n  consumed_click = false;\n  drag_start: number | null = null;\n  began = false;\n  last_internal_h = 0;\n  last_frame = 0;\n  was_disabled = false;\n  scrollbar_visible = false;\n  last_max_value = 0;\n\n  constructor(params?: ScrollAreaOpts) {\n    params = params || {};\n    this.applyParams(params);\n    this.rate_scroll_wheel = params.rate_scroll_wheel || this.rate_scroll_click * 2;\n    this.rollover_color = params.rollover_color || darken(this.color, 0.75);\n    this.rollover_color_light = params.rollover_color_light || darken(this.color, 0.95);\n    // equality is used to detect if this gets used and prevent rollover\n    assert(this.rollover_color_light !== this.color);\n    this.disabled_color = params.disabled_color || this.rollover_color;\n  }\n\n  applyParams(params?: ScrollAreaOpts): void {\n    if (!params) {\n      return;\n    }\n    merge(this, params);\n  }\n\n  barWidth(): number {\n    let { pixel_scale } = this;\n    let { scrollbar_top } = ui.sprites;\n    return scrollbar_top.uidata.total_w * pixel_scale;\n  }\n\n  isFocused(): boolean {\n    assert(false, 'deprecated?');\n    return false;\n  }\n\n  consumedClick(): boolean {\n    return this.consumed_click;\n  }\n\n  isVisible(): boolean {\n    return this.scrollbar_visible;\n  }\n\n  begin(params?: ScrollAreaOpts): void {\n    this.applyParams(params);\n    let { x, y, w, h, z, id } = this;\n    verify(!this.began); // Checking mismatched begin/end\n    this.began = true;\n    spotSubBegin({ x, y, w, h, key: id });\n    // Set up camera and clippers\n    clipPush(z + 0.05, x, y, w - this.barWidth(), h);\n    let camera_orig_x0 = camera2d.x0();\n    let camera_orig_x1 = camera2d.x1();\n    let camera_orig_y0 = camera2d.y0();\n    let camera_orig_y1 = camera2d.y1();\n    // map (0,0) onto (x,y) in the current camera space, keeping w/h scale the same\n    let camera_new_x0 = -(x - camera_orig_x0);\n    let camera_new_y0 = -(y - camera_orig_y0) + this.getScrollPos();\n    let camera_new_x1 = camera_new_x0 + camera_orig_x1 - camera_orig_x0;\n    let camera_new_y1 = camera_new_y0 + camera_orig_y1 - camera_orig_y0;\n    camera2d.push();\n    camera2d.set(camera_new_x0, camera_new_y0, camera_new_x1, camera_new_y1);\n  }\n\n  // Includes overscroll - actual visible scroll pos for this frame\n  getScrollPos(): number {\n    return round(this.scroll_pos + this.overscroll);\n  }\n\n  clampScrollPos(): void {\n    let clamped_pos = clamp(this.scroll_pos, 0, this.last_max_value);\n    if (this.scroll_pos < 0) {\n      this.overscroll = max(this.scroll_pos, -MAX_OVERSCROLL);\n    } else if (this.scroll_pos > this.last_max_value) {\n      this.overscroll = min(this.scroll_pos - this.last_max_value, MAX_OVERSCROLL);\n    }\n    this.scroll_pos = clamped_pos;\n  }\n\n  keyboardScroll(): void {\n    if (this.was_disabled) {\n      return;\n    }\n    let modified = false;\n    let pad_shift = input.padButtonDown(PAD.RIGHT_TRIGGER) || input.padButtonDown(PAD.LEFT_TRIGGER);\n    let value = input.keyDownEdge(KEYS.PAGEDOWN) +\n      (pad_shift ? input.padButtonDownEdge(PAD.DOWN) : 0);\n    if (value) {\n      // don't overscroll on pageup/pagedown unless we're already at the end\n      this.scroll_pos = min(this.scroll_pos + this.h,\n        this.scroll_pos === this.last_max_value ? Infinity : this.last_max_value);\n      modified = true;\n    }\n    value = input.keyDownEdge(KEYS.PAGEUP) +\n      (pad_shift ? input.padButtonDownEdge(PAD.UP) : 0);\n    if (value) {\n      this.scroll_pos = max(this.scroll_pos - this.h,\n        this.scroll_pos === 0 ? -this.h : 0);\n      modified = true;\n    }\n\n    if (modified) {\n      this.clampScrollPos();\n    }\n  }\n\n  end(h: number): void {\n    //ScrollAreaDisplay *display = OR(this.display, &scroll_area_display_default);\n    assert(h >= 0);\n    h = max(h, 1); // prevent math from going awry on height of 0\n    assert(this.began); // Checking mismatched begin/end\n    this.began = false;\n    this.consumed_click = false;\n    let focused_sub_elem = spotSubEnd();\n    // restore camera and clippers\n    camera2d.pop();\n    clipPop();\n\n    if (focused_sub_elem) {\n      // assumes the focus'd spot was in the same camera transform, if not, need to adapt to use .dom_pos instead\n      this.scrollIntoFocus(focused_sub_elem.y, focused_sub_elem.y + focused_sub_elem.h + 1, this.h);\n    }\n\n    let maxvalue = max(h - this.h+1, 0);\n    if (this.scroll_pos >= maxvalue) {\n      // internal height must have shrunk\n      this.scroll_pos = max(0, maxvalue);\n    }\n\n    let was_at_bottom = this.scroll_pos === this.last_max_value;\n    if (this.auto_scroll && (\n      this.last_frame !== engine.getFrameIndex() - 1 || // was not seen last frame, do a reset\n      this.last_internal_h !== h && was_at_bottom\n    )) {\n      // We were at the bottom, but we are now not, and auto-scroll is enabled\n      // want to be at the bottom, scroll down (effective next frame for the contents,\n      // but this frame for the handle, to prevent flicker)\n      this.overscroll = max(0, this.scroll_pos + this.overscroll - maxvalue);\n      this.scroll_pos = maxvalue;\n    }\n    this.last_internal_h = h;\n    this.last_frame = engine.getFrameIndex();\n\n\n    if (this.overscroll) {\n      let dt = engine.getFrameDt();\n      if (dt >= this.overscroll_delay) {\n        this.overscroll_delay = 0;\n        this.overscroll *= max(1 - dt * 0.008, 0);\n      } else {\n        this.overscroll_delay -= dt;\n      }\n    }\n\n    let {\n      auto_hide,\n      pixel_scale,\n      rollover_color,\n      rollover_color_light,\n    } = this;\n\n    let {\n      scrollbar_top, scrollbar_bottom, scrollbar_trough, scrollbar_handle, scrollbar_handle_grabber\n    } = ui.sprites;\n\n    let bar_w = scrollbar_top.uidata.total_w * pixel_scale;\n    let button_h = min(scrollbar_top.uidata.total_h * pixel_scale, this.h / 3);\n    let button_h_nopad = this.top_pad ? button_h : 0;\n    let bar_x0 = this.x + this.w - bar_w;\n    let handle_h = this.h / h; // How much of the area is visible\n    handle_h = clamp(handle_h, 0, 1);\n    let handle_pos = (this.h > h) ? 0 : (this.scroll_pos / (h - this.h));\n    handle_pos = clamp(handle_pos, 0, 1);\n    let handle_pixel_h = handle_h * (this.h - button_h_nopad * 2);\n    let handle_pixel_min_h = scrollbar_handle.uidata.total_h * pixel_scale;\n    let trough_height = this.h - button_h * 2;\n    handle_pixel_h = max(handle_pixel_h, min(handle_pixel_min_h, trough_height * 0.75));\n    let handle_screenpos = this.y + button_h_nopad + handle_pos * (this.h - button_h_nopad * 2 - handle_pixel_h);\n    // TODO: round handle_screenpos in pixely modes?\n    let top_color = this.color;\n    let bottom_color = this.color;\n    let handle_color = this.color;\n    let trough_color = this.color;\n    let disabled = this.disabled;\n    let auto_hidden = false;\n    if (!this.h) {\n      disabled = true;\n      auto_hidden = true;\n    } else if (handle_h === 1) {\n      auto_hidden = true;\n      if (this.no_disable) {\n        // Just *look* disabled, but still do overscroll, eat mousewheel events\n        trough_color = top_color = bottom_color = handle_color = this.disabled_color;\n      } else {\n        disabled = true;\n      }\n    }\n    this.was_disabled = disabled;\n\n    let gained_focus = false;\n\n    // Handle UI interactions\n    if (disabled) {\n      trough_color = top_color = bottom_color = handle_color = this.disabled_color;\n      this.drag_start = null;\n    } else {\n      // handle scroll wheel\n      let wheel_delta = input.mouseWheel({\n        x: this.x,\n        y: this.y,\n        w: this.w,\n        h: this.h\n      });\n      if (wheel_delta) {\n        this.overscroll_delay = OVERSCROLL_DELAY_WHEEL;\n        this.scroll_pos -= this.rate_scroll_wheel * wheel_delta;\n        if (focused_sub_elem) {\n          spotUnfocus();\n        }\n      }\n\n      // handle drag of handle\n      // before end buttons, as those might be effectively hidden in some UIs\n      let handle_rect = {\n        x: bar_x0,\n        y: handle_screenpos,\n        w: bar_w,\n        h: handle_pixel_h,\n        button: 0,\n        spot_debug_ignore: true,\n      };\n\n      let down = input.mouseDownEdge(handle_rect);\n      if (down) {\n        this.grabbed_pos = (down.pos[1] - handle_screenpos);\n        this.grabbed = true;\n        handle_color = rollover_color_light;\n      }\n      if (this.grabbed) {\n        gained_focus = true;\n      }\n      if (this.grabbed) {\n        // update pos\n        let up = input.mouseUpEdge({ button: 0 });\n        if (up) {\n          temp_pos[1] = up.pos[1];\n          this.consumed_click = true;\n        } else if (!input.mouseDown({ button: 0 })) {\n          // released but someone else ate it, release anyway!\n          this.grabbed = false;\n          this.consumed_click = true;\n        } else {\n          input.mousePos(temp_pos);\n        }\n        if (this.grabbed) {\n          let delta = temp_pos[1] - (this.y + button_h_nopad) - this.grabbed_pos;\n          this.scroll_pos = (h - this.h) * delta / (this.h - button_h_nopad * 2 - handle_pixel_h);\n          handle_color = rollover_color_light;\n        }\n      }\n      if (input.mouseOver(handle_rect)) {\n        if (handle_color !== rollover_color_light) {\n          handle_color = rollover_color;\n        }\n      }\n\n      // handle clicking on end buttons\n      let button_param_up = {\n        x: bar_x0,\n        y: this.y,\n        w: bar_w,\n        h: button_h,\n        button: 0,\n        pad_focusable: false,\n        disabled: this.grabbed,\n        disabled_focusable: false,\n        def: SPOT_DEFAULT_BUTTON,\n      };\n      let button_param_down = {\n        ...button_param_up,\n        y: this.y + this.h - button_h,\n      };\n      let button_spot_ret = spot(button_param_up);\n      while (button_spot_ret.ret) {\n        --button_spot_ret.ret;\n        gained_focus = true;\n        this.scroll_pos -= this.rate_scroll_click;\n        this.consumed_click = true;\n      }\n      if (button_spot_ret.spot_state === SPOT_STATE_DOWN) {\n        top_color = rollover_color_light;\n      } else if (button_spot_ret.spot_state === SPOT_STATE_FOCUSED) {\n        top_color = rollover_color;\n      }\n      button_spot_ret = spot(button_param_down);\n      while (button_spot_ret.ret) {\n        --button_spot_ret.ret;\n        gained_focus = true;\n        this.scroll_pos += this.rate_scroll_click;\n        this.consumed_click = true;\n      }\n      if (button_spot_ret.spot_state === SPOT_STATE_DOWN) {\n        bottom_color = rollover_color_light;\n      } else if (button_spot_ret.spot_state === SPOT_STATE_FOCUSED) {\n        bottom_color = rollover_color;\n      }\n\n      // handle clicking trough if not caught by anything above +/-\n      let bar_param = {\n        key: `bar_${this.id}`,\n        x: bar_x0,\n        y: this.y,\n        w: bar_w,\n        h: this.h,\n        button: 0,\n        sound_rollover: null,\n        pad_focusable: false,\n        def: SPOT_DEFAULT_BUTTON,\n      };\n      let bar_spot_ret = spot(bar_param);\n      while (bar_spot_ret.ret) {\n        --bar_spot_ret.ret;\n        gained_focus = true;\n        this.consumed_click = true;\n        if (bar_spot_ret.pos[1] > handle_screenpos + handle_pixel_h/2) {\n          this.scroll_pos += this.h;\n        } else {\n          this.scroll_pos -= this.h;\n        }\n      }\n\n      // handle dragging the scroll area background\n      let drag = input.drag({ x: this.x, y: this.y, w: this.w - bar_w, h: this.h, button: 0, min_dist: this.min_dist });\n      if (drag) {\n        // Drag should not steal focus\n        // This also fixes an interaction with chat_ui where clicking on the chat background (which causes\n        //   a flicker of a drag) would cause pointer lock to be lost\n        //spotFocusSteal(this);\n        if (this.drag_start === null) {\n          this.drag_start = this.scroll_pos;\n        }\n        this.scroll_pos = this.drag_start - drag.cur_pos[1] + drag.start_pos[1];\n        this.consumed_click = true;\n      } else {\n        this.drag_start = null;\n      }\n      // Also eat drag for bar area, we handle it\n      input.drag({ x: this.x + this.w - bar_w, y: this.y, w: bar_w, h: this.h, button: 0 });\n    }\n\n    if (gained_focus && this.focusable_elem) {\n      this.focusable_elem.focus();\n    }\n\n    this.last_max_value = maxvalue;\n    this.clampScrollPos();\n\n    if (this.background_color) {\n      ui.drawRect(this.x, this.y, this.x + this.w, this.y + this.h, this.z, this.background_color);\n    }\n\n    if (disabled && (auto_hide && auto_hidden || !this.h)) {\n      this.scrollbar_visible = false;\n      return;\n    }\n    this.scrollbar_visible = true;\n\n    scrollbar_top.draw({\n      x: bar_x0, y: this.y, z: this.z + 0.2,\n      w: bar_w, h: button_h,\n      color: top_color,\n    });\n    scrollbar_bottom.draw({\n      x: bar_x0, y: this.y + this.h - button_h, z: this.z + 0.2,\n      w: bar_w, h: button_h,\n      color: bottom_color,\n    });\n    let trough_draw_pad = button_h / 2;\n    let trough_draw_height = trough_height + trough_draw_pad * 2;\n    let trough_v0 = -trough_draw_pad / pixel_scale / scrollbar_trough.uidata.total_h;\n    let trough_v1 = trough_v0 + trough_draw_height / pixel_scale / scrollbar_trough.uidata.total_h;\n    scrollbar_trough.draw({\n      x: bar_x0, y: this.y + trough_draw_pad, z: this.z+0.1,\n      w: bar_w, h: trough_draw_height,\n      uvs: [scrollbar_trough.uvs[0], trough_v0, scrollbar_trough.uvs[2], trough_v1],\n      color: trough_color,\n    });\n\n    ui.drawVBox({\n      x: bar_x0, y: handle_screenpos, z: this.z + 0.3,\n      w: bar_w, h: handle_pixel_h,\n    }, scrollbar_handle, handle_color);\n    let grabber_h = scrollbar_handle_grabber.uidata.total_h * pixel_scale;\n    scrollbar_handle_grabber.draw({\n      x: bar_x0, y: handle_screenpos + (handle_pixel_h - grabber_h) / 2, z: this.z + 0.4,\n      w: bar_w, h: grabber_h,\n      color: handle_color,\n    });\n  }\n\n  // h is height of visible area\n  scrollIntoFocus(miny: number, maxy: number, h: number): void {\n    let old_scroll_pos = this.scroll_pos;\n    let changed = false;\n    miny = max(miny, 0);\n    if (miny < this.scroll_pos) {\n      this.scroll_pos = miny;\n      changed = true;\n    }\n    maxy -= h;\n    if (maxy > this.scroll_pos) {\n      this.scroll_pos = maxy;\n      changed = true;\n    }\n    if (changed) {\n      // Make it smooth/bouncy a bit\n      this.overscroll = old_scroll_pos - this.scroll_pos;\n    }\n  }\n\n  scrollToEnd(): void {\n    this.scroll_pos = this.last_max_value;\n  }\n\n  resetScroll(): void {\n    this.scroll_pos = 0;\n    this.overscroll = 0;\n  }\n}\n\nexport function scrollAreaCreate(params?: ScrollAreaOpts): ScrollArea {\n  return new ScrollAreaInternal(params);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint complexity:off */\n\n// eslint-disable-next-line no-use-before-define\nexports.create = selectionBoxCreate;\n\nimport * as assert from 'assert';\nconst { max, round, sin } = Math;\nimport { clamp, cloneShallow, easeIn, merge } from 'glov/common/util.js';\nimport { v4copy, vec4 } from 'glov/common/vmath.js';\nimport * as camera2d from './camera2d.js';\nimport * as glov_engine from './engine.js';\nimport * as glov_font from './font.js';\nimport {\n  KEYS,\n  PAD,\n  drag,\n  keyDownEdge,\n  mouseButtonHadUpEdge,\n  padButtonDown,\n  padButtonDownEdge,\n} from './input.js';\nimport { link } from './link.js';\nimport { scrollAreaCreate } from './scroll_area.js';\nimport {\n  SPOT_DEFAULT_BUTTON,\n  SPOT_NAV_DOWN,\n  SPOT_NAV_LEFT,\n  SPOT_NAV_RIGHT,\n  SPOT_NAV_UP,\n  SPOT_STATE_DISABLED,\n  SPOT_STATE_DOWN,\n  SPOT_STATE_FOCUSED,\n  SPOT_STATE_REGULAR,\n  spot,\n  spotFocusSteal,\n  spotPadMode,\n  spotSubBegin,\n  spotSubEnd,\n  spotSubPop,\n  spotSubPush,\n} from './spot.js';\nimport { clipPause, clipResume, clipped } from './sprites.js';\nimport { playUISound } from './ui.js';\nimport * as glov_ui from './ui.js';\n\nlet glov_markup = null; // Not ported\n\nlet last_key_id = 0;\n\nlet font;\n\nconst selbox_font_style_default = glov_font.style(null, {\n  color: 0xDFDFDFff,\n});\n\nconst selbox_font_style_selected = glov_font.style(null, {\n  color: 0xFFFFFFff,\n});\n\nconst selbox_font_style_down = glov_font.style(null, {\n  color: 0x000000ff,\n});\n\nconst selbox_font_style_disabled = glov_font.style(null, {\n  color: 0x808080ff,\n});\n\nconst pad = 8;\n\nconst color_white = vec4(1, 1, 1, 1);\n\nlet color_temp_fade = vec4(1,1,1,1);\nexport function selboxDefaultDrawItemBackground({\n  item_idx, item,\n  x, y, z,\n  w, h,\n  image_set, color,\n  image_set_extra, image_set_extra_alpha,\n}) {\n  glov_ui.drawHBox({ x, y, z, w, h },\n    image_set, color);\n  if (image_set_extra && image_set_extra_alpha) {\n    v4copy(color_temp_fade, color);\n    color_temp_fade[3] *= easeIn(image_set_extra_alpha, 2);\n    glov_ui.drawHBox({ x, y, z: z + 0.001, w, h },\n      image_set_extra, color_temp_fade);\n  }\n}\n\nexport function selboxDefaultDrawItemText({\n  item_idx, item,\n  x, y, z,\n  w, h,\n  display,\n  font_height,\n  style,\n}) {\n  let text_z = z + 1;\n  // spriteListClipperPush(x, y + yoffs, eff_width - pad, h);\n  let did_tab = false;\n  if (display.tab_stop) {\n    let str = item.name;\n    let tab_idx = str.indexOf('\\t');\n    if (tab_idx !== -1) {\n      did_tab = true;\n      let pre = str.slice(0, tab_idx);\n      let post = str.slice(tab_idx + 1);\n      let x1 = x + display.xpad;\n      let x2 = x + display.xpad + display.tab_stop + pad;\n      let w1 = display.tab_stop;\n      let w2 = w - display.tab_stop - display.xpad * 2 - pad;\n      if (display.use_markup) {\n        let md = {};\n        md.align = glov_font.ALIGN.HFIT;\n        md.x_size = md.y_size = font_height;\n        md.w = w1;\n        md.h = 1;\n        md.style = style;\n        glov_markup.print(md, x1, y, text_z, pre);\n        md.w = w2;\n        glov_markup.print(md, x2, y, text_z, post);\n      } else {\n        font.drawSizedAligned(style, x1, y, text_z, font_height,\n          glov_font.ALIGN.HFIT | glov_font.ALIGN.VCENTER,\n          w1, h, pre);\n        font.drawSizedAligned(style, x2, y, text_z, font_height,\n          glov_font.ALIGN.HFIT | glov_font.ALIGN.VCENTER,\n          w2, h, post);\n      }\n    }\n  }\n  if (!did_tab) {\n    let md = {};\n    md.align = (item.centered || display.centered ? glov_font.ALIGN.HCENTERFIT : glov_font.ALIGN.HFIT) |\n      glov_font.ALIGN.VCENTER;\n    md.x_size = md.y_size = font_height;\n    md.w = w - display.xpad * 2;\n    md.h = h;\n    md.style = style;\n    let xx = x + display.xpad;\n    if (display.use_markup) {\n      glov_markup.print(md, xx, y, text_z, item.name);\n    } else {\n      font.drawSizedAligned(md.style, xx, y, text_z, md.x_size,\n        md.align, md.w, md.h, item.name);\n    }\n  }\n  // spriteListClipperPop();\n  // if (display.selection_highlight && this.selected === i && show_selection) {\n  //   let grow = 0.2 * (1 - bounce_amt);\n  //   display.selection_highlight.DrawStretched(\n  //     x - grow * w, y - grow * h, text_z + 1.5,\n  //     w * (1 + 2 * grow), h * (1 + 2 * grow), 0, 0xFF);\n  // }\n}\n\nexport function selboxDefaultDrawItem(param) {\n  selboxDefaultDrawItemBackground(param);\n  selboxDefaultDrawItemText(param);\n}\n\n\nexport const default_display = {\n  style_default: selbox_font_style_default,\n  style_selected: selbox_font_style_selected,\n  style_disabled: selbox_font_style_disabled,\n  style_down: selbox_font_style_down,\n  color_default: color_white,\n  color_selected: color_white,\n  color_disabled: color_white,\n  color_down: color_white,\n  // old: no_buttons: false, instead pass `nop` to draw_cb\n  draw_item_cb: selboxDefaultDrawItem,\n  centered: false,\n  bounce: true,\n  tab_stop: 0,\n  xpad: 8,\n  selection_fade: Infinity, // alpha per millisecond\n  // selection_highlight: null, // TODO: custom / better selection highlight for menus\n  use_markup: false, // always false, Markup not ported\n};\n\n\nconst color_gray80 = vec4(0.500, 0.500, 0.500, 1.000);\nconst color_grayD0 = vec4(0.816, 0.816, 0.816, 1.000);\nconst COLORS = {\n  [SPOT_STATE_REGULAR]: color_white,\n  [SPOT_STATE_DOWN]: color_grayD0,\n  [SPOT_STATE_FOCUSED]: color_grayD0,\n  [SPOT_STATE_DISABLED]: color_gray80,\n};\n\nconst SELBOX_BOUNCE_TIME = 80;\n\n// Used by GlovSimpleMenu and GlovSelectionBox and GlovDropDown\nexport class GlovMenuItem {\n  constructor(params) {\n    params = params || {};\n    if (params instanceof GlovMenuItem) {\n      for (let field in params) {\n        this[field] = params[field];\n      }\n      return;\n    }\n    if (typeof params === 'string') {\n      params = { name: params };\n    }\n    this.name = params.name || 'NO_NAME'; // name to display\n    this.state = params.state || null; // state to set upon selection\n    this.cb = params.cb || null; // callback to call upon selection\n    // TODO - cb function on value change?\n    this.value = params.value === undefined ? null : params.value; // can be number or string\n    this.value_min = params.value_min || 0;\n    this.value_max = params.value_max || 0;\n    this.value_inc = params.value_inc || 0;\n    this.href = params.href || null; // for links\n    this.tag = params.tag || null; // for isSelected(tag)\n    this.style = params.style || null;\n    // was bitmask\n    this.exit = Boolean(params.exit);\n    this.prompt_int = Boolean(params.prompt_int);\n    this.prompt_string = Boolean(params.prompt_string);\n    this.no_sound = Boolean(params.no_sound);\n    this.slider = Boolean(params.slider);\n    this.no_controller_exit = Boolean(params.no_controller_exit);\n    this.plus_minus = Boolean(params.plus_minus);\n    this.disabled = Boolean(params.disabled);\n    this.centered = Boolean(params.centered);\n    this.auto_focus = Boolean(params.auto_focus);\n    this.selection_alpha = 0;\n  }\n}\n\n\nclass SelectionBoxBase {\n  constructor(params) {\n    assert(!params.auto_unfocus, 'Old parameter: auto_unfocus');\n    // Options (and defaults)\n    this.key = `dd${++last_key_id}`;\n    this.x = 0;\n    this.y = 0;\n    this.z = Z.UI;\n    this.width = glov_ui.button_width;\n    this.items = [];\n    this.disabled = false;\n    this.display = cloneShallow(default_display);\n    this.scroll_height = 0;\n    this.font_height = glov_ui.font_height;\n    this.entry_height = glov_ui.button_height;\n    this.auto_reset = true;\n    this.reset_selection = false;\n    this.initial_selection = 0;\n    this.show_as_focused = -1;\n    this.applyParams(params);\n\n    // Run-time inter-frame state\n    this.selected = 0;\n    this.was_clicked = false;\n    this.was_right_clicked = false;\n    this.is_focused = false;\n    this.expected_frame_index = 0;\n    // Run-time intra-frame state\n    this.ctx = {};\n    if (this.is_dropdown || this.scroll_height) {\n      this.sa = scrollAreaCreate({\n        //focusable_elem: this,\n        //background_color: null,\n      });\n    }\n  }\n\n  applyParams(params) {\n    if (!params) {\n      return;\n    }\n    for (let f in params) {\n      if (f === 'items') {\n        this.items = params.items.map((item) => new GlovMenuItem(item));\n      } else if (f === 'display') {\n        merge(this.display, params[f]);\n      } else {\n        this[f] = params[f];\n      }\n    }\n  }\n\n  isSelected(tag_or_index) {\n    if (typeof tag_or_index === 'number') {\n      return this.selected === tag_or_index;\n    }\n    return this.items[this.selected].tag === tag_or_index;\n  }\n\n  getSelected() {\n    return this.items[this.selected];\n  }\n\n  handleInitialSelection() {\n    let { auto_reset } = this;\n    if (this.reset_selection || auto_reset && this.expected_frame_index !== glov_engine.getFrameIndex()) {\n      this.reset_selection = false;\n      // Reset\n      if (this.items[this.initial_selection] && !this.items[this.initial_selection].disabled) {\n        this.selected = this.initial_selection;\n      } else {\n        // Selection out of range or disabled, select first non-disabled entry\n        for (let ii = 0; ii < this.items.length; ++ii) {\n          if (!this.items[ii].disabled) {\n            this.selected = ii;\n            break;\n          }\n        }\n      }\n    }\n  }\n\n  runPrep(y) {\n    let { ctx, entry_height, is_dropdown } = this;\n    this.was_clicked = false;\n    this.was_right_clicked = false;\n\n    let num_non_disabled_selections = 0;\n    let first_non_disabled_selection = -1;\n    let last_non_disabled_selection = -1;\n    for (let ii = 0; ii < this.items.length; ++ii) {\n      let item = this.items[ii];\n      if (!item.disabled) {\n        if (first_non_disabled_selection === -1) {\n          first_non_disabled_selection = ii;\n        }\n        num_non_disabled_selections++;\n        last_non_disabled_selection = ii;\n      }\n    }\n    // This is OK, can have an empty selection box: assert(num_non_disabled_selections);\n\n    let scroll_height = this.scroll_height;\n    if (!scroll_height && is_dropdown) {\n      scroll_height = camera2d.y1() - (y + entry_height);\n    }\n\n    ctx.first_non_disabled_selection = first_non_disabled_selection;\n    ctx.last_non_disabled_selection = last_non_disabled_selection;\n    ctx.num_non_disabled_selections = num_non_disabled_selections;\n    ctx.list_visible = !is_dropdown || this.dropdown_visible;\n    ctx.scroll_height = scroll_height;\n  }\n\n  selectWalk(idx, delta) {\n    let { ctx, selected: old_sel, key } = this;\n    let {\n      num_non_disabled_selections,\n      first_non_disabled_selection,\n      last_non_disabled_selection,\n      list_visible,\n    } = ctx;\n    if (!num_non_disabled_selections) {\n      this.selected = 0;\n    } else if (idx >= last_non_disabled_selection) {\n      this.selected = last_non_disabled_selection;\n    } else if (idx <= first_non_disabled_selection) {\n      this.selected = first_non_disabled_selection;\n    } else {\n      while (this.items[idx].disabled) {\n        idx += delta;\n      }\n      this.selected = idx;\n    }\n    if (this.selected !== old_sel) {\n      if (list_visible) {\n        // Selection changed (via disabled states changing, or pad/keyboard operation,\n        // Show the new focus\n        spotFocusSteal({ key: `${key}_${this.selected}` });\n      } else {\n        this.was_clicked = true; // trigger value change immediately\n      }\n    }\n  }\n  // Select `idx`, or the next non-disabled selection after it\n  selectForward(idx) {\n    this.selectWalk(idx, 1);\n  }\n\n  // Select `idx` or the next non-disabled selection before it\n  selectBackward(idx) {\n    this.selectWalk(idx, -1);\n  }\n\n  doPadMovement() {\n    let { ctx, entry_height } = this;\n    let { list_visible, scroll_height } = ctx;\n    let page_size = round(max(scroll_height - 1, 0) / entry_height);\n    if (!list_visible) {\n      // since arrows navigate to other elements, page up/down scroll the selection by one\n      page_size = 1;\n    }\n    if (page_size) {\n      let pad_shift = padButtonDown(PAD.RIGHT_TRIGGER) || padButtonDown(PAD.LEFT_TRIGGER);\n      let value = keyDownEdge(KEYS.PAGEDOWN) +\n        (pad_shift ? padButtonDownEdge(PAD.DOWN) : 0);\n      if (value) {\n        playUISound('rollover');\n        this.selectForward(this.selected + page_size * value);\n      }\n      value = keyDownEdge(KEYS.PAGEUP) +\n        (pad_shift ? padButtonDownEdge(PAD.UP) : 0);\n      if (value) {\n        playUISound('rollover');\n        this.selectBackward(this.selected - page_size * value);\n      }\n    }\n    if (keyDownEdge(KEYS.HOME)) {\n      playUISound('rollover');\n      this.selectForward(0);\n    }\n    if (keyDownEdge(KEYS.END)) {\n      playUISound('rollover');\n      this.selectBackward(Infinity);\n    }\n  }\n\n  doList(x, y, z, do_scroll, eff_selection) {\n    let {\n      ctx,\n      disabled,\n      display,\n      entry_height,\n      font_height,\n      key,\n      selected: old_sel,\n      show_as_focused,\n      width,\n    } = this;\n    let { scroll_height } = ctx;\n    let eff_width = width;\n    const y_save = y;\n    if (do_scroll) {\n      this.sa.begin({\n        x, y, z,\n        w: width,\n        h: scroll_height,\n      });\n      y = 0;\n      x = 0;\n      eff_width = width - this.sa.barWidth();\n    } else if (this.is_dropdown) {\n      // Need a spot sub here so that navigation within elements does not target\n      //   other elements that happen to be behind the dropdown\n      spotSubBegin({\n        key,\n        x, y, z,\n        w: width,\n        h: scroll_height || entry_height,\n      });\n    }\n    let dt = glov_engine.getFrameDt();\n    let any_focused = false;\n    let { first_non_disabled_selection, last_non_disabled_selection } = ctx;\n    for (let ii = 0; ii < this.items.length; ii++) {\n      let item = this.items[ii];\n      let entry_disabled = item.disabled;\n      let image_set = null;\n      let image_set_extra = null;\n      let image_set_extra_alpha = 0;\n      if (item.href) {\n        link({\n          x, y, w: width, h: entry_height,\n          url: item.href,\n        });\n      }\n      let entry_spot_rect = {\n        def: SPOT_DEFAULT_BUTTON,\n        key: `${key}_${ii}`,\n        disabled: disabled || entry_disabled,\n        disabled_focusable: false,\n        x, y, w: width, h: entry_height,\n        custom_nav: {\n          [SPOT_NAV_RIGHT]: null,\n          [SPOT_NAV_LEFT]: null,\n        },\n        auto_focus: item.auto_focus,\n      };\n      if (ii === first_non_disabled_selection && this.nav_loop) {\n        entry_spot_rect.custom_nav[SPOT_NAV_UP] = `${key}_${last_non_disabled_selection}`;\n      }\n      if (ii === last_non_disabled_selection && this.nav_loop) {\n        entry_spot_rect.custom_nav[SPOT_NAV_DOWN] = `${key}_${first_non_disabled_selection}`;\n      }\n      let entry_spot_ret = spot(entry_spot_rect);\n      if (ii === show_as_focused) {\n        entry_spot_ret.focused = true;\n        entry_spot_ret.spot_state = SPOT_STATE_FOCUSED;\n      }\n      let focused_or_down = entry_spot_ret.focused || entry_spot_ret.spot_state === SPOT_STATE_DOWN;\n      any_focused = any_focused || focused_or_down;\n      if (item.slider || item.plus_minus) {\n        // Allow left to negatively select\n        if (entry_spot_ret.nav === SPOT_NAV_LEFT) {\n          entry_spot_ret.nav = SPOT_NAV_RIGHT;\n          entry_spot_ret.button = 2; // hack: right click is also treated as negative-select\n        }\n      }\n      if (entry_spot_ret.nav === SPOT_NAV_RIGHT) {\n        // select\n        playUISound('button_click');\n        entry_spot_ret.spot_state = SPOT_STATE_DOWN;\n        entry_spot_ret.ret = true;\n      }\n      if (entry_spot_ret.ret) {\n        // select\n        this.was_clicked = true;\n        this.was_right_clicked = entry_spot_ret.button === 2;\n        this.selected = ii;\n        this.onListSelect();\n      }\n\n      let bounce = false;\n      if (focused_or_down) {\n        this.selected = ii;\n        if (!this.is_dropdown && display.bounce) {\n          if (this.selected !== old_sel) {\n            bounce = true;\n            this.bounce_time = SELBOX_BOUNCE_TIME;\n          } else if (dt >= this.bounce_time) {\n            this.bounce_time = 0;\n          } else {\n            bounce = true;\n            this.bounce_time -= dt;\n          }\n        }\n      }\n      if (entry_spot_ret.nav === SPOT_NAV_LEFT) {\n        // cancel\n        this.selected = eff_selection;\n        this.onListSelect();\n      }\n\n      let color;\n      let style;\n      if (entry_spot_ret.spot_state === SPOT_STATE_DOWN || entry_spot_ret.spot_state === SPOT_STATE_FOCUSED) {\n        style = display.style_selected || selbox_font_style_selected;\n        color = display.color_selected || default_display.color_selected;\n        item.selection_alpha = clamp(item.selection_alpha + dt * display.selection_fade, 0, 1);\n        if (item.selection_alpha === 1) {\n          image_set = glov_ui.sprites.menu_selected;\n        } else {\n          image_set = glov_ui.sprites.menu_entry;\n          image_set_extra = glov_ui.sprites.menu_selected;\n          image_set_extra_alpha = item.selection_alpha;\n        }\n        if (entry_spot_ret.spot_state === SPOT_STATE_DOWN) {\n          if (glov_ui.sprites.menu_down) {\n            image_set = glov_ui.sprites.menu_down;\n            if (display.style_down) {\n              style = display.style_down;\n              color = display.color_down || default_display.color_down;\n            }\n          } else {\n            style = display.style_down || selbox_font_style_down;\n            color = display.color_down || default_display.color_down;\n          }\n        }\n      } else {\n        item.selection_alpha = clamp(item.selection_alpha - dt * display.selection_fade, 0, 1);\n        if (item.selection_alpha !== 1) {\n          image_set_extra = glov_ui.sprites.menu_selected;\n          image_set_extra_alpha = item.selection_alpha;\n        }\n        if (entry_spot_ret.spot_state === SPOT_STATE_DISABLED) {\n          style = display.style_disabled || selbox_font_style_disabled;\n          color = display.color_disabled || default_display.color_disabled;\n          image_set = glov_ui.sprites.menu_entry;\n        } else {\n          style = item.style || display.style_default || selbox_font_style_default;\n          color = display.color_default || default_display.color_default;\n          image_set = glov_ui.sprites.menu_entry;\n        }\n      }\n\n      let yoffs = 0;\n      if (bounce) {\n        let bounce_amt = sin(this.bounce_time * 20 / SELBOX_BOUNCE_TIME / 10);\n        yoffs = -4 * bounce_amt * entry_height / 32;\n      }\n\n      display.draw_item_cb({\n        item_idx: ii, item,\n        x, y: y + yoffs, z: z + 1,\n        w: eff_width, h: entry_height,\n        image_set, color,\n        image_set_extra, image_set_extra_alpha,\n        font_height,\n        display,\n        style,\n      });\n\n      if (entry_spot_ret.ret && item.href) {\n        window.location.href = item.href;\n      }\n      y += entry_height;\n    }\n    ctx.scroll_area_consumed_click = false;\n    if (do_scroll) {\n      this.sa.end(y);\n      ctx.scroll_area_consumed_click = this.sa.consumedClick();\n      y = y_save + scroll_height;\n    } else if (this.is_dropdown) {\n      // Consume drag events (desired for drop-down menu temporarily overlapping a slider)\n      drag({\n        x, y: y_save,\n        w: width,\n        h: y - y_save,\n      });\n      spotSubEnd();\n    }\n    ctx.any_focused = any_focused;\n    return y;\n  }\n}\n\nclass GlovSelectionBox extends SelectionBoxBase {\n  constructor(params) {\n    assert(!params.is_dropdown, 'Use dropDownCreate() instead');\n    super(params);\n\n    // Run-time state\n    this.bounce_time = 0;\n  }\n\n  getHeight() {\n    let { entry_height } = this;\n    // if (this.is_dropdown) {\n    //   return entry_height + 2;\n    // }\n    let list_height = this.items.length * entry_height;\n    let do_scroll = this.scroll_height && this.items.length * entry_height > this.scroll_height;\n    if (do_scroll) {\n      list_height = this.scroll_height;\n    }\n    list_height += 2;\n    return list_height + 3;\n  }\n\n  focus() {\n    assert(false, 'deprecated?');\n    // focus the currently select element?  top element?\n    let { key } = this;\n    spotFocusSteal({ key: `${key}_0` });\n  }\n\n  onListSelect() {\n    // nothing\n  }\n\n  run(params) {\n    this.applyParams(params);\n    let { x, y, z, entry_height, ctx } = this;\n\n    this.handleInitialSelection();\n\n    let y0 = y;\n    let yret;\n\n    this.runPrep(y);\n\n    let { scroll_height } = ctx;\n\n    let do_scroll = scroll_height && this.items.length * entry_height > scroll_height;\n\n    y = this.doList(x, y, z, do_scroll, this.selected);\n\n    if (ctx.any_focused) {\n      this.doPadMovement();\n    }\n\n    this.expected_frame_index = glov_engine.getFrameIndex() + 1;\n    x = 10;\n    y += 5;\n    yret = y;\n    assert.equal(yret - y0, this.getHeight());\n    return yret - y0;\n  }\n}\nGlovSelectionBox.prototype.is_dropdown = false;\nGlovSelectionBox.prototype.nav_loop = false;\n\nclass GlovDropDown extends SelectionBoxBase {\n  constructor(params) {\n    assert(!params.is_dropdown, 'Old parameter: is_dropdown');\n    super(params);\n\n    // Run-time state\n    this.dropdown_visible = false;\n    this.last_selected = undefined;\n  }\n\n  focus() {\n    assert(false, 'deprecated?');\n    spotFocusSteal(this);\n    this.is_focused = true;\n  }\n\n  onListSelect() {\n    this.dropdown_visible = false;\n    spotFocusSteal(this);\n  }\n\n  run(params) {\n    this.applyParams(params);\n    let { x, y, z, width, font_height, entry_height, disabled, key, display, ctx } = this;\n\n    this.handleInitialSelection();\n\n    if (this.last_selected !== undefined &&\n      (this.last_selected >= this.items.length || this.items[this.last_selected].disabled)\n    ) {\n      this.last_selected = undefined;\n    }\n\n    let y0 = y;\n    let yret;\n\n    this.runPrep(y);\n\n    let { first_non_disabled_selection, list_visible, scroll_height } = ctx;\n\n    let root_spot_rect = {\n      key,\n      disabled,\n      x, y,\n      z: z + 2 - 0.1, // z used for checkHooks\n      w: width, h: entry_height,\n      def: SPOT_DEFAULT_BUTTON,\n      custom_nav: {\n        // left/right toggle the dropdown visibility - maybe make this customizable?\n        [SPOT_NAV_RIGHT]: null,\n      },\n    };\n    ctx.root_spot_rect = root_spot_rect;\n    if (this.dropdown_visible) {\n      root_spot_rect.custom_nav[SPOT_NAV_LEFT] = null;\n      root_spot_rect.custom_nav[SPOT_NAV_DOWN] = `${key}_${first_non_disabled_selection}`;\n    }\n    let root_spot_ret = spot(root_spot_rect);\n    this.is_focused = root_spot_ret.focused;\n\n    if (root_spot_ret.kb_focused || list_visible) {\n      this.doPadMovement();\n    }\n\n    // Ensure the current selection is not disabled\n    this.selectForward(this.selected);\n\n    let eff_selection = this.dropdown_visible && this.last_selected !== undefined ?\n      this.last_selected :\n      this.selected;\n\n    if (this.dropdown_visible && (\n      keyDownEdge(KEYS.ESC) || padButtonDownEdge(PAD.B)\n    )) {\n      this.selected = eff_selection;\n      this.onListSelect();\n    }\n\n    // display header, respond to clicks\n    if (root_spot_ret.ret || root_spot_ret.nav) {\n      if (root_spot_ret.nav) {\n        playUISound('button_click');\n      }\n      if (this.dropdown_visible) {\n        this.selected = eff_selection;\n        this.dropdown_visible = false;\n      } else {\n        this.dropdown_visible = true;\n        this.last_selected = this.selected;\n        if (spotPadMode()) {\n          spotFocusSteal({ key: `${key}_${this.selected}` });\n        }\n      }\n    }\n    glov_ui.drawHBox({\n      x, y, z: z + 1,\n      w: width, h: entry_height\n    }, glov_ui.sprites.menu_header, COLORS[root_spot_ret.spot_state]);\n    let align = (display.centered ? glov_font.ALIGN.HCENTER : glov_font.ALIGN.HLEFT) |\n      glov_font.ALIGN.HFIT | glov_font.ALIGN.VCENTER;\n    font.drawSizedAligned(root_spot_ret.focused ? glov_ui.font_style_focused : glov_ui.font_style_normal,\n      x + display.xpad, y, z + 2,\n      font_height, align,\n      width - display.xpad - glov_ui.sprites.menu_header.uidata.wh[2] * entry_height, entry_height,\n      this.items[eff_selection].name);\n    y += entry_height;\n    yret = y + 2;\n\n    if (this.dropdown_visible) {\n      z += 1000; // drop-down part should be above everything except tooltips\n      let clip_pause = clipped();\n      if (clip_pause) {\n        clipPause();\n      }\n      spotSubPush();\n      let do_scroll = scroll_height && this.items.length * entry_height > scroll_height;\n      if (!do_scroll && y + this.items.length * entry_height >= camera2d.y1()) {\n        y = camera2d.y1() - this.items.length * entry_height;\n      }\n\n      this.doList(x, y, z, do_scroll, eff_selection);\n\n      if (this.was_clicked) {\n        this.dropdown_visible = false;\n      }\n      spotSubPop();\n      if (clip_pause) {\n        clipResume();\n      }\n\n      let { any_focused, scroll_area_consumed_click } = ctx;\n      if (root_spot_ret.ret || this.was_clicked) {\n        any_focused = true;\n      }\n      this.is_focused = this.is_focused || any_focused;\n      if (!any_focused) {\n        // Nothing focused?  Don't preview any current selection.\n        this.selected = eff_selection;\n      }\n      if (!any_focused && !root_spot_ret.focused && !scroll_area_consumed_click) {\n        // Not focused, and not toggled this frame\n        if (\n          // Clicked anywhere else?\n          mouseButtonHadUpEdge() ||\n          // In pad mode\n          spotPadMode()\n        ) {\n          // Cancel and close dropdown\n          this.selected = eff_selection;\n          this.dropdown_visible = false;\n        }\n      }\n    }\n\n\n    this.expected_frame_index = glov_engine.getFrameIndex() + 1;\n    return yret - y0;\n  }\n}\n\nGlovDropDown.prototype.is_dropdown = true;\nGlovDropDown.prototype.nav_loop = true;\n\n\nexport function selectionBoxCreate(params) {\n  if (!font) {\n    font = glov_ui.font;\n  }\n  return new GlovSelectionBox(params);\n}\n\nexport function dropDownCreate(params) {\n  if (!font) {\n    font = glov_ui.font;\n  }\n  return new GlovDropDown(params);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nlet modified = {};\nexports.true = true; // for perf.js\n\nconst assert = require('assert');\nconst { titleCase } = require('glov/common/util.js');\nconst { cmd_parse } = require('./cmds.js');\nconst engine = require('./engine.js');\n\nlet change_cbs = {};\n\nexport function get(key) {\n  return exports[key];\n}\n\nexport function set(key, value) {\n  if (exports[key] !== value) {\n    cmd_parse.handle(null, `${key} ${value}`, null); // uses default cmd_parse handler\n  }\n}\n\nexport function setAsync(key, value) {\n  engine.postTick({ fn: set.bind(null, key, value) });\n}\n\nexport function runTimeDefault(key, new_default) {\n  assert(!change_cbs[key]); // If so, we set `default_clear_on` below, and may have discarded a desired setting.\n  // Set a default value that cannot be determined at load time\n  // Only set if this has never been modified\n  if (!modified[key]) {\n    // Does *not* call cmd_parse.set - will not write to storage, still at \"default\" setting\n    exports[key] = new_default;\n  }\n}\n\nlet settings_stack = null;\nexport function push(pairs) {\n  assert(!settings_stack);\n  settings_stack = {};\n  for (let key in pairs) {\n    settings_stack[key] = exports[key];\n    exports[key] = pairs[key];\n    let cb = change_cbs[key];\n    if (cb) {\n      cb(false);\n    }\n  }\n}\n\nexport function pop() {\n  assert(settings_stack);\n  for (let key in settings_stack) {\n    exports[key] = settings_stack[key];\n    let cb = change_cbs[key];\n    if (cb) {\n      cb(false);\n    }\n  }\n  settings_stack = null;\n}\n\nexport function register(defs) {\n  Object.keys(defs).forEach(function (key) {\n    let def = defs[key];\n    exports[key] = def.default_value;\n    if (def.on_change) {\n      change_cbs[key] = def.on_change;\n    }\n    cmd_parse.registerValue(key, {\n      type: def.type,\n      label: def.label || titleCase(key.replace(/_/g, ' ')),\n      range: def.range,\n      get: () => exports[key],\n      set: (v) => {\n        modified[key] = true;\n        exports[key] = v;\n      },\n      store: def.store !== false,\n      ver: def.ver,\n      help: def.help,\n      usage: def.usage,\n      prefix_usage_with_help: def.prefix_usage_with_help,\n      on_change: def.on_change,\n      access_run: def.access_run,\n      access_show: def.access_show,\n      default_value: def.default_value,\n    });\n  });\n}\n\nregister({\n  max_fps: {\n    label: 'Maximum frame rate (FPS)',\n    prefix_usage_with_help: true,\n    usage:\n      'Display current maximum: /max_fps\\n' +\n      'Disable maximum FPS limit: /max_fps 0 (highly recommended)\\n' +\n      'Set maximum FPS limit: /max_fps 30\\n' +\n      'Default: /max_fps 0',\n    default_value: 0,\n    type: cmd_parse.TYPE_FLOAT,\n    ver: 1,\n  },\n  render_scale: {\n    label: 'Render Scale (3D)',\n    default_value: 1,\n    type: cmd_parse.TYPE_FLOAT,\n    range: [0.1,1],\n  },\n  render_scale_mode: {\n    label: 'Render Scale Mode',\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,2],\n  },\n  render_scale_all: {\n    label: 'Render Scale (All)',\n    default_value: 1,\n    type: cmd_parse.TYPE_FLOAT,\n    range: [0.3333,4],\n  },\n  render_scale_clear: {\n    label: 'Render Scale Full Clear',\n    default_value: 1,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n  },\n  fov: {\n    default_value: 60,\n    type: cmd_parse.TYPE_FLOAT,\n    range: [1,100],\n  },\n  double_click_time: {\n    default_value: 500,\n    type: cmd_parse.TYPE_INT,\n    range: [0,2500],\n  },\n});\n","/* eslint-disable import/order */\nconst camera2d = require('./camera2d.js');\nconst { cmd_parse } = require('./cmds.js');\nconst engine = require('./engine.js');\nconst { fetch } = require('./fetch.js');\nconst glov_font = require('./font.js');\nconst input = require('glov/client/input.js');\nconst { min } = Math;\nconst { scrollAreaCreate } = require('./scroll_area.js');\nconst { shadersGetDebug } = require('./shaders.js');\nconst settings = require('./settings.js');\nconst ui = require('./ui.js');\nconst { errorString } = require('glov/common/util.js');\nconst { vec4 } = require('glov/common/vmath.js');\n\nZ.SHADER_DEBUG = Z.SHADER_DEBUG || 900;\n\nconst SHADER_STATS_SERVER = 'http://localhost:3000/api/shaderstats';\n\nlet shader_stats_cache = {};\nfunction getShaderStats(text, stage, peek) {\n  if (shader_stats_cache[text]) {\n    return shader_stats_cache[text].data;\n  }\n  if (peek) {\n    return null;\n  }\n  let cache = shader_stats_cache[text] = {\n    data: null,\n  };\n  fetch({\n    url: `${SHADER_STATS_SERVER}?stage=${stage}&text=${encodeURIComponent(text)}`,\n    response_type: 'json',\n  }, (err, obj) => {\n    if (err) {\n      cache.data = { err: `Fetch error: ${errorString(err)}` };\n    } else {\n      cache.data = obj;\n    }\n  });\n  return cache.data;\n}\n\nconst PAD = 4;\nconst style_title = glov_font.styleColored(null, 0x8090FFff);\nconst style = glov_font.styleColored(null, 0x222222ff);\nconst style_error = glov_font.styleColored(null, 0xDD2222ff);\nconst color_line = vec4(0.4,0.4,0.4,1);\nconst color_panel = vec4(1,1,1,1);\nconst color_invalid = vec4(0.8,0,0,1);\nconst color_selected = vec4(0.4, 0.6, 1, 1);\nlet scroll_area;\nlet scroll_area_source;\nlet selected_shader;\nfunction shaderDebugUITick() {\n  const PANEL_PAD = ui.tooltip_pad;\n  let x0 = camera2d.x0() + PANEL_PAD;\n  const y0 = camera2d.y0() + PANEL_PAD;\n  let z = Z.SHADER_DEBUG;\n  const { font, title_font, font_height } = ui;\n  let w = font_height * 20;\n  let x = x0;\n  let y = y0;\n\n  let shaders = shadersGetDebug();\n\n  title_font.drawSizedAligned(style_title, x, y, z, font_height, font.ALIGN.HCENTERFIT, w, 0,\n    `Shaders (${shaders.length})`);\n\n  if (!scroll_area) {\n    scroll_area = scrollAreaCreate({\n      z,\n      background_color: null,\n      auto_hide: true,\n    });\n    scroll_area_source = scrollAreaCreate({\n      z,\n      background_color: null,\n      auto_hide: true,\n    });\n  }\n  let sub_w = w - PAD - scroll_area.barWidth();\n  let score_w = sub_w * 0.3;\n  let subscore_w = score_w/2;\n  let button_w = sub_w - score_w - PAD;\n\n  font.draw({\n    x: x + button_w + PAD, y: y + ui.font_height * 0.5, z,\n    w: subscore_w - 1,\n    color: 0x404040ff,\n    size: ui.font_height * 0.5,\n    text: 'Ops',\n    align: font.ALIGN.HCENTERFIT,\n  });\n  font.draw({\n    x: x + button_w + PAD + subscore_w + 1, y: y + ui.font_height * 0.5, z,\n    w: subscore_w - 1,\n    color: 0x404040ff,\n    size: ui.font_height * 0.5,\n    text: 'Bytes',\n    align: font.ALIGN.HCENTERFIT,\n  });\n\n  y += font_height + 1;\n  ui.drawLine(x0 + w * 0.3, y, x0 + w * 0.7, y, z, 0.5, true, color_line);\n  y += PAD;\n\n  const max_h = camera2d.y1() - PAD - y;\n  let scroll_y_start = y;\n  scroll_area.begin({\n    x, y, w, h: max_h,\n  });\n  x = 0;\n  y = 0;\n  z = Z.UI;\n\n\n  for (let ii = 0; ii < shaders.length; ++ii) {\n    let shader = shaders[ii];\n    let filename = shader.filename.replace('shaders/', '');\n    if (shader.defines_arr.length) {\n      filename += `(${shader.defines_arr.join(',')})`;\n    }\n    if (ui.buttonText({\n      text: filename,\n      x, y, z,\n      w: button_w,\n      h: font_height,\n      color: selected_shader === shader ? color_selected : shader.valid ? undefined : color_invalid,\n      align: glov_font.ALIGN.HFIT,\n    })) {\n      if (selected_shader === shader) {\n        selected_shader = undefined;\n      } else {\n        selected_shader = shader;\n      }\n    }\n\n    let stats = getShaderStats(shader.shader_source_text, shader.type === gl.FRAGMENT_SHADER ? 'frag' : 'vert', false);\n    if (!stats || stats.err) {\n      font.draw({\n        x: x + button_w + PAD, y, z,\n        w: score_w,\n        color: stats?.err ? 0x800000ff : 0x808080ff,\n        text: stats?.err ? 'ERR' : '...',\n        align: font.ALIGN.HCENTERFIT,\n      });\n    } else {\n      let color = 0x000000ff;\n      font.draw({\n        x: x + button_w + PAD, y, z,\n        w: subscore_w - 1,\n        color,\n        text: `${stats.spirv?.count_total}`,\n        align: font.ALIGN.HCENTERFIT,\n      });\n      font.draw({\n        x: x + button_w + PAD + subscore_w + 1, y, z,\n        w: subscore_w - 1,\n        color,\n        text: stats.bin_size.toLocaleString(),\n        align: font.ALIGN.HCENTERFIT,\n      });\n    }\n\n    y += font_height;\n  }\n\n  scroll_area.end(y);\n  y = scroll_y_start + min(max_h, y);\n  z = Z.SHADER_DEBUG;\n\n  let close_button_size = ui.font_height;\n  if (ui.buttonText({\n    x: x0 + w - close_button_size,\n    y: y0, z: z + 1,\n    w: close_button_size, h: close_button_size,\n    text: 'X',\n  })) {\n    settings.set('shader_debug', 0);\n  }\n\n  ui.panel({\n    x: x0 - PANEL_PAD, y: y0 - PANEL_PAD, z: z - 1,\n    w: w + PANEL_PAD * 2, h: y - y0 + PANEL_PAD * 2,\n    color: color_panel,\n  });\n\n  if (!selected_shader) {\n    return;\n  }\n  let shader = selected_shader;\n  x0 += w + PANEL_PAD * 2;\n  w = camera2d.x1() - PAD - x0;\n  x = x0;\n  y = y0;\n\n  font.draw({\n    x, y, z,\n    w,\n    style, text: shader.filename,\n    align: font.ALIGN.HCENTERFIT,\n  });\n  y += font_height + 1;\n  ui.drawLine(x0 + w * 0.3, y, x0 + w * 0.7, y, z, 0.5, true, color_line);\n  y += PAD;\n\n  scroll_y_start = y;\n  scroll_area_source.begin({\n    x, y, w, h: max_h,\n  });\n  sub_w = w - PAD - scroll_area_source.barWidth();\n  x = 0;\n  y = 0;\n  z = Z.UI;\n\n  if (shader.error_text) {\n    y += font.draw({\n      x, y, z,\n      w: sub_w,\n      color: 0x800000ff,\n      style, text: shader.error_text,\n      align: font.ALIGN.HWRAP,\n    });\n  }\n\n  function flatten(obj, path) {\n    for (let key in obj) {\n      if (key === 'text' || key === 'spirv_raw') {\n        continue;\n      }\n      let value = obj[key];\n      let subpath = path ? `${path}.${key}` : key;\n      if (typeof value === 'object') {\n        flatten(value, subpath);\n      } else {\n        font.draw({\n          x, y, z,\n          w: sub_w,\n          style,\n          text: `${subpath}: ${value}`,\n          align: font.ALIGN.HFIT,\n        });\n        y += ui.font_height;\n      }\n    }\n  }\n  let stats = getShaderStats(shader.shader_source_text, shader.type === gl.FRAGMENT_SHADER ? 'frag' : 'vert');\n  if (!stats) {\n    y += font.draw({\n      x, y, z,\n      w,\n      style,\n      text: 'Loading shader stats...',\n      align: font.ALIGN.HWRAP,\n    });\n  } else if (stats.err) {\n    y += font.draw({\n      x, y, z,\n      w: sub_w,\n      style: style_error,\n      text: String(stats.err),\n      align: font.ALIGN.HWRAP,\n    });\n  } else {\n    flatten(stats);\n  }\n\n  let source_height = ui.font_height * 0.5;\n\n  if (stats?.text) {\n    y += PAD;\n    ui.drawLine(x + w * 0.3, y, x + w * 0.7, y, z, 0.5, true, color_line);\n    y += PAD/2;\n    font.draw({\n      x, y, z,\n      w,\n      style, text: 'Analyzed Shader Source',\n      align: font.ALIGN.HCENTERFIT,\n    });\n    y += font_height + 1;\n\n    let h = font.draw({\n      x, y, z,\n      w,\n      size: source_height,\n      style, text: stats.text,\n      align: font.ALIGN.HWRAP,\n    });\n    if (input.click({ x, y, w, h })) {\n      ui.provideUserString('Analyzed shader source', stats.text);\n    }\n    y += h;\n  }\n\n  if (stats?.spirv_raw) {\n    y += PAD;\n    ui.drawLine(x + w * 0.3, y, x + w * 0.7, y, z, 0.5, true, color_line);\n    y += PAD/2;\n    font.draw({\n      x, y, z,\n      w,\n      style, text: 'SPIR-V Disassembly',\n      align: font.ALIGN.HCENTERFIT,\n    });\n    y += font_height + 1;\n\n    let h = font.draw({\n      x, y, z,\n      w,\n      size: source_height,\n      style, text: stats.spirv_raw,\n      align: font.ALIGN.HWRAP,\n    });\n    if (input.click({ x, y, w, h })) {\n      ui.provideUserString('SPIR-V Disassembly', stats.spirv_raw);\n    }\n    y += h;\n  }\n\n  y += PAD;\n  ui.drawLine(x + w * 0.3, y, x + w * 0.7, y, z, 0.5, true, color_line);\n  y += PAD/2;\n  font.draw({\n    x, y, z,\n    w,\n    style, text: 'Actual WebGL Shader Source',\n    align: font.ALIGN.HCENTERFIT,\n  });\n  y += font_height + 1;\n\n  let h = font.draw({\n    x, y, z,\n    w,\n    size: source_height,\n    style, text: shader.shader_source_text,\n    align: font.ALIGN.HWRAP,\n  });\n  if (input.click({ x, y, w, h })) {\n    ui.provideUserString('Used WebGL shader source', shader.shader_source_text);\n  }\n  y += h;\n\n  scroll_area_source.end(y);\n  y = scroll_y_start + min(max_h, y);\n  z = Z.SHADER_DEBUG;\n\n  ui.panel({\n    x: x0 - PANEL_PAD, y: y0 - PANEL_PAD, z: z - 1,\n    w: w + PANEL_PAD * 2, h: y - y0 + PANEL_PAD * 2,\n    color: color_panel,\n  });\n}\n\nexport function shaderDebugUIStartup() {\n  // Registering after startup because of needing to call engine.addTickFunc()\n  settings.register({\n    shader_debug: {\n      label: 'Shader Debug',\n      default_value: 0,\n      type: cmd_parse.TYPE_INT,\n      range: [0,1],\n      access_show: ['sysadmin'],\n      on_change: () => {\n        engine.removeTickFunc(shaderDebugUITick);\n        if (settings.shader_debug) {\n          engine.addTickFunc(shaderDebugUITick);\n        }\n      },\n    },\n  });\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nexport const MAX_SEMANTIC = 5;\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst engine = require('./engine.js');\nconst { errorReportClear, errorReportSetDetails, glovErrorReport } = require('./error_report.js');\nconst { filewatchOn } = require('./filewatch.js');\nconst { matchAll, nop } = require('glov/common/util.js');\nconst { texturesUnloadDynamic } = require('./textures.js');\nconst { webFSGetFile } = require('./webfs.js');\n\nlet last_id = 0;\n\nlet bound_prog = null;\n\nexport const semantic = {\n  'ATTR0': 0,\n  'POSITION': 0,\n  'ATTR1': 1,\n  'COLOR': 1,\n  'COLOR_0': 1,\n  'ATTR2': 2,\n  'TEXCOORD': 2,\n  'TEXCOORD_0': 2,\n  'ATTR3': 3,\n  'NORMAL': 3,\n  'ATTR4': 4,\n  'TEXCOORD_1': 4,\n};\n\nexport let globals;\nlet globals_used;\nlet global_defines;\n\nlet error_fp;\nlet error_fp_webgl2;\nlet error_vp;\n\nlet shaders = [];\n\nconst vp_attr_regex = /attribute [^ ]+ ([^ ;]+);/g;\nconst uniform_regex = /uniform (?:(?:low|medium|high)p )?((?:(?:vec|mat)\\d(?:x\\d)?|float) [^ ;]+);/g;\nconst sampler_regex = /uniform sampler(?:2D|Cube) ([^ ;]+);/g;\nconst include_regex = /\\n#include \"([^\"]+)\"/g;\n\nconst type_size = {\n  float: 1,\n  vec2: 2*1,\n  vec3: 3*1,\n  vec4: 4*1,\n  mat3: 3*3,\n  mat4: 4*4,\n};\n\nfunction loadInclude(filename) {\n  let text = webFSGetFile(filename, 'text');\n  return `\\n// from include \"${filename}\":\\n${text}\\n`;\n}\n\nexport function shadersResetState() {\n  for (let ii = 0; ii < shaders.length; ++ii) {\n    let shader = shaders[ii];\n    if (shader.programs) {\n      for (let fpid in shader.programs) {\n        let prog = shader.programs[fpid];\n        //gl.useProgram(prog.handle);\n        for (let jj = 0; jj < prog.uniforms.length; ++jj) {\n          let unif = prog.uniforms[jj];\n          for (let kk = 0; kk < unif.size; ++kk) {\n            unif.value[kk] = NaN;\n          }\n          //uniformSetValue(unif);\n        }\n      }\n    }\n  }\n  bound_prog = null;\n  gl.useProgram(null);\n}\n\nfunction setGLErrorReportDetails() {\n  // Set some debug details we might want\n  let details = {\n    max_fragment_uniform_vectors: gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS),\n    max_varying_vectors: gl.getParameter(gl.MAX_VARYING_VECTORS),\n    max_vertex_attribs: gl.getParameter(gl.MAX_VERTEX_ATTRIBS),\n    max_vertex_uniform_vectors: gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS),\n    vendor: gl.getParameter(gl.VENDOR),\n    renderer: gl.getParameter(gl.RENDERER),\n    webgl: engine.webgl2 ? 2 : 1,\n  };\n  let debug_info = gl.getExtension('WEBGL_debug_renderer_info');\n  if (debug_info) {\n    details.renderer_unmasked = gl.getParameter(debug_info.UNMASKED_RENDERER_WEBGL);\n    details.vendor_unmasked = gl.getParameter(debug_info.UNMASKED_VENDOR_WEBGL);\n  }\n  for (let key in details) {\n    errorReportSetDetails(key, details[key]);\n  }\n}\n\nlet report_queued = false;\nlet shader_errors;\nlet shader_errors_any_fatal;\nlet reported_shader_errors = false;\nfunction reportShaderError(non_fatal, err) {\n  function doReport() {\n    report_queued = false;\n    setGLErrorReportDetails();\n    let msg = `Shader error(s):\\n    ${shader_errors.join('\\n    ')}`;\n    reported_shader_errors = true;\n    if (!shader_errors_any_fatal) {\n      glovErrorReport(false, msg, 'shaders.js');\n    } else {\n      assert(false, msg);\n    }\n    shader_errors = null;\n  }\n  if (!report_queued) {\n    setTimeout(doReport, 1000);\n    report_queued = true;\n    shader_errors = [];\n    shader_errors_any_fatal = false;\n  }\n  shader_errors_any_fatal = shader_errors_any_fatal || !non_fatal;\n  shader_errors.push(err);\n}\n\nfunction parseIncludes(parent_name, text) {\n  let supplied_uniforms = {};\n  text.replace(uniform_regex, function (str, key) {\n    supplied_uniforms[key] = true;\n  });\n  text = text.replace(include_regex, function (str, filename) {\n    let include_path = parent_name.split('/');\n    include_path.pop();\n    include_path.push(filename);\n    include_path = include_path.join('/');\n    let replacement = loadInclude(include_path);\n    if (!replacement) {\n      console.error(`Could not evaluate ${str}`);\n      return str;\n    }\n    // Remove duplicate uniforms\n    replacement = replacement.replace(uniform_regex, function (str2, key) {\n      if (supplied_uniforms[key]) {\n        return `// [removed ${key}]`;\n      }\n      supplied_uniforms[key] = true;\n      return str2;\n    });\n    return replacement;\n  });\n  return text;\n}\n\nconst webgl2_header = [\n  '#version 300 es',\n  '#define WEBGL2',\n].join('\\n');\nconst webgl2_header_fp = [\n  webgl2_header,\n  '#define varying in',\n  'out lowp vec4 fragColor;',\n  '#define gl_FragColor fragColor',\n  '#define texture2D texture',\n  '#define textureCube texture',\n  ''\n].join('\\n');\nconst webgl2_header_vp = [\n  webgl2_header,\n  '#define varying out',\n  '#define attribute in',\n  ''\n].join('\\n');\n\nfunction Shader(params) {\n  let { filename, defines, non_fatal } = params;\n  assert.equal(typeof filename, 'string');\n  let type = filename.endsWith('.fp') ? gl.FRAGMENT_SHADER : filename.endsWith('.vp') ? gl.VERTEX_SHADER : 0;\n  assert(type);\n  this.type = type;\n  this.filename = filename;\n  this.non_fatal = non_fatal;\n  this.defines_arr = (defines || []);\n  this.defines = this.defines_arr.map((a) => `#define ${a}\\n`).join('');\n  this.shader = gl.createShader(type);\n  this.id = ++last_id;\n  if (type === gl.VERTEX_SHADER) {\n    this.programs = {};\n  }\n  shaders.push(this);\n  this.compile();\n}\n\nexport function shadersGetDebug() {\n  return shaders;\n}\n\nfunction cleanShaderError(error_text) {\n  if (error_text) { // sometimes null on iOS\n    error_text = error_text.replace(/\\0/g, '').trim();\n  }\n  return error_text;\n}\n\nShader.prototype.compile = function () {\n  let { type, filename } = this;\n  let header = '';\n  let text = webFSGetFile(filename, 'text');\n  if (engine.webgl2 && text.includes('#pragma WebGL2')) {\n    header = type === gl.VERTEX_SHADER ? webgl2_header_vp : webgl2_header_fp;\n  }\n  text = `${header}${global_defines}${this.defines}${text}`;\n  text = parseIncludes(filename, text);\n  text = text.replace(/#pragma WebGL2?/g, '');\n  if (type === gl.VERTEX_SHADER) {\n    this.attributes = matchAll(text, vp_attr_regex);\n    // Ensure they are known names so we can give them indices\n    // Add to semantic[] above as needed\n    this.attributes.forEach((v) => assert(semantic[v] !== undefined));\n  } else {\n    this.samplers = matchAll(text, sampler_regex);\n    // Ensure all samplers end in a unique number\n    let found = [];\n    this.samplers.forEach((v) => {\n      let num = Number(v.slice(-1));\n      assert(!isNaN(num));\n      assert(!found[num]);\n      found[num] = true;\n    });\n  }\n  this.uniforms = matchAll(text, uniform_regex);\n  // Ensure a known type\n  this.uniforms.forEach((v) => {\n    let type_name = v.split(' ')[0];\n    assert(type_size[type_name]);\n  });\n  this.shader_source_text = text;\n  gl.shaderSource(this.shader, text);\n  gl.compileShader(this.shader);\n\n  if (!gl.getShaderParameter(this.shader, gl.COMPILE_STATUS)) {\n    this.valid = false;\n    let error_text = this.error_text = cleanShaderError(gl.getShaderInfoLog(this.shader));\n    if (this.defines_arr.length) {\n      filename += `(${this.defines_arr.join(',')})`;\n    }\n    console[this.non_fatal ? 'warn' : 'error'](`Error compiling ${filename}: ${error_text}`);\n    reportShaderError(this.non_fatal, `${filename}: ${error_text}`);\n    console.log(text.split('\\n').map((line, idx) => `${idx+1}: ${line}`).join('\\n'));\n  } else {\n    this.valid = true;\n    if (this.error_text) {\n      delete this.error_text;\n    }\n  }\n};\n\nexport function create(filename) {\n  if (typeof filename === 'object') {\n    return new Shader(filename);\n  }\n  return new Shader({ filename });\n}\n\nfunction uniformSetValue(unif) {\n  switch (unif.width) { // eslint-disable-line default-case\n    case 1:\n      gl.uniform1fv(unif.location, unif.value);\n      break;\n    case 2:\n      gl.uniform2fv(unif.location, unif.value);\n      break;\n    case 3:\n      gl.uniform3fv(unif.location, unif.value);\n      break;\n    case 4:\n      gl.uniform4fv(unif.location, unif.value);\n      break;\n    case 9:\n      gl.uniformMatrix3fv(unif.location, false, unif.value);\n      break;\n    case 16:\n      gl.uniformMatrix4fv(unif.location, false, unif.value);\n      break;\n  }\n}\n\nlet require_prelink = false;\nexport function shadersRequirePrelink(ensure) {\n  let old = require_prelink;\n  require_prelink = ensure;\n  return old;\n}\n\nfunction link(vp, fp, on_error) {\n  assert(!require_prelink);\n  let prog = vp.programs[fp.id] = {\n    handle: gl.createProgram(),\n    uniforms: null,\n  };\n  if (!prog.handle) {\n    assert(false, `gl.createProgram() returned ${prog.handle}${gl.createProgram() ? ', retry would succeed' : ''}`);\n  }\n  gl.attachShader(prog.handle, vp.shader);\n  gl.attachShader(prog.handle, fp.shader);\n  // call this for all relevant semantic\n  for (let ii = 0; ii < vp.attributes.length; ++ii) {\n    gl.bindAttribLocation(prog.handle, semantic[vp.attributes[ii]], vp.attributes[ii]);\n  }\n  gl.linkProgram(prog.handle);\n\n  prog.valid = gl.getProgramParameter(prog.handle, gl.LINK_STATUS);\n  if (!prog.valid) {\n    let error_text = cleanShaderError(gl.getProgramInfoLog(prog.handle));\n    console.error(`Shader link error: ${error_text}`);\n    // Currently, not calling on_error if `engine.DEBUG`, we want to see our\n    //   shader errors immediately!\n    if (on_error && (!engine.DEBUG || on_error === nop)) {\n      on_error(error_text);\n    } else {\n      reportShaderError(false, `Shader link error (${vp.filename} & ${fp.filename}):` +\n        ` ${error_text}`);\n    }\n    prog.uniforms = [];\n    return prog;\n  }\n\n  gl.useProgram(prog.handle);\n  bound_prog = prog;\n\n  let uniforms = vp.uniforms.slice(0);\n  for (let ii = 0; ii < fp.uniforms.length; ++ii) {\n    let name = fp.uniforms[ii];\n    if (uniforms.indexOf(name) === -1) {\n      uniforms.push(name);\n    }\n  }\n  prog.uniforms = uniforms.map((v) => {\n    v = v.split(' ');\n    let type = v[0];\n    let name = v[1];\n    let count = 1;\n    let m = name.match(/([^[]+)\\[(\\d+)\\]/);\n    if (m) {\n      name = m[1];\n      count = Number(m[2]);\n    }\n    let location = gl.getUniformLocation(prog.handle, name);\n    if (location === null) {\n      // Not in either shader, (commented out?), remove (via filter below)\n      return null;\n    }\n    let width = type_size[type];\n    let size = width * count;\n    let glob = globals[name];\n    globals_used[name] = true;\n    let value = new Float32Array(size);\n    // set initial value\n    let unif = {\n      name,\n      size,\n      width,\n      count,\n      value,\n      location,\n      glob,\n    };\n    uniformSetValue(unif);\n    return unif;\n  }).filter((v) => v);\n\n  for (let ii = 0; ii < fp.samplers.length; ++ii) {\n    let name = fp.samplers[ii];\n    let num = Number(name.slice(-1));\n    let location = gl.getUniformLocation(prog.handle, name);\n    if (location !== null) {\n      gl.uniform1i(location, num);\n    }\n  }\n  return prog;\n}\n\nfunction autoLink(vp, fp, on_error) {\n  let prog = vp.programs[fp.id];\n  if (!prog) {\n    prog = link(vp, fp, on_error);\n  }\n  if (!prog.valid) {\n    prog = link(vp, error_fp, nop);\n    if (!prog.valid && error_fp_webgl2) {\n      prog = link(vp, error_fp_webgl2, nop);\n    }\n    if (!prog.valid) {\n      prog = link(error_vp, error_fp, nop);\n    }\n    vp.programs[fp.id] = prog;\n  }\n  return prog;\n}\n\nexport function bind(vp, fp, params) {\n  let prog = vp.programs[fp.id];\n  if (!prog) {\n    prog = autoLink(vp, fp);\n  }\n  if (prog !== bound_prog) {\n    bound_prog = prog;\n    gl.useProgram(prog.handle);\n  }\n  for (let ii = 0; ii < prog.uniforms.length; ++ii) {\n    let unif = prog.uniforms[ii];\n    let value = params[unif.name] || unif.glob;\n    if (!value) {\n      continue;\n    }\n    let diff = false;\n    for (let jj = 0; jj < unif.size; ++jj) {\n      if (value[jj] !== unif.value[jj]) {\n        diff = true;\n        break;\n      }\n    }\n    if (diff) {\n      for (let jj = 0; jj < unif.size; ++jj) {\n        unif.value[jj] = value[jj];\n      }\n      uniformSetValue(unif);\n    }\n  }\n}\n\nexport function prelink(vp, fp, params = {}, on_error) {\n  let prog = autoLink(vp, fp, on_error);\n  // In theory, only need to link, not bind, but let's push it through the pipe as far as it can to be safe.\n  if (prog.valid) {\n    bind(vp, fp, params);\n  }\n  return prog.valid;\n}\n\nconst reserved = { WEBGL2: 1 };\nexport function addReservedDefine(key) {\n  reserved[key] = 1;\n}\nlet internal_defines = {};\nfunction applyDefines() {\n  global_defines = Object.keys(engine.defines).filter((v) => !reserved[v])\n    .concat(Object.keys(internal_defines))\n    .map((v) => `#define ${v}\\n`)\n    .join('');\n}\n\nfunction shaderReload() {\n  shadersRequirePrelink(false);\n  if (shaders.length) {\n    if (reported_shader_errors) {\n      errorReportClear();\n      reported_shader_errors = false;\n    }\n    gl.useProgram(null);\n    for (let ii = 0; ii < shaders.length; ++ii) {\n      let programs = shaders[ii].programs;\n      if (programs) {\n        for (let id in programs) {\n          gl.deleteProgram(programs[id].handle);\n        }\n        shaders[ii].programs = {};\n      }\n    }\n    for (let ii = 0; ii < shaders.length; ++ii) {\n      shaders[ii].compile();\n    }\n    texturesUnloadDynamic();\n  }\n}\n\nexport function handleDefinesChanged() {\n  applyDefines();\n  shaderReload();\n}\n\nexport function setInternalDefines(new_values) {\n  for (let key in new_values) {\n    if (new_values[key]) {\n      internal_defines[key] = new_values[key];\n    } else {\n      delete internal_defines[key];\n    }\n  }\n  handleDefinesChanged();\n}\n\nfunction onShaderChange(filename) {\n  shaderReload();\n}\n\nexport function startup(_globals) {\n  applyDefines();\n  globals = _globals;\n  globals_used = {};\n\n  error_fp = create('shaders/error.fp');\n  if (engine.webgl2) {\n    error_fp_webgl2 = create('shaders/error_gl2.fp');\n  }\n  error_vp = create('shaders/error.vp');\n\n  filewatchOn('.fp', onShaderChange);\n  filewatchOn('.vp', onShaderChange);\n}\n\nexport function addGlobal(key, vec) {\n  assert(!globals[key]);\n  assert(!globals_used[key]); // A shader has already been prelinked referencing this global\n  globals[key] = vec;\n  for (let ii = 0; ii < vec.length; ++ii) {\n    assert(isFinite(vec[ii]));\n  }\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint complexity:off */\n\n//////////////////////////////////////////////////////////////////////////\n// GlovSimpleMenu is just a GlovSelectionBox plus some logic to activate\n// callbacks/etc upon selecting of elements.\n\nexports.createSimpleMenu = simpleMenuCreate; // eslint-disable-line no-use-before-define\nexports.create = simpleMenuCreate; // eslint-disable-line no-use-before-define\n\nconst assert = require('assert');\nconst { clamp } = require('glov/common/util.js');\nconst { vec4 } = require('glov/common/vmath.js');\nconst camera2d = require('./camera2d.js');\nconst engine = require('./engine.js');\nconst {\n  KEYS,\n  PAD,\n  keyDown,\n  keyDownEdge,\n  padButtonDownEdge,\n} = require('./input.js');\nconst { selectionBoxCreate } = require('./selection_box.js');\nconst { slider, sliderIsFocused } = require('./slider.js');\nconst ui = require('./ui.js');\n\nconst color101010C8 = vec4(0x10/255, 0x10/255, 0x10/255, 0xC8/255);\n\nclass GlovSimpleMenu {\n  constructor(params) {\n    params = params || {};\n    this.sel_box = selectionBoxCreate(params);\n    this.edit_index = -1;\n\n    // Output members\n    this.selected = -1; // actually selected/acted on, not just current highlight, like this.sel_box.selected\n  }\n\n  execItem(index, delta) {\n    let { items } = this.sel_box;\n    assert(index >= 0 && index < items.length);\n    let menu_item = items[index];\n    let force = false;\n    if (delta === 2) {\n      delta = 1;\n      force = true;\n    }\n    if (!menu_item.state) {\n      if (menu_item.value !== null && (menu_item.prompt_int || menu_item.prompt_string)) {\n        // Open an edit box\n        // menu.internal.mte = GlovModalTextEntry::createInt(simpleMenuFieldName(menu_item.name), *menu_item.value);\n        this.internal.edit_index = index;\n        // glovInputReleaseAll();\n      } else if (menu_item.value !== null) {\n        if (keyDown(KEYS.SHIFT) && !force) {\n          delta = -1;\n        }\n        menu_item.value += delta * menu_item.value_inc;\n        if (menu_item.slider || menu_item.plus_minus) {\n          // implicitly no wrapping, maybe make a separate flag for this?\n          menu_item.value = clamp(menu_item.value, menu_item.value_min, menu_item.value_max);\n        } else {\n          if (menu_item.value < menu_item.value_min) {\n            menu_item.value = menu_item.value_max;\n          }\n          if (menu_item.value > menu_item.value_max) {\n            menu_item.value = menu_item.value_min;\n          }\n        }\n        // TODO: some kind of callback on value change\n      } else {\n        // presumably tag or externally operated on, probably want to skip key repeat here too?\n        // glovInputReleaseAll();\n      }\n    } else {\n      engine.setState(menu_item.state);\n      // glovInputReleaseAll();\n    }\n    if (menu_item.cb) {\n      menu_item.cb();\n    }\n  }\n\n  run(params) {\n    let { sel_box } = this;\n    sel_box.applyParams(params); // Apply new list of items, positions, etc\n    sel_box.items[0].auto_focus = true;\n\n    const { items, x, z } = sel_box;\n    const y0 = sel_box.y;\n    let exit_index = -1;\n    for (let i = 0; i < items.length; ++i) {\n      if (items[i].exit) {\n        exit_index = i;\n      }\n    }\n\n    // Check to see if any selection has an editBox open first\n    let selbox_enabled = !(params && params.disabled);\n    if (this.edit_index >= 0 && this.edit_index < items.length) {\n      selbox_enabled = false;\n      ui.drawRect(camera2d.x0(), camera2d.y0(), camera2d.x1(), camera2d.y1(),\n        z + 2, color101010C8);\n      // TODO: Need modal text entry dialog\n      // let ret = this.internal.mte.run(z + 3);\n\n      // if (ret == 'ok') {\n      //   if (items[this.edit_index].prompt_int) {\n      //     items[this.edit_index].value = this.internal.mte.getInt();\n      //   } else {\n      //     items[this.edit_index].svalue = this.internal.mte.getString();\n      //   }\n      //   this.edit_index = -1;\n      // } else if (ret == 'cancel') {\n      //   this.edit_index = -1;\n      // }\n    }\n    sel_box.disabled = !selbox_enabled;\n\n    // Do all sliders, plus-minus-es\n    let display = sel_box.display;\n    sel_box.show_as_focused = -1;\n    for (let ii = 0; ii < items.length; ii++) {\n      let menu_item = items[ii];\n      if (menu_item.slider) {\n        // slider_no_notches = true;\n        // slider_sound_release = this.sound_accept;\n        let slider_width = 160;\n        let slider_x = x + sel_box.width - slider_width - 4 - display.xpad;\n        let color = display.style_default.color_vec4;\n        // if (display.style_default.color_mode == glov_font.COLOR_MODE.GRADIENT) {\n        //   color = colorIntLerp(display.style_default.color_vec4, display.style_default.colorLR, 0.5);\n        // }\n        if (menu_item.disabled) {\n          color = display.style_disabled.color;\n        }\n        menu_item.value = slider(menu_item.value, {\n          x: slider_x,\n          y: y0 + ii * sel_box.entry_height,\n          z: z + 3,\n          w: slider_width,\n          h: sel_box.entry_height,\n          // scale: 1,\n          disabled: menu_item.disabled,\n          color,\n          min: menu_item.value_min,\n          max: menu_item.value_max,\n          pad_focusable: false,\n        });\n        if (sliderIsFocused()) {\n          // expect our row to be selected\n          sel_box.show_as_focused = ii;\n        }\n      } else if (menu_item.plus_minus) {\n        assert(typeof menu_item.value === 'number', 'plus_minus items require a numerical value');\n        assert(menu_item.value_inc, 'plus_minus items require a value increment');\n        let pad = 6;\n        let button_width = sel_box.entry_height;\n        let button_x = x + sel_box.width - button_width * 2 - pad - 4;\n        let delta = 0;\n        // if (!glovMasterControllerActive()) { // Don't show buttons if using a controller / no mouse\n        if (ui.buttonText({\n          pad_focusable: false,\n          x: button_x,\n          y: y0 + ii * sel_box.entry_height,\n          z: z + 3,\n          w: button_width,\n          h: sel_box.entry_height,\n          text: '-'\n        })) {\n          delta = -1;\n        }\n        let minus_over = ui.button_mouseover;\n        if (ui.buttonText({\n          pad_focusable: false,\n          x: button_x + pad + button_width,\n          y: y0 + ii * sel_box.entry_height,\n          z: z + 3,\n          w: button_width,\n          h: sel_box.entry_height,\n          text: '+'\n        })) {\n          delta = 1;\n        }\n        let plus_over = ui.button_mouseover;\n        // } end if (!glovMasterControllerActive())\n        if (delta) {\n          menu_item.value += delta * menu_item.value_inc;\n          menu_item.value = clamp(menu_item.value, menu_item.value_min, menu_item.value_max);\n        }\n        if (minus_over || plus_over) {\n          // expect our row to be selected\n          sel_box.show_as_focused = ii;\n        }\n      }\n    }\n\n    let y = y0;\n    y += sel_box.run();\n\n    let selected=-1;\n    if (exit_index !== -1 && (\n      keyDownEdge(KEYS.ESC) ||\n      !items[exit_index].no_controller_exit && padButtonDownEdge(PAD.CANCEL)\n    )) {\n      this.execItem(exit_index, 1);\n      selected = exit_index;\n    }\n    if (sel_box.was_clicked) {\n      this.execItem(sel_box.selected, sel_box.was_right_clicked ? -1 : 1);\n      selected = sel_box.selected;\n    }\n    this.selected = selected;\n    if (selected !== -1 && !items[selected].no_sound) {\n      if (items[selected].exit) {\n        ui.playUISound('cancel');\n      } else {\n        ui.playUISound('select');\n      }\n    }\n\n    return y - y0;\n  }\n\n  isSelected(tag_or_index) {\n    if (this.selected === -1) {\n      return false;\n    }\n    if (tag_or_index === undefined) {\n      return this.sel_box.items[this.selected].tag || true;\n    }\n    return this.sel_box.isSelected(tag_or_index);\n  }\n\n  getSelectedIndex() {\n    return this.selected;\n  }\n\n  getSelectedItem() {\n    return this.sel_box.items[this.selected];\n  }\n}\n\nexport function simpleMenuCreate(params) {\n  return new GlovSimpleMenu(params);\n}\n","import * as assert from 'assert';\nconst { round, max } = Math;\nimport { clamp } from 'glov/common/util.js';\nimport { vec4 } from 'glov/common/vmath.js';\nimport * as input from './input.js';\nimport {\n  SPOT_DEFAULT_BUTTON,\n  SPOT_NAV_LEFT,\n  SPOT_NAV_RIGHT,\n  spot,\n} from './spot.js';\nimport { Z_MIN_INC, drawHBox, playUISound } from './ui.js';\nimport * as ui from './ui.js';\n\nconst SPOT_DEFAULT_SLIDER = {\n  ...SPOT_DEFAULT_BUTTON,\n  sound_button: null,\n  custom_nav: {\n    [SPOT_NAV_RIGHT]: null,\n    [SPOT_NAV_LEFT]: null,\n  },\n};\n\nlet slider_default_vshrink = 1.0;\nlet slider_default_handle_shrink = 1.0;\nexport function sliderSetDefaultShrink(vshrink, handle_shrink) {\n  slider_default_vshrink = vshrink;\n  slider_default_handle_shrink = handle_shrink;\n}\nconst color_slider_handle = vec4(1,1,1,1);\nconst color_slider_handle_grab = vec4(0.5,0.5,0.5,1);\nconst color_slider_handle_over = vec4(0.75,0.75,0.75,1);\nlet slider_dragging = false; // for caller polling\nlet slider_focused = false; // for caller polling\nexport function sliderIsDragging() {\n  return slider_dragging;\n}\nexport function sliderIsFocused() {\n  return slider_focused;\n}\n// Returns new value\nexport function slider(value, param) {\n  // required params\n  assert(typeof param.x === 'number');\n  assert(typeof param.y === 'number');\n  assert(param.min < param.max); // also must be numbers\n  // optional params\n  param.z = param.z || Z.UI;\n  param.w = param.w || ui.button_width;\n  param.h = param.h || ui.button_height;\n  param.max_dist = param.max_dist || Infinity;\n  // below: param.step = param.step || (param.max - param.min)/16;\n  let vshrink = param.vshrink || slider_default_vshrink;\n  let handle_shrink = param.handle_shrink || slider_default_handle_shrink;\n  let disabled = param.disabled || false;\n  let handle_h = param.h * handle_shrink;\n  let handle_w = ui.sprites.slider_handle.uidata.wh[0] * handle_h;\n  let pad_focusable = param.pad_focusable;\n\n  slider_dragging = false;\n\n  let shrinkdiff = handle_shrink - vshrink;\n  drawHBox({\n    x: param.x + param.h * shrinkdiff/2,\n    y: param.y + param.h * (1 - vshrink)/2,\n    z: param.z,\n    w: param.w - param.h * shrinkdiff,\n    h: param.h * vshrink,\n  }, ui.sprites.slider, param.color);\n\n  let xoffs = round(max(ui.sprites.slider.uidata.wh[0] * param.h * vshrink, handle_w) / 2);\n  let draggable_width = param.w - xoffs * 2;\n\n  // Draw notches - would also need to quantize the values below\n  // if (!slider->no_notches) {\n  //   float space_for_notches = width - xoffs * 4;\n  //   int num_notches = max - 1;\n  //   float notch_w = tile_scale * glov_ui_slider_notch->GetTileWidth();\n  //   float notch_h = tile_scale * glov_ui_slider_notch->GetTileHeight();\n  //   float max_notches = space_for_notches / (notch_w + 2);\n  //   int notch_inc = 1;\n  //   if (num_notches > max_notches)\n  //     notch_inc = ceil(num_notches / floor(max_notches));\n\n  //   for (int ii = 1; ii*notch_inc <= num_notches; ii++) {\n  //     float notch_x_mid = x + xoffs + draggable_width * ii * notch_inc / (float)max;\n  //     if (notch_x_mid - notch_w/2 < x + xoffs * 2)\n  //       continue;\n  //     if (notch_x_mid + notch_w/2 > x + width - xoffs * 2)\n  //       continue;\n  //     glov_ui_slider_notch->DrawStretchedColor(notch_x_mid - notch_w / 2, y + yoffs,\n  //       z + 0.25, notch_w, notch_h, 0, color);\n  //   }\n  // }\n\n  // Handle\n  let drag = !disabled && input.drag(param);\n  let grabbed = Boolean(drag);\n  param.def = SPOT_DEFAULT_SLIDER;\n  if (grabbed) {\n    param.focus_steal = true;\n  }\n  param.pad_focusable = pad_focusable;\n  let spot_ret = spot(param);\n  slider_focused = spot_ret.focused;\n  if (spot_ret.ret && spot_ret.pos) {\n    // was actually clicked (not\n    grabbed = false;\n    // update pos\n    value = (spot_ret.pos[0] - (param.x + xoffs)) / draggable_width;\n    value = param.min + (param.max - param.min) * clamp(value, 0, 1);\n    playUISound('button_click');\n  } else if (grabbed) {\n    // update pos\n    value = (drag.cur_pos[0] - (param.x + xoffs)) / draggable_width;\n    value = param.min + (param.max - param.min) * clamp(value, 0, 1);\n    // Eat all mouseovers while dragging\n    input.mouseOver();\n    slider_dragging = true;\n    slider_focused = true;\n  }\n  if (spot_ret.nav) {\n    playUISound('button_click');\n    let step = param.step || (param.max - param.min)/16;\n    if (spot_ret.nav === SPOT_NAV_RIGHT) {\n      value = clamp(value + step, param.min, param.max);\n    } else if (spot_ret.nav === SPOT_NAV_LEFT) {\n      value = clamp(value - step, param.min, param.max);\n    }\n  }\n  let handle_center_pos = param.x + xoffs + draggable_width * (value - param.min) / (param.max - param.min);\n  let handle_x = handle_center_pos - handle_w / 2;\n  let handle_y = param.y + param.h / 2 - handle_h / 2;\n  let handle_color = color_slider_handle;\n  if (grabbed) {\n    handle_color = color_slider_handle_grab;\n  } else if (spot_ret.focused) {\n    handle_color = color_slider_handle_over;\n  }\n\n  ui.sprites.slider_handle.draw({\n    x: handle_x,\n    y: handle_y,\n    z: param.z + Z_MIN_INC,\n    w: handle_w,\n    h: handle_h,\n    color: handle_color,\n    frame: 0,\n  });\n\n  return value;\n}\n","// Portions Copyright 2020 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/* eslint-env browser */\n\nimport assert from 'assert';\nimport { PLATFORM_FBINSTANT } from 'glov/client/client_config';\nimport {\n  ID_PROVIDER_FB_GAMING,\n  ID_PROVIDER_FB_INSTANT,\n  PRESENCE_ACTIVE,\n  PRESENCE_INACTIVE,\n  PRESENCE_OFFLINE,\n} from 'glov/common/enums';\nimport { FriendData, FriendStatus, FriendsData } from 'glov/common/friends_data';\nimport {\n  ClientPresenceData,\n  ErrorCallback,\n  FriendCmdResponse,\n  ServerPresenceData,\n} from 'glov/common/types';\nimport { deepEqual } from 'glov/common/util';\nimport { cmd_parse } from './cmds';\nimport { ExternalUserInfo } from './external_user_info';\nimport * as input from './input';\nimport { netDisconnected, netSubs } from './net';\nimport * as sprites from './sprites';\nimport * as textures from './textures';\n\ndeclare let gl: WebGLRenderingContext | WebGL2RenderingContext;\n\nconst IDLE_TIME = 60000;\n\nlet friend_list: FriendsData | null = null;\n\nexport function friendsGet(): FriendsData {\n  return friend_list ?? Object.create(null);\n}\n\nexport function isFriend(user_id: string): boolean {\n  let value = friend_list?.[user_id];\n  return value?.status === FriendStatus.Added || value?.status === FriendStatus.AddedAuto;\n}\n\nexport function friendIsBlocked(user_id: string): boolean {\n  let value = friend_list?.[user_id];\n  return value?.status === FriendStatus.Blocked;\n}\n\nfunction makeFriendCmdRequest(cmd: string, user_id: string, cb: ErrorCallback<string>): void {\n  user_id = user_id.toLowerCase();\n  let requesting_user_id = netSubs().loggedIn();\n  if (netDisconnected()) {\n    return void cb('ERR_DISCONNECTED');\n  }\n  netSubs().getMyUserChannel().cmdParse(`${cmd} ${user_id}`, function (err: string, resp: FriendCmdResponse) {\n    if (err) {\n      return void cb(err);\n    } else if (requesting_user_id !== netSubs().loggedIn() || !friend_list) {\n      // Logged out or switched user meanwhile, so ignore the result\n      return void cb('Invalid data');\n    }\n\n    if (resp.friend) {\n      friend_list[user_id] = resp.friend;\n    } else {\n      delete friend_list[user_id];\n    }\n    cb(null, resp.msg);\n  });\n}\n\nexport function friendAdd(user_id: string, cb: ErrorCallback<string>): void {\n  makeFriendCmdRequest('friend_add', user_id, cb);\n}\nexport function friendRemove(user_id: string, cb: ErrorCallback<string>): void {\n  makeFriendCmdRequest('friend_remove', user_id, cb);\n}\nexport function friendBlock(user_id: string, cb: ErrorCallback<string>): void {\n  makeFriendCmdRequest('friend_block', user_id, cb);\n}\nexport function friendUnblock(user_id: string, cb: ErrorCallback<string>): void {\n  makeFriendCmdRequest('friend_unblock', user_id, cb);\n}\n\n// Pass-through commands\ncmd_parse.register({\n  cmd: 'friend_add',\n  help: 'Add a friend',\n  func: friendAdd,\n});\ncmd_parse.register({\n  cmd: 'friend_remove',\n  help: 'Remove a friend',\n  func: friendRemove,\n});\ncmd_parse.register({\n  cmd: 'friend_block',\n  help: 'Block someone from seeing your rich presence, also removes from your friends list',\n  func: friendBlock,\n});\ncmd_parse.register({\n  cmd: 'friend_unblock',\n  help: 'Reset a user to allow seeing your rich presence again',\n  func: friendUnblock,\n});\ncmd_parse.register({\n  cmd: 'friend_list',\n  help: 'List all friends',\n  func: function (str: string, resp_func: ErrorCallback<string>) {\n    if (!friend_list) {\n      return void resp_func('Friends list not loaded');\n    }\n    resp_func(null, Object.keys(friend_list).filter(isFriend).join(',') ||\n      'You have no friends');\n  },\n});\ncmd_parse.register({\n  cmd: 'friend_block_list',\n  help: 'List all blocked users',\n  func: function (str: string, resp_func: ErrorCallback<string>) {\n    if (!friend_list) {\n      return void resp_func('Friends list not loaded');\n    }\n    resp_func(null, Object.keys(friend_list).filter(friendIsBlocked).join(',') ||\n      'You have no blocked users');\n  },\n});\n\nlet invisible = 0;\ncmd_parse.registerValue('invisible', {\n  type: cmd_parse.TYPE_INT,\n  help: 'Hide rich presence information from other users',\n  label: 'Invisible',\n  range: [0,1],\n  get: () => invisible,\n  set: (v: number) => (invisible = v),\n});\n\nlet afk = 0;\ncmd_parse.registerValue('afk', {\n  type: cmd_parse.TYPE_INT,\n  help: 'Appear as idle to other users',\n  label: 'AFK',\n  range: [0,1],\n  get: () => afk,\n  set: (v: number) => (afk = v),\n});\n\nfunction onPresence(this: { presence_data?: ServerPresenceData }, data: ServerPresenceData): void {\n  let user_channel = this;\n  user_channel.presence_data = data;\n}\n\nlet last_presence: ClientPresenceData | null = null;\nlet send_queued = false;\nfunction richPresenceSend(): void {\n  if (!netSubs().loggedIn() || !last_presence || send_queued) {\n    return;\n  }\n  send_queued = true;\n  netSubs().onceConnected(() => {\n    send_queued = false;\n    if (!netSubs().loggedIn() || !last_presence) {\n      return;\n    }\n    let pak = netSubs().getMyUserChannel().pak('presence_set');\n    pak.writeInt(last_presence.active);\n    pak.writeAnsiString(last_presence.state);\n    pak.writeJSON(last_presence.payload);\n    pak.send();\n  });\n}\nexport function richPresenceSet(active: number, state: string, payload?: unknown): void {\n  active = !active || afk || (Date.now() - input.inputLastTime() > IDLE_TIME) ? PRESENCE_INACTIVE : PRESENCE_ACTIVE;\n  if (invisible) {\n    active = PRESENCE_OFFLINE;\n  }\n  payload = payload || null;\n  if (!last_presence ||\n    active !== last_presence.active || state !== last_presence.state ||\n    !deepEqual(last_presence.payload, payload)\n  ) {\n    last_presence = {\n      active,\n      state,\n      payload,\n    };\n    richPresenceSend();\n  }\n}\n\n/// Current user info by provider\nlet external_current_users: Record<string, ExternalUserInfo> = Object.create(null);\n/// Friends info by provider and user id\nlet external_friends: Record<string, Record<string, ExternalUserInfo>> = Object.create(null);\n\nexport function getExternalCurrentUserInfos(): Record<string, ExternalUserInfo> {\n  return external_current_users;\n}\n\nexport function getExternalFriendInfos(user_id: string): Record<string, ExternalUserInfo> | undefined {\n  return external_friends[user_id];\n}\n\nexport function getExternalUserInfos(user_id: string): Record<string, ExternalUserInfo> | undefined {\n  if (user_id === netSubs().loggedIn()) {\n    return getExternalCurrentUserInfos();\n  } else {\n    return getExternalFriendInfos(user_id);\n  }\n}\n\nfunction setExternalCurrentUser(provider: string, user_info: ExternalUserInfo): void {\n  if (user_info) {\n    external_current_users[provider] = user_info;\n  } else {\n    delete external_current_users[provider];\n  }\n}\n\nfunction updateExternalFriendsOnServer(provider: string, to_add: ExternalUserInfo[], to_remove: string[]): void {\n  if (to_add.length === 0 && to_remove.length === 0 || netDisconnected()) {\n    return;\n  }\n\n  let requesting_user_id = netSubs().loggedIn();\n  let pak = netSubs().getMyUserChannel().pak('friend_auto_update');\n  pak.writeAnsiString(provider);\n  for (let ii = 0; ii < to_add.length; ++ii) {\n    pak.writeAnsiString(to_add[ii].external_id);\n  }\n  pak.writeAnsiString('');\n  for (let ii = 0; ii < to_remove.length; ++ii) {\n    pak.writeAnsiString(to_remove[ii]);\n  }\n  pak.writeAnsiString('');\n  pak.send(function (err: string, resp: Record<string, FriendData>) {\n    if (requesting_user_id !== netSubs().loggedIn() || !friend_list) {\n      // Logged out or switched user meanwhile, so ignore the result\n      return;\n    } else if (err) {\n      // Unable to get external friends\n      return;\n    } else if (!resp) {\n      // Nothing to do\n      return;\n    }\n\n    // Add all new friends\n    let friends_external_to_user_ids: Record<string, string> = Object.create(null);\n    for (let user_id in resp) {\n      let friend = friend_list[user_id] = resp[user_id];\n      if (friend.ids) {\n        let external_id = friend.ids[provider];\n        friends_external_to_user_ids[external_id] = user_id;\n      }\n    }\n\n    // Map all the external friends by their corresponding user id\n    to_add.forEach((provider_friend) => {\n      let external_id = provider_friend.external_id;\n      let user_id = friends_external_to_user_ids[external_id];\n      if (user_id) {\n        let external_friend_infos = external_friends[user_id];\n        if (!external_friend_infos) {\n          external_friend_infos = external_friends[user_id] = Object.create(null);\n        }\n        external_friend_infos[provider] = provider_friend;\n      }\n    });\n  });\n}\n\nfunction setExternalFriends(provider: string, provider_friends: ExternalUserInfo[]): void {\n  let friends_external_to_user_ids: Record<string, string> = Object.create(null);\n  for (let user_id in friend_list) {\n    let friend = friend_list[user_id];\n    let external_id = friend.ids?.[provider];\n    if (external_id) {\n      friends_external_to_user_ids[external_id] = user_id;\n    }\n  }\n\n  // Delete all existing infos for this provider\n  for (let user_id in external_friends) {\n    delete external_friends[user_id][provider];\n  }\n\n  let to_add: ExternalUserInfo[] = [];\n  provider_friends.forEach((provider_friend) => {\n    let external_id = provider_friend.external_id;\n    let user_id = friends_external_to_user_ids[external_id];\n    if (user_id) {\n      let external_friend_infos = external_friends[user_id];\n      if (!external_friend_infos) {\n        external_friend_infos = external_friends[user_id] = Object.create(null);\n      }\n      external_friend_infos[provider] = provider_friend;\n      // Delete it, so that in the end the only ones left are the ones that need to be removed\n      delete friends_external_to_user_ids[external_id];\n    } else {\n      // New friend, needs to be added\n      to_add.push(provider_friend);\n    }\n  });\n\n  // The only ones left are the ones that need to be removed\n  let to_remove: string[] = [];\n  for (let external_id in friends_external_to_user_ids) {\n    to_remove.push(external_id);\n  }\n\n  if (to_add.length !== 0 || to_remove.length !== 0) {\n    updateExternalFriendsOnServer(provider, to_add, to_remove);\n  }\n}\n\nfunction requestExternalCurrentUser(provider: string,\n  request_func: (cb: ErrorCallback<ExternalUserInfo>) => void): void {\n  let requesting_user_id = netSubs().loggedIn();\n  request_func((err, user_info) => {\n    if (requesting_user_id !== netSubs().loggedIn()) {\n      // Logged out or switched user meanwhile, so ignore the result\n      return;\n    } else if (err || !user_info) {\n      // Unable to get external current user\n      return;\n    }\n\n    setExternalCurrentUser(provider, user_info);\n  });\n}\n\nfunction requestExternalFriends(provider: string,\n  request_func: (cb: ErrorCallback<ExternalUserInfo[]>) => void): void {\n  let requesting_user_id = netSubs().loggedIn();\n  request_func((err, friends) => {\n    if (requesting_user_id !== netSubs().loggedIn() || !friend_list) {\n      // Logged out or switched user meanwhile, so ignore the result\n      return;\n    } else if (err || !friends) {\n      // Unable to get external friends\n      return;\n    }\n\n    setExternalFriends(provider, friends);\n  });\n}\n\nlet profile_images: Record<string, unknown> = {};\nlet default_profile_image: unknown = null;\nexport function getUserProfileImage(user_id: string): unknown {\n  let image = profile_images[user_id];\n  if (image) {\n    return image;\n  }\n\n  let url = null;\n  if (PLATFORM_FBINSTANT) {\n    url = getExternalUserInfos(user_id)?.[ID_PROVIDER_FB_INSTANT]?.profile_picture_url;\n  } else {\n    url = getExternalUserInfos(user_id)?.[ID_PROVIDER_FB_GAMING]?.profile_picture_url;\n  }\n\n  if (url) {\n    let tex = textures.load({\n      url: url,\n      filter_min: gl.LINEAR_MIPMAP_LINEAR,\n      filter_mag: gl.LINEAR,\n      soft_error: true,\n      auto_unload: () => delete profile_images[user_id],\n    });\n    if (tex && tex.loaded) {\n      image = profile_images[user_id] = {\n        img: sprites.create({ tex }),\n      };\n      return image;\n    }\n  }\n\n  return default_profile_image;\n}\n\nexport function setDefaultUserProfileImage(image: unknown): void {\n  default_profile_image = image;\n}\n\nlet external_user_info_providers = Object.create(null);\nexport function registerExternalUserInfoProvider(\n  provider: string,\n  get_current_user: ((cb: ErrorCallback<ExternalUserInfo>) => void) | null,\n  get_friends: ((cb: ErrorCallback<ExternalUserInfo[]>) => void) | null,\n): void {\n  if (get_current_user || get_friends) {\n    assert(!friend_list);\n    assert(!netSubs()?.loggedIn());\n\n    external_user_info_providers[provider] = { get_current_user, get_friends };\n  } else {\n    delete external_user_info_providers[provider];\n  }\n}\n\n// Init\nexport function socialInit(): void {\n  netSubs().on('login', function () {\n    let user_channel = netSubs().getMyUserChannel();\n    let user_id = netSubs().loggedIn();\n    richPresenceSend();\n    friend_list = null;\n    if (netDisconnected()) {\n      return;\n    }\n    user_channel.pak('friend_list').send((err: unknown, resp: FriendsData) => {\n      if (err || user_id !== netSubs().loggedIn()) {\n        // disconnected, etc\n        return;\n      }\n      friend_list = resp;\n\n      // Sync friend list with external providers' friends\n      for (const provider in external_user_info_providers) {\n        let { get_current_user, get_friends } = external_user_info_providers[provider];\n        if (get_current_user) {\n          requestExternalCurrentUser(provider, get_current_user);\n        }\n        if (get_friends) {\n          requestExternalFriends(provider, get_friends);\n        }\n      }\n    });\n  });\n  netSubs().on('logout', function () {\n    friend_list = null;\n    external_current_users = Object.create(null);\n    external_friends = Object.create(null);\n  });\n\n  netSubs().onChannelMsg('user', 'presence', onPresence);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nexport const FADE_DEFAULT = 0;\nexport const FADE_OUT = 1;\nexport const FADE_IN = 2;\nexport const FADE = FADE_OUT + FADE_IN;\n\nimport assert from 'assert';\nimport { ErrorCallback } from 'glov/common/types';\nimport { callEach, defaults, ridx } from 'glov/common/util';\nimport { is_firefox } from './browser';\nimport { cmd_parse } from './cmds';\nimport { fbInstantOnPause } from './fbinstant';\nimport { filewatchOn } from './filewatch';\nimport * as urlhash from './urlhash';\n\nconst { Howl, Howler } = require('@jimbly/howler/src/howler.core.js');\n// TODO: Replace with \"import * as settings\" and replace settings.x with settings.get('x')\nconst settings = require('./settings');\nconst { abs, floor, max, min, random } = Math;\n\nconst DEFAULT_FADE_RATE = 0.001;\n\ninterface SoundLoadOpts {\n  streaming?: boolean;\n  for_reload?: boolean;\n  loop?: boolean;\n}\n\n// Workaround to have interface to Howl object available (alongside glov_load_opts).\ninterface HowlSound {\n  glov_load_opts: SoundLoadOpts;\n  play: (sprite?: string | number, volume?: number) => number;\n  stop: (id?: number) => HowlSound;\n  volume: (vol?: number, id?: number) => void;\n  seek: (seek?: number, id?: number) => HowlSound | number;\n  playing: (id?: number) => boolean;\n  duration: (id?: number) => number;\n}\n\ninterface GlovSound { // Sound wrapper returned by soundPlay to external code\n  stop: (id: number) => HowlSound;\n  volume: (vol: number) => void;\n  playing: (id?: number) => boolean;\n  duration: (id: number) => number;\n  location: () => number;\n  fadeOut: (time: number) => void;\n}\n\ninterface GlovMusic {\n  sound: HowlSound | null;\n  id: number;\n  current_volume: number;\n  target_volume: number;\n  sys_volume: number;\n  need_play: boolean;\n}\n\ninterface Fade {\n  sound: HowlSound;\n  id: number;\n  time: number;\n  volume: number;\n  settingsVolume: () => number;\n}\n\nlet sounds : Record<string, HowlSound> = {};\nlet active_sfx_as_music: {\n  sound: GlovSound;\n  play_volume: number;\n  set_volume_when_played: number;\n}[] = [];\nlet num_loading = 0;\n\n// Howler.usingWebAudio = false; // Disable WebAudio for testing HTML5 fallbacks\n\nconst default_params = {\n  // Note: as of Firefox v71 (2019), all major browsers support MP3\n  ext_list: ['mp3', 'wav'], // (recommended) try loading .mp3 versions first, then fallback to .wav\n  //  also covers all browsers: ['webm', 'mp3']\n  fade_rate: DEFAULT_FADE_RATE,\n};\nlet sound_params: {\n  ext_list: string[];\n  fade_rate: number;\n};\n\nlet last_played : Record<string, number> = {};\nlet frame_timestamp = 0;\nlet fades : Fade[] = [];\nlet music : GlovMusic[];\n\nlet volume_override = 1;\nlet volume_override_target = 1;\n\nsettings.register({\n  volume: {\n    default_value: 1,\n    type: cmd_parse.TYPE_FLOAT,\n    range: [0,1],\n  },\n});\n\nsettings.register({\n  volume_music: {\n    default_value: 1,\n    type: cmd_parse.TYPE_FLOAT,\n    range: [0,1],\n  },\n});\n\nsettings.register({\n  volume_sound: {\n    default_value: 1,\n    type: cmd_parse.TYPE_FLOAT,\n    range: [0,1],\n  },\n});\n\nsettings.register({\n  sound: {\n    default_value: 1,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n  },\n});\n\nsettings.register({\n  music: {\n    default_value: 1,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n  },\n});\n\nfunction musicVolume() {\n  return settings.volume * settings.volume_music;\n}\n\nfunction soundVolume() {\n  return settings.volume * settings.volume_sound;\n}\n\nlet sounds_loading : Record<string, ErrorCallback<never, string>[]> = {};\nlet on_load_fail: (base: string) => void;\nexport function soundOnLoadFail(cb: (base: string) => void): void {\n  on_load_fail = cb;\n}\n\nexport type SoundID = string | { file: string; volume: number };\n\nexport function soundLoad(soundid: SoundID | SoundID[], opts: SoundLoadOpts, cb?: ErrorCallback<never, string>): void {\n  opts = opts || {};\n  if (opts.streaming && is_firefox) {\n    // TODO: Figure out workaround and fix!\n    //   On slow connections, sounds set to streaming sometimes never load on Firefox,\n    //   possibly related to preload options or something ('preload=meta' not guaranteed to fire 'canplay')\n    opts.streaming = false;\n  }\n  if (Array.isArray(soundid)) {\n    assert(!cb);\n    for (let ii = 0; ii < soundid.length; ++ii) {\n      soundLoad(soundid[ii], opts);\n    }\n    return;\n  }\n  let key = typeof soundid === 'string' ? soundid : soundid.file;\n  if (sounds[key]) {\n    if (cb) {\n      cb();\n    }\n    return;\n  }\n  if (sounds_loading[key]) {\n    if (cb) {\n      sounds_loading[key].push(cb);\n    }\n    return;\n  }\n  let cbs : ErrorCallback<never, string>[] = [];\n  if (cb) {\n    cbs.push(cb);\n  }\n  sounds_loading[key] = cbs;\n  let soundname = key;\n  let m = soundname.match(/^(.*)\\.(mp3|ogg|wav|webm)$/u);\n  let preferred_ext;\n  if (m) {\n    soundname = m[1];\n    preferred_ext = m[2];\n  }\n  let src = `sounds/${soundname}`;\n  let srcs : string[] = [];\n  let suffix = '';\n  if (opts.for_reload) {\n    suffix = `?rl=${Date.now()}`;\n  }\n  if (preferred_ext) {\n    srcs.push(`${urlhash.getURLBase()}${src}.${preferred_ext}${suffix}`);\n  }\n  for (let ii = 0; ii < sound_params.ext_list.length; ++ii) {\n    let ext = sound_params.ext_list[ii];\n    if (ext !== preferred_ext) {\n      srcs.push(`${urlhash.getURLBase()}${src}.${ext}${suffix}`);\n    }\n  }\n  // Try loading desired sound types one at a time.\n  // Cannot rely on Howler's built-in support for this because it only continues\n  //   through the list on *some* load errors, not all :(.\n  function tryLoad(idx: number) {\n    if (idx === srcs.length) {\n      console.error(`Error loading sound ${soundname}: All fallbacks exhausted, giving up`);\n      if (on_load_fail) {\n        on_load_fail(soundname);\n      }\n      callEach(cbs, delete sounds_loading[key], 'Error loading sound');\n      return;\n    }\n    if (!opts.streaming) {\n      ++num_loading;\n    }\n    let once = false;\n    let sound = new Howl({\n      src: srcs.slice(idx),\n      html5: Boolean(opts.streaming),\n      loop: Boolean(opts.loop),\n      volume: 0,\n      onload: function () {\n        if (!once) {\n          if (!opts.streaming) {\n            --num_loading;\n          }\n          once = true;\n          sound.glov_load_opts = opts;\n          sounds[key] = sound;\n          callEach(cbs, delete sounds_loading[key], null);\n        }\n      },\n      onloaderror: function (id: unknown, err: string, extra: unknown) {\n        if (idx === srcs.length - 1) {\n          console.error(`Error loading sound ${srcs[idx]}: ${err}`);\n        } else {\n          console.log(`Error loading sound ${srcs[idx]}: ${err}, trying fallback...`);\n        }\n        if (!once) {\n          if (!opts.streaming) {\n            --num_loading;\n          }\n          once = true;\n          tryLoad(idx + 1);\n        }\n      },\n    });\n  }\n  tryLoad(0);\n}\n\nfunction soundReload(filename: string) {\n  let name_match = filename.match(/^sounds\\/([^.]+)\\.\\w+$/);\n  let sound_name = name_match && name_match[1];\n  if (!sound_name) {\n    return;\n  }\n  if (!sounds[sound_name]) {\n    console.log(`Reload trigged for non-existent sound: ${filename}`);\n    return;\n  }\n  let opts = sounds[sound_name].glov_load_opts;\n  opts.for_reload = true;\n  delete sounds[sound_name];\n  soundLoad(sound_name, opts);\n}\n\nexport function soundPause(): void {\n  volume_override = volume_override_target = 0;\n  // Immediately mute all the music\n  // Can't do a nice fade out here because we stop getting ticked when we're not in the foreground\n  soundTick(0); // eslint-disable-line no-use-before-define\n}\n\nexport function soundResume(): void {\n  volume_override_target = 1;\n\n  // Actual context resuming handled internally by Howler, except for gamepad\n  //   which calls soundResume, so let's poke howler to unlock.\n  Howler.manualUnlock();\n}\n\nexport function soundStartup(params: { ext_list?: string[]; fade_rate?: number }): void {\n  sound_params = defaults(params || {}, default_params);\n\n  // Music\n  music = []; // 0 is current, 1 is previous (fading out)\n  for (let ii = 0; ii < 2; ++ii) {\n    music.push({\n      sound: null,\n      id: 0,\n      current_volume: 0,\n      target_volume: 0,\n      sys_volume: 0,\n      need_play: false,\n    });\n  }\n  filewatchOn('.mp3', soundReload);\n  filewatchOn('.ogg', soundReload);\n  filewatchOn('.wav', soundReload);\n  filewatchOn('.webm', soundReload);\n\n  fbInstantOnPause(soundPause);\n}\n\nexport function soundResumed(): boolean {\n  return !Howler.noAudio && Howler.safeToPlay;\n}\n\nexport function soundTick(dt: number): void {\n  frame_timestamp += dt;\n  if (volume_override !== volume_override_target) {\n    let delta = dt * 0.004;\n    if (volume_override < volume_override_target) {\n      volume_override = min(volume_override + delta, volume_override_target);\n    } else {\n      volume_override = max(volume_override - delta, volume_override_target);\n    }\n  }\n  if (!soundResumed()) {\n    return;\n  }\n  for (let i = 0; i < active_sfx_as_music.length; ++i) {\n    let { sound, play_volume, set_volume_when_played } = active_sfx_as_music[i];\n    if (!sound.playing()) {\n      ridx(active_sfx_as_music, i);\n    } else if (set_volume_when_played !== musicVolume()) {\n      sound.volume(play_volume);\n      active_sfx_as_music[i].set_volume_when_played = musicVolume();\n    }\n  }\n  // Do music fading\n  // Cannot rely on Howler's fading because starting a fade when one is in progress\n  //   messes things up, as well causes snaps in volume :(\n  let max_fade = dt * sound_params.fade_rate;\n  for (let ii = 0; ii < music.length; ++ii) {\n    let mus = music[ii];\n    if (!mus.sound) {\n      continue;\n    }\n    let target = settings.music ? mus.target_volume : 0;\n    if (mus.current_volume !== target) {\n      let delta = target - mus.current_volume;\n      let fade_amt = min(abs(delta), max_fade);\n      if (delta < 0) {\n        mus.current_volume = max(target, mus.current_volume - fade_amt);\n      } else {\n        mus.current_volume = min(target, mus.current_volume + fade_amt);\n      }\n      if (!mus.target_volume && !mus.current_volume) {\n        if (!mus.need_play) {\n          mus.sound.stop(mus.id);\n        }\n        mus.sound = null;\n      }\n    }\n    if (mus.sound) {\n      let sys_volume = mus.current_volume * musicVolume() * volume_override;\n      if (mus.need_play) {\n        mus.need_play= false;\n        mus.id = mus.sound.play();\n        mus.sys_volume = -1;\n      }\n      if (mus.sys_volume !== sys_volume) {\n        mus.sound.volume(sys_volume, mus.id);\n        mus.sys_volume = sys_volume;\n      }\n    }\n  }\n\n  for (let ii = fades.length - 1; ii >= 0; --ii) {\n    let fade = fades[ii];\n    let fade_amt = fade.time ? dt / fade.time : max_fade;\n    fade.volume = max(0, fade.volume - fade_amt);\n    fade.sound.volume(fade.volume * fade.settingsVolume() * volume_override, fade.id);\n    if (!fade.volume) {\n      fade.sound.stop(fade.id);\n      ridx(fades, ii);\n    }\n  }\n}\n\nexport function soundPlay(soundid: SoundID, volume_in?: number, as_music?: boolean): GlovSound | null {\n  let volume = volume_in || 1;\n  if (!as_music && !settings.sound || as_music && !settings.music) {\n    return null;\n  }\n  if (!soundResumed()) {\n    return null;\n  }\n  if (Array.isArray(soundid)) {\n    soundid = soundid[floor(random() * soundid.length)];\n  }\n  if (typeof soundid === 'object') {\n    volume *= (soundid.volume || 1);\n    soundid = soundid.file;\n  }\n  let sound = sounds[soundid];\n  if (!sound) {\n    return null;\n  }\n  let last_played_time = last_played[soundid] || -9e9;\n  if (frame_timestamp - last_played_time < 45) {\n    return null;\n  }\n  let settingsVolume = as_music ? musicVolume : soundVolume;\n  let id = sound.play(undefined, volume * settingsVolume() * volume_override);\n  // sound.volume(volume * settingsVolume() * volume_override, id);\n  last_played[soundid] = frame_timestamp;\n  let played_sound = {\n    stop: sound.stop.bind(sound, id),\n    playing: sound.playing.bind(sound, id), // not reliable if it hasn't started yet? :(\n    location: () => { // get current location\n      let v = sound.seek(id);\n      if (typeof v !== 'number') {\n        // Howler sometimes returns `self` from `seek()`\n        return 0;\n      }\n      return v;\n    },\n    duration: sound.duration.bind(sound, id),\n    volume: (vol: number) => {\n      sound.volume(vol * settingsVolume() * volume_override, id);\n    },\n    fadeOut: (time: number) => {\n      fades.push({\n        volume,\n        sound,\n        id,\n        time,\n        settingsVolume,\n      });\n    },\n  };\n  if (as_music) {\n    active_sfx_as_music.push({\n      sound: played_sound,\n      play_volume: volume,\n      set_volume_when_played: musicVolume(),\n    });\n  }\n  return played_sound;\n}\n\nexport function soundPlayStreaming(soundname: string, volume: number): void {\n  if (!settings.sound) {\n    return;\n  }\n  if (Array.isArray(soundname)) {\n    soundname = soundname[floor(random() * soundname.length)];\n  }\n  soundLoad(soundname, { streaming: true, loop: false }, (err) => {\n    if (!err) {\n      soundPlay(soundname, volume);\n    }\n  });\n}\n\nexport function soundPlayMusic(soundname: string, volume: number, transition: number): void {\n  if (!settings.music) {\n    return;\n  }\n  if (volume === undefined) {\n    volume = 1;\n  }\n  transition = transition || FADE_DEFAULT;\n  soundLoad(soundname, { streaming: true, loop: true }, (err) => {\n    assert(!err);\n    let sound = sounds[soundname];\n    assert(sound);\n    if (music[0].sound === sound) {\n      // Same sound, just adjust volume, if required\n      music[0].target_volume = volume;\n      if (!transition) {\n        if (!volume) {\n          sound.stop(music[0].id);\n          music[0].sound = null;\n        } else {\n          let sys_volume = music[0].sys_volume = volume * musicVolume() * volume_override;\n          sound.volume(sys_volume, music[0].id);\n          if (!sound.playing()) {\n            sound.play(undefined, sys_volume);\n          }\n        }\n      }\n      return;\n    }\n    // fade out previous music, if any\n    if (music[0].current_volume) {\n      if (transition & FADE_OUT) {\n        // swap to position 1, start fadeout\n        let temp = music[1];\n        music[1] = music[0];\n        music[0] = temp;\n        music[1].target_volume = 0;\n      }\n    }\n    if (music[0].sound) {\n      music[0].sound.stop(music[0].id);\n    }\n    music[0].sound = sound;\n    music[0].target_volume = volume;\n    let start_vol = (transition & FADE_IN) ? 0 : volume;\n    music[0].current_volume = start_vol;\n    if (soundResumed()) {\n      let sys_volume = start_vol * musicVolume() * volume_override;\n      music[0].id = sound.play(undefined, sys_volume);\n      // sound.volume(sys_volume, music[0].id);\n      music[0].sys_volume = sys_volume;\n      music[0].need_play = false;\n    } else {\n      music[0].need_play = true;\n    }\n  });\n}\n\nexport function soundLoading(): number {\n  return num_loading;\n}\n","// Portions Copyright 2022 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/**\n * Support for handling Spine animations.\n *\n * Note: Requires a Spine license to use in any product.\n */\n\nimport * as assert from 'assert';\nimport {\n  BLEND_ADDITIVE,\n  BLEND_ALPHA,\n  queueSpriteData,\n  spriteDataAlloc,\n} from 'glov/client/sprites.js';\n\nimport { AnimationState } from 'spine-core/AnimationState';\nimport { AnimationStateData } from 'spine-core/AnimationStateData';\nimport { AtlasAttachmentLoader } from 'spine-core/AtlasAttachmentLoader';\nimport { ClippingAttachment } from 'spine-core/ClippingAttachment';\nimport { MeshAttachment } from 'spine-core/MeshAttachment';\nimport { RegionAttachment } from 'spine-core/RegionAttachment';\nimport { Skeleton } from 'spine-core/Skeleton';\nimport { SkeletonBinary } from 'spine-core/SkeletonBinary';\n// import { SkeletonJson } from 'spine-core/SkeletonJson';\nimport { BlendMode } from 'spine-core/SlotData';\nimport { TextureAtlas } from 'spine-core/TextureAtlas';\nimport { Color, Vector2 } from 'spine-core/Utils';\n\nimport { textureLoad } from './textures.js';\nimport { webFSGetFile } from './webfs.js';\n\nfunction SpineTexture(texture) {\n  this.texture = texture;\n  this.texs = [this.texture];\n}\nSpineTexture.prototype.setFilters = function (filter_min, filter_mag) {\n  this.texture.setSamplerState({\n    filter_min,\n    filter_mag,\n    wrap_s: gl.CLAMP_TO_EDGE,\n    wrap_t: gl.CLAMP_TO_EDGE,\n  });\n};\nSpineTexture.prototype.setWraps = function (wrap_s, wrap_t) {\n  assert.equal(this.texture.wrap_s, wrap_s);\n  assert.equal(this.texture.wrap_t, wrap_t);\n};\nSpineTexture.prototype.getImage = function () {\n  assert(false);\n  return { width: this.width, height: this.height };\n};\n\nlet atlases = {};\nfunction spineLoadAtlas(filename) {\n  if (atlases[filename]) {\n    return atlases[filename];\n  }\n  let atlas_text = webFSGetFile(filename, 'text');\n  let parent = filename.match(/(.*\\/)[^/]+/)[1];\n\n  let atlas;\n  try {\n    atlases[filename] = atlas = new TextureAtlas(atlas_text);\n  } catch (e) {\n    throw new Error(`Couldn't parse texture atlas ${filename}: ${e.message}`);\n  }\n  for (let ii = 0; ii < atlas.pages.length; ++ii) {\n    let page = atlas.pages[ii];\n\n    page.setTexture(new SpineTexture(textureLoad({\n      url: `${parent}${page.name}`,\n      wrap_s: gl.CLAMP_TO_EDGE,\n      wrap_t: gl.CLAMP_TO_EDGE,\n    })));\n  }\n  return (atlases[filename] = atlas);\n}\n\nlet skeletons = {};\nfunction spineLoadSkeleton(atlas, params) {\n  let { skel: filename, mix } = params;\n  if (skeletons[filename]) {\n    return skeletons[filename];\n  }\n  let atlas_loader = new AtlasAttachmentLoader(atlas);\n  let is_json = filename.endsWith('.json');\n  let skeleton_data;\n  if (is_json) {\n    assert(false);\n    // let skeleton_json = new SkeletonJson(atlas_loader);\n    // skeleton_json.scale = 1;\n    // skeleton_data = skeleton_json.readSkeletonData(webFSGetFile(filename.slice(0, -'.json'.length), 'jsobj'));\n  } else {\n    let skeleton_binary = new SkeletonBinary(atlas_loader);\n    skeleton_binary.scale = 1;\n    skeleton_data = skeleton_binary.readSkeletonData(webFSGetFile(filename, 'binary'));\n  }\n  let skeleton = new Skeleton(skeleton_data);\n  let animation_state_data = new AnimationStateData(skeleton_data);\n  for (let from in mix) {\n    let map = mix[from];\n    for (let to in map) {\n      let v = map[to];\n      animation_state_data.setMix(from, to, v);\n      if (!mix[to] || mix[to][from] === undefined) {\n        animation_state_data.setMix(to, from, v);\n      }\n    }\n  }\n  return (skeletons[filename] = { skeleton, animation_state_data });\n}\n\nlet tempPos = new Vector2();\nlet tempUv = new Vector2();\nlet tempLight = new Color();\nlet tempDark = new Color();\nlet finalColor = new Color();\nlet tempColor2 = new Color();\n\nfunction Spine(params) {\n  let {\n    anim,\n  } = params;\n  let atlas = spineLoadAtlas(params.atlas);\n  let { skeleton, animation_state_data } = spineLoadSkeleton(atlas, params);\n  this.skeleton = skeleton;\n\n  this.animation_state = new AnimationState(animation_state_data);\n  this.vertices = new Float32Array(1024);\n  if (anim) {\n    this.setAnimation(0, anim, true);\n  }\n}\nSpine.prototype.getAnimation = function (track_index) {\n  track_index = track_index || 0;\n  let cur = this.animation_state.getCurrent(track_index);\n  return cur && cur.animation && cur.animation.name || null;\n};\nSpine.prototype.setAnimation = function (track_index, name, loop) {\n  let cur = this.animation_state.getCurrent(track_index);\n  if (cur && cur.animation && cur.animation.name === name) {\n    return;\n  }\n  this.animation_state.setAnimation(track_index, name, loop);\n};\nSpine.prototype.update = function (dt) {\n  this.animation_state.update(dt/1000);\n  this.animation_state.apply(this.skeleton);\n  this.skeleton.updateWorldTransform();\n};\nlet match_a = [-1,-1,-1];\nlet match_b = [0,0,0];\nconst QUAD_TRIANGLES = [0, 1, 2, 2, 3, 0];\nconst ZINC = 0.001;\nSpine.prototype.draw = function (param) {\n  let { x, y, z, scale } = param;\n  if (scale === undefined) {\n    scale = 1;\n  }\n  let { skeleton, vertices } = this;\n  let drawOrder = skeleton.drawOrder;\n  let skeletonColor = skeleton.color;\n\n  const vertexSize = 2; // just 2 floats, x,y?\n  const clippedVertexSize = vertexSize;\n  const premultipliedAlpha = false;\n\n  let texture;\n  let uvs;\n  let blend;\n  let lookup = [];\n  function doQuad(v0, v1, v2, v3) {\n    lookup[0] = v0;\n    lookup[1] = v1;\n    lookup[2] = v2;\n    lookup[3] = v3;\n    let sprite = spriteDataAlloc(texture.texs, null, null, blend);\n    let buf = sprite.data;\n    for (let corner = 0, vout = 0; corner < 4; corner++) {\n      let vin = lookup[corner] * 2;\n      buf[vout++] = x + vertices[vin] * scale;\n      buf[vout++] = y - vertices[vin+1] * scale;\n      buf[vout++] = finalColor.r;\n      buf[vout++] = finalColor.g;\n      buf[vout++] = finalColor.b;\n      buf[vout++] = finalColor.a;\n      buf[vout++] = uvs[vin];\n      buf[vout++] = uvs[vin + 1];\n    }\n    queueSpriteData(sprite, z);\n    z += ZINC;\n  }\n\n  for (let i = 0; i < drawOrder.length; i++) {\n    let slot = drawOrder[i];\n    if (!slot.bone.active) {\n      continue;\n    }\n\n    let attachment = slot.getAttachment();\n    let numVertices;\n    let triangles;\n    let attachmentColor;\n    if (attachment instanceof RegionAttachment) {\n      let region = attachment;\n      numVertices = 4;\n      region.computeWorldVertices(slot.bone, vertices, 0, clippedVertexSize);\n      triangles = QUAD_TRIANGLES;\n      uvs = region.uvs;\n      texture = region.region.renderObject.page.texture;\n      attachmentColor = region.color;\n    } else if (attachment instanceof MeshAttachment) {\n      let mesh = attachment;\n      numVertices = (mesh.worldVerticesLength >> 1);\n      let numFloats = numVertices * clippedVertexSize;\n      if (numFloats > vertices.length) {\n        vertices = this.vertices = new Float32Array(numFloats);\n      }\n      mesh.computeWorldVertices(slot, 0, mesh.worldVerticesLength, vertices, 0, clippedVertexSize);\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      triangles = mesh.triangles;\n      texture = mesh.region.renderObject.page.texture;\n      uvs = mesh.uvs;\n      attachmentColor = mesh.color;\n    } else if (attachment instanceof ClippingAttachment) {\n      // let clip = attachment;\n      // clipper.clipStart(slot, clip);\n      continue;\n    } else {\n      // clipper.clipEndWithSlot(slot);\n      continue;\n    }\n\n    if (!texture) {\n      // clipper.clipEndWithSlot(slot)\n      continue;\n    }\n\n    let slotColor = slot.color;\n    finalColor.r = skeletonColor.r * slotColor.r * attachmentColor.r;\n    finalColor.g = skeletonColor.g * slotColor.g * attachmentColor.g;\n    finalColor.b = skeletonColor.b * slotColor.b * attachmentColor.b;\n    finalColor.a = skeletonColor.a * slotColor.a * attachmentColor.a;\n    if (premultipliedAlpha) {\n      finalColor.r *= finalColor.a;\n      finalColor.g *= finalColor.a;\n      finalColor.b *= finalColor.a;\n    }\n    let darkColor = tempColor2;\n    if (!slot.darkColor) {\n      darkColor.set(0, 0, 0, 1.0);\n    } else {\n      if (premultipliedAlpha) {\n        darkColor.r = slot.darkColor.r * finalColor.a;\n        darkColor.g = slot.darkColor.g * finalColor.a;\n        darkColor.b = slot.darkColor.b * finalColor.a;\n      } else {\n        darkColor.setFromColor(slot.darkColor);\n      }\n      darkColor.a = premultipliedAlpha ? 1.0 : 0.0;\n    }\n\n    let slotBlendMode = slot.data.blendMode;\n    blend = BLEND_ALPHA;\n    if (slotBlendMode === BlendMode.Additive) { // Others are: Normal, Multiply, Screen\n      blend = BLEND_ADDITIVE;\n    }\n\n    // if (clipper.isClipping()) {\n    //   // clipper.clipTriangles(renderable.vertices, renderable.numFloats, triangles,\n    //   //    triangles.length, uvs, finalColor, darkColor, twoColorTint);\n    //   // TODO\n    // } else\n    {\n      let verts = vertices;\n      if (this.vertexEffect) {\n        let vertexEffect = this.vertexEffect;\n        for (let /*vout=0, */v = 0; v < numVertices*2; v+=2) {\n          tempPos.x = verts[v];\n          tempPos.y = verts[v + 1];\n          tempUv.x = uvs[v];\n          tempUv.y = uvs[v + 1];\n          tempLight.setFromColor(finalColor);\n          tempDark.set(0, 0, 0, 0);\n          vertexEffect.transform(tempPos, tempUv, tempLight, tempDark);\n          // TODO: output\n          // verts[vout++] = tempPos.x;\n          // verts[vout++] = tempPos.y;\n          // verts[vout++] = tempLight.r;\n          // verts[vout++] = tempLight.g;\n          // verts[vout++] = tempLight.b;\n          // verts[vout++] = tempLight.a;\n          // verts[vout++] = tempUv.x;\n          // verts[vout++] = tempUv.y;\n          assert(false, 'Not yet implemented'); // would be similar to below\n        }\n      } else {\n        if (numVertices === 4) {\n          // assume quad\n          let sprite = spriteDataAlloc(texture.texs, null, null, blend);\n          let buf = sprite.data;\n          for (let vin = 0, vout = 0; vin < numVertices*2; vin += 2) {\n            buf[vout++] = x + verts[vin] * scale;\n            buf[vout++] = y - verts[vin+1] * scale;\n            buf[vout++] = finalColor.r;\n            buf[vout++] = finalColor.g;\n            buf[vout++] = finalColor.b;\n            buf[vout++] = finalColor.a;\n            buf[vout++] = uvs[vin];\n            buf[vout++] = uvs[vin + 1];\n          }\n          queueSpriteData(sprite, z);\n          z += ZINC;\n        } else {\n          // translate to quads\n          for (let tri_idx = 0; tri_idx < triangles.length;) {\n            match_b[0] = match_b[1] = match_b[2] = 0;\n            let ti_b = tri_idx + 3;\n            let num_match = 0;\n            for (let ii = 0; ii < 3; ++ii) {\n              match_a[ii] = -1;\n              for (let jj = 0; jj < 3; ++jj) {\n                if (triangles[tri_idx + ii] === triangles[ti_b + jj]) {\n                  ++num_match;\n                  match_a[ii] = jj;\n                  match_b[jj] = 1;\n                  break;\n                }\n              }\n            }\n            if (num_match === 2) {\n              // can do as a quad\n              let unmatchedA = match_a[0] === -1 ? 0 : match_a[1] === -1 ? 1 : 2;\n              let unmatchedB = match_b[0] ? match_b[1] ? 2 : 1 : 0;\n              doQuad(triangles[tri_idx + unmatchedA], triangles[tri_idx + (unmatchedA+1)%3],\n                triangles[ti_b + unmatchedB], triangles[tri_idx + (unmatchedA+2)%3]);\n              tri_idx += 6;\n            } else {\n              // Fake as triangle\n              doQuad(triangles[tri_idx], triangles[tri_idx + 1], triangles[tri_idx + 1], triangles[tri_idx + 2]);\n              tri_idx += 3;\n            }\n          }\n        }\n      }\n      // draw indexed w/ texture, verts, triangles\n    }\n    // clipper.clipEndWithSlot(slot);\n  }\n  // clipper.clipEnd();\n};\n\nexport function spineCreate(params) {\n  return new Spine(params);\n}\n","export const SPOT_NAV_NONE = 0;\nexport const SPOT_NAV_LEFT = 1;\nexport const SPOT_NAV_UP = 2;\nexport const SPOT_NAV_RIGHT = 3;\nexport const SPOT_NAV_DOWN = 4;\nexport const SPOT_NAV_NEXT = 5;\nexport const SPOT_NAV_PREV = 6;\nconst SPOT_NAV_MAX = 7;\n\nexport const BUTTON_ANY = -2; // same as input.ANY\n\nexport const SPOT_DEFAULT = {\n  key: undefined, // string | undefined (defaults to from x,y otherwise)\n  disabled: false, // boolean\n  tooltip: null, // string | LocalizableString\n  in_event_cb: null, // for clicks and key presses\n  drag_target: false, // receive dragDrop events\n  drag_over: false, // consume dragOver events\n  button: BUTTON_ANY, // respond to which mouse button\n  is_button: false, // can be activated/clicked/etc\n  button_long_press: false, // detect long press differently than a regular click/tap\n  pad_focusable: true, // is a target for keyboard/gamepad focus; set to false if only accessible via hotkey/button\n  spatial_focus: true, // if pad_focusable: can be focused spatialy (via d-pad/etc), otherwise only through tab\n  auto_focus: false, // if this spot is new this frame, and doing pad (not mouse/touch) focusing, automatically focus it\n  long_press_focuses: true, // a long press will focus an element (triggering tooltips, etc, on touch devices)\n  sound_button: 'button_click', // string // when activated\n  sound_rollover: 'rollover', // string | null // when mouse movement triggers focus\n  touch_focuses: false, // first touch focuses (on touch devices), showing tooltip, etc, second activates the button\n  disabled_focusable: true, // allow focusing even if disabled (e.g. to show tooltip)\n  hotkey: null, // optional keyboard hotkey\n  hotpad: null, // optional gamepad button\n  // (silently) ensures we have the focus this frame (e.g. if dragging a slider, the slider\n  // should retain focus even without mouseover)\n  focus_steal: false,\n  sticky_focus: false, // focus is not lost due to mouseover elsewhere\n  // optional map of SPOT_NAV_* to either:\n  //   null: indicates the spot should not do navigation, but allow the caller to handle (sets param.out.nav)\n  //   undefined: indicates navigation should target nothing (and those keys will not be consumed)\n  //   a string key: a custom element to target with navigation\n  custom_nav: null,\n};\n\nexport const SPOT_DEFAULT_BUTTON = {\n  ...SPOT_DEFAULT,\n  is_button: true,\n};\n\nexport const SPOT_DEFAULT_BUTTON_DISABLED = {\n  ...SPOT_DEFAULT,\n  disabled: true,\n  sound_rollover: null,\n};\n\nexport const SPOT_DEFAULT_BUTTON_DRAW_ONLY = {\n  // Matches previous { draw_only: true, draw_only_mouseover: true, disabled_mouseover: true } option to ui.buttonShared\n  ...SPOT_DEFAULT,\n  pad_focusable: false,\n};\n\nexport const SPOT_DEFAULT_LABEL = {\n  ...SPOT_DEFAULT,\n  sound_rollover: null,\n  touch_focuses: true, // usually want this?\n};\n\nexport const SPOT_STATE_REGULAR = 1;\nexport const SPOT_STATE_DOWN = 2;\nexport const SPOT_STATE_FOCUSED = 3;\nexport const SPOT_STATE_DISABLED = 4;\n\nimport assert from 'assert';\nconst { abs, max } = Math;\nimport * as camera2d from './camera2d.js';\nimport * as engine from './engine.js';\nimport {\n  KEYS,\n  PAD,\n  dragDrop,\n  dragOver,\n  inputClick,\n  inputEatenMouse,\n  inputTouchMode,\n  keyDown,\n  keyDownEdge,\n  longPress,\n  mouseButtonHadEdge,\n  mouseDomPos,\n  mouseDown,\n  mouseDownEdge,\n  mouseMoved,\n  mouseOver,\n  mousePosIsTouch,\n  padButtonDownEdge,\n} from './input.js';\nimport * as settings from './settings.js';\nimport * as ui from './ui.js';\nimport {\n  checkHooks,\n  drawLine,\n  drawRect,\n  drawTooltipBox,\n  playUISound,\n} from './ui.js';\n\nlet focus_sub_rect = null;\nlet focus_sub_rect_elem;\nlet sub_stack = [];\nlet focus_key = null;\n// sticky focus: used for edit boxes so that they do not lose focus even when\n//   mousing over other elements (those elements become the temporary `nonsticky`\n//   focus.\nlet focus_is_sticky = false;\nlet focus_key_nonsticky = null;\nlet focus_pos = { x: 0, y: 0, w: 0, h: 0 };\nlet frame_spots = [];\nlet focus_next = []; // indexed by SPOT_NAV_*\nlet focus_next_via = []; // just for spotDebug\nlet frame_autofocus_spots = {};\nlet last_frame_autofocus_spots = {};\nlet did_canvas_spot = false;\n// pad_mode: really \"non-mouse-mode\" - touch triggers this in various situations\n// non-pad_mode (mouse mode) requires constant mouse over state to maintain focus\nlet pad_mode = false;\n\nexport function spotPadMode() {\n  return pad_mode;\n}\n\nexport function spotlog(...args) {\n  // const { getFrameIndex } = require('./engine.js'); // eslint-disable-line global-require\n  // console.log(`spotlog(${getFrameIndex()}): `, ...args);\n}\n\nexport function spotKey(param) {\n  profilerStartFunc();\n  let key = param.key || `${focus_sub_rect ? focus_sub_rect.key_computed : ''}_${param.x}_${param.y}`;\n  if (param.key_computed) {\n    assert.equal(param.key_computed, key);\n  } else {\n    param.key_computed = key;\n  }\n  profilerStopFunc();\n  return param.key_computed;\n}\n\nfunction spotFocusSet(param, from_mouseover, force, log) {\n  if (from_mouseover && (!mouseMoved() || mousePosIsTouch())) {\n    return false;\n  }\n  const def = param.def || SPOT_DEFAULT;\n  const sound_rollover = param.sound_rollover === undefined ? def.sound_rollover : param.sound_rollover;\n  const key = param.key_computed || spotKey(param);\n  const use_nonsticky = focus_is_sticky && !force && from_mouseover && key !== focus_key;\n  const key_prev = use_nonsticky ? focus_key_nonsticky : focus_key;\n  if ((sound_rollover || !from_mouseover) && key_prev !== key) {\n    playUISound(sound_rollover || SPOT_DEFAULT.sound_rollover);\n  }\n  if (key_prev !== key || pad_mode !== !from_mouseover) {\n    spotlog('spotFocusSet', key, log, from_mouseover ? '' : 'pad_mode');\n  }\n  pad_mode = !from_mouseover;\n  if (use_nonsticky) {\n    focus_key_nonsticky = key;\n  } else {\n    focus_key = key;\n    const sticky_focus = param.sticky_focus === undefined ? def.sticky_focus : param.sticky_focus;\n    focus_is_sticky = sticky_focus;\n    focus_key_nonsticky = null;\n  }\n  assert(param.dom_pos);\n  return true;\n}\n\nexport function spotUnfocus() {\n  spotlog('spotUnfocus');\n  focus_key = null;\n  focus_is_sticky = false;\n  focus_key_nonsticky = null;\n  pad_mode = false;\n}\n\n\nconst TARGET_QUAD = 0;\nconst TARGET_HALF = 1;\nconst TARGET_ALL = 2;\n\nfunction findBestTargetInternal(nav, dom_pos, targets, precision, filter) {\n  let start_w2 = dom_pos.w/2;\n  let start_h2 = dom_pos.h/2;\n  let start_x = dom_pos.x + start_w2;\n  let start_y = dom_pos.y + start_h2;\n  let start_left = dom_pos.x;\n  let start_right = dom_pos.x + dom_pos.w;\n  let start_top = dom_pos.y;\n  let start_bottom = dom_pos.y + dom_pos.h;\n  let best = null;\n  let bestd;\n  for (let ii = 0; ii < targets.length; ++ii) {\n    let param = targets[ii];\n    if (!filter(param)) {\n      continue;\n    }\n    let target = param.dom_pos;\n    let d;\n    if (precision === TARGET_QUAD) {\n      let quadrant;\n      // edge facing quadrant calc: to be to the \"left\" our right edge must be\n      //   in the quadrant formed by the 2 45-degree lines passing through the\n      //   left 2 points of the start rect.\n      // In this case, for `d`, use the Manhattan distance from the center of\n      //   the start edge to the nearest point in the target, this will favor\n      //   those that are nearby and aligned without skipping past a large, wide\n      //   button in favor of a small (closer) button on the other side of it.\n      let target_right = target.x + target.w;\n      let target_bottom = target.y + target.h;\n      let left_dx = start_left - target_right;\n      let right_dx = target.x - start_right;\n      let top_dy = start_top - target_bottom;\n      let bottom_dy = target.y - start_bottom;\n      if (left_dx >= -start_w2 && target_bottom > start_top - left_dx && target.y < start_bottom + left_dx) {\n        quadrant = SPOT_NAV_LEFT;\n        d = left_dx + max(target.y - start_y, start_y - target_bottom, 0);\n      } else if (right_dx >= -start_w2 && target_bottom > start_top - right_dx && target.y < start_bottom + right_dx) {\n        quadrant = SPOT_NAV_RIGHT;\n        d = right_dx + max(target.y - start_y, start_y - target_bottom, 0);\n      } else if (top_dy >= -start_h2 && target_right >= start_left - top_dy && target.x <= start_right + top_dy) {\n        quadrant = SPOT_NAV_UP;\n        d = top_dy + max(target.x - start_x, start_x - target_right, 0);\n      } else if (bottom_dy >= -start_h2 && target_right >= start_left - bottom_dy &&\n        target.x <= start_right + bottom_dy\n      ) {\n        quadrant = SPOT_NAV_DOWN;\n        d = bottom_dy + max(target.x - start_x, start_x - target_right, 0);\n      }\n\n      if (quadrant === undefined) {\n        // smart logic didn't work, perhaps heavily overlapping, instead use\n        // simple center-point quadrant calc:\n        let x = target.x + target.w/2;\n        let y = target.y + target.h/2;\n        let dx = x - start_x;\n        let dy = y - start_y;\n        d = abs(dx) + abs(dy);\n        if (abs(dx) > abs(dy)) {\n          if (dx > 0) {\n            quadrant = SPOT_NAV_RIGHT;\n          } else {\n            quadrant = SPOT_NAV_LEFT;\n          }\n        } else {\n          if (dy > 0) {\n            quadrant = SPOT_NAV_DOWN;\n          } else {\n            quadrant = SPOT_NAV_UP;\n          }\n        }\n      }\n      if (quadrant !== nav) {\n        continue;\n      }\n    } else {\n      let x = target.x + target.w/2;\n      let y = target.y + target.h/2;\n      let dx = x - start_x;\n      let dy = y - start_y;\n      d = abs(dx) + abs(dy);\n      if (precision === TARGET_HALF) {\n        if (dx <= 0 && nav === SPOT_NAV_RIGHT ||\n          dx >= 0 && nav === SPOT_NAV_LEFT ||\n          dy <= 0 && nav === SPOT_NAV_DOWN ||\n          dy >= 0 && nav === SPOT_NAV_UP\n        ) {\n          continue;\n        }\n      } else {\n        // allow any, just find closest\n      }\n    }\n    if (!best || d < bestd) {\n      best = param;\n      bestd = d;\n    }\n  }\n  return best;\n}\n\nconst EPSILON = 0.00001;\nlet debug_style;\nfunction spotDebugList(show_all, list) {\n  for (let ii = 0; ii < list.length; ++ii) {\n    let area = list[ii];\n    let pos = area.dom_pos;\n    let color;\n    if (area.spot_debug_ignore) {\n      continue;\n    }\n    if (area.only_mouseover) {\n      color = [1,0.5,0, 0.5];\n    } else {\n      const def = area.def || SPOT_DEFAULT;\n      const pad_focusable = !area.is_sub_rect &&\n        (area.pad_focusable === undefined ? def.pad_focusable : area.pad_focusable);\n      if (!pad_focusable) {\n        continue;\n      }\n      const spatial_focus = area.spatial_focus === undefined ? def.spatial_focus : area.spatial_focus;\n      if (!spatial_focus) {\n        continue;\n      }\n      for (let jj = 0; jj < list.length; ++jj) {\n        if (ii === jj) {\n          continue;\n        }\n        let other = list[jj];\n        if (other.sub_rect !== area.sub_rect) {\n          continue;\n        }\n        const other_def = other.def || SPOT_DEFAULT;\n        const other_pad_focusable = !other.is_sub_rect &&\n          (other.pad_focusable === undefined ? other_def.pad_focusable : other.pad_focusable);\n        if (other.only_mouseover || !other_pad_focusable) {\n          continue;\n        }\n        const other_spatial_focus = other.spatial_focus === undefined ? other_def.spatial_focus : other.spatial_focus;\n        if (!other_spatial_focus) {\n          continue;\n        }\n        let other_pos = other.dom_pos;\n        if (pos.x < other_pos.x + other_pos.w - EPSILON && pos.x + pos.w > other_pos.x + EPSILON &&\n          pos.y < other_pos.y + other_pos.h - EPSILON && pos.y + pos.h > other_pos.y + EPSILON\n        ) {\n          color = [1,0,0, 0.5];\n        }\n      }\n    }\n    if (!show_all && !color) {\n      continue;\n    }\n    drawRect(pos.x, pos.y, pos.x + pos.w, pos.y + pos.h, Z.DEBUG, color || [1,1,0, 0.5]);\n    if (!debug_style) {\n      debug_style = ui.font.style(null, {\n        color: 0x000000ff,\n        outline_color: 0xFFFFFFcc,\n        outline_width: 2,\n      });\n    }\n    ui.font.drawSizedAligned(debug_style, pos.x, pos.y, Z.DEBUG, 8,\n      ui.font.ALIGN.HVCENTERFIT, pos.w, pos.h, area.key_computed || 'unknown');\n  }\n}\nfunction spotDebug() {\n  camera2d.push();\n  camera2d.setDOMMapped();\n  let show_all = keyDown(KEYS.SHIFT);\n  spotDebugList(show_all, frame_spots);\n\n  if (pad_mode || show_all) {\n    for (let ii = SPOT_NAV_LEFT; ii <= SPOT_NAV_DOWN; ++ii) {\n      let next = focus_next[ii];\n      if (next) {\n        let pos = focus_pos;\n        next = next.dom_pos;\n        let via = focus_next_via[ii];\n        if (via) {\n          pos = via.dom_pos;\n          drawLine(pos.x + pos.w/2, pos.y + pos.h/2, next.x + next.w/2, next.y+next.h/2,\n            Z.DEBUG, 1, 0.95, [1, 0.5, 0, 1]);\n          pos = focus_pos;\n          next = via.dom_pos;\n        }\n        drawLine(pos.x + pos.w/2, pos.y + pos.h/2, next.x + next.w/2, next.y+next.h/2,\n          Z.DEBUG, 1, 0.95, [1, 1, 0, 1]);\n      }\n    }\n  }\n\n  camera2d.pop();\n}\n\nlet filter_sub_rect;\nlet filter_not;\nfunction filterMatchesSubrect(param) {\n  return param !== filter_not && param.sub_rect === filter_sub_rect;\n}\n\nfunction overlaps(r1, r2) {\n  return r1.x + r1.w > r2.x && r1.x < r2.x + r2.w &&\n    r1.y + r1.h > r2.y && r1.y < r2.y + r2.h;\n}\nfunction contains(outer, inner) {\n  return inner.x >= outer.x && inner.x + inner.w <= outer.x + outer.w &&\n    inner.y >= outer.y && inner.y + inner.h <= outer.y + outer.h;\n}\n\nfunction filterInSubrectView(param) {\n  if (param.sub_rect !== filter_sub_rect) {\n    return false;\n  }\n  return overlaps(param.dom_pos, filter_sub_rect.dom_pos);\n}\n\nfunction filterMatchesSubrectOrInVisibleChild(param) {\n  if (param === filter_not) {\n    return false;\n  }\n  if (param.sub_rect === filter_sub_rect) {\n    return true;\n  }\n  if (param.sub_rect && param.sub_rect.sub_rect === filter_sub_rect) {\n    // in immediate child\n    return overlaps(param.dom_pos, param.sub_rect.dom_pos);\n  }\n  return false;\n}\n\nconst SUBRECT_FILTERS = [filterInSubrectView, filterMatchesSubrect];\nfunction findBestWithinSubrect(nav, dom_pos, pad_focusable_list, best, precision_max) {\n  // we hit a sub rect, find the best target inside it, first trying all\n  //   in view (all precision), then all out of view\n  filter_sub_rect = best;\n  for (let jj = 0; jj < SUBRECT_FILTERS.length; ++jj) {\n    let filter = SUBRECT_FILTERS[jj];\n    for (let precision = 0; precision <= precision_max; ++precision) {\n      let best_inside = findBestTargetInternal(nav, dom_pos, pad_focusable_list, precision, filter);\n      if (best_inside) {\n        return best_inside;\n      }\n    }\n  }\n  return null;\n}\n\nfunction findBestTargetFromSubRect(start_sub_rect, nav, dom_pos, pad_focusable_list, precision) {\n  // Go to the one in the appropriate quadrant which has the smallest Manhattan distance\n  filter_sub_rect = start_sub_rect;\n  let best = findBestTargetInternal(nav, dom_pos, pad_focusable_list, precision, filterMatchesSubrectOrInVisibleChild);\n  if (best) {\n    if (best.is_sub_rect) {\n      focus_next_via[nav] = best;\n      best = findBestWithinSubrect(nav, dom_pos, pad_focusable_list, best, precision);\n      if (!best) {\n        focus_next_via[nav] = undefined;\n      }\n    }\n  }\n  return best;\n}\n\nfunction spotCalcNavTargets() {\n  // Computes, for each direction, where we would target from the current focus\n  //   state, to be used next frame if a focus key is pressed.\n  // Note: cannot compute this trivially only upon keypress since we do not know\n  //   which keys to check until we reached a focused / focusable element.  We\n  //   could, however, instead, do this at the beginning of the frame only if\n  //   we peek at the key/pad state and see that it *might be* pressed this\n  //   frame.\n  for (let ii = 1; ii < SPOT_NAV_MAX; ++ii) {\n    focus_next[ii] = undefined;\n    focus_next_via[ii] = undefined;\n  }\n  // First, find current focused element (if any) and gather the list of potentially\n  //  focusable elements, computing where \"prev\" and \"next should go (based on\n  //  the in-frame order).\n  let start;\n  let pad_focusable_list = [];\n  let prev;\n  let first_non_sub_rect;\n  for (let ii = 0; ii < frame_spots.length; ++ii) {\n    let param = frame_spots[ii];\n    if (param.is_sub_rect) {\n      // Not actually \"focusable\", but need to target it to then target its contents\n      if (!param.is_empty_sub_rect) {\n        pad_focusable_list.push(param);\n      }\n    } else if (param.key_computed === focus_key) {\n      if (!focus_next[SPOT_NAV_PREV] && prev) {\n        focus_next[SPOT_NAV_PREV] = prev;\n      }\n      start = param;\n    } else {\n      const def = param.def || SPOT_DEFAULT;\n      const pad_focusable = param.pad_focusable === undefined ? def.pad_focusable : param.pad_focusable;\n      if (pad_focusable) {\n        if (!first_non_sub_rect) {\n          first_non_sub_rect = param;\n        }\n        prev = param;\n        if (!focus_next[SPOT_NAV_NEXT] && start) {\n          focus_next[SPOT_NAV_NEXT] = param;\n        }\n        const spatial_focus = param.spatial_focus === undefined ? def.spatial_focus : param.spatial_focus;\n        if (spatial_focus) {\n          pad_focusable_list.push(param);\n        }\n      }\n    }\n  }\n  if (!focus_next[SPOT_NAV_PREV] && prev) {\n    // but, didn't trigger above, must have been first, wrap to end\n    focus_next[SPOT_NAV_PREV] = prev;\n  }\n  if (!focus_next[SPOT_NAV_NEXT]) {\n    // nothing next, go to first non-sub_rect\n    focus_next[SPOT_NAV_NEXT] = first_non_sub_rect;\n  }\n  let precision_max;\n  let start_sub_rect;\n  if (start) {\n    start_sub_rect = start.sub_rect;\n    focus_pos.x = start.dom_pos.x;\n    focus_pos.y = start.dom_pos.y;\n    focus_pos.w = start.dom_pos.w;\n    focus_pos.h = start.dom_pos.h;\n    precision_max = TARGET_HALF;\n  } else {\n    // use the subrect overlapped, if any\n    start_sub_rect = null;\n    for (let ii = 0; ii < frame_spots.length; ++ii) {\n      let param = frame_spots[ii];\n      if (param.is_sub_rect) {\n        if (contains(param.dom_pos, focus_pos)) {\n          start_sub_rect = param;\n        }\n      }\n    }\n    if (start_sub_rect) {\n      precision_max = TARGET_HALF;\n    } else {\n      precision_max = TARGET_ALL;\n    }\n  }\n\n  // Second, using the currently focused rect as a starting point, find\n  //   appropriate elements to focus in each of the cardinal directions.\n  for (let nav = SPOT_NAV_LEFT; nav <= SPOT_NAV_DOWN; ++nav) {\n    for (let precision = 0; precision <= precision_max; ++precision) {\n      filter_not = null;\n      let best = findBestTargetFromSubRect(start_sub_rect, nav, focus_pos, pad_focusable_list, precision);\n      if (best) {\n        focus_next[nav] = best;\n        break;\n      }\n      if (start_sub_rect) {\n        // Did not find anything within our subrect, try searching outside, from the subrect itself\n        filter_not = start_sub_rect; // do not target oneself\n        best = findBestTargetFromSubRect(start_sub_rect.sub_rect, nav, focus_pos,\n          pad_focusable_list, precision);\n        if (best) {\n          focus_next[nav] = best;\n          break;\n        }\n      }\n    }\n  }\n\n  // Finally, apply any custom navigation instructions (keys which should not change\n  //   focus or which target a particular other element by key) based on the currently\n  //   focused element.\n  if (start) {\n    const def = start.def || SPOT_DEFAULT;\n    const custom_nav = start.custom_nav === undefined ? def.custom_nav : start.custom_nav;\n    if (custom_nav) {\n      let by_key;\n      for (let key in custom_nav) {\n        let target = custom_nav[key];\n        if (!target) {\n          focus_next[key] = target;\n        } else {\n          if (!by_key) {\n            by_key = {};\n            for (let ii = 0; ii < frame_spots.length; ++ii) {\n              let param = frame_spots[ii];\n              by_key[param.key_computed] = param;\n            }\n          }\n          if (by_key[target]) {\n            focus_next[key] = by_key[target];\n          }\n        }\n      }\n    }\n  }\n}\n\nexport function spotTopOfFrame() {\n  if (mouseMoved()) {\n    let pos = mouseDomPos();\n    focus_pos.x = pos[0];\n    focus_pos.y = pos[1];\n    focus_pos.w = 0;\n    focus_pos.h = 0;\n  }\n  if (mouseDownEdge({ peek: true })) {\n    pad_mode = false;\n  }\n  sub_stack.length = 0;\n}\n\nexport function spotEndOfFrame() {\n  if (did_canvas_spot && focus_key && (keyDownEdge(KEYS.ESC) || padButtonDownEdge(PAD.B))) {\n    // Handle cancelling to auto-focus \"canvas\" spot (maybe this should be moved to app logic?)\n    spotUnfocus();\n  }\n  spotCalcNavTargets();\n\n  last_frame_autofocus_spots = frame_autofocus_spots;\n  did_canvas_spot = false;\n  frame_spots = [];\n  frame_autofocus_spots = {};\n}\n\nfunction frameSpotsPush(param) {\n  assert(param.dom_pos);\n  param.sub_rect = focus_sub_rect;\n  frame_spots.push(param);\n  if (focus_sub_rect) {\n    focus_sub_rect.is_empty_sub_rect = false;\n  }\n}\n\nfunction spotEntirelyObscured(param) {\n  let pos = param.dom_pos;\n  for (let ii = 0; ii < frame_spots.length; ++ii) {\n    let other = frame_spots[ii];\n    if (other.is_sub_rect || other.sub_rect !== focus_sub_rect) {\n      continue;\n    }\n    let other_pos = other.dom_pos;\n    if (other_pos.x <= pos.x && other_pos.x + other_pos.w >= pos.x + pos.w &&\n      other_pos.y <= pos.y && other_pos.y + other_pos.h >= pos.y + pos.h\n    ) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function spotSubPush() {\n  sub_stack.push([focus_sub_rect, focus_sub_rect_elem]);\n  focus_sub_rect = null;\n}\nexport function spotSubPop() {\n  ([focus_sub_rect, focus_sub_rect_elem] = sub_stack.pop());\n}\n\nexport function spotSubBegin(param) {\n  assert(param.key);\n  assert(!focus_sub_rect); // no recursive nesting supported yet\n  spotKey(param);\n  param.is_sub_rect = true;\n  if (!param.dom_pos) {\n    param.dom_pos = {};\n  }\n  camera2d.virtualToDomPosParam(param.dom_pos, param);\n  if (!spotEntirelyObscured(param)) {\n    frameSpotsPush(param);\n  }\n  focus_sub_rect = param;\n  focus_sub_rect.is_empty_sub_rect = true;\n  focus_sub_rect_elem = null;\n}\n\nexport function spotSubEnd() {\n  assert(focus_sub_rect);\n  focus_sub_rect = null;\n  return focus_sub_rect_elem;\n}\n\nexport function spotMouseoverHook(pos_param, param) {\n  if (inputEatenMouse() || param.peek) {\n    return;\n  }\n  if (param.key_computed) { // presumably in a call to `spot()`\n    return;\n  }\n  if (!pos_param.dom_pos) {\n    pos_param.dom_pos = {};\n  }\n  camera2d.virtualToDomPosParam(pos_param.dom_pos, pos_param);\n  if (!spotEntirelyObscured(pos_param)) {\n    pos_param.only_mouseover = true;\n    pos_param.pad_focusable = false;\n    if (engine.defines.SPOT_DEBUG) {\n      pos_param.spot_debug_ignore = param.eat_clicks || // just consuming mouseover, not a button / etc\n        param.spot_debug_ignore;\n    }\n    frameSpotsPush(pos_param);\n  }\n}\n\nfunction keyCheck(nav_dir) {\n  switch (nav_dir) {\n    case SPOT_NAV_LEFT:\n      return keyDownEdge(KEYS.LEFT) || padButtonDownEdge(PAD.LEFT);\n    case SPOT_NAV_UP:\n      return keyDownEdge(KEYS.UP) || padButtonDownEdge(PAD.UP);\n    case SPOT_NAV_RIGHT:\n      return keyDownEdge(KEYS.RIGHT) || padButtonDownEdge(PAD.RIGHT);\n    case SPOT_NAV_DOWN:\n      return keyDownEdge(KEYS.DOWN) || padButtonDownEdge(PAD.DOWN);\n    case SPOT_NAV_PREV:\n      return keyDown(KEYS.SHIFT) && keyDownEdge(KEYS.TAB) || padButtonDownEdge(PAD.LEFT_BUMPER);\n    case SPOT_NAV_NEXT:\n      return !keyDown(KEYS.SHIFT) && keyDownEdge(KEYS.TAB) || padButtonDownEdge(PAD.RIGHT_BUMPER);\n    default:\n      assert(false);\n  }\n  return false;\n}\n\nfunction spotFocusCheckNavButtonsFocused(param) {\n  for (let ii = 1; ii < SPOT_NAV_MAX; ++ii) {\n    if (focus_next[ii] !== undefined && keyCheck(ii)) {\n      if (focus_next[ii]) {\n        spotFocusSet(focus_next[ii], false, false, 'nav_focused');\n      } else {\n        param.out.nav = ii;\n      }\n    }\n  }\n}\n\nfunction spotFocusCheckNavButtonsUnfocused(param) {\n  for (let ii = 1; ii < SPOT_NAV_MAX; ++ii) {\n    if (focus_next[ii] && focus_next[ii].key_computed === param.key_computed && keyCheck(ii)) {\n      spotFocusSet(focus_next[ii], false, false, 'nav_unfocused');\n    }\n  }\n}\n\n// Silently steal (keep) focus\nfunction spotFocusSetSilent(param) {\n  const key = spotKey(param);\n  const def = param.def || SPOT_DEFAULT;\n  focus_key = key;\n  const sticky_focus = param.sticky_focus === undefined ? def.sticky_focus : param.sticky_focus;\n  focus_is_sticky = sticky_focus;\n  focus_key_nonsticky = null;\n}\n\nexport function spotFocusSteal(param) {\n  const key = spotKey(param);\n  spotlog('spotFocusSteal', key, false);\n  // Silent, no sound, no checking parameters, just set the key string\n  pad_mode = true;\n  spotFocusSetSilent(param);\n}\n\n\n// sets param.out.allow_focus, param.out.nav, and param.dom_pos (if allow_focus)\nexport function spotFocusCheck(param) {\n  let out = param.out;\n  if (!out) {\n    out = param.out = {};\n  }\n  out.focused = false;\n  out.kb_focused = false;\n  out.allow_focus = false;\n  const key = spotKey(param); // Doing this even if disabled for spotDebug()\n  const def = param.def || SPOT_DEFAULT;\n  const disabled = param.disabled === undefined ? def.disabled : param.disabled;\n  if (disabled) {\n    const disabled_focusable = param.disabled_focusable === undefined ? def.disabled_focusable :\n      param.disabled_focusable;\n    if (!disabled_focusable) {\n      return out;\n    }\n    // Otherwise disabled_focusable - allow focusing\n  }\n  const focus_steal = param.focus_steal === undefined ? def.focus_steal : param.focus_steal;\n  if (focus_steal) {\n    // Silently steal (keep) focus\n    spotFocusSetSilent(param);\n  }\n  if (focus_key === key) {\n    // last_frame_focus_found = true;\n    spotFocusCheckNavButtonsFocused(param);\n  } else {\n    spotFocusCheckNavButtonsUnfocused(param);\n  }\n  let focused = focus_key === key || focus_key_nonsticky === key;\n  if (inputEatenMouse()) {\n    if (focus_key === key) {\n      spotUnfocus();\n      focused = false;\n    }\n    if (focus_key_nonsticky === key) {\n      focus_key_nonsticky = null;\n      focused = false;\n    }\n  } else {\n    out.allow_focus = true;\n    if (!param.dom_pos) {\n      param.dom_pos = {};\n    }\n    camera2d.virtualToDomPosParam(param.dom_pos, param);\n    if (!spotEntirelyObscured(param)) {\n      frameSpotsPush(param);\n      const auto_focus = param.auto_focus === undefined ? def.auto_focus : param.auto_focus;\n      if (auto_focus) {\n        if (!focused && !last_frame_autofocus_spots[key] && pad_mode) {\n          spotlog('auto_focus', key);\n          // play no sound, etc, just silently steal focus\n          spotFocusSetSilent(param);\n          focused = true;\n        }\n        frame_autofocus_spots[key] = param;\n      }\n    }\n    if (focus_sub_rect && focus_key === key) {\n      focus_sub_rect_elem = param;\n    }\n  }\n\n  out.kb_focused = focus_key === key;\n  out.focused = focused;\n  return out;\n}\n\nexport function spotEndInput() {\n  if (engine.defines.SPOT_DEBUG) {\n    spotDebug();\n  }\n}\n\nlet last_signal = {\n  key: '',\n  timestamp: 0,\n};\nfunction spotSignalRet(param) {\n  let out = param.out;\n  let key = param.key_computed;\n  assert(key);\n  out.double_click = key === last_signal.key &&\n    engine.frame_timestamp - last_signal.timestamp < settings.double_click_time;\n  last_signal.key = key;\n  last_signal.timestamp = engine.frame_timestamp;\n  out.ret++;\n}\n\n// param:\n//   See SPOT_DEFAULT, additionally:\n//   x,y,w,h : number // only parameters not inherited from `def`\n//   def: used for any undefined parameters (defaults to SPOT_DEFAULT)\n//   out: object // holds return values, lazy-allocated if needed\n// returns/modifies param.out:\n//   focused : boolean // focused by any means\n//   kb_focused : boolean // focused for the purpose of receiving keyboard input (focused and no other sticky focus)\n//   spot_state: one of SPOT_STATE_*\n//   ret: number // if `param.is_button` and was activated (0/1 or more if clicked multiple times in a frame)\n//   long_press: boolean // if button_long_press and ret and was a long press, set to true\n//   button: number // if ret, set to mouse button used to click it\n//   pos: vec2 // if ret, set to position of the click\n//   double_click: boolean // if ret, set to true if it was a double click/tap/button press/etc\n//   drag_drop: any // if drag_target and a drop happened, contains dragDrop event { drag_payload }\n//   nav: SPOT_NAV_* // if custom_nav, and the user navigated, set to the navigation event\nexport function spot(param) {\n  profilerStartFunc();\n  const def = param.def || SPOT_DEFAULT;\n  const disabled = param.disabled === undefined ? def.disabled : param.disabled;\n  const tooltip = param.tooltip === undefined ? def.tooltip : param.tooltip;\n  const is_button = param.is_button === undefined ? def.is_button : param.is_button;\n  const button_long_press = param.button_long_press === undefined ? def.button_long_press : param.button_long_press;\n  const in_event_cb = param.in_event_cb === undefined ? def.in_event_cb : param.in_event_cb;\n  const drag_target = param.drag_target === undefined ? def.drag_target : param.drag_target;\n  const drag_over = param.drag_over === undefined ? def.drag_over : param.drag_over;\n  const touch_focuses = param.touch_focuses === undefined ? def.touch_focuses : param.touch_focuses;\n  const focus_steal = param.focus_steal === undefined ? def.focus_steal : param.focus_steal;\n  const custom_nav = param.custom_nav === undefined ? def.custom_nav : param.custom_nav;\n\n  let out = param.out;\n  if (!out) {\n    out = param.out = {};\n  }\n  out.focused = false;\n  out.ret = 0;\n  if (button_long_press) {\n    out.long_press = false;\n  }\n  if (drag_target) {\n    out.drag_drop = null;\n  }\n  if (custom_nav) {\n    out.nav = SPOT_NAV_NONE;\n  }\n\n  let state = SPOT_STATE_REGULAR;\n  let { focused, allow_focus, kb_focused } = spotFocusCheck(param);\n  if (disabled) {\n    state = SPOT_STATE_DISABLED;\n  } else {\n    let button_click;\n    if (drag_target && (out.drag_drop = dragDrop(param))) {\n      spotFocusSet(param, true, true, 'drag_drop');\n      spotSignalRet(param);\n      focused = true;\n    } else if (button_long_press && (button_click = longPress(param)) ||\n        is_button && (button_click = inputClick(param))\n    ) {\n      // TODO: change `ret` to be a count of how many clicks/taps happened?\n      out.long_press = button_click.long_press;\n      out.button = button_click.button;\n      // Not using button_click.was_double_click: relying on doubly activating this exact spot instead\n      // out.double_click = button_click.was_double_click;\n      out.pos = button_click.pos;\n      if (mousePosIsTouch()) {\n        if (touch_focuses) {\n          if (!focused) {\n            // Just focus, show tooltip\n            // touch_changed_focus = true;\n            // Considering this a \"pad\" focus, not mouse, as it's sticky\n            spotFocusSet(param, false, false, 'touch_focus');\n            focused = true;\n          } else {\n            // activate, and also unfocus\n            spotSignalRet(param);\n            spotUnfocus();\n            focused = false;\n          }\n        } else {\n          // not focusing, would flicker a tooltip for 1 frame\n          // also, unfocusing, in case it was focused via long_press_focuses\n          spotSignalRet(param);\n          spotUnfocus();\n          focused = false;\n        }\n      } else {\n        spotSignalRet(param);\n        spotFocusSet(param, true, true, 'click');\n        focused = true;\n      }\n    } else if (!is_button && touch_focuses && mousePosIsTouch() && inputClick(param)) {\n      // Considering this a \"pad\" focus, not mouse, as it's sticky\n      spotFocusSet(param, false, false, 'touch_focus');\n      focused = true;\n    } else if (drag_target && dragOver(param)) {\n      spotFocusSet(param, true, false, 'drag_over');\n      focused = true;\n      if (mouseDown()) {\n        state = SPOT_STATE_DOWN;\n      }\n    } else if (drag_over && dragOver(param)) {\n      // do nothing, just consume event\n      // not even set focus?\n    }\n  }\n  // Long-press (on touch) focuses, a la mouse rollover\n  if (allow_focus && inputTouchMode()) {\n    const long_press_focuses = param.long_press_focuses === undefined ?\n      def.long_press_focuses : param.long_press_focuses;\n    if (long_press_focuses && longPress(param)) {\n      // Considering this a \"pad\" focus, not mouse, as it's sticky\n      spotFocusSet(param, false, false, 'long_press');\n      focused = true;\n    }\n  }\n  let is_mouseover = mouseOver(param);\n  if (focused && !focus_steal && !is_mouseover) {\n    // Want to unfocus if mouse is in use\n    if (mouseButtonHadEdge()) {\n      // Unfocus regardless\n      focused = false;\n      spotUnfocus();\n    } else if (mouseMoved()) {\n      // Unfocus just focus_non_sticky if appropriate\n      focused = false;\n      if (focus_key === param.key_computed) {\n        spotUnfocus();\n      } else if (focus_key_nonsticky === param.key_computed) {\n        focus_key_nonsticky = null;\n      }\n    }\n  }\n  if (is_mouseover) {\n    if (allow_focus) {\n      if (spotFocusSet(param, true, false, 'mouseover')) {\n        focused = true;\n      }\n    }\n  }\n  if (is_button && mouseDown({\n    x: param.x, y: param.y,\n    w: param.w, h: param.h,\n    do_max_dist: true, // Need to apply the same max_dist logic to mouseDown() as we do for click()\n  })) {\n    if (!disabled) {\n      state = SPOT_STATE_DOWN;\n    }\n  }\n\n  let button_activate = false;\n  if (focused) {\n    if (state === SPOT_STATE_REGULAR) {\n      state = SPOT_STATE_FOCUSED;\n    }\n    if (is_button && !disabled && kb_focused) {\n      let key_opts = in_event_cb ? { in_event_cb } : null;\n      if (keyDownEdge(KEYS.SPACE, key_opts) || keyDownEdge(KEYS.RETURN, key_opts) || padButtonDownEdge(PAD.A)) {\n        button_activate = true;\n      }\n    }\n  }\n  if (!disabled) {\n    const hotkey = param.hotkey === undefined ? def.hotkey : param.hotkey;\n    const hotpad = param.hotpad === undefined ? def.hotpad : param.hotpad;\n    if (hotkey) {\n      let key_opts = in_event_cb ? { in_event_cb } : null;\n      if (keyDownEdge(hotkey, key_opts)) {\n        button_activate = true;\n      }\n    }\n    if (hotpad) {\n      if (padButtonDownEdge(hotpad)) {\n        button_activate = true;\n      }\n    }\n  }\n  if (button_activate) {\n    spotSignalRet(param);\n    out.button = 0;\n    out.pos = null;\n  }\n\n  out.focused = focused;\n  if (out.ret) {\n    state = SPOT_STATE_DOWN;\n    const sound_button = param.sound_button === undefined ? def.sound_button : param.sound_button;\n    playUISound(sound_button);\n  }\n  if (out.focused && tooltip) {\n    drawTooltipBox(param);\n  }\n  checkHooks(param, out.ret);\n  out.spot_state = state;\n\n  profilerStopFunc();\n  return out;\n}\n\n\nconst canvas_spot = {\n  def: SPOT_DEFAULT,\n  key: 'canvas',\n  pad_focusable: true,\n  spatial_focus: false,\n  x: Infinity, y: Infinity, // Cause no spatial events to be eaten\n  w: 0, h: 0,\n  // custom_nav filled below\n  sound_rollover: null,\n};\n// Defines a virtual spot for the canvas, which is focusable, and which, when focused,\n//  does not capture any navigation keys (e.g. for arrows driving avatar control)\nexport function spotFocusableCanvas() {\n  if (!did_canvas_spot) {\n    did_canvas_spot = true;\n    canvas_spot.focus_steal = !focus_key;\n    spot(canvas_spot);\n  }\n  return canvas_spot.out;\n}\n\nconst CANVAS_HANDLES_DEFAULT = [SPOT_NAV_LEFT, SPOT_NAV_UP, SPOT_NAV_RIGHT, SPOT_NAV_DOWN];\nexport function spotCanvasHandles(list) {\n  let custom_nav = {};\n  for (let ii = 0; ii < list.length; ++ii) {\n    custom_nav[list[ii]] = undefined;\n  }\n  canvas_spot.custom_nav = custom_nav;\n}\nspotCanvasHandles(CANVAS_HANDLES_DEFAULT);\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nconst { floor, random } = Math;\n\nfunction GlovSpriteAnimation(params) {\n  this.frame = 0;\n  this.time = 0;\n  this.frame_time = 0;\n  this.state = null;\n  this.anim = null;\n  this.anim_idx = 0;\n\n  if (params instanceof GlovSpriteAnimation) {\n    this.data = params.data; // already initialized\n    this.setState(params.state);\n  } else {\n    this.data = params;\n    for (let key in this.data) {\n      let anim = this.data[key];\n      if (typeof anim.frames === 'number') {\n        anim.frames = [anim.frames];\n      }\n      if (typeof anim.times === 'number') {\n        let arr = new Array(anim.frames.length);\n        for (let ii = 0; ii < anim.frames.length; ++ii) {\n          arr[ii] = anim.times;\n        }\n        anim.times = arr;\n      }\n      if (anim.times_random) {\n        if (typeof anim.times_random === 'number') {\n          let arr = new Array(anim.frames.length);\n          for (let ii = 0; ii < anim.frames.length; ++ii) {\n            arr[ii] = anim.times_random;\n          }\n          anim.times_random = arr;\n        }\n      }\n      anim.total_time = 0;\n      for (let ii = 0; ii < anim.times.length; ++ii) {\n        anim.total_time += anim.times[ii];\n      }\n      if (anim.loop === undefined) {\n        anim.loop = true;\n      }\n    }\n  }\n}\n\nexport function create(params) {\n  return new GlovSpriteAnimation(params);\n}\nexports.createSpriteAnimation = create;\n\nGlovSpriteAnimation.prototype.clone = function () {\n  return new GlovSpriteAnimation(this);\n};\n\nGlovSpriteAnimation.prototype.setFrameIndex = function (anim_idx) {\n  this.anim_idx = anim_idx;\n  this.frame = this.anim.frames[anim_idx];\n  this.frame_time = this.anim.times[anim_idx];\n  if (this.anim.times_random) {\n    this.frame_time += floor(random() * this.anim.times_random[anim_idx]);\n  }\n};\n\nGlovSpriteAnimation.prototype.setState = function (state, force) {\n  if (state === this.state && !force) {\n    return this;\n  }\n  if (!this.data[state]) {\n    console.error(`Tried to set anim state ${state} which does not exist`);\n    return this;\n  }\n  this.state = state;\n  this.anim = this.data[state];\n  if (this.anim.init_time) {\n    this.time = floor(random() * this.anim.init_time);\n  } else {\n    this.time = 0;\n  }\n  this.setFrameIndex(0);\n  return this;\n};\n\nGlovSpriteAnimation.prototype.progress = function () {\n  if (!this.anim) {\n    return 1;\n  }\n  let time = this.time;\n  for (let ii = 0; ii < this.anim_idx; ++ii) {\n    time += this.anim.times[ii];\n  }\n  return time / this.anim.total_time;\n};\n\nGlovSpriteAnimation.prototype.update = function (dt) {\n  if (!this.anim) {\n    return;\n  }\n  this.time += dt;\n  if (this.time > this.frame_time) {\n    this.time -= this.frame_time;\n    this.anim_idx++;\n    if (this.anim_idx === this.anim.frames.length) {\n      if (this.anim.loop) {\n        this.anim_idx %= this.anim.frames.length;\n      } else if (this.anim.transition_to) {\n        this.setState(this.anim.transition_to);\n      } else {\n        // keep final frame\n        this.anim = null;\n        return;\n      }\n    }\n    this.setFrameIndex(this.anim_idx);\n    if (this.time >= this.frame_time) {\n      this.time = this.frame_time - 1;\n    }\n  }\n};\n\nGlovSpriteAnimation.prototype.getFrame = function (dt) {\n  if (dt !== undefined) {\n    this.update(dt);\n  }\n  return this.frame;\n};\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n// Some code from Turbulenz: Copyright (c) 2012-2013 Turbulenz Limited\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// eslint-disable-next-line no-use-before-define\nexports.createSprite = create;\n// eslint-disable-next-line no-use-before-define\nexports.spritesClip = clip;\n\nexport const BlendMode = {\n  BLEND_ALPHA: 0,\n  BLEND_ADDITIVE: 1,\n  BLEND_PREMULALPHA: 2,\n};\nexport const BLEND_ALPHA = 0;\nexport const BLEND_ADDITIVE = 1;\nexport const BLEND_PREMULALPHA = 2;\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst camera2d = require('./camera2d.js');\nconst engine = require('./engine.js');\nconst geom = require('./geom.js');\nconst { cos, max, min, round, sin } = Math;\nconst textures = require('./textures.js');\nconst { cmpTextureArray } = textures;\nconst shaders = require('./shaders.js');\nconst { nextHighestPowerOfTwo } = require('glov/common/util.js');\nconst { vec2, vec4 } = require('glov/common/vmath.js');\n\nexport let sprite_vshader;\nexport let sprite_fshader;\nlet sprite_dual_fshader;\nlet clip_space = vec4();\nlet sprite_shader_params = {\n  clip_space\n};\nlet last_uid = 0;\nlet geom_stats;\n\nlet sprite_queue = [];\n\nlet sprite_freelist = [];\n\nlet sprite_queue_stack = [];\nexport function spriteQueuePush(new_list) {\n  assert(sprite_queue_stack.length < 10); // probably leaking\n  sprite_queue_stack.push(sprite_queue);\n  sprite_queue = new_list || [];\n}\nexport function spriteQueuePop(for_pause) {\n  assert(sprite_queue_stack.length);\n  assert(for_pause || !sprite_queue.length);\n  sprite_queue = sprite_queue_stack.pop();\n}\n\nfunction SpriteData() {\n  // x y cr cg cb ca u v (x4)\n  // data for GL queuing\n  this.data = new Float32Array(32);\n  // data for sorting/binding/etc\n  this.texs = null;\n  this.shader = null;\n  this.shader_params = null;\n  this.x = 0;\n  this.y = 0;\n  this.z = 0;\n  this.blend = 0; // BLEND_ALPHA\n  this.uid = 0;\n  this.chained = false;\n  this.next = null;\n}\n\nSpriteData.prototype.queue = function (z) {\n  ++geom_stats.sprites;\n  if (!this.chained) {\n    this.z = z;\n    this.uid = ++last_uid;\n    sprite_queue.push(this);\n  }\n};\n\nlet is_chained = false;\nlet chained_prev = null;\nexport function spriteChainedStart() {\n  is_chained = true;\n  chained_prev = null;\n}\nexport function spriteChainedStop() {\n  is_chained = false;\n  chained_prev = null;\n}\n\nexport function spriteDataAlloc(texs, shader, shader_params, blend) {\n  let ret;\n  if (sprite_freelist.length) {\n    ret = sprite_freelist.pop();\n  } else {\n    ret = new SpriteData();\n  }\n  ret.texs = texs;\n  if (is_chained && chained_prev) {\n    ret.chained = true;\n    chained_prev.next = ret;\n  } else {\n    ret.chained = false;\n    ret.shader = shader || null;\n    if (shader_params) {\n      shader_params.clip_space = sprite_shader_params.clip_space;\n      ret.shader_params = shader_params;\n    } else {\n      ret.shader_params = null;\n    }\n    ret.blend = blend || 0; // BLEND_ALPHA\n  }\n  if (is_chained) {\n    chained_prev = ret;\n  }\n  return ret;\n}\n\nfunction cmpSprite(a, b) {\n  ++geom_stats.sprite_sort_cmps;\n  if (a.z !== b.z) {\n    return a.z - b.z;\n  }\n  if (a.blend === BLEND_ADDITIVE && b.blend === BLEND_ADDITIVE) {\n    // both additive at the same Z, do not sort for performance reasons\n    return 0;\n  }\n  if (a.y !== b.y) {\n    return a.y - b.y;\n  }\n  if (a.x !== b.x) {\n    return a.x - b.x;\n  }\n  return a.uid - b.uid;\n}\n\nexport function queuefn(z, fn) {\n  assert(isFinite(z));\n  sprite_queue.push({\n    fn,\n    x: 0,\n    y: 0,\n    z,\n    uid: ++last_uid,\n  });\n}\n\n// 4 arbitrary positions, colors, uvs\n// coordinates must be in counter-clockwise winding order\nexport function queueraw4color(\n  texs,\n  x0, y0, c0, u0, v0,\n  x1, y1, c1, u1, v1,\n  x2, y2, c2, u2, v2,\n  x3, y3, c3, u3, v3,\n  z,\n  shader, shader_params, blend\n) {\n  assert(isFinite(z));\n  let elem = spriteDataAlloc(texs, shader, shader_params, blend);\n  let data = elem.data;\n  // x1 y1 x2 y2 x3 y3 x4 y4 - vertices [0,8)\n  // cr cg cb ca u1 v1 u2 v2 - normalized color + texture [8,16)\n  // Minor perf improvement: convert by clip_space here (still just a single MAD\n  //   if pre-calculated in the camera) and remove it from the shader.\n  data[0] = (x0 - camera2d.data[0]) * camera2d.data[4];\n  data[1] = (y0 - camera2d.data[1]) * camera2d.data[5];\n  // Note: measurably slower: data.set(c0, 2);\n  data[2] = c0[0];\n  data[3] = c0[1];\n  data[4] = c0[2];\n  data[5] = c0[3];\n  data[6] = u0;\n  data[7] = v0;\n\n  data[8] = (x1 - camera2d.data[0]) * camera2d.data[4];\n  data[9] = (y1 - camera2d.data[1]) * camera2d.data[5];\n  data[10] = c1[0];\n  data[11] = c1[1];\n  data[12] = c1[2];\n  data[13] = c1[3];\n  data[14] = u1;\n  data[15] = v1;\n\n  data[16] = (x2 - camera2d.data[0]) * camera2d.data[4];\n  data[17] = (y2 - camera2d.data[1]) * camera2d.data[5];\n  data[18] = c2[0];\n  data[19] = c2[1];\n  data[20] = c2[2];\n  data[21] = c2[3];\n  data[22] = u2;\n  data[23] = v2;\n\n  data[24] = (x3 - camera2d.data[0]) * camera2d.data[4];\n  data[25] = (y3 - camera2d.data[1]) * camera2d.data[5];\n  data[26] = c3[0];\n  data[27] = c3[1];\n  data[28] = c3[2];\n  data[29] = c3[3];\n  data[30] = u3;\n  data[31] = v3;\n\n  elem.x = data[0];\n  elem.y = data[1];\n  elem.queue(z);\n  return elem;\n}\n\n// 4 arbitrary positions\n// coordinates must be in counter-clockwise winding order\nexport function queueraw4(\n  texs, x0, y0, x1, y1, x2, y2, x3, y3, z,\n  u0, v0, u1, v1,\n  color, shader, shader_params, blend\n) {\n  return queueraw4color(texs,\n    x0, y0, color, u0, v0,\n    x1, y1, color, u0, v1,\n    x2, y2, color, u1, v1,\n    x3, y3, color, u1, v0,\n    z,\n    shader, shader_params, blend);\n}\n\n// allocate with spriteDataAlloc() and then fill .data\nexport function queueSpriteData(elem, z) {\n  assert(isFinite(z));\n  let data = elem.data;\n  data[0] = (data[0] - camera2d.data[0]) * camera2d.data[4];\n  data[1] = (data[1] - camera2d.data[1]) * camera2d.data[5];\n\n  data[8] = (data[8] - camera2d.data[0]) * camera2d.data[4];\n  data[9] = (data[9] - camera2d.data[1]) * camera2d.data[5];\n\n  data[16] = (data[16] - camera2d.data[0]) * camera2d.data[4];\n  data[17] = (data[17] - camera2d.data[1]) * camera2d.data[5];\n\n  data[24] = (data[24] - camera2d.data[0]) * camera2d.data[4];\n  data[25] = (data[25] - camera2d.data[1]) * camera2d.data[5];\n\n  elem.x = data[0];\n  elem.y = data[1];\n  elem.queue(z);\n  return elem;\n}\n\n// Expects a buffer in the form of:\n//   x, y, r, g, b, a, u, v, (x4)\nexport function queueraw4colorBuffer(\n  texs, buf,\n  z, shader, shader_params, blend\n) {\n  assert(isFinite(z));\n  let elem = spriteDataAlloc(texs, shader, shader_params, blend);\n  let data = elem.data;\n  for (let ii = 0; ii < 32; ++ii) {\n    data[ii] = buf[ii];\n  }\n  queueSpriteData(elem, z);\n  return elem;\n}\n\n\nexport function queueraw(\n  texs, x, y, z, w, h,\n  u0, v0, u1, v1,\n  color, shader, shader_params, blend\n) {\n  return queueraw4color(texs,\n    x, y, color, u0, v0,\n    x, y + h, color, u0, v1,\n    x + w, y + h, color, u1, v1,\n    x + w, y, color, u1, v0,\n    z,\n    shader, shader_params, blend);\n}\n\nlet temp_uvs = vec4();\nfunction fillUVs(tex, w, h, nozoom, uvs) {\n  let ubias = 0;\n  let vbias = 0;\n  if (!nozoom && !tex.nozoom) {\n    // Bias the texture coordinates depending on the minification/magnification\n    //   level so we do not get pixels from neighboring frames bleeding in\n    // Use min here (was max in libGlov), to solve tooltip edges being wrong in strict pixely\n    // Use max here to solve box buttons not lining up, but instead using nozoom in drawBox/drawHBox,\n    //   but, that only works for magnification - need the max here for minification!\n    let zoom_level = max(\n      (uvs[2] - uvs[0]) * tex.width / w,\n      (uvs[3] - uvs[1]) * tex.height / h,\n    ); // in texels per pixel\n    if (zoom_level < 1) { // magnification\n      if (tex.filter_mag === gl.LINEAR) {\n        // Need to bias by half a texel, so we're doing absolutely no blending with the neighboring texel\n        ubias = vbias = 0.5;\n      } else if (tex.filter_mag === gl.NEAREST) {\n        if (engine.antialias) {\n          // When antialiasing is on, even nearest sampling samples from adjacent texels, do slight bias\n          // Want to bias by one *pixel's* worth\n          ubias = vbias = zoom_level / 2;\n        } else {\n          // even without it, running into problems, just add a tiny bias!\n          // In theory, don't want this if UVs are 0/1 and we're clamping?\n          ubias = vbias = zoom_level * 0.01;\n        }\n      }\n    } else if (zoom_level > 1) { // minification\n      // need to apply this bias even with nearest filtering, not exactly sure why\n      let mipped_texels = zoom_level / 2;\n      ubias = vbias = 0.5 + mipped_texels;\n\n    }\n    if (uvs[0] > uvs[2]) {\n      ubias *= -1;\n    }\n    if (uvs[1] > uvs[3]) {\n      vbias *= -1;\n    }\n  }\n\n  temp_uvs[0] = uvs[0] + ubias / tex.width;\n  temp_uvs[1] = uvs[1] + vbias / tex.height;\n  temp_uvs[2] = uvs[2] - ubias / tex.width;\n  temp_uvs[3] = uvs[3] - vbias / tex.height;\n}\n\n// Colors counter-clockwise from upper-left\n// c0 = upper left\n// c1 = lower left\n// c2 = lower right\n// c3 = upper right\nexport function queuesprite4color(\n  sprite, x, y, z, w, h, rot, uvs, c0, c1, c2, c3, shader, shader_params, nozoom,\n  pixel_perfect, blend\n) {\n  assert(isFinite(z));\n  let elem = spriteDataAlloc(sprite.texs, shader, shader_params, blend);\n  x = (x - camera2d.data[0]) * camera2d.data[4];\n  y = (y - camera2d.data[1]) * camera2d.data[5];\n  w *= camera2d.data[4];\n  h *= camera2d.data[5];\n  if (pixel_perfect) {\n    x |= 0;\n    y |= 0;\n    w |= 0;\n    h |= 0;\n  }\n  elem.x = x;\n  elem.y = y;\n  let data = elem.data;\n  if (!rot) {\n    let x1 = x - sprite.origin[0] * w;\n    let y1 = y - sprite.origin[1] * h;\n    let x2 = x1 + w;\n    let y2 = y1 + h;\n    data[0] = x1;\n    data[1] = y1;\n    data[8] = x1;\n    data[9] = y2;\n    data[16] = x2;\n    data[17] = y2;\n    data[24] = x2;\n    data[25] = y1;\n  } else {\n    let dx = sprite.origin[0] * w;\n    let dy = sprite.origin[1] * h;\n\n    let cosr = cos(rot);\n    let sinr = sin(rot);\n\n    let x1 = x - cosr * dx + sinr * dy;\n    let y1 = y - sinr * dx - cosr * dy;\n    let ch = cosr * h;\n    let cw = cosr * w;\n    let sh = sinr * h;\n    let sw = sinr * w;\n\n    data[0] = x1;\n    data[1] = y1;\n    data[8] = x1 - sh;\n    data[9] = y1 + ch;\n    data[16] = x1 + cw - sh;\n    data[17] = y1 + sw + ch;\n    data[24] = x1 + cw;\n    data[25] = y1 + sw;\n  }\n\n  fillUVs(elem.texs[0], w, h, nozoom, uvs);\n  data[2] = c0[0];\n  data[3] = c0[1];\n  data[4] = c0[2];\n  data[5] = c0[3];\n  data[6] = temp_uvs[0];\n  data[7] = temp_uvs[1];\n\n  data[10] = c1[0];\n  data[11] = c1[1];\n  data[12] = c1[2];\n  data[13] = c1[3];\n  data[14] = temp_uvs[0];\n  data[15] = temp_uvs[3];\n\n  data[18] = c2[0];\n  data[19] = c2[1];\n  data[20] = c2[2];\n  data[21] = c2[3];\n  data[22] = temp_uvs[2];\n  data[23] = temp_uvs[3];\n\n  data[26] = c3[0];\n  data[27] = c3[1];\n  data[28] = c3[2];\n  data[29] = c3[3];\n  data[30] = temp_uvs[2];\n  data[31] = temp_uvs[1];\n\n  elem.queue(z);\n  return elem;\n}\n\nexport function queuesprite(\n  sprite, x, y, z, w, h, rot, uvs, color, shader, shader_params, nozoom,\n  pixel_perfect, blend\n) {\n  color = color || sprite.color;\n  return queuesprite4color(\n    sprite, x, y, z, w, h, rot, uvs,\n    color, color, color, color,\n    shader, shader_params, nozoom,\n    pixel_perfect, blend);\n}\n\nlet clip_temp_xy = vec2();\nlet clip_temp_wh = vec2();\nfunction clipCoordsScissor(x, y, w, h) {\n  camera2d.virtualToCanvas(clip_temp_xy, [x, y]);\n  clip_temp_xy[0] = round(clip_temp_xy[0]);\n  clip_temp_xy[1] = round(clip_temp_xy[1]);\n  camera2d.virtualToCanvas(clip_temp_wh, [x + w, y + h]);\n  clip_temp_wh[0] = round(clip_temp_wh[0]) - clip_temp_xy[0];\n  clip_temp_wh[1] = round(clip_temp_wh[1]) - clip_temp_xy[1];\n\n  // let gd_w = engine.render_width || engine.width;\n  let gd_h = engine.render_height || engine.height;\n  return [clip_temp_xy[0], gd_h - (clip_temp_xy[1] + clip_temp_wh[1]), clip_temp_wh[0], clip_temp_wh[1]];\n}\n\nfunction clipCoordsDom(x, y, w, h) {\n  let xywh = vec4();\n  camera2d.virtualToDom(xywh, [x + w, y + h]);\n  xywh[2] = xywh[0];\n  xywh[3] = xywh[1];\n  camera2d.virtualToDom(xywh, [x, y]);\n  xywh[0] = round(xywh[0]);\n  xywh[1] = round(xywh[1]);\n  xywh[2] = round(xywh[2]) - xywh[0];\n  xywh[3] = round(xywh[3]) - xywh[1];\n\n  return xywh;\n}\n\nexport function clip(z_start, z_end, x, y, w, h) {\n  let scissor = clipCoordsScissor(x, y, w, h);\n  queuefn(z_start - 0.01, () => {\n    gl.enable(gl.SCISSOR_TEST);\n    gl.scissor(scissor[0], scissor[1], scissor[2], scissor[3]);\n  });\n  queuefn(z_end - 0.01, () => {\n    gl.disable(gl.SCISSOR_TEST);\n  });\n}\n\nlet clip_stack = [];\nexport function clipped() {\n  return clip_stack.length > 0;\n}\n\nexport function clipPush(z, x, y, w, h) {\n  assert(clip_stack.length < 10); // probably leaking\n  let scissor = clipCoordsScissor(x, y, w, h);\n  let dom_clip = clipCoordsDom(x, y, w, h);\n  camera2d.setInputClipping(dom_clip);\n  spriteQueuePush();\n  clip_stack.push({\n    z, scissor, dom_clip,\n  });\n}\n\nexport function clipPop() {\n  assert(clipped());\n  queuefn(Z.TOOLTIP - 0.1, () => {\n    gl.disable(gl.SCISSOR_TEST);\n  });\n  let { z, scissor } = clip_stack.pop();\n  let sprites = sprite_queue;\n  spriteQueuePop(true);\n  if (clip_stack.length) {\n    let { dom_clip } = clip_stack[clip_stack.length - 1];\n    camera2d.setInputClipping(dom_clip);\n  } else {\n    camera2d.setInputClipping(null);\n  }\n  queuefn(z, () => {\n    gl.enable(gl.SCISSOR_TEST);\n    gl.scissor(scissor[0], scissor[1], scissor[2], scissor[3]);\n    spriteQueuePush();\n    sprite_queue = sprites;\n    exports.draw();\n    spriteQueuePop();\n    // done at Z.TOOLTIP: gl.disable(gl.SCISSOR_TEST);\n  });\n}\n\nlet clip_paused;\nexport function clipPause() {\n  // Queue back into the root sprite queue\n  assert(clipped());\n  assert(!clip_paused);\n  clip_paused = true;\n  spriteQueuePush(sprite_queue_stack[0]);\n  camera2d.setInputClipping(null);\n  // push onto the clip stack so if there's another clip push/pop we get back to\n  // escaped when it pops.\n  clip_stack.push({ dom_clip: null });\n}\nexport function clipResume() {\n  assert(clipped());\n  assert(clip_paused);\n  clip_stack.pop(); // remove us\n  clip_paused = false;\n  assert(clipped());\n  let { dom_clip } = clip_stack[clip_stack.length - 1];\n  spriteQueuePop(true);\n  camera2d.setInputClipping(dom_clip);\n}\n\nlet batch_state;\nlet sprite_geom;\nlet sprite_buffer; // Float32Array with 8 entries per vert\nlet sprite_buffer_len = 0; // in verts\nlet sprite_buffer_batch_start = 0;\nlet sprite_buffer_idx = 0; // in verts\n\nlet last_blend_mode;\nlet last_bound_shader;\nconst MAX_VERT_COUNT = 65532; // strictly less than 65536, as index 65535 is special in WebGL2\nlet batches = [];\n\nfunction commit() {\n  if (sprite_buffer_idx === sprite_buffer_batch_start) {\n    return;\n  }\n  batches.push({\n    state: batch_state,\n    start: sprite_buffer_batch_start,\n    end: sprite_buffer_idx,\n  });\n  sprite_buffer_batch_start = sprite_buffer_idx;\n}\n\nexport function blendModeSet(blend) {\n  if (last_blend_mode !== blend) {\n    last_blend_mode = blend;\n    if (last_blend_mode === BLEND_ADDITIVE) {\n      gl.blendFunc(gl.SRC_ALPHA, gl.ONE);\n    } else if (last_blend_mode === BLEND_PREMULALPHA) {\n      gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n    } else {\n      gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n    }\n  }\n}\n\nexport function blendModeReset(force) {\n  if (last_blend_mode !== BLEND_ALPHA || force) {\n    // always reset to this\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n    last_blend_mode = BLEND_ALPHA;\n  }\n}\n\nfunction commitAndFlush() {\n  commit();\n  if (!batches.length) {\n    return;\n  }\n  assert(sprite_buffer_idx);\n  sprite_geom.update(sprite_buffer, sprite_buffer_idx);\n  sprite_geom.bind();\n\n  for (let ii = 0; ii < batches.length; ++ii) {\n    let batch = batches[ii];\n    let { state, start, end } = batch;\n    if (last_bound_shader !== state.shader || state.shader_params) {\n      shaders.bind(sprite_vshader,\n        state.shader || sprite_fshader,\n        state.shader_params || sprite_shader_params);\n      last_bound_shader = state.shader;\n    }\n    if (last_blend_mode !== state.blend) {\n      blendModeSet(state.blend);\n    }\n    textures.bindArray(state.texs);\n    ++geom_stats.draw_calls_sprite;\n    gl.drawElements(sprite_geom.mode, (end - start) * 3 / 2, gl.UNSIGNED_SHORT, start * 3);\n  }\n\n  batches.length = 0;\n  sprite_buffer_idx = 0;\n  sprite_buffer_batch_start = 0;\n}\n\nfunction drawSetup() {\n  if (engine.defines.NOSPRITES) {\n    sprite_queue.length = 0;\n  }\n  if (!sprite_queue.length) {\n    return;\n  }\n\n  clip_space[0] = 2 / engine.viewport[2];\n  clip_space[1] = -2 / engine.viewport[3];\n\n  last_blend_mode = -1;\n  last_bound_shader = -1;\n\n  if (!sprite_geom) {\n    sprite_geom = geom.create([\n      [shaders.semantic.POSITION, gl.FLOAT, 2, false],\n      [shaders.semantic.COLOR, gl.FLOAT, 4, false],\n      [shaders.semantic.TEXCOORD, gl.FLOAT, 2, false],\n    ], [], null, geom.QUADS);\n    sprite_buffer = new Float32Array(1024);\n    sprite_buffer_len = sprite_buffer.length / 8;\n  }\n\n  profilerStart('sort');\n  sprite_queue.sort(cmpSprite);\n  geom_stats.sprite_sort_elems += sprite_queue.length;\n  profilerStop('sort');\n\n  batch_state = null;\n  assert.equal(sprite_buffer_idx, 0);\n  assert.equal(sprite_buffer_batch_start, 0);\n  assert.equal(batches.length, 0);\n}\n\nfunction growSpriteBuffer() {\n  let new_length = min((sprite_buffer_len * 1.25 + 3) & ~3, MAX_VERT_COUNT);\n  sprite_buffer_len = new_length;\n  sprite_buffer = new Float32Array(new_length * 8);\n}\n\nfunction drawElem(elem) {\n  let count = 0;\n  if (elem.fn) {\n    commitAndFlush();\n    batch_state = null;\n    elem.fn();\n    last_bound_shader = -1;\n    last_blend_mode = -1;\n    assert.equal(sprite_buffer_idx, 0);\n    assert.equal(sprite_buffer_batch_start, 0);\n    assert.equal(batches.length, 0);\n\n    clip_space[0] = 2 / engine.viewport[2];\n    clip_space[1] = -2 / engine.viewport[3];\n    count++;\n  } else {\n    if (!batch_state ||\n      cmpTextureArray(elem.texs, batch_state.texs) ||\n      elem.shader !== batch_state.shader ||\n      elem.shader_params !== batch_state.shader_params ||\n      elem.blend !== batch_state.blend\n    ) {\n      commit();\n      batch_state = elem;\n    }\n    do {\n      if (sprite_buffer_idx + 4 > sprite_buffer_len) {\n        commitAndFlush();\n        // batch_state left alone\n        if (sprite_buffer_len !== MAX_VERT_COUNT) {\n          growSpriteBuffer();\n        }\n      }\n\n      let index = sprite_buffer_idx * 8;\n      sprite_buffer_idx += 4;\n\n      // measurably slower:\n      // for (let ii = 0; ii < 32; ++ii) {\n      //   sprite_buffer[index + ii] = elem.data[ii];\n      // }\n      sprite_buffer.set(elem.data, index);\n      count++;\n\n      sprite_freelist.push(elem);\n      let next = elem.next;\n      elem.next = null;\n      elem = next;\n    } while (elem);\n  }\n  return count;\n}\n\nfunction finishDraw() {\n  commitAndFlush();\n  blendModeReset();\n}\n\nexport function draw() {\n  profilerStart('sprites:draw');\n  drawSetup();\n  profilerStart('drawElem');\n  for (let ii = 0; ii < sprite_queue.length; ++ii) {\n    let elem = sprite_queue[ii];\n    drawElem(elem);\n  }\n  profilerStop('drawElem');\n  sprite_queue.length = 0;\n  finishDraw();\n  profilerStop('sprites:draw');\n}\n\nexport function drawPartial(z) {\n  profilerStart('sprites:drawPartial');\n  drawSetup();\n  profilerStart('drawElem');\n  for (let ii = 0; ii < sprite_queue.length; ++ii) {\n    let elem = sprite_queue[ii];\n    if (elem.z > z) {\n      sprite_queue = sprite_queue.slice(ii);\n      break;\n    }\n    drawElem(elem);\n  }\n  profilerStop('drawElem');\n  finishDraw();\n  profilerStop('sprites:drawPartial');\n}\n\nexport function buildRects(ws, hs, tex) {\n  let rects = [];\n  let total_w = 0;\n  for (let ii = 0; ii < ws.length; ++ii) {\n    total_w += ws[ii];\n  }\n  let total_h = 0;\n  for (let ii = 0; ii < hs.length; ++ii) {\n    total_h += hs[ii];\n  }\n  let tex_w;\n  let tex_h;\n  if (!tex || nextHighestPowerOfTwo(tex.src_width) === tex.width &&\n    nextHighestPowerOfTwo(tex.src_height) === tex.height\n  ) {\n    // texture is in fact power of two, or assume it will be\n    tex_w = nextHighestPowerOfTwo(total_w);\n    tex_h = nextHighestPowerOfTwo(total_h);\n  } else {\n    // Assume snuggly fitting, use the summed w/h, which might be a multiple of\n    //   the actual w/h, but should be correct relative to the specified `ws` and `hs`\n    tex_w = total_w;\n    tex_h = total_h;\n  }\n  let wh = [];\n  for (let ii = 0; ii < ws.length; ++ii) {\n    wh.push(ws[ii] / total_h);\n  }\n  let hw = [];\n  for (let ii = 0; ii < hs.length; ++ii) {\n    hw.push(hs[ii] / total_w);\n  }\n  let aspect = [];\n  let non_square = false;\n  let y = 0;\n  for (let jj = 0; jj < hs.length; ++jj) {\n    let x = 0;\n    for (let ii = 0; ii < ws.length; ++ii) {\n      let r = vec4(x / tex_w, y / tex_h,\n        (x + ws[ii]) / tex_w, (y + hs[jj]) / tex_h);\n      rects.push(r);\n      let asp = ws[ii] / hs[jj];\n      if (asp !== 1) {\n        non_square = true;\n      }\n      aspect.push(asp);\n      x += ws[ii];\n    }\n    y += hs[jj];\n  }\n  return {\n    widths: ws,\n    heights: hs,\n    wh,\n    hw,\n    rects,\n    aspect: non_square ? aspect : null,\n    total_w,\n    total_h,\n  };\n}\n\nfunction Sprite(params) {\n  if (params.texs) {\n    this.texs = params.texs;\n  } else {\n    let ext = params.ext || '.png';\n    this.texs = [];\n    if (params.tex) {\n      this.texs.push(params.tex);\n    } else if (params.layers) {\n      assert(params.name);\n      this.texs = [];\n      for (let ii = 0; ii < params.layers; ++ii) {\n        this.texs.push(textures.load({\n          url: `img/${params.name}_${ii}${ext}`,\n          filter_min: params.filter_min,\n          filter_mag: params.filter_mag,\n          wrap_s: params.wrap_s,\n          wrap_t: params.wrap_t,\n        }));\n      }\n    } else if (params.name) {\n      this.texs.push(textures.load({\n        url: `img/${params.name}${ext}`,\n        filter_min: params.filter_min,\n        filter_mag: params.filter_mag,\n        wrap_s: params.wrap_s,\n        wrap_t: params.wrap_t,\n      }));\n    } else {\n      assert(params.url);\n      this.texs.push(textures.load(params));\n    }\n  }\n\n  this.origin = params.origin || vec2(0, 0); // [0,1] range\n  this.size = params.size || vec2(1, 1);\n  this.color = params.color || vec4(1,1,1,1);\n  this.uvs = params.uvs || vec4(0, 0, 1, 1);\n  if (!params.uvs) {\n    // Fix up non-power-of-two textures\n    this.texs[0].onLoad((tex) => {\n      this.uvs[2] = tex.src_width / tex.width;\n      this.uvs[3] = tex.src_height / tex.height;\n    });\n  }\n\n  if (params.ws) {\n    this.uidata = buildRects(params.ws, params.hs);\n    this.texs[0].onLoad((tex) => {\n      this.uidata = buildRects(params.ws, params.hs, tex);\n    });\n  }\n  this.shader = params.shader || null;\n}\n\n// params:\n//   required: x, y\n//   optional: z, w, h, uvs, color, nozoom, pixel_perfect\nSprite.prototype.draw = function (params) {\n  if (params.w === 0 || params.h === 0) {\n    return null;\n  }\n  let w = (params.w || 1) * this.size[0];\n  let h = (params.h || 1) * this.size[1];\n  let uvs = (typeof params.frame === 'number') ? this.uidata.rects[params.frame] : (params.uvs || this.uvs);\n  return queuesprite(this, params.x, params.y, params.z || Z.UI, w, h, params.rot, uvs, params.color || this.color,\n    params.shader || this.shader, params.shader_params, params.nozoom, params.pixel_perfect, params.blend);\n};\n\nSprite.prototype.drawDualTint = function (params) {\n  params.shader = sprite_dual_fshader;\n  params.shader_params = {\n    color1: params.color1,\n  };\n  return this.draw(params);\n};\n\nSprite.prototype.draw4Color = function (params) {\n  if (params.w === 0 || params.h === 0) {\n    return null;\n  }\n  let w = (params.w || 1) * this.size[0];\n  let h = (params.h || 1) * this.size[1];\n  let uvs = (typeof params.frame === 'number') ? this.uidata.rects[params.frame] : (params.uvs || this.uvs);\n\n  return queuesprite4color(this,\n    params.x, params.y, params.z || Z.UI, w, h,\n    params.rot, uvs,\n    params.color_ul, params.color_ll, params.color_lr, params.color_ur,\n    params.shader || this.shader,\n    params.shader_params, params.nozoom,\n    params.pixel_perfect, params.blend);\n};\n\nexport function create(params) {\n  return new Sprite(params);\n}\n\nexport function startup() {\n  geom_stats = geom.stats;\n  clip_space[2] = -1;\n  clip_space[3] = 1;\n  sprite_vshader = shaders.create('shaders/sprite.vp');\n  sprite_fshader = shaders.create('shaders/sprite.fp');\n  sprite_dual_fshader = shaders.create('shaders/sprite_dual.fp');\n  shaders.prelink(sprite_vshader, sprite_fshader);\n  shaders.prelink(sprite_vshader, sprite_dual_fshader);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst {\n  chunkedReceiverFinish,\n  chunkedReceiverInit,\n  chunkedReceiverOnChunk,\n  chunkedReceiverStart,\n  chunkedReceiverFreeFile,\n  chunkedReceiverGetFile,\n} = require('glov/common/chunked_send.js');\nimport { PLATFORM_FBINSTANT } from 'glov/client/client_config.js';\nconst dot_prop = require('glov/common/dot-prop.js');\nconst EventEmitter = require('glov/common/tiny-events.js');\nconst { fbGetLoginInfo } = require('./fbinstant.js');\nconst local_storage = require('./local_storage.js');\nconst md5 = require('glov/common/md5.js');\nconst { netDisconnected } = require('./net.js');\nconst { isPacket } = require('glov/common/packet.js');\nconst { perfCounterAdd } = require('glov/common/perfcounters.js');\nconst util = require('glov/common/util.js');\nconst { errorString } = util;\nconst walltime = require('./walltime.js');\n\n// relevant events:\n//   .on('channel_data', cb(data [, mod_key, mod_value]));\n\nfunction ClientChannelWorker(subs, channel_id, base_handlers) {\n  EventEmitter.call(this);\n  this.subs = subs;\n  this.channel_id = channel_id;\n  this.subscriptions = 0;\n  this.subscribe_failed = false;\n  this.got_subscribe = false;\n  this.immediate_subscribe = 0;\n  this.channel_data_ver = 0; // for polling for changes\n  this.handlers = Object.create(base_handlers);\n  this.data = {};\n}\nutil.inherits(ClientChannelWorker, EventEmitter);\n\n// cb(data)\nClientChannelWorker.prototype.onSubscribe = function (cb) {\n  assert(this.subscriptions || this.autosubscribed);\n  this.on('subscribe', cb);\n  if (this.got_subscribe) {\n    cb(this.data);\n  }\n};\n\n// cb(data)\nClientChannelWorker.prototype.onceSubscribe = function (cb) {\n  assert(this.subscriptions || this.autosubscribed);\n  if (this.got_subscribe) {\n    cb(this.data);\n  } else {\n    this.once('subscribe', cb);\n  }\n};\n\n\nClientChannelWorker.prototype.handleChannelData = function (data, resp_func) {\n  console.log(`got channel_data(${this.channel_id}):  ${JSON.stringify(data)}`);\n  this.data = data;\n  ++this.channel_data_ver;\n  this.emit('channel_data', this.data);\n  this.got_subscribe = true;\n  this.emit('subscribe', this.data);\n\n  // Get command list upon first connect\n  let channel_type = this.channel_id.split('.')[0];\n  let cmd_list = this.subs.cmds_fetched_by_type;\n  if (cmd_list && !cmd_list[channel_type]) {\n    cmd_list[channel_type] = true;\n    this.send('cmdparse', 'cmd_list', (err, resp) => {\n      if (err) { // already unsubscribed?\n        console.error(`Error getting cmd_list for ${channel_type}`);\n        delete cmd_list[channel_type];\n      } else {\n        this.subs.cmd_parse.addServerCommands(resp);\n      }\n    });\n  }\n\n  resp_func();\n};\n\nClientChannelWorker.prototype.handleApplyChannelData = function (data, resp_func) {\n  // already logged in handleChannelMessage\n  // if (!data.q) {\n  //   console.log(`got channel data mod: ${JSON.stringify(data)}`);\n  // }\n  if (data.value === undefined) {\n    dot_prop.delete(this.data, data.key);\n  } else {\n    dot_prop.set(this.data, data.key, data.value);\n  }\n  ++this.channel_data_ver;\n  this.emit('channel_data', this.data, data.key, data.value);\n  resp_func();\n};\n\nClientChannelWorker.prototype.handleBatchSet = function (data, resp_func) {\n  for (let ii = 0; ii < data.length; ++ii) {\n    let [key, value] = data[ii];\n    if (value === undefined) {\n      dot_prop.delete(this.data.public, key);\n    } else {\n      dot_prop.set(this.data.public, key, value);\n    }\n    // Question: Should this just be one event at the end?\n    ++this.channel_data_ver;\n    this.emit('channel_data', this.data, `public.${key}`, value);\n  }\n  resp_func();\n};\n\nClientChannelWorker.prototype.getChannelData = function (key, default_value) {\n  return dot_prop.get(this.data, key, default_value);\n};\n\nClientChannelWorker.prototype.setChannelData = function (key, value, skip_predict, resp_func) {\n  if (!skip_predict) {\n    dot_prop.set(this.data, key, value);\n  }\n  let q = value && value.q || undefined;\n  let pak = this.subs.client.pak('set_channel_data');\n  pak.writeAnsiString(this.channel_id);\n  pak.writeBool(q);\n  pak.writeAnsiString(key);\n  pak.writeJSON(value);\n  pak.send(resp_func);\n};\n\nClientChannelWorker.prototype.removeMsgHandler = function (msg, cb) {\n  assert(this.handlers[msg] === cb);\n  delete this.handlers[msg];\n};\n\nClientChannelWorker.prototype.onMsg = function (msg, cb) {\n  assert(!this.handlers[msg] || this.handlers[msg] === cb);\n  this.handlers[msg] = cb;\n};\n\nClientChannelWorker.prototype.pak = function (msg) {\n  let pak = this.subs.client.pak('channel_msg');\n  pak.writeAnsiString(this.channel_id);\n  pak.writeAnsiString(msg);\n  // pak.writeInt(flags);\n  return pak;\n};\n\nClientChannelWorker.prototype.send = function (msg, data, resp_func, old_fourth) {\n  assert(!resp_func || typeof resp_func === 'function');\n  assert(!old_fourth);\n  this.subs.client.send('channel_msg', {\n    channel_id: this.channel_id,\n    msg, data,\n  }, resp_func);\n};\n\nClientChannelWorker.prototype.cmdParse = function (cmd, resp_func) {\n  this.send('cmdparse', cmd, resp_func);\n};\n\nfunction SubscriptionManager(client, cmd_parse) {\n  EventEmitter.call(this);\n  this.client = client;\n  this.channels = {};\n  this.logged_in = false;\n  this.login_credentials = null;\n  this.logged_in_username = null;\n  this.was_logged_in = false;\n  this.logging_in = false;\n  this.logging_out = false;\n  this.auto_create_user = false;\n  this.allow_anon = false;\n  this.no_auto_login = false;\n  this.cmd_parse = cmd_parse;\n  if (cmd_parse) {\n    this.cmds_fetched_by_type = {};\n  }\n  this.base_handlers = {};\n  this.channel_handlers = {}; // channel type -> msg -> handler\n\n  this.first_connect = true;\n  this.server_time = 0;\n  this.server_time_interp = 0;\n  this.cack_data = {};\n  client.onMsg('connect', this.handleConnect.bind(this));\n  client.onMsg('disconnect', this.handleDisconnect.bind(this));\n  client.onMsg('channel_msg', this.handleChannelMessage.bind(this));\n  client.onMsg('server_time', this.handleServerTime.bind(this));\n  client.onMsg('chat_broadcast', this.handleChatBroadcast.bind(this));\n  client.onMsg('restarting', this.handleRestarting.bind(this));\n  if (cmd_parse) {\n    client.onMsg('csr_to_client', this.handleCSRToClient.bind(this));\n  }\n  this.chunked = null;\n  client.onMsg('upload_start', this.handleUploadStart.bind(this));\n  client.onMsg('upload_chunk', this.handleUploadChunk.bind(this));\n  client.onMsg('upload_finish', this.handleUploadFinish.bind(this));\n  // Add handlers for all channel types\n  this.onChannelMsg(null, 'channel_data', ClientChannelWorker.prototype.handleChannelData);\n  this.onChannelMsg(null, 'apply_channel_data', ClientChannelWorker.prototype.handleApplyChannelData);\n  this.onChannelMsg(null, 'batch_set', ClientChannelWorker.prototype.handleBatchSet);\n}\nutil.inherits(SubscriptionManager, EventEmitter);\n\nSubscriptionManager.prototype.onceConnected = function (cb) {\n  if (this.client.connected && this.client.socket.readyState === 1) {\n    return void cb();\n  }\n  this.once('connect', cb);\n};\n\nSubscriptionManager.prototype.getBaseHandlers = function (channel_type) {\n  let handlers = this.channel_handlers[channel_type];\n  if (!handlers) {\n    handlers = this.channel_handlers[channel_type] = Object.create(this.base_handlers);\n  }\n  return handlers;\n};\n\nSubscriptionManager.prototype.onChannelMsg = function (channel_type, msg, cb) {\n  let handlers = channel_type ? this.getBaseHandlers(channel_type) : this.base_handlers;\n  assert(!handlers[msg]);\n  handlers[msg] = cb;\n};\n\nSubscriptionManager.prototype.handleChatBroadcast = function (data) {\n  console.error(`[${data.src}] ${data.msg}`);\n  this.emit('chat_broadcast', data);\n};\n\nSubscriptionManager.prototype.handleRestarting = function (data) {\n  this.restarting = data;\n  this.emit('restarting', data);\n};\n\nSubscriptionManager.prototype.handleDisconnect = function (data) {\n  this.emit('disconnect', data);\n};\n\nSubscriptionManager.prototype.handleConnect = function (data) {\n  let reconnect = false;\n  if (this.first_connect) {\n    this.first_connect = false;\n  } else {\n    reconnect = true;\n  }\n  this.restarting = Boolean(data.restarting);\n  this.cack_data = data;\n  walltime.sync(data.time);\n\n  if (!this.client.connected || this.client.socket.readyState !== 1) { // WebSocket.OPEN\n    // we got disconnected while trying to log in, we'll retry after reconnection\n    return;\n  }\n\n  let subs = this;\n  function resub() {\n    // (re-)subscribe to all channels\n    for (let channel_id in subs.channels) {\n      let channel = subs.channels[channel_id];\n      if (channel.subscriptions) {\n        subs.client.send('subscribe', channel_id, function (err) {\n          if (err) {\n            channel.subscribe_failed = true;\n            console.error(`Error subscribing to ${channel_id}: ${err}`);\n            channel.emit('subscribe_fail', err);\n          }\n        });\n      }\n    }\n    subs.emit('connect', reconnect);\n  }\n\n  if (this.logging_in) {\n    // already have a login in-flight, it should error before we try again\n  } else if (this.was_logged_in) {\n    // Try to re-connect to existing login\n    this.loginInternal(this.login_credentials, (err) => {\n      if (err && err === 'ERR_FAILALL_DISCONNECT') {\n        // we got disconnected while trying to log in, we'll retry after reconnection\n      } else if (err) {\n        // Error logging in upon re-connection, no good way to handle this?\n        // TODO: Show some message to the user and prompt them to refresh?  Stay in \"disconnected\" state?\n        let credentials_str = this.login_credentials && this.login_credentials.password ?\n          'user_id, password' :\n          JSON.stringify(this.login_credentials);\n        assert(false, `Login failed for ${credentials_str}: ${errorString(err)}`);\n      } else {\n        resub();\n      }\n    });\n  } else if (!this.no_auto_login) {\n    // Try auto-login\n    let auto_login_enabled = PLATFORM_FBINSTANT;\n\n    if (auto_login_enabled) {\n      let login_cb = () => {\n        // ignore error on auto-login\n      };\n      if (PLATFORM_FBINSTANT) {\n        this.loginFacebook(login_cb);\n      }\n    } else if (local_storage.get('name') && local_storage.get('password')) {\n      this.login(local_storage.get('name'), local_storage.get('password'), function () {\n        // ignore error on auto-login\n      });\n    }\n\n    resub();\n  } else {\n    resub();\n  }\n\n  this.fetchCmds();\n};\n\nSubscriptionManager.prototype.fetchCmds = function () {\n  let channel_type = 'client';\n  let cmd_list = this.cmds_fetched_by_type;\n  if (cmd_list && !cmd_list[channel_type]) {\n    cmd_list[channel_type] = true;\n    this.client.send('cmd_parse_list_client', null, (err, resp) => {\n      if (!err) {\n        this.cmd_parse.addServerCommands(resp);\n      }\n    });\n  }\n};\n\nSubscriptionManager.prototype.handleChannelMessage = function (pak, resp_func) {\n  assert(isPacket(pak));\n  let channel_id = pak.readAnsiString();\n  let msg = pak.readAnsiString();\n  let is_packet = pak.readBool();\n  let data = is_packet ? pak : pak.readJSON();\n  if (!data || !data.q) {\n    let debug_msg;\n    if (!is_packet) {\n      debug_msg = JSON.stringify(data);\n    } else if (typeof data.contents === 'function') {\n      debug_msg = data.contents();\n    } else {\n      debug_msg = '(pak)';\n    }\n    console.log(`got channel_msg(${channel_id}) ${msg}: ${debug_msg}`);\n  }\n  let channel = this.getChannel(channel_id);\n  let handler = channel.handlers[msg];\n  if (!handler) {\n    console.error(`no handler for channel_msg(${channel_id}) ${msg}: ${JSON.stringify(data)}`);\n    return;\n  }\n  perfCounterAdd(`cm.${channel_id.split('.')[0]}.${msg}`);\n  handler.call(channel, data, resp_func);\n};\n\nSubscriptionManager.prototype.handleServerTime = function (pak) {\n  this.server_time = pak.readInt();\n  if (this.server_time < this.server_time_interp && this.server_time > this.server_time_interp - 250) {\n    // slight time travel backwards, this one packet must have been delayed,\n    // since we once got a packet quicker. Just ignore this, interpolate from\n    // where we were before\n    // TODO: If the server had a short stall (less than 250ms) we might be\n    // ahead from now on!  Slowly interp back to the specified time\n    // (run speed at 90% until it matches?, same thing for catching up to\n    // small jumps ahead)\n  } else {\n    this.server_time_interp = this.server_time;\n  }\n  walltime.sync(pak.readInt());\n};\n\n// DEPRECATED: Not actually a useful unit of time, if your client worker is on a\n//   different process than a particular game worker.\nSubscriptionManager.prototype.getServerTime = function () {\n  // Interpolated server time as of start of last tick\n  return this.server_time_interp;\n};\n\nSubscriptionManager.prototype.tick = function (dt) {\n  this.server_time_interp += dt;\n  for (let channel_id in this.channels) {\n    let channel = this.channels[channel_id];\n    if (channel.immediate_subscribe) {\n      if (dt >= channel.immediate_subscribe) {\n        channel.immediate_subscribe = 0;\n        this.unsubscribe(channel_id);\n      } else {\n        channel.immediate_subscribe -= dt;\n      }\n    }\n  }\n};\n\n\nSubscriptionManager.prototype.onUploadProgress = function (mime_type, cb) {\n  if (!this.upload_progress_cbs) {\n    this.upload_progress_cbs = {};\n  }\n  assert(!this.upload_progress_cbs[mime_type]);\n  this.upload_progress_cbs[mime_type] = cb;\n  if (!this.chunked) {\n    this.chunked = chunkedReceiverInit('client_receive', Infinity);\n  }\n  if (!this.chunked.on_progress) {\n    this.chunked.on_progress = (progress, total, type) => {\n      if (this.upload_progress_cbs[type]) {\n        this.upload_progress_cbs[type](progress, total);\n      }\n    };\n  }\n};\n\nSubscriptionManager.prototype.handleUploadStart = function (pak, resp_func) {\n  if (!this.chunked) {\n    this.chunked = chunkedReceiverInit('client_receive', Infinity);\n  }\n  chunkedReceiverStart(this.chunked, pak, resp_func);\n};\n\nSubscriptionManager.prototype.handleUploadChunk = function (pak, resp_func) {\n  chunkedReceiverOnChunk(this.chunked, pak, resp_func);\n};\n\nSubscriptionManager.prototype.handleUploadFinish = function (pak, resp_func) {\n  chunkedReceiverFinish(this.chunked, pak, resp_func);\n};\n\nSubscriptionManager.prototype.uploadGetFile = function (file_id) {\n  return chunkedReceiverGetFile(this.chunked, file_id);\n};\n\nSubscriptionManager.prototype.uploadFreeFile = function (file_data) {\n  return chunkedReceiverFreeFile(file_data);\n};\n\n\nSubscriptionManager.prototype.subscribe = function (channel_id) {\n  this.getChannel(channel_id, true);\n};\n\nSubscriptionManager.prototype.getChannel = function (channel_id, do_subscribe) {\n  let channel = this.channels[channel_id];\n  if (!channel) {\n    let channel_type = channel_id.split('.')[0];\n    let handlers = this.getBaseHandlers(channel_type);\n    channel = this.channels[channel_id] = new ClientChannelWorker(this, channel_id, handlers);\n  }\n  if (do_subscribe) {\n    channel.subscriptions++;\n    if (!netDisconnected() && channel.subscriptions === 1) {\n      channel.subscribe_failed = false;\n      this.client.send('subscribe', channel_id, function (err) {\n        if (err) {\n          channel.subscribe_failed = true;\n          console.error(`Error subscribing to ${channel_id}: ${err}`);\n          channel.emit('subscribe_fail', err);\n        }\n      });\n    }\n  }\n  return channel;\n};\n\nSubscriptionManager.prototype.getUserId = function () {\n  return this.loggedIn();\n};\n\nSubscriptionManager.prototype.getMyUserChannel = function () {\n  let user_id = this.loggedIn();\n  if (!user_id) {\n    return null;\n  }\n  let channel = this.getChannel(`user.${user_id}`);\n  if (!this.logging_out) {\n    channel.autosubscribed = true;\n  }\n  return channel;\n};\n\nSubscriptionManager.prototype.unsubscribe = function (channel_id) {\n  let channel = this.channels[channel_id];\n  assert(channel);\n  assert(channel.subscriptions);\n  channel.subscriptions--;\n  if (!channel.subscriptions) {\n    channel.got_subscribe = false;\n  }\n  if (!netDisconnected() && !channel.subscriptions && !channel.subscribe_failed) {\n    this.client.send('unsubscribe', channel_id);\n  }\n};\n\n// Immediate-mode channel subscription; will unsubscribe automatically on logout\n//   or if not accessed for some time\nSubscriptionManager.prototype.getChannelImmediate = function (channel_id, timeout) {\n  timeout = timeout || 60000;\n  let channel = this.getChannel(channel_id);\n  if (!channel.immediate_subscribe) {\n    this.subscribe(channel_id);\n  }\n  channel.immediate_subscribe = timeout;\n  return channel;\n};\n\nSubscriptionManager.prototype.onLogin = function (cb) {\n  this.on('login', cb);\n  if (this.logged_in) {\n    return void cb();\n  }\n};\n\nSubscriptionManager.prototype.loggedIn = function () {\n  return this.logging_out ? false : this.logged_in ? this.logged_in_username || 'missing_name' : false;\n};\n\nSubscriptionManager.prototype.userOnChannelData = function (expected_user_id, data, key, value) {\n  if (expected_user_id !== this.getUserId()) {\n    // must have logged out\n    return;\n  }\n  if (key === 'public.display_name') {\n    this.logged_in_display_name = value;\n  }\n};\n\nSubscriptionManager.prototype.handleLoginResponse = function (resp_func, err, resp) {\n  this.logging_in = false;\n  if (!err) {\n    this.logged_in_username = resp.user_id;\n    this.logged_in_display_name = resp.display_name;\n    this.logged_in = true;\n    this.was_logged_in = true;\n    let user_channel = this.getMyUserChannel(); // auto-subscribe to it\n    user_channel.onceSubscribe(() => {\n      if (!this.did_master_subscribe && user_channel.getChannelData('public.permissions.sysadmin')) {\n        // For cmd_parse access\n        this.did_master_subscribe = true;\n        this.subscribe('master.master');\n      }\n    });\n\n    if (!user_channel.subs_added_user_on_channel_data) {\n      user_channel.on('channel_data', this.userOnChannelData.bind(this, this.logged_in_username));\n      user_channel.subs_added_user_on_channel_data = true;\n    }\n    this.emit('login');\n  } else {\n    this.emit('login_fail', err);\n  }\n  resp_func(err);\n};\n\nSubscriptionManager.prototype.loginInternal = function (login_credentials, resp_func) {\n  if (this.logging_in) {\n    return void resp_func('Login already in progress');\n  }\n  this.logging_in = true;\n  this.logged_in = false;\n\n  if (login_credentials.fb) {\n    fbGetLoginInfo((err, result) => {\n      if (err) {\n        return void this.handleLoginResponse(resp_func, err);\n      }\n      if (!this.client.connected) {\n        return void this.handleLoginResponse(resp_func, 'ERR_DISCONNECTED');\n      }\n      this.client.send('login_facebook_instant', result, this.handleLoginResponse.bind(this, resp_func));\n    });\n  } else {\n    this.client.send('login', {\n      user_id: login_credentials.user_id,\n      password: md5(this.client.secret + login_credentials.password),\n    }, this.handleLoginResponse.bind(this, resp_func));\n  }\n};\n\nSubscriptionManager.prototype.userCreateInternal = function (params, resp_func) {\n  if (this.logging_in) {\n    return resp_func('Login already in progress');\n  }\n  this.logging_in = true;\n  this.logged_in = false;\n  return this.client.send('user_create', params, this.handleLoginResponse.bind(this, resp_func));\n};\n\nfunction hashedPassword(user_id, password) {\n  if (password.split('$$')[0] === 'prehashed') {\n    password = password.split('$$')[1];\n  } else {\n    password = md5(md5(user_id.toLowerCase()) + password);\n  }\n  return password;\n}\n\n\nSubscriptionManager.prototype.login = function (username, password, resp_func) {\n  username = (username || '').trim();\n  if (!username) {\n    return resp_func('Missing username');\n  }\n  password = (password || '').trim();\n  if (!password) {\n    return resp_func('Missing password');\n  }\n  let hashed_password = hashedPassword(username, password);\n  if (hashed_password !== password) {\n    local_storage.set('password', `prehashed$$${hashed_password}`);\n  }\n  this.login_credentials = { user_id: username, password: hashed_password };\n  if (!this.auto_create_user) {\n    // Just return result directly\n    return this.loginInternal(this.login_credentials, resp_func);\n  }\n  return this.loginInternal(this.login_credentials, (err, data) => {\n    if (!err || err !== 'ERR_USER_NOT_FOUND') {\n      return void resp_func(err, data);\n    }\n    // user not found, auto-create\n    this.userCreate({\n      user_id: username,\n      password,\n      password_confirm: password,\n      email: 'autocreate@glovjs.org',\n    }, resp_func);\n  });\n};\n\nSubscriptionManager.prototype.loginFacebook = function (resp_func) {\n  this.login_credentials = { fb: true };\n  return this.loginInternal(this.login_credentials, resp_func);\n};\n\nSubscriptionManager.prototype.userCreate = function (params, resp_func) {\n  params.user_id = (params.user_id || '').trim();\n  if (!params.user_id) {\n    return resp_func('Missing username');\n  }\n  params.password = (params.password || '').trim();\n  if (!params.password) {\n    return resp_func('Missing password');\n  }\n  params.password_confirm = (params.password_confirm || '').trim();\n  if (!this.auto_create_user && !params.password_confirm) {\n    return resp_func('Missing password confirmation');\n  }\n  params.email = (params.email || '').trim();\n  if (!this.auto_create_user && !params.email) {\n    return resp_func('Missing email');\n  }\n  params.display_name = (params.display_name || '').trim();\n  let hashed_password = hashedPassword(params.user_id, params.password);\n  if (hashed_password !== params.password) {\n    local_storage.set('password', `prehashed$$${hashed_password}`);\n  }\n  let hashed_password_confirm = hashedPassword(params.user_id, params.password_confirm);\n  if (hashed_password !== hashed_password_confirm) {\n    return resp_func('Passwords do not match');\n  }\n  this.login_credentials = { user_id: params.user_id, password: hashed_password };\n  return this.userCreateInternal({\n    display_name: params.display_name || params.user_id,\n    user_id: params.user_id,\n    email: params.email,\n    password: hashed_password,\n  }, resp_func);\n};\n\n\nSubscriptionManager.prototype.logout = function () {\n  assert(this.logged_in);\n  assert(!this.logging_in);\n  assert(!this.logging_out);\n  // Don't know how to gracefully handle logging out with app-level subscriptions\n  //   currently, clean up those we can, assert we have no others\n  if (this.did_master_subscribe) {\n    this.did_master_subscribe = false;\n    this.unsubscribe('master.master');\n  }\n  for (let channel_id in this.channels) {\n    let channel = this.channels[channel_id];\n    if (channel.immediate_subscribe) {\n      channel.immediate_subscribe = 0;\n      this.unsubscribe(channel_id);\n    }\n    assert(!channel.subscriptions, `Remaining active subscription for ${channel_id}`);\n    if (channel.autosubscribed) {\n      channel.autosubscribed = false;\n    }\n  }\n\n  this.logging_out = true;\n  this.client.send('logout', null, (err) => {\n    this.logging_out = false;\n    if (!err) {\n      local_storage.set('password', undefined);\n      this.logged_in = false;\n      this.logged_in_username = null;\n      this.was_logged_in = false;\n      this.login_credentials = null;\n      this.emit('logout');\n    }\n  });\n};\n\nSubscriptionManager.prototype.serverLog = function (type, data) {\n  this.onceConnected(() => {\n    this.client.send('log', { type, data });\n  });\n};\n\nSubscriptionManager.prototype.sendCmdParse = function (command, resp_func) {\n  this.onceConnected(() => {\n    let pak = this.client.pak('cmd_parse_auto');\n    pak.writeString(command);\n    pak.send(resp_func);\n  });\n};\n\nSubscriptionManager.prototype.handleCSRToClient = function (pak, resp_func) {\n  let cmd = pak.readString();\n  let access = pak.readJSON();\n  this.cmd_parse.handle({ access }, cmd, (err, resp) => {\n    if (err && this.cmd_parse.was_not_found) {\n      // bounce back to server\n      return resp_func(null, { found: 0, err });\n    }\n    return resp_func(err, { found: 1, resp });\n  });\n};\n\nexport function create(client, cmd_parse) {\n  return new SubscriptionManager(client, cmd_parse);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint-env browser */\n\n// eslint-disable-next-line no-use-before-define\nexports.textureLoad = load;\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst engine = require('./engine.js');\nconst { filewatchOn } = require('./filewatch.js');\nconst local_storage = require('./local_storage.js');\nconst settings = require('./settings.js');\nconst urlhash = require('./urlhash.js');\nconst { callEach, isPowerOfTwo, nextHighestPowerOfTwo, ridx } = require('glov/common/util.js');\n\nconst TEX_UNLOAD_TIME = 5 * 60 * 1000; // for textures loaded (each frame) with auto_unload: true\n\nexport let textures = {};\nexport let load_count = 0;\nlet aniso = 4;\nlet max_aniso = 0;\nlet aniso_enum;\n\nlet default_filter_min;\nlet default_filter_mag;\n\nconst cube_faces = [\n  { target: 'TEXTURE_CUBE_MAP_NEGATIVE_X', pos: [0,1] },\n  { target: 'TEXTURE_CUBE_MAP_POSITIVE_X', pos: [0,0] },\n  { target: 'TEXTURE_CUBE_MAP_NEGATIVE_Y', pos: [1,0] },\n  { target: 'TEXTURE_CUBE_MAP_POSITIVE_Y', pos: [1,1] },\n  { target: 'TEXTURE_CUBE_MAP_NEGATIVE_Z', pos: [2,0] },\n  { target: 'TEXTURE_CUBE_MAP_POSITIVE_Z', pos: [2,1] },\n];\n\nexport const format = {\n  R8: { count: 1 },\n  RGB8: { count: 3 },\n  RGBA8: { count: 4 },\n  DEPTH16: { count: 1 },\n  DEPTH24: { count: 1 },\n};\n\nexport function defaultFilters(min, mag) {\n  default_filter_min = min;\n  default_filter_mag = mag;\n}\n\nlet bound_unit = null;\nlet bound_tex = [];\n\nlet handle_loading;\nlet handle_error;\n\nlet frame_timestamp;\n\nfunction setUnit(unit) {\n  if (unit !== bound_unit) {\n    gl.activeTexture(gl.TEXTURE0 + unit);\n    bound_unit = unit;\n  }\n}\n\nfunction bindHandle(unit, target, handle) {\n  if (bound_tex[unit] !== handle) {\n    setUnit(unit);\n    gl.bindTexture(target, handle);\n    bound_tex[unit] = handle;\n  }\n}\n\nfunction unbindAll(target) {\n  for (let unit = 0; unit < bound_tex.length; ++unit) {\n    setUnit(unit);\n    gl.bindTexture(target, target === gl.TEXTURE_2D ? handle_loading : null);\n    bound_tex[unit] = null;\n  }\n}\n\nexport function bind(unit, tex) {\n  tex.last_use = frame_timestamp;\n  // May or may not change the unit\n  bindHandle(unit, tex.target, tex.eff_handle);\n}\n\n// hot path inlined for perf\nexport function bindArray(texs) {\n  for (let ii = 0; ii < texs.length; ++ii) {\n    let tex = texs[ii];\n    tex.last_use = frame_timestamp;\n    let handle = tex.eff_handle;\n    if (bound_tex[ii] !== handle) {\n      if (ii !== bound_unit) {\n        gl.activeTexture(gl.TEXTURE0 + ii);\n        bound_unit = ii;\n      }\n      gl.bindTexture(tex.target, handle);\n      bound_tex[ii] = handle;\n    }\n  }\n}\n\nexport function cmpTextureArray(texsa, texsb) {\n  let d = texsa.length - texsb.length;\n  if (d) {\n    return d;\n  }\n  for (let ii = 0; ii < texsa.length; ++ii) {\n    d = texsa[ii].id - texsb[ii].id;\n    if (d) {\n      return d;\n    }\n  }\n  return 0;\n}\n\nexport function isArrayBound(texs) {\n  for (let ii = 0; ii < texs.length; ++ii) {\n    let tex = texs[ii];\n    let handle = tex.eff_handle;\n    if (bound_tex[ii] !== handle) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function texturesResetState() {\n  bound_unit = -1;\n  if (engine.webgl2) {\n    unbindAll(gl.TEXTURE_2D_ARRAY);\n  }\n  unbindAll(gl.TEXTURE_2D);\n  setUnit(0);\n  // Disabling this.  In theory clearing the GL error at the beginning of the frame\n  //   is good for debugging, and shouldn't actually harm anything (possibly stall\n  //   as it's the first GL call of the frame, but theoretically not much more than\n  //   whatever the next GL call would be), however in practice this is adding up\n  //   to a couple ms (when running at /max_fps 1000) in Chrome.  Does not seem to\n  //   have any effect either way under GPU-bound conditions though.\n  // profilerStart('gl.getError()');\n  // gl.getError();\n  // profilerStop('gl.getError()');\n}\n\n\nlet auto_unload_textures = [];\n\nlet last_id = 0;\nfunction Texture(params) {\n  this.id = ++last_id;\n  this.name = params.name;\n  this.loaded = false;\n  this.load_fail = false;\n  this.target = params.target || gl.TEXTURE_2D;\n  this.is_array = this.target === gl.TEXTURE_2D_ARRAY;\n  this.is_cube = this.target === gl.TEXTURE_CUBE_MAP;\n  this.handle = gl.createTexture();\n  this.eff_handle = handle_loading;\n  this.setSamplerState(params);\n  this.src_width = this.src_height = 1;\n  this.width = this.height = 1;\n  this.nozoom = params.nozoom || false;\n  this.on_load = [];\n  this.gpu_mem = 0;\n  this.soft_error = params.soft_error || false;\n  this.last_use = frame_timestamp;\n  this.auto_unload = params.auto_unload || false;\n  if (this.auto_unload) {\n    auto_unload_textures.push(this);\n  }\n\n  this.format = params.format || format.RGBA8;\n\n  if (params.data) {\n    let err = this.updateData(params.width, params.height, params.data);\n    if (err) {\n      assert(false, `Error loading ${params.name}: ${err}`);\n    }\n  } else {\n    // texture is not valid, do not leave bound\n    unbindAll(this.target);\n    if (params.url) {\n      this.url = params.url;\n      this.loadURL(params.url);\n    }\n  }\n}\n\nTexture.prototype.updateGPUMem = function () {\n  let new_size = this.width * this.height * this.format.count;\n  if (this.mipmaps) {\n    new_size *= 1.5;\n  }\n  let diff = new_size - this.gpu_mem;\n  engine.perf_state.gpu_mem.tex += diff;\n  this.gpu_mem = diff;\n};\n\nfunction bindForced(tex) {\n  let target = tex.target;\n  setUnit(0);\n  bound_tex[0] = null; // Force a re-bind, no matter what\n  bindHandle(0, target, tex.handle);\n}\n\nTexture.prototype.setSamplerState = function (params) {\n  let target = this.target;\n  bindForced(this);\n\n  this.filter_min = params.filter_min || default_filter_min;\n  this.filter_mag = params.filter_mag || default_filter_mag;\n  gl.texParameteri(target, gl.TEXTURE_MIN_FILTER, this.filter_min);\n  gl.texParameteri(target, gl.TEXTURE_MAG_FILTER, this.filter_mag);\n  this.wrap_s = params.wrap_s || gl.REPEAT;\n  this.wrap_t = params.wrap_t || gl.REPEAT;\n  gl.texParameteri(target, gl.TEXTURE_WRAP_S, this.wrap_s);\n  gl.texParameteri(target, gl.TEXTURE_WRAP_T, this.wrap_t);\n\n  this.mipmaps = this.filter_min >= 0x2700 && this.filter_min <= 0x2703 || // Probably gl.LINEAR_MIPMAP_LINEAR\n    params.force_mipmaps;\n\n  if (max_aniso) {\n    if (this.mipmaps && params.filter_mag !== gl.NEAREST) {\n      gl.texParameterf(gl.TEXTURE_2D, aniso_enum, aniso);\n    } else {\n      gl.texParameterf(gl.TEXTURE_2D, aniso_enum, 1);\n    }\n  }\n};\n\nTexture.prototype.updateData = function updateData(w, h, data) {\n  profilerStart('Texture:updateData');\n  assert(!this.destroyed);\n  bindForced(this);\n  this.last_use = frame_timestamp;\n  this.src_width = w;\n  this.src_height = h;\n  this.width = w;\n  this.height = h;\n  // clear the error flag(s) if there are any\n  for (let ii = 0; ii < 10 && gl.getError(); ++ii) {\n    // Error cleared with gl.getError()\n  }\n  // Resize NP2 if this is not being used for a texture array, and it is not explicitly allowed (non-mipmapped, wrapped)\n  let np2 = (!isPowerOfTwo(w) || !isPowerOfTwo(h)) && !this.is_array && !this.is_cube &&\n    !(!this.mipmaps && this.wrap_s === gl.CLAMP_TO_EDGE && this.wrap_t === gl.CLAMP_TO_EDGE);\n  if (np2) {\n    this.width = nextHighestPowerOfTwo(w);\n    this.height = nextHighestPowerOfTwo(h);\n    gl.texImage2D(this.target, 0, this.format.internal_type, this.width, this.height, 0,\n      this.format.internal_type, this.format.gl_type, null);\n  }\n  if (data instanceof Uint8Array) {\n    assert(data.length >= w * h * this.format.count);\n    assert(!this.is_cube);\n    if (this.is_array) {\n      let num_images = h / w; // assume square\n      gl.texImage3D(this.target, 0, this.format.internal_type, w, w,\n        num_images, 0, this.format.internal_type, this.format.gl_type, data);\n    } else if (np2) {\n      // Could do multiple upload thing like below, but smarter, but we really shouldn't be doing this for\n      // in-process generated images!\n      gl.texSubImage2D(this.target, 0, 0, 0, w, h, this.format.internal_type, this.format.gl_type, data);\n    } else {\n      gl.texImage2D(this.target, 0, this.format.internal_type, w, h, 0,\n        this.format.internal_type, this.format.gl_type, data);\n    }\n  } else {\n    // Ensure this is an Image or Canvas\n    if (!data.width) {\n      profilerStop();\n      return `Missing width (${data.width}) (\"${String(data).slice(0, 100)}\")`;\n    }\n    if (this.is_cube) {\n      assert.equal(w * 2, h * 3);\n      let tex_size = h / 2;\n      let canvas = document.createElement('canvas');\n      canvas.width = tex_size;\n      canvas.height = tex_size;\n      let ctx = canvas.getContext('2d');\n      for (let ii = 0; ii < cube_faces.length; ++ii) {\n        let face = cube_faces[ii];\n        ctx.drawImage(data, face.pos[0] * tex_size, face.pos[1] * tex_size, tex_size, tex_size,\n          0, 0, tex_size, tex_size);\n        gl.texImage2D(gl[face.target], 0, this.format.internal_type, this.format.internal_type, this.format.gl_type,\n          canvas);\n      }\n    } else if (this.is_array) {\n      let num_images = h / w;\n      gl.texImage3D(this.target, 0, this.format.internal_type, w, w,\n        num_images, 0, this.format.internal_type, this.format.gl_type, data);\n\n      if (gl.getError()) {\n        // Fix for Samsung devices (Chris's and Galaxy S8 on CrossBrowserTesting)\n        // Also fixes locally on Chrome when using a 8K source texture (was 896x57344),\n        //  perhaps some auto-scaling is going on in the gl.texImage3D call if required?\n        // Try drawing to canvas first\n        let canvas = document.createElement('canvas');\n        canvas.width = w;\n        canvas.height = h;\n        let ctx = canvas.getContext('2d');\n        ctx.drawImage(data, 0, 0);\n        gl.texImage3D(this.target, 0, this.format.internal_type, w, w,\n          num_images, 0, this.format.internal_type, this.format.gl_type, canvas);\n      }\n\n    } else if (np2) {\n      // Pad up to power of two\n      // Duplicate right and bottom pixel row by sending image 3 times\n      if (w !== this.width) {\n        gl.texSubImage2D(this.target, 0, 1, 0, this.format.internal_type, this.format.gl_type, data);\n      }\n      if (h !== this.height) {\n        gl.texSubImage2D(this.target, 0, 0, 1, this.format.internal_type, this.format.gl_type, data);\n      }\n      gl.texSubImage2D(this.target, 0, 0, 0, this.format.internal_type, this.format.gl_type, data);\n    } else {\n      gl.texImage2D(this.target, 0, this.format.internal_type, this.format.internal_type, this.format.gl_type, data);\n    }\n  }\n  let err = null;\n  let gl_err = gl.getError();\n  if (gl_err) {\n    err = `GLError(${gl_err})`;\n  }\n  if (!err && this.mipmaps) {\n    gl.generateMipmap(this.target);\n    gl_err = gl.getError();\n    if (gl_err) {\n      err = `GLError(${gl_err})`;\n    }\n  }\n  if (!err) {\n    this.updateGPUMem();\n    this.eff_handle = this.handle;\n    this.loaded = true;\n\n    callEach(this.on_load, this.on_load = null, this);\n  }\n\n  profilerStop();\n  return err;\n};\n\nTexture.prototype.onLoad = function (cb) {\n  if (this.loaded) {\n    cb(this);\n  } else {\n    this.on_load.push(cb);\n  }\n};\n\nconst TEX_RETRY_COUNT = 4;\nTexture.prototype.loadURL = function loadURL(url, filter) {\n  let tex = this;\n  assert(!tex.destroyed);\n\n  // When our browser's location has been changed from 'site.com/foo/' to\n  //  'site.com/foo/bar/7' our relative image URLs are still relative to the\n  //  base.  Maybe should set some meta tag to do this instead?\n  if (!url.match(/^.{2,7}:/)) {\n    url = `${urlhash.getURLBase()}${url}`;\n  }\n\n  let load_gen = tex.load_gen = (tex.load_gen || 0) + 1;\n  function tryLoad(next) {\n    profilerStart('Texture:tryLoad');\n    let did_next = false;\n    function done(img) {\n      if (!did_next) {\n        did_next = true;\n        return void next(img);\n      }\n    }\n\n    let img = new Image();\n    img.onload = function () {\n      profilerStart('Texture:onload');\n      done(img);\n      profilerStop();\n    };\n    function fail() {\n      done(null);\n    }\n    img.onerror = fail;\n    img.crossOrigin = 'anonymous';\n    img.src = url;\n    profilerStop();\n  }\n\n  ++load_count;\n  let retries = 0;\n  function handleLoad(img) {\n    if (tex.load_gen !== load_gen || tex.destroyed) {\n      // someone else requested this texture to be loaded!  Or, it was already unloaded\n      --load_count;\n      return;\n    }\n    let err_details = '';\n    if (img) {\n      tex.format = format.RGBA8;\n      if (filter) {\n        img = filter(tex, img);\n      }\n      let err = tex.updateData(img.width, img.height, img);\n      if (err) {\n        err_details = `: ${err}`;\n        // Samsung TV gets 1282 on texture arrays\n        // Samsung Galaxy S6 gets 1281 on texture arrays\n        // Note: Any failed image load (partial read of a bad png, etc) also results in 1281!\n        if (tex.is_array && (err === 'GLError(1282)' || err === 'GLError(1281)') && engine.webgl2 && !engine.DEBUG) {\n          local_storage.setJSON('webgl2_disable', {\n            ua: navigator.userAgent,\n            ts: Date.now(),\n          });\n          console.error(`Error loading array texture \"${url}\"${err_details}, reloading without WebGL2..`);\n          engine.reloadSafe();\n          return;\n        }\n        if (!tex.for_reload) {\n          retries = TEX_RETRY_COUNT; // do not retry this\n        }\n      } else {\n        --load_count;\n        return;\n      }\n    }\n    let err_url = url && url.length > 200 ? `${url.slice(0, 200)}...` : url;\n    let err = `Error loading texture \"${err_url}\"${err_details}`;\n    retries++;\n    if (retries > TEX_RETRY_COUNT) {\n      --load_count;\n      tex.eff_handle = handle_error;\n      tex.load_fail = true;\n      console.error(`${err}${err_details ? '' : ', retries failed'}`);\n      if (tex.soft_error) {\n        tex.err = 'Load failed';\n      } else {\n        assert(false, err);\n      }\n      return;\n    }\n    console.error(`${err}, retrying... `);\n    setTimeout(tryLoad.bind(null, handleLoad), 100 * retries * retries);\n  }\n  tryLoad(handleLoad);\n};\n\nTexture.prototype.allocFBO = function (w, h) {\n  const fbo_format = settings.fbo_rgba ? gl.RGBA : gl.RGB;\n  bindForced(this);\n  gl.texImage2D(this.target, 0, fbo_format, w, h, 0, fbo_format, gl.UNSIGNED_BYTE, null);\n\n  this.fbo = gl.createFramebuffer();\n  gl.bindFramebuffer(gl.FRAMEBUFFER, this.fbo);\n  gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.handle, 0);\n\n  this.last_use = frame_timestamp;\n  this.src_width = this.width = w;\n  this.src_height = this.height = h;\n  this.updateGPUMem();\n};\n\nTexture.prototype.allocDepth = function (w, h) {\n  bindForced(this);\n  gl.texImage2D(gl.TEXTURE_2D, 0, this.format.internal_type,\n    w, h, 0, this.format.format, this.format.gl_type, null);\n\n  this.last_use = frame_timestamp;\n  this.src_width = this.width = w;\n  this.src_height = this.height = h;\n  this.updateGPUMem();\n};\n\nTexture.prototype.captureStart = function (w, h) {\n  assert(!this.capture);\n  this.capture = { w, h };\n  if (this.fbo) {\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this.fbo);\n  }\n};\n\nTexture.prototype.captureEnd = function (filter_linear, wrap) {\n  assert(this.capture);\n  let capture = this.capture;\n  this.capture = null;\n  if (this.fbo) {\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n  } else {\n    this.copyTexImage(0, 0, capture.w, capture.h);\n  }\n  let filter = filter_linear ? gl.LINEAR : gl.NEAREST;\n  this.setSamplerState({\n    filter_min: filter,\n    filter_mag: filter,\n    wrap_s: wrap ? gl.REPEAT : gl.CLAMP_TO_EDGE,\n    wrap_t: wrap ? gl.REPEAT : gl.CLAMP_TO_EDGE,\n  });\n};\n\nTexture.prototype.copyTexImage = function (x, y, w, h) {\n  assert(!this.destroyed);\n  assert(w && h);\n  bindHandle(0, this.target, this.handle);\n  gl.copyTexImage2D(this.target, 0, gl.RGB, x, y, w, h, 0);\n  this.last_use = frame_timestamp;\n  this.src_width = this.width = w;\n  this.src_height = this.height = h;\n  this.updateGPUMem();\n};\n\nTexture.prototype.destroy = function () {\n  if (this.destroyed) {\n    return;\n  }\n  assert(this.name);\n  let auto_unload = this.auto_unload;\n  if (auto_unload) {\n    this.auto_unload = null;\n    let idx = auto_unload_textures.indexOf(this);\n    assert(idx !== -1);\n    ridx(auto_unload_textures, idx);\n  }\n  delete textures[this.name];\n  unbindAll(this.target);\n  gl.deleteTexture(this.handle);\n  if (this.fbo) {\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.deleteFramebuffer(this.fbo);\n  }\n  this.width = this.height = 0;\n  this.updateGPUMem();\n  this.destroyed = true;\n  if (typeof auto_unload === 'function') {\n    auto_unload();\n  }\n};\n\nfunction create(params) {\n  assert(params.name);\n  let texture = new Texture(params);\n  textures[params.name] = texture;\n  return texture;\n}\n\nlet last_temporary_id = 0;\nexport function createForCapture(unique_name, auto_unload) {\n  let name = unique_name || `screen_temporary_tex_${++last_temporary_id}`;\n  assert(!textures[name]);\n  let texture = create({\n    filter_min: gl.NEAREST,\n    filter_mag: gl.NEAREST,\n    wrap_s: gl.CLAMP_TO_EDGE,\n    wrap_t: gl.CLAMP_TO_EDGE,\n    format: format.RGB8,\n    name,\n    auto_unload,\n  });\n  texture.loaded = true;\n  texture.eff_handle = texture.handle;\n  return texture;\n}\n\nexport function createForDepthCapture(unique_name, tex_format) {\n  let name = unique_name || `screen_temporary_tex_${++last_temporary_id}`;\n  assert(!textures[name]);\n  let texture = create({\n    filter_min: gl.NEAREST,\n    filter_mag: gl.NEAREST,\n    wrap_s: gl.CLAMP_TO_EDGE,\n    wrap_t: gl.CLAMP_TO_EDGE,\n    format: tex_format,\n    name,\n  });\n  texture.loaded = true;\n  texture.eff_handle = texture.handle;\n  return texture;\n}\n\nexport function load(params) {\n  let key = params.name = params.name || params.url;\n  assert(key);\n  let tex = textures[key];\n  if (!tex) {\n    tex = create(params);\n  }\n  tex.last_use = frame_timestamp;\n  return tex;\n}\n\nexport function cname(key) {\n  let idx = key.lastIndexOf('/');\n  if (idx !== -1) {\n    key = key.slice(idx+1);\n  }\n  idx = key.indexOf('.');\n  if (idx !== -1) {\n    key = key.slice(0, idx);\n  }\n  return key.toLowerCase();\n}\nexport function findTexForReplacement(search_key) {\n  search_key = cname(search_key);\n  for (let key in textures) {\n    let compare_key = cname(key);\n    if (compare_key === search_key) {\n      return textures[key];\n    }\n  }\n  return null;\n}\n\nlet tick_next_tex = 0;\nexport function texturesTick() {\n  frame_timestamp = engine.frame_timestamp;\n  let len = auto_unload_textures.length;\n  if (!len) {\n    return;\n  }\n  if (tick_next_tex >= len) {\n    tick_next_tex = 0;\n  }\n  let tex = auto_unload_textures[tick_next_tex];\n  if (tex.last_use < frame_timestamp - TEX_UNLOAD_TIME) {\n    console.log(`Unloading texture ${tex.name}`);\n    tex.destroy();\n  } else {\n    ++tick_next_tex;\n  }\n}\n\nexport function texturesUnloadDynamic() {\n  while (auto_unload_textures.length) {\n    auto_unload_textures[0].destroy();\n  }\n}\n\nfunction textureReload(filename) {\n  let tex = textures[filename];\n  if (tex && tex.url) {\n    tex.for_reload = true;\n    tex.loadURL(`${tex.url}?rl=${Date.now()}`);\n    return true;\n  }\n  return false;\n}\n\nlet depth_supported;\nexport function textureSupportsDepth() {\n  return depth_supported;\n}\n\nexport function startup() {\n\n  default_filter_min = gl.LINEAR_MIPMAP_LINEAR;\n  default_filter_mag = gl.LINEAR;\n\n  format.R8.internal_type = gl.LUMINANCE;\n  format.R8.gl_type = gl.UNSIGNED_BYTE;\n  format.RGB8.internal_type = gl.RGB;\n  format.RGB8.gl_type = gl.UNSIGNED_BYTE;\n  format.RGBA8.internal_type = gl.RGBA;\n  format.RGBA8.gl_type = gl.UNSIGNED_BYTE;\n\n  let UNSIGNED_INT_24_8;\n  if (engine.webgl2) {\n    depth_supported = true;\n    UNSIGNED_INT_24_8 = gl.UNSIGNED_INT_24_8;\n  } else {\n    let ext = gl.getExtension('WEBGL_depth_texture');\n    if (ext) {\n      UNSIGNED_INT_24_8 = ext.UNSIGNED_INT_24_8_WEBGL;\n      depth_supported = true;\n    }\n  }\n  if (depth_supported) {\n    format.DEPTH16.internal_type = engine.webgl2 ? gl.DEPTH_COMPONENT16 : gl.DEPTH_COMPONENT;\n    format.DEPTH16.format = gl.DEPTH_COMPONENT;\n    format.DEPTH16.gl_type = gl.UNSIGNED_SHORT;\n    format.DEPTH24.internal_type = engine.webgl2 ? gl.DEPTH24_STENCIL8 : gl.DEPTH_STENCIL;\n    format.DEPTH24.format = gl.DEPTH_STENCIL;\n    format.DEPTH24.gl_type = UNSIGNED_INT_24_8;\n  }\n\n  let ext_anisotropic = (\n    gl.getExtension('EXT_texture_filter_anisotropic') ||\n    gl.getExtension('MOZ_EXT_texture_filter_anisotropic') ||\n    gl.getExtension('WEBKIT_EXT_texture_filter_anisotropic')\n  );\n  if (ext_anisotropic) {\n    aniso_enum = ext_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT;\n    aniso = max_aniso = gl.getParameter(ext_anisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT);\n  }\n\n  handle_error = load({\n    name: 'error',\n    width: 2, height: 2,\n    nozoom: true,\n    format: format.RGBA8,\n    filter_mag: gl.NEAREST,\n    data: new Uint8Array([\n      255, 20, 147, 255,\n      255, 0, 0, 255,\n      255, 255, 255, 255,\n      255, 20, 147, 255\n    ]),\n  }).handle;\n\n  handle_loading = load({\n    name: 'loading',\n    width: 2, height: 2,\n    nozoom: true,\n    format: format.RGBA8,\n    data: new Uint8Array([\n      127, 127, 127, 255,\n      0, 0, 0, 255,\n      64, 64, 64, 255,\n      127, 127, 127, 255,\n    ]),\n  }).handle;\n\n  load({\n    name: 'white',\n    width: 2, height: 2,\n    nozoom: true,\n    format: format.RGBA8,\n    data: new Uint8Array([\n      255, 255, 255, 255,\n      255, 255, 255, 255,\n      255, 255, 255, 255,\n      255, 255, 255, 255,\n    ]),\n  });\n\n  load({\n    name: 'invisible',\n    width: 2, height: 2,\n    nozoom: true,\n    format: format.RGBA8,\n    data: new Uint8Array([\n      0, 0, 0, 0,\n      0, 0, 0, 0,\n      0, 0, 0, 0,\n      0, 0, 0, 0,\n    ]),\n  });\n\n  filewatchOn('.png', textureReload);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst camera2d = require('./camera2d.js');\nconst glov_engine = require('./engine.js');\nconst { applyCopy, effectsQueue, effectsIsFinal } = require('./effects.js');\nconst { framebufferCapture, framebufferStart, framebufferEnd, temporaryTextureClaim } = require('./framebuffer.js');\nconst { floor, min, pow, random } = Math;\nconst sprites = require('./sprites.js');\nconst shaders = require('./shaders.js');\nconst textures = require('./textures.js');\nconst glov_ui = require('./ui.js');\nconst { easeOut } = require('glov/common/util.js');\nconst { unit_vec, vec4 } = require('glov/common/vmath.js');\nconst verify = require('glov/common/verify.js');\n\nlet transitions = [];\n\nexport const IMMEDIATE = 'immediate';\n\nexport const REMOVE = 'remove';\nexport const CONTINUE = 'continue';\n\nconst shader_data = {\n  transition_pixelate: {\n    fp: 'shaders/transition_pixelate.fp',\n  },\n};\n\nfunction getShader(key) {\n  let elem = shader_data[key];\n  if (!elem.shader) {\n    elem.shader = shaders.create(elem.fp);\n  }\n  return elem.shader;\n}\n\nfunction GlovTransition(z, func) {\n  this.z = z;\n  this.capture = null;\n  this.func = func;\n  this.accum_time = 0;\n}\n\nfunction transitionCapture(trans) {\n  // Warning: Slow on iOS\n  assert(!trans.capture);\n  trans.capture = textures.createForCapture();\n  framebufferCapture(trans.capture);\n}\n\nfunction transitionCaptureFramebuffer(trans) {\n  assert(!trans.capture);\n  trans.capture = framebufferEnd();\n  temporaryTextureClaim(trans.capture);\n  if (trans.capture.fbo) {\n    // new framebuffer bound, effectively cleared, need to blit this to it!\n    applyCopy({ source: trans.capture, final: effectsIsFinal() });\n  } else {\n    framebufferStart({\n      width: trans.capture.width,\n      height: trans.capture.height,\n      final: effectsIsFinal(),\n    });\n  }\n}\n\nexport function queue(z, fn) {\n  assert(!glov_engine.had_3d_this_frame); // Cannot queue a transition after we've already started 3d rendering/cleared\n  let immediate = false;\n  if (z === IMMEDIATE) {\n    immediate = true;\n    z = Z.TRANSITION_FINAL;\n  }\n\n  for (let ii = 0; ii < transitions.length; ++ii) {\n    let trans = transitions[ii];\n    if (trans.z === z) {\n      // same Z\n      if (!verify(trans.capture)) {\n        // two transitions at the same Z on one frame!  ignore second\n        return false;\n      }\n    }\n  }\n  let trans = new GlovTransition(z, fn);\n  transitions.push(trans);\n\n  if (immediate) {\n    transitionCapture(trans);\n  } else {\n    // queue up a capture past the specified Z, so transitions rendering at that Z (plus a handful) get captured\n    effectsQueue(z + Z.TRANSITION_RANGE, transitionCaptureFramebuffer.bind(null, trans));\n    //sprites.queuefn(z + Z.TRANSITION_RANGE, transitionCapture.bind(null, trans));\n  }\n  return true;\n}\n\nfunction destroyTexture(tex) {\n  profilerStart('transition:destroyTexture');\n  tex.destroy();\n  profilerStop();\n}\n\nexport function render(dt) {\n  dt = min(dt, 100); // debug: clamp frame times\n  for (let trans_idx = 0; trans_idx < transitions.length; ++trans_idx) {\n    let trans = transitions[trans_idx];\n    trans.accum_time += dt;\n    assert(trans.capture);\n    // call the function and give them the Z\n    // If not the last one, want it to end now!\n    let force_end = trans_idx < transitions.length - 1;\n    let ret = trans.func(trans.z, trans.capture, trans.accum_time, force_end);\n    if (ret === REMOVE) {\n      setTimeout(destroyTexture.bind(null, trans.capture), 0);\n      transitions.splice(trans_idx, 1);\n      trans_idx--;\n    }\n  }\n}\n\nexport function active() {\n  return transitions.length;\n}\n\nfunction glovTransitionFadeFunc(fade_time, z, initial, ms_since_start, force_end) {\n  let progress = min(ms_since_start / fade_time, 1);\n  let alpha = (1 - easeOut(progress, 2));\n  let color = vec4(1, 1, 1, alpha);\n  camera2d.setNormalized();\n  sprites.queueraw4([initial],\n    0, 0, 0, 1,\n    1, 1, 1, 0,\n    z,\n    0, 1, 1, 0,\n    color);\n\n  if (force_end || progress === 1) {\n    return REMOVE;\n  }\n  return CONTINUE;\n}\n\n\n/*\n  // Doesn't work because we need more than just 2 UV values in the queue call\nfunction glovTransitionWipeFunc(wipe_time, wipe_angle, z, tex, ms_since_start, force_end) {\n  let progress = min(ms_since_start / wipe_time, 1);\n\n  camera2d.setNormalized();\n\n  let uvs = [[0,1], [1,0]];\n\n  let points = [{}, {}, {}, {}];\n  for (let ii = 0; ii < 4; ii++) {\n    let x = (ii === 1 || ii === 2) ? 1 : 0;\n    let y = (ii >= 2) ? 1 : 0;\n    points[ii].x = x;\n    points[ii].y = y;\n  }\n\n  while (wipe_angle > PI) {\n    wipe_angle -= (2 * PI);\n  }\n  while (wipe_angle < -PI) {\n    wipe_angle += (2 * PI);\n  }\n\n  // TODO: if anyone ever uses this, change 0 degrees to be up, not right, to match other things?\n  if (wipe_angle >= -PI_4 && wipe_angle <= PI_4) {\n    // horizontal wipe from left to right\n    let x0 = progress * 2; // rightmost x\n    let x1 = x0 - sin(abs(wipe_angle)) / SQRT1_2; // leftmost x\n    if (wipe_angle < 0) {\n      points[0].x = x1;\n      points[3].x = x0;\n    } else {\n      points[0].x = x0;\n      points[3].x = x1;\n    }\n    points[1].x = points[2].x = 2;\n  } else if (wipe_angle >= PI_2 + PI_4 || wipe_angle <= -PI_2 - PI_4) {\n    // horizontal wipe from right to left\n    let x0 = 1 - progress * 2; // leftmost x\n    let x1 = x0 + sin(abs(wipe_angle)) / SQRT1_2; // rightmost x,\n    if (wipe_angle < 0) {\n      points[1].x = x1;\n      points[2].x = x0;\n    } else {\n      points[1].x = x0;\n      points[2].x = x1;\n    }\n    points[0].x = points[3].x = -1;\n  } else if (wipe_angle > PI_4 && wipe_angle <= PI_2 + PI_4) {\n    // vertical wipe, top to bottom\n    let y0 = progress * 2; // bottommost y\n    let offs = cos(wipe_angle) / SQRT1_2;\n    let y1 = y0 - abs(offs); // topmost y,\n    if (offs > 0) {\n      points[0].y = y0;\n      points[1].y = y1;\n    } else {\n      points[0].y = y1;\n      points[1].y = y0;\n    }\n    points[2].y = points[3].y = 2;\n  } else {\n    // vertical wipe, bottom to top\n    let y0 = 1 - progress * 2; // topmost y\n    let offs = cos(wipe_angle) / SQRT1_2;\n    let y1 = y0 + abs(offs); // bottommost y,\n    if (offs > 0) {\n      points[2].y = y1;\n      points[3].y = y0;\n    } else {\n      points[2].y = y0;\n      points[3].y = y1;\n    }\n    points[0].y = points[1].y = -1;\n  }\n  // interp UVs based on points\n  points[0].u = lerp(points[0].x, uvs[0][0], uvs[1][0]);\n  points[1].u = lerp(points[1].x, uvs[0][0], uvs[1][0]);\n  points[2].u = lerp(points[2].x, uvs[0][0], uvs[1][0]);\n  points[3].u = lerp(points[3].x, uvs[0][0], uvs[1][0]);\n  points[0].v = lerp(points[0].y, uvs[0][1], uvs[1][1]);\n  points[1].v = lerp(points[1].y, uvs[0][1], uvs[1][1]);\n  points[2].v = lerp(points[2].y, uvs[0][1], uvs[1][1]);\n  points[3].v = lerp(points[3].y, uvs[0][1], uvs[1][1]);\n\n  sprites.queueraw4([tex],\n    points[0].x, points[0].y, points[3].x, points[3].y,\n    points[2].x, points[2].y, points[1].x, points[1].y,\n    z,\n    points[0].u, points[0].v, points[2].u, points[2].v,\n    unit_vec, 'alpha_nearest');\n\n  if (force_end || progress === 1) {\n    return REMOVE;\n  }\n  return CONTINUE;\n}\n\n*/\n\nfunction glovTransitionSplitScreenFunc(time, border_width, slide_window, z, tex, ms_since_start, force_end) {\n  let border_color = vec4(1, 1, 1, 1);\n  let progress = easeOut(min(ms_since_start / time, 1), 2);\n  camera2d.setNormalized();\n\n  let uvs = [[0,1], [1,0]];\n\n  let xoffs = progress;\n  let v_half = uvs[0][1] + (uvs[1][1] - uvs[0][1]) / 2;\n  if (slide_window) { // slide window\n    sprites.queueraw([tex], 0, 0, z, 1 - xoffs, 1 / 2,\n      0, uvs[0][1], uvs[1][0] * (1 - progress), v_half,\n      unit_vec);\n    sprites.queueraw([tex], 0 + xoffs, 1 / 2, z, 1 - xoffs, 1 / 2,\n      uvs[1][0] * progress, v_half, uvs[1][0], uvs[1][1],\n      unit_vec);\n  } else { // slide image\n    sprites.queueraw([tex], 0 - xoffs, 0, z, 1, 1 / 2,\n      uvs[0][0], uvs[0][1], uvs[1][0], v_half,\n      unit_vec);\n    sprites.queueraw([tex], 0 + xoffs, 1 / 2, z, 1, 1 / 2,\n      uvs[0][0], v_half, uvs[1][0], uvs[1][1],\n      unit_vec);\n  }\n  let border_grow_progress = min(progress * 4, 1);\n  border_color[3] = border_grow_progress;\n  border_width *= border_grow_progress;\n  // TODO: Would look better if the horizontal border grew from the middle out, so the overlapping bit is identical\n  // on both sides\n  glov_ui.drawRect(0, 0.5 - border_width, 1 - xoffs, 0.5, z + 1, border_color);\n  glov_ui.drawRect(1 - xoffs - border_width, 0, 1 - xoffs, 0.5, z + 1, border_color);\n  glov_ui.drawRect(xoffs, 0.5, 1, 0.5 + border_width, z + 1, border_color);\n  glov_ui.drawRect(xoffs, 0.5, xoffs + border_width, 1, z + 1, border_color);\n\n  if (force_end || progress === 1) {\n    return REMOVE;\n  }\n  return CONTINUE;\n}\n\nconst render_scale = 1;\nlet transition_pixelate_textures = [null];\n\nfunction transitionPixelateCapture() {\n  let tex = framebufferEnd();\n  framebufferStart({\n    width: tex.width,\n    height: tex.height,\n    final: effectsIsFinal(),\n  });\n  transition_pixelate_textures[0] = tex;\n}\n\nfunction glovTransitionPixelateFunc(time, z, tex, ms_since_start, force_end) {\n  //ms_since_start %= time;\n  //let viewport = glov_engine.graphics_device.getViewport();\n  //let gd_width = viewport[2];\n  let gd_width = glov_engine.width;\n  let progress = min(ms_since_start / time, 1);\n  camera2d.setNormalized();\n\n  transition_pixelate_textures[0] = tex;\n  if (progress > 0.5) {\n    effectsQueue(z, transitionPixelateCapture); // modifies transition_pixelate_textures[]\n  }\n\n  let partial_progress = (progress > 0.5 ? 1 - progress : progress) * 2;\n  // Use power of two scalings, but then scale relative to a 1024px virtual screen, so the biggest\n  //  pixel is about the same percentage of the screen regardless of resolution.\n  let pixel_scale = pow(2, floor(partial_progress * 8.9)) / 1024 * gd_width * render_scale;\n\n  let param0 = vec4(tex.width / pixel_scale, tex.height / pixel_scale,\n    pixel_scale / tex.width, pixel_scale / tex.height);\n  let param1 = vec4(0.5 / tex.width, 0.5 / tex.height,\n    (tex.texSizeX - 1) / tex.width, (tex.texSizeY - 1) / tex.height);\n\n\n  sprites.queueraw(transition_pixelate_textures, 0, 0, z + 1, 1, 1,\n    0, 1, 1, 0,\n    unit_vec, getShader('transition_pixelate'), {\n      param0,\n      param1,\n    });\n\n  if (force_end || progress === 1) {\n    return REMOVE;\n  }\n  return CONTINUE;\n}\n\nexport function fade(fade_time) {\n  return glovTransitionFadeFunc.bind(null, fade_time);\n}\n\n// export function wipe(wipe_time, wipe_angle) {\n//   return glovTransitionWipeFunc.bind(null, wipe_time, wipe_angle);\n// }\n\n// border_width in camera-relative size\nexport function splitScreen(time, border_width, slide_window) {\n  border_width /= camera2d.w(); // convert to normalized units\n  return glovTransitionSplitScreenFunc.bind(null, time, border_width, slide_window);\n}\n\nexport function pixelate(fade_time) {\n  return glovTransitionPixelateFunc.bind(null, fade_time);\n}\n\n// export function logoZoom(time, logo) {\n//   return glovTransitionLogoZoomFunc.bind(null, time, logo);\n// }\n\nexport function randomTransition(fade_time_scale) {\n  fade_time_scale = fade_time_scale || 1;\n  let idx = floor(random() * 3);\n  switch (idx) {\n    case 0:\n      return fade(500 * fade_time_scale);\n    case 1:\n      return splitScreen(250 * fade_time_scale, 2, false);\n    case 2:\n      return pixelate(750 * fade_time_scale);\n    // case 3:\n    //   return wipe(250 * fade_time_scale, random() * 2 * PI);\n    // case 4:\n    //   if (!logo) {\n    //     GlovTextureLoadOptions options;\n    //     options.clamp_s = options.clamp_t = true;\n    //     logo = GlovTextures::loadtex(\"data/SampleLogoTransition.png\", &options);\n    //   }\n    //   glovTransitionQueue(Z_TRANSITION_FINAL, glovTransitionLogoZoom(500, logo));\n    //   break;\n    default:\n      assert(0);\n  }\n  return null;\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint no-underscore-dangle:off */\n\nwindow.Z = window.Z || {};\nexport const Z = window.Z;\n\nexport const Z_MIN_INC = 1e-5;\n\nZ.BORDERS = Z.BORDERS || 90;\nZ.UI = Z.UI || 100;\nZ.MODAL = Z.MODAL || 1000;\nZ.TOOLTIP = Z.TOOLTIP || 2000;\nZ.DEBUG = Z.DEBUG || 9800;\n\n// very high, but can still add integers\nZ.TRANSITION_FINAL = Z.TRANSITION_FINAL || 9900;\n// how much Z range can be used for rendering transitions - the capture happens at z + Z_TRANSITION_RANGE\nZ.TRANSITION_RANGE = Z.TRANSITION_RANGE || 10;\n\nZ.FPSMETER = Z.FPSMETER || 10000;\n\nexport const LINE_ALIGN = 1<<0;\nexport const LINE_CAP_SQUARE = 1<<1;\nexport const LINE_CAP_ROUND = 1<<2;\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst camera2d = require('./camera2d.js');\nconst { editBoxCreate, editBoxTick } = require('./edit_box.js');\nconst effects = require('./effects.js');\nconst { effectsQueue } = effects;\nconst glov_engine = require('./engine.js');\nconst glov_font = require('./font.js');\nconst { fontSetDefaultSize } = glov_font;\nconst glov_input = require('./input.js');\nconst { linkTick } = require('./link.js');\nconst { getStringFromLocalizable } = require('./localization.js');\nconst { abs, floor, max, min, round, sqrt } = Math;\nconst { scrollAreaSetPixelScale } = require('./scroll_area.js');\nconst { soundLoad, soundPlay } = require('./sound.js');\nconst {\n  SPOT_DEFAULT_BUTTON,\n  SPOT_DEFAULT_BUTTON_DRAW_ONLY,\n  SPOT_DEFAULT_LABEL,\n  SPOT_STATE_REGULAR,\n  SPOT_STATE_DOWN,\n  SPOT_STATE_FOCUSED,\n  SPOT_STATE_DISABLED,\n  spot,\n  spotEndOfFrame,\n  spotFocusableCanvas,\n  spotKey,\n  spotPadMode,\n  spotTopOfFrame,\n  spotUnfocus,\n} = require('./spot.js');\nconst glov_sprites = require('./sprites.js');\nconst { clipped, clipPause, clipResume, BLEND_PREMULALPHA } = glov_sprites;\nconst textures = require('./textures.js');\nconst { clamp, clone, defaults, deprecate, lerp, merge } = require('glov/common/util.js');\nconst { mat43, m43identity, m43mul } = require('./mat43.js');\nconst { vec2, vec4, v3scale, unit_vec } = require('glov/common/vmath.js');\n\ndeprecate(exports, 'slider_dragging', 'slider.js:sliderIsDragging()');\ndeprecate(exports, 'slider_rollover', 'slider.js:sliderIsFocused()');\ndeprecate(exports, 'setSliderDefaultShrink', 'slider.js:sliderSetDefaultShrink()');\ndeprecate(exports, 'slider', 'slider.js:slider()');\n\nconst MODAL_DARKEN = 0.75;\nlet KEYS;\nlet PAD;\n\nconst menu_fade_params_default = {\n  blur: [0.125, 0.865],\n  saturation: [0.5, 0.1],\n  brightness: [1, 1 - MODAL_DARKEN],\n  fallback_darken: vec4(0, 0, 0, MODAL_DARKEN),\n  z: Z.MODAL,\n};\n\nlet color_set_shades = vec4(1, 1, 1, 1);\n\nlet color_sets = [];\nfunction applyColorSet(color_set) {\n  v3scale(color_set.regular, color_set.color, color_set_shades[0]);\n  v3scale(color_set.rollover, color_set.color, color_set_shades[1]);\n  v3scale(color_set.down, color_set.color, color_set_shades[2]);\n  v3scale(color_set.disabled, color_set.color, color_set_shades[3]);\n}\nexport function makeColorSet(color) {\n  let ret = {\n    color,\n    regular: vec4(),\n    rollover: vec4(),\n    down: vec4(),\n    disabled: vec4(),\n  };\n  for (let field in ret) {\n    ret[field][3] = color[3];\n  }\n  color_sets.push(ret);\n  applyColorSet(ret);\n  return ret;\n}\n\nlet hooks = [];\nexport function addHook(draw, click) {\n  hooks.push({\n    draw,\n    click,\n  });\n}\n\nlet ui_elem_data = {};\n// Gets per-element state data that allows a paradigm of inter-frame state but\n//   without the caller being required to allocate a state container.\nexport function getUIElemData(type, param, allocator) {\n  let key = spotKey(param);\n  let by_type = ui_elem_data[type];\n  if (!by_type) {\n    by_type = ui_elem_data[type] = {};\n  }\n  let elem_data = by_type[key];\n  if (!elem_data) {\n    elem_data = by_type[key] = allocator ? allocator(param) : {};\n  }\n  elem_data.frame_index = glov_engine.frame_index;\n  return elem_data;\n}\n\nfunction doBlurEffect(factor) {\n  effects.applyGaussianBlur({\n    blur: factor,\n    // min_size: 128,\n  });\n}\n\nlet desaturate_xform = mat43();\nlet desaturate_tmp = mat43();\nfunction doDesaturateEffect(saturation, brightness) {\n  m43identity(desaturate_xform);\n\n  effects.saturationMatrix(desaturate_tmp, saturation);\n  m43mul(desaturate_xform, desaturate_xform, desaturate_tmp);\n\n  effects.brightnessScaleMatrix(desaturate_tmp, brightness);\n  m43mul(desaturate_xform, desaturate_xform, desaturate_tmp);\n\n  // if ((hue % (Math.PI * 2)) !== 0) {\n  //   effects.hueMatrix(tmp, hue);\n  //   m43mul(xform, xform, tmp);\n  // }\n  // if (contrast !== 1) {\n  //   effects.contrastMatrix(tmp, contrast);\n  //   m43mul(xform, xform, tmp);\n  // }\n  // if (brightness !== 0) {\n  //   effects.brightnessMatrix(tmp, brightness);\n  //   m43mul(xform, xform, tmp);\n  // }\n  // if (additiveRGB[0] !== 0 || additiveRGB[1] !== 0 || additiveRGB[2] !== 0) {\n  //   effects.additiveMatrix(tmp, additiveRGB);\n  //   m43mul(xform, xform, tmp);\n  // }\n  // if (grayscale) {\n  //   effects.grayScaleMatrix(tmp);\n  //   m43mul(xform, xform, tmp);\n  // }\n  // if (negative) {\n  //   effects.negativeMatrix(tmp);\n  //   m43mul(xform, xform, tmp);\n  // }\n  // if (sepia) {\n  //   effects.sepiaMatrix(tmp);\n  //   m43mul(xform, xform, tmp);\n  // }\n  effects.applyColorMatrix({\n    colorMatrix: desaturate_xform,\n  });\n}\n\n// overrideable default parameters\nexport let button_height = 32;\nexport let font_height = 24;\nexport let button_width = 200;\nexport let modal_button_width = 100;\nexport let button_img_size = button_height;\nexport let modal_width = 600;\nexport let modal_y0 = 200;\nexport let modal_title_scale = 1.2;\nexport let modal_pad = 16;\nexport let panel_pixel_scale = 32 / 13; // button_height / button pixel resolution\nexport let tooltip_panel_pixel_scale = panel_pixel_scale;\nexport let tooltip_width = 400;\nexport let tooltip_pad = 8;\n\n// export let font_style_focused = glov_font.style(null, {\n//   color: 0x000000ff,\n//   outline_width: 2,\n//   outline_color: 0xFFFFFFff,\n// });\nexport let font_style_normal = glov_font.styleColored(null, 0x000000ff);\nexport let font_style_focused = glov_font.style(font_style_normal, {});\n\nexport let font;\nexport let title_font;\nexport let sprites = {};\n\nexport let color_button = makeColorSet([1,1,1,1]);\nexport let color_panel = vec4(1, 1, 0.75, 1);\nexport let modal_font_style = glov_font.styleColored(null, 0x000000ff);\n\nlet sounds = {};\nexport let button_mouseover = false; // for callers to poll the very last button\nexport let button_focused = false; // for callers to poll the very last button\nexport let button_click = null; // on click, for callers to poll which mouse button, etc\n\nlet modal_dialog = null;\nexport let menu_up = false; // Boolean to be set by app to impact behavior, similar to a modal\nlet menu_fade_params = merge({}, menu_fade_params_default);\nlet menu_up_time = 0;\n\nlet dom_elems = [];\nlet dom_elems_issued = 0;\n\n// for modal dialogs\nlet button_keys;\n\nlet default_line_mode;\n\n// These can be of types string or LocalizableString\nlet buttons_default_labels = {\n  ok: 'OK',\n  cancel: 'Cancel',\n  yes: 'Yes',\n  no: 'No',\n};\nlet default_copy_success_msg = 'Text copied to clipboard!';\nlet default_copy_failure_msg = 'Copy to clipboard FAILED, please copy from below.';\n\nexport function colorSetSetShades(rollover, down, disabled) {\n  color_set_shades[1] = rollover;\n  color_set_shades[2] = down;\n  color_set_shades[3] = disabled;\n  for (let ii = 0; ii < color_sets.length; ++ii) {\n    applyColorSet(color_sets[ii]);\n  }\n}\n\nexport function loadUISprite(name, ws, hs) {\n  let wrap_s = gl.CLAMP_TO_EDGE;\n  let wrap_t = gl.CLAMP_TO_EDGE;\n  sprites[name] = glov_sprites.create({\n    name: `ui/${name}`,\n    ws,\n    hs,\n    wrap_s,\n    wrap_t,\n  });\n}\n\nexport function loadUISprite2(name, param) {\n  if (param === null) {\n    // skip it, assume not used\n    return;\n  }\n  let wrap_s = gl.CLAMP_TO_EDGE;\n  let wrap_t = param.wrap_t ? gl.REPEAT : gl.CLAMP_TO_EDGE;\n  let sprite_param = {\n    ws: param.ws,\n    hs: param.hs,\n    wrap_s,\n    wrap_t,\n    layers: param.layers,\n  };\n  if (param.url) {\n    sprite_param.url = param.url;\n  } else {\n    sprite_param.name = `ui/${param.name || name}`;\n  }\n  sprites[name] = glov_sprites.create(sprite_param);\n}\n\nexport function setFonts(new_font, new_title_font) {\n  font = new_font;\n  title_font = new_title_font || font;\n}\n\nexport function setButtonsDefaultLabels(buttons_labels) {\n  for (const key in buttons_labels) {\n    buttons_default_labels[key.toLowerCase()] = buttons_labels[key];\n  }\n}\n\nexport function setProvideUserStringDefaultMessages(success_msg, failure_msg) {\n  default_copy_success_msg = success_msg;\n  default_copy_failure_msg = failure_msg;\n}\n\nconst base_ui_sprites = {\n  color_set_shades: [1, 1, 1],\n\n  white: { url: 'white' },\n\n  button: { ws: [8, 112, 8], hs: [128] },\n  button_rollover: { ws: [8, 112, 8], hs: [128] },\n  button_down: { ws: [8, 112, 8], hs: [128] },\n  button_disabled: { ws: [8, 112, 8], hs: [128] },\n  panel: { ws: [32, 64, 32], hs: [32, 64, 32] },\n\n  menu_entry: { ws: [8, 112, 8], hs: [128] },\n  menu_selected: { ws: [8, 112, 8], hs: [128] },\n  menu_down: { ws: [8, 112, 8], hs: [128] },\n  menu_header: { ws: [8, 112, 136], hs: [128] },\n  slider: { ws: [56, 16, 56], hs: [128] },\n  // slider_notch: { ws: [3], hs: [13] },\n  slider_handle: { ws: [64], hs: [128] },\n\n  scrollbar_bottom: { ws: [64], hs: [64] },\n  scrollbar_trough: { ws: [64], hs: [8], wrap_t: true },\n  scrollbar_top: { ws: [64], hs: [64] },\n  scrollbar_handle_grabber: { ws: [64], hs: [64] },\n  scrollbar_handle: { ws: [64], hs: [24, 16, 24] },\n  progress_bar: { ws: [48, 32, 48], hs: [128] },\n  progress_bar_trough: { ws: [48, 32, 48], hs: [128] },\n};\n\nexport const ui_sprites_stone = {\n  button: { name: 'stone/button', ws: [32, 64, 32], hs: [128] },\n  button_rollover: { name: 'stone/button_rollover', ws: [32, 64, 32], hs: [128] },\n  button_down: { name: 'stone/button_down', ws: [32, 64, 32], hs: [128] },\n  button_disabled: { name: 'stone/button_disabled', ws: [32, 64, 32], hs: [128] },\n};\n\nexport const ui_sprites_pixely = {\n  color_set_shades: [0.8, 0.7, 0.4],\n\n  button: { name: 'pixely/button', ws: [4, 5, 4], hs: [13] },\n  button_rollover: null,\n  button_down: { name: 'pixely/button_down', ws: [4, 5, 4], hs: [13] },\n  button_disabled: { name: 'pixely/button_disabled', ws: [4, 5, 4], hs: [13] },\n  panel: { name: 'pixely/panel', ws: [3, 2, 3], hs: [3, 10, 3] },\n  menu_entry: { name: 'pixely/menu_entry', ws: [4, 5, 4], hs: [13] },\n  menu_selected: { name: 'pixely/menu_selected', ws: [4, 5, 4], hs: [13] },\n  menu_down: { name: 'pixely/menu_down', ws: [4, 5, 4], hs: [13] },\n  menu_header: { name: 'pixely/menu_header', ws: [4, 5, 12], hs: [13] },\n  slider: { name: 'pixely/slider', ws: [6, 2, 6], hs: [13] },\n  // slider_notch:  name: 'pixely///',{ ws: [3], hs: [13] },\n  slider_handle: { name: 'pixely/slider_handle', ws: [9], hs: [13] },\n\n  scrollbar_bottom: { name: 'pixely/scrollbar_bottom', ws: [11], hs: [13] },\n  scrollbar_trough: { name: 'pixely/scrollbar_trough', ws: [11], hs: [8], wrap_t: true },\n  scrollbar_top: { name: 'pixely/scrollbar_top', ws: [11], hs: [13] },\n  scrollbar_handle_grabber: { name: 'pixely/scrollbar_handle_grabber', ws: [11], hs: [13] },\n  scrollbar_handle: { name: 'pixely/scrollbar_handle', ws: [11], hs: [3, 7, 3] },\n  progress_bar: { name: 'pixely/progress_bar', ws: [3, 7, 3], hs: [13] },\n  progress_bar_trough: { name: 'pixely/progress_bar_trough', ws: [3, 7, 3], hs: [13] },\n};\n\nexport function startup(param) {\n  font = param.font;\n  title_font = param.title_font || font;\n  let overrides = param.ui_sprites;\n  KEYS = glov_input.KEYS;\n  PAD = glov_input.PAD;\n\n  let ui_sprites = {\n    ...base_ui_sprites,\n    ...param.ui_sprites,\n  };\n\n  for (let key in ui_sprites) {\n    let base_elem = base_ui_sprites[key];\n    if (typeof base_elem === 'object' && !Array.isArray(base_elem)) {\n      let override = overrides && overrides[key];\n      loadUISprite2(key, override === undefined ? base_elem : override);\n    }\n  }\n  sprites.button_regular = sprites.button;\n\n  if (ui_sprites.color_set_shades) {\n    colorSetSetShades(...ui_sprites.color_set_shades);\n  }\n\n  if (sprites.button_rollover && color_set_shades[1] !== 1) {\n    colorSetSetShades(1, color_set_shades[2], color_set_shades[3]);\n  }\n  if (sprites.button_down && color_set_shades[2] !== 1) {\n    colorSetSetShades(color_set_shades[1], 1, color_set_shades[3]);\n  }\n  if (sprites.button_disabled && color_set_shades[3] !== 1) {\n    colorSetSetShades(color_set_shades[1], color_set_shades[2], 1);\n  }\n\n  button_keys = {\n    ok: { key: [KEYS.O], pad: [PAD.X], low_key: [KEYS.ESC] },\n    cancel: { key: [KEYS.ESC], pad: [PAD.B, PAD.Y] },\n  };\n  button_keys.yes = clone(button_keys.ok);\n  button_keys.yes.key.push(KEYS.Y);\n  button_keys.no = clone(button_keys.cancel);\n  button_keys.no.key.push(KEYS.N);\n\n  if (param.line_mode !== undefined) {\n    default_line_mode = param.line_mode;\n  } else {\n    default_line_mode = LINE_ALIGN|LINE_CAP_ROUND;\n    // let is_pixely = param.pixely && param.pixely !== 'off';\n    // if (is_pixely) {\n    //   // Maybe want to not do aligning here, causes inconsistencies when smoothly scrolling\n    //   default_line_mode = 0;\n    // }\n  }\n\n  // eslint-disable-next-line no-use-before-define\n  scaleSizes(1);\n}\n\nlet dynamic_text_elem;\nlet per_frame_dom_alloc = [0,0,0,0,0,0,0];\nlet per_frame_dom_suppress = 0;\nexport function suppressNewDOMElemWarnings() {\n  per_frame_dom_suppress = glov_engine.frame_index + 1;\n}\nexport function uiGetDOMElem(last_elem, allow_modal) {\n  if (modal_dialog && !allow_modal) {\n    // Note: this case is no longer needed for edit boxes (spot's focus logic\n    //   handles this), but links still rely on this\n    return null;\n  }\n  if (dom_elems_issued >= dom_elems.length || !last_elem) {\n    let elem = document.createElement('div');\n    if (glov_engine.DEBUG && !glov_engine.resizing() && glov_engine.frame_index > per_frame_dom_suppress) {\n      per_frame_dom_alloc[glov_engine.frame_index % per_frame_dom_alloc.length] = 1;\n      let sum = 0;\n      for (let ii = 0; ii < per_frame_dom_alloc.length; ++ii) {\n        sum += per_frame_dom_alloc[ii];\n      }\n      assert(sum < per_frame_dom_alloc.length, 'Allocated new DOM elements for too many consecutive frames');\n    }\n    elem.setAttribute('class', 'glovui_dynamic');\n    if (!dynamic_text_elem) {\n      dynamic_text_elem = document.getElementById('dynamic_text');\n    }\n    dynamic_text_elem.appendChild(elem);\n    dom_elems.push(elem);\n    last_elem = elem;\n  }\n  if (dom_elems[dom_elems_issued] !== last_elem) {\n    for (let ii = dom_elems_issued + 1; ii < dom_elems.length; ++ii) {\n      if (dom_elems[ii] === last_elem) {\n        dom_elems[ii] = dom_elems[dom_elems_issued];\n        dom_elems[dom_elems_issued] = last_elem;\n      }\n    }\n  }\n  let elem = dom_elems[dom_elems_issued];\n  dom_elems_issued++;\n  return elem;\n}\n\nexport function bindSounds(_sounds) {\n  sounds = _sounds;\n  for (let key in sounds) {\n    soundLoad(sounds[key]);\n  }\n}\n\nexport function drawHBox(coords, s, color) {\n  let uidata = s.uidata;\n  let x = coords.x;\n  let ws = [uidata.wh[0] * coords.h, 0, uidata.wh[2] * coords.h];\n  if (coords.no_min_width && ws[0] + ws[2] > coords.w) {\n    let scale = coords.w / (ws[0] + ws[2]);\n    ws[0] *= scale;\n    ws[2] *= scale;\n  } else {\n    ws[1] = max(0, coords.w - ws[0] - ws[2]);\n  }\n  for (let ii = 0; ii < ws.length; ++ii) {\n    let my_w = ws[ii];\n    if (my_w) {\n      let draw_param = {\n        x,\n        y: coords.y,\n        z: coords.z || Z.UI,\n        color,\n        w: my_w,\n        h: coords.h,\n        uvs: uidata.rects[ii],\n        nozoom: true, // nozoom since different parts of the box get zoomed differently\n      };\n      if (coords.color1) {\n        draw_param.color1 = coords.color1;\n        s.drawDualTint(draw_param);\n      } else {\n        s.draw(draw_param);\n      }\n    }\n    x += my_w;\n  }\n}\n\nexport function drawVBox(coords, s, color) {\n  let uidata = s.uidata;\n  let hs = [uidata.hw[0] * coords.w, 0, uidata.hw[2] * coords.w];\n  let y = coords.y;\n  hs[1] = max(0, coords.h - hs[0] - hs[2]);\n  for (let ii = 0; ii < hs.length; ++ii) {\n    let my_h = hs[ii];\n    s.draw({\n      x: coords.x,\n      y,\n      z: coords.z,\n      color,\n      w: coords.w,\n      h: my_h,\n      uvs: uidata.rects[ii],\n      nozoom: true, // nozoom since different parts of the box get zoomed differently\n    });\n    y += my_h;\n  }\n}\n\nexport function drawBox(coords, s, pixel_scale, color) {\n  let uidata = s.uidata;\n  let scale = pixel_scale;\n  let ws = [uidata.widths[0] * scale, 0, uidata.widths[2] * scale];\n  ws[1] = max(0, coords.w - ws[0] - ws[2]);\n  let hs = [uidata.heights[0] * scale, 0, uidata.heights[2] * scale];\n  hs[1] = max(0, coords.h - hs[0] - hs[2]);\n  let x = coords.x;\n  for (let ii = 0; ii < ws.length; ++ii) {\n    let my_w = ws[ii];\n    if (my_w) {\n      let y = coords.y;\n      for (let jj = 0; jj < hs.length; ++jj) {\n        let my_h = hs[jj];\n        if (my_h) {\n          s.draw({\n            x, y, z: coords.z,\n            color,\n            w: my_w,\n            h: my_h,\n            uvs: uidata.rects[jj * 3 + ii],\n            nozoom: true, // nozoom since different parts of the box get zoomed differently\n          });\n          y += my_h;\n        }\n      }\n      x += my_w;\n    }\n  }\n}\n\nexport function drawMultiPartBox(coords, scaleable_data, s, pixel_scale, color) {\n  let uidata = s.uidata;\n  let scale = pixel_scale;\n\n  let ws = [];\n  let fixed_w_sum = 0;\n  let scaleable_sum = 0;\n  for (let i = 0; i < uidata.widths.length; i++) {\n    if (scaleable_data.widths[i] < 0) {\n      ws.push(uidata.widths[i] * scale);\n      fixed_w_sum += uidata.widths[i] * scale;\n    } else {\n      ws.push(0);\n      scaleable_sum += scaleable_data.widths[i];\n    }\n  }\n  assert(scaleable_sum === 1);\n  for (let i = 0; i < uidata.widths.length; i++) {\n    if (scaleable_data.widths[i] >= 0) {\n      ws[i] = max(0, (coords.w - fixed_w_sum) * scaleable_data.widths[i]);\n    }\n  }\n\n  scaleable_sum = 0;\n  let hs = [];\n  let fixed_h_sum = 0;\n  for (let i = 0; i < uidata.heights.length; i++) {\n    if (scaleable_data.heights[i] < 0) {\n      hs.push(uidata.heights[i] * scale);\n      fixed_h_sum += uidata.heights[i] * scale;\n    } else {\n      hs.push(0);\n      scaleable_sum += scaleable_data.heights[i];\n    }\n  }\n  assert(scaleable_sum === 1);\n  for (let i = 0; i < uidata.heights.length; i++) {\n    if (scaleable_data.heights[i] >= 0) {\n      hs[i] = max(0, (coords.h - fixed_h_sum) * scaleable_data.heights[i]);\n    }\n  }\n  let x = coords.x;\n  for (let ii = 0; ii < ws.length; ++ii) {\n    let my_w = ws[ii];\n    if (my_w) {\n      let y = coords.y;\n      for (let jj = 0; jj < hs.length; ++jj) {\n        let my_h = hs[jj];\n        if (my_h) {\n          s.draw({\n            x, y, z: coords.z,\n            color,\n            w: my_w,\n            h: my_h,\n            uvs: uidata.rects[jj * ws.length + ii],\n            nozoom: true, // nozoom since different parts of the box get zoomed differently\n          });\n          y += my_h;\n        }\n      }\n      x += my_w;\n    }\n  }\n}\n\nexport function playUISound(name, volume) {\n  if (name === 'select') {\n    name = 'button_click';\n  }\n  if (sounds[name]) {\n    soundPlay(sounds[name], volume);\n  }\n}\n\nexport function focusCanvas() {\n  spotUnfocus();\n}\n\n// Returns true if the navigation inputs (arrows, etc) should go to the UI, not the app\nexport function uiHandlingNav() {\n  return menu_up || !spotFocusableCanvas().focused;\n}\n\nexport function panel(param) {\n  assert(typeof param.x === 'number');\n  assert(typeof param.y === 'number');\n  assert(typeof param.w === 'number');\n  assert(typeof param.h === 'number');\n  param.z = param.z || (Z.UI - 1);\n  param.eat_clicks = param.eat_clicks === undefined ? true : param.eat_clicks;\n  let color = param.color || color_panel;\n  drawBox(param, param.sprite || sprites.panel, param.pixel_scale || panel_pixel_scale, color);\n  if (param.eat_clicks) {\n    glov_input.mouseOver(param);\n  }\n}\n\nexport function drawTooltip(param) {\n  param.tooltip = getStringFromLocalizable(param.tooltip);\n\n  assert(typeof param.x === 'number');\n  assert(typeof param.y === 'number');\n  assert(typeof param.tooltip === 'string');\n\n  let clip_pause = clipped();\n  if (clip_pause) {\n    clipPause();\n  }\n\n  let tooltip_w = param.tooltip_width || tooltip_width;\n  let z = param.z || Z.TOOLTIP;\n  let tooltip_y0 = param.y;\n  let eff_tooltip_pad = param.tooltip_pad || tooltip_pad;\n  let w = tooltip_w - eff_tooltip_pad * 2;\n  let dims = font.dims(modal_font_style, w, 0, font_height, param.tooltip);\n  let above = param.tooltip_above;\n  if (!above && param.tooltip_auto_above_offset) {\n    above = tooltip_y0 + dims.h + eff_tooltip_pad * 2 > camera2d.y1();\n  }\n  let x = param.x;\n  let eff_tooltip_w = dims.w + eff_tooltip_pad * 2;\n  if (x + eff_tooltip_w > camera2d.x1()) {\n    x = camera2d.x1() - eff_tooltip_w;\n  }\n\n  if (above) {\n    tooltip_y0 -= dims.h + eff_tooltip_pad * 2 + (param.tooltip_auto_above_offset || 0);\n  }\n  let y = tooltip_y0 + eff_tooltip_pad;\n  y += font.drawSizedWrapped(modal_font_style,\n    x + eff_tooltip_pad, y, z+1, w, 0, font_height,\n    param.tooltip);\n  y += eff_tooltip_pad;\n  let pixel_scale = param.pixel_scale || tooltip_panel_pixel_scale;\n\n  panel({\n    x,\n    y: tooltip_y0,\n    z,\n    w: eff_tooltip_w,\n    h: y - tooltip_y0,\n    pixel_scale,\n    eat_clicks: false,\n  });\n  if (clip_pause) {\n    clipResume();\n  }\n}\n\nexport function checkHooks(param, click) {\n  if (param.hook) {\n    for (let ii = 0; ii < hooks.length; ++ii) {\n      if (click) {\n        hooks[ii].click(param);\n      }\n      hooks[ii].draw(param);\n    }\n  }\n}\n\nexport function drawTooltipBox(param) {\n  drawTooltip({\n    x: param.x,\n    y: param.y + param.h + 2,\n    tooltip_auto_above_offset: param.h + 4,\n    tooltip_above: param.tooltip_above,\n    tooltip: param.tooltip,\n    tooltip_width: param.tooltip_width,\n  });\n}\n\nexport function progressBar(param) {\n  drawHBox(param, sprites.progress_bar_trough, param.color_trough || param.color || unit_vec);\n  let progress = clamp(param.progress, 0, 1);\n  drawHBox({\n    x: param.x + (param.centered ? param.w * (1-progress) * 0.5 : 0),\n    y: param.y,\n    z: (param.z || Z.UI) + Z_MIN_INC,\n    w: param.w * progress,\n    h: param.h,\n    no_min_width: true,\n  }, sprites.progress_bar, param.color || unit_vec);\n  if (param.tooltip) {\n    spot({\n      x: param.x, y: param.y,\n      w: param.w, h: param.h,\n      tooltip: param.tooltip,\n      def: SPOT_DEFAULT_LABEL,\n    });\n  }\n}\n\n// TODO: refactor so callers all use the new states 'focused'\nconst SPOT_STATE_TO_UI_BUTTON_STATE = {\n  [SPOT_STATE_REGULAR]: 'regular',\n  [SPOT_STATE_DOWN]: 'down',\n  [SPOT_STATE_FOCUSED]: 'rollover',\n  [SPOT_STATE_DISABLED]: 'disabled',\n};\n\nconst UISPOT_BUTTON_DISABLED = {\n  ...SPOT_DEFAULT_BUTTON,\n  disabled: true,\n  disabled_focusable: false,\n  sound_rollover: null,\n};\n\n\nexport function buttonShared(param) {\n  profilerStartFunc();\n  param.z = param.z || Z.UI;\n  if (param.rollover_quiet) {\n    param.sound_rollover = null;\n  }\n  let spot_ret;\n  if (param.draw_only && !param.draw_only_mouseover) {\n    // no spot() needed\n    spot_ret = { ret: false, state: 'regular', focused: false };\n  } else {\n    if (param.draw_only) {\n      assert(!param.def || param.def === SPOT_DEFAULT_BUTTON_DRAW_ONLY);\n      param.def = SPOT_DEFAULT_BUTTON_DRAW_ONLY;\n    } else if (param.disabled && !param.disabled_focusable) {\n      param.def = param.def || UISPOT_BUTTON_DISABLED;\n    } else {\n      param.def = param.def || SPOT_DEFAULT_BUTTON;\n    }\n    if (param.sound) {\n      param.sound_button = param.sound;\n    }\n    spot_ret = spot(param);\n    spot_ret.state = SPOT_STATE_TO_UI_BUTTON_STATE[spot_ret.spot_state];\n    if (spot_ret.ret) {\n      // TODO: refactor callers to gather this from spot_ret, passes as return from button()/etc\n      button_click = spot_ret;\n      button_click.was_double_click = spot_ret.double_click;\n    }\n  }\n\n  button_focused = button_mouseover = spot_ret.focused;\n  param.z += param.z_bias && param.z_bias[spot_ret.state] || 0;\n  profilerStopFunc();\n  return spot_ret;\n}\n\nexport let button_last_color;\nexport function buttonBackgroundDraw(param, state) {\n  profilerStartFunc();\n  let colors = param.colors || color_button;\n  let color = button_last_color = param.color || colors[state];\n  if (!param.no_bg) {\n    let base_name = param.base_name || 'button';\n    let sprite_name = `${base_name}_${state}`;\n    let sprite = sprites[sprite_name];\n    // Note: was if (sprite) color = colors.regular for specific-sprite matches\n    if (!sprite) {\n      sprite = sprites[base_name];\n    }\n\n    drawHBox(param, sprite, color);\n  }\n  profilerStopFunc();\n}\n\nexport function buttonSpotBackgroundDraw(param, spot_state) {\n  profilerStartFunc();\n  let state = SPOT_STATE_TO_UI_BUTTON_STATE[spot_state];\n  let colors = param.colors || color_button;\n  let color = button_last_color = param.color || colors[state];\n  if (!param.no_bg) {\n    let base_name = param.base_name || 'button';\n    let sprite_name = `${base_name}_${state}`;\n    let sprite = sprites[sprite_name];\n    // Note: was if (sprite) color = colors.regular for specific-sprite matches\n    if (!sprite) {\n      sprite = sprites[base_name];\n    }\n\n    drawHBox(param, sprite, color);\n  }\n  profilerStopFunc();\n}\n\nexport function buttonTextDraw(param, state, focused) {\n  profilerStartFunc();\n  buttonBackgroundDraw(param, state);\n  let hpad = min(param.font_height * 0.25, param.w * 0.1);\n  font.drawSizedAligned(\n    focused ? font_style_focused : font_style_normal,\n    param.x + hpad, param.y, param.z + 0.1,\n    param.font_height, param.align || glov_font.ALIGN.HVCENTERFIT, param.w - hpad * 2, param.h, param.text);\n  profilerStopFunc();\n}\n\nexport function buttonText(param) {\n  profilerStartFunc();\n  param.text = getStringFromLocalizable(param.text);\n\n  // required params\n  assert(typeof param.x === 'number');\n  assert(typeof param.y === 'number');\n  assert(typeof param.text === 'string');\n  // optional params\n  // param.z = param.z || Z.UI;\n  param.w = param.w || button_width;\n  param.h = param.h || button_height;\n  param.font_height = param.font_height || font_height;\n\n  let spot_ret = buttonShared(param);\n  let { ret, state, focused } = spot_ret;\n  buttonTextDraw(param, state, focused);\n  profilerStopFunc();\n  return ret ? spot_ret : null;\n}\n\nfunction buttonImageDraw(param, state, focused) {\n  profilerStartFunc();\n  let uvs = param.img_rect;\n  let img = param.imgs && param.imgs[state] || param.img;\n  if (typeof param.frame === 'number') {\n    uvs = img.uidata.rects[param.frame];\n  }\n  buttonBackgroundDraw(param, state);\n  let color = button_last_color;\n  let img_origin = img.origin;\n  let img_w = img.size[0];\n  let img_h = img.size[1];\n  let aspect = img_w / img_h;\n  if (typeof param.frame === 'number') {\n    aspect = img.uidata.aspect ? img.uidata.aspect[param.frame] : 1;\n  }\n  let largest_w_horiz = param.w * param.shrink;\n  let largest_w_vert = param.h * param.shrink * aspect;\n  img_w = min(largest_w_horiz, largest_w_vert);\n  img_h = img_w / aspect;\n  let pad_top = (param.h - img_h) / 2;\n  let draw_param = {\n    x: param.x + (param.left_align ? pad_top : (param.w - img_w) / 2) + img_origin[0] * img_w,\n    y: param.y + pad_top + img_origin[1] * img_h,\n    z: param.z + Z_MIN_INC,\n    // use img_color if provided, use explicit tint if doing dual-tinting, otherwise button color\n    color: param.img_color || param.color1 && param.color || color,\n    color1: param.color1,\n    w: img_w / img.size[0],\n    h: img_h / img.size[1],\n    uvs,\n    rot: param.rotation,\n  };\n  if (param.flip) {\n    let { x, w } = draw_param;\n    draw_param.x = x + w;\n    draw_param.w = -w;\n  }\n  if (param.color1) {\n    img.drawDualTint(draw_param);\n  } else {\n    img.draw(draw_param);\n  }\n  profilerStopFunc();\n}\n\nexport function buttonImage(param) {\n  profilerStartFunc();\n  // required params\n  assert(typeof param.x === 'number');\n  assert(typeof param.y === 'number');\n  assert(param.imgs || param.img && param.img.draw); // should be a sprite\n  // optional params\n  param.z = param.z || Z.UI;\n  param.w = param.w || button_img_size;\n  param.h = param.h || param.w || button_img_size;\n  param.shrink = param.shrink || 0.75;\n  //param.img_rect; null -> full image\n\n  let spot_ret = buttonShared(param);\n  let { ret, state, focused } = spot_ret;\n  buttonImageDraw(param, state, focused);\n  profilerStopFunc();\n  return ret ? spot_ret : null;\n}\n\nexport function button(param) {\n  if (param.img && !param.text) {\n    return buttonImage(param);\n  } else if (param.text && !param.img) {\n    return buttonText(param);\n  }\n  profilerStartFunc();\n\n  // required params\n  assert(typeof param.x === 'number');\n  assert(typeof param.y === 'number');\n  assert(param.img && param.img.draw); // should be a sprite\n  // optional params\n  param.z = param.z || Z.UI;\n  // w/h initialize differently than either buttonText or buttonImage\n  param.h = param.h || button_img_size;\n  param.w = param.w || button_width;\n  param.shrink = param.shrink || 0.75;\n  //param.img_rect; null -> full image\n  param.left_align = true; // always left-align images\n  param.font_height = param.font_height || font_height;\n\n  let spot_ret = buttonShared(param);\n  let { ret, state, focused } = spot_ret;\n  buttonImageDraw(param, state, focused);\n  // Hide some stuff on the second draw\n  let saved_no_bg = param.no_bg;\n  let saved_w = param.w;\n  let saved_x = param.x;\n  param.no_bg = true;\n  param.x += param.h * param.shrink;\n  param.w -= param.h * param.shrink;\n  buttonTextDraw(param, state, focused);\n\n  param.no_bg = saved_no_bg;\n  param.w = saved_w;\n  param.x = saved_x;\n  profilerStopFunc();\n  return ret ? spot_ret : null;\n}\n\nexport function print(style, x, y, z, text) {\n  return font.drawSized(style, x, y, z, font_height, text);\n}\n\nexport function label(param) {\n  profilerStartFunc();\n  let { style, x, y, align, w, h, text, tooltip } = param;\n  text = getStringFromLocalizable(text);\n  let use_font = param.font || font;\n  let z = param.z || Z.UI;\n  let size = param.size || font_height;\n  assert(isFinite(x));\n  assert(isFinite(y));\n  assert.equal(typeof text, 'string');\n  if (tooltip) {\n    if (!w) {\n      w = use_font.getStringWidth(style, size, text);\n    }\n    assert(isFinite(w));\n    assert(isFinite(h));\n    let spot_ret = spot({\n      x, y, w, h,\n      tooltip: tooltip,\n      def: SPOT_DEFAULT_LABEL,\n    });\n    if (spot_ret.focused && spotPadMode()) {\n      if (param.style_focused) {\n        style = param.style_focused;\n      } else {\n        // No focused style provided, do a generic glow instead?\n        // eslint-disable-next-line no-use-before-define\n        drawElipse(x - w*0.25, y-h*0.25, x + w*1.25, y + h*1.25, z - 0.001, 0.5, unit_vec);\n      }\n    }\n  }\n  if (text) {\n    if (align) {\n      use_font.drawSizedAligned(style, x, y, z, size, align, w, h, text);\n    } else {\n      use_font.drawSized(style, x, y, z, size, text);\n    }\n  }\n  profilerStopFunc();\n}\n\n// Note: modal dialogs not really compatible with HTML overlay on top of the canvas!\nexport function modalDialog(param) {\n  param.title = getStringFromLocalizable(param.title);\n  param.text = `${getStringFromLocalizable(param.text) || ''}`;\n\n  assert(!param.title || typeof param.title === 'string');\n  assert(!param.text || typeof param.text === 'string');\n  assert(!param.buttons || typeof param.buttons === 'object');\n  if (param.buttons) {\n    for (let key in param.buttons) {\n      if (typeof param.buttons[key] !== 'object') {\n        // Button is function or null\n        param.buttons[key] = { cb: param.buttons[key] };\n      }\n    }\n  }\n  // assert(Object.keys(param.buttons).length);\n  modal_dialog = param;\n}\n\nexport function modalDialogClear() {\n  modal_dialog = null;\n}\n\nlet dom_requirement = vec2(24,24);\nlet virtual_size = vec2();\nfunction modalDialogRun() {\n  camera2d.domDeltaToVirtual(virtual_size, dom_requirement);\n  let fullscreen_mode = false;\n  let eff_font_height = modal_dialog.font_height || font_height;\n  let eff_button_height = button_height;\n  let pad = modal_pad;\n  let vpad = modal_pad * 0.5;\n  let general_scale = 1;\n  let exit_lock = true;\n  let num_lines;\n  if (virtual_size[0] > 0.05 * camera2d.h() && camera2d.w() > camera2d.h() * 2) {\n    // If a 24-pt font is more than 5% of the camera height, we're probably super-wide-screen\n    // on a mobile device due to keyboard being visible\n    fullscreen_mode = true;\n    eff_button_height = eff_font_height;\n    vpad = pad = 4;\n\n    let old_h = camera2d.h();\n    camera2d.push();\n    // Find a number of lines (and implicit scaling) such they all fit\n    for (num_lines = 1; ; num_lines++) {\n      camera2d.setAspectFixed2(1, eff_font_height * (modal_title_scale + 1 + num_lines) + pad * 4.5);\n      general_scale = camera2d.h() / old_h;\n      if (!modal_dialog.text) {\n        break;\n      }\n      const game_width = camera2d.x1() - camera2d.x0();\n      const text_w = game_width - pad * 2;\n      let wrapped_numlines = font.numLines(modal_font_style, text_w, 0, eff_font_height, modal_dialog.text);\n      if (wrapped_numlines <= num_lines) {\n        break;\n      }\n    }\n  }\n\n  let { buttons, click_anywhere } = modal_dialog;\n  let keys = Object.keys(buttons || {});\n\n  const game_width = camera2d.x1() - camera2d.x0();\n  const eff_modal_width = fullscreen_mode ? game_width : (modal_dialog.width || modal_width);\n  let eff_button_width = modal_dialog.button_width || modal_button_width;\n  let max_total_button_width = eff_modal_width * 2 / 3;\n  eff_button_width = min(eff_button_width, max_total_button_width / keys.length);\n  const text_w = eff_modal_width - pad * 2;\n  const x0 = camera2d.x0() + round((game_width - eff_modal_width) / 2);\n  let x = x0 + pad;\n  const y0 = fullscreen_mode ? 0 : (modal_dialog.y0 || modal_y0);\n  let y = round(y0 + pad);\n\n  if (modal_dialog.title) {\n    if (fullscreen_mode) {\n      title_font.drawSizedAligned(modal_font_style, x, y, Z.MODAL, eff_font_height * modal_title_scale,\n        glov_font.ALIGN.HFIT, text_w, 0, modal_dialog.title);\n      y += eff_font_height * modal_title_scale;\n    } else {\n      y += title_font.drawSizedWrapped(modal_font_style,\n        x, y, Z.MODAL, text_w, 0, eff_font_height * modal_title_scale,\n        modal_dialog.title);\n    }\n    y = round(y + vpad * 1.5);\n  }\n\n  if (modal_dialog.text || fullscreen_mode) {\n    if (fullscreen_mode) {\n      if (modal_dialog.text) {\n        font.drawSizedAligned(modal_font_style, x, y, Z.MODAL, eff_font_height,\n          glov_font.ALIGN.HWRAP, text_w, 0, modal_dialog.text);\n      }\n      y += eff_font_height * num_lines;\n    } else {\n      y += font.drawSizedWrapped(modal_font_style, x, y, Z.MODAL, text_w, 0, eff_font_height,\n        modal_dialog.text);\n    }\n    y = round(y + vpad);\n  }\n\n  let tick_key;\n  if (modal_dialog.tick) {\n    let avail_width = eff_modal_width - pad * 2;\n    if (fullscreen_mode) {\n      avail_width -= (pad + eff_button_width) * keys.length;\n    }\n    let param = {\n      x, y,\n      modal_width: eff_modal_width,\n      avail_width,\n      font_height: eff_font_height,\n      fullscreen_mode,\n    };\n    tick_key = modal_dialog.tick(param);\n    y = param.y;\n  }\n\n  x = x0 + eff_modal_width - (pad + eff_button_width) * keys.length;\n  let did_button = -1;\n  for (let ii = 0; ii < keys.length; ++ii) {\n    let key = keys[ii];\n    let key_lower = key.toLowerCase();\n    let cur_button = buttons[key] = buttons[key] || {};\n    let eff_button_keys = button_keys[key_lower];\n    let pressed = 0;\n    if (eff_button_keys) {\n      for (let jj = 0; jj < eff_button_keys.key.length; ++jj) {\n        pressed += glov_input.keyDownEdge(eff_button_keys.key[jj], cur_button.in_event_cb);\n        if (eff_button_keys.key[jj] === tick_key) {\n          pressed++;\n        }\n      }\n      for (let jj = 0; jj < eff_button_keys.pad.length; ++jj) {\n        pressed += glov_input.padButtonDownEdge(eff_button_keys.pad[jj]);\n      }\n    }\n    if (click_anywhere && ii === 0 && glov_input.click()) {\n      ++pressed;\n    }\n    if (pressed) {\n      did_button = ii;\n    }\n    let but_label = cur_button.label || buttons_default_labels[key_lower] || key;\n    if (buttonText(defaults({\n      x, y, z: Z.MODAL,\n      w: eff_button_width,\n      h: eff_button_height,\n      text: but_label,\n      auto_focus: ii === 0,\n    }, cur_button))) {\n      did_button = ii;\n    }\n    x = round(x + pad + eff_button_width);\n  }\n  // Also check low-priority keys\n  if (did_button === -1) {\n    for (let ii = 0; ii < keys.length; ++ii) {\n      let key = keys[ii];\n      let eff_button_keys = button_keys[key.toLowerCase()];\n      if (eff_button_keys && eff_button_keys.low_key) {\n        for (let jj = 0; jj < eff_button_keys.low_key.length; ++jj) {\n          if (glov_input.keyDownEdge(eff_button_keys.low_key[jj], buttons[key].in_event_cb) ||\n          eff_button_keys.low_key[jj] === tick_key) {\n            did_button = ii;\n          }\n        }\n      }\n    }\n  }\n  if (did_button !== -1) {\n    let key = keys[did_button];\n    playUISound('button_click');\n    modal_dialog = null;\n    if (buttons[key].cb) {\n      buttons[key].cb();\n    }\n    exit_lock = false;\n  }\n  y += eff_button_height;\n  y = round(y + vpad + pad);\n  panel({\n    x: x0,\n    y: y0,\n    z: Z.MODAL - 1,\n    w: eff_modal_width,\n    h: (fullscreen_mode ? camera2d.y1() : y) - y0,\n    pixel_scale: panel_pixel_scale * general_scale,\n  });\n\n  if (glov_input.pointerLocked() && exit_lock) {\n    glov_input.pointerLockExit();\n  }\n\n  glov_input.eatAllInput();\n  if (fullscreen_mode) {\n    camera2d.pop();\n  }\n}\n\nexport function modalTextEntry(param) {\n  let eb = editBoxCreate({\n    initial_focus: true,\n    spellcheck: false,\n    initial_select: true,\n    text: param.edit_text,\n    max_len: param.max_len,\n    esc_clears: false,\n  });\n  let buttons = {};\n  for (let key in param.buttons) {\n    let cb = param.buttons[key];\n    if ((cb !== null) && (typeof cb === 'object') && ('cb' in cb)) {\n      cb = param.buttons[key].cb;\n    }\n    if (typeof cb === 'function') {\n      cb = (function (old_fn) {\n        return function () {\n          old_fn(eb.getText());\n        };\n      }(cb));\n    }\n    buttons[key] = defaults({ cb }, param.buttons[key]);\n  }\n  param.buttons = buttons;\n  param.text = `${param.text || ''}`;\n  let old_tick = param.tick;\n  param.tick = function (params) {\n    let eb_ret = eb.run({\n      x: params.x,\n      y: params.y,\n      w: params.avail_width || param.edit_w,\n      font_height: params.font_height,\n    });\n    if (!params.fullscreen_mode) {\n      params.y += params.font_height + modal_pad;\n    }\n    let ret;\n    if (eb_ret === eb.SUBMIT) {\n      ret = KEYS.O; // Do OK, Yes\n    } else if (eb_ret === eb.CANCEL) {\n      ret = KEYS.ESC; // Do Cancel, No\n    }\n    if (old_tick) {\n      ret = old_tick(params) || ret;\n    }\n    return ret;\n  };\n  modalDialog(param);\n}\n\n\nexport function createEditBox(param) {\n  return editBoxCreate(param);\n}\n\nlet pp_bad_frames = 0;\n\nexport function isMenuUp() {\n  return modal_dialog || menu_up;\n}\n\nfunction releaseOldUIElemData() {\n  for (let type in ui_elem_data) {\n    let by_type = ui_elem_data[type];\n    let any = false;\n    for (let key in by_type) {\n      let elem_data = by_type[key];\n      if (elem_data.frame_index < glov_engine.frame_index - 1) {\n        delete by_type[key];\n      } else {\n        any = true;\n      }\n    }\n    if (!any) {\n      delete ui_elem_data[type];\n    }\n  }\n}\n\nexport function tickUI(dt) {\n  per_frame_dom_alloc[glov_engine.frame_index % per_frame_dom_alloc.length] = 0;\n  releaseOldUIElemData();\n\n  editBoxTick();\n  linkTick();\n\n  dom_elems_issued = 0;\n\n  let pp_this_frame = false;\n  if (modal_dialog || menu_up) {\n    let params = menu_fade_params;\n    if (!menu_up) {\n      // Modals get defaults\n      params = menu_fade_params_default;\n    }\n    menu_up_time += dt;\n    // Effects during modal dialogs\n    let factor = min(menu_up_time / 500, 1);\n    if (glov_engine.postprocessing && !glov_engine.defines.NOPP) {\n      // Note: this lerp used to be done later in the frame (during drawing, not queueing) a problem?\n      let blur_factor = lerp(factor, params.blur[0], params.blur[1]);\n      if (blur_factor) {\n        effectsQueue(params.z - 2, doBlurEffect.bind(null, blur_factor));\n      }\n      let saturation = lerp(factor, params.saturation[0], params.saturation[1]);\n      let brightness = lerp(factor, params.brightness[0], params.brightness[1]);\n      if (saturation !== 1 || brightness !== 1) {\n        effectsQueue(params.z - 1, doDesaturateEffect.bind(null, saturation, brightness));\n      }\n      pp_this_frame = true;\n    } else {\n      // Or, just darken\n      sprites.white.draw({\n        x: camera2d.x0Real(),\n        y: camera2d.y0Real(),\n        z: params.z - 2,\n        color: params.fallback_darken,\n        w: camera2d.wReal(),\n        h: camera2d.hReal(),\n      });\n    }\n  } else {\n    menu_up_time = 0;\n  }\n  menu_up = false;\n\n  if (!glov_engine.is_loading && glov_engine.getFrameDtActual() > 50 && pp_this_frame) {\n    pp_bad_frames = (pp_bad_frames || 0) + 1;\n    if (pp_bad_frames >= 6) { // 6 in a row, disable superfluous postprocessing\n      glov_engine.postprocessingAllow(false);\n    }\n  } else if (pp_bad_frames) {\n    pp_bad_frames = 0;\n  }\n\n  spotTopOfFrame();\n\n  if (modal_dialog) {\n    modalDialogRun();\n  }\n}\n\nexport function endFrame() {\n  spotEndOfFrame();\n\n  if (glov_input.click({\n    x: -Infinity, y: -Infinity,\n    w: Infinity, h: Infinity,\n  })) {\n    spotUnfocus();\n  }\n\n  while (dom_elems_issued < dom_elems.length) {\n    let elem = dom_elems.pop();\n    dynamic_text_elem.removeChild(elem);\n  }\n}\n\nexport function cleanupDOMElems() {\n  while (dom_elems.length) {\n    let elem = dom_elems.pop();\n    dynamic_text_elem.removeChild(elem);\n  }\n}\n\nexport function menuUp(param) {\n  merge(menu_fade_params, menu_fade_params_default);\n  if (param) {\n    merge(menu_fade_params, param);\n  }\n  menu_up = true;\n  glov_input.eatAllInput();\n}\n\nfunction copyTextToClipboard(text) {\n  let textArea = document.createElement('textarea');\n  textArea.style.position = 'fixed';\n  textArea.style.top = 0;\n  textArea.style.left = 0;\n  textArea.style.width = '2em';\n  textArea.style.height = '2em';\n  textArea.style.border = 'none';\n  textArea.style.outline = 'none';\n  textArea.style.boxShadow = 'none';\n  textArea.style.background = 'transparent';\n  textArea.value = text;\n\n  document.body.appendChild(textArea);\n  textArea.focus();\n  textArea.select();\n\n  let ret = false;\n  try {\n    ret = document.execCommand('copy');\n  } catch (err) {\n    // do nothing\n  }\n\n  document.body.removeChild(textArea);\n  return ret;\n}\n\nexport function provideUserString(title, str) {\n  let copy_success = copyTextToClipboard(str);\n  modalTextEntry({\n    edit_w: 400,\n    edit_text: str.replace(/[\\n\\r]/g, ' '),\n    title,\n    text: copy_success ?\n      default_copy_success_msg :\n      default_copy_failure_msg,\n    buttons: { ok: null },\n  });\n}\n\nexport function drawRect(x0, y0, x1, y1, z, color) {\n  let mx = min(x0, x1);\n  let my = min(y0, y1);\n  let Mx = max(x0, x1);\n  let My = max(y0, y1);\n  return sprites.white.draw({\n    x: mx,\n    y: my,\n    z,\n    color,\n    w: Mx - mx,\n    h: My - my,\n  });\n}\n\nexport function drawRect2(param) {\n  return drawRect(param.x, param.y, param.x + param.w, param.y + param.h, param.z, param.color);\n}\n\nexport function drawRect4Color(x0, y0, x1, y1, z, color_ul, color_ur, color_ll, color_lr) {\n  let mx = min(x0, x1);\n  let my = min(y0, y1);\n  let Mx = max(x0, x1);\n  let My = max(y0, y1);\n  return sprites.white.draw4Color({\n    x: mx,\n    y: my,\n    z,\n    color_ul,\n    color_ll,\n    color_lr,\n    color_ur,\n    w: Mx - mx,\n    h: My - my,\n  });\n}\n\nfunction spreadTechParams(spread) {\n  // spread=0 -> 1\n  // spread=0.5 -> 2\n  // spread=0.75 -> 4\n  // spread=1 -> large enough to AA\n  spread = min(max(spread, 0), 0.99);\n\n  let tech_params = {\n    param0: vec4(0,0,0,0),\n  };\n\n  tech_params.param0[0] = 1 / (1 - spread);\n  tech_params.param0[1] = -0.5 * tech_params.param0[0] + 0.5;\n  return tech_params;\n}\n\nlet temp_color = vec4();\nfunction premulAlphaColor(color) {\n  temp_color[0] = color[0] * color[3];\n  temp_color[1] = color[1] * color[3];\n  temp_color[2] = color[2] * color[3];\n  temp_color[3] = color[3];\n  return temp_color;\n}\nfunction drawElipseInternal(sprite, x0, y0, x1, y1, z, spread, tu0, tv0, tu1, tv1, color, blend) {\n  if (!blend && !glov_engine.defines.NOPREMUL) {\n    blend = BLEND_PREMULALPHA;\n    color = premulAlphaColor(color);\n  }\n  glov_sprites.queueraw(sprite.texs,\n    x0, y0, z, x1 - x0, y1 - y0,\n    tu0, tv0, tu1, tv1,\n    color, glov_font.font_shaders.font_aa, spreadTechParams(spread), blend);\n}\n\nfunction drawCircleInternal(sprite, x, y, z, r, spread, tu0, tv0, tu1, tv1, color, blend) {\n  let x0 = x - r * 2 + r * 4 * tu0;\n  let x1 = x - r * 2 + r * 4 * tu1;\n  let y0 = y - r * 2 + r * 4 * tv0;\n  let y1 = y - r * 2 + r * 4 * tv1;\n  drawElipseInternal(sprite, x0, y0, x1, y1, z, spread, tu0, tv0, tu1, tv1, color, blend);\n}\n\nfunction initCircleSprite() {\n  const CIRCLE_SIZE = 32;\n  let data = new Uint8Array(CIRCLE_SIZE*CIRCLE_SIZE);\n  let midp = (CIRCLE_SIZE - 1) / 2;\n  for (let i = 0; i < CIRCLE_SIZE; i++) {\n    for (let j = 0; j < CIRCLE_SIZE; j++) {\n      let d = sqrt((i - midp)*(i - midp) + (j - midp)*(j - midp)) / midp;\n      let v = clamp(1 - d, 0, 1);\n      data[i + j*CIRCLE_SIZE] = v * 255;\n    }\n  }\n  sprites.circle = glov_sprites.create({\n    url: 'circle',\n    width: CIRCLE_SIZE, height: CIRCLE_SIZE,\n    format: textures.format.R8,\n    data,\n    filter_min: gl.LINEAR,\n    filter_mag: gl.LINEAR,\n    wrap_s: gl.CLAMP_TO_EDGE,\n    wrap_t: gl.CLAMP_TO_EDGE,\n    origin: vec2(0.5, 0.5),\n  });\n}\n\nexport function drawElipse(x0, y0, x1, y1, z, spread, color, blend) {\n  if (!sprites.circle) {\n    initCircleSprite();\n  }\n  drawElipseInternal(sprites.circle, x0, y0, x1, y1, z, spread, 0, 0, 1, 1, color, blend);\n}\n\nexport function drawCircle(x, y, z, r, spread, color, blend) {\n  if (!sprites.circle) {\n    initCircleSprite();\n  }\n  drawCircleInternal(sprites.circle, x, y, z, r, spread, 0, 0, 1, 1, color, blend);\n}\n\nexport function drawHollowCircle(x, y, z, r, spread, color, blend) {\n  if (!sprites.hollow_circle) {\n    const CIRCLE_SIZE = 128;\n    const LINE_W = 2;\n    let data = new Uint8Array(CIRCLE_SIZE*CIRCLE_SIZE);\n    let midp = (CIRCLE_SIZE - 1) / 2;\n    for (let i = 0; i < CIRCLE_SIZE; i++) {\n      for (let j = 0; j < CIRCLE_SIZE; j++) {\n        let d = sqrt((i - midp)*(i - midp) + (j - midp)*(j - midp)) / midp;\n        let v = clamp(1 - d, 0, 1);\n        if (v > 0.5) {\n          v = 1 - v;\n        }\n        v += (LINE_W / CIRCLE_SIZE);\n        data[i + j*CIRCLE_SIZE] = v * 255;\n      }\n    }\n    sprites.hollow_circle = glov_sprites.create({\n      url: 'hollow_circle',\n      width: CIRCLE_SIZE, height: CIRCLE_SIZE,\n      format: textures.format.R8,\n      data,\n      filter_min: gl.LINEAR,\n      filter_mag: gl.LINEAR,\n      wrap_s: gl.CLAMP_TO_EDGE,\n      wrap_t: gl.CLAMP_TO_EDGE,\n      origin: vec2(0.5, 0.5),\n    });\n  }\n  drawCircleInternal(sprites.hollow_circle, x, y, z, r, spread, 0, 0, 1, 1, color, blend);\n}\n\n\nconst LINE_TEX_W=16;\nconst LINE_TEX_H=16; // Only using 15, so we can have a value of 255 in the middle\nconst LINE_MIDP = floor((LINE_TEX_H - 1) / 2);\nconst LINE_V0 = 0.5/LINE_TEX_H;\nconst LINE_V1 = 1-1.5/LINE_TEX_H;\nconst LINE_U0 = 0.5/LINE_TEX_W;\nconst LINE_U1 = (LINE_MIDP + 0.5) / LINE_TEX_W;\nconst LINE_U2 = 1 - LINE_U1; // 1 texel away from LINE_U1\nconst LINE_U3 = 1 - 0.5/LINE_TEX_W;\nexport function drawLine(x0, y0, x1, y1, z, w, precise, color, mode) {\n  if (mode === undefined) {\n    mode = default_line_mode;\n  }\n  let blend;\n  if (!glov_engine.defines.NOPREMUL) {\n    blend = BLEND_PREMULALPHA;\n    color = premulAlphaColor(color);\n  }\n\n  let tex_key = mode & LINE_CAP_ROUND ? 'line3' : 'line2';\n  if (!sprites[tex_key]) {\n    let data = new Uint8Array(LINE_TEX_W * LINE_TEX_H);\n    let i1 = LINE_MIDP;\n    let i2 = LINE_TEX_W - 1 - LINE_MIDP;\n    if (tex_key === 'line2') {\n      // rectangular caps\n      for (let j = 0; j < LINE_TEX_H; j++) {\n        let d = abs((j - LINE_MIDP) / LINE_MIDP);\n        let j_value = round(clamp(1 - d, 0, 1) * 255);\n        for (let i = 0; i < LINE_TEX_W; i++) {\n          d = i < i1 ? i/LINE_MIDP : i >= i2 ? 1 - (i-i2) / LINE_MIDP : 1;\n          let i_value = round(clamp(d, 0, 1) * 255);\n          data[i + j*LINE_TEX_W] = min(i_value, j_value);\n        }\n      }\n    } else {\n      // round caps\n      for (let j = 0; j < LINE_TEX_H; j++) {\n        let d = abs((j - LINE_MIDP) / LINE_MIDP);\n        for (let i = 0; i < LINE_TEX_W; i++) {\n          let id = i < i1 ? 1-i/LINE_MIDP : i >= i2 ? (i-i2) / LINE_MIDP : 0;\n          let dv = sqrt(id*id + d*d);\n          dv = clamp(1-dv, 0, 1);\n          data[i + j*LINE_TEX_W] = round(dv * 255);\n        }\n      }\n    }\n    sprites[tex_key] = glov_sprites.create({\n      url: tex_key,\n      width: LINE_TEX_W, height: LINE_TEX_H,\n      format: textures.format.R8,\n      data,\n      filter_min: gl.LINEAR,\n      filter_mag: gl.LINEAR,\n      wrap_s: gl.CLAMP_TO_EDGE,\n      wrap_t: gl.CLAMP_TO_EDGE,\n    });\n  }\n  let texs = sprites[tex_key].texs;\n\n  const camera_xscale = camera2d.data[4];\n  const camera_yscale = camera2d.data[5];\n  let virtual_to_pixels = (camera_xscale + camera_yscale) * 0.5;\n  let pixels_to_virutal = 1/virtual_to_pixels;\n  let w_in_pixels = w * virtual_to_pixels;\n  let draw_w_pixels = w_in_pixels + 2*2;\n  let half_draw_w_pixels = draw_w_pixels * 0.5;\n  let draw_w = half_draw_w_pixels * pixels_to_virutal;\n  // let tex_delta_for_pixel = 1 / draw_w_pixels; // should be 51/255 for width=1 (draw_w_pixels = 5)\n\n  let dx = x1 - x0;\n  let dy = y1 - y0;\n  let length = sqrt(dx*dx + dy*dy);\n  dx /= length;\n  dy /= length;\n  let tangx = -dy * draw_w;\n  let tangy = dx * draw_w;\n\n  if (mode & LINE_ALIGN) {\n    // align drawing so that the edge of the line is aligned with a pixel edge\n    //   (avoids a 0.1,1.0,0.1 line drawing in favor of 1.0,0.2, which will be crisper, if slightly visually offset)\n    let y0_real = (y0 - camera2d.data[1]) * camera2d.data[5];\n    let y0_real_aligned = round(y0_real - half_draw_w_pixels) + half_draw_w_pixels;\n    let yoffs = (y0_real_aligned - y0_real) / camera2d.data[5];\n    y0 += yoffs;\n    y1 += yoffs;\n\n    let x0_real = (x0 - camera2d.data[0]) * camera2d.data[4];\n    let x0_real_aligned = round(x0_real - half_draw_w_pixels) + half_draw_w_pixels;\n    let xoffs = (x0_real_aligned - x0_real) / camera2d.data[4];\n    x0 += xoffs;\n    x1 += xoffs;\n  }\n\n  let tex_delta_for_pixel = 2/draw_w_pixels;\n  let step_start = 1 - (w_in_pixels + 1) / draw_w_pixels;\n  let step_end = step_start + tex_delta_for_pixel;\n  step_end = 1 + precise * (step_end - 1);\n  let A = 1.0 / (step_end - step_start);\n  let B = -step_start * A;\n  let shader_param = { param0: [A, B] };\n\n  glov_sprites.queueraw4(texs,\n    x1 + tangx, y1 + tangy,\n    x1 - tangx, y1 - tangy,\n    x0 - tangx, y0 - tangy,\n    x0 + tangx, y0 + tangy,\n    z,\n    LINE_U1, LINE_V0, LINE_U2, LINE_V1,\n    color, glov_font.font_shaders.font_aa, shader_param, blend);\n\n  if (mode & (LINE_CAP_ROUND|LINE_CAP_SQUARE)) {\n    // round caps (line3) - square caps (line2)\n    let nx = dx * w/2;\n    let ny = dy * w/2;\n    glov_sprites.queueraw4(texs,\n      x1 - tangx, y1 - tangy,\n      x1 + tangx, y1 + tangy,\n      x1 + tangx + nx, y1 + tangy + ny,\n      x1 - tangx + nx, y1 - tangy + ny,\n      z,\n      LINE_U2, LINE_V1, LINE_U3, LINE_V0,\n      color, glov_font.font_shaders.font_aa, shader_param, blend);\n    glov_sprites.queueraw4(texs,\n      x0 - tangx, y0 - tangy,\n      x0 + tangx, y0 + tangy,\n      x0 + tangx - nx, y0 + tangy - ny,\n      x0 - tangx - nx, y0 - tangy - ny,\n      z,\n      LINE_U1, LINE_V1, LINE_U0, LINE_V0,\n      color, glov_font.font_shaders.font_aa, shader_param, blend);\n  }\n}\n\nexport function drawHollowRect(x0, y0, x1, y1, z, w, precise, color, mode) {\n  drawLine(x0, y0, x1, y0, z, w, precise, color, mode);\n  drawLine(x1, y0, x1, y1, z, w, precise, color, mode);\n  drawLine(x1, y1, x0, y1, z, w, precise, color, mode);\n  drawLine(x0, y1, x0, y0, z, w, precise, color, mode);\n}\n\nexport function drawHollowRect2(param) {\n  drawHollowRect(param.x, param.y, param.x + param.w, param.y + param.h,\n    param.z || Z.UI, param.line_width || 1, param.precise || 1, param.color || unit_vec);\n}\n\nexport function drawCone(x0, y0, x1, y1, z, w0, w1, spread, color) {\n  let blend;\n  if (!glov_engine.defines.NOPREMUL) {\n    blend = BLEND_PREMULALPHA;\n    color = premulAlphaColor(color);\n  }\n  if (!sprites.cone) {\n    const CONE_SIZE = 32;\n    let data = new Uint8Array(CONE_SIZE*CONE_SIZE);\n    let midp = (CONE_SIZE - 1) / 2;\n    for (let i = 0; i < CONE_SIZE; i++) {\n      for (let j = 0; j < CONE_SIZE; j++) {\n        let dx = 0;\n        let dy = 0;\n        let d = 0;\n        if (i > midp) {\n          dx = (i - midp) / midp;\n          dy = abs(j - midp) / midp;\n          let dCircle = sqrt(dx*dx + dy*dy);\n          d = dx * dCircle;\n        }\n        let v = clamp(1 - d, 0, 1);\n        data[i + j*CONE_SIZE] = v * 255;\n      }\n    }\n    sprites.cone = glov_sprites.create({\n      url: 'cone',\n      width: CONE_SIZE, height: CONE_SIZE,\n      format: textures.format.R8,\n      data,\n      filter_min: gl.LINEAR,\n      filter_mag: gl.LINEAR,\n      wrap_s: gl.CLAMP_TO_EDGE,\n      wrap_t: gl.CLAMP_TO_EDGE,\n      origin: vec2(0.5, 0.5),\n    });\n  }\n  let dx = x1 - x0;\n  let dy = y1 - y0;\n  let length = sqrt(dx*dx + dy*dy);\n  dx /= length;\n  dy /= length;\n  let tangx = -dy;\n  let tangy = dx;\n  glov_sprites.queueraw4(sprites.cone.texs,\n    x0 - tangx*w0, y0 - tangy*w0,\n    x0 + tangx*w0, y0 + tangy*w0,\n    x1 + tangx*w1, y1 + tangy*w1,\n    x1 - tangx*w1, y1 - tangy*w1,\n    z,\n    0, 0, 1, 1,\n    color, glov_font.font_shaders.font_aa, spreadTechParams(spread), blend);\n}\n\nexport function setFontHeight(_font_height) {\n  font_height = _font_height;\n  fontSetDefaultSize(font_height);\n}\n\nexport function scaleSizes(scale) {\n  button_height = round(32 * scale);\n  setFontHeight(round(24 * scale));\n  button_width = round(200 * scale);\n  button_img_size = button_height;\n  modal_button_width = round(button_width / 2);\n  modal_width = round(600 * scale);\n  modal_y0 = round(200 * scale);\n  modal_title_scale = 1.2;\n  modal_pad = round(16 * scale);\n  tooltip_width = round(400 * scale);\n  tooltip_pad = round(8 * scale);\n  panel_pixel_scale = button_height / sprites.panel.uidata.total_h; // button_height / panel pixel resolution\n  tooltip_panel_pixel_scale = panel_pixel_scale;\n  scrollAreaSetPixelScale(button_height / sprites.button.uidata.total_h);\n}\n\nexport function setPanelPixelScale(scale) {\n  tooltip_panel_pixel_scale = panel_pixel_scale = scale;\n}\n\nexport function setModalSizes(_modal_button_width, width, y0, title_scale, pad) {\n  modal_button_width = _modal_button_width || round(button_width / 2);\n  modal_width = width || 600;\n  modal_y0 = y0 || 200;\n  modal_title_scale = title_scale || 1.2;\n  modal_pad = pad || modal_pad;\n}\n\nexport function setTooltipWidth(_tooltip_width, _tooltip_panel_pixel_scale) {\n  tooltip_width = _tooltip_width;\n  tooltip_panel_pixel_scale = _tooltip_panel_pixel_scale;\n  tooltip_pad = modal_pad / 2 * _tooltip_panel_pixel_scale;\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nimport assert from 'assert';\nimport { vec4 } from 'glov/common/vmath';\nimport { colorPicker } from './color_picker.js';\nimport { EditBox, editBoxCreate } from './edit_box';\nimport * as engine from './engine.js';\nimport { ALIGN, Font, FontStyle, fontStyle, fontStyleAlpha } from './font';\nimport * as input from './input.js';\nimport { linkText } from './link.js';\nimport { ScrollArea, scrollAreaCreate } from './scroll_area';\nimport {\n  SelectionBox,\n  dropDownCreate,\n  selectionBoxCreate,\n} from './selection_box';\nimport { SimpleMenu, simpleMenuCreate } from './simple_menu';\nimport { slider } from './slider.js';\nimport * as ui from './ui.js';\nimport { getURLBase } from './urlhash.js';\n\nconst { ceil, max, random } = Math;\n\nlet demo_menu: SimpleMenu;\nlet demo_menu_up = false;\nlet demo_result: string | undefined;\nlet font_style: FontStyle;\n\nlet inited: string | undefined;\nlet edit_box1: EditBox;\nlet edit_box2: EditBox;\nlet test_select1: SelectionBox;\nlet test_dropdown: SelectionBox;\nlet test_dropdown_large: SelectionBox;\nlet test_scroll_area: ScrollArea;\nlet slider_value = 0.75;\nlet test_lines = 10;\nlet test_color = vec4(1,0,1,1);\n\nfunction init(x: number, y: number, column_width: number) {\n  edit_box1 = editBoxCreate({\n    x: x + column_width,\n    y: y,\n    w: column_width - 8,\n  });\n  edit_box2 = editBoxCreate({\n    x: x + column_width + column_width,\n    y: y,\n    w: column_width - 8,\n  });\n  demo_menu = simpleMenuCreate({\n    items: [\n      'Option 1',\n      {\n        name: 'Option 2',\n        tag: 'opt2',\n      }, {\n        name: 'Option C',\n        cb: () => {\n          demo_result = 'Callback the third';\n        },\n      },\n    ]\n  });\n  font_style = fontStyle(null, {\n    outline_width: 1.0,\n    outline_color: 0x800000ff,\n    glow_xoffs: 3.25,\n    glow_yoffs: 3.25,\n    glow_inner: -2.5,\n    glow_outer: 5,\n    glow_color: 0x000000ff,\n  });\n\n  test_select1 = selectionBoxCreate({\n    items: ['Apples', 'Bananas', 'Chameleon'],\n    z: Z.UI,\n    width: column_width - 8,\n  });\n  test_dropdown = dropDownCreate({\n    items: ['Apples', 'Bananas', 'Chameleon', { name: 'Disabled', disabled: true }],\n    z: Z.UI,\n    width: column_width - 8,\n  });\n\n  let items = [];\n  for (let ii = 0; ii < 100; ++ii) {\n    items.push(`item${ii}`);\n  }\n  test_dropdown_large = dropDownCreate({\n    items,\n    z: Z.UI,\n    width: column_width - 8,\n  });\n\n  test_scroll_area = scrollAreaCreate();\n}\n\nexport function run(x: number, y: number, z: number): void {\n  const font: Font = ui.font;\n  z = z || Z.UI;\n  let line_height = ui.button_height + 2;\n  let column_width = ui.button_width + 8;\n  if (inited !== `${x}_${y}_${column_width}`) {\n    init(x, y, column_width);\n    inited = `${x}_${y}_${column_width}`;\n  }\n\n  if (demo_menu_up) {\n    demo_result = '';\n    demo_menu.run({ x: x + ui.button_width, y: y + line_height, z: Z.MODAL });\n    if (demo_menu.isSelected()) {\n      if (demo_menu.isSelected('opt2')) {\n        demo_result = 'Selected the second option';\n      }\n      if (!demo_result) {\n        demo_result = `Menu selected: ${demo_menu.getSelectedItem().name}`;\n      }\n      demo_menu_up = false;\n    }\n    ui.menuUp();\n    input.eatAllInput();\n  }\n\n  let pad = 4;\n\n  if (ui.buttonText({ x, y, z, text: 'Modal Dialog', tooltip: 'Shows a modal dialog' })) {\n    demo_result = '';\n    ui.modalDialog({\n      title: 'Modal Dialog',\n      text: 'This is a modal dialog!',\n      buttons: {\n        'OK': function () {\n          demo_result = 'OK pushed!';\n        },\n        'Cancel': null, // no callback\n      },\n    });\n  }\n\n  if (edit_box1.run() === edit_box1.SUBMIT) {\n    ui.modalDialog({\n      title: 'Modal Dialog',\n      text: `Edit box submitted with text ${edit_box1.getText()}`,\n      buttons: {\n        'OK': null,\n      },\n    });\n  }\n  if (edit_box2.run() === edit_box2.SUBMIT) {\n    edit_box2.setText('');\n  }\n\n  if (ui.buttonText({ x: edit_box2.x + edit_box2.w + pad, y, z, text: '...', w: ui.button_height })) {\n    ui.modalTextEntry({\n      title: 'Type something',\n      edit_text: edit_box2.getText(),\n      buttons: {\n        ok: function (text: string) {\n          edit_box2.setText(text);\n        },\n        cancel: null,\n      }\n    });\n  }\n\n  y += line_height;\n\n  if (ui.buttonText({ x, y, z, text: 'Menu', tooltip: 'Shows a menu' })) {\n    demo_menu_up = true;\n  }\n\n  colorPicker({\n    x: x + column_width, y, z,\n    color: test_color,\n  });\n\n  test_scroll_area.begin({\n    x: x + column_width + 4 + line_height,\n    y: y + 4,\n    z,\n    w: 100,\n    h: ui.font_height * 8 + pad,\n  });\n  let internal_y = 2;\n  internal_y += font.drawSizedAligned(font_style, 2, internal_y, z + 1,\n    ui.font_height, ALIGN.HWRAP|ALIGN.HFIT, 100 - test_scroll_area.barWidth() - 2, 0,\n    `Edit Box Text: ${edit_box1.getText()}+${edit_box2.getText()}`) + pad;\n  ui.print(font_style, 2, internal_y, z + 1, `Result: ${demo_result}`);\n  internal_y += ui.font_height + pad;\n  ui.print(font_style, 2, internal_y, z + 1, `Dropdown: ${test_dropdown.getSelected().name}`);\n  internal_y += ui.font_height + pad;\n  linkText({ x: 2, y: internal_y, text: 'Ext URL', url: 'https://github.com/jimbly/glovjs' });\n  if (linkText({ x: column_width/2, y: internal_y, text: 'Int URL',\n    internal: true,\n    url: engine.defines.SPOT_DEBUG ? getURLBase() : `${getURLBase()}?D=SPOT_DEBUG` })\n  ) {\n    engine.defines.SPOT_DEBUG = !engine.defines.SPOT_DEBUG;\n  }\n  internal_y += ui.font_height + pad;\n  internal_y += test_dropdown_large.run({ x: 2, y: internal_y, z: z + 1 }) + pad;\n  if (ui.buttonText({ x: 2, y: internal_y, z, text: 'Disabled', tooltip: 'A disabled button', disabled: true })) {\n    assert(false);\n  }\n  internal_y += ui.button_height + pad;\n  for (let ii = 0; ii < test_lines; ++ii) {\n    ui.print(font_style, 2, internal_y, z + 1, `Line #${ii}`);\n    internal_y += ui.font_height + pad;\n  }\n  if (ui.buttonText({ x: 2, y: internal_y, z: z + 1, text: 'Add Line', key: 'add_line' })) {\n    ++test_lines;\n  }\n  internal_y += ui.button_height + pad;\n  if (ui.buttonText({ x: 2, y: internal_y, z: z + 1, text: 'Remove Line', key: 'remove_line' })) {\n    --test_lines;\n  }\n  internal_y += ui.button_height + pad;\n  test_scroll_area.end(internal_y);\n  ui.panel({ x: test_scroll_area.x - pad, y: test_scroll_area.y - pad, z: z - 1,\n    w: test_scroll_area.w + pad * 2, h: test_scroll_area.h + pad * 2 });\n\n  y += line_height;\n\n  y += test_select1.run({ x, y, z });\n  y += test_dropdown.run({ x, y, z });\n\n  y = max(y, test_scroll_area.y + test_scroll_area.h + pad);\n  slider_value = slider(slider_value, {\n    x, y, z,\n    min: 0,\n    max: 2,\n  });\n  ui.print(null, x + ui.button_width + pad, y, z, `${slider_value.toFixed(2)}`);\n  ui.progressBar({\n    x: x + ui.button_width + pad * 2 + ui.font_height * 2,\n    y, z,\n    w: 60, h: ui.button_height,\n    progress: slider_value,\n  });\n  y += ui.button_height;\n}\n\nexport function runFontTest(x: number, y: number): void {\n  const COLOR_RED = 0xFF0000ff;\n  const COLOR_GREEN = 0x00FF00ff;\n  const COLOR_WHITE = 0xFFFFFFff;\n  const COLOR_INVISIBLE = 0x00000000;\n  let z = Z.UI;\n  const font: Font = ui.font;\n\n  let font_size = ui.font_height * 2;\n  font.drawSized(null, x, y, z, font_size, `Default ${font_size} ${random().toFixed(7)}`);\n  y += font_size;\n  font.drawSized(null, x, y, z, font_size / 2, `Default ${font_size / 2} Lorem ipsum dolor sit amet <[A|B]>`);\n  y += ceil(font_size / 2);\n  font.drawSized(null, x, y, z, font_size / 4,\n    `Default ${font_size / 4} The quick brown fox jumped over the lazy dog rutabaga Alfalfa`);\n  y += ceil(font_size / 4);\n\n  const font_style_outline = fontStyle(null, {\n    outline_width: 1, outline_color: COLOR_RED,\n    glow_xoffs: 0, glow_yoffs: 0, glow_inner: 0, glow_outer: 0, glow_color: COLOR_INVISIBLE,\n    color: COLOR_WHITE\n  });\n  const font_style_outline_dim = fontStyle(null, {\n    outline_width: 1, outline_color: 0x0000007f,\n    glow_xoffs: 0, glow_yoffs: 0, glow_inner: 0, glow_outer: 0, glow_color: COLOR_INVISIBLE,\n    color: COLOR_WHITE\n  });\n  const font_style_outline_dim2 = fontStyle(null, {\n    outline_width: 1, outline_color: 0xFF00007f,\n    glow_xoffs: 0, glow_yoffs: 0, glow_inner: 0, glow_outer: 0, glow_color: COLOR_INVISIBLE,\n    color: COLOR_WHITE\n  });\n  let xx = x;\n  xx += font.drawSized(font_style_outline, xx, y, z, font_size, 'Outline ');\n  xx += font.drawSized(font_style_outline_dim, xx, y, z, font_size, 'Dim ');\n  xx += font.drawSized(font_style_outline_dim2, xx, y, z, font_size, 'Out');\n  xx += font.drawSized(fontStyleAlpha(font_style_outline_dim2, 0.5), xx, y, z, font_size, 'line');\n  y += font_size;\n\n  const font_style_glow = fontStyle(null, {\n    outline_width: 0, outline_color: COLOR_INVISIBLE,\n    glow_xoffs: 0, glow_yoffs: 0, glow_inner: -1, glow_outer: 4, glow_color: COLOR_GREEN,\n    color: COLOR_WHITE\n  });\n  const font_style_glow_dim = fontStyle(null, {\n    outline_width: 0, outline_color: COLOR_INVISIBLE,\n    glow_xoffs: 0, glow_yoffs: 0, glow_inner: -1, glow_outer: 4, glow_color: 0x00FF0020,\n    color: COLOR_WHITE\n  });\n  const font_style_glow_dim_on_dim = fontStyle(null, {\n    outline_width: 0, outline_color: COLOR_INVISIBLE,\n    glow_xoffs: 0, glow_yoffs: 0, glow_inner: -1, glow_outer: 4, glow_color: 0x00FF0020,\n    color: 0xFFFFFF80,\n  });\n  xx = x;\n  xx += font.drawSized(font_style_glow, xx, y, z, font_size, 'Glow ');\n  xx += font.drawSized(font_style_glow_dim, xx, y, z, font_size, 'Dim ');\n  font.drawSized(font_style_glow_dim_on_dim, xx, y, z, font_size, 'Glow ');\n  y += font_size;\n\n  const font_style_shadow = fontStyle(null, {\n    outline_width: 0, outline_color: COLOR_INVISIBLE,\n    glow_xoffs: 4, glow_yoffs: 4, glow_inner: -2.5, glow_outer: 5, glow_color: COLOR_GREEN,\n    color: COLOR_WHITE\n  });\n  font.drawSized(font_style_shadow, x, y, z, font_size, 'Glow (Shadow) O0O1Il');\n  y += font_size;\n\n  const font_style_both = fontStyle(null, {\n    outline_width: 1, outline_color: COLOR_RED,\n    glow_xoffs: 0, glow_yoffs: 0, glow_inner: 0, glow_outer: 6, glow_color: COLOR_GREEN,\n    color: COLOR_WHITE\n  });\n  const font_style_both_soft_on_hard = fontStyle(null, {\n    outline_width: 1, outline_color: 0xFF00007f,\n    glow_xoffs: 0, glow_yoffs: 0, glow_inner: 0, glow_outer: 6, glow_color: COLOR_GREEN,\n    color: COLOR_WHITE\n  });\n  const font_style_both_hard_on_soft = fontStyle(null, {\n    outline_width: 1, outline_color: COLOR_RED,\n    glow_xoffs: 0, glow_yoffs: 0, glow_inner: 0, glow_outer: 6, glow_color: 0x00FF0040,\n    color: COLOR_WHITE\n  });\n  const font_style_both_soft_on_soft = fontStyle(null, {\n    outline_width: 1, outline_color: 0xFF00007f,\n    glow_xoffs: 0, glow_yoffs: 0, glow_inner: 0, glow_outer: 6, glow_color: 0x00FF0040,\n    color: COLOR_WHITE\n  });\n  xx = x;\n  xx += font.drawSized(font_style_both, xx, y, z, font_size, 'B');\n  xx += font.drawSized(fontStyleAlpha(font_style_both, 0.75), xx, y, z, font_size, 'o');\n  xx += font.drawSized(fontStyleAlpha(font_style_both, 0.5), xx, y, z, font_size, 't');\n  xx += font.drawSized(fontStyleAlpha(font_style_both, 0.25), xx, y, z, font_size, 'h ');\n  xx += font.drawSized(font_style_both_soft_on_hard, xx, y, z, font_size, 'SoH ');\n  xx += font.drawSized(font_style_both_hard_on_soft, xx, y, z, font_size, 'HoH ');\n  font.drawSized(font_style_both_soft_on_soft, xx, y, z, font_size, 'SoS 0O0');\n  y += font_size;\n\n  let font_size2 = 32;\n  const font_style_both2 = fontStyle(null, {\n    outline_width: 1.75,outline_color: COLOR_RED,\n    glow_xoffs: 0.25, glow_yoffs: 0.25, glow_inner: 0, glow_outer: 5, glow_color: 0x7F7F7Fff,\n    color: COLOR_WHITE\n  });\n  font.drawSizedAligned(font_style_both2, x, y, z, font_size2, ALIGN.HFIT, ui.button_width * 2, 0,\n    'ALIGN.HFIT The quick brown fox jumps over the lazy dog');\n  y += font_size2;\n\n  let test = 'glow';\n\n  if (test === 'outline') {\n    const font_style_outline2 = fontStyle(null, {\n      outline_width: 1, outline_color: COLOR_RED,\n      glow_xoffs: 0, glow_yoffs: 0, glow_inner: 0, glow_outer: 0, glow_color: COLOR_INVISIBLE,\n      color: COLOR_WHITE\n    });\n    for (let ii = 1; ii <= 4; ii++) {\n      font.drawSizedAligned(\n        fontStyle(font_style_outline2, {\n          outline_width: ii * 2,\n        }), x, y, z, font_size2, ALIGN.HLEFT, 400, 0,\n        `Outline thickness ${ii * 2}`);\n      y += font_size2;\n    }\n\n    // Not allowing non-uniform scaling here, simulate with camera?\n    // font.drawSizedAligned(font_style_outline2, x, y, z, font_size2 * 2, font_size2, ALIGN.HLEFT, 400, 0,\n    //   'Wide thick outline');\n    // y += font_size2;\n    // font.drawSizedAligned(font_style_outline2, x, y, z, font_size2, font_size2 * 2, ALIGN.HLEFT, 400, 0,\n    //   'Tall thick outline');\n    // y += font_size2 * 2;\n  } else if (test === 'glow') {\n    const font_style_glow2 = fontStyle(null, {\n      outline_width: 0, outline_color: COLOR_INVISIBLE,\n      glow_xoffs: 0, glow_yoffs: 0, glow_inner: 0, glow_outer: 8, glow_color: COLOR_RED,\n      color: COLOR_WHITE\n    });\n    for (let ii = 1; ii <= 4; ii++) {\n      font.drawSizedAligned(\n        fontStyle(font_style_glow2, {\n          // glow_inner: ii * 2 - 1,\n          glow_outer: ii * 2,\n        }), x, y, z, font_size2, ALIGN.HLEFT, 400, 0,\n        `Glow outer ${ii * 2}`);\n      y += font_size2;\n    }\n\n    // Not allowing non-uniform scaling here, simulate with camera?\n    // font.drawSizedAligned(font_style_glow2, x, y, z, font_size2 * 2, font_size2, ALIGN.HLEFT, 400, 0,\n    //   'Wide thick glow \\x01\\x02\\xe5\\xae\\xb4\\xe8\\xaf\\xb7');\n    // y += font_size2;\n    // font.drawSizedAligned(font_style_glow2, x, y, z, font_size2, font_size2 * 2, ALIGN.HLEFT, 400, 0,\n    //   'Tall thick glow');\n    // y += font_size2 * 2;\n  } else if (test === 'wrap') {\n    y += font.drawSizedWrapped(null, x, y, z, 400, 24, font_size2,\n      'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor' +\n      ' incididunt utlaboreetdoloremagnaaliqua.');\n  }\n\n\n  // Gradient not supported\n  // y = y0;\n  // x += font_size * 8;\n  // const font_style_gradient = fontStyle(null, {\n  //   outline_width: 1, outline_color: 0x777777ff,\n  //   glow_xoffs: 0, glow_yoffs: 0, glow_inner: 0, glow_outer: 0, glow_color: COLOR_BLUE,\n  //   gradient: [COLOR_WHITE, COLOR_WHITE, COLOR_BLACK, COLOR_BLACK],\n  // });\n  // font.drawSized(font_style_gradient, x, y + Math.sin(engine.getFrameTimestamp() * 0.005) * 20, z,\n  //   font_size*2, 'Gradient');\n  // y += font_size*2;\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/*\n  API usage:\n  engine.defines = urlhash.register({\n    key: 'D',\n    type: SET,\n  });\n  urlhash.register({\n    key: 'pos',\n    // type: TYPE_STRING,\n    change: (newvalue) => {},\n    title: (value) => 'string',\n    def: '1,2',\n    hides: { otherfield: true },\n    push: true, // do a pushState instead of replaceState when this changes\n    hide_values: { foo: true }, // do not add to URL if values is in the provided set\n    route_only: true, // never show this value, but still use it to influence routes - use with routeFixed()\n  });\n  urlhash.set('pos', '3,4');\n  urlhash.get('pos')\n\n  urlhash.route('w/:w')     // use URLs like foo.com/w/1   instead of foo.com/?w=1\n  urlhash.route('w/:w/:wg')  // use URLs like foo.com/w/1/2 instead of foo.com/?w=1&wg=2\n\n  // Called whenever the URL state is pushed, even if to exactly the same URL (e.g. on link click)\n  urlhash.onChange(cb)\n*/\n\nconst assert = require('assert');\nconst { callEach } = require('glov/common/util.js');\n\nconst HISTORY_UPDATE_TIME = 1000;\n\nexport let TYPE_SET = 'set';\nexport let TYPE_STRING = 'string';\n\nlet params = {};\n\nlet title_transformer;\n\nlet page_base = (document.location.href || '').match(/^[^#?]+/)[0]; // remove search and anchor\nif (!page_base.endsWith('/')) { // e.g. http://foo.bar/index.html\n  page_base += '?';\n}\n// Removes index.html et all\nlet url_base = page_base.replace(/[^/]*$/,'');\nlet on_change = [];\n\nexport function getURLBase() {\n  return url_base;\n}\n\nexport function getURLPageBase() {\n  return page_base;\n}\n\nexport function onChange(cb) {\n  on_change.push(cb);\n}\n\nfunction cmpNumKeys(a, b) {\n  let d = b.keys.length - a.keys.length;\n  if (d) {\n    return d;\n  }\n  // otherwise alphabetical for stability\n  for (let ii = 0; ii < a.keys.length; ++ii) {\n    if (a.keys[ii] < b.keys[ii]) {\n      return -1;\n    } else if (a.keys[ii] > b.keys[ii]) {\n      return 1;\n    }\n  }\n  assert(false); // two routes with identical keys\n  return 0;\n}\n\nconst route_param_regex = /:(\\w+)/g;\nlet routes = [];\n\nfunction queryString() {\n  let href = String(document.location);\n  return href.slice(page_base.length);\n}\n\nconst regex_value = /[^\\w]\\w+=([^&]+)/;\nfunction getValue(query_string, opts) {\n  if (opts.routes) {\n    for (let ii = 0; ii < opts.routes.length; ++ii) {\n      let r = opts.routes[ii];\n      let m = query_string.match(r.regex);\n      if (m) {\n        if (r.value) {\n          return r.value;\n        }\n        let idx = r.keys.indexOf(opts.key);\n        return m[1 + idx];\n      }\n    }\n  }\n  let m = query_string.match(opts.regex) || [];\n  if (opts.type === TYPE_SET) {\n    let r = {};\n    for (let ii = 0; ii < m.length; ++ii) {\n      let m2 = m[ii].match(regex_value);\n      assert(m2);\n      r[m2[1]] = 1;\n    }\n    return r;\n  } else {\n    return m[1] || opts.def;\n  }\n}\n\nlet last_history_str = null; // always re-set it on the first update\n\nfunction goInternal(query_string) { // with the '?'\n  // Update all values, except those hidden by what is currently in the query string\n  let hidden = {};\n  for (let key in params) {\n    let opts = params[key];\n    if (opts.hides) {\n      if (getValue(query_string, opts)) {\n        for (let otherkey in opts.hides) {\n          hidden[otherkey] = 1;\n        }\n      }\n    }\n  }\n\n  let dirty = {};\n  for (let key in params) {\n    if (hidden[key]) {\n      continue;\n    }\n    let opts = params[key];\n    let new_value = getValue(query_string, opts);\n    if (opts.type === TYPE_SET) {\n      for (let v in new_value) {\n        if (!opts.value[v]) {\n          opts.value[v] = 1;\n          dirty[key] = true;\n        }\n      }\n      for (let v in opts.value) {\n        if (!new_value[v]) {\n          delete opts.value[v];\n          dirty[key] = true;\n        }\n      }\n    } else {\n      if (new_value !== opts.value) {\n        dirty[key] = true;\n        opts.value = new_value;\n      }\n    }\n  }\n\n  // Call all change callbacks\n  for (let key in dirty) {\n    let opts = params[key];\n    if (opts.change) {\n      opts.change(opts.value);\n    }\n  }\n  callEach(on_change);\n}\n\nlet eff_title;\nfunction toString() {\n  eff_title = '';\n  let values = [];\n  let hidden = {};\n  for (let key in params) {\n    let opts = params[key];\n    if (opts.hides && opts.value) {\n      for (let otherkey in opts.hides) {\n        hidden[otherkey] = 1;\n      }\n    }\n  }\n  let root_value = '';\n  outer: // eslint-disable-line no-labels\n  for (let ii = 0; ii < routes.length; ++ii) {\n    let r = routes[ii];\n    let route_title = '';\n    for (let jj = 0; jj < r.keys.length; ++jj) {\n      let key = r.keys[jj];\n      if (hidden[key]) {\n        continue outer; // eslint-disable-line no-labels\n      }\n      let opts = params[key];\n      if (opts.hide_values[opts.value]) {\n        continue outer; // eslint-disable-line no-labels\n      }\n      // has a value, is not hidden, continue\n      if (!route_title && opts.title) {\n        route_title = opts.title(opts.value);\n      }\n    }\n    for (let jj = 0; jj < r.keys.length; ++jj) {\n      let key = r.keys[jj];\n      if (params[key].route_only) {\n        hidden[key] = true;\n      }\n    }\n    // route is good!\n    root_value = r.route_string.replace(route_param_regex, function (ignored, key) {\n      hidden[key] = true;\n      return String(params[key].value);\n    });\n    if (!eff_title && route_title) {\n      eff_title = route_title;\n    }\n    break;\n  }\n  for (let key in params) {\n    if (hidden[key]) {\n      continue;\n    }\n    let opts = params[key];\n    if (opts.type === TYPE_SET) {\n      for (let v in opts.value) {\n        values.push(`${key}=${v}`);\n      }\n    } else {\n      if (!opts.hide_values[opts.value]) {\n        values.push(`${key}=${opts.value}`);\n        if (!eff_title && opts.title) {\n          eff_title = opts.title(opts.value);\n        }\n      }\n    }\n  }\n  if (title_transformer) {\n    eff_title = title_transformer(eff_title);\n  }\n  eff_title = String(eff_title);\n  return `${root_value}${values.length ? '?' : ''}${values.join('&')}`;\n}\n\nexport function refreshTitle() {\n  toString();\n  if (eff_title && eff_title !== document.title) {\n    document.title = eff_title;\n  }\n}\n\nfunction periodicRefreshTitle() {\n  profilerStart('periodicRefreshTitle');\n  refreshTitle();\n  setTimeout(periodicRefreshTitle, 1000);\n  profilerStop();\n}\n\nfunction onPopState() {\n  let query_string = queryString();\n  last_history_str = query_string;\n  goInternal(query_string);\n  refreshTitle();\n}\n\nlet on_url_change;\nexport function onURLChange(cb) {\n  on_url_change = cb;\n}\n\nlet last_history_set_time = 0;\nlet scheduled = false;\nlet need_push_state = false;\nfunction updateHistoryCommit() {\n  profilerStart('updateHistoryCommit');\n  scheduled = false;\n  last_history_set_time = Date.now();\n  let url = `${page_base}${last_history_str}`;\n  if (url.endsWith('?')) {\n    url = url.slice(0, -1);\n  }\n  try {\n    if (need_push_state) {\n      need_push_state = false;\n      window.history.pushState(undefined, eff_title, url);\n    } else {\n      window.history.replaceState(undefined, eff_title, url);\n    }\n  } catch (e) {\n    // ignore; some browsers disallow this, I guess\n  }\n  if (eff_title) {\n    document.title = eff_title;\n  }\n  if (on_url_change) {\n    on_url_change();\n  }\n  //window.history.replaceState(undefined, eff_title, `#${last_history_str}`);\n  profilerStop();\n}\nfunction updateHistory(new_need_push_state) {\n  let new_str = toString();\n  if (last_history_str === new_str) {\n    return;\n  }\n  need_push_state = need_push_state || new_need_push_state;\n  last_history_str = new_str;\n  if (scheduled) {\n    // already queued up\n    return;\n  }\n  let delay = HISTORY_UPDATE_TIME;\n  if (Date.now() - last_history_set_time > HISTORY_UPDATE_TIME) {\n    // Been awhile, apply \"instantly\" (but still wait until next tick to ensure\n    //   any other immediate changes are registered)\n    delay = 1;\n  }\n  scheduled = true;\n  setTimeout(updateHistoryCommit, delay);\n}\n\n// Optional startup\nexport function startup(param) {\n  assert(!title_transformer);\n  title_transformer = param.title_transformer;\n  if (!title_transformer && (param.title_suffix || param.title_default)) {\n    const { title_suffix, title_default } = param;\n    title_transformer = function (title) {\n      if (title_suffix && title) {\n        return `${title} | ${title_suffix}`;\n      }\n      return title || title_default || title_suffix;\n    };\n  }\n\n  // Refresh the current URL, it might be in the non-route format\n  updateHistory(false);\n\n  if (title_transformer) {\n    refreshTitle();\n    setTimeout(periodicRefreshTitle, 1000);\n  }\n}\n\nfunction routeEx(new_route) {\n  let { keys } = new_route;\n  for (let ii = 0; ii < keys.length; ++ii) {\n    let opts = params[keys[ii]];\n    // Must have already registered these keys\n    assert(opts);\n    opts.routes = opts.routes || [];\n    opts.routes.push(new_route);\n    // Update initial value\n    opts.value = getValue(queryString(), opts);\n  }\n  routes.push(new_route);\n  routes.sort(cmpNumKeys);\n}\n\nexport function route(route_string) {\n  let keys = [];\n  // foo/:key/:bar => foo/([^/&?]+)/([^/&?]+)\n  let base = route_string.replace(route_param_regex, function (ignored, match) {\n    keys.push(match);\n    return '([^/&?]+)';\n  });\n  let regex = new RegExp(`^${base}(?:$|\\\\?)`);\n  routeEx({\n    route_string,\n    regex,\n    keys,\n  });\n}\n\n// For a route that has no parameters, e.g. `foo.html`\n// Needs an associated key already registered, then set(key, '1') and set(key, '') enter and leave this route\nexport function routeFixed(route_string, key) {\n  let regex = new RegExp(`^${route_string}(?:$|\\\\?)`);\n  routeEx({\n    route_string,\n    regex,\n    value: '1', // Just need something\n    keys: [key],\n  });\n}\n\nexport function register(opts) {\n  assert(opts.key);\n  assert(!params[opts.key]);\n  opts.type = opts.type || TYPE_STRING;\n  let regex_search = `(?:[^\\\\w])${opts.key}=([^&]+)`;\n  let regex_type = '';\n  if (opts.type === TYPE_SET) {\n    regex_type = 'g';\n  } else {\n    opts.def = opts.def || '';\n    opts.hide_values = opts.hide_values || {};\n    opts.hide_values[opts.def] = true;\n  }\n  opts.regex = new RegExp(regex_search, regex_type);\n  params[opts.key] = opts;\n  // Get initial value\n  opts.value = getValue(queryString(), opts);\n  let ret = opts.value;\n  if (opts.type === TYPE_SET && typeof Proxy === 'function') {\n    // Auto-apply changes to URL if someone modifies the proxy\n    ret = new Proxy(opts.value, {\n      set: function (target, prop, value) {\n        if (value) {\n          target[prop] = 1;\n        } else {\n          delete target[prop];\n        }\n        updateHistory();\n        return true;\n      }\n    });\n  }\n\n  if (!window.onpopstate) {\n    window.onpopstate = onPopState;\n  }\n\n  return ret;\n}\n\nexport function set(key, value, value2) {\n  let opts = params[key];\n  assert(opts);\n  if (opts.type === TYPE_SET) {\n    if (Boolean(opts.value[value]) !== Boolean(value2)) {\n      opts.value[value] = value2 ? 1 : 0;\n      updateHistory(opts.push);\n    }\n  } else {\n    if (opts.value !== value) {\n      opts.value = value;\n      updateHistory(opts.push);\n    }\n  }\n}\n\nexport function setMulti(values) {\n  let any = false;\n  let push = false;\n  for (let key in values) {\n    let value = values[key];\n    let opts = params[key];\n    assert(opts);\n    assert(opts.type !== TYPE_SET);\n    if (opts.value !== value) {\n      opts.value = value;\n      any = true;\n      push = push || opts.push;\n    }\n  }\n  if (any) {\n    updateHistory(push);\n  }\n}\n\nexport function get(key) {\n  let opts = params[key];\n  assert(opts);\n  return opts.value;\n}\n\nexport function go(query_string) { // with the '?'\n  goInternal(query_string);\n  updateHistory(true);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nconst { floor, min } = Math;\n\nlet offs = 0;\nfunction now() {\n  return Date.now() + offs;\n}\nmodule.exports = exports = now;\nexports.now = now;\nlet first = true;\nexports.sync = function (server_time) {\n  if (first) {\n    offs = server_time - Date.now();\n  } else {\n    offs = min(offs, server_time - Date.now());\n  }\n};\nfunction toSS2020(milliseconds) {\n  // Seconds since Jan 1st, 2020\n  return floor(milliseconds / 1000) - 1577836800;\n}\nexports.toSS2020 = toSS2020;\nexports.seconds = function () {\n  // Seconds since Jan 1st, 2020\n  return toSS2020(now());\n};\n","/* eslint-disable import/order */\nconst assert = require('assert');\nconst { filewatchOn, filewatchTriggerChange } = require('./filewatch.js');\nconst urlhash = require('./urlhash.js');\nconst { clone, deepEqual } = require('glov/common/util.js');\n\nlet fs = window.glov_webfs || {};\nlet decoded = {};\nlet used = {};\nlet active_reload = false; // after an active reload, do data cloning to better detect which files changed\n// export function webFSReady() {\n//   // TODO: async ready state?\n// }\n\nfunction decode(data) {\n  let len = data[0];\n  let str = data[1];\n  let u8 = new Uint8Array(len);\n  let idxo = 0;\n  let idxi = 0;\n  while (idxo < len) {\n    let byte = str.charCodeAt(idxi++);\n    if (byte === 126) {\n      byte = 0;\n    } else if (byte === 27) {\n      byte = str.charCodeAt(idxi++);\n    }\n    u8[idxo++] = byte;\n  }\n  assert.equal(idxi, str.length);\n  assert.equal(idxo, len);\n  return u8;\n}\n\nexport function webFSGetFileNames(directory) {\n  let ret = [];\n  for (let filename in fs) {\n    if (filename.startsWith(directory)) {\n      ret.push(filename);\n    }\n  }\n  return ret;\n}\n\nexport function webFSGetFile(filename, encoding) {\n  let ret = decoded[filename];\n  if (ret) {\n    return ret;\n  }\n  used[filename] = true;\n  assert(window.glov_webfs, 'Failed to load fsdata.js');\n  let data = fs[filename];\n  assert(data, `Error loading file: ${filename}`);\n  if (encoding === 'jsobj') {\n    assert(!Array.isArray(data));\n    ret = active_reload ? clone(data) : data;\n  } else {\n    assert(Array.isArray(data));\n    if (encoding === 'text') {\n      ret = data[1];\n    } else {\n      ret = decode(data);\n    }\n  }\n  decoded[filename] = ret;\n  return ret;\n}\n\nexport function webFSExists(filename) {\n  return Boolean(fs[filename]);\n}\n\nexport function webFSReportUnused(ignore_regex) {\n  // Don't report on files we know are loaded dynamically, and are small\n  ignore_regex = ignore_regex || /\\.(fp|vp)$/;\n  let tot_size = 0;\n  for (let filename in fs) {\n    if (!used[filename] && !filename.match(ignore_regex)) {\n      console.warn(`WebFS file bundled but unreferenced: ${filename}`);\n      tot_size += fs[filename][0];\n    }\n  }\n  if (tot_size) {\n    console.warn(`WebFS wasting ${tot_size} bytes`);\n  }\n}\n\nfunction webFSReload() {\n  active_reload = true;\n  window.glov_webfs = null;\n  let scriptTag = document.createElement('script');\n  scriptTag.src = `${urlhash.getURLBase()}fsdata.js?rl=${Date.now()}`;\n  scriptTag.onload = function () {\n    if (window.glov_webfs) {\n      let old_fs = fs;\n      fs = window.glov_webfs;\n      decoded = {};\n      used = {};\n      for (let key in fs) {\n        let old_value = old_fs[key];\n        let new_value = fs[key];\n        if (Array.isArray(old_value)) {\n          for (let ii = 0; ii < new_value.length; ++ii) {\n            if (!old_value || new_value[ii] !== old_value[ii]) {\n              filewatchTriggerChange(key);\n              break;\n            }\n          }\n        } else {\n          // Raw object\n          if (!deepEqual(old_value, new_value)) {\n            filewatchTriggerChange(key);\n          }\n        }\n      }\n    }\n  };\n  document.getElementsByTagName('head')[0].appendChild(scriptTag);\n}\n\nfilewatchOn('fsdata.js', webFSReload);\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n// Originally from Splody, used with permission\n/* eslint no-multi-spaces:off, array-bracket-spacing:off */\n\n/* eslint-disable import/order */\nconst { mashString } = require('glov/common/rand_alea.js');\nconst { randFastCreate } = require('glov/client/rand_fast.js');\nconst { profanityFilterCommon, profanityCommonStartup } = require('glov/common/words/profanity_common.js');\nconst { webFSGetFile } = require('glov/client/webfs.js');\n\nlet non_profanity;\n\nexport function profanityStartup() {\n  non_profanity = webFSGetFile('words/replacements.txt', 'text').split('\\n').filter((a) => a);\n  profanityCommonStartup(webFSGetFile('words/filter.gkg', 'text'),\n    webFSGetFile('words/exceptions.txt', 'text'));\n}\n\nlet rand = randFastCreate();\n\nlet last_word;\nfunction randWord() {\n  if (last_word === -1 || non_profanity.length === 1) {\n    last_word = rand.range(non_profanity.length);\n  } else {\n    let choice = rand.range(non_profanity.length - 1);\n    last_word = choice < last_word ? choice : choice + 1;\n  }\n  return non_profanity[last_word];\n}\n\nexport function profanityFilter(user_str) {\n  last_word = -1;\n  rand.seed = mashString(user_str);\n  return profanityFilterCommon(user_str, randWord);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* global WebSocket */\n\n/* eslint-disable import/order */\nimport { getAPIPath, setCurrentEnvironment } from 'glov/client/environments';\n\nconst ack = require('glov/common/ack.js');\nconst { ackInitReceiver } = ack;\nconst assert = require('assert');\nconst { errorReportSetDetails, session_uid } = require('./error_report.js');\nconst { fetch, ERR_CONNECTION } = require('./fetch.js');\nconst { min, random } = Math;\nconst { perfCounterAdd } = require('glov/common/perfcounters.js');\nconst urlhash = require('./urlhash.js');\nconst wscommon = require('glov/common/wscommon.js');\nconst { wsHandleMessage } = wscommon;\nconst { PLATFORM, getAbilityReload } = require('glov/client/client_config.js');\n\n// let net_time = 0;\n// export function getNetTime() {\n//   let r = net_time;\n//   net_time = 0;\n//   return r;\n// }\n\n// Values exposed for `client.connect_error`\nexport const ERR_CONNECTING = 'ERR_CONNECTING';\nexport const ERR_RESTARTING = 'ERR_RESTARTING';\nexport const ERR_CLIENT_VERSION_NEW = 'ERR_CLIENT_VERSION_NEW';\nexport const ERR_CLIENT_VERSION_OLD = 'ERR_CLIENT_VERSION_OLD';\n\nexports.CURRENT_VERSION = 0;\n\nexport function WSClient(path) {\n  this.id = null;\n  this.my_ids = {}; // set of all IDs I've been during this session\n  this.handlers = {};\n  this.socket = null;\n  this.net_delayer = null;\n  this.connected = false;\n  this.disconnected = false;\n  this.retry_scheduled = false;\n  this.retry_count = 0;\n  this.disconnect_time = Date.now();\n  this.last_receive_time = Date.now();\n  this.idle_counter = 0;\n  this.last_send_time = Date.now();\n  this.connect_error = ERR_CONNECTING;\n  ackInitReceiver(this);\n\n  if (path) {\n    this.path = path;\n  }\n\n  this.connect(false);\n\n  this.onMsg('cack', this.onConnectAck.bind(this));\n  this.onMsg('build', this.onBuildTimestamp.bind(this));\n  this.onMsg('error', this.onError.bind(this));\n}\n\nWSClient.prototype.logPacketDispatch = function (source, pak, buf_offs, msg) {\n  perfCounterAdd(`ws.${typeof msg === 'number' ? 'ack' : msg}`);\n};\n\nWSClient.prototype.timeSinceDisconnect = function () {\n  return Date.now() - this.disconnect_time;\n};\n\nfunction getVersionUrlParams() {\n  return `plat=${PLATFORM}&ver=${exports.CURRENT_VERSION}&build=${BUILD_TIMESTAMP}`;\n}\n\nfunction jsonParseResponse(response) {\n  if (!response) {\n    return null;\n  }\n  if (response.trim()[0] === '<') {\n    // html response\n    return null;\n  }\n  try {\n    return JSON.parse(response);\n  } catch (e) {\n    return null;\n  }\n}\n\nfunction whenServerReady(cb) {\n  let retry_count = 0;\n  function doit() {\n    fetch({\n      url: `${getAPIPath()}ready?${getVersionUrlParams()}`,\n    }, (err, response) => {\n      if (err) {\n        let response_data = jsonParseResponse(response);\n        let status = response_data?.status;\n        if (status !== 'ERR_CLIENT_VERSION_OLD') {\n          ++retry_count;\n          setTimeout(doit, min(retry_count * retry_count * 100, 15000) * (0.75 + random() * 0.5));\n          return;\n        }\n      }\n      cb();\n    });\n  }\n  doit();\n}\n\nWSClient.prototype.onBuildTimestamp = function (build_timestamp) {\n  if (build_timestamp !== BUILD_TIMESTAMP) {\n    if (this.on_build_timestamp_mismatch) {\n      this.on_build_timestamp_mismatch();\n    } else {\n      if (getAbilityReload()) {\n        console.error(`App build mismatch (server: ${build_timestamp}, client: ${BUILD_TIMESTAMP}), reloading`);\n        whenServerReady(function () {\n          if (window.reloadSafe) {\n            window.reloadSafe();\n          } else {\n            document.location.reload();\n          }\n        });\n      } else {\n        // Not allowed to reload\n        console.warn(`App build mismatch (server: ${build_timestamp}, client: ${BUILD_TIMESTAMP}), ignoring`);\n      }\n    }\n  }\n};\n\nWSClient.prototype.onConnectAck = function (data, resp_func) {\n  let client = this;\n  client.connected = true;\n  client.connect_error = null;\n  client.disconnected = false;\n  client.id = data.id;\n  client.my_ids[data.id] = true;\n  errorReportSetDetails('client_id', client.id);\n  client.secret = data.secret;\n  if (data.build) {\n    client.onBuildTimestamp(data.build);\n  }\n  // Fire subscription_manager connect handler\n  assert(client.handlers.connect);\n  data.client_id = client.id;\n  client.handlers.connect(client, data);\n  resp_func();\n};\n\n\nWSClient.prototype.pak = function (msg) {\n  return wscommon.wsPak(msg, null, this);\n};\n\nWSClient.prototype.send = function (msg, data, resp_func) {\n  wscommon.sendMessage.call(this, msg, data, resp_func);\n};\n\nWSClient.prototype.onError = function (e) {\n  console.error('WSClient Error');\n  console.error(e);\n  if (!(e instanceof Error)) {\n    e = new Error(e);\n  }\n  throw e;\n};\n\n// cb(client, data, resp_func)\nWSClient.prototype.onMsg = function (msg, cb) {\n  assert.ok(!this.handlers[msg]);\n  this.handlers[msg] = function wrappedCallback(client, data, resp_func) {\n    // Client interface does not need a client passed to it!\n    return cb(data, resp_func);\n  };\n};\n\nWSClient.prototype.checkForNewAppBuild = function () {\n  if (!getAbilityReload()) {\n    // would do nothing with it, don't bother checking\n    return;\n  }\n  if (this.new_build_check_in_progress) {\n    return;\n  }\n  this.new_build_check_in_progress = true;\n  fetch({\n    url: `${urlhash.getURLBase()}app.ver.json`,\n    response_type: 'json'\n  }, (err, obj) => {\n    this.new_build_check_in_progress = false;\n    if (obj && obj.ver) {\n      this.onBuildTimestamp(obj.ver);\n    }\n    if (err && err !== ERR_CONNECTION) {\n      // If this is not triggered on connection errors, only if we got a (non-parseable) response from the server\n      if (!this.delayed_recheck) {\n        this.delayed_recheck = true;\n        setTimeout(() => {\n          this.delayed_recheck = false;\n          this.checkForNewAppBuild();\n        }, 1000);\n      }\n    }\n  });\n};\n\nWSClient.prototype.retryConnection = function () {\n  let client = this;\n  assert(!client.socket);\n  assert(!client.retry_scheduled);\n  client.retry_scheduled = true;\n  ++client.retry_count;\n  this.checkForNewAppBuild();\n  setTimeout(function () {\n    assert(client.retry_scheduled);\n    assert(!client.socket);\n    client.retry_scheduled = false;\n    client.connect(true);\n  }, min(client.retry_count * client.retry_count * 100, 15000) * (0.75 + random() * 0.5));\n};\n\nWSClient.prototype.checkDisconnect = function () {\n  if (this.connected && this.socket.readyState !== 1) { // WebSocket.OPEN\n    // We think we're connected, but we're not, we must have received an\n    // animation frame before the close event when phone was locked or something\n    this.on_close();\n    assert(!this.connected);\n  }\n};\n\nWSClient.prototype.connect = function (for_reconnect) {\n  let client = this;\n  client.socket = { readyState: 0 }; // Placeholder so it appears disconnected\n\n  assert(!this.ready_check_in_progress);\n  this.ready_check_in_progress = true;\n  // retry hitting status endpoint until it says it's okay to make a WebSocket connection\n  fetch({\n    url: `${getAPIPath()}ready?${getVersionUrlParams()}`,\n  }, (err, response) => {\n    let response_data = jsonParseResponse(response);\n    let status = response_data?.status;\n    let redirect_environment = response_data?.redirect_environment;\n    let update_available = response_data?.update_available;\n    let should_reload = update_available && getAbilityReload();\n\n    assert(this.ready_check_in_progress);\n    this.ready_check_in_progress = false;\n    this.connect_error = ERR_CONNECTING;\n\n    if (!err && !redirect_environment && !should_reload) {\n      if (update_available) {\n        // TODO: Inform the user that a new version is available,\n        // even though the current version is still supported\n      }\n      return void this.connectAfterReady(for_reconnect);\n    }\n\n    console.log(`Server not ready, err=${err}, response=${response}`);\n    // Handle known error strings\n    if (status === 'ERR_RESTARTING' || status === 'ERR_STARTUP') {\n      client.connect_error = ERR_RESTARTING;\n    } else if (status === 'ERR_CLIENT_VERSION_NEW') {\n      client.connect_error = ERR_CLIENT_VERSION_NEW;\n    } else if (status === 'ERR_CLIENT_VERSION_OLD') {\n      client.connect_error = ERR_CLIENT_VERSION_OLD;\n    }\n\n    if (redirect_environment) {\n      setCurrentEnvironment(redirect_environment);\n    }\n\n    client.socket = null;\n    client.net_delayer = null;\n    this.retryConnection();\n  });\n};\n\nWSClient.prototype.connectAfterReady = function (for_reconnect) {\n  let client = this;\n\n  let path = client.path ||\n    getAPIPath()      // 'https://foo.com/product/api/'\n    .replace(/^http/, 'ws')\n    .replace(/api\\/$/, 'ws'); // 'wss://foo.com/product/ws';\n  path = `${path}?${getVersionUrlParams()}${\n    for_reconnect && client.id && client.secret ? `&reconnect=${client.id}&secret=${client.secret}` : ''\n  }&sesuid=${session_uid}`;\n  let socket = new WebSocket(path);\n  socket.binaryType = 'arraybuffer';\n  client.socket = socket;\n\n  // Protect callbacks from ever firing if we've already disconnected this socket\n  //   from the WSClient\n  function guard(fn) {\n    return function (...args) {\n      if (client.socket !== socket) {\n        return;\n      }\n      fn(...args);\n    };\n  }\n\n  function abort(skip_close) {\n    client.socket = null;\n    client.net_delayer = null;\n    if (client.connected) {\n      client.disconnect_time = Date.now();\n      client.disconnected = true;\n      errorReportSetDetails('disconnected', 1);\n    }\n    client.connected = false;\n    client.connect_error = ERR_CONNECTING;\n    if (!skip_close) {\n      try {\n        socket.close();\n      } catch (e) {\n        // ignore\n      }\n    }\n    // Fire subscription_manager disconnect handler\n    client.handlers.disconnect();\n    ack.failAll(client);\n  }\n\n  function retry(skip_close) {\n    abort(skip_close);\n    client.retryConnection();\n  }\n\n  // Local state, for this one connection\n  let connected = false;\n  client.socket.addEventListener('error', guard(function (err) {\n    if (!connected) {\n      console.log('WebSocket error during initial connection, retrying...', err);\n      retry();\n    } else {\n      console.error('WebSocket error', err);\n      // Disconnect and reconnect here, is this a terminal error? Probably not, we'll get a 'close' event if it is?\n      // We some error occasionally on iOS, not sure what error, but it auto-reconnects fine, so let's\n      // not do a throw\n      // client.onError(err);\n    }\n  }));\n\n  client.socket.addEventListener('message', guard(function (message) {\n    profilerStart('WS');\n    // net_time -= Date.now();\n    assert(message.data instanceof ArrayBuffer);\n    wsHandleMessage(client, new Uint8Array(message.data));\n    // net_time += Date.now();\n    profilerStop('WS');\n  }));\n\n  client.socket.addEventListener('open', guard(function () {\n    console.log('WebSocket open');\n    connected = true;\n    // reset retry count so next retry is fast if we get disconnected\n    client.retry_count = 0;\n  }));\n\n  // This may get called before the close event gets to use\n  client.on_close = guard(function () {\n    console.log('WebSocket close, retrying connection...');\n    retry(true);\n  });\n  client.socket.addEventListener('close', client.on_close);\n\n  let doPing = guard(function () {\n    if (Date.now() - client.last_send_time > wscommon.PING_TIME && client.connected && client.socket.readyState === 1) {\n      client.send('ping');\n    }\n    setTimeout(doPing, wscommon.PING_TIME);\n  });\n  setTimeout(doPing, wscommon.PING_TIME);\n\n  // For debugging reconnect handling\n  // setTimeout(function () {\n  //   if (connected) {\n  //     socket.close();\n  //   }\n  // }, 5000);\n};\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint no-bitwise:off */\n\nconst assert = require('assert');\nconst { isPacket } = require('./packet.js');\n\nexport function ackInitReceiver(receiver) {\n  receiver.last_pak_id = 0;\n  receiver.resp_cbs = {};\n  receiver.responses_waiting = 0;\n}\n\nconst ERR_FAILALL_DISCONNECT = 'ERR_FAILALL_DISCONNECT';\n\nconst ACKFLAG_IS_RESP = 1<<3;\nconst ACKFLAG_ERR = 1<<4;\nconst ACKFLAG_DATA_JSON = 1<<5;\n// `receiver` is really the sender, here, but will receive any response\nexport function ackWrapPakStart(pak, receiver, msg) {\n  let flags = 0;\n\n  pak.ack_data = {\n    receiver,\n  };\n\n  if (typeof msg === 'number') {\n    flags |= ACKFLAG_IS_RESP;\n    pak.writeInt(msg);\n  } else {\n    pak.writeAnsiString(msg);\n  }\n  let resp_pak_id = receiver ? ++receiver.last_pak_id : 0;\n  pak.ack_data.resp_pak_id = resp_pak_id;\n  pak.ack_data.resp_pak_id_offs = pak.getOffset();\n  pak.writeInt(resp_pak_id);\n\n  pak.ack_data.data_offs = pak.getOffset();\n  pak.ack_data.flags = flags;\n}\n\nexport function ackWrapPakPayload(pak, data) {\n  if (isPacket(data)) {\n    pak.appendRemaining(data);\n  } else {\n    pak.ack_data.flags |= ACKFLAG_DATA_JSON;\n    pak.writeJSON(data);\n  }\n}\n\nexport function ackWrapPakFinish(pak, err, resp_func) {\n  let flags = pak.ack_data.flags;\n  let offs = pak.getOffset();\n  if (err) {\n    // Nothing else must have been written\n    assert.equal(pak.ack_data.data_offs, offs);\n    flags |= ACKFLAG_ERR;\n    pak.writeString(String(err));\n    offs = pak.getOffset();\n  }\n  pak.makeReadable();\n  let resp_pak_id = 0;\n  if (resp_func && resp_func.expecting_response !== false) {\n    resp_pak_id = pak.ack_data.resp_pak_id;\n    assert(resp_pak_id);\n    assert(pak.ack_data.receiver);\n    pak.ack_data.receiver.resp_cbs[resp_pak_id] = resp_func;\n  } else {\n    pak.seek(pak.ack_data.resp_pak_id_offs);\n    pak.zeroInt();\n    pak.seek(offs);\n  }\n  pak.updateFlags(flags);\n  delete pak.ack_data;\n  return resp_pak_id;\n}\n\nexport function ackReadHeader(pak) {\n  let flags = pak.getFlags();\n  let msg = (flags & ACKFLAG_IS_RESP) ? pak.readInt() : pak.readAnsiString();\n  let pak_id = pak.readInt();\n  let err = (flags & ACKFLAG_ERR) ? pak.readString() : undefined;\n  let data;\n  if (flags & ACKFLAG_DATA_JSON) {\n    data = pak.readJSON();\n  } else {\n    data = pak;\n  }\n  return {\n    msg,\n    err,\n    data,\n    pak_id,\n  };\n}\n\nexport function failAll(receiver, err) {\n  err = err || ERR_FAILALL_DISCONNECT;\n  let cbs = receiver.resp_cbs;\n  receiver.resp_cbs = {};\n  receiver.responses_waiting = 0;\n  for (let pak_id in cbs) {\n    cbs[pak_id](err);\n  }\n}\n\n// `source` is a string for debug/logging only\n// `receiver` needs initReceicver called on it, have .onError() in the prototype and optionally .log()\n// sendFunc(msg, err, data, resp_func)\n// handleFunc(msg, data, resp_func)\nexport function ackHandleMessage(receiver, source, pak, send_func, pak_func, handle_func, filter_func) {\n  let pak_initial_offs = pak.getOffset();\n  let { err, data, msg, pak_id } = ackReadHeader(pak);\n  if (receiver.logPacketDispatch) {\n    receiver.logPacketDispatch(source, pak, pak_initial_offs, msg);\n  }\n  let now = Date.now();\n  let expecting_response = Boolean(pak_id);\n  let timeout_id;\n  if (expecting_response) {\n    timeout_id = 'pending';\n  }\n  let sent_response = false;\n  let start_time = now;\n\n  if (filter_func && !filter_func(receiver, msg, data)) {\n    // Simply discard this message\n    return;\n  }\n\n  function preSendResp(err) {\n    assert(!sent_response, 'Response function called twice');\n    sent_response = true;\n\n    if (expecting_response) {\n      if (timeout_id) {\n        if (timeout_id !== 'pending') {\n          clearTimeout(timeout_id);\n        }\n      } else {\n        if (err === ERR_FAILALL_DISCONNECT) {\n          // this is the result of a failAll() call, a response was not actually sent!\n        } else {\n          (receiver.log ? receiver : console).log(`Response finally sent for ${msg\n          } after ${((Date.now() - start_time) / 1000).toFixed(1)}s`);\n        }\n      }\n      receiver.responses_waiting--;\n    }\n  }\n\n  function respFunc(err, resp_data, resp_func) {\n    preSendResp(err);\n    // the callback wants to send a response, and possibly get a response from that!\n    if (!expecting_response) {\n      // But, the other end is not expecting a response from this packet, black-hole it\n      if (resp_func) {\n        // We better not be expecting a response to our response!\n        receiver.onError(`Sending a response to a packet (${msg}) that did not expect` +\n          ' one, but we are expecting a response');\n        return;\n      }\n      // however, if there was an error, let's forward that along as an error message\n      if (err) {\n        send_func('error', null, err, null);\n      }\n      return;\n    }\n    send_func(pak_id, err, resp_data, resp_func);\n  }\n  respFunc.expecting_response = expecting_response;\n  respFunc.pak = function (ref_pak) {\n    assert(expecting_response);\n    let pak = pak_func(pak_id, ref_pak);\n    let orig_send = pak.send;\n    pak.send = function (err, resp_func) {\n      preSendResp(err);\n      orig_send.call(pak, err, resp_func);\n    };\n    return pak;\n  };\n\n  if (typeof msg === 'number') {\n    let cb = receiver.resp_cbs[msg];\n    if (!cb) {\n      return void receiver.onError(`Received response to unknown packet with id ${msg} from ${source}`);\n    }\n    delete receiver.resp_cbs[msg];\n    cb(err, data, respFunc);\n  } else {\n    if (!msg) {\n      return void receiver.onError(`Received message with no .msg from ${source}`);\n    }\n    handle_func(msg, data, respFunc);\n  }\n  if (expecting_response) {\n    // Note, this may be -1 if respFunc has already been called\n    receiver.responses_waiting++;\n    if (!sent_response && !respFunc.suppress_timeout) {\n      // timeout warning for response\n      timeout_id = setTimeout(function () {\n        timeout_id = null;\n        if (!respFunc.suppress_timeout) {\n          (receiver.log ? receiver : console).log(`Response not sent for ${msg\n          } from ${source} after ${((Date.now() - start_time) / 1000).toFixed(1)}s`);\n        }\n      }, 15*1000);\n    }\n  }\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint no-bitwise:off */\n\n\n// Encoding is fastest with non-native calls: http://jsperf.com/base64-encode\n// Decoding is fastest using window.btoa: http://jsperf.com/base64-decode\n\nconst { floor } = Math;\n\nconst chr_table = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'.split('');\nconst PAD = '=';\n\n// dv is a DataView with a .u8 property\nfunction encode(dv, offset, length) {\n  let data = dv.u8;\n  let result = '';\n  let i;\n  let effi;\n  // Convert every three bytes to 4 ascii characters.\n  for (i = 0; i < (length - 2); i += 3) {\n    effi = offset + i;\n    result += chr_table[data[effi] >> 2];\n    result += chr_table[((data[effi] & 0x03) << 4) + (data[effi + 1] >> 4)];\n    result += chr_table[((data[effi + 1] & 0x0f) << 2) + (data[effi + 2] >> 6)];\n    result += chr_table[data[effi + 2] & 0x3f];\n  }\n\n  // Convert the remaining 1 or 2 bytes, pad out to 4 characters.\n  if (length % 3) {\n    i = length - (length % 3);\n    effi = offset + i;\n    result += chr_table[data[effi] >> 2];\n    if ((length % 3) === 2) {\n      result += chr_table[((data[effi] & 0x03) << 4) + (data[effi + 1] >> 4)];\n      result += chr_table[(data[effi + 1] & 0x0f) << 2];\n      result += PAD;\n    } else {\n      result += chr_table[(data[effi] & 0x03) << 4];\n      result += PAD + PAD;\n    }\n  }\n\n  return result;\n}\n\nfunction decodeNativeBrowser(data, allocator) {\n  let str = window.atob(data);\n  let len = str.length;\n  let dv = allocator(len);\n  let u8 = dv.u8;\n  for (let ii = 0; ii < len; ++ii) {\n    u8[ii] = str.charCodeAt(ii);\n  }\n  dv.decode_size = len;\n  return dv;\n}\n\nfunction encodeNativeNode(dv, offset, length) {\n  // Allocates a Buffer() object each time - could have our allocDataView do that if needed for perf\n  return Buffer.from(dv.buffer).toString('base64', offset, offset + length);\n}\n// Faster, but uses an internal function that might break:\n// function encodeNativeNode(dv, offset, length) {\n//   return Buffer.prototype.base64Slice.call(dv.u8, offset, offset + length);\n// }\n\nfunction decodeNativeNode(data, allocator) {\n  let buffer_len = (data.length >> 2) * 3 + floor((data.length % 4) / 1.5);\n  let dv = allocator(buffer_len);\n  let buffer = Buffer.from(dv.buffer);\n  dv.decode_size = buffer.write(data, 'base64');\n  return dv;\n}\n\nconst BROWSER = typeof window !== 'undefined';\n\n// string -> Uint8Array or Buffer\nexports.base64Decode = BROWSER ? decodeNativeBrowser : decodeNativeNode;\n// Uint8Array or Buffer -> string\nexports.base64Encode = BROWSER ? encode : encodeNativeNode;\n\nexports.base64CharTable = chr_table;\n","// Portions Copyright 2020 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nconst assert = require('assert');\nconst { asyncParallelLimit, asyncSeries } = require('glov-async');\nconst crc32 = require('./crc32.js');\nconst { ceil, min } = Math;\nconst { packetBufPoolAlloc, packetBufPoolFree } = require('./packet.js');\n\n// combined size of all chunked sends at any given time\nexport const MAX_CLIENT_UPLOAD_SIZE = 2*1024*1024;\n\nconst CHUNK_SIZE = 8192 - 100; // Should fit in a 8kb packet after headers and such; used by sender only\n\nfunction cleanupFile(state, file_id, pool) {\n  let file_data = state.files[file_id];\n  if (file_data.dv) {\n    // Pool?\n    packetBufPoolFree(file_data.dv);\n    delete file_data.dv;\n  }\n  state.buffer_size -= file_data.length;\n  assert(state.buffer_size >= 0);\n  delete state.files[file_id];\n}\n\nexport function chunkedReceiverInit(name, max_buffer_size) {\n  return {\n    name,\n    max_buffer_size,\n    last_file_id: 0,\n    buffer_size: 0,\n    files: {},\n  };\n}\n\nexport function chunkedReceiverCleanup(state) {\n  if (!state || !state.files) {\n    return;\n  }\n  for (let file_id in state.files) {\n    cleanupFile(state, file_id);\n  }\n}\n\nexport function chunkedReceiverFreeFile(container) {\n  let { buffer, dv } = container;\n  assert(buffer);\n  assert(dv);\n  packetBufPoolFree(dv);\n  delete container.buffer;\n}\n\nexport function chunkedReceiverGetFile(state, file_id) {\n  if (!state) {\n    return { err: 'ERR_NOT_INITIALIZED' };\n  }\n  function err(msg) {\n    console.error(`${state.name}: chunkedReceiverGetFile(${file_id}): ${msg}`);\n    return { err: msg };\n  }\n  if (!state.files) {\n    return err('ERR_FILE_NOT_FOUND');\n  }\n  let file_data = state.files[file_id];\n  if (!file_data) {\n    return err('ERR_FILE_NOT_FOUND');\n  }\n  if (!file_data.finished) {\n    cleanupFile(state, file_id);\n    return err('ERR_UPLOAD_UNFINISHED');\n  }\n  let { dv, mime_type, length } = file_data;\n  file_data.buffer = null;\n  file_data.dv = null;\n  cleanupFile(state, file_id);\n  let buffer = new Uint8Array(dv.buffer, dv.byteOffset, length);\n  return {\n    dv,\n    mime_type,\n    buffer,\n  };\n}\n\nexport function chunkedReceiverStart(state, pak, resp_func) {\n  assert(state);\n  let length = pak.readInt();\n  let crc = pak.readU32();\n  let mime_type = pak.readAnsiString();\n  let log = `${state.name}: chunkedReceiverStart length=${length} crc=${crc} mime=${mime_type}`;\n\n  if (length > state.max_buffer_size) {\n    console.error(`${log}: ERR_TOO_LARGE`);\n    return void resp_func('ERR_TOO_LARGE');\n  }\n  if (state.buffer_size + length > state.max_buffer_size) {\n    console.error(`${log}: ERR_OUT_OF_SPACE`);\n    return void resp_func('ERR_OUT_OF_SPACE');\n  }\n\n  state.buffer_size += length;\n\n  let id = ++state.last_file_id;\n  console.log(`${log} id=${id}`);\n  state.files[id] = {\n    length,\n    crc,\n    mime_type,\n    total: 0,\n    dv: packetBufPoolAlloc(length),\n  };\n  resp_func(null, id);\n}\n\nexport function chunkedReceiverOnChunk(state, pak, resp_func) {\n  if (!state) {\n    pak.pool();\n    return void resp_func('ERR_NOT_INITED');\n  }\n  let id = pak.readInt();\n  let offs = pak.readInt();\n  let buf = pak.readBuffer(false);\n  let log = `${state.name}: chunkedReceiverOnChunk id=${id} offs=${offs} length=${buf.length}`;\n  let file_data = state.files && state.files[id];\n  if (!file_data) {\n    console.error(`${log}: ERR_INVALID_FILE_ID`);\n    return void resp_func('ERR_INVALID_FILE_ID');\n  }\n  if (file_data.total + buf.length > file_data.length) {\n    cleanupFile(state, id);\n    console.error(`${log}: ERR_BUFFER_OVERRUN`);\n    return void resp_func('ERR_BUFFER_OVERRUN');\n  }\n  console.debug(log);\n  file_data.total += buf.length;\n  file_data.dv.u8.set(buf, offs);\n  if (state.on_progress) {\n    state.on_progress(file_data.total, file_data.length, file_data.mime_type, id);\n  }\n  resp_func();\n}\n\n// Optional? do some final checks\nexport function chunkedReceiverFinish(state, pak, resp_func) {\n  let id = pak.readInt();\n  if (!state) {\n    return void resp_func('ERR_NOT_INITED');\n  }\n  let file_data = state.files && state.files[id];\n  let log = `${state.name}: chunkedReceiverFinish id=${id}`;\n  if (!file_data) {\n    console.error(`${log}: ERR_INVALID_FILE_ID`);\n    return void resp_func('ERR_INVALID_FILE_ID');\n  }\n  if (file_data.total !== file_data.length) {\n    cleanupFile(state, id);\n    console.error(`${log}: ERR_INCOMPLETE (total=${file_data.total} length=${file_data.length})`);\n    return void resp_func('ERR_INCOMPLETE');\n  }\n  let crc = crc32(file_data.dv.u8, file_data.length);\n  if (crc !== file_data.crc) {\n    cleanupFile(state, id);\n    console.error(`${log}: ERR_CRC_MISMATCH (expected=${file_data.crc} actual=${crc})`);\n    return void resp_func('ERR_CRC_MISMATCH');\n  }\n  file_data.finished = true;\n  resp_func();\n}\n\n// cb(err, id)\nexport function chunkedSend(opts, cb) {\n  let { client, buffer, mime_type, max_in_flight } = opts;\n  assert(buffer instanceof Uint8Array, 'Invalid data type');\n  assert(mime_type, 'Missing mime_type');\n\n  let length = buffer.length;\n  assert(length);\n  let crc = crc32(buffer);\n\n  let id;\n  asyncSeries([\n    function getID(next) {\n      let pak = client.pak('upload_start');\n      pak.writeInt(length);\n      pak.writeU32(crc);\n      pak.writeAnsiString(mime_type);\n      pak.send(function (err, assigned_id) {\n        id = assigned_id;\n        next(err);\n      });\n    },\n    function streamFile(next) {\n      let num_chunks = ceil(length / CHUNK_SIZE);\n\n      let any_error = false;\n      function sendChunk(idx, next) {\n        if (any_error) {\n          // Already had an error, fail-fast, don't try to send on disconnected link, etc\n          return void next();\n        }\n        assert(idx < num_chunks);\n        let pak = client.pak('upload_chunk');\n        pak.writeInt(id);\n        let start = idx * CHUNK_SIZE;\n        pak.writeInt(start);\n        let chunk_len = min(CHUNK_SIZE, length - start);\n        pak.writeBuffer(new Uint8Array(buffer.buffer, buffer.byteOffset + start, chunk_len));\n        pak.send(function (err) {\n          if (err) {\n            any_error = true;\n          }\n          next(err);\n        });\n      }\n      let tasks = [];\n      for (let ii = 0; ii < num_chunks; ++ii) {\n        tasks.push(sendChunk.bind(null, ii));\n      }\n      asyncParallelLimit(tasks, max_in_flight, next);\n    },\n    function finish(next) {\n      let pak = client.pak('upload_finish');\n      pak.writeInt(id);\n      pak.send(next);\n    },\n  ], function (err) {\n    cb(err, id);\n  });\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst { isInteger } = require('./util.js');\nconst { perfCounterAdd } = require('./perfcounters.js');\n\nexport function canonical(cmd) {\n  return cmd.toLowerCase().replace(/[_.]/g, '');\n}\n\nexport const TYPE_INT = 0;\nexport const TYPE_FLOAT = 1;\nexport const TYPE_STRING = 2;\nconst TYPE_NAME = ['INTEGER', 'NUMBER', 'STRING'];\n\nexport function defaultHandler(err, resp) {\n  if (err) {\n    console.error(err, resp);\n  } else {\n    console.info(resp);\n  }\n}\n\nfunction checkAccess(access, list) {\n  if (list) {\n    for (let ii = 0; ii < list.length; ++ii) {\n      if (!access || !access[list[ii]]) {\n        return false;\n      }\n    }\n  }\n  return true;\n}\n\nfunction formatUsage(usage, help, prefix_help) {\n  return !usage ? undefined :\n    prefix_help ? `${help}\\n${usage}`:\n    help ? String(usage).replace(/\\$HELP/, help) :\n    String(usage);\n}\n\nfunction CmdParse(params) {\n  this.cmds = {};\n  this.cmds_for_complete = this.cmds;\n  this.was_not_found = false;\n  this.storage = params && params.storage; // expects .setJSON(), .getJSON()\n  this.default_handler = defaultHandler;\n  this.last_access = null;\n  this.register({\n    cmd: 'cmd_list',\n    func: this.cmdList.bind(this),\n    access_show: ['hidden'],\n  });\n}\nCmdParse.prototype.cmdList = function (str, resp_func) {\n  if (!this.cmd_list) {\n    let list = this.cmd_list = {};\n    for (let cmd in this.cmds) {\n      let cmd_data = this.cmds[cmd];\n      let access = []; // combine for data compaction\n      if (cmd_data.access_show) {\n        access = access.concat(cmd_data.access_show);\n      }\n      if (cmd_data.access_run) {\n        access = access.concat(cmd_data.access_run);\n      }\n      if (access.indexOf('hidden') !== -1) {\n        continue;\n      }\n      let data = {\n        name: cmd_data.name,\n        help: String(cmd_data.help),\n      };\n      if (cmd_data.usage) {\n        data.usage = formatUsage(cmd_data.usage, cmd_data.help, cmd_data.prefix_usage_with_help);\n      }\n      if (access.length) {\n        data.access_show = access;\n      }\n      list[cmd] = data;\n    }\n  }\n  resp_func(null, this.cmd_list);\n};\n\nCmdParse.prototype.setDefaultHandler = function (fn) {\n  assert(this.default_handler === defaultHandler); // Should only set this once\n  this.default_handler = fn;\n};\nCmdParse.prototype.checkAccess = function (access_list) {\n  return checkAccess(this.last_access, access_list);\n};\nCmdParse.prototype.handle = function (self, str, resp_func) {\n  resp_func = resp_func || this.default_handler;\n  this.was_not_found = false;\n  let m = str.match(/^([^\\s]+)(?:\\s+(.*))?$/);\n  if (!m) {\n    resp_func('Missing command');\n    return true;\n  }\n  let cmd = canonical(m[1]);\n  let cmd_data = this.cmds[cmd];\n  this.last_access = self && self.access;\n  if (cmd_data && !checkAccess(this.last_access, cmd_data.access_run)) {\n    // this.was_not_found = true;\n    resp_func(`Access denied: \"${m[1]}\"`);\n    return false;\n  }\n  if (!cmd_data) {\n    this.was_not_found = true;\n    resp_func(`Unknown command: \"${m[1]}\"`);\n    this.was_not_found = false;\n    return false;\n  }\n  perfCounterAdd(`cmd.${cmd}`);\n  cmd_data.fn.call(self, m[2] || '', resp_func);\n  return true;\n};\n\nCmdParse.prototype.register = function (param) {\n  assert.equal(typeof param, 'object');\n  let { cmd, func, help, usage, prefix_usage_with_help, access_show, access_run } = param;\n  assert(cmd && func);\n  let help_lower = String(help || '').toLowerCase();\n  if (help_lower.includes('(admin)')) {\n    assert(access_run && access_run.includes('sysadmin'));\n  }\n  if (help_lower.includes('(hidden)')) {\n    assert(access_show && access_show.length);\n  }\n  this.cmds[canonical(cmd)] = {\n    name: cmd,\n    fn: func,\n    help,\n    usage,\n    prefix_usage_with_help,\n    access_show,\n    access_run,\n  };\n};\n\nfunction formatRangeValue(type, value) {\n  let ret = String(value);\n  if (type === TYPE_FLOAT && !ret.includes('.')) {\n    ret += '.00';\n  }\n  return ret;\n}\n\n// Optional param.on_change(is_startup:boolean)\nCmdParse.prototype.registerValue = function (cmd, param) {\n  assert(TYPE_NAME[param.type] || !param.set);\n  assert(param.set || param.get);\n  let label = param.label || cmd;\n  let store = param.store && this.storage || false;\n  let store_key = `cmd_parse_${canonical(cmd)}`;\n  if (param.ver) {\n    store_key += `_${param.ver}`;\n  }\n  if (store) {\n    assert(param.set);\n    let init_value = this.storage.getJSON(store_key);\n    if (init_value !== undefined) {\n      // enforce stored values within current range\n      if (param.range) {\n        init_value = Number(init_value);\n        if (!isFinite(init_value) || init_value < param.range[0] || init_value > param.range[1]) {\n          init_value = undefined;\n        }\n      }\n      if (init_value !== undefined) {\n        param.set(init_value);\n      }\n      if (param.on_change) {\n        param.on_change(true);\n      }\n    }\n  }\n  let fn = (str, resp_func) => {\n    function value() {\n      resp_func(null, `${label} = ${param.get()}`);\n    }\n    function usage() {\n      resp_func(`Usage: /${cmd} ${TYPE_NAME[param.type]}`);\n    }\n    if (!str) {\n      if (param.get && param.set) {\n        // More explicit help for these automatic value settings\n        let is_bool = param.type === TYPE_INT && param.range && param.range[0] === 0 && param.range[1] === 1;\n        let help = [\n          `${label}:`,\n        ];\n        if (param.range) {\n          help.push(`Valid range: [${formatRangeValue(param.type, param.range[0])}...` +\n            `${formatRangeValue(param.type, param.range[1])}]`);\n        }\n        let cur_value = param.get();\n        if (is_bool) {\n          help.push(`To disable: /${cmd} 0`);\n          help.push(`To enable: /${cmd} 1`);\n        } else {\n          help.push(`To change: /${cmd} NewValue`);\n          help.push(`  example: /${cmd} ${param.range ?\n            cur_value === param.range[0] ? param.range[1] : param.range[0] : 1}`);\n        }\n        let def_value = param.default_value;\n        if (def_value !== undefined) {\n          help.push(`Default value = ${def_value}${is_bool ? ` (${def_value ? 'Enabled' : 'Disabled'})`: ''}`);\n        }\n        help.push(`Current value = ${cur_value}${is_bool ? ` (${cur_value ? 'Enabled' : 'Disabled'})`: ''}`);\n        return resp_func(null, help.join('\\n'));\n      } else if (param.get) {\n        return value();\n      } else {\n        return usage();\n      }\n    }\n    if (!param.set) {\n      return resp_func(`Usage: /${cmd}`);\n    }\n    let n = Number(str);\n    if (param.range) {\n      if (n < param.range[0]) {\n        n = param.range[0];\n      } else if (n > param.range[1]) {\n        n = param.range[1];\n      }\n    }\n    let store_value = n;\n    if (param.type === TYPE_INT) {\n      if (!isInteger(n)) {\n        return usage();\n      }\n      param.set(n);\n    } else if (param.type === TYPE_FLOAT) {\n      if (!isFinite(n)) {\n        return usage();\n      }\n      param.set(n);\n    } else {\n      store_value = str;\n      param.set(str);\n    }\n    if (store) {\n      this.storage.setJSON(store_key, store_value);\n    }\n    if (param.on_change) {\n      param.on_change(false);\n    }\n    if (param.get) {\n      return value();\n    } else {\n      return resp_func(null, `${label} udpated`);\n    }\n  };\n  this.register({\n    cmd,\n    func: fn,\n    help: param.help || ((param.get && param.set) ?\n      `Set or display \"${label}\" value` :\n      param.set ? `Set \"${label}\" value` : `Display \"${label}\" value`),\n    usage: param.usage || ((param.get ? `Display \"${label}\" value\\n  Usage: /${cmd}\\n` : '') +\n      (param.set ? `Set \"${label}\" value\\n  Usage: /${cmd} NewValue` : '')),\n    prefix_usage_with_help: param.prefix_usage_with_help,\n    access_show: param.access_show,\n    access_run: param.access_run,\n  });\n};\n\nfunction cmpCmd(a, b) {\n  if (a.cname < b.cname) {\n    return -1;\n  }\n  return 1;\n}\n\n// for auto-complete\nCmdParse.prototype.addServerCommands = function (new_cmds) {\n  let cmds = this.cmds_for_complete;\n  if (this.cmds_for_complete === this.cmds) {\n    cmds = this.cmds_for_complete = {};\n    for (let cname in this.cmds) {\n      cmds[cname] = this.cmds[cname];\n    }\n  }\n  for (let cname in new_cmds) {\n    if (!cmds[cname]) {\n      cmds[cname] = new_cmds[cname];\n    }\n  }\n};\n\nCmdParse.prototype.autoComplete = function (str, access) {\n  let list = [];\n  str = str.split(' ');\n  let first_tok = canonical(str[0]);\n  for (let cname in this.cmds_for_complete) {\n    if (str.length === 1 && cname.slice(0, first_tok.length) === first_tok ||\n      str.length > 1 && cname === first_tok\n    ) {\n      let cmd_data = this.cmds_for_complete[cname];\n      if (checkAccess(access, cmd_data.access_show) && checkAccess(access, cmd_data.access_run)) {\n        list.push({\n          cname,\n          cmd: cmd_data.name,\n          help: String(cmd_data.help),\n          usage: formatUsage(cmd_data.usage, cmd_data.help, cmd_data.prefix_usage_with_help),\n        });\n      }\n    }\n  }\n  list.sort(cmpCmd);\n  return list; // .slice(0, 20); Maybe?\n};\n\nCmdParse.prototype.canonical = canonical;\n\nCmdParse.prototype.TYPE_INT = TYPE_INT;\nCmdParse.prototype.TYPE_FLOAT = TYPE_FLOAT;\nCmdParse.prototype.TYPE_STRING = TYPE_STRING;\n\nexport function create(params) {\n  return new CmdParse(params);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n// Possibly originally from PNG Specification Appendix: https://www.w3.org/TR/PNG-CRCAppendix.html\n\n// Table of CRCs of all 8-bit messages.\nlet crc_table = new Array(256);\n\n// Make the table for a fast CRC.\n(function () {\n  for (let n = 0; n < 256; n++) {\n    let c = n;\n    for (let k = 0; k < 8; k++) {\n      if (c & 1) {\n        c = -306674912 ^ (c >>> 1);\n      } else {\n        c >>>= 1;\n      }\n    }\n    crc_table[n] = c;\n  }\n}());\n\n\n/* Update a running CRC with the bytes buf[0..len-1]--the CRC\nshould be initialized to all 1's, and the transmitted value\nis the 1's complement of the final running CRC (see the\ncrc32() routine below)). */\n\nfunction update_crc(crc, buf, len) {\n  for (let n = 0; n < len; n++) {\n    crc = crc_table[(crc ^ buf[n]) & 0xff] ^ (crc >>> 8);\n  }\n  return crc;\n}\n\n// Return the CRC of the bytes buf[0..len-1].\nfunction crc32(buf, len) {\n  len = len || buf.length;\n  return (update_crc(0xffffffff, buf, len) ^ 0xffffffff) >>> 0;\n}\nmodule.exports = crc32;\nmodule.exports.crc32 = crc32;\n","/* eslint prefer-template:off */\n// From https://github.com/sindresorhus/dot-prop\n// MIT License\n// Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)\n\n// Adjusted to work on old browsers (if through Babel) and to not crash on Arrays\n\nconst { arrayToSet } = require('./util.js');\n\nconst disallowedKeys = arrayToSet([\n  '__proto__',\n  'prototype',\n  'constructor'\n]);\n\nfunction isObject(value) {\n  const type = typeof value;\n  return value !== null && (type === 'object' || type === 'function');\n}\n\nfunction isValidPath(pathSegments) {\n  for (let ii = 0; ii < pathSegments.length; ++ii) {\n    if (disallowedKeys[pathSegments[ii]]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction getPathSegments(path) {\n  const pathArray = path.split('.');\n  const parts = [];\n\n  for (let i = 0; i < pathArray.length; i++) {\n    let p = pathArray[i];\n\n    while (p[p.length - 1] === '\\\\' && pathArray[i + 1] !== undefined) {\n      p = p.slice(0, -1) + '.';\n      p += pathArray[++i];\n    }\n\n    parts.push(p);\n  }\n\n  if (!isValidPath(parts)) {\n    return [];\n  }\n\n  return parts;\n}\n\nmodule.exports = {\n  get(object, path, value) {\n    if (!isObject(object) || typeof path !== 'string') {\n      return value === undefined ? object : value;\n    }\n\n    const pathArray = getPathSegments(path);\n    if (pathArray.length === 0) {\n      return value;\n    }\n\n    for (let i = 0; i < pathArray.length; i++) {\n      object = object[pathArray[i]];\n\n      if (object === undefined || object === null) {\n        // `object` is either `undefined` or `null` so we want to stop the loop, and\n        // if this is not the last bit of the path, and\n        // if it did't return `undefined`\n        // it would return `null` if `object` is `null`\n        // but we want `get({foo: null}, 'foo.bar')` to equal `undefined`, or the supplied value, not `null`\n        if (i !== pathArray.length - 1) {\n          return value;\n        }\n\n        break;\n      }\n    }\n\n    return object === undefined ? value : object;\n  },\n\n  set(object, path, value) {\n    if (!isObject(object) || typeof path !== 'string') {\n      return object;\n    }\n\n    const root = object;\n    const pathArray = getPathSegments(path);\n\n    for (let i = 0; i < pathArray.length; i++) {\n      const p = pathArray[i];\n\n      if (i === pathArray.length - 1) {\n        object[p] = value;\n      } else if (!isObject(object[p])) {\n        object[p] = {};\n      }\n\n\n      object = object[p];\n    }\n\n    return root;\n  },\n\n  // eslint-disable-next-line consistent-return\n  delete(object, path) {\n    if (!isObject(object) || typeof path !== 'string') {\n      return false;\n    }\n\n    const pathArray = getPathSegments(path);\n\n    for (let i = 0; i < pathArray.length; i++) {\n      const p = pathArray[i];\n\n      if (i === pathArray.length - 1) {\n        delete object[p];\n        return true;\n      }\n\n      object = object[p];\n\n      if (!isObject(object)) {\n        return false;\n      }\n    }\n  },\n\n  has(object, path) {\n    if (!isObject(object) || typeof path !== 'string') {\n      return false;\n    }\n\n    const pathArray = getPathSegments(path);\n    if (pathArray.length === 0) {\n      return false;\n    }\n\n    for (let i = 0; i < pathArray.length; i++) {\n      if (isObject(object)) {\n        if (!(pathArray[i] in object)) {\n          return false;\n        }\n\n        object = object[pathArray[i]];\n      } else {\n        return false;\n      }\n    }\n\n    return true;\n  }\n};\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nexport let PRESENCE_OFFLINE = 0; // for invisible, etc\nexport let PRESENCE_ACTIVE = 1;\nexport let PRESENCE_INACTIVE = 2;\n\nexport const ID_PROVIDER_APPLE = 'apl';\nexport const ID_PROVIDER_FB_GAMING = 'fbg';\nexport const ID_PROVIDER_FB_INSTANT = 'fbi';\n\nfunction getStringEnumValues<T extends string>(e: Record<string, T>) {\n  return Object.values(e);\n}\nfunction isValidStringEnumValue<T extends string>(e: Record<string, T>, v: string | undefined | null): boolean {\n  for (let key in e) {\n    if (e[key] === v) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport enum Platform {\n  Android = 'android',\n  FBInstant = 'fbinstant',\n  IOS = 'ios',\n  Web = 'web',\n  Yandex = 'yandex',\n}\nexport function getPlatformValues(): Platform[] {\n  return getStringEnumValues(Platform);\n}\nexport function isValidPlatform(v: string | undefined | null): boolean {\n  return isValidStringEnumValue(Platform, v);\n}\n","export enum FriendStatus {\n  Added = 1,\n  AddedAuto = 2,\n  Removed = 3,\n  Blocked = 4,\n}\n\nexport interface FriendData {\n  status: FriendStatus;\n  ids?: Record<string, string>;\n}\n\nexport type FriendsData = Record<string, FriendData>;\n","/**\n *\n *  MD5 (Message-Digest Algorithm)\n *  http://www.webtoolkit.info/\n *\n * Modified by railGun to handle node.js Buffer objects\n *\n **/\n\n/* eslint no-bitwise:off, new-cap:off*/\nconst assert = require('assert');\n\nfunction stringUtf8Encode(str) {\n  let c;\n  let n;\n  let utftext = [];\n  str = str.replace(/\\r\\n/g, '\\n');\n  for (n = 0; n < str.length; ++n) {\n    c = str.charCodeAt(n);\n    if (c < 128) {\n      utftext.push(String.fromCharCode(c));\n    } else if ((c > 127) && (c < 2048)) {\n      utftext.push(String.fromCharCode((c >> 6) | 192));\n      utftext.push(String.fromCharCode((c & 63) | 128));\n    } else {\n      utftext.push(String.fromCharCode((c >> 12) | 224));\n      utftext.push(String.fromCharCode(((c >> 6) & 63) | 128));\n      utftext.push(String.fromCharCode((c & 63) | 128));\n    }\n  }\n  return utftext.join('');\n}\n\n\nfunction rotateLeft(lValue, iShiftBits) {\n  return (lValue<<iShiftBits) | (lValue>>>(32-iShiftBits));\n}\n\nfunction addUnsigned(lX,lY) {\n  let lX8 = (lX & 0x80000000);\n  let lY8 = (lY & 0x80000000);\n  let lX4 = (lX & 0x40000000);\n  let lY4 = (lY & 0x40000000);\n  let lResult = (lX & 0x3FFFFFFF)+(lY & 0x3FFFFFFF);\n  if (lX4 & lY4) {\n    return (lResult ^ 0x80000000 ^ lX8 ^ lY8);\n  }\n  if (lX4 | lY4) {\n    if (lResult & 0x40000000) {\n      return (lResult ^ 0xC0000000 ^ lX8 ^ lY8);\n    } else {\n      return (lResult ^ 0x40000000 ^ lX8 ^ lY8);\n    }\n  } else {\n    return (lResult ^ lX8 ^ lY8);\n  }\n}\n\nfunction F(x,y,z) {\n  return (x & y) | ((~x) & z);\n}\nfunction G(x,y,z) {\n  return (x & z) | (y & (~z));\n}\nfunction H(x,y,z) {\n  return (x ^ y ^ z);\n}\nfunction I(x,y,z) {\n  return (y ^ (x | (~z)));\n}\n\nfunction FF(a,b,c,d,x,s,ac) {\n  a = addUnsigned(a, addUnsigned(addUnsigned(F(b, c, d), x), ac));\n  return addUnsigned(rotateLeft(a, s), b);\n}\n\nfunction GG(a,b,c,d,x,s,ac) {\n  a = addUnsigned(a, addUnsigned(addUnsigned(G(b, c, d), x), ac));\n  return addUnsigned(rotateLeft(a, s), b);\n}\n\nfunction HH(a,b,c,d,x,s,ac) {\n  a = addUnsigned(a, addUnsigned(addUnsigned(H(b, c, d), x), ac));\n  return addUnsigned(rotateLeft(a, s), b);\n}\n\nfunction II(a,b,c,d,x,s,ac) {\n  a = addUnsigned(a, addUnsigned(addUnsigned(I(b, c, d), x), ac));\n  return addUnsigned(rotateLeft(a, s), b);\n}\n\nfunction convertToWordArray(string) {\n  let lWordCount;\n  let lMessageLength = string.length;\n  let lNumberOfWords_temp1=lMessageLength + 8;\n  let lNumberOfWords_temp2=\n    (lNumberOfWords_temp1-(lNumberOfWords_temp1 % 64))/64;\n  let lNumberOfWords = (lNumberOfWords_temp2+1)*16;\n  let lWordArray=new Array(lNumberOfWords-1);\n  let lBytePosition = 0;\n  let lByteCount = 0;\n  while (lByteCount < lMessageLength) {\n    lWordCount = (lByteCount-(lByteCount % 4))/4;\n    lBytePosition = (lByteCount % 4)*8;\n    lWordArray[lWordCount] |= string.charCodeAt(lByteCount) << lBytePosition;\n    lByteCount++;\n  }\n  lWordCount = (lByteCount-(lByteCount % 4))/4;\n  lBytePosition = (lByteCount % 4)*8;\n  lWordArray[lWordCount] |= (0x80<<lBytePosition);\n  lWordArray[lNumberOfWords-2] = lMessageLength<<3;\n  lWordArray[lNumberOfWords-1] = lMessageLength>>>29;\n  return lWordArray;\n}\n\n// function convertByteArraytoWordArray(arr) {\n//   let lWordCount;\n//   let lMessageLength = arr.length;\n//   let lNumberOfWords_temp1 = lMessageLength + 8;\n//   let lNumberOfWords_temp2 =\n//     (lNumberOfWords_temp1 - (lNumberOfWords_temp1 % 64)) / 64;\n//   let lNumberOfWords = (lNumberOfWords_temp2 + 1) * 16;\n//   let lWordArray = new Array(lNumberOfWords - 1);\n//   let lBytePosition = 0;\n//   let lByteCount = 0;\n//   while (lByteCount < lMessageLength) {\n//     lWordCount = (lByteCount - (lByteCount % 4)) / 4;\n//     lBytePosition = (lByteCount % 4) * 8;\n//     lWordArray[lWordCount] |= arr[lByteCount] << lBytePosition;\n//     lByteCount++;\n//   }\n//   lWordCount = (lByteCount - (lByteCount % 4)) / 4;\n//   lBytePosition = (lByteCount % 4) * 8;\n//   lWordArray[lWordCount] |= 0x80 << lBytePosition;\n//   lWordArray[lNumberOfWords - 2] = lMessageLength << 3;\n//   lWordArray[lNumberOfWords - 1] = lMessageLength >>> 29;\n//   return lWordArray;\n// }\n\nfunction wordToHex(lValue) {\n  let wordToHexValue='';\n\n\n  let wordToHexValue_temp='';\n\n\n  let lByte;\n  let lCount;\n  for (lCount = 0; lCount<=3; lCount++) {\n    lByte = (lValue>>>(lCount*8)) & 255;\n    wordToHexValue_temp = `0${lByte.toString(16)}`;\n    wordToHexValue +=\n      wordToHexValue_temp.substr(wordToHexValue_temp.length-2,2);\n  }\n  return wordToHexValue;\n}\n\n// string can either be a string, node.js Buffer, array (of numbers < 256)\n// or a typed array\nmodule.exports = function md5(string) {\n  let AA;\n  let BB;\n  let CC;\n  let DD;\n  let a;\n  let b;\n  let c;\n  let d;\n  let k;\n  let S11=7;\n  let S12=12;\n  let S13=17;\n  let S14=22;\n  let S21=5;\n  let S22=9;\n  let S23=14;\n  let S24=20;\n  let S31=4;\n  let S32=11;\n  let S33=16;\n  let S34=23;\n  let S41=6;\n  let S42=10;\n  let S43=15;\n  let S44=21;\n\n  let x;\n  if (typeof string === 'string') {\n    string = stringUtf8Encode(string);\n    x = convertToWordArray(string);\n  } else {\n    assert(false); // disable due to not used\n    // node.js buffer or Array\n    // x = convertByteArraytoWordArray(string);\n  }\n\n  a = 0x67452301;\n  b = 0xEFCDAB89;\n  c = 0x98BADCFE;\n  d = 0x10325476;\n\n  for (k=0; k<x.length; k+=16) {\n    AA=a;\n    BB=b;\n    CC=c;\n    DD=d;\n    a=FF(a,b,c,d,x[k], S11,0xD76AA478);\n    d=FF(d,a,b,c,x[k+1], S12,0xE8C7B756);\n    c=FF(c,d,a,b,x[k+2], S13,0x242070DB);\n    b=FF(b,c,d,a,x[k+3], S14,0xC1BDCEEE);\n    a=FF(a,b,c,d,x[k+4], S11,0xF57C0FAF);\n    d=FF(d,a,b,c,x[k+5], S12,0x4787C62A);\n    c=FF(c,d,a,b,x[k+6], S13,0xA8304613);\n    b=FF(b,c,d,a,x[k+7], S14,0xFD469501);\n    a=FF(a,b,c,d,x[k+8], S11,0x698098D8);\n    d=FF(d,a,b,c,x[k+9], S12,0x8B44F7AF);\n    c=FF(c,d,a,b,x[k+10],S13,0xFFFF5BB1);\n    b=FF(b,c,d,a,x[k+11],S14,0x895CD7BE);\n    a=FF(a,b,c,d,x[k+12],S11,0x6B901122);\n    d=FF(d,a,b,c,x[k+13],S12,0xFD987193);\n    c=FF(c,d,a,b,x[k+14],S13,0xA679438E);\n    b=FF(b,c,d,a,x[k+15],S14,0x49B40821);\n    a=GG(a,b,c,d,x[k+1], S21,0xF61E2562);\n    d=GG(d,a,b,c,x[k+6], S22,0xC040B340);\n    c=GG(c,d,a,b,x[k+11],S23,0x265E5A51);\n    b=GG(b,c,d,a,x[k], S24,0xE9B6C7AA);\n    a=GG(a,b,c,d,x[k+5], S21,0xD62F105D);\n    d=GG(d,a,b,c,x[k+10],S22,0x2441453);\n    c=GG(c,d,a,b,x[k+15],S23,0xD8A1E681);\n    b=GG(b,c,d,a,x[k+4], S24,0xE7D3FBC8);\n    a=GG(a,b,c,d,x[k+9], S21,0x21E1CDE6);\n    d=GG(d,a,b,c,x[k+14],S22,0xC33707D6);\n    c=GG(c,d,a,b,x[k+3], S23,0xF4D50D87);\n    b=GG(b,c,d,a,x[k+8], S24,0x455A14ED);\n    a=GG(a,b,c,d,x[k+13],S21,0xA9E3E905);\n    d=GG(d,a,b,c,x[k+2], S22,0xFCEFA3F8);\n    c=GG(c,d,a,b,x[k+7], S23,0x676F02D9);\n    b=GG(b,c,d,a,x[k+12],S24,0x8D2A4C8A);\n    a=HH(a,b,c,d,x[k+5], S31,0xFFFA3942);\n    d=HH(d,a,b,c,x[k+8], S32,0x8771F681);\n    c=HH(c,d,a,b,x[k+11],S33,0x6D9D6122);\n    b=HH(b,c,d,a,x[k+14],S34,0xFDE5380C);\n    a=HH(a,b,c,d,x[k+1], S31,0xA4BEEA44);\n    d=HH(d,a,b,c,x[k+4], S32,0x4BDECFA9);\n    c=HH(c,d,a,b,x[k+7], S33,0xF6BB4B60);\n    b=HH(b,c,d,a,x[k+10],S34,0xBEBFBC70);\n    a=HH(a,b,c,d,x[k+13],S31,0x289B7EC6);\n    d=HH(d,a,b,c,x[k], S32,0xEAA127FA);\n    c=HH(c,d,a,b,x[k+3], S33,0xD4EF3085);\n    b=HH(b,c,d,a,x[k+6], S34,0x4881D05);\n    a=HH(a,b,c,d,x[k+9], S31,0xD9D4D039);\n    d=HH(d,a,b,c,x[k+12],S32,0xE6DB99E5);\n    c=HH(c,d,a,b,x[k+15],S33,0x1FA27CF8);\n    b=HH(b,c,d,a,x[k+2], S34,0xC4AC5665);\n    a=II(a,b,c,d,x[k], S41,0xF4292244);\n    d=II(d,a,b,c,x[k+7], S42,0x432AFF97);\n    c=II(c,d,a,b,x[k+14],S43,0xAB9423A7);\n    b=II(b,c,d,a,x[k+5], S44,0xFC93A039);\n    a=II(a,b,c,d,x[k+12],S41,0x655B59C3);\n    d=II(d,a,b,c,x[k+3], S42,0x8F0CCC92);\n    c=II(c,d,a,b,x[k+10],S43,0xFFEFF47D);\n    b=II(b,c,d,a,x[k+1], S44,0x85845DD1);\n    a=II(a,b,c,d,x[k+8], S41,0x6FA87E4F);\n    d=II(d,a,b,c,x[k+15],S42,0xFE2CE6E0);\n    c=II(c,d,a,b,x[k+6], S43,0xA3014314);\n    b=II(b,c,d,a,x[k+13],S44,0x4E0811A1);\n    a=II(a,b,c,d,x[k+4], S41,0xF7537E82);\n    d=II(d,a,b,c,x[k+11],S42,0xBD3AF235);\n    c=II(c,d,a,b,x[k+2], S43,0x2AD7D2BB);\n    b=II(b,c,d,a,x[k+9], S44,0xEB86D391);\n    a=addUnsigned(a,AA);\n    b=addUnsigned(b,BB);\n    c=addUnsigned(c,CC);\n    d=addUnsigned(d,DD);\n  }\n\n  let temp = wordToHex(a)+wordToHex(b)+wordToHex(c)+wordToHex(d);\n  return temp.toLowerCase();\n};\n\n/* // Uncomment this and run \"node MD5.js file.ext\"\nvar FS = require('fs');\nvar data = FS.readFileSync(process.argv[2]);\nvar md5 = module.exports(data);\nconsole.log('MD5 = ' + md5);\n// */\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n// Some code derived from libGLOV (C++), also MIT Licensed\n\n/* eslint no-bitwise:off */\n\n// Upon read, throw an exception if there is any data read error (e.g. read off of end of packet)\n\n// TODO: Maybe: Have 2 offsets, one for writing (data_len?), one for reading (buf_offs?),\n//   then there should be many fewer ?pak.readable branches\n//   that return different values under different circumstances, and maybe fewer .makeReadable() calls needed.\n\n\n// 3 bits of flags reserved for internal use\nconst PACKET_DEBUG = exports.PACKET_DEBUG = 1<<0;\nconst PACKET_RESERVED1 = exports.PACKET_RESERVED1 = 1<<1;\nconst PACKET_RESERVED2 = exports.PACKET_RESERVED2 = 1<<2;\nconst FLAG_PACKET_INTERNAL = PACKET_DEBUG | PACKET_RESERVED1 | PACKET_RESERVED2;\n\n// Internal, runtime-only (not serialized) flags < 8 bits\nconst PACKET_UNOWNED_BUFFER = 1 << 8;\n\nexports.default_flags = 0;\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst { max } = Math;\nconst { isInteger, log2 } = require('./util.js');\n// const { isInteger, log2 } = require('../../build.dev/common/glov/util.js');\nconst { base64Encode, base64Decode } = require('./base64.js');\n\nconst FALSYS = [undefined, null, 0, false, '', NaN];\nconst PAK_BUF_DEFAULT_SIZE = 1024;\n\nconst UNDERRUN = 'PKTERR_UNDERRUN';\n\nconst POOL_PACKETS = 5000;\nconst POOL_TIMEOUT = 5000;\nconst POOL_BUF_BY_SIZE = [\n  0, // 2^0 : 1 - shouldn't be allocated ever?\n  10, // 2^1 : 2\n  10, // 2^2 : 4\n  20, // 2^3 : 8\n  20, // 2^4 : 16\n  20, // 2^5 : 32\n  20, // 2^6 : 64\n  20, // 2^7 : 128\n  20, // 2^8 : 256\n  20, // 2^9 : 512\n  5000, // 2^10 : 1024 - standard Packet size\n  20, // 2^11 : 2048\n  20, // 2^12 : 4096\n  20, // 2^13 : 8192\n  20, // 2^14 : 16384\n  20, // 2^15 : 32768\n  20, // 2^16 : 65536\n  10, // 2^17 : 131072\n  10, // 2^18 : 262144,\n];\n\nlet pak_pool = [];\nlet pak_debug_pool = [];\nlet buf_pool = POOL_BUF_BY_SIZE.map(() => []);\n\nfunction allocDataView(size) {\n  let pool_idx = log2(size);\n  assert(pool_idx);\n  if (pool_idx >= buf_pool.length) {\n    pool_idx = 0;\n  }\n  if (pool_idx) {\n    size = 1 << pool_idx;\n    if (buf_pool[pool_idx].length) {\n      // No reinit here, just a container\n      //console.log(`Buffer FROMPOOL:${size}/${pool_idx}`);\n      return buf_pool[pool_idx].pop();\n    }\n  } else {\n    // Enable this (and lower pool size) to track down big packets:\n    // console.log(`Allocating UNPOOLABLE buffer of size ${size} from ${new Error().stack}`);\n  }\n  //console.log(`Buffer ALLOC:${size}`);\n  let u8 = new Uint8Array(size);\n  let dv = new DataView(u8.buffer);\n  dv.u8 = u8;\n  if (pool_idx) {\n    dv.packet_pool_idx = pool_idx;\n  }\n  return dv;\n}\n\nfunction wrapU8AsDataView(u8) {\n  let dv = new DataView(u8.buffer, u8.byteOffset, u8.byteLength);\n  dv.u8 = u8;\n  return dv;\n}\n\nfunction utf8ByteLength(str) {\n  let len = str.length;\n  let ret = len;\n  for (let ii = 0; ii < len; ++ii) {\n    let c = str.charCodeAt(ii);\n    if (c > 0x7F) {\n      ++ret;\n      if (c > 0x07FF) {\n        ++ret;\n        if (c > 0xFFFF) {\n          ++ret;\n          if (c > 0x1FFFFF) {\n            ++ret;\n            if (c > 0x3FFFFFF) {\n              ++ret;\n            }\n          }\n        }\n      }\n    }\n  }\n  return ret;\n}\n\n// Assumes buffer will fit it\nfunction utf8WriteChar(buf, buf_offs, c) {\n  if (c > 0x10FFFF) {\n    // Limit to Unicode max code point. Note that this function currently\n    //   receives character codes, not code points, so will not actually\n    //   ever receive a value over 0xFFFF since JavaScript uses UTF-16\n    //   character codes.  See note on writeString below.\n    c = 0xFFFF;\n  }\n  if (c <= 0x7F) {\n    buf.u8[buf_offs++] = c;\n  } else if (c <= 0x07FF) {\n    buf.u8[buf_offs++] = (c >> 6) | 0xC0;\n    buf.u8[buf_offs++] = (c & 0x3F) | 0x80;\n  } else if (c <= 0xFFFF) {\n    buf.u8[buf_offs++] = (c >> 12) | 0xE0;\n    buf.u8[buf_offs++] = ((c >> 6) & 0x3F) | 0x80;\n    buf.u8[buf_offs++] = (c & 0x3F) | 0x80;\n  } else if (c <= 0x10FFFF) { // Note: technically can fit up to 0x1FFFFF here, but those code points are disallowed\n    buf.u8[buf_offs++] = (c >> 18) | 0xF0;\n    buf.u8[buf_offs++] = ((c >> 12) & 0x3F) | 0x80;\n    buf.u8[buf_offs++] = ((c >> 6) & 0x3F) | 0x80;\n    buf.u8[buf_offs++] = (c & 0x3F) | 0x80;\n  } else {\n    assert(false);\n  }\n  return buf_offs;\n}\n\nfunction poolBuf(dv) {\n  // if it's poolable (not part of another Buffer), pool it!\n  assert(dv);\n  assert(dv.u8);\n  let pool_idx = dv.packet_pool_idx;\n  if (pool_idx) {\n    let arr = buf_pool[pool_idx];\n    if (arr.length < POOL_BUF_BY_SIZE[pool_idx]) {\n      //console.log(`Buffer TOPOOL:${dv.byteLength}/${pool_idx}`);\n      arr.push(dv);\n    }\n  } else {\n    // console.log(`Buffer UNPOOLABLE:${dv.byteLength}`);\n  }\n}\n\nexport function packetBufPoolAlloc(size) {\n  return allocDataView(size);\n}\nexport function packetBufPoolFree(dv) {\n  poolBuf(dv);\n}\n\nfunction Packet(flags, init_size, pak_debug) {\n  this.reinit(flags, init_size, pak_debug);\n}\nPacket.prototype.reinit = function (flags, init_size, pak_debug) {\n  this.flags = flags || 0;\n  this.has_flags = false;\n  this.buf = null;\n  this.buf_len = 0;\n  this.buf_offs = 0;\n  this.bufs = null;\n  this.bsizes = null;\n  this.readable = false;\n  this.ref_count = 1;\n  this.pak_debug = pak_debug;\n  if (init_size) {\n    this.fit(init_size, true);\n    this.buf_len = init_size;\n  }\n};\nPacket.prototype.getRefCount = function () {\n  return this.ref_count;\n};\nPacket.prototype.ref = function () {\n  assert(this.ref_count); // must not already be pooled!\n  ++this.ref_count;\n};\nPacket.prototype.pool = function () {\n  assert(this.ref_count);\n  if (--this.ref_count) {\n    return;\n  }\n  // Do not clear on pool(), callers (readInt()) may still momentarily reference .buf, etc\n  if (this.flags & PACKET_UNOWNED_BUFFER) {\n    // doing nothing with buffers, still pooling the packet\n  } else {\n    if (this.buf) {\n      poolBuf(this.buf);\n    }\n    if (this.bufs) {\n      for (let ii = 0; ii < this.bufs.length; ++ii) {\n        poolBuf(this.bufs[ii]);\n      }\n    }\n  }\n  if (pak_pool.length < POOL_PACKETS) {\n    pak_pool.push(this);\n  }\n  if (this.pak_debug) {\n    this.pak_debug.poolDebug();\n  }\n};\n\nPacket.prototype.totalSize = function () {\n  let ret = 0;\n  if (this.readable) {\n    return this.buf_len;\n  }\n  if (this.bsizes) {\n    for (let ii = 0; ii < this.bsizes.length; ++ii) {\n      ret += this.bsizes[ii];\n    }\n  }\n  ret += this.buf_offs;\n  return ret;\n};\n\nPacket.prototype.setReadable = function () {\n  assert(this.buf);\n  assert(!this.bufs);\n  assert(!this.readable);\n  this.readable = true;\n};\n\nPacket.prototype.makeReadable = function () {\n  assert(this.buf);\n  assert(!this.readable); // otherwise just reset offset? or do nothing?\n  let total = this.totalSize(); // before this.readable = true\n  this.readable = true;\n  if (!this.bufs) {\n    this.buf_len = total;\n    this.buf_offs = 0;\n    return;\n  }\n  let buf = allocDataView(total);\n  let u8 = buf.u8;\n  let offs = 0;\n  for (let ii = 0; ii < this.bufs.length; ++ii) {\n    let bsize = this.bsizes[ii];\n    let dv = this.bufs[ii];\n    if (offs + dv.u8.length > total) {\n      // unused portion would overrun\n      assert.equal(dv.byteOffset, 0);\n      u8.set(new Uint8Array(dv.buffer, 0, bsize), offs);\n    } else {\n      u8.set(dv.u8, offs);\n    }\n    offs += bsize;\n    poolBuf(dv);\n  }\n  assert.equal(this.buf.byteOffset, 0); // Would handle it, but should never happen here, these are our pooled buffers?\n  u8.set(new Uint8Array(this.buf.buffer, this.buf.byteOffset, this.buf_offs), offs);\n  poolBuf(this.buf);\n  assert.equal(offs + this.buf_offs, total);\n  this.bufs = this.bsizes = null;\n  this.buf = buf;\n  this.buf_offs = 0;\n  this.buf_len = total; // buffer is actually buf.buffer.byteLength, but we can't read past `total`\n};\n\nPacket.prototype.flush = function () {\n  let { buf, buf_offs } = this;\n  if (!this.bufs) {\n    this.bufs = [buf];\n    this.bsizes = [buf_offs];\n  } else {\n    this.bufs.push(buf);\n    this.bsizes.push(buf_offs);\n  }\n  this.buf = null;\n  this.buf_len = 0;\n  this.buf_offs = 0;\n};\nPacket.prototype.fit = function (extra_bytes, no_advance) {\n  let { buf, buf_len, buf_offs } = this;\n  let new_offs = buf_offs + extra_bytes;\n  if (new_offs <= buf_len) {\n    if (!no_advance) {\n      this.buf_offs = new_offs;\n    }\n    return buf_offs;\n  }\n  assert(!this.readable); // Shouldn't happen on concatenated buffers\n  if (buf) {\n    this.flush();\n  }\n  this.buf_len = buf_len = max(PAK_BUF_DEFAULT_SIZE, extra_bytes);\n  this.buf = allocDataView(buf_len);\n  this.buf_offs = no_advance ? 0 : extra_bytes;\n  return 0;\n};\nPacket.prototype.advance = function (bytes) {\n  let offs = this.buf_offs;\n  let new_offs = offs + bytes;\n  this.buf_offs = new_offs;\n  if (new_offs > this.buf_len) {\n    throw new Error(UNDERRUN);\n  }\n  if (new_offs === this.buf_len) {\n    this.pool();\n  }\n  return offs;\n};\nPacket.prototype.ended = function () {\n  return this.buf_offs === this.buf_len;\n};\n\n// low-level write/read functions\nPacket.prototype.writeU8 = function (v) {\n  assert(v >= 0 && v < 256);\n  let offs = this.fit(1);\n  this.buf.u8[offs] = v;\n};\nPacket.prototype.readU8 = function () {\n  return this.buf.u8[this.advance(1)];\n};\n// Packed int, first byte:\n// 0-247 byte\n// 248 positive 16-bit\n// 249 negative 16-bit\n// 250 positive 32-bit\n// 251 negative 32-bit\n// 252 positive 64-bit\n// 253 negative 64-bit\n// 254 unused\n// 255 negative byte\nPacket.prototype.writeInt = function (v) {\n  assert(isInteger(v));\n  let offs = this.fit(9, true); // 9 is max size of a packed int\n  let buf = this.buf;\n  let neg = (v < 0) ? 1 : 0;\n  if (neg) {\n    v = -v;\n  }\n  if (v < 248) { // || neg && v < 256 would also decode right\n    if (neg) {\n      buf.u8[offs++] = 255;\n    }\n    buf.u8[offs++] = v;\n  } else {\n    if (v < 65536) {\n      buf.u8[offs++] = 248 + neg;\n      buf.setUint16(offs, v, true);\n      offs += 2;\n    } else if (v < 4294967296) {\n      buf.u8[offs++] = 250 + neg;\n      buf.setUint32(offs, v, true);\n      offs += 4;\n    } else {\n      buf.u8[offs++] = 252 + neg;\n      let low_bits = v >>> 0;\n      buf.setUint32(offs, low_bits, true);\n      offs += 4;\n      buf.setUint32(offs, (v - low_bits) / 4294967296, true);\n      offs += 4;\n    }\n  }\n  this.buf_offs = offs;\n};\nPacket.prototype.zeroInt = function () {\n  // Overwrite an existing int with a zero, keeping the same packed size\n  let b1 = this.buf.u8[this.buf_offs];\n  if (b1 < 248) {\n    this.buf.u8[this.buf_offs++] = 0;\n    return;\n  }\n  // Otherwise, leave header bit\n  this.buf_offs++;\n  let zeroes;\n  switch (b1) {\n    case 253:\n    case 252:\n      zeroes = 8;\n      break;\n    case 251:\n    case 250:\n      zeroes = 4;\n      break;\n    case 249:\n    case 248:\n      zeroes = 2;\n      break;\n    case 255:\n      zeroes = 1;\n      break;\n    default:\n      throw new Error('PKTERR_PACKED_INT');\n  }\n  while (zeroes) {\n    --zeroes;\n    this.buf.u8[this.buf_offs++] = 0;\n  }\n};\nPacket.prototype.readInt = function () {\n  let b1 = this.buf.u8[this.advance(1)];\n  if (b1 < 248) {\n    return b1;\n  }\n  let sign = 1;\n  switch (b1) {\n    case 249:\n      sign = -1;\n    case 248: // eslint-disable-line no-fallthrough\n      return sign * this.buf.getUint16(this.advance(2), true);\n    case 251:\n      sign = -1;\n    case 250: // eslint-disable-line no-fallthrough\n      return sign * this.buf.getUint32(this.advance(4), true);\n    case 253:\n      sign = -1;\n    case 252: { // eslint-disable-line no-fallthrough\n      let low_bits = this.buf.getUint32(this.advance(4), true);\n      let high_bits = this.buf.getUint32(this.advance(4), true);\n      return sign * (high_bits * 4294967296 + low_bits);\n    }\n    case 255:\n      return -this.buf.u8[this.advance(1)];\n    default:\n      throw new Error('PKTERR_PACKED_INT');\n  }\n};\nPacket.prototype.writeFloat = function (v) {\n  assert.equal(typeof v, 'number');\n  if (!v) {\n    this.buf.u8[this.fit(1)] = 0;\n    return;\n  }\n  let offs = this.fit(5, true);\n  this.buf.setFloat32(offs, v, true);\n  if (this.buf.u8[offs] <= 1) { // escape a 0 or 1 in the first byte\n    this.buf.u8[offs++] = 1;\n    this.buf.setFloat32(offs, v, true);\n  }\n  this.buf_offs = offs + 4;\n};\nPacket.prototype.readFloat = function () {\n  let offs = this.advance(1);\n  let b1 = this.buf.u8[offs];\n  if (!b1) {\n    return 0;\n  }\n  if (b1 === 1) {\n    return this.buf.getFloat32(this.advance(4), true);\n  }\n  this.advance(3);\n  return this.buf.getFloat32(offs, true);\n};\nPacket.prototype.writeU32 = function (v) {\n  assert.equal(typeof v, 'number');\n  this.buf.setUint32(this.fit(4), v, true);\n};\nPacket.prototype.readU32 = function () {\n  return this.buf.getUint32(this.advance(4), true);\n};\n// Note this is not quite serializing the same as UTF-8 when dealing with surrogate\n//   pairs, such as code point U+1F303 which is represented by character codes\n//   0xD83C, 0xDF03, and would technically be <f0 9f 8c 83> in UTF-8, but we\n//   serialize as two separate characters.  When deserialized in the same way,\n//   this reconstructs the same original string, without losing the ability to\n//   serialize some otherwise valid JavaScript strings (e.g. just one char\n//   code 0xD83C) like with Node.js's Buffer's utf8 implementation.\nPacket.prototype.writeString = function (v) {\n  assert.equal(typeof v, 'string'); // Could maybe do a toString() here if not\n  let byte_length = utf8ByteLength(v);\n  this.writeInt(byte_length); // Just 1 byte for small strings\n  if (!byte_length) {\n    return;\n  }\n  let offs = this.fit(byte_length);\n  let buf = this.buf;\n  for (let ii = 0; ii < v.length; ++ii) {\n    let c = v.charCodeAt(ii);\n    if (c <= 0x7F) {\n      buf.u8[offs++] = c;\n    } else {\n      offs = utf8WriteChar(buf, offs, c);\n    }\n  }\n};\n// Only called on multi-byte characters; Supplied the first byte for efficiency\nPacket.prototype.utf8ReadChar = function (c) {\n  let buf = this.buf;\n  if (c >= 0xC0 && c < 0xE0) {\n    return ((c & 0x1F) << 6) |\n      (buf.u8[this.buf_offs++] & 0x3F);\n  } else if (c >= 0xE0 && c < 0xF0) {\n    return ((c & 0x0F) << 12) |\n      ((buf.u8[this.buf_offs++] & 0x3F) << 6) |\n      (buf.u8[this.buf_offs++] & 0x3F);\n  } else if (c >= 0xF0 && c < 0xF8) {\n    return ((c & 0x0F) << 18) |\n      ((buf.u8[this.buf_offs++] & 0x3F) << 12) |\n      ((buf.u8[this.buf_offs++] & 0x3F) << 6) |\n      (buf.u8[this.buf_offs++] & 0x3F);\n  } else { // c >= 0x80 & c < 0xC0 or c >= 0xF8\n    // Illegal continuation character, or old-spec 5-byte/6-byte UTF-8 encoding\n    //   Regardless, was not generated by our utf8WriteChar().\n    return 0xFFFD;\n  }\n};\n\nlet string_assembly = [];\nPacket.prototype.readString = function () {\n  let byte_length = this.readInt();\n  if (!byte_length) {\n    return '';\n  }\n  if (this.buf_offs + byte_length > this.buf_len) {\n    throw new Error(UNDERRUN);\n  }\n\n  let { buf } = this;\n  let end_offset = this.buf_offs + byte_length;\n  let ret;\n  if (byte_length > 8192) {\n    ret = '';\n    while (this.buf_offs < end_offset) {\n      let c = buf.u8[this.buf_offs++];\n      if (c > 0x7F) {\n        c = this.utf8ReadChar(c);\n      }\n      ret += String.fromCharCode(c);\n    }\n  } else {\n    string_assembly.length = byte_length;\n    let ii = 0;\n    while (this.buf_offs < end_offset) {\n      let c = buf.u8[this.buf_offs++];\n      if (c > 0x7F) {\n        c = this.utf8ReadChar(c);\n      }\n      string_assembly[ii++] = c;\n    }\n    if (string_assembly.length !== ii) {\n      // truncate if multi-byte UTF8 produced single characters\n      string_assembly.length = ii;\n    }\n    ret = String.fromCharCode.apply(undefined, string_assembly);\n  }\n  if (this.buf_offs === this.buf_len) {\n    this.pool();\n  }\n  return ret;\n};\n// Much more efficient than writeString if the input is known to be ANSI-ish (all characters <= 255)\nPacket.prototype.writeAnsiString = function (v) {\n  assert.equal(typeof v, 'string'); // Could maybe do a toString() here if not\n  let byte_length = v.length;\n  this.writeInt(byte_length);\n  let offs = this.fit(byte_length);\n  let { buf } = this;\n  for (let ii = 0; ii < byte_length; ++ii) {\n    buf.u8[offs++] = v.charCodeAt(ii);\n  }\n};\nPacket.prototype.readAnsiString = function () {\n  let len = this.readInt();\n  if (!len) {\n    return '';\n  }\n  let offs = this.advance(len);\n  let { buf } = this;\n  string_assembly.length = len;\n  for (let ii = 0; ii < len; ++ii) {\n    string_assembly[ii] = buf.u8[offs++];\n  }\n  return String.fromCharCode.apply(undefined, string_assembly);\n};\n\n// high-level write/read functions\nPacket.prototype.writeJSON = function (v) {\n  if (!v) {\n    let idx = FALSYS.indexOf(v);\n    assert(idx !== -1);\n    this.writeU8(idx + 1);\n    return;\n  }\n  this.writeU8(0);\n  this.writeString(JSON.stringify(v));\n};\nPacket.prototype.readJSON = function () {\n  let byte = this.readU8();\n  if (byte) {\n    if (byte - 1 >= FALSYS.length) {\n      throw new Error('PKTERR_JSON_HEADER');\n    }\n    return FALSYS[byte - 1];\n  }\n  let str = this.readString();\n  return JSON.parse(str);\n};\n// Uint8Array or Buffer object?\nPacket.prototype.writeBuffer = function (v) {\n  this.writeInt(v.length);\n  if (v.length) {\n    let offs = this.fit(v.length);\n    this.buf.u8.set(v, offs);\n  }\n};\nconst null_buf = new Uint8Array(0);\nPacket.prototype.readBuffer = function (do_copy) {\n  let len = this.readInt();\n  if (!len) {\n    return null_buf;\n  }\n  let offs = this.advance(len);\n  if (do_copy) {\n    return this.buf.u8.slice(offs, offs + len);\n  } else {\n    let { buf } = this;\n    return new Uint8Array(buf.buffer, buf.byteOffset + offs, len);\n  }\n};\nPacket.prototype.writeBool = function (v) {\n  this.writeU8(v?1:0);\n};\nPacket.prototype.readBool = function () {\n  return Boolean(this.readU8());\n};\n\nPacket.prototype.append = function (pak) {\n  assert.equal(this.flags & FLAG_PACKET_INTERNAL, pak.flags & FLAG_PACKET_INTERNAL);\n  if (pak.bufs) {\n    for (let ii = 0; ii < pak.bufs.length; ++ii) {\n      let buf = pak.bufs[ii];\n      let bsize = pak.bsizes[ii];\n      let offs = this.fit(bsize);\n      if (bsize !== buf.byteLength) {\n        this.buf.u8.set(new Uint8Array(buf.buffer, buf.byteOffset, bsize), offs);\n      } else {\n        this.buf.u8.set(buf.u8, offs);\n      }\n    }\n  }\n  if (pak.buf) {\n    let buf = pak.buf;\n    let bsize = pak.readable ? pak.buf_len : pak.buf_offs;\n    let offs = this.fit(bsize);\n    if (bsize !== buf.byteLength) {\n      this.buf.u8.set(new Uint8Array(buf.buffer, buf.byteOffset, bsize), offs);\n    } else {\n      this.buf.u8.set(buf.u8, offs);\n    }\n  }\n};\n\nPacket.prototype.appendRemaining = function (pak) {\n  assert.equal(this.flags & FLAG_PACKET_INTERNAL, pak.flags & FLAG_PACKET_INTERNAL);\n  assert(pak.readable);\n  assert(!pak.bufs);\n  assert(pak.buf);\n  assert(pak.buf_offs <= pak.buf_len);\n  let bsize = pak.buf_len - pak.buf_offs;\n  if (bsize) {\n    let offs = this.fit(bsize);\n    this.buf.u8.set(new Uint8Array(pak.buf.buffer, pak.buf.byteOffset + pak.buf_offs, bsize), offs);\n  }\n  // everything consumed, pool it\n  pak.pool();\n};\n\nPacket.prototype.toJSON = function () {\n  let ret = {\n    f: this.flags,\n  };\n\n  if (this.bufs) {\n    ret.b = [];\n    for (let ii = 0; ii < this.bufs.length; ++ii) {\n      ret.b.push(base64Encode(this.bufs[ii], 0, this.bsizes[ii]));\n    }\n  }\n  if (this.buf) {\n    if (this.readable) {\n      ret.d = base64Encode(this.buf, 0, this.buf_len);\n    } else {\n      ret.d = base64Encode(this.buf, 0, this.buf_offs);\n    }\n  }\n  return ret;\n};\n\nPacket.prototype.setBuffer = function (buf, buf_len) {\n  assert(!this.buf);\n  assert(!this.bufs);\n  assert(this.flags & PACKET_UNOWNED_BUFFER); // Probably okay if not?\n  assert(buf instanceof Uint8Array);\n  this.buf = wrapU8AsDataView(buf);\n  this.buf_len = buf_len;\n  this.readable = true;\n};\n\nPacket.prototype.getBuffer = function () {\n  assert(this.buf);\n  assert(!this.bufs);\n  return this.buf.u8;\n};\n\nPacket.prototype.getBufferLen = function () {\n  assert(this.buf);\n  assert(!this.bufs);\n  return this.readable ? this.buf_len : this.buf_offs;\n};\n\nPacket.prototype.getOffset = function () {\n  if (this.readable) {\n    return this.buf_offs;\n  }\n  return this.totalSize();\n};\n\nPacket.prototype.seek = function (pos) {\n  assert(this.readable); // .makeReadable should be called so that it is a single buffer\n  assert(pos >= 0 && pos <= this.buf_len);\n  this.buf_offs = pos;\n};\n\nPacket.prototype.writeFlags = function () {\n  assert(!this.has_flags);\n  assert.equal(this.buf_offs, 0);\n  this.writeU8(this.flags);\n  this.has_flags = true;\n};\n\nPacket.prototype.updateFlags = function (flags) {\n  assert(this.has_flags);\n  assert(!(flags & FLAG_PACKET_INTERNAL));\n  this.flags = this.flags & FLAG_PACKET_INTERNAL | flags;\n  let buf = this.bufs ? this.bufs[0] : this.buf;\n  buf.u8[0] = this.flags;\n};\n\nPacket.prototype.readFlags = function () {\n  let read = this.readU8();\n  assert.equal(read, this.flags & 0xFF);\n  this.has_flags = true;\n  return this.flags;\n};\n\nPacket.prototype.getFlags = function () {\n  return this.flags;\n};\n\nPacket.prototype.getInternalFlags = function () {\n  return this.flags & FLAG_PACKET_INTERNAL;\n};\n\nPacket.prototype.contents = function () {\n  return `pak(${this.totalSize()}b)`;\n};\n\nfunction PacketDebug(flags, init_size) {\n  this.reinit(flags, init_size);\n}\nPacketDebug.prototype.reinit = function (flags, init_size) {\n  this.in_pool = false;\n  if (pak_pool.length) {\n    this.pak = pak_pool.pop();\n    this.pak.reinit(flags, init_size, this);\n  } else {\n    this.pak = new Packet(flags, init_size, this);\n  }\n  this.warned = false;\n  this.pool_timer = setTimeout(() => {\n    console.warn(`Packet not pooled after 5s: ${this.contents()}`);\n    this.warned = true;\n  }, POOL_TIMEOUT);\n};\nPacketDebug.prototype.poolDebug = function () {\n  if (this.warned) {\n    console.warn('Packet pooled after timeout');\n  } else {\n    clearTimeout(this.pool_timer);\n  }\n  assert(!this.in_pool);\n  this.in_pool = true; // Set this, as if pooled, even if discarded\n  if (pak_debug_pool.length < POOL_PACKETS) {\n    pak_debug_pool.push(this);\n  }\n};\nconst types = [null, 'U8', 'U32', 'Int', 'Float', 'String', 'AnsiString', 'JSON', 'Bool', 'Buffer'];\n// Functions (types) that read and write a debug byte\ntypes.forEach((type, idx) => {\n  if (!type) { // don't use debug ID 0\n    return;\n  }\n  let write = `write${type}`;\n  let read = `read${type}`;\n  let write_fn = Packet.prototype[write];\n  let read_fn = Packet.prototype[read];\n  PacketDebug.prototype[write] = function (v) {\n    this.pak.writeU8(idx);\n    write_fn.call(this.pak, v);\n  };\n  PacketDebug.prototype[read] = function (param) {\n    let found_idx = this.pak.readU8();\n    if (found_idx !== idx) {\n      assert(false, `PacketDebug error: Expected ${type}(${idx}), found ${types[found_idx]}(${found_idx})`);\n    }\n    return read_fn.call(this.pak, param);\n  };\n});\nPacketDebug.prototype.zeroInt = function () {\n  this.pak.writeU8(3); // types.indexof('Int')\n  this.pak.zeroInt();\n};\n// Functions that simply fall through\n[\n  'ended',\n  'getBuffer',\n  'getBufferLen',\n  'getFlags',\n  'getInternalFlags',\n  'getOffset',\n  'getRefCount',\n  'makeReadable',\n  'pool',\n  'readFlags', // *not* wrapped in debug headers\n  'ref',\n  'seek',\n  'setBuffer',\n  'setReadable',\n  'toJSON',\n  'totalSize',\n  'updateFlags',\n  'writeFlags', // *not* wrapped in debug headers\n].forEach((fname) => {\n  let fn = Packet.prototype[fname];\n  PacketDebug.prototype[fname] = function () {\n    return fn.apply(this.pak, arguments); // eslint-disable-line prefer-rest-params\n  };\n});\nPacketDebug.prototype.append = function (pak) {\n  assert(pak instanceof PacketDebug);\n  this.pak.append(pak.pak);\n};\nPacketDebug.prototype.appendRemaining = function (pak) {\n  assert(pak instanceof PacketDebug);\n  this.pak.appendRemaining(pak.pak);\n};\nfunction format(v) {\n  switch (typeof v) {\n    case 'object':\n      if (v instanceof Uint8Array) {\n        return `u8<${v.length}>`;\n      }\n      return JSON.stringify(v);\n    default:\n      return v;\n  }\n}\nPacketDebug.prototype.contents = function () {\n  let { pak } = this;\n  let cur_offs = pak.getOffset();\n  let read_len = cur_offs;\n  let ret = [`buf:${pak.buf_offs}/${pak.buf_len}`];\n  if (pak.bufs) {\n    // write packet, just combine and reset location when done\n    pak.makeReadable();\n    ret.push('bufs');\n  } else if (pak.buf) {\n    // read packet, or write packet that is a single buf\n    if (pak.readable) {\n      read_len = pak.buf_len;\n    }\n    pak.buf_offs = 0;\n  } else {\n    ret.push('empty');\n    read_len = -1;\n  }\n  let saved_ref_count = pak.ref_count;\n  pak.ref_count = 2; // prevent auto pooling, don't assert on ref() if unref'd.\n  try {\n    if (!saved_ref_count) {\n      ret.push('!ref_count=0!');\n    }\n    if (pak.has_flags) {\n      ret.push(`flags:${pak.readU8()}`);\n    }\n    while (pak.buf_offs < read_len) {\n      let type_idx = pak.readU8();\n      let type = types[type_idx];\n      if (!type) {\n        ret.push(`UnknownType:${type_idx}`);\n        break;\n      }\n      let val = pak[`read${type}`]();\n      ret.push(`${type}:${format(val)}`);\n    }\n  } catch (e) {\n    ret.push(`Error dumping packet contents: ${e}`);\n  }\n  pak.ref_count = saved_ref_count;\n  pak.buf_offs = cur_offs;\n  return ret.join(',');\n};\n\nfunction packetCreate(flags, init_size) {\n  if (flags === undefined) {\n    flags = exports.default_flags;\n  }\n  let pool = (flags & PACKET_DEBUG) ? pak_debug_pool : pak_pool;\n  if (pool.length) {\n    let pak = pool.pop();\n    pak.reinit(flags, init_size);\n    return pak;\n  }\n  if (flags & PACKET_DEBUG) {\n    return new PacketDebug(flags, init_size);\n  }\n  return new Packet(flags, init_size);\n}\nexports.packetCreate = packetCreate;\n\nfunction packetFromBuffer(buf, buf_len, need_copy) {\n  let flags = buf[0];\n  assert.equal(typeof flags, 'number'); // `buf` should be a Buffer or Uint8Array, not a DataView like other funcs here\n  if (need_copy) {\n    assert(buf_len);\n    assert(buf.buffer instanceof ArrayBuffer);\n    let pak = packetCreate(flags, buf_len);\n    if (buf.byteLength !== buf_len) {\n      buf = Buffer.from(buf.buffer, 0, buf_len);\n    }\n    pak.getBuffer().set(buf);\n    pak.setReadable();\n    return pak;\n  } else {\n    // reference unowned/unpoolable buffer\n    assert(buf instanceof Uint8Array);\n    let pak = packetCreate(flags | PACKET_UNOWNED_BUFFER);\n    pak.setBuffer(buf, buf_len || buf.byteLength);\n    return pak;\n  }\n}\nexports.packetFromBuffer = packetFromBuffer;\n\nfunction packetFromJSON(js_obj) {\n  let pak = packetCreate(js_obj.f);\n\n  let payload = pak.pak || pak;\n\n  function decode(str) {\n    return base64Decode(str, allocDataView);\n  }\n  if (js_obj.b) {\n    payload.bsizes = [];\n    payload.bufs = [];\n    for (let ii = 0; ii < js_obj.b.length; ++ii) {\n      let buf = decode(js_obj.b[ii]);\n      payload.bufs.push(buf);\n      payload.bsizes.push(buf.decode_size);\n      delete buf.decode_size;\n    }\n  }\n  if (js_obj.d) {\n    payload.buf = decode(js_obj.d);\n    payload.buf_len = payload.buf.decode_size;\n    delete payload.buf.decode_size;\n    payload.buf_offs = 0;\n  }\n\n  return pak;\n}\nexports.packetFromJSON = packetFromJSON;\n\nfunction isPacket(thing) {\n  return thing instanceof Packet || thing instanceof PacketDebug;\n}\nexports.isPacket = isPacket;\n","const BUCKET_TIME = 10000;\nconst NUM_BUCKETS = 5;\n\nlet counters = { time_start: Date.now() };\nlet hist = [counters];\nlet countdown = BUCKET_TIME;\n\nexport function perfCounterAdd(key) {\n  counters[key] = (counters[key] || 0) + 1;\n}\n\nexport function perfCounterTick(dt, log) {\n  countdown -= dt;\n  if (countdown <= 0) {\n    countdown = BUCKET_TIME;\n    if (hist.length === NUM_BUCKETS) {\n      hist.splice(0, 1);\n    }\n    let now = Date.now();\n    counters.time_end = now;\n    if (log) {\n      log(counters);\n    }\n    counters = {};\n    counters.time_start = now;\n    hist.push(counters);\n  }\n}\n\nexport function perfCounterHistory() {\n  return hist;\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// Alea PRNG\n// Based on code from Johannes Baagøe <baagoe@baagoe.com>, 2010\n// From https://github.com/coverslide/node-alea/blob/master/alea.js, MIT Licensed\n// From http://baagoe.com/en/RandomMusings/javascript/\n\nexport function mashString(data) {\n  let n = 0xefc8249d;\n  for (let i = 0; i < data.length; i++) {\n    n += data.charCodeAt(i);\n    let h = 0.02519603282416938 * n;\n    n = h >>> 0;\n    h -= n;\n    h *= n;\n    n = h >>> 0;\n    h -= n;\n    n += h * 0x100000000; // 2^32\n  }\n  return n >>> 0;\n  // return (n >>> 0) * 2.3283064365386963e-10; // 2^-32\n}\n\n// Takes an integer (up to 53bits) and returns a 0-1 float\nexport function mashI53(data) {\n  let n = 0xefc8249d;\n  while (data) {\n    let byte = data % 256;\n    data = (data - byte) / 256;\n    n += byte;\n    let h = 0.02519603282416938 * n;\n    n = h >>> 0;\n    h -= n;\n    h *= n;\n    n = h >>> 0;\n    h -= n;\n    n += h * 0x100000000; // 2^32\n  }\n  return (n >>> 0) * 2.3283064365386963e-10; // 2^-32\n}\n\nfunction Mash() {\n  this.n = 0xc06c5fc8; // 0xefc8249d;\n}\nMash.prototype.mash = function (data) {\n  let n = this.n + data;\n  let h = 0.02519603282416938 * n;\n  n = h >>> 0;\n  h -= n;\n  h *= n;\n  n = h >>> 0;\n  h -= n;\n  n += h * 0x100000000; // 2^32\n  this.n = n;\n  return (n >>> 0) * 2.3283064365386963e-10; // 2^-32\n};\n\nfunction Alea(seed) {\n  this.reseed(seed);\n}\nAlea.prototype.reseed = function (seed) {\n  // this.s0/s1/s2 are floating point between 0 and 1\n  // this.c is a 32-bit int\n  this.c = 1;\n  let mash = new Mash();\n  // Hard-coded results of initial mash(' ') found in original implementation\n  this.s0 = 0.3014581324532628;\n  this.s1 = 0.2643220406025648;\n  this.s2 = 0.7516536582261324;\n\n  this.s0 -= mash.mash(seed);\n  if (this.s0 < 0) {\n    this.s0 += 1;\n  }\n  this.s1 -= mash.mash(seed);\n  if (this.s1 < 0) {\n    this.s1 += 1;\n  }\n  this.s2 -= mash.mash(seed);\n  if (this.s2 < 0) {\n    this.s2 += 1;\n  }\n};\nAlea.prototype.step = function () {\n  let t = 2091639 * this.s0 + this.c * 2.3283064365386963e-10; // 2^-32\n  this.s0 = this.s1;\n  this.s1 = this.s2;\n  return (this.s2 = t - (this.c = t | 0));\n};\nAlea.prototype.uint32 = function () {\n  return this.step() * 0x100000000; // 2^32\n};\nAlea.prototype.fract53 = function () {\n  return this.step() +\n    (this.step() * 0x200000 | 0) * 1.1102230246251565e-16; // 2^-53\n};\nAlea.prototype.random = Alea.prototype.step;\nAlea.prototype.range = function (range) {\n  return (this.step() * range) | 0;\n};\nAlea.prototype.floatBetween = function (a, b) {\n  return a + (b - a) * this.random();\n};\n\n// Note: import/export probably needs more precision than F32 or JSON provide\nAlea.prototype.exportState = function () {\n  return [this.s0, this.s1, this.s2, this.c];\n};\nAlea.prototype.importState = function (i) {\n  this.s0 = i[0];\n  this.s1 = i[1];\n  this.s2 = i[2];\n  this.c = i[3];\n};\n\nexport function randCreate(seed) {\n  return new Alea(seed);\n}\n\nexport function shuffleArray(rand, arr) {\n  for (let ii = arr.length - 1; ii >= 1; --ii) {\n    let swap = rand.range(ii + 1);\n    let t = arr[ii];\n    arr[ii] = arr[swap];\n    arr[swap] = t;\n  }\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint prefer-rest-params:off, no-underscore-dangle:off */\n\nconst assert = require('assert');\n\nfunction EventEmitter() {\n  this._listeners = {};\n}\n\nmodule.exports = EventEmitter;\nmodule.exports.EventEmitter = EventEmitter;\n\nfunction addListener(ee, type, fn, once) {\n  assert(typeof fn === 'function');\n  let arr = ee._listeners[type];\n  if (!arr) {\n    arr = ee._listeners[type] = [];\n  }\n  arr.push({\n    once,\n    fn,\n  });\n}\n\nEventEmitter.prototype.hasListener = function (type, fn) {\n  let arr = this._listeners[type];\n  if (!arr) {\n    return false;\n  }\n  for (let ii = 0; ii < arr.length; ++ii) {\n    if (arr[ii].fn === fn) {\n      return true;\n    }\n  }\n  return false;\n};\n\nEventEmitter.prototype.on = function (type, fn) {\n  addListener(this, type, fn, 0);\n  return this;\n};\n\nEventEmitter.prototype.once = function (type, fn) {\n  addListener(this, type, fn, 1);\n  return this;\n};\n\nEventEmitter.prototype.removeListener = function (type, fn) {\n  let arr = this._listeners[type];\n  assert(arr);\n  for (let ii = 0; ii < arr.length; ++ii) {\n    if (arr[ii].fn === fn) {\n      arr.splice(ii, 1);\n      return this;\n    }\n  }\n  assert(false); // expected to find the listener!\n  return this;\n};\n\nfunction filterNotOnce(elem) {\n  return !elem.once;\n}\n\nEventEmitter.prototype.emit = function (type, ...args) {\n  let arr = this._listeners[type];\n  if (!arr) {\n    return false;\n  }\n\n  let any = false;\n  let any_once = false;\n  for (let ii = 0; ii < arr.length; ++ii) {\n    let elem = arr[ii];\n    any = true;\n    elem.fn(...args);\n    if (elem.once) {\n      any_once = true;\n    }\n  }\n  if (any_once) {\n    this._listeners[type] = arr.filter(filterNotOnce);\n  }\n\n  return any;\n};\n\n// Aliases\n// EventEmitter.prototype.addListener = EventEmitter.prototype.on;\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nconst assert = require('assert');\nconst { abs, floor, min, max, random, round, pow, sqrt } = Math;\n\nexport function nop() {\n  // empty\n}\n\nexport function identity(a) {\n  return a;\n}\n\nexport function once(fn) {\n  let called = false;\n  return function (...args) {\n    if (called) {\n      return;\n    }\n    called = true;\n    fn(...args);\n  };\n}\n\nexport function empty(obj) {\n  for (let key in obj) {\n    return false;\n  }\n  return true;\n}\n\nexport function easeInOut(v, a) {\n  let va = pow(v, a);\n  return va / (va + pow(1 - v, a));\n}\n\nexport function easeIn(v, a) {\n  return 2 * easeInOut(0.5 * v, a);\n}\n\nexport function easeOut(v, a) {\n  return 2 * easeInOut(0.5 + 0.5 * v, a) - 1;\n}\n\nexport function clone(obj) {\n  if (!obj) { // handle undefined\n    return obj;\n  }\n  return JSON.parse(JSON.stringify(obj));\n}\n\nexport function merge(dest, src) {\n  for (let f in src) {\n    dest[f] = src[f];\n  }\n  return dest;\n}\n\nexport function has(obj, field) {\n  return Object.prototype.hasOwnProperty.call(obj, field);\n}\n\nexport function defaults(dest, src) {\n  for (let f in src) {\n    if (!has(dest, f)) {\n      dest[f] = src[f];\n    }\n  }\n  return dest;\n}\n\nexport function defaultsDeep(dest, src) {\n  for (let f in src) {\n    if (!has(dest, f)) {\n      dest[f] = src[f];\n    } else if (typeof dest[f] === 'object') {\n      defaultsDeep(dest[f], src[f]);\n    }\n  }\n  return dest;\n}\n\nexport function cloneShallow(src) {\n  return merge({}, src);\n}\n\nexport function deepEqual(a, b) {\n  if (Array.isArray(a)) {\n    if (!Array.isArray(b)) {\n      return false;\n    }\n    if (a.length !== b.length) {\n      return false;\n    }\n    for (let ii = 0; ii < a.length; ++ii) {\n      if (!deepEqual(a[ii], b[ii])) {\n        return false;\n      }\n    }\n    return true;\n  } else if (typeof a === 'object') {\n    if (typeof b !== 'object') {\n      return false;\n    }\n    if (!a || !b) { // at least one is null\n      return !a && !b; // equal if both are null\n    }\n    for (let key in a) {\n      // b must have key, or both a[key] and b[key] are undefined\n      if (!deepEqual(a[key], b[key])) {\n        return false;\n      }\n    }\n    for (let key in b) {\n      // if b has key and it's defined, a must also be defined (and would have checked equality above)\n      if (b[key] !== undefined && a[key] === undefined) {\n        return false;\n      }\n    }\n    return true;\n  }\n  return a === b;\n}\n\nexport function deepAdd(dest, src) {\n  assert(dest && src);\n  for (let key in src) {\n    let value = src[key];\n    if (typeof value === 'object') {\n      let dest_sub = dest[key] = dest[key] || {};\n      assert.equal(typeof dest_sub, 'object');\n      deepAdd(dest_sub, value);\n    } else {\n      dest[key] = (dest[key] || 0) + value;\n    }\n  }\n}\n\nexport function clamp(v, mn, mx) {\n  return min(max(mn, v), mx);\n}\n\nexport function lerp(a, v0, v1) {\n  return (1 - a) * v0 + a * v1;\n}\n\nexport function mix(v0, v1, a) { // GLSL semantics\n  return (1 - a) * v0 + a * v1;\n}\n\nexport function map01(number,in_min, in_max) {\n  return (number - in_min) / (in_max - in_min);\n}\n\nexport function sign(a) {\n  return a < 0 ? -1 : a > 0 ? 1 : 0;\n}\n\nexport function mod(a, n) {\n  return ((a % n) + n) % n;\n}\n\n// log2 rounded up to nearest integer\nexport function log2(val) {\n  for (let ii=1, jj=0; ; ii <<= 1, ++jj) {\n    if (ii >= val) {\n      return jj;\n    }\n  }\n}\n\nexport function ridx(arr, idx) {\n  arr[idx] = arr[arr.length - 1];\n  arr.pop();\n}\n\nexport function round100(a) {\n  return round(a * 100) / 100;\n}\n\nexport function round1000(a) {\n  return round(a * 1000) / 1000;\n}\n\nexport function fract(a) {\n  return a - floor(a);\n}\n\nexport function nearSame(a, b, tol) {\n  return abs(b - a) <= tol;\n}\n\nexport function titleCase(str) {\n  return str.split(' ').map((word) => `${word[0].toUpperCase()}${word.slice(1)}`)\n    .join(' ');\n}\n\nconst EPSILON = 0.00001;\n\n// http://local.wasp.uwa.edu.au/~pbourke/geometry/sphereline/\nexport function lineCircleIntersect(p1, p2, pCircle, radius) {\n  let dp = [\n    p2[0] - p1[0],\n    p2[1] - p1[1]\n  ];\n  let a = dp[0] * dp[0] + dp[1] * dp[1];\n  let b = 2 * (dp[0] * (p1[0] - pCircle[0]) + dp[1] * (p1[1] - pCircle[1]));\n  let c = pCircle[0] * pCircle[0] + pCircle[1] * pCircle[1];\n  c += p1[0] * p1[0] + p1[1] * p1[1];\n  c -= 2 * (pCircle[0] * p1[0] + pCircle[1] * p1[1]);\n  c -= radius * radius;\n  let bb4ac = b * b - 4 * a * c;\n  if (abs(a) < EPSILON || bb4ac < 0) {\n    return false;\n  }\n\n  let mu1 = (-b + sqrt(bb4ac)) / (2 * a);\n  let mu2 = (-b - sqrt(bb4ac)) / (2 * a);\n  if (mu1 >= 0 && mu1 <= 1 || mu2 >= 0 && mu2 <= 1) {\n    return true;\n  }\n\n  return false;\n}\n\nexport function inherits(ctor, superCtor) {\n  // From Node.js\n  assert(typeof superCtor === 'function');\n  let ctor_proto_orig = ctor.prototype;\n  // not needed? ctor.super_ = superCtor; // eslint-disable-line no-underscore-dangle\n  // second parameter also not actually needed, just defines new Foo().constructor === Foo?\n  ctor.prototype = Object.create(superCtor.prototype, {\n    constructor: {\n      value: ctor,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  // If anything had been added to the prototype (only in the case of late/double\n  //   inheritance), add it\n  for (let key in ctor_proto_orig) {\n    ctor.prototype[key] = ctor_proto_orig[key];\n  }\n}\n\nexport function isPowerOfTwo(n) {\n  return ((n & (n - 1)) === 0);\n}\n\nexport function nextHighestPowerOfTwo(x) {\n  --x;\n  for (let i = 1; i < 32; i <<= 1) {\n    x |= x >> i;\n  }\n  return x + 1;\n}\n\nexport function logdata(data) {\n  if (data === undefined) {\n    return '';\n  }\n  let r = JSON.stringify(data);\n  if (r.length < 120) {\n    return r;\n  }\n  return `${r.slice(0, 120-3)}...(${r.length})`;\n}\n\nexport function isInteger(v) {\n  return typeof v === 'number' && isFinite(v) && floor(v) === v;\n}\n\nexport function toNumber(v) {\n  return Number(v);\n}\n\nexport function randomNot(not_value, max_value) {\n  let new_value;\n  do {\n    new_value = floor(random() * max_value);\n  } while (new_value === not_value);\n  return new_value;\n}\n\nexport function toArray(array_like) {\n  return Array.prototype.slice.call(array_like);\n}\n\nexport function arrayToSet(array) {\n  let ret = Object.create(null);\n  for (let ii = 0; ii < array.length; ++ii) {\n    ret[array[ii]] = true;\n  }\n  return ret;\n}\n\nexport function matchAll(str, re) {\n  let ret = [];\n  let m;\n  do {\n    m = re.exec(str);\n    if (m) {\n      ret.push(m[1]);\n    }\n  } while (m);\n  return ret;\n}\n\nexport function callEach(arr, pre_clear, ...args) {\n  if (arr && arr.length) {\n    for (let ii = 0; ii < arr.length; ++ii) {\n      arr[ii](...args);\n    }\n  }\n}\n\n// The characters cause problems with lower level systems (Google Firestore)\n// that presumably try to convert to UTF-16.\n// const utf16_surrogates = /[\\uD800-\\uDFFF]/g;\n\n// \"Bad\" whitespace characters not caught by .trim()\n// Found by running:\n//   require('somefont.json').char_infos.filter(a=>String.fromCharCode(a.c).trim()).filter(a=>!a.w).map(a=a.c)\n// const bad_whitespace = /[\\x00-\\x1F\\x7F\\u1D54\\u1D55\\u2000-\\u200F\\u205F-\\u206F\\uFE00]/g;\n\n// eslint-disable-next-line no-control-regex, no-misleading-character-class\nconst sanitize_regex = /[\\uD800-\\uDFFF\\x00-\\x1F\\x7F\\u1D54\\u1D55\\u2000-\\u200F\\u205F-\\u206F\\uFE00]/g;\nexport function sanitize(str) {\n  return (str || '').replace(sanitize_regex, '');\n}\n\nexport function plural(number, label) {\n  return `${label}${number === 1 ? '' : 's'}`;\n}\n\nexport function secondsToFriendlyString(seconds, force_include_seconds) {\n  let days = floor(seconds / (60*60*24));\n  seconds -= days * 60*60*24;\n  let hours = floor(seconds / (60*60));\n  seconds -= hours * 60*60;\n  let minutes = floor(seconds / 60);\n  seconds -= minutes * 60;\n  let resp = [];\n  if (days) {\n    let years = floor(days / 365.25);\n    if (years) {\n      days -= floor(years * 365.25);\n      resp.push(`${years} ${plural(years, 'year')}`);\n    }\n    resp.push(`${days} ${plural(days, 'day')}`);\n  }\n  if (hours) {\n    resp.push(`${hours} ${plural(hours, 'hour')}`);\n  }\n  if (minutes || !resp.length) {\n    resp.push(`${minutes} ${plural(minutes, 'minute')}`);\n  }\n  if (force_include_seconds) {\n    resp.push(`${seconds} ${plural(seconds, 'second')}`);\n  }\n  return resp.join(', ');\n}\n\nexport function secondsSince2020() {\n  // Seconds since Jan 1st, 2020\n  return floor(Date.now() / 1000) - 1577836800;\n}\n\nexport function dateToSafeLocaleString(date) {\n  // Uses toString as a fallback since some browsers do not properly detect default locale.\n  let date_text;\n  try {\n    date_text = date.toLocaleString();\n  } catch (e) {\n    console.error(e, '(Using toString as fallback)');\n    date_text = date.toString();\n  }\n  return date_text;\n}\n\nlet sw = {}; // Stop words map\nsw.am = sw.an = sw.and = sw.as = sw.at = sw.be = sw.by = sw.el =\n  sw.for = sw.in = sw.is = sw.la = sw.las = sw.los = sw.of = sw.on =\n  sw.or = sw.the = sw.that = sw.this = sw.to = sw.with = true;\n/**\n * Removes single char and stop words from the string array.\n * @param {string[]} string_array Array of strings to filter out single char\n * @returns {string[]} Filter string array with single char and stop words removed\n */\nexport function cleanupStringArray(string_array) {\n  return string_array.filter((s) => (s.length > 1) && (s.length <= 32) && !sw[s]);\n}\n\n/**\n * Return an array of the string splits after transforming to lowercase and trimming whitespaces on each of the split.\n * Punctuations and symbols are also filtered.\n * Also removes single char and stopwords via cleanupStringArray.\n * @param {string[]} string String to use to form the string split result\n * @param {string} pattern String pattern to divide the string on\n * @returns {string[]} String split result\n */\nexport function cleanStringSplit(string, pattern) {\n  // remove punctuations and symbols; e.g., 'In!@£$%^&*()_+sane Wo`{}[]|/?\\'\"rld;:<>s,.' = 'Insane Worlds'\n  const base = sanitize(string).replace(/[.,/\\\\@#£!$%^&*;:<>{}|?=\\-+_`'\"~[\\]()]/g,'').replace(/\\s{1,}/g,' ');\n  return cleanupStringArray(base.toLowerCase().split(pattern).map((s) => s.trim()));\n}\n\nexport function eatPossiblePromise(p) {\n  // On some browsers, some APIs return Promises where they did not before,\n  //   wrap in this to discard any exceptions / rejections from these.\n  //   For example, pointerLockEnter, throws \"Uncaught UnknownError\" on Chrome on\n  //   Android, as well as triggering pointerlockerror.\n  if (p && p.catch) {\n    p.catch(nop);\n  }\n}\n\nexport function errorString(e) { // function errorString(e : Error | object | string) : string {\n  let msg = String(e);\n  if (msg === '[object Object]') {\n    try {\n      msg = JSON.stringify(e);\n    } catch (ignored) {\n      // ignored\n    }\n  }\n  if (e && e.stack && e.message) {\n    // Error object or similar\n    // Just grabbing the message, but could do something with the stack similar to error handler in bootstrap.js\n    msg = String(e.message);\n  }\n  msg = msg.slice(0, 600); // Not too huge\n  return msg;\n}\n\nexport function deprecate(exports, field, replacement) {\n  Object.defineProperty(exports, field, {\n    get: function () {\n      assert(false, `${field} is deprecated, use ${replacement} instead`);\n      return undefined;\n    }\n  });\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// Like assert(0), but return the value, so the throw can be disabled if the\n// calling code handles failure.  Can replace `verify(foo)` with `(foo)` at\n// build time in production builds.\n\nlet should_throw = true;\n\nfunction ok(exp, msg) {\n  if (exp) {\n    return true;\n  }\n  if (should_throw) {\n    throw new Error(`Assertion failed${msg ? `: ${msg}` : ''}`);\n  }\n  return false;\n}\nmodule.exports = ok;\nmodule.exports.ok = ok;\n\nfunction equal(a, b) {\n  if (a === b) {\n    return true;\n  }\n  if (should_throw) {\n    throw new Error(`Assertion failed: \"${a}\"===\"${b}\"`);\n  }\n  return false;\n}\nmodule.exports.equal = equal;\n\nfunction dothrow(doit) {\n  should_throw = doit;\n}\nmodule.exports.dothrow = dothrow;\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// Vector math functions required by the rest of the engine taken piecemeal from\n// gl-matrix and related, as well as some generic math utilities\nconst mat3Create = require('gl-mat3/create');\nconst mat4Create = require('gl-mat4/create');\n\nconst { abs, acos, max, min, floor, pow, round, sqrt } = Math;\n\nexport type Mat3 = Float32Array |\n  [number, number, number,\n   number, number, number,\n   number, number, number];\nexport type Mat4 = Float32Array |\n  [number, number, number, number,\n   number, number, number, number,\n   number, number, number, number,\n   number, number, number, number];\n\nexport type Vec4 = [number, number, number, number] | Float32Array | Int32Array;\nexport type Vec3 = [number, number, number] | Vec4;\nexport type Vec2 = [number, number] | Vec3;\nexport type Vec1 = [number] | Vec2;\n\nexport const mat3 = mat3Create as () => Mat3;\nexport const mat4 = mat4Create as () => Mat4;\n\nexport function vec1(v: number): Vec1 {\n  return new Float32Array([v || 0]);\n}\n\nexport function vec2(): Vec2;\nexport function vec2(a: number, b: number): Vec2;\nexport function vec2(a?: number, b?: number): Vec2 {\n  let r = new Float32Array(2);\n  if (a || b) {\n    r[0] = a as number;\n    r[1] = b as number;\n  }\n  return r;\n}\n\nexport function ivec2(): Vec2;\nexport function ivec2(a: number, b: number): Vec2;\nexport function ivec2(a?: number, b?: number): Vec2 {\n  let r = new Int32Array(2);\n  if (a || b) {\n    r[0] = a as number;\n    r[1] = b as number;\n  }\n  return r;\n}\n\nexport function vec3(): Vec3;\nexport function vec3(a: number, b: number, c: number): Vec3;\nexport function vec3(a?: number, b?: number, c?: number): Vec3 {\n  let r = new Float32Array(3);\n  if (a || b || c) {\n    r[0] = a as number;\n    r[1] = b as number;\n    r[2] = c as number;\n  }\n  return r;\n}\n\nexport function ivec3(): Vec3;\nexport function ivec3(a: number, b: number, c: number): Vec3;\nexport function ivec3(a?: number, b?: number, c?: number): Vec3 {\n  let r = new Int32Array(3);\n  if (a || b || c) {\n    r[0] = a as number;\n    r[1] = b as number;\n    r[2] = c as number;\n  }\n  return r;\n}\n\nexport function vec4(): Vec4;\nexport function vec4(a: number, b: number, c: number, d: number): Vec4;\nexport function vec4(a?: number, b?: number, c?: number, d?: number): Vec4 {\n  let r = new Float32Array(4);\n  if (a || b || c || d) {\n    r[0] = a as number;\n    r[1] = b as number;\n    r[2] = c as number;\n    r[3] = d as number;\n  }\n  return r;\n}\n\nfunction frozenVec4(a: number, b: number, c: number, d: number): Vec4 {\n  // if (debug) {\n  //   return Object.freeze([a,b,c,d]); // Not a vec4, but lets us catch bugs\n  // }\n  return vec4(a,b,c,d);\n}\n\nexport const unit_vec = frozenVec4(1,1,1,1);\nexport const half_vec = frozenVec4(0.5,0.5,0.5,0.5);\nexport const zero_vec = frozenVec4(0,0,0,0);\nexport const identity_mat3 = mat3();\nexport const identity_mat4 = mat4();\nexport const xaxis = frozenVec4(1,0,0,0);\nexport const yaxis = frozenVec4(0,1,0,0);\nexport const zaxis = frozenVec4(0,0,1,0);\n\n\nexport function v2abs(out: Vec2, a: Vec2): Vec2 {\n  out[0] = abs(a[0]);\n  out[1] = abs(a[1]);\n  return out;\n}\n\nexport function v2add(out: Vec2, a: Vec2, b: Vec2): Vec2 {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  return out;\n}\n\nexport function v2addScale(out: Vec2, a: Vec2, b: Vec2, s: number): Vec2 {\n  out[0] = a[0] + b[0] * s;\n  out[1] = a[1] + b[1] * s;\n  return out;\n}\n\nexport function v2angle(a: Vec2, b: Vec2): number {\n  let mag = sqrt(\n    (a[0] * a[0] + a[1] * a[1]) *\n    (b[0] * b[0] + b[1] * b[1])\n  );\n  return acos(\n    min(max(\n      mag && ((a[0] * b[0] + a[1] * b[1]) / mag),\n      -1),1\n    )\n  );\n}\n\nexport function v2copy(out: Vec2, a: Vec2): Vec2 {\n  out[0] = a[0];\n  out[1] = a[1];\n  return out;\n}\n\nexport function v2dist(a: Vec2, b: Vec2): number {\n  return sqrt((a[0] - b[0]) * (a[0] - b[0]) +\n    (a[1] - b[1]) * (a[1] - b[1]));\n}\n\nexport function v2distSq(a: Vec2, b: Vec2): number {\n  return (a[0] - b[0]) * (a[0] - b[0]) +\n    (a[1] - b[1]) * (a[1] - b[1]);\n}\n\nexport function v2div(out: Vec2, a: Vec2, b: Vec2): Vec2 {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  return out;\n}\n\nexport function v2dot(a: Vec2, b: Vec2): number {\n  return a[0] * b[0] + a[1] * b[1];\n}\n\nexport function v2floor(out: Vec2, a: Vec2): Vec2 {\n  out[0] = floor(a[0]);\n  out[1] = floor(a[1]);\n  return out;\n}\n\nexport function v2iFloor(a: Vec2): Vec2 {\n  a[0] = floor(a[0]);\n  a[1] = floor(a[1]);\n  return a;\n}\n\nexport function v2lengthSq(a: Vec2): number {\n  return a[0]*a[0] + a[1]*a[1];\n}\n\nexport function v2lerp(out: Vec2, t: number, a: Vec2, b: Vec2): Vec2 {\n  let it = 1 - t;\n  out[0] = it * a[0] + t * b[0];\n  out[1] = it * a[1] + t * b[1];\n  return out;\n}\n\nexport function v2mul(out: Vec2, a: Vec2, b: Vec2): Vec2 {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  return out;\n}\n\nexport function v2normalize(out: Vec2, a: Vec2): Vec2 {\n  let len = a[0]*a[0] + a[1]*a[1];\n  if (len > 0) {\n    len = 1 / sqrt(len);\n    out[0] = a[0] * len;\n    out[1] = a[1] * len;\n  }\n  return out;\n}\n\nexport function v2iNormalize(a: Vec2): Vec2 {\n  let len = a[0]*a[0] + a[1]*a[1];\n  if (len > 0) {\n    len = 1 / sqrt(len);\n    a[0] *= len;\n    a[1] *= len;\n  }\n  return a;\n}\n\nexport function v2round(out: Vec2, a: Vec2): Vec2 {\n  out[0] = round(a[0]);\n  out[1] = round(a[1]);\n  return out;\n}\n\nexport function v2iRound(a: Vec2): Vec2 {\n  a[0] = round(a[0]);\n  a[1] = round(a[1]);\n  return a;\n}\n\nexport function v2same(a: Vec2, b: Vec2): boolean {\n  return a[0] === b[0] && a[1] === b[1];\n}\n\nexport function v2scale(out: Vec2, a: Vec2, s: number): Vec2 {\n  out[0] = a[0] * s;\n  out[1] = a[1] * s;\n  return out;\n}\n\nexport function v2set(out: Vec2, a: number, b: number): Vec2 {\n  out[0] = a;\n  out[1] = b;\n  return out;\n}\n\nexport function v2sub(out: Vec2, a: Vec2, b: Vec2): Vec2 {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  return out;\n}\n\n\nexport function v3add(out: Vec3, a: Vec3, b: Vec3): Vec3 {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  return out;\n}\n\nexport function v3iAdd(a: Vec3, b: Vec3): Vec3 {\n  a[0] += b[0];\n  a[1] += b[1];\n  a[2] += b[2];\n  return a;\n}\n\nexport function v3addScale(out: Vec3, a: Vec3, b: Vec3, s: number): Vec3 {\n  out[0] = a[0] + b[0] * s;\n  out[1] = a[1] + b[1] * s;\n  out[2] = a[2] + b[2] * s;\n  return out;\n}\n\nexport function v3angle(a: Vec3, b: Vec3): number {\n  let mag = sqrt(\n    (a[0] * a[0] + a[1] * a[1] + a[2] * a[2]) *\n    (b[0] * b[0] + b[1] * b[1] + b[2] * b[2])\n  );\n  return acos(\n    min(max(\n      mag && ((a[0] * b[0] + a[1] * b[1] + a[2] * b[2]) / mag),\n      -1),1\n    )\n  );\n}\n\nexport function v3copy(out: Vec3, a: Vec3): Vec3 {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n\nexport function v3cross(out: Vec3, a: Vec3, b: Vec3): Vec3 {\n  let a0 = a[0];\n  let a1 = a[1];\n  let a2 = a[2];\n  let b0 = b[0];\n  let b1 = b[1];\n  let b2 = b[2];\n  out[0] = ((a1 * b2) - (a2 * b1));\n  out[1] = ((a2 * b0) - (a0 * b2));\n  out[2] = ((a0 * b1) - (a1 * b0));\n  return out;\n}\n\n// determinant of the matrix made by (columns?) [a, b, c];\nexport function v3determinant(a: Vec3, b: Vec3, c: Vec3): number {\n  // let a00 = a[0];\n  // let a01 = a[1];\n  // let a02 = a[2];\n  // let a10 = b[0];\n  // let a11 = b[1];\n  // let a12 = b[2];\n  // let a20 = c[0];\n  // let a21 = c[2];\n  // let a22 = c[2];\n  let a00 = a[0];\n  let a01 = b[0];\n  let a02 = c[0];\n  let a10 = a[1];\n  let a11 = b[1];\n  let a12 = c[1];\n  let a20 = a[2];\n  let a21 = b[2];\n  let a22 = c[2];\n\n  return a00 * (a22 * a11 - a12 * a21) + a01 * (-a22 * a10 + a12 * a20) + a02 * (a21 * a10 - a11 * a20);\n}\n\nexport function v3distSq(a: Vec3, b: Vec3): number {\n  return (a[0] - b[0]) * (a[0] - b[0]) +\n    (a[1] - b[1]) * (a[1] - b[1]) +\n    (a[2] - b[2]) * (a[2] - b[2]);\n}\n\nexport function v3dist(a: Vec3, b: Vec3): number {\n  return sqrt(v3distSq(a,b));\n}\n\nexport function v3div(out: Vec3, a: Vec3, b: Vec3): Vec3 {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  return out;\n}\n\nexport function v3dot(a: Vec3, b: Vec3): number {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n\nexport function v3iFloor(a: Vec3): Vec3 {\n  a[0] = floor(a[0]);\n  a[1] = floor(a[1]);\n  a[2] = floor(a[2]);\n  return a;\n}\n\nexport function v3floor(out: Vec3, a: Vec3): Vec3 {\n  out[0] = floor(a[0]);\n  out[1] = floor(a[1]);\n  out[2] = floor(a[2]);\n  return out;\n}\n\nexport function v3lengthSq(a: Vec3): number {\n  return a[0]*a[0] + a[1]*a[1] + a[2]*a[2];\n}\n\nexport function v3lerp(out: Vec3, t: number, a: Vec3, b: Vec3): Vec3 {\n  let it = 1 - t;\n  out[0] = it * a[0] + t * b[0];\n  out[1] = it * a[1] + t * b[1];\n  out[2] = it * a[2] + t * b[2];\n  return out;\n}\n\nexport function v3iMax(a: Vec3, b: Vec3): Vec3 {\n  a[0] = max(a[0], b[0]);\n  a[1] = max(a[1], b[1]);\n  a[2] = max(a[2], b[2]);\n  return a;\n}\n\nexport function v3iMin(a: Vec3, b: Vec3): Vec3 {\n  a[0] = min(a[0], b[0]);\n  a[1] = min(a[1], b[1]);\n  a[2] = min(a[2], b[2]);\n  return a;\n}\n\nexport function v3mul(out: Vec3, a: Vec3, b: Vec3): Vec3 {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  return out;\n}\n\nexport function v3iMul(a: Vec3, b: Vec3): Vec3 {\n  a[0] *= b[0];\n  a[1] *= b[1];\n  a[2] *= b[2];\n  return a;\n}\n\nexport function v3mulMat4(out: Vec3, a: Vec3, m: Mat4): Vec3 {\n  let x = a[0];\n  let y = a[1];\n  let z = a[2];\n  out[0] = x * m[0] + y * m[4] + z * m[8];\n  out[1] = x * m[1] + y * m[5] + z * m[9];\n  out[2] = x * m[2] + y * m[6] + z * m[10];\n  return out;\n}\n\n// Same as v3mulMat4, but assumes it's a vector with w=1\nexport function m4TransformVec3(out: Vec3, a: Vec3, m: Mat4): Vec3 {\n  let x = a[0];\n  let y = a[1];\n  let z = a[2];\n  out[0] = x * m[0] + y * m[4] + z * m[8] + m[12];\n  out[1] = x * m[1] + y * m[5] + z * m[9] + m[13];\n  out[2] = x * m[2] + y * m[6] + z * m[10] + m[14];\n  return out;\n}\n\nexport function v3normalize(out: Vec3, a: Vec3): Vec3 {\n  let len = a[0]*a[0] + a[1]*a[1] + a[2]*a[2];\n  if (len > 0) {\n    len = 1 / sqrt(len);\n    out[0] = a[0] * len;\n    out[1] = a[1] * len;\n    out[2] = a[2] * len;\n  }\n  return out;\n}\n\nexport function v3iNormalize(a: Vec3): Vec3 {\n  let len = a[0]*a[0] + a[1]*a[1] + a[2]*a[2];\n  if (len > 0) {\n    len = 1 / sqrt(len);\n    a[0] *= len;\n    a[1] *= len;\n    a[2] *= len;\n  }\n  return a;\n}\n\n// Treats `a` as vec3 input with w assumed to be 1\n// out[0]/[1] have had perspective divide and converted to normalized 0-1 range\n// out[2] is distance\nexport function v3perspectiveProject(out: Vec3, a: Vec3, m: Mat4): Vec3 {\n  let x = a[0];\n  let y = a[1];\n  let z = a[2];\n  let w = m[3] * x + m[7] * y + m[11] * z + m[15];\n  let invw = 0.5 / (w || 0.00001);\n  out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) * invw + 0.5;\n  out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) * -invw + 0.5;\n  out[2] = m[2] * x + m[6] * y + m[10] * z + m[14];\n  return out;\n}\n\nexport function v3pow(out: Vec3, a: Vec3, exp: number) : Vec3 {\n  out[0] = pow(a[0], exp);\n  out[1] = pow(a[1], exp);\n  out[2] = pow(a[2], exp);\n  return out;\n}\n\nexport function v3round(out: Vec3, a: Vec3): Vec3 {\n  out[0] = round(a[0]);\n  out[1] = round(a[1]);\n  out[2] = round(a[2]);\n  return out;\n}\n\nexport function v3iRound(a: Vec3): Vec3 {\n  a[0] = round(a[0]);\n  a[1] = round(a[1]);\n  a[2] = round(a[2]);\n  return a;\n}\n\nexport function v3same(a: Vec3, b: Vec3): boolean {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n}\n\nexport function v3scale(out: Vec3, a: Vec3, s: number): Vec3 {\n  out[0] = a[0] * s;\n  out[1] = a[1] * s;\n  out[2] = a[2] * s;\n  return out;\n}\n\nexport function v3scaleFloor(out: Vec3, a: Vec3, s: number): Vec3 {\n  out[0] = floor(a[0] * s);\n  out[1] = floor(a[1] * s);\n  out[2] = floor(a[2] * s);\n  return out;\n}\n\nexport function v3iScale(a: Vec3, s: number): Vec3 {\n  a[0] *= s;\n  a[1] *= s;\n  a[2] *= s;\n  return a;\n}\n\nexport function v3set(out: Vec3, a: number, b: number, c: number): Vec3 {\n  out[0] = a;\n  out[1] = b;\n  out[2] = c;\n  return out;\n}\n\nexport function v3sub(out: Vec3, a: Vec3, b: Vec3): Vec3 {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  return out;\n}\n\nexport function v3iSub(a: Vec3, b: Vec3): Vec3 {\n  a[0] -= b[0];\n  a[1] -= b[1];\n  a[2] -= b[2];\n  return a;\n}\n\nexport function v3zero(out: Vec3): Vec3 {\n  out[0] = out[1] = out[2] = 0;\n  return out;\n}\n\n\nexport function v4add(out: Vec4, a: Vec4, b: Vec4): Vec4 {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  return out;\n}\n\nexport function v4clone(a: Vec4): Vec4 {\n  return a.slice(0) as Vec4;\n}\n\nexport function v4copy(out: Vec4, a: Vec4): Vec4 {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  return out;\n}\n\nexport function v4dot(a: Vec4, b: Vec4): number {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\n}\n\nexport function v4fromRGBA(rgba: number): Vec4 {\n  let r = rgba >>> 24;\n  let g = (rgba & 0x00FF0000) >> 16;\n  let b = (rgba & 0x0000FF00) >> 8;\n  let a = rgba & 0xFF;\n  return vec4(r/255, g/255, b/255, a/255);\n}\n\nexport function v4lerp(out: Vec4, t: number, a: Vec4, b: Vec4): Vec4 {\n  let it = 1 - t;\n  out[0] = it * a[0] + t * b[0];\n  out[1] = it * a[1] + t * b[1];\n  out[2] = it * a[2] + t * b[2];\n  out[3] = it * a[3] + t * b[3];\n  return out;\n}\n\nexport function v4mul(out: Vec4, a: Vec4, b: Vec4): Vec4 {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  out[3] = a[3] * b[3];\n  return out;\n}\n\nexport function v4mulAdd(out: Vec4, a: Vec4, b: Vec4, c: Vec4): Vec4 {\n  out[0] = a[0] * b[0] + c[0];\n  out[1] = a[1] * b[1] + c[1];\n  out[2] = a[2] * b[2] + c[2];\n  out[3] = a[3] * b[3] + c[3];\n  return out;\n}\n\nexport function v4same(a: Vec4, b: Vec4): boolean {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n}\n\nexport function v4scale(out: Vec4, a: Vec4, s:number): Vec4 {\n  out[0] = a[0] * s;\n  out[1] = a[1] * s;\n  out[2] = a[2] * s;\n  out[3] = a[3] * s;\n  return out;\n}\n\nexport function v4set(out: Vec4, a: number, b: number, c: number, d: number): Vec4 {\n  out[0] = a;\n  out[1] = b;\n  out[2] = c;\n  out[3] = d;\n  return out;\n}\n\nexport function v4zero(out: Vec4): Vec4 {\n  out[0] = out[1] = out[2] = out[3] = 0;\n  return out;\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n// Originally from Splody, used with permission\n/* eslint no-multi-spaces:off, array-bracket-spacing:off */\n\nconst assert = require('assert');\nconst { max } = Math;\n\nconst trans_src = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+';\nconst trans_dst = '4bcd3fgh1jk1mn0pqr57uvwxy24bcd3fgh1jk1mn0pqr57uvwxy201234567897';\nconst trans_src_regex = /[a-zA-Z0-9+]+/g;\nlet trans_lookup = {};\nfunction canonize(str) {\n  return str.split('').map((c) => (trans_lookup[c] || c)).join('');\n}\n\nfunction rot13(str) {\n  return str.split('').map((c) => {\n    c = c.charCodeAt(0);\n    if (c >= 97/*a*/ && c <= 122/*z*/) {\n      c = 97 + (((c - 97) + 13) % 26);\n    } else if (c >= 65/*A*/ && c <= 90/*Z*/) {\n      c = 65 + (((c - 65) + 13) % 26);\n    }\n    return String.fromCharCode(c);\n  }).join('');\n}\n\nlet profanity = {};\nlet reserved = {};\n\n// shorter first, if substrings (just 's' and 'es'/'ers')\nlet suffixes =           [ '', 's',  's', 'in', 'ing', 'er', 'ers', 'ed', 'y' ];\nlet suffixes_canonized = [ '', '5', '35', '1n', '1ng', '3r', '3r5', '3d', 'y' ];\n\nlet max_len = 0;\nlet inited = false;\n// filter_gkg is rot13 of (singular) words to filter\n// exceptions_txt is includes specific words that should not be filtered (e.g.\n//   a common word that looks like a plural of a filtered word)\nexport function profanityCommonStartup(filter_gkg, exceptions_txt) {\n  assert(!inited);\n  inited = true;\n  for (let ii = 0; ii < trans_src.length; ++ii) {\n    trans_lookup[trans_src[ii]] = trans_dst[ii];\n  }\n  let data = filter_gkg.split('\\n').filter((a) => a);\n  for (let ii = 0; ii < data.length; ++ii) {\n    let s = rot13(data[ii]);\n    let start_len = s.length;\n    s = canonize(s);\n    assert.equal(start_len, s.length); // Otherwise got a bad character in the source data?\n    for (let jj = 0; jj < suffixes_canonized.length; ++jj) {\n      let str = s + suffixes_canonized[jj];\n      let existing = profanity[str];\n      if (!existing || existing > jj) {\n        max_len = max(max_len, str.length);\n        profanity[str] = jj + 1;\n      }\n    }\n  }\n  data = exceptions_txt.split('\\n').filter((a) => a);\n  for (let ii = 0; ii < data.length; ++ii) {\n    delete profanity[canonize(data[ii])];\n  }\n}\n\nexport function reservedStartup(reserved_txt) {\n  let data = reserved_txt.split('\\n').filter((a) => a);\n  for (let i = 0; i < data.length; ++i) {\n    let string = canonize(data[i]);\n    reserved[string] = 1;\n  }\n}\n\nlet randWord;\nfunction filterWord(word_src) {\n  if (word_src.length >= max_len) {\n    return word_src;\n  }\n\n  let is_uppercase = word_src[0].toUpperCase() === word_src[0];\n  let word_canon = canonize(word_src);\n  let suffix_idx = profanity[word_canon];\n  // do lookup, replace\n  if (!suffix_idx) {\n    return word_src;\n  }\n  --suffix_idx;\n  let word = randWord();\n  if (is_uppercase) {\n    word = word[0].toUpperCase() + word.slice(1);\n  }\n  let suffix = suffixes[suffix_idx];\n  if (word[word.length - 1] === suffix[0]) { // e.g. replacement word ends in an 'e'\n    suffix = suffix.slice(1);\n  }\n  if (word.endsWith('e') && suffix[0] === 'i') {\n    word = word.slice(0, -1);\n  }\n  word += suffix;\n  return word;\n}\n\nlet is_profane;\nfunction checkWord(word_src) {\n  if (word_src.length >= max_len) {\n    return;\n  }\n\n  if (profanity[canonize(word_src)]) {\n    is_profane = true;\n  }\n}\n\nexport function profanityFilterCommon(user_str, rand_word_fn) {\n  assert(inited);\n  randWord = rand_word_fn;\n  return user_str.replace(trans_src_regex, filterWord);\n}\n\nexport function isProfane(user_str) {\n  assert(inited);\n  is_profane = false;\n  user_str.replace(trans_src_regex, checkWord);\n  return is_profane;\n}\n\nlet is_reserved;\nfunction checkReserved(word_src) {\n  if (reserved[canonize(word_src)]) {\n    is_reserved = true;\n  }\n}\n\nexport function isReserved(user_str) {\n  assert(inited);\n  is_reserved = false;\n  user_str.replace(trans_src_regex, checkReserved);\n  return is_reserved;\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nexport let wsstats = { msgs: 0, bytes: 0 };\nexport let wsstats_out = { msgs: 0, bytes: 0 };\n\n/* eslint-disable import/order */\nconst ack = require('./ack.js');\nconst assert = require('assert');\nconst { ackHandleMessage, ackReadHeader, ackWrapPakStart, ackWrapPakPayload, ackWrapPakFinish } = ack;\nconst { random, round } = Math;\nconst packet = require('./packet.js');\nconst { isPacket, packetCreate, packetFromBuffer } = packet;\n\nexport const CONNECTION_TIMEOUT = 60000;\nexport const PING_TIME = CONNECTION_TIMEOUT / 2;\n\n// Rough estimate, if over, will prevent resizing the packet\nconst PAK_HEADER_SIZE = 1 + // flags\n  1+16 + // message id\n  1+9; // resp_pak_id\n\nlet net_delay = 0;\nlet net_delay_rand = 0;\n\nfunction socketSendInternal(client, buf, pak) {\n  if (client.ws_server) {\n    client.socket.send(buf, pak.pool.bind(pak));\n  } else {\n    // Testing code to fake sending string packets for debugging\n    // Note: though we can successfully decode these string packets, ones seen\n    //   in the wild appear to have lost data and cannot be decoded in the same\n    //   way.\n    // let str = [];\n    // for (let ii = 0; ii < buf.length; ++ii) {\n    //   str.push(String.fromCharCode(buf[ii]));\n    // }\n    // client.socket.send(str.join(''));\n\n    client.socket.send(buf);\n    pak.pool();\n  }\n}\n\nexport function netDelaySet(delay, rand) {\n  if (delay === undefined) {\n    // development defaults\n    delay = 100;\n    rand = 50;\n  }\n  if (delay) {\n    console.log(`NetDelay: ON (${delay}+${rand})`);\n  } else {\n    console.log('NetDelay: Off');\n  }\n  net_delay = delay;\n  net_delay_rand = rand;\n}\n\nexport function netDelayGet() {\n  return [net_delay, net_delay_rand];\n}\n\nfunction NetDelayer(client, socket) {\n  this.client = client;\n  this.head = null;\n  this.tail = null;\n  this.tick = this.tickFn.bind(this);\n}\nNetDelayer.prototype.send = function (buf, pak) {\n  let now = Date.now();\n  let delay = round(net_delay + net_delay_rand * random());\n  let time = now + delay;\n  let elem = { buf, pak, time, next: null };\n  if (this.tail) {\n    this.tail.next = elem;\n    this.tail = elem;\n  } else {\n    this.head = this.tail = elem;\n    setTimeout(this.tick, delay);\n  }\n};\nNetDelayer.prototype.tickFn = function () {\n  let { client } = this;\n  if (client.net_delayer !== this) {\n    // we've been disconnected, just don't ever write these packets\n    while (this.head) {\n      let elem = this.head;\n      elem.pak.pool();\n      this.head = elem.next;\n    }\n    this.tail = null;\n    return;\n  }\n  // Send at least first, possibly more, then schedule tick if any left\n  let now = Date.now();\n  do {\n    // Pop it\n    let elem = this.head;\n    this.head = elem.next;\n    if (!this.head) {\n      this.tail = null;\n    }\n    // Send it\n    let { buf, pak } = elem;\n    socketSendInternal(client, buf, pak);\n  } while (this.head && this.head.time <= now);\n  if (this.head) {\n    setTimeout(this.tick, this.head.time - now);\n  }\n};\n\nexport function wsPakSendDest(client, pak) {\n  if (!client.connected || client.socket.readyState !== 1) {\n    // We only get to this particular location from wsserver.broadcast*, all\n    //   other paths will print the actual message and error earlier.\n    console.warn(`Attempting to send on a disconnected link (client_id:${client.id}), ignoring`);\n    pak.pool();\n    return;\n  }\n  let buf = pak.getBuffer(); // a Uint8Array\n  let buf_len = pak.getBufferLen();\n  if (buf_len !== buf.length) {\n    buf = new Uint8Array(buf.buffer, buf.byteOffset, buf_len);\n  }\n  wsstats_out.msgs++;\n  wsstats_out.bytes += buf.length;\n  if (net_delay) {\n    if (!client.net_delayer) {\n      client.net_delayer = new NetDelayer(client);\n    }\n    client.net_delayer.send(buf, pak);\n  } else {\n    socketSendInternal(client, buf, pak);\n  }\n  client.last_send_time = Date.now();\n}\n\nfunction wsPakSendFinish(pak, err, resp_func) {\n  let { client, msg } = pak.ws_data;\n  delete pak.ws_data;\n  let ack_resp_pkt_id = ackWrapPakFinish(pak, err, resp_func);\n\n  if (!client.connected || client.socket.readyState !== 1) { // WebSocket.OPEN\n    if (msg === 'channel_msg') { // client -> server channel message, attach additional debugging info\n      pak.seek(0);\n      pak.readFlags();\n      let header = ackReadHeader(pak);\n      let is_packet = isPacket(header.data);\n      let channel_id;\n      let submsg;\n      if (is_packet) {\n        pak.ref(); // deal with auto-pool of an empty packet\n        channel_id = pak.readAnsiString();\n        submsg = pak.readAnsiString();\n        if (!pak.ended()) {\n          pak.pool();\n        }\n      } else {\n        channel_id = header.data.channel_id;\n        submsg = header.data.msg;\n      }\n      msg = `channel_msg:${channel_id}:${submsg}`;\n    }\n    if (typeof msg !== 'number') {\n      (client.log ? client : console).log(`Attempting to send msg=${msg} on a disconnected link, ignoring`);\n      if (!client.log && client.onError && msg) {\n        // On the client, if we try to send a new packet while disconnected, this is an application error\n        client.onError(`Attempting to send msg=${msg} on a disconnected link`);\n      }\n    }\n\n    if (ack_resp_pkt_id) {\n      // Callback will never be dispatched through ack.js, remove the callback here\n      delete client.resp_cbs[ack_resp_pkt_id];\n    }\n    pak.pool();\n    return;\n  }\n\n  assert.equal(Boolean(resp_func && resp_func.expecting_response !== false), Boolean(ack_resp_pkt_id));\n\n  wsPakSendDest(client, pak);\n}\n\nfunction wsPakSend(err, resp_func) {\n  let pak = this; // eslint-disable-line @typescript-eslint/no-invalid-this\n  if (typeof err === 'function' && !resp_func) {\n    resp_func = err;\n    err = null;\n  }\n  wsPakSendFinish(pak, err, resp_func);\n}\n\nexport function wsPak(msg, ref_pak, client) {\n  assert(typeof msg === 'string' || typeof msg === 'number');\n\n  // Assume new packet needs to be comparable to old packet, in flags and size\n  let pak = packetCreate(ref_pak ? ref_pak.getInternalFlags() : packet.default_flags,\n    ref_pak ? ref_pak.totalSize() + PAK_HEADER_SIZE : 0);\n  pak.writeFlags();\n\n  ackWrapPakStart(pak, client, msg);\n\n  pak.ws_data = {\n    msg,\n    client,\n  };\n  pak.send = wsPakSend;\n  return pak;\n}\n\nfunction sendMessageInternal(client, msg, err, data, resp_func) {\n  let is_packet = isPacket(data);\n  let pak = wsPak(msg, is_packet ? data : null, client);\n\n  if (!err) {\n    ackWrapPakPayload(pak, data);\n  }\n\n  pak.send(err, resp_func);\n}\n\nexport function sendMessage(msg, data, resp_func) {\n  sendMessageInternal(this, msg, null, data, resp_func); // eslint-disable-line @typescript-eslint/no-invalid-this\n}\n\nexport function wsHandleMessage(client, buf, filter) {\n  ++wsstats.msgs;\n  let now = Date.now();\n  let source = client.id ? `client ${client.id}` : 'server';\n  if (!(buf instanceof Uint8Array)) {\n    (client.log ? client : console).log(`Received incorrect WebSocket data type from ${source} (${typeof buf})`);\n    if (typeof buf === 'string') {\n      (client.log ? client : console).log(`Invalid WebSocket data: ${JSON.stringify(buf.slice(0, 120))}`);\n    }\n    if (client.ws_server) {\n      if (!client.has_warned_about_text) {\n        // Send an generic error (still as binary, since if they got this far, they\n        //   must have received the binary `cack` successfully.\n        client.has_warned_about_text = true;\n        client.send('error', 'Server received non-binary WebSocket data.  ' +\n          'Likely cause is a proxy, VPN or something else intercepting and modifying network traffic.');\n      }\n      return;\n    }\n    return void client.onError('Invalid data received');\n  }\n  wsstats.bytes += buf.length;\n  let pak = packetFromBuffer(buf, buf.length, false);\n  pak.readFlags();\n  client.last_receive_time = now;\n  client.idle_counter = 0;\n\n  return void ackHandleMessage(client, source, pak, function sendFunc(msg, err, data, resp_func) {\n    if (resp_func && !resp_func.expecting_response) {\n      resp_func = null;\n    }\n    sendMessageInternal(client, msg, err, data, resp_func);\n  }, function pakFunc(msg, ref_pak) {\n    return wsPak(msg, ref_pak, client);\n  }, function handleFunc(msg, data, resp_func) {\n    let handler = client.handlers[msg];\n    if (!handler) {\n      let error_msg = `No handler for message ${JSON.stringify(msg)} from ${source}`;\n      console.error(error_msg, isPacket(data) ? data.contents() : data);\n      if (client.onError) {\n        return client.onError(error_msg);\n      }\n      return resp_func(error_msg);\n    }\n    return handler(client, data, resp_func);\n  }, filter);\n}\n"]}