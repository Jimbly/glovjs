{"version":3,"sources":["node_modules/browser-pack/_prelude.js","app.js","img/font/vga_16x1.json","terminal_test.js","../glov/client/bootstrap.js","../glov/client/browser.js","../glov/client/build_ui.js","../glov/client/camera2d.js","../glov/client/client_config.ts","../glov/client/cmds.js","../glov/client/dyn_geom.js","../glov/client/edit_box.js","../glov/client/effects.js","../glov/client/engine.js","../glov/client/environments.ts","../glov/client/error_report.js","../glov/client/fbinstant.js","../glov/client/fetch.js","../glov/client/filewatch.js","../glov/client/font.js","../glov/client/framebuffer.js","../glov/client/geom.js","../glov/client/glb/decode-utf8.js","../glov/client/glb/gltf-type-utils.js","../glov/client/glb/parser.js","../glov/client/glb/unpack-binary-json.js","../glov/client/glb/unpack-glb-buffers.js","../glov/client/in_event.js","../glov/client/input.js","../glov/client/input_constants.ts","../glov/client/link.js","../glov/client/local_storage.ts","../glov/client/localization.ts","../glov/client/mat43.js","../glov/client/models.js","../glov/client/net.js","../glov/client/particles.js","../glov/client/perf.js","../glov/client/perf_net.ts","../glov/client/pointer_lock.js","../glov/client/polyfill.js","../glov/client/profiler.js","../glov/client/profiler_ui.js","../glov/client/scroll_area.ts","../glov/client/settings.js","../glov/client/shader_debug_ui.js","../glov/client/shaders.js","../glov/client/slider.js","../glov/client/social.ts","../glov/client/sound.ts","../glov/client/spot.ts","../glov/client/sprites.js","../glov/client/subscription_manager.js","../glov/client/terminal.js","../glov/client/terminal_settings.js","../glov/client/textures.js","../glov/client/transition.js","../glov/client/ui.js","../glov/client/urlhash.js","../glov/client/walltime.js","../glov/client/webfs.js","../glov/client/wsclient.js","../glov/common/ack.js","../glov/common/base64.js","../glov/common/chunked_send.js","../glov/common/cmd_parse.js","../glov/common/crc32.js","../glov/common/dot-prop.js","../glov/common/enums.ts","../glov/common/friends_data.ts","../glov/common/md5.js","../glov/common/packet.js","../glov/common/perfcounters.js","../glov/common/tiny-events.js","../glov/common/util.js","../glov/common/verify.ts","../glov/common/vmath.ts","../glov/common/wscommon.js"],"names":[],"mappings":"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AAI;AACvB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AAEzB,EAAE,GAAG,EADL,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI,YAChB,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACvB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AAEzB,EAAE,GAAG,EADL,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI,YAChB,EAAE,EAAE,EAAE,GAAI,IAAI;AACvB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI;AACzB,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAI;AACzB,EA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","file":"app.bundle.js","sourceRoot":"","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","/* eslint global-require:off */\n\n// For debug and used internally in the build/bundling pipeline\nwindow.glov_build_version=BUILD_TIMESTAMP;\n\n// Startup code.\n\nlet called_once = false;\nwindow.onload = function () {\n  if (called_once) {\n    return;\n  }\n  called_once = true;\n  require('glov/client/bootstrap.js');\n  require('./terminal_test.js').main();\n};\n","module.exports={\"font_size\":16,\"imageW\":512,\"imageH\":256,\"spread\":4,\"noFilter\":1,\"channels\":1,\"char_infos\":[{\"c\":1,\"x0\":106,\"y0\":49,\"yoffs\":2,\"xpad\":1,\"w\":8,\"h\":10},{\"c\":2,\"x0\":123,\"y0\":49,\"yoffs\":2,\"xpad\":1,\"w\":8,\"h\":10},{\"c\":3,\"x0\":319,\"y0\":106,\"yoffs\":4,\"xpad\":2,\"w\":7,\"h\":8},{\"c\":4,\"x0\":119,\"y0\":126,\"yoffs\":4,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":5,\"x0\":479,\"y0\":84,\"yoffs\":3,\"xpad\":1,\"w\":8,\"h\":9},{\"c\":6,\"x0\":496,\"y0\":84,\"yoffs\":3,\"xpad\":1,\"w\":8,\"h\":9},{\"c\":7,\"x0\":312,\"y0\":140,\"yoffs\":6,\"xpad\":3,\"w\":6,\"h\":4},{\"c\":8,\"x0\":4,\"y0\":4,\"xpad\":1,\"w\":8,\"h\":16},{\"c\":9,\"x0\":20,\"y0\":143,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":6},{\"c\":10,\"x0\":21,\"y0\":4,\"xpad\":1,\"w\":8,\"h\":16},{\"c\":11,\"x0\":140,\"y0\":49,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":12,\"x0\":156,\"y0\":49,\"yoffs\":2,\"xpad\":3,\"w\":6,\"h\":10},{\"c\":13,\"x0\":171,\"y0\":49,\"yoffs\":2,\"xpad\":1,\"w\":8,\"h\":10},{\"c\":14,\"x0\":188,\"y0\":49,\"yoffs\":2,\"xpad\":1,\"w\":8,\"h\":10},{\"c\":15,\"x0\":4,\"y0\":108,\"yoffs\":3,\"xpad\":1,\"w\":8,\"h\":9},{\"c\":16,\"x0\":100,\"y0\":29,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":17,\"x0\":116,\"y0\":29,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":18,\"x0\":21,\"y0\":108,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":9},{\"c\":19,\"x0\":205,\"y0\":49,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":20,\"x0\":221,\"y0\":49,\"yoffs\":2,\"xpad\":1,\"w\":8,\"h\":10},{\"c\":21,\"x0\":486,\"y0\":4,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":12},{\"c\":22,\"x0\":327,\"y0\":139,\"yoffs\":8,\"xpad\":2,\"w\":7,\"h\":4},{\"c\":23,\"x0\":238,\"y0\":49,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":24,\"x0\":254,\"y0\":49,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":25,\"x0\":270,\"y0\":49,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":26,\"x0\":117,\"y0\":143,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":5},{\"c\":27,\"x0\":133,\"y0\":142,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":5},{\"c\":28,\"x0\":343,\"y0\":139,\"yoffs\":6,\"xpad\":2,\"w\":7,\"h\":4},{\"c\":29,\"x0\":149,\"y0\":140,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":5},{\"c\":30,\"x0\":135,\"y0\":124,\"yoffs\":4,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":31,\"x0\":151,\"y0\":124,\"yoffs\":4,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":32,\"xpad\":9},{\"c\":33,\"x0\":286,\"y0\":49,\"yoffs\":2,\"xpad\":3,\"w\":6,\"h\":10},{\"c\":34,\"x0\":359,\"y0\":139,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":4},{\"c\":35,\"x0\":37,\"y0\":108,\"yoffs\":3,\"xpad\":2,\"w\":7,\"h\":9},{\"c\":36,\"x0\":374,\"y0\":4,\"xpad\":2,\"w\":7,\"h\":14},{\"c\":37,\"x0\":335,\"y0\":106,\"yoffs\":4,\"xpad\":2,\"w\":7,\"h\":8},{\"c\":38,\"x0\":301,\"y0\":49,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":39,\"x0\":375,\"y0\":139,\"yoffs\":1,\"xpad\":5,\"w\":4,\"h\":4},{\"c\":40,\"x0\":317,\"y0\":49,\"yoffs\":2,\"xpad\":3,\"w\":6,\"h\":10},{\"c\":41,\"x0\":332,\"y0\":49,\"yoffs\":2,\"xpad\":3,\"w\":6,\"h\":10},{\"c\":42,\"x0\":165,\"y0\":140,\"yoffs\":5,\"xpad\":1,\"w\":8,\"h\":5},{\"c\":43,\"x0\":182,\"y0\":140,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":5},{\"c\":44,\"x0\":388,\"y0\":139,\"yoffs\":9,\"xpad\":4,\"w\":5,\"h\":4},{\"c\":45,\"x0\":34,\"y0\":158,\"yoffs\":7,\"xpad\":2,\"w\":7,\"h\":1},{\"c\":46,\"x0\":499,\"y0\":135,\"yoffs\":10,\"xpad\":4,\"w\":5,\"h\":2},{\"c\":47,\"x0\":351,\"y0\":106,\"yoffs\":4,\"xpad\":2,\"w\":7,\"h\":8},{\"c\":48,\"x0\":347,\"y0\":49,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":49,\"x0\":363,\"y0\":49,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":50,\"x0\":379,\"y0\":49,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":51,\"x0\":395,\"y0\":47,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":52,\"x0\":411,\"y0\":47,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":53,\"x0\":427,\"y0\":46,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":54,\"x0\":443,\"y0\":46,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":55,\"x0\":459,\"y0\":46,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":56,\"x0\":475,\"y0\":46,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":57,\"x0\":491,\"y0\":46,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":58,\"x0\":167,\"y0\":124,\"yoffs\":4,\"xpad\":4,\"w\":5,\"h\":7},{\"c\":59,\"x0\":367,\"y0\":106,\"yoffs\":4,\"xpad\":4,\"w\":5,\"h\":8},{\"c\":60,\"x0\":53,\"y0\":108,\"yoffs\":3,\"xpad\":2,\"w\":7,\"h\":9},{\"c\":61,\"x0\":402,\"y0\":139,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":4},{\"c\":62,\"x0\":69,\"y0\":108,\"yoffs\":3,\"xpad\":2,\"w\":7,\"h\":9},{\"c\":63,\"x0\":4,\"y0\":70,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":64,\"x0\":85,\"y0\":108,\"yoffs\":3,\"xpad\":2,\"w\":7,\"h\":9},{\"c\":65,\"x0\":20,\"y0\":70,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":66,\"x0\":36,\"y0\":70,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":67,\"x0\":52,\"y0\":70,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":68,\"x0\":68,\"y0\":70,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":69,\"x0\":84,\"y0\":70,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":70,\"x0\":100,\"y0\":70,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":71,\"x0\":116,\"y0\":68,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":72,\"x0\":132,\"y0\":68,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":73,\"x0\":148,\"y0\":68,\"yoffs\":2,\"xpad\":3,\"w\":6,\"h\":10},{\"c\":74,\"x0\":163,\"y0\":68,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":75,\"x0\":179,\"y0\":68,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":76,\"x0\":195,\"y0\":68,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":77,\"x0\":211,\"y0\":68,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":78,\"x0\":227,\"y0\":68,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":79,\"x0\":243,\"y0\":68,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":80,\"x0\":259,\"y0\":68,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":81,\"x0\":4,\"y0\":29,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":12},{\"c\":82,\"x0\":275,\"y0\":68,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":83,\"x0\":291,\"y0\":68,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":84,\"x0\":307,\"y0\":68,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":85,\"x0\":323,\"y0\":68,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":86,\"x0\":339,\"y0\":68,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":87,\"x0\":355,\"y0\":68,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":88,\"x0\":371,\"y0\":68,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":89,\"x0\":387,\"y0\":68,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":90,\"x0\":403,\"y0\":66,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":91,\"x0\":419,\"y0\":66,\"yoffs\":2,\"xpad\":3,\"w\":6,\"h\":10},{\"c\":92,\"x0\":101,\"y0\":108,\"yoffs\":3,\"xpad\":2,\"w\":7,\"h\":9},{\"c\":93,\"x0\":434,\"y0\":65,\"yoffs\":2,\"xpad\":3,\"w\":6,\"h\":10},{\"c\":94,\"x0\":418,\"y0\":139,\"xpad\":2,\"w\":7,\"h\":4},{\"c\":95,\"x0\":50,\"y0\":158,\"yoffs\":13,\"xpad\":1,\"w\":8,\"h\":1},{\"c\":96,\"x0\":466,\"y0\":137,\"yoffs\":1,\"xpad\":3,\"w\":6,\"h\":3},{\"c\":97,\"x0\":181,\"y0\":124,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":98,\"x0\":449,\"y0\":65,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":99,\"x0\":197,\"y0\":124,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":100,\"x0\":465,\"y0\":65,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":101,\"x0\":213,\"y0\":124,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":102,\"x0\":481,\"y0\":65,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":103,\"x0\":497,\"y0\":65,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":104,\"x0\":4,\"y0\":89,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":105,\"x0\":20,\"y0\":89,\"yoffs\":2,\"xpad\":3,\"w\":6,\"h\":10},{\"c\":106,\"x0\":407,\"y0\":4,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":13},{\"c\":107,\"x0\":35,\"y0\":89,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":108,\"x0\":51,\"y0\":89,\"yoffs\":2,\"xpad\":3,\"w\":6,\"h\":10},{\"c\":109,\"x0\":229,\"y0\":124,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":110,\"x0\":245,\"y0\":124,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":111,\"x0\":261,\"y0\":124,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":112,\"x0\":66,\"y0\":89,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":113,\"x0\":82,\"y0\":89,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":114,\"x0\":277,\"y0\":124,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":115,\"x0\":293,\"y0\":124,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":116,\"x0\":98,\"y0\":89,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":117,\"x0\":309,\"y0\":124,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":118,\"x0\":325,\"y0\":123,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":119,\"x0\":341,\"y0\":123,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":120,\"x0\":357,\"y0\":123,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":121,\"x0\":114,\"y0\":89,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":122,\"x0\":373,\"y0\":123,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":123,\"x0\":130,\"y0\":87,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":124,\"x0\":146,\"y0\":87,\"yoffs\":2,\"xpad\":4,\"w\":5,\"h\":10},{\"c\":125,\"x0\":160,\"y0\":87,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":126,\"x0\":4,\"y0\":159,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":2},{\"c\":127,\"x0\":389,\"y0\":123,\"yoffs\":4,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":160,\"xpad\":9},{\"c\":161,\"x0\":176,\"y0\":87,\"yoffs\":2,\"xpad\":3,\"w\":6,\"h\":10},{\"c\":162,\"x0\":132,\"y0\":29,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":163,\"x0\":148,\"y0\":29,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":165,\"x0\":191,\"y0\":87,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":170,\"x0\":36,\"y0\":143,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":6},{\"c\":171,\"x0\":198,\"y0\":140,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":5},{\"c\":172,\"x0\":214,\"y0\":140,\"yoffs\":6,\"xpad\":2,\"w\":7,\"h\":5},{\"c\":176,\"x0\":434,\"y0\":139,\"yoffs\":1,\"xpad\":3,\"w\":6,\"h\":4},{\"c\":177,\"x0\":381,\"y0\":106,\"yoffs\":4,\"xpad\":2,\"w\":7,\"h\":8},{\"c\":178,\"x0\":52,\"y0\":143,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":6},{\"c\":181,\"x0\":207,\"y0\":87,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":183,\"x0\":67,\"y0\":158,\"yoffs\":7,\"xpad\":4,\"w\":5,\"h\":1},{\"c\":186,\"x0\":68,\"y0\":143,\"yoffs\":2,\"xpad\":3,\"w\":6,\"h\":6},{\"c\":187,\"x0\":230,\"y0\":140,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":5},{\"c\":188,\"x0\":423,\"y0\":4,\"yoffs\":1,\"xpad\":1,\"w\":8,\"h\":13},{\"c\":189,\"x0\":440,\"y0\":4,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":13},{\"c\":191,\"x0\":223,\"y0\":87,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":196,\"x0\":164,\"y0\":29,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":197,\"x0\":20,\"y0\":29,\"xpad\":2,\"w\":7,\"h\":12},{\"c\":198,\"x0\":36,\"y0\":29,\"xpad\":2,\"w\":7,\"h\":12},{\"c\":199,\"x0\":52,\"y0\":29,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":12},{\"c\":201,\"x0\":68,\"y0\":29,\"xpad\":2,\"w\":7,\"h\":12},{\"c\":209,\"x0\":84,\"y0\":29,\"xpad\":2,\"w\":7,\"h\":12},{\"c\":214,\"x0\":180,\"y0\":29,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":220,\"x0\":196,\"y0\":29,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":223,\"x0\":239,\"y0\":87,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":224,\"x0\":212,\"y0\":29,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":225,\"x0\":228,\"y0\":29,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":226,\"x0\":244,\"y0\":29,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":228,\"x0\":255,\"y0\":87,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":229,\"x0\":260,\"y0\":29,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":230,\"x0\":405,\"y0\":123,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":231,\"x0\":117,\"y0\":108,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":9},{\"c\":232,\"x0\":276,\"y0\":29,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":233,\"x0\":292,\"y0\":29,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":234,\"x0\":308,\"y0\":29,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":235,\"x0\":271,\"y0\":87,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":236,\"x0\":324,\"y0\":29,\"yoffs\":1,\"xpad\":3,\"w\":6,\"h\":11},{\"c\":237,\"x0\":339,\"y0\":29,\"yoffs\":1,\"xpad\":3,\"w\":6,\"h\":11},{\"c\":238,\"x0\":354,\"y0\":29,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":239,\"x0\":287,\"y0\":87,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":241,\"x0\":303,\"y0\":87,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":242,\"x0\":370,\"y0\":29,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":243,\"x0\":386,\"y0\":27,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":244,\"x0\":402,\"y0\":27,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":246,\"x0\":319,\"y0\":87,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":247,\"x0\":246,\"y0\":140,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":5},{\"c\":249,\"x0\":418,\"y0\":26,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":250,\"x0\":434,\"y0\":26,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":251,\"x0\":450,\"y0\":26,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":252,\"x0\":335,\"y0\":87,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":255,\"x0\":456,\"y0\":4,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":13},{\"c\":402,\"x0\":466,\"y0\":26,\"yoffs\":1,\"xpad\":1,\"w\":8,\"h\":11},{\"c\":915,\"x0\":351,\"y0\":87,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":920,\"x0\":367,\"y0\":87,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":931,\"x0\":383,\"y0\":87,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":934,\"x0\":399,\"y0\":87,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":937,\"x0\":415,\"y0\":85,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":945,\"x0\":421,\"y0\":123,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":948,\"x0\":431,\"y0\":85,\"yoffs\":2,\"xpad\":2,\"w\":7,\"h\":10},{\"c\":949,\"x0\":447,\"y0\":84,\"yoffs\":2,\"xpad\":3,\"w\":6,\"h\":10},{\"c\":960,\"x0\":437,\"y0\":121,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":963,\"x0\":453,\"y0\":121,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":964,\"x0\":397,\"y0\":106,\"yoffs\":4,\"xpad\":2,\"w\":7,\"h\":8},{\"c\":966,\"x0\":133,\"y0\":106,\"yoffs\":3,\"w\":9,\"h\":9},{\"c\":8319,\"x0\":83,\"y0\":143,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":6},{\"c\":8359,\"x0\":483,\"y0\":26,\"yoffs\":1,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":8729,\"x0\":20,\"y0\":158,\"yoffs\":7,\"xpad\":4,\"w\":5,\"h\":2},{\"c\":8730,\"x0\":499,\"y0\":25,\"yoffs\":1,\"xpad\":1,\"w\":8,\"h\":11},{\"c\":8734,\"x0\":262,\"y0\":140,\"yoffs\":5,\"w\":9,\"h\":5},{\"c\":8745,\"x0\":151,\"y0\":106,\"yoffs\":3,\"xpad\":2,\"w\":7,\"h\":9},{\"c\":8776,\"x0\":280,\"y0\":140,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":5},{\"c\":8801,\"x0\":469,\"y0\":120,\"yoffs\":4,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":8804,\"x0\":167,\"y0\":106,\"yoffs\":3,\"xpad\":2,\"w\":7,\"h\":9},{\"c\":8805,\"x0\":183,\"y0\":106,\"yoffs\":3,\"xpad\":2,\"w\":7,\"h\":9},{\"c\":8976,\"x0\":296,\"y0\":140,\"yoffs\":6,\"xpad\":2,\"w\":7,\"h\":5},{\"c\":8992,\"x0\":390,\"y0\":4,\"yoffs\":2,\"xpad\":1,\"w\":8,\"h\":14},{\"c\":8993,\"x0\":472,\"y0\":4,\"xpad\":4,\"w\":5,\"h\":13},{\"c\":9472,\"x0\":81,\"y0\":158,\"yoffs\":7,\"w\":9,\"h\":1},{\"c\":9474,\"x0\":38,\"y0\":4,\"xpad\":4,\"w\":5,\"h\":16},{\"c\":9484,\"x0\":199,\"y0\":106,\"yoffs\":7,\"w\":9,\"h\":9},{\"c\":9488,\"x0\":217,\"y0\":106,\"yoffs\":7,\"xpad\":4,\"w\":5,\"h\":9},{\"c\":9492,\"x0\":413,\"y0\":106,\"w\":9,\"h\":8},{\"c\":9496,\"x0\":431,\"y0\":104,\"xpad\":4,\"w\":5,\"h\":8},{\"c\":9500,\"x0\":52,\"y0\":4,\"w\":9,\"h\":16},{\"c\":9508,\"x0\":70,\"y0\":4,\"xpad\":4,\"w\":5,\"h\":16},{\"c\":9516,\"x0\":231,\"y0\":106,\"yoffs\":7,\"w\":9,\"h\":9},{\"c\":9524,\"x0\":445,\"y0\":104,\"w\":9,\"h\":8},{\"c\":9532,\"x0\":84,\"y0\":4,\"w\":9,\"h\":16},{\"c\":9552,\"x0\":481,\"y0\":136,\"yoffs\":5,\"w\":9,\"h\":3},{\"c\":9553,\"x0\":102,\"y0\":4,\"xpad\":2,\"w\":7,\"h\":16},{\"c\":9554,\"x0\":4,\"y0\":50,\"yoffs\":5,\"w\":9,\"h\":11},{\"c\":9555,\"x0\":249,\"y0\":106,\"yoffs\":7,\"w\":9,\"h\":9},{\"c\":9556,\"x0\":22,\"y0\":50,\"yoffs\":5,\"w\":9,\"h\":11},{\"c\":9557,\"x0\":40,\"y0\":50,\"yoffs\":5,\"xpad\":4,\"w\":5,\"h\":11},{\"c\":9558,\"x0\":267,\"y0\":106,\"yoffs\":7,\"xpad\":2,\"w\":7,\"h\":9},{\"c\":9559,\"x0\":54,\"y0\":50,\"yoffs\":5,\"xpad\":2,\"w\":7,\"h\":11},{\"c\":9560,\"x0\":463,\"y0\":103,\"w\":9,\"h\":8},{\"c\":9561,\"x0\":481,\"y0\":102,\"w\":9,\"h\":8},{\"c\":9562,\"x0\":4,\"y0\":126,\"w\":9,\"h\":8},{\"c\":9563,\"x0\":22,\"y0\":126,\"xpad\":4,\"w\":5,\"h\":8},{\"c\":9564,\"x0\":36,\"y0\":126,\"xpad\":2,\"w\":7,\"h\":8},{\"c\":9565,\"x0\":52,\"y0\":126,\"xpad\":2,\"w\":7,\"h\":8},{\"c\":9566,\"x0\":118,\"y0\":4,\"w\":9,\"h\":16},{\"c\":9567,\"x0\":136,\"y0\":4,\"w\":9,\"h\":16},{\"c\":9568,\"x0\":154,\"y0\":4,\"w\":9,\"h\":16},{\"c\":9569,\"x0\":172,\"y0\":4,\"xpad\":4,\"w\":5,\"h\":16},{\"c\":9570,\"x0\":186,\"y0\":4,\"xpad\":2,\"w\":7,\"h\":16},{\"c\":9571,\"x0\":202,\"y0\":4,\"xpad\":2,\"w\":7,\"h\":16},{\"c\":9572,\"x0\":70,\"y0\":50,\"yoffs\":5,\"w\":9,\"h\":11},{\"c\":9573,\"x0\":283,\"y0\":106,\"yoffs\":7,\"w\":9,\"h\":9},{\"c\":9574,\"x0\":88,\"y0\":50,\"yoffs\":5,\"w\":9,\"h\":11},{\"c\":9575,\"x0\":99,\"y0\":143,\"yoffs\":2,\"w\":9,\"h\":6},{\"c\":9576,\"x0\":68,\"y0\":126,\"w\":9,\"h\":8},{\"c\":9577,\"x0\":86,\"y0\":126,\"w\":9,\"h\":8},{\"c\":9578,\"x0\":218,\"y0\":4,\"w\":9,\"h\":16},{\"c\":9579,\"x0\":236,\"y0\":4,\"w\":9,\"h\":16},{\"c\":9580,\"x0\":254,\"y0\":4,\"w\":9,\"h\":16},{\"c\":9600,\"x0\":485,\"y0\":119,\"w\":9,\"h\":7},{\"c\":9604,\"x0\":301,\"y0\":106,\"yoffs\":7,\"w\":9,\"h\":9},{\"c\":9608,\"x0\":272,\"y0\":4,\"w\":9,\"h\":16},{\"c\":9612,\"x0\":290,\"y0\":4,\"xpad\":5,\"w\":4,\"h\":16},{\"c\":9616,\"x0\":303,\"y0\":4,\"w\":9,\"h\":16},{\"c\":9617,\"x0\":321,\"y0\":4,\"xpad\":1,\"w\":8,\"h\":16},{\"c\":9618,\"x0\":338,\"y0\":4,\"xpad\":1,\"w\":9,\"h\":16},{\"c\":9619,\"x0\":356,\"y0\":4,\"xpad\":1,\"w\":9,\"h\":16},{\"c\":9632,\"x0\":4,\"y0\":143,\"yoffs\":4,\"xpad\":2,\"w\":7,\"h\":7},{\"c\":9654,\"x0\":104,\"y0\":126,\"yoffs\":4,\"xpad\":1,\"w\":6,\"h\":8},{\"c\":9660,\"x0\":449,\"y0\":137,\"yoffs\":6,\"xpad\":1,\"w\":8,\"h\":4},{\"c\":65533,\"x0\":462,\"y0\":84,\"yoffs\":3,\"xpad\":1,\"w\":8,\"h\":10}]}","/*eslint global-require:off, @typescript-eslint/no-use-before-define:[\"error\", { \"functions\": false }]*/\n// eslint-disable-next-line import/order\nconst local_storage = require('glov/client/local_storage.js');\nlocal_storage.setStoragePrefix('glovjs-playground'); // Before requiring anything else that might load from this\n\nimport * as fs from 'fs';\nimport * as engine from 'glov/client/engine.js';\nimport * as input from 'glov/client/input.js';\nconst { floor, random, min } = Math;\nimport * as net from 'glov/client/net.js';\nimport { ansi, padRight, terminalCreate } from 'glov/client/terminal.js';\nimport { terminalSettingsInit, terminalSettingsShow } from 'glov/client/terminal_settings.js';\nimport * as ui from 'glov/client/ui.js';\n\n\nwindow.Z = window.Z || {};\nZ.BACKGROUND = 1;\nZ.SPRITES = 10;\nZ.PARTICLES = 20;\nZ.UI_TEST = 200;\n\n// let app = exports;\n// Virtual viewport for our game logic\nconst game_width = 720;\nconst game_height = 400;\n\nlet ansi_files = [\n  fs.readFileSync(`${__dirname}/ans/data0.ans`, 'binary'),\n  fs.readFileSync(`${__dirname}/ans/data5.ans`, 'binary'),\n  fs.readFileSync(`${__dirname}/ans/data1.ans`, 'binary'),\n  fs.readFileSync(`${__dirname}/ans/data4.ans`, 'binary'),\n  fs.readFileSync(`${__dirname}/ans/data2.ans`, 'binary'),\n  fs.readFileSync(`${__dirname}/ans/data6.ans`, 'binary'),\n  fs.readFileSync(`${__dirname}/ans/data7.ans`, 'binary'),\n  fs.readFileSync(`${__dirname}/ans/data3.ans`, 'binary'),\n  fs.readFileSync(`${__dirname}/ans/data8.ans`, 'binary'),\n  fs.readFileSync(`${__dirname}/ans/animated.ans`, 'binary'),\n];\n\nexport function main() {\n  if (engine.DEBUG) {\n    // Enable auto-reload, etc\n    net.init({ engine });\n  }\n\n  if (!engine.startup({\n    game_width,\n    game_height,\n    pixely: 'strict',\n    viewport_postprocess: true,\n    font: {\n      info: require('./img/font/vga_16x1.json'),\n      texture: 'font/vga_16x1',\n    },\n    pixel_aspect: (640/480) / (720 / 400),\n    show_fps: false,\n  })) {\n    return;\n  }\n\n  const terminal = terminalCreate({\n    z: Z.BACKGROUND + 1,\n  });\n  // const font = engine.font;\n\n  // Perfect sizes for pixely modes\n  ui.scaleSizes(13 / 32);\n  ui.setFontHeight(16);\n\n  // Cache KEYS\n  const KEYS = input.KEYS;\n\n  let auto_advance = true;\n  let term_idx = 0;\n  let terminal_countdown = 0;\n\n  function ansiArt(dt) {\n    if (input.keyDownEdge(KEYS.ESCAPE)) {\n      engine.setState(menuInit);\n    }\n    if (input.keyDownEdge(KEYS.LEFT)) {\n      auto_advance = false;\n      terminal_countdown = 0;\n      term_idx--;\n    }\n    if (input.keyDownEdge(KEYS.RIGHT)) {\n      auto_advance = false;\n      terminal_countdown = 0;\n      term_idx++;\n    }\n    let baud_save = terminal.baud;\n    terminal.baud = (input.keyDown(KEYS.SPACE) || input.keyDown(KEYS.ESCAPE)) ? Infinity : baud_save;\n    if (!terminal_countdown || dt >= terminal_countdown) {\n      if (term_idx === undefined) {\n        term_idx = 0;\n      }\n      if (auto_advance) {\n        term_idx = min((term_idx || 0), ansi_files.length) + 1;\n      }\n      if (term_idx > ansi_files.length || term_idx <= 0) {\n        // random fill\n        if (!ansiArt.terminal_inited) {\n          ansiArt.terminal_inited = true;\n          // randomish fill\n          terminal.autoScroll(false);\n          terminal.moveto(0,0);\n          function getch(ii, jj) { //eslint-disable-line no-inner-declarations\n            return 176 + floor(random() * (224-176));\n            // return 32 + ((ii * 7 + jj) % (255 - 32));\n          }\n          for (let ii = 0; ii < 25; ++ii) {\n            let str = [ii === 0 ? '' : ii === 24 ? '' : '']; // \n            for (let jj = 1; jj < 79; ++jj) {\n              if (ii === 0) {\n                str.push('');\n              } else if (ii === 24) {\n                str.push('');\n              } else {\n                str.push(getch(ii, jj));\n              }\n            }\n            str.push(ii === 0 ? '' : ii === 24 ? '' : '');\n            terminal.print({ x: 0, y: ii, text: str, fg: 8, bg: 0 });\n          }\n          terminal.moveto(0, 0);\n        }\n\n        terminal.color(floor(random() * 16), floor(random() * 8));\n        let x = 1 + floor(random() * 78);\n        let y = 1 + floor(random() * 23);\n        terminal.fill({\n          x,\n          y,\n          w: min(79 - x, 1 + floor(random() * 10)),\n          h: min(24 - y, 1 + floor(random() * 8)),\n          ch: 32 + floor(random() * (255 - 32)),\n        });\n        terminal_countdown = 100;\n      } else {\n        // scroll through ansi files\n        terminal.color(7,0);\n        terminal.clear();\n        let data = ansi_files[term_idx - 1];\n        terminal.print({ x: 0, y: 0, text: data });\n        terminal_countdown = auto_advance ? 1500 : 1000000000;\n      }\n    } else {\n      terminal_countdown -= dt;\n    }\n\n    terminal.render();\n    terminal.baud = baud_save;\n  }\n\n  let rpgdata;\n  const RPG_BODY_W = 60-2;\n  const RPG_STATUS_W = 20-2;\n  const RPG_STATUS_H = 3;\n  const RPG_STATUS_X = RPG_BODY_W + 2;\n  let rpgsubview;\n  function rpgText(text) {\n    terminal.subViewPush(rpgsubview);\n    terminal.print({\n      text: text,\n    });\n    terminal.subViewPop();\n  }\n  const RPG_STATES = {\n    town: {\n      enter: function () {\n        rpgText('You stand in the town square, ready for adventure!  Or,\\r\\nperhaps, a break.\\r\\n');\n      },\n      menu: {\n        '[1] Visit the Inn': 'inn',\n        '[2] Fight a Monster': 'fight',\n      },\n    },\n    inn: {\n      enter: function () {\n        rpgText('You rest, and are healed.\\r\\n\\r\\n');\n        rpgdata.hp = rpgdata.maxhp;\n        rpgState('town');\n      },\n    },\n    fight: {\n      enter: function () {\n        rpgText('You head into the forest to fight...\\r\\n');\n        let damage = floor(random() * random() * 50);\n        if (damage) {\n          rpgText(`You take ${ansi.red(damage)} damage.\\r\\n`);\n          rpgdata.hp -= damage;\n        } else {\n          rpgText('You escape unscathed.\\r\\n');\n        }\n        let gp = floor(random() * 20);\n        rpgText(`You find ${ansi.yellow.bright(gp)} GP.\\r\\n`);\n        rpgdata.gp += gp;\n        rpgText('\\r\\n');\n        rpgState('town');\n      },\n    },\n  };\n  function rpgState(state) {\n    let st = RPG_STATES[state];\n    rpgdata.state = state;\n\n    st.enter();\n    if (rpgdata.state !== state) {\n      // already left\n      return;\n    }\n    terminal.subViewPush(rpgsubview);\n    if (st.menu) {\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      for (let key in st.menu) {\n        terminal.print({ text: '\\n' });\n      }\n      terminal.print({ text: '> ' });\n    }\n\n    terminal.subViewPop();\n    rpgdata.menu_cursor_x = rpgsubview.cursor_x;\n    rpgdata.menu_cursor_y = rpgsubview.cursor_y;\n    rpgdata.menu_x = rpgsubview.x;\n    rpgdata.menu_y = rpgsubview.cursor_y - Object.keys(st.menu).length;\n  }\n  function rpgInit() {\n    rpgdata = {\n      hp: 100,\n      maxhp: 100,\n      gp: 0,\n    };\n    rpgsubview = {\n      x: 1, y: 1, w: RPG_BODY_W, h: 23,\n      cursor_x: 1, cursor_y: 1,\n    };\n    terminal.color(7,0);\n    terminal.clear();\n\n    terminal.color(4,0);\n    terminal.cells({\n      x: 0, y: 0, ws: [RPG_BODY_W], hs: [23], charset: 1,\n      header: ' THE RPG ',\n    });\n    terminal.color(2,0);\n    terminal.cells({\n      x: RPG_STATUS_X, y: 0, ws: [RPG_STATUS_W], hs: [RPG_STATUS_H], charset: 0,\n      header: ' Status ',\n    });\n    terminal.color(7,0);\n    rpgState('town');\n  }\n  function rpg(dt) {\n\n    function drawStatus() {\n      let health_percent = rpgdata.hp / rpgdata.maxhp;\n      let health_color = health_percent < 0.5 ? 'red' : 'green';\n      terminal.print({\n        x: RPG_STATUS_X + 2,\n        y: 1,\n        fg: 2,\n        text: padRight(`HP: ${ansi[health_color].bright(`${rpgdata.hp} / ${rpgdata.maxhp}`)}  `, RPG_STATUS_W - 2),\n      });\n      terminal.print({\n        x: RPG_STATUS_X + 2,\n        y: 2,\n        fg: 2,\n        text: padRight(`GP: ${ansi.yellow.bright(rpgdata.gp)}  `, RPG_STATUS_W - 2),\n      });\n    }\n\n    drawStatus();\n\n    let st = RPG_STATES[rpgdata.state];\n    if (st && st.menu) {\n      if (!st.menu_keys) {\n        st.menu_keys = Object.keys(st.menu);\n      }\n      let ret = terminal.menu({\n        pre_sel: '  ',\n        pre_unsel: '   ',\n        x: rpgdata.menu_x,\n        y: rpgdata.menu_y,\n        items: st.menu_keys,\n      });\n      terminal.moveto(rpgdata.menu_cursor_x, rpgdata.menu_cursor_y);\n      if (ret !== -1) {\n        rpgText(`${st.menu_keys[ret]}\\r\\n`);\n        // TODO: transition to new state\n        rpgState(st.menu[st.menu_keys[ret]]);\n      }\n    }\n\n    terminal.render();\n  }\n\n  const MENU_W = 20;\n  const MENU_X = (80 - MENU_W) / 2;\n  const MENU_Y = 5;\n  function menu(dt) {\n    let sel = terminal.menu({\n      x: MENU_X,\n      y: 5,\n      items: [\n        'ANSI Art ',\n        'An RPG ',\n        `${ansi.yellow.bright('[O]')}ptions `,\n      ],\n    });\n\n    switch (sel) { // eslint-disable-line default-case\n      case 0:\n        engine.setState(ansiArt);\n        break;\n      case 1:\n        rpgInit();\n        engine.setState(rpg);\n        break;\n      case 2:\n        terminalSettingsShow();\n        break;\n    }\n\n    terminal.render();\n  }\n\n  function menuInit(dt) {\n    terminal.baud = 9600;\n    terminal.color(7,0);\n    terminal.clear();\n    terminalSettingsInit(terminal);\n\n    terminal.cells({\n      x: MENU_X - 2, y: MENU_Y - 1, ws: [MENU_W], hs: [3], charset: 2,\n      header: ' MENU ',\n    });\n\n    engine.setState(menu);\n    menu(dt);\n  }\n\n  engine.setState(menuInit);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// Things that should be done before requiring or running any user-level code or other engine code\n\nrequire('./polyfill.js');\n\nlet debug = document.getElementById('debug');\nwindow.onerror = function (e, file, line, col, errorobj) {\n  let msg = String(e);\n  if (msg === '[object Object]') {\n    try {\n      msg = JSON.stringify(e);\n    } catch (ignored) {\n      // ignored\n    }\n    msg = msg.slice(0, 600); // Not too huge\n  }\n  if (file || line > 0 || col > 0) {\n    msg += `\\n  at ${file}(${line}:${col})`;\n  }\n  if (errorobj && errorobj.stack) {\n    msg = `${errorobj.stack}`;\n    if (errorobj.message) {\n      if (msg.indexOf(errorobj.message) === -1) {\n        msg = `${errorobj.message}\\n${msg}`;\n      }\n    }\n    let origin = document.location.origin || '';\n    if (origin) {\n      if (origin.slice(-1) !== '/') {\n        origin += '/';\n      }\n      msg = msg.split(origin).join(''); // replace\n    }\n    // fixup weird Firefox weirdness\n    msg = msg.replace(/\\[\\d+\\]<\\/?/g, '') // remove funny [123]/ at start of stack lines\n      .replace(/\\/</g, '') // remove funny /<s, they mess up people's copy and paste, look funny\n      .replace(/<?\\/<?/g, '/') // remove funny </s, they mess up people's copy and paste\n      .replace(/\\n\\//g, '\\n') // remove preceding slashes, not sure where those come from\n      .replace(/\\n([^ ])/g, '\\n  $1'); // add indentation if missing\n  }\n  if (msg.indexOf('Error:') === -1) {\n    msg = `Error: ${msg}`;\n  }\n  if (errorobj && errorobj.type) {\n    if (errorobj.type === 'unhandledrejection') {\n      msg = `Uncaught (in promise) ${msg}`;\n    }\n  }\n  let show = true;\n  if (window.glov_error_report) {\n    show = window.glov_error_report(msg, file, line, col);\n  }\n  if (show) {\n    debug.innerText = `${msg}\\n\\nPlease report this error to the developer,` +\n      ' and then reload this page or restart the app.';\n  }\n};\nwindow.addEventListener('unhandledrejection', function (event) {\n  let errorobj = event.reason;\n  if (!errorobj) {\n    // Can't possibly get anything useful from this? `reject()` causes this, though, still useful to know?\n    return;\n  }\n  if (!errorobj || typeof errorobj !== 'object') {\n    errorobj = { stack: errorobj };\n  }\n  errorobj.type = event.type;\n  window.onerror(event.reason, undefined, 0, 0, errorobj);\n});\nwindow.debugmsg = function (msg, clear) {\n  if (clear) {\n    debug.innerText = msg;\n  } else {\n    debug.innerText += `${msg}\\n`;\n  }\n};\n\n// Placeholder profiler functions (in case shared/startup code calls them) until\n//   profiler is initialized/enabled.\n// eslint-disable-next-line @typescript-eslint/no-empty-function, func-name-matching\nwindow.profilerStart = window.profilerStop = window.profilerStopStart = function nop() {};\n","let ua = window.navigator.userAgent;\nexport let is_mac_osx = ua.match(/Mac OS X/);\nexport let is_ios = !window.MSStream && ua.match(/iPad|iPhone|iPod/);\nexport let is_windows_phone = ua.match(/windows phone/i);\nexport let is_android = !is_windows_phone && ua.match(/android/i);\nexport let is_webkit = ua.match(/WebKit/i);\nexport let is_ios_safari = is_ios && is_webkit && !ua.match(/CriOS/i);\nexport let is_firefox = ua.match(/Firefox/i);\n\nexport let is_discrete_gpu = false;\n\nfunction init() {\n  try {\n    let canvas = document.createElement('canvas');\n    canvas.width = 4;\n    canvas.height = 4;\n    let gltest = canvas.getContext('webgl');\n    if (gltest) {\n      let debug_info = gltest.getExtension('WEBGL_debug_renderer_info');\n      if (debug_info) {\n        let renderer_unmasked = gltest.getParameter(debug_info.UNMASKED_RENDERER_WEBGL);\n        is_discrete_gpu = Boolean(renderer_unmasked && renderer_unmasked.match(/nvidia|radeon/i));\n      }\n    }\n  } catch (e) {\n    // ignored\n  }\n}\ninit();\n","/* eslint-disable import/order */\nconst camera2d = require('./camera2d.js');\nconst engine = require('./engine.js');\nconst glov_font = require('./font.js');\nconst { min } = Math;\nconst { scrollAreaCreate } = require('./scroll_area.js');\nconst ui = require('./ui.js');\nconst net = require('./net.js');\nconst { plural } = require('glov/common/util.js');\nconst { vec4 } = require('glov/common/vmath.js');\n\nlet gbstate;\nlet server_error;\n\nZ.BUILD_ERRORS = Z.BUILD_ERRORS || 9900;\n\nfunction onGBState(state) {\n  gbstate = state;\n}\n\nfunction onServerError(err) {\n  server_error = err;\n}\n\nconst PAD = 4;\nconst color_panel = vec4(0,0,0,1);\nconst style_title = glov_font.styleColored(null, 0xFF2020ff);\nconst style = glov_font.styleColored(null, 0xDDDDDDff);\nconst style_task = glov_font.styleColored(null, 0x00DDDDff);\nconst style_job = glov_font.styleColored(null, 0x2020FFff);\nconst color_line = vec4(1,1,1,1);\n// eslint-disable-next-line no-control-regex\nconst strip_ansi = /\\u001b\\[(?:[0-9;]*)[0-9A-ORZcf-nqry=><]/g;\nlet scroll_area;\nfunction buildUITick() {\n  if (!gbstate && !server_error) {\n    return;\n  }\n  const x0 = camera2d.x0() + PAD;\n  const y0 = camera2d.y0() + PAD;\n  let z = Z.BUILD_ERRORS;\n  const w = camera2d.w() * 0.75;\n  const { font, title_font, font_height } = ui;\n  let x = x0;\n  let y = y0;\n\n  let error_count = (gbstate?.error_count || 0) + (server_error ? 1 : 0);\n  let warning_count = gbstate?.warning_count || 0;\n  title_font.drawSizedAligned(style_title, x, y, z, font_height, font.ALIGN.HCENTERFIT, w, 0,\n    `${error_count} ${plural(error_count, 'error')}, ` +\n    `${warning_count} ${plural(warning_count, 'warning')}`);\n  y += font_height + 1;\n  ui.drawLine(x0 + w * 0.3, y, x0 + w * 0.7, y, z, 0.5, true, color_line);\n  y += PAD;\n\n  if (!scroll_area) {\n    scroll_area = scrollAreaCreate({\n      z,\n      background_color: null,\n      auto_hide: true,\n    });\n  }\n\n  const max_h = camera2d.y1() - PAD - y;\n  let scroll_y_start = y;\n  scroll_area.begin({\n    x, y, w, h: max_h,\n  });\n  const sub_w = w - PAD - scroll_area.barWidth();\n  y = 0;\n  z = Z.UI;\n\n  function printLine(type, str) {\n    str = str.replace(strip_ansi, '');\n    y += font.drawSizedWrapped(style, x, y, z, sub_w, 0, font_height,\n      `${type}: ${str}`);\n  }\n\n  if (gbstate) {\n    for (let task_name in gbstate.tasks) {\n      let task = gbstate.tasks[task_name];\n      x = 0;\n      font.drawSizedAligned(style_task, x, y, z, font_height, font.ALIGN.HLEFT, sub_w, 0,\n        `${task_name}:`);\n      y += font_height;\n      x += font_height;\n      let printed_any = false;\n      for (let job_name in task.jobs) {\n        let job = task.jobs[job_name];\n        let { warnings, errors } = job;\n        if (job_name !== 'all') {\n          if (job_name.startsWith('source:')) {\n            job_name = job_name.slice(7);\n          }\n          y += font.drawSizedWrapped(style_job, x, y, z, sub_w, 0, font_height,\n            job_name);\n        }\n        if (warnings) {\n          for (let ii = 0; ii < warnings.length; ++ii) {\n            printLine('Warning', warnings[ii]);\n            printed_any = true;\n          }\n        }\n        if (errors) {\n          for (let ii = 0; ii < errors.length; ++ii) {\n            printLine('Error', errors[ii]);\n            printed_any = true;\n          }\n        }\n      }\n      if (!printed_any && task.err) {\n        printLine('Error', task.err);\n      }\n      y += PAD;\n    }\n  }\n\n  if (server_error) {\n    x = 0;\n    font.drawSizedAligned(style_task, x, y, z, font_height, font.ALIGN.HLEFT, sub_w, 0,\n      'Server Error:');\n    y += font_height;\n    x += font_height;\n    printLine('Server error', server_error);\n  }\n\n  scroll_area.end(y);\n  y = scroll_y_start + min(max_h, y);\n\n  if (ui.buttonText({\n    x: x0 + w - ui.button_height,\n    y: y0, z: Z.BUILD_ERRORS + 1,\n    w: ui.button_height,\n    text: 'X',\n  })) {\n    gbstate = null;\n    server_error = null;\n  }\n\n  ui.panel({\n    x: x0 - PAD, y: y0 - PAD, z: Z.BUILD_ERRORS - 1,\n    w: w + PAD * 2, h: y - y0 + PAD * 2,\n    color: color_panel,\n  });\n\n}\n\nexport function buildUIStartup() {\n  if (net.client && engine.DEBUG) {\n    net.client.onMsg('gbstate', onGBState);\n    net.client.onMsg('server_error', onServerError);\n    net.subs.on('connect', function () {\n      let pak = net.client.pak('gbstate_enable');\n      pak.writeBool(true);\n      pak.send();\n    });\n    engine.addTickFunc(buildUITick);\n  }\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint @typescript-eslint/no-shadow:off */\n\nconst assert = require('assert');\nconst engine = require('./engine.js');\n\nconst { max, round } = Math;\n\nconst safearea_pad = new Float32Array(4); // left, right, top, bottom\n// 0: x0_real\n// 1: y0_real\n// 2: x1_real\n// 3: y1_real\n// 4: x_scale\n// 5: y_scale\n// 6: dom_to_canvas_ratio\n// 7: inverse viewport x_scale\n// 8: inverse viewport y_scale\n// 9: x0\n// 10: y0\n// 11: x1\n// 12: y1\nexport const data = new Float32Array(13);\n\nlet screen_width;\nlet screen_height;\n// Note: render_* not used by FRVR at this time\nlet render_width;\nlet render_height;\nexport let render_viewport_w;\nexport let render_viewport_h;\nexport let render_offset_x;\nlet render_offset_y_top;\nexport let render_offset_y_bottom;\n\nfunction reapply() {\n  if (render_width) {\n    data[4] = render_width / (data[2] - data[0]);\n    data[5] = render_height / (data[3] - data[1]);\n    data[7] = (data[2] - data[0]) / render_viewport_w;\n    data[8] = (data[3] - data[1]) / render_viewport_h;\n  } else {\n    data[4] = screen_width / (data[2] - data[0]);\n    data[5] = screen_height / (data[3] - data[1]);\n  }\n}\n\n// To get to coordinates used by OpenGL / canvas\nexport function virtualToCanvas(dst, src) {\n  dst[0] = (src[0] - data[0]) * data[4];\n  dst[1] = (src[1] - data[1]) * data[5];\n}\nexport function transformX(x) {\n  return (x - data[0]) * data[4];\n}\nexport function transformY(y) {\n  return (y - data[1]) * data[5];\n}\n\nexport function canvasToVirtual(dst, src) {\n  dst[0] = src[0] / data[4] + data[0];\n  dst[1] = src[1] / data[5] + data[1];\n}\n\nfunction safeScreenWidth() {\n  return max(1, screen_width - safearea_pad[0] - safearea_pad[1]);\n}\n\nfunction safeScreenHeight() {\n  return max(1, screen_height - safearea_pad[2] - safearea_pad[3]);\n}\n\n// Sets the 2D \"camera\" used to translate sprite positions to screen space.  Affects sprites queued\n//  after this call\nexport function set(x0, y0, x1, y1, ignore_safe_area) {\n  assert(isFinite(x0));\n  assert(isFinite(y0));\n  assert(isFinite(x1));\n  assert(isFinite(y1));\n  if (ignore_safe_area || render_width) {\n    data[9] = data[0] = x0;\n    data[10] = data[1] = y0;\n    data[11] = data[2] = x1;\n    data[12] = data[3] = y1;\n  } else {\n    data[9] = x0;\n    data[10] = y0;\n    data[11] = x1;\n    data[12] = y1;\n    let wscale = (x1 - x0) / safeScreenWidth();\n    let hscale = (y1 - y0) / safeScreenHeight();\n    data[0] = x0 - safearea_pad[0] * wscale;\n    data[1] = y0 - safearea_pad[2] * hscale;\n    data[2] = x1 + safearea_pad[1] * wscale;\n    data[3] = y1 + safearea_pad[3] * hscale;\n  }\n\n  reapply();\n}\n\nexport function setSafeAreaPadding(left, right, top, bottom) {\n  safearea_pad[0] = round(left);\n  safearea_pad[1] = round(right);\n  safearea_pad[2] = round(top);\n  safearea_pad[3] = round(bottom);\n  // Called while updating screen width/height, reapply() should get called later\n}\n\nexport function safeAreaPadding() {\n  return safearea_pad;\n}\n\nconst stack = [];\nexport function push() {\n  stack.push(data.slice(0));\n}\nexport function pop() {\n  let old = stack.pop();\n  for (let ii = 0; ii < old.length; ++ii) {\n    data[ii] = old[ii];\n  }\n  reapply();\n}\n\nexport function domToCanvasRatio() {\n  return data[6];\n}\n\nexport function screenAspect() {\n  return safeScreenWidth() /\n    safeScreenHeight();\n}\n\n// Drawing area 0,0-w,h\n// But keep the aspect ratio of those things drawn to be correct\n// This may create a padding or margin on either top and bottom or sides of the screen\n// User should use constant values in this range for consistent UI on all devices\nexport function setAspectFixed(w, h) {\n  let pa = render_width ? 1 : engine.pixel_aspect;\n  let inv_aspect = h / pa / w;\n  let inv_desired_aspect;\n  let screen_w;\n  let screen_h;\n  if (render_width) {\n    screen_w = render_width;\n    screen_h = render_height;\n  } else {\n    screen_w = safeScreenWidth();\n    screen_h = safeScreenHeight();\n  }\n  inv_desired_aspect = screen_h / screen_w;\n  // ensure the left/top margin is integer screen pixels\n  // Note: the margin is, however, not integer virtual pixels, so anything\n  //   using an `integral` font and camera2d.x0()/etc will have artifacts\n  if (inv_aspect > inv_desired_aspect) {\n    let virtual_w = h / pa / inv_desired_aspect;\n    let virtual_to_screen = screen_w / virtual_w;\n    let margin = virtual_w - w;\n    let left_margin_screen_px = round(margin * virtual_to_screen / 2);\n    let left_margin = left_margin_screen_px / virtual_to_screen;\n    let right_margin = margin - left_margin;\n    set(-left_margin, 0, w + right_margin, h, false);\n  } else {\n    let virtual_h = w * pa * inv_desired_aspect;\n    let virtual_to_screen = screen_h / virtual_h;\n    let margin = virtual_h - h;\n    let top_margin_screen_px = round(margin * virtual_to_screen / 2);\n    let top_margin = top_margin_screen_px / virtual_to_screen;\n    let bot_margin = margin - top_margin;\n    set(0, -top_margin, w, h + bot_margin, false);\n  }\n}\n\n// Primary drawing area at least W x H\n// But keep the aspect ratio of those things drawn to be correct\n// Similar to setAspectFixed() but keeps (0,0) in the upper left (all padding\n//   is added to right and bottom)\n// Requires users to use camera2d.w()/ and camera2d.h() to determine reasonable\n//   UI positioning\nexport function setAspectFixed2(w, h) {\n  let pa = render_width ? 1 : engine.pixel_aspect;\n  let inv_aspect = h / pa / w;\n  let inv_desired_aspect;\n  if (render_width) {\n    inv_desired_aspect = render_height / render_width;\n  } else {\n    inv_desired_aspect = 1 / screenAspect();\n  }\n  if (inv_aspect > inv_desired_aspect) {\n    let margin = (h / pa / inv_desired_aspect - w);\n    set(0, 0, w + margin, h, false);\n  } else {\n    let margin = (w * pa * inv_desired_aspect - h);\n    set(0, 0, w, h + margin, false);\n  }\n}\n\nexport function zoom(x, y, factor) {\n  let inv_factor = 1.0 / factor;\n  set(\n    x - (x - data[0]) * inv_factor,\n    y - (y - data[1]) * inv_factor,\n    x + (data[2] - x) * inv_factor,\n    y + (data[3] - y) * inv_factor, true);\n}\n\nexport function shift(dx, dy) {\n  set(data[0] + dx, data[1] + dy, data[2] + dx, data[3] + dy, true);\n}\n\n// returns [x0,y0,x1,y1] to use as parameters set() such that src_rect in the\n// current view is now addressable by dest_rect (presumably something like\n// [0,0,vw,vh])\nexport function calcMap(out, src_rect, dest_rect) {\n  let cur_w = data[11] - data[9];\n  let cur_h = data[12] - data[10];\n  let vx0 = (src_rect[0] - data[9]) / cur_w;\n  let vy0 = (src_rect[1] - data[10]) / cur_h;\n  let vx1 = (src_rect[2] - data[9]) / cur_w;\n  let vy1 = (src_rect[3] - data[10]) / cur_h;\n  let vw = vx1 - vx0;\n  let vh = vy1 - vy0;\n  let dest_vw = dest_rect[2] - dest_rect[0];\n  let dest_vh = dest_rect[3] - dest_rect[1];\n  out[0] = dest_rect[0] - dest_vw / vw * vx0;\n  out[1] = dest_rect[1] - dest_vh / vh * vy0;\n  out[2] = dest_rect[2] + dest_vw / vw * (1 - vx1);\n  out[3] = dest_rect[3] + dest_vh / vh * (1 - vy1);\n  return out;\n}\n\nexport function setNormalized() {\n  set(0, 0, 1, 1, true);\n}\n\n// Sets virtual viewport equal to (DPI-aware) screen pixels\n//   (generally a bad idea, will not scale well without lots of app work)\nexport function setScreen(no_dpi_aware) {\n  if (render_width) {\n    set(0, 0, render_width, render_height);\n  } else if (no_dpi_aware) {\n    set(0, 0, safeScreenWidth(), safeScreenHeight());\n  } else {\n    set(0, 0, safeScreenWidth() / engine.dom_to_canvas_ratio, safeScreenHeight() / engine.dom_to_canvas_ratio);\n  }\n}\n\n// Sets virtual viewport equal to DOM coordinates, for debugging input events/etc\nexport function setDOMMapped() {\n  if (render_width) {\n    set(render_offset_x, render_offset_y_top,\n      screen_width - render_offset_x, screen_height - render_offset_y_top, true);\n  } else {\n    set(0, 0, screen_width / engine.dom_to_canvas_ratio, screen_height / engine.dom_to_canvas_ratio, true);\n  }\n}\n\nexport function x0Real() {\n  return data[0];\n}\nexport function y0Real() {\n  return data[1];\n}\nexport function x1Real() {\n  return data[2];\n}\nexport function y1Real() {\n  return data[3];\n}\nexport function wReal() {\n  return data[2] - data[0];\n}\nexport function hReal() {\n  return data[3] - data[1];\n}\nexport function x0() {\n  return data[9];\n}\nexport function y0() {\n  return data[10];\n}\nexport function x1() {\n  return data[11];\n}\nexport function y1() {\n  return data[12];\n}\nexport function w() {\n  return data[11] - data[9];\n}\nexport function h() {\n  return data[12] - data[10];\n}\nexport function xScale() {\n  return data[4];\n}\nexport function yScale() {\n  return data[5];\n}\n\nexport function htmlPos(x, y) {\n  if (render_width) {\n    return [\n      100 * (((x - data[0]) / data[7] + render_offset_x) / screen_width),\n      100 * (((y - data[1]) / data[8] + render_offset_y_top) / screen_height),\n    ];\n  } else {\n    return [\n      100 * (x - data[0]) / (data[2] - data[0]),\n      100 * (y - data[1]) / (data[3] - data[1]),\n    ];\n  }\n}\nexport function htmlSize(w, h) {\n  if (render_width) {\n    return [\n      100 * w / data[7] / screen_width,\n      100 * h / data[8] / screen_height,\n    ];\n  } else {\n    return [100 * w / (data[2] - data[0]), 100 * h / (data[3] - data[1])];\n  }\n}\n\nlet input_clipping;\nexport function setInputClipping(xywh) {\n  input_clipping = xywh;\n}\n\nexport function domToVirtual(dst, src) {\n  let ret = true;\n  if (input_clipping) {\n    if (src[0] < input_clipping[0] || src[0] > input_clipping[0] + input_clipping[2] ||\n      src[1] < input_clipping[1] || src[1] > input_clipping[1] + input_clipping[3]\n    ) {\n      ret = false;\n    }\n  }\n  if (render_width) {\n    dst[0] = (src[0] * data[6] - render_offset_x) * data[7] + data[0];\n    dst[1] = (src[1] * data[6] - render_offset_y_top) * data[8] + data[1];\n  } else {\n    dst[0] = src[0] * data[6] / data[4] + data[0];\n    dst[1] = src[1] * data[6] / data[5] + data[1];\n  }\n  return ret;\n}\n\nexport function domDeltaToVirtual(dst, src) {\n  if (render_width) {\n    dst[0] = src[0] * data[6] * data[7];\n    dst[1] = src[1] * data[6] * data[8];\n  } else {\n    dst[0] = src[0] * data[6] / data[4];\n    dst[1] = src[1] * data[6] / data[5];\n  }\n}\n\nlet input_clipping_virtual = new Float32Array(4);\nfunction updateVirtualInputClipping() {\n  domToVirtual(input_clipping_virtual, input_clipping);\n  //domDeltaToVirtual(input_clipping_virtual.slice(2), input_clipping.slice(2)) :\n  if (render_width) {\n    input_clipping_virtual[2] = input_clipping[2] * data[6] * data[7];\n    input_clipping_virtual[3] = input_clipping[3] * data[6] * data[8];\n  } else {\n    input_clipping_virtual[2] = input_clipping[2] * data[6] / data[4];\n    input_clipping_virtual[3] = input_clipping[3] * data[6] / data[5];\n  }\n}\n\n\n// To get to coordinates used by mouse events\nexport function virtualToDom(dst, src) {\n  if (render_width) {\n    dst[0] = (render_offset_x + (src[0] - data[0]) / data[7]) / data[6];\n    dst[1] = (render_offset_y_top + (src[1] - data[1]) / data[8]) / data[6];\n  } else {\n    dst[0] = (src[0] - data[0]) * data[4] / data[6];\n    dst[1] = (src[1] - data[1]) * data[5] / data[6];\n  }\n}\n\nexport function virtualToFontSize(height) {\n  if (render_width) {\n    return height / (data[6] * data[8]) * 0.84;\n  } else {\n    return height * data[5] / data[6] * 0.84;\n  }\n}\n\n// dst/src are x/y/w/h objects (e.g. from input system)\nexport function virtualToDomPosParam(dst, src) {\n  if (render_width) {\n    dst.x = (render_offset_x + (src.x - data[0]) / data[7]) / data[6];\n    dst.w = src.w / data[7] / data[6];\n    dst.y = (render_offset_y_top + (src.y - data[1]) / data[8]) / data[6];\n    dst.h = src.h / data[8] / data[6];\n  } else {\n    dst.x = (src.x - data[0]) * data[4] / data[6];\n    dst.w = src.w * data[4] / data[6];\n    dst.y = (src.y - data[1]) * data[5] / data[6];\n    dst.h = src.h * data[5] / data[6];\n  }\n  if (input_clipping) {\n    if (dst.x < input_clipping[0]) {\n      dst.w = max(0, dst.w - (input_clipping[0] - dst.x));\n      dst.x = input_clipping[0];\n    }\n    if (dst.y < input_clipping[1]) {\n      dst.h = max(0, dst.h - (input_clipping[1] - dst.y));\n      dst.y = input_clipping[1];\n    }\n    if (dst.x > input_clipping[0] + input_clipping[2]) {\n      dst.w = 0;\n    }\n    if (dst.y > input_clipping[1] + input_clipping[3]) {\n      dst.h = 0;\n    }\n  }\n}\n\nexport function clipTestRect(rect) {\n  if (!input_clipping) {\n    return true;\n  }\n  updateVirtualInputClipping();\n  let icv = input_clipping_virtual;\n  if (rect.x > icv[0] + icv[2] ||\n    rect.x + rect.w < icv[0] ||\n    rect.y > icv[1] + icv[3] ||\n    rect.y + rect.h < icv[1]\n  ) {\n    // fully clipped\n    return false;\n  }\n  if (rect.x < icv[0]) {\n    rect.w -= icv[0] - rect.x;\n    rect.x = icv[0];\n  }\n  if (rect.y < icv[1]) {\n    rect.h -= icv[1] - rect.y;\n    rect.y = icv[1];\n  }\n  if (rect.x + rect.w > icv[0] + icv[2]) {\n    rect.w = icv[0] + icv[2] - rect.x;\n  }\n  if (rect.y + rect.h > icv[1] + icv[3]) {\n    rect.h = icv[1] + icv[3] - rect.y;\n  }\n  return true;\n}\n\nexport function tickCamera2D() {\n  data[6] = engine.dom_to_canvas_ratio; /* dom_to_canvas_ratio */\n  screen_width = engine.width;\n  screen_height = engine.height;\n  let viewport = [0, 0, screen_width, screen_height];\n  if (engine.render_width) { // Note: render_* not used by FRVR at this time\n    render_width = engine.render_width;\n    render_height = engine.render_height;\n    // Find an offset so this rendered viewport is centered while preserving aspect ratio, just like setAspectFixed\n    let pa = engine.pixel_aspect;\n    let inv_aspect = render_height / pa / render_width;\n    let eff_screen_width = safeScreenWidth();\n    let eff_screen_height = safeScreenHeight();\n    let inv_desired_aspect = eff_screen_height / eff_screen_width;\n    if (inv_aspect > inv_desired_aspect) {\n      let margin = (render_height / inv_desired_aspect - render_width * pa) / 2 *\n        eff_screen_height / render_height;\n      render_offset_x = safearea_pad[0] + round(margin);\n      render_offset_y_top = safearea_pad[2];\n      render_offset_y_bottom = safearea_pad[3];\n      render_viewport_w = round(eff_screen_width - margin * 2);\n      render_viewport_h = eff_screen_height;\n    } else {\n      let margin = (render_width * inv_desired_aspect - render_height / pa) / 2 *\n        eff_screen_width / render_width;\n      render_offset_x = safearea_pad[0];\n      render_offset_y_top = safearea_pad[2] + round(margin);\n      render_offset_y_bottom = safearea_pad[3] + round(margin);\n      render_viewport_w = eff_screen_width;\n      render_viewport_h = round(eff_screen_height - margin * 2);\n    }\n    viewport[2] = render_width;\n    viewport[3] = render_height;\n  } else {\n    render_width = render_height = 0;\n    render_offset_x = 0;\n    render_offset_y_top = 0;\n    render_offset_y_bottom = 0;\n  }\n\n  reapply();\n\n  // let screen_width = engine.width;\n  // let screen_height = engine.height;\n  // let screen_aspect = screen_width / screen_height;\n  // let view_aspect = game_width / game_height;\n  // if (screen_aspect > view_aspect) {\n  //   let viewport_width = game_height * screen_aspect;\n  //   let half_diff = (viewport_width - game_width) / 2;\n  //   viewportRectangle = [-half_diff, 0, game_width + half_diff, game_height];\n  // } else {\n  //   let viewport_height = game_width / screen_aspect;\n  //   let half_diff = (viewport_height - game_height) / 2;\n  //   viewportRectangle = [0, -half_diff, game_width, game_height + half_diff];\n  // }\n\n  engine.setViewport(viewport);\n}\n\nexport function startup() {\n  screen_width = engine.width;\n  screen_height = engine.height;\n  set(0, 0, engine.width, engine.height);\n  tickCamera2D();\n}\n","import assert from 'assert';\nimport { Platform, isValidPlatform } from 'glov/common/enums';\n\n// Platform\nassert(isValidPlatform(window.conf_platform));\nexport const PLATFORM = window.conf_platform as Platform;\nexport const PLATFORM_WEB = PLATFORM === Platform.Web;\nexport const PLATFORM_FBINSTANT = PLATFORM === Platform.FBInstant;\nexport const PLATFORM_ANDROID = PLATFORM === Platform.Android;\nexport const PLATFORM_IOS = PLATFORM === Platform.IOS;\nexport const PLATFORM_MOBILE = PLATFORM_ANDROID || PLATFORM_IOS;\n\nassert(PLATFORM_WEB || PLATFORM_FBINSTANT || PLATFORM_ANDROID || PLATFORM_IOS);\n\n// Type\n// TODO: Allow other platforms to set MODE_DEVELOPMENT through a parameter\nexport const MODE_DEVELOPMENT = (PLATFORM_WEB || PLATFORM_FBINSTANT) &&\n  Boolean(String(document.location).match(/^https?:\\/\\/localhost/));\nexport const MODE_PRODUCTION = !MODE_DEVELOPMENT;\n\nif (MODE_DEVELOPMENT) {\n  assert(PLATFORM_WEB || !window.FB);\n  assert(PLATFORM_FBINSTANT || !window.FBInstant);\n  assert(PLATFORM_ANDROID === Boolean(window.androidwrapper));\n  assert(PLATFORM_IOS === Boolean(window.webkit?.messageHandlers?.iosWrapper));\n}\n\n// Abilities\nlet ability_reload = PLATFORM_WEB;\nexport function getAbilityReload(): boolean {\n  return ability_reload;\n}\nexport function setAbilityReload(value: boolean): void {\n  ability_reload = PLATFORM_WEB && value;\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/* eslint-disable import/order */\nconst cmd_parse_mod = require('glov/common/cmd_parse.js');\nconst local_storage = require('./local_storage.js');\nexport let cmd_parse = cmd_parse_mod.create({ storage: local_storage });\n\nconst engine = require('./engine.js');\nconst { errorReportDetailsString } = require('./error_report.js');\nconst net = require('./net.js');\nconst { netClient, netDisconnected } = net;\nconst shaders = require('./shaders.js');\nconst textures = require('./textures.js');\nconst { netDelayGet, netDelaySet } = require('glov/common/wscommon.js');\n\nwindow.cmd = function (str) {\n  cmd_parse.handle(null, str, cmd_parse_mod.defaultHandler);\n};\n\nfunction byteFormat(bytes) {\n  if (bytes > 850000) {\n    return `${(bytes/(1024*1024)).toFixed(2)}MB`;\n  }\n  if (bytes > 850) {\n    return `${(bytes/1024).toFixed(2)}KB`;\n  }\n  return `${bytes}B`;\n}\n\ncmd_parse.register({\n  cmd: 'texmem',\n  help: 'Displays texture memory usage',\n  func: function (str, resp_func) {\n    let keys = Object.keys(textures.textures);\n    keys = keys.filter((a) => textures.textures[a].gpu_mem > 1024);\n    keys.sort((a, b) => textures.textures[a].gpu_mem - textures.textures[b].gpu_mem);\n    resp_func(null, keys.map((a) => `${byteFormat(textures.textures[a].gpu_mem)} ${a}`).join('\\n'));\n  }\n});\n\ncmd_parse.register({\n  cmd: 'gpumem',\n  help: 'Displays GPU memory usage summary',\n  func: function (str, resp_func) {\n    let { gpu_mem } = engine.perf_state;\n    resp_func(null, `${byteFormat(gpu_mem.geom)} Geo\\n${byteFormat(gpu_mem.tex)} Tex\\n${\n      byteFormat(gpu_mem.geom + gpu_mem.tex)} Total`);\n  }\n});\n\nfunction validDefine(str) {\n  if (shaders.semantic[str]) {\n    return false;\n  }\n  return str.match(/^[A-Z][A-Z0-9_]*$/);\n}\n\ncmd_parse.register({\n  cmd: 'd',\n  help: 'Toggles a debug define',\n  func: function (str, resp_func) {\n    str = str.toUpperCase().trim();\n    if (!str) {\n      if (engine.definesClearAll()) {\n        return void resp_func(null, 'All debug defines cleared');\n      } else {\n        return void resp_func(null, 'No debug defines active');\n      }\n    }\n    if (!validDefine(str)) {\n      return void resp_func('Invalid define specified');\n    }\n    engine.defines[str] = !engine.defines[str];\n    resp_func(null, `D=${str} now ${engine.defines[str]?'SET':'unset'}`);\n    engine.definesChanged();\n  }\n});\n\ncmd_parse.register({\n  cmd: 'renderer',\n  help: 'Displays current renderer',\n  func: function (str, resp_func) {\n    resp_func(null, `Renderer=WebGL${engine.webgl2?2:1}`);\n  }\n});\n\ncmd_parse.register({\n  cmd: 'csr',\n  access_run: ['sysadmin'],\n  help: '(Admin) Run a command as another user',\n  usage: '$HELP\\n  /csr UserID command\\n' +\n    'Example: /csr jimbly gems -100',\n  func: function (str, resp_func) {\n    let idx = str.indexOf(' ');\n    if (idx === -1) {\n      return void resp_func('Invalid number of arguments');\n    }\n    let user_id = str.slice(0, idx);\n    let cmd = str.slice(idx + 1);\n    let pak = net.subs.getChannelImmediate(`user.${user_id}`).pak('csr_admin_to_user');\n    pak.writeJSON(cmd_parse.last_access);\n    pak.writeString(cmd);\n    pak.send(resp_func);\n  }\n});\n\nfunction cmdDesc(cmd_data) {\n  return `/${cmd_data.cmd} - ${cmd_data.help}`;\n}\n\ncmd_parse.register({\n  cmd: 'help',\n  help: 'Searches commands',\n  func: function (str, resp_func) {\n    let list = cmd_parse.autoComplete('', this && this.access);\n    if (str) {\n      let str_cname = cmd_parse.canonical(str);\n      let str_lc = str.toLowerCase();\n      list = list.filter((cmd_data) => cmd_data.cname.indexOf(str_cname) !== -1 ||\n          cmd_data.help.toLowerCase().indexOf(str_lc) !== -1);\n    }\n    if (!list.length) {\n      return void resp_func(null, `No commands found matching \"${str}\"`);\n    }\n    resp_func(null, list.map(cmdDesc).join('\\n'));\n  }\n});\n\nexport let safearea = [-1,-1,-1,-1];\ncmd_parse.registerValue('safe_area', {\n  label: 'Safe Area',\n  type: cmd_parse.TYPE_STRING,\n  usage: 'Safe Area value: Use -1 for auto based on browser environment,\\n' +\n    'or 0-25 for percentage of screen size\\n' +\n    '  Usage: /safe_area [value]\\n' +\n    '  Usage: /safe_area horizontal,vertical\\n' +\n    '  Usage: /safe_area left,right,top,bottom',\n  default_value: '-1',\n  get: () => (safearea[0] === -1 ? '-1 (auto)' : safearea.join(',')),\n  set: (v) => {\n    v = String(v);\n    let keys = v.split(',');\n    if (v && keys.length === 1) {\n      safearea[0] = safearea[1] = safearea[2] = safearea[3] = Number(v);\n    } else if (keys.length === 2) {\n      safearea[0] = safearea[1] = Number(keys[0]);\n      safearea[2] = safearea[3] = Number(keys[1]);\n    } else if (keys.length === 4) {\n      for (let ii = 0; ii < 4; ++ii) {\n        safearea[ii] = Number(keys[ii]);\n      }\n    } else {\n      // error, ignore?\n    }\n    for (let ii = 0; ii < 4; ++ii) {\n      if (!isFinite(safearea[ii])) {\n        safearea[ii] = -1;\n      }\n    }\n  },\n  store: true,\n});\n\ncmd_parse.register({\n  cmd: 'webgl2_auto',\n  help: 'Resets WebGL2 auto-detection',\n  func: function (str, resp_func) {\n    let disable_data = local_storage.getJSON('webgl2_disable');\n    if (!disable_data) {\n      return resp_func(null, 'WebGL2 is already being auto-detected');\n    }\n    local_storage.setJSON('webgl2_disable', undefined);\n    return resp_func(null, 'WebGL2 was disabled, will attempt to use it again on the next load');\n  },\n});\n\ncmd_parse.registerValue('postprocessing', {\n  label: 'Postprocessing',\n  type: cmd_parse.TYPE_INT,\n  help: 'Enables/disables postprocessing',\n  get: () => (engine.postprocessing ? 1 : 0),\n  set: (v) => engine.postprocessingAllow(v),\n});\n\ncmd_parse.register({\n  cmd: 'net_delay',\n  help: 'Sets/shows network delay values',\n  usage: '$HELP\\n/net_delay time_base time_rand',\n  func: function (str, resp_func) {\n    if (str) {\n      let params = str.split(' ');\n      netDelaySet(Number(params[0]), Number(params[1]) || 0);\n    }\n    let cur = netDelayGet();\n    resp_func(null, `Client NetDelay: ${cur[0]}+${cur[1]}`);\n  }\n});\n\ncmd_parse.register({\n  cmd: 'error_report_details',\n  help: 'Shows details submitted with any error report',\n  access_show: ['hidden'],\n  func: function (str, resp_func) {\n    resp_func(null, errorReportDetailsString());\n  },\n});\n\ncmd_parse.register({\n  cmd: 'disconnect',\n  help: 'Forcibly disconnect WebSocket connection (Note: will auto-reconnect)',\n  func: function (str, resp_func) {\n    let socket = netClient()?.socket;\n    if (!socket) {\n      return void resp_func('No socket');\n    }\n    if (netDisconnected()) {\n      return void resp_func('Not connected');\n    }\n    socket.close();\n    resp_func();\n  },\n});\n\nexport function resetSettings() {\n  let results = cmd_parse.resetSettings();\n  if (engine.definesClearAll()) {\n    results.push('Debug defines cleared');\n  }\n  if (!results.length) {\n    return null;\n  }\n  results.push('Please restart the app or reload to page for the new settings to take effect.');\n  return results.join('\\n');\n}\n\ncmd_parse.register({\n  cmd: 'reset_settings',\n  help: 'Resets all settings and options to their defaults (Note: requires an app restart)',\n  func: function (str, resp_func) {\n    resp_func(null, resetSettings() || 'No stored settings to reset');\n  },\n});\n","export const BUCKET_OPAQUE = 1; // sorted by state, depth writes, no blend\nexport const BUCKET_DECAL = 2; // sorted by state, no depth writes, blended\nexport const BUCKET_ALPHA = 3; // sorted by dist, blended\n\nexport const FACE_NONE = 0;\nexport const FACE_XY = 1<<0;\nexport const FACE_XYZ = 1<<1;\nexport const FACE_FRUSTUM = 1<<2;\nexport const FACE_CAMERA = 1<<3;\nexport const FACE_DEFAULT = FACE_XY|FACE_FRUSTUM;\n\n\nconst DYN_VERT_SIZE = 4*3;\n\nconst assert = require('assert');\nconst mat4LookAt = require('gl-mat4/lookAt');\nconst { log2, nextHighestPowerOfTwo } = require('glov/common/util.js');\nconst {\n  mat4,\n  v3addScale,\n  v3copy,\n  v3cross,\n  v3iNormalize,\n  v3scale,\n  v3sub,\n  vec3,\n  zero_vec,\n} = require('glov/common/vmath.js');\nconst engine = require('./engine.js');\nconst { engineStartupFunc, setGlobalMatrices } = engine;\nconst geom = require('./geom.js');\nconst { ceil, max, min } = Math;\nconst shaders = require('./shaders.js');\nconst sprites = require('./sprites.js');\nconst {\n  BLEND_ALPHA,\n  blendModeReset,\n  blendModeSet,\n} = sprites;\nconst textures = require('./textures.js');\nconst { cmpTextureArray } = textures;\n\nlet mat_vp;\nlet mat_view = mat4();\n\nlet geom_stats;\nlet last_uid = 0;\nlet sprite_fshader;\nexport let sprite3d_vshader;\n\nconst sprite3d_shader_params = {};\n\nlet buckets = [\n  null,\n  [],\n  [],\n  [],\n];\n\nconst TRI_QUAD = new Uint16Array([1, 3, 0, 1, 2, 3]);\nconst TRI_QUAD_DOUBLE = new Uint16Array([1, 3, 0, 1, 2, 3, 0, 3, 1, 3, 2, 1]);\n\nlet dyn_freelist = [];\n\nfunction DynGeomData() {\n  // geometry data\n  this.num_tris = 0;\n  this.tris = null;\n  this.tri_pool_idx = 0;\n  this.num_verts = 0;\n  this.verts = null;\n  this.vert_pool_idx = 0;\n  // data for sorting/binding/etc\n  this.texs = null;\n  this.shader = null;\n  this.vshader = null;\n  this.shader_params = null;\n  this.blend = 0; // BLEND_ALPHA; only if bucket > BUCKET_OPAQUE\n  this.sort_z = 0;\n  this.uid = 0;\n}\n\nexport function dynGeomAlloc() {\n  let ret;\n  if (dyn_freelist.length) {\n    ret = dyn_freelist.pop();\n  } else {\n    ret = new DynGeomData();\n  }\n  return ret;\n}\n\nDynGeomData.prototype.queue = function (bucket, sort_z) {\n  assert(isFinite(sort_z));\n  assert(this.texs);\n  assert(this.shader);\n  assert(this.vshader);\n  this.sort_z = sort_z;\n  this.uid = ++last_uid;\n  ++geom_stats.dyn;\n  buckets[bucket].push(this);\n};\n\n// Pool for vert and index counts up to 16k\nlet vert_pool = new Array(15).join(',').split(',').map(() => []);\nvert_pool[0] = null;\nlet tri_pool = new Array(15).join(',').split(',').map(() => []);\ntri_pool[0] = null;\nconst POOL_UPPER_LIMIT = 4096;\n// Max size per vert count - use at most 1MB per pool (1MB/DYN_VERT_SIZE/4~=1<<14), max of POOL_UPPER_LIMIT entries\nconst VERT_POOL_MAX_SIZE = vert_pool.map((a, idx) => min(POOL_UPPER_LIMIT, 1<<(14-idx)));\n// Max size per index count - use at most 1MB per pool (1MB/3/2~=1<<17), max of POOL_UPPER_LIMIT entries\nconst TRI_POOL_MAX_SIZE = vert_pool.map((a, idx) => min(POOL_UPPER_LIMIT, 1<<(17-idx)));\n\nDynGeomData.prototype.allocVerts = function (num_verts) {\n  this.num_verts = num_verts;\n  let vert_pool_idx = log2(this.num_verts);\n  assert(vert_pool_idx > 0);\n  this.vert_pool_idx = vert_pool_idx;\n  let pool = vert_pool[this.vert_pool_idx];\n  if (pool && pool.length) {\n    this.verts = pool.pop();\n  } else {\n    let alloc_num_verts = pool ? nextHighestPowerOfTwo(num_verts) : num_verts;\n    this.verts = new Float32Array(DYN_VERT_SIZE * alloc_num_verts);\n  }\n};\n\nDynGeomData.prototype.allocTris = function (num_tris) {\n  this.num_tris = num_tris;\n  let tri_pool_idx = log2(this.num_tris);\n  assert(tri_pool_idx > 0);\n  this.tri_pool_idx = tri_pool_idx;\n  let pool = tri_pool[this.tri_pool_idx];\n  if (pool && pool.length) {\n    this.tris = pool.pop();\n  } else {\n    let alloc_num_tris = pool ? nextHighestPowerOfTwo(num_tris) : num_tris;\n    this.tris = new Uint16Array(3 * alloc_num_tris);\n  }\n};\n\nDynGeomData.prototype.alloc = function (num_verts, num_tris) {\n  this.allocVerts(num_verts);\n  this.allocTris(num_tris);\n};\n\nDynGeomData.prototype.allocQuad = function (doublesided) {\n  this.allocVerts(4);\n  this.tris = doublesided ? TRI_QUAD_DOUBLE : TRI_QUAD;\n  this.num_tris = this.tris.length / 3;\n  this.tri_pool_idx = 0;\n};\n\nDynGeomData.prototype.dispose = function () {\n  let pool = vert_pool[this.vert_pool_idx];\n  if (pool && pool.length < VERT_POOL_MAX_SIZE[this.vert_pool_idx]) {\n    pool.push(this.verts);\n  }\n  this.verts = null;\n  pool = tri_pool[this.tri_pool_idx];\n  if (pool && pool.length < TRI_POOL_MAX_SIZE[this.tri_pool_idx]) {\n    pool.push(this.tris);\n  }\n  this.tris = null;\n  dyn_freelist.push(this);\n};\n\nlet down = vec3();\nlet up = vec3();\nlet cam_down = vec3();\nlet cam_pos = vec3();\nlet right = vec3();\nlet forward = vec3();\nexport function dynGeomLookAt(cam_pos_in, target_pos, up_in) {\n  v3copy(cam_pos, cam_pos_in);\n  v3copy(up, up_in);\n  v3scale(down, up, -1);\n  v3sub(forward, target_pos, cam_pos);\n  v3iNormalize(forward);\n  v3cross(right, forward, up);\n  v3iNormalize(right);\n  v3cross(cam_down, forward, right);\n  v3iNormalize(cam_down);\n  mat4LookAt(mat_view, cam_pos, target_pos, up);\n  setGlobalMatrices(mat_view);\n}\n\nlet temp = vec3();\nconst xaxis = vec3(1,0,0);\nlet target_right = vec3();\nexport function dynGeomSpriteSetup(params) {\n  let {\n    pos, // 3D world position\n    shader, shader_params,\n    bucket,\n    facing,\n    vshader,\n  } = params;\n  bucket = bucket || BUCKET_ALPHA;\n  facing = facing === undefined ? FACE_DEFAULT : facing;\n  shader = shader || sprite_fshader;\n  vshader = vshader || sprite3d_vshader;\n  shader_params = shader_params || null;\n\n  let my_right;\n  let my_down;\n  if (facing & FACE_XY) {\n    my_right = right;\n    my_down = down;\n  } else if (facing & FACE_XYZ) {\n    my_right = right;\n    my_down = cam_down;\n  } else {\n    my_right = xaxis;\n    my_down = down;\n  }\n  if (my_right === right && (facing & FACE_CAMERA)) {\n    v3sub(temp, pos, cam_pos);\n    v3cross(target_right, temp, up);\n    my_right = v3iNormalize(target_right);\n  }\n\n  let sort_z = mat_vp[2] * pos[0] +\n    mat_vp[6] * pos[1] +\n    mat_vp[10] * pos[2] +\n    mat_vp[14];\n  return {\n    bucket,\n    my_right,\n    my_down,\n    sort_z,\n    shader,\n    vshader,\n    shader_params,\n  };\n}\nlet pos0 = vec3();\nexport function dynGeomQueueSprite(sprite, params) {\n  let {\n    bucket,\n    my_right,\n    my_down,\n    sort_z,\n    shader,\n    vshader,\n    shader_params,\n  } = dynGeomSpriteSetup(params);\n  let {\n    pos, // 3D world position\n    offs, // 2D offset (-x/-y is upper left), in world scale\n    size, // 2D w,h, in world scale\n    uvs,\n    blend,\n    color,\n    doublesided,\n  } = params;\n  let elem = dynGeomAlloc();\n  color = color || sprite.color;\n  offs = offs || zero_vec;\n  elem.shader = shader;\n  elem.vshader = vshader;\n  elem.shader_params = shader_params;\n  elem.texs = sprite.texs;\n  elem.blend = blend || BLEND_ALPHA;\n  doublesided = doublesided || false;\n\n  let { origin } = sprite;\n  let [w, h] = size;\n  v3addScale(pos0, pos, my_right, -origin[0] * w + offs[0]);\n  v3addScale(pos0, pos0, my_down, -origin[1] * h + offs[1]);\n\n  // TODO: rot?\n  elem.allocQuad(doublesided);\n  let { verts } = elem;\n  // upper left\n  verts[0] = pos0[0];\n  verts[1] = pos0[1];\n  verts[2] = pos0[2];\n  verts[4] = color[0];\n  verts[5] = color[1];\n  verts[6] = color[2];\n  verts[7] = color[3];\n  verts[8] = uvs[0];\n  verts[9] = uvs[1];\n\n  // lower left\n  verts[12] = pos0[0] + my_down[0] * h;\n  verts[13] = pos0[1] + my_down[1] * h;\n  verts[14] = pos0[2] + my_down[2] * h;\n  verts[16] = color[0];\n  verts[17] = color[1];\n  verts[18] = color[2];\n  verts[19] = color[3];\n  verts[20] = uvs[0];\n  verts[21] = uvs[3];\n\n  verts[24] = pos0[0] + my_right[0] * w + my_down[0] * h;\n  verts[25] = pos0[1] + my_right[1] * w + my_down[1] * h;\n  verts[26] = pos0[2] + my_right[2] * w + my_down[2] * h;\n  verts[28] = color[0];\n  verts[29] = color[1];\n  verts[30] = color[2];\n  verts[31] = color[3];\n  verts[32] = uvs[2];\n  verts[33] = uvs[3];\n\n  verts[36] = pos0[0] + my_right[0] * w;\n  verts[37] = pos0[1] + my_right[1] * w;\n  verts[38] = pos0[2] + my_right[2] * w;\n  verts[40] = color[0];\n  verts[41] = color[1];\n  verts[42] = color[2];\n  verts[43] = color[3];\n  verts[44] = uvs[2];\n  verts[45] = uvs[1];\n\n  elem.queue(bucket, sort_z);\n}\n\n\nlet batch_state;\nlet sprite_geom;\nlet sprite_buffer_vert; // Float32Array with DYN_VERT_SIZE floats per vert\nlet sprite_buffer_vert_cur = 0; // in floats\nlet sprite_buffer_idx; // Uint16Array with 3 entries per tri\nlet sprite_buffer_idx_cur = 0; // in indices\nlet sprite_buffer_idx_batch_start = 0;\n\nlet do_blending;\nlet last_bound_shader;\nlet last_bound_vshader;\nconst MAX_VERT_ELEM_COUNT = 65532 * DYN_VERT_SIZE; // strictly less than 65536, as index 65535 is special in WebGL2\nlet batches = [];\nfunction commit() {\n  if (sprite_buffer_idx_cur === sprite_buffer_idx_batch_start) {\n    return;\n  }\n  batches.push({\n    state: batch_state,\n    start: sprite_buffer_idx_batch_start,\n    end: sprite_buffer_idx_cur,\n  });\n  sprite_buffer_idx_batch_start = sprite_buffer_idx_cur;\n}\n\nfunction commitAndFlush() {\n  commit();\n  if (!batches.length) {\n    return;\n  }\n  assert(sprite_buffer_idx_cur);\n  sprite_geom.updateIndex(sprite_buffer_idx, sprite_buffer_idx_cur);\n  let num_verts = sprite_buffer_vert_cur/DYN_VERT_SIZE;\n  sprite_geom.update(sprite_buffer_vert, num_verts);\n  sprite_geom.bind();\n  geom_stats.tris += sprite_buffer_idx_cur / 3;\n  geom_stats.verts += num_verts;\n\n  for (let ii = 0; ii < batches.length; ++ii) {\n    let batch = batches[ii];\n    let { state, start, end } = batch;\n    if (last_bound_shader !== state.shader || last_bound_vshader !== state.vshader || state.shader_params) {\n      shaders.bind(state.vshader, state.shader, state.shader_params || sprite3d_shader_params);\n      last_bound_shader = state.shader;\n      last_bound_vshader = state.vshader;\n    }\n    if (do_blending) {\n      blendModeSet(state.blend);\n    }\n    textures.bindArray(state.texs);\n    ++geom_stats.draw_calls_dyn;\n    gl.drawElements(sprite_geom.mode, end - start, gl.UNSIGNED_SHORT, start * 2);\n  }\n\n  batches.length = 0;\n  sprite_buffer_vert_cur = 0;\n  sprite_buffer_idx_cur = 0;\n  sprite_buffer_idx_batch_start = 0;\n}\n\nfunction drawSetup(do_blend) {\n  do_blending = do_blend;\n  last_bound_shader = -1;\n  last_bound_vshader = -1;\n\n  if (!sprite_geom) {\n    sprite_geom = geom.create([\n      // needs to be multiple of 4 elements, for best performance\n      [shaders.semantic.POSITION, gl.FLOAT, 4, false], // 1 unused\n      [shaders.semantic.COLOR, gl.FLOAT, 4, false],\n      [shaders.semantic.TEXCOORD, gl.FLOAT, 4, false], // 2 unused\n    ], [], [], geom.TRIANGLES);\n    sprite_buffer_vert = new Float32Array(1024);\n    sprite_buffer_idx = new Uint16Array(1024);\n  }\n}\n\nfunction drawElem(elem) {\n  if (!batch_state ||\n    cmpTextureArray(elem.texs, batch_state.texs) ||\n    elem.shader !== batch_state.shader ||\n    elem.vshader !== batch_state.vshader ||\n    elem.shader_params !== batch_state.shader_params ||\n    do_blending && elem.blend !== batch_state.blend\n  ) {\n    commit();\n    batch_state = elem;\n  }\n  let num_floats = elem.num_verts * DYN_VERT_SIZE;\n  if (sprite_buffer_vert_cur + num_floats > sprite_buffer_vert.length) {\n    commitAndFlush();\n    // batch_state left alone\n    if (sprite_buffer_vert.length !== MAX_VERT_ELEM_COUNT) {\n      let cur_tris = sprite_buffer_vert.length / DYN_VERT_SIZE / 3;\n      let new_length = min(ceil(cur_tris * 1.25) * 3 * DYN_VERT_SIZE, MAX_VERT_ELEM_COUNT);\n      sprite_buffer_vert = new Float32Array(new_length);\n    }\n  }\n  let num_idxs = elem.num_tris * 3;\n  if (sprite_buffer_idx_cur + num_idxs > sprite_buffer_idx.length) {\n    commitAndFlush();\n    // batch_state left alone\n    let cur_tris = sprite_buffer_idx.length / 3;\n    let new_length = max(elem.tris.length, ceil(cur_tris * 1.25) * 3);\n    sprite_buffer_idx = new Uint16Array(new_length);\n  }\n\n  let vidx0 = sprite_buffer_vert_cur / DYN_VERT_SIZE;\n  if (elem.verts.length === num_floats) {\n    sprite_buffer_vert.set(elem.verts, sprite_buffer_vert_cur);\n    sprite_buffer_vert_cur += num_floats;\n  } else {\n    // Could also do elem.verts.subarray() if that is more efficient?\n    for (let ii = 0; ii < num_floats; ++ii) {\n      sprite_buffer_vert[sprite_buffer_vert_cur++] = elem.verts[ii];\n    }\n  }\n  for (let ii = 0; ii < num_idxs; ++ii) {\n    sprite_buffer_idx[sprite_buffer_idx_cur++] = vidx0 + elem.tris[ii];\n  }\n\n  // TODO: pool on freelist\n}\n\nfunction finishDraw() {\n  commitAndFlush();\n  blendModeReset();\n}\n\n// draws [start_idx, end_idx)\n// pools all drawn elements\nfunction queueDraw(do_blend, queue, start_idx, end_idx) {\n  drawSetup(do_blend);\n  for (let ii = start_idx; ii < end_idx; ++ii) {\n    let elem = queue[ii];\n    drawElem(elem);\n    elem.dispose();\n  }\n  finishDraw();\n}\n\n\n// TODO (later, in real-world test): compare changing sorting precedence\nfunction cmpOpaue(a, b) {\n  let d = a.vshader.id - b.vshader.id;\n  if (d) {\n    return d;\n  }\n  d = a.shader.id - b.shader.id;\n  if (d) {\n    return d;\n  }\n  d = cmpTextureArray(a.texs, b.texs);\n  if (d) {\n    return d;\n  }\n  return a.uid - b.uid;\n}\n\nfunction cmpAlpha(a, b) {\n  let d = b.sort_z - a.sort_z;\n  if (d) {\n    return d;\n  }\n  return a.uid - b.uid;\n}\n\n// draw Opaque and Decal buckets\nexport function dynGeomDrawOpaque() {\n  profilerStartFunc();\n  let queue = buckets[BUCKET_OPAQUE];\n  if (queue.length) {\n    queue.sort(cmpOpaue);\n    queueDraw(false, queue, 0, queue.length);\n    queue.length = 0;\n  }\n  queue = buckets[BUCKET_DECAL];\n  if (queue.length) {\n    queue.sort(cmpOpaue);\n    // TODO: depth write, etc\n    queueDraw(true, queue, 0, queue.length);\n    queue.length = 0;\n  }\n  profilerStopFunc();\n}\n\nexport function dynGeomDrawAlpha() {\n  profilerStartFunc();\n  assert(!buckets[BUCKET_OPAQUE].length); // nothing called dynGeomDrawOpaque?\n  assert(!buckets[BUCKET_DECAL].length);\n\n  // TODO: merge with draw_list\n  let queue = buckets[BUCKET_ALPHA];\n  if (queue.length) {\n    queue.sort(cmpAlpha);\n    queueDraw(true, queue, 0, queue.length);\n    queue.length = 0;\n  }\n  profilerStopFunc();\n}\n\nfunction dynGeomStartup() {\n  geom_stats = geom.stats;\n  sprite3d_vshader = shaders.create('shaders/sprite3d.vp');\n  sprite_fshader = sprites.sprite_fshader;\n  shaders.prelink(sprite3d_vshader, sprite_fshader);\n  mat_vp = engine.mat_vp;\n}\nengineStartupFunc(dynGeomStartup);\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nexports.create = editBoxCreate; // eslint-disable-line @typescript-eslint/no-use-before-define\n\nconst assert = require('assert');\nconst verify = require('glov/common/verify.js');\nconst camera2d = require('./camera2d.js');\nconst engine = require('./engine.js');\nconst {\n  KEYS,\n  eatAllKeyboardInput,\n  mouseConsumeClicks,\n  keyDownEdge,\n  keyUpEdge,\n  pointerLockEnter,\n  pointerLockExit,\n  pointerLocked,\n  inputClick,\n} = require('./input.js');\nconst { getStringIfLocalizable } = require('./localization.js');\nconst {\n  SPOT_NAV_DOWN,\n  SPOT_NAV_LEFT,\n  SPOT_NAV_RIGHT,\n  SPOT_NAV_UP,\n  spotFocusCheck,\n  spotFocusSteal,\n  spotUnfocus,\n  spotlog,\n} = require('./spot.js');\nconst glov_ui = require('./ui.js');\nconst { uiGetDOMElem } = require('./ui.js');\n\nlet form_hook_registered = false;\nlet active_edit_box;\nlet active_edit_box_frame;\n\nlet this_frame_edit_boxes = [];\nlet last_frame_edit_boxes = [];\n\nexport function editBoxTick() {\n  let expected_last_frame = engine.frame_index - 1;\n  for (let ii = 0; ii < last_frame_edit_boxes.length; ++ii) {\n    let edit_box = last_frame_edit_boxes[ii];\n    if (edit_box.last_frame < expected_last_frame) {\n      edit_box.unrun();\n    }\n  }\n  last_frame_edit_boxes = this_frame_edit_boxes;\n  this_frame_edit_boxes = [];\n}\n\nfunction setActive(edit_box) {\n  active_edit_box = edit_box;\n  active_edit_box_frame = engine.frame_index;\n}\n\nexport function editBoxAnyActive() {\n  return active_edit_box && active_edit_box_frame >= engine.frame_index - 1;\n}\n\nfunction formHook(ev) {\n  ev.preventDefault();\n\n  if (!editBoxAnyActive()) {\n    return;\n  }\n  active_edit_box.submitted = true;\n  active_edit_box.updateText();\n  if (active_edit_box.pointer_lock && !active_edit_box.text) {\n    pointerLockEnter('edit_box_submit');\n  }\n}\n\nlet last_key_id = 0;\n\nclass GlovUIEditBox {\n  constructor(params) {\n    this.key = `eb${++last_key_id}`;\n    this.x = 0;\n    this.y = 0;\n    this.z = Z.UI; // actually in DOM, so above everything!\n    this.w = glov_ui.button_width;\n    this.type = 'text';\n    // this.h = glov_ui.button_height;\n    this.font_height = glov_ui.font_height;\n    this.text = '';\n    this.placeholder = '';\n    this.max_len = 0;\n    this.zindex = null;\n    this.uppercase = false;\n    this.initial_focus = false;\n    this.onetime_focus = false;\n    this.auto_unfocus = false;\n    this.initial_select = false;\n    this.spellcheck = true;\n    this.esc_clears = true;\n    this.multiline = 0;\n    this.autocomplete = false;\n    this.custom_nav = {\n      // We want left/right to be handled by the input element, not used to change focus.\n      [SPOT_NAV_LEFT]: null,\n      [SPOT_NAV_RIGHT]: null,\n    };\n    this.sticky_focus = true;\n    this.applyParams(params);\n    assert.equal(typeof this.text, 'string');\n\n    this.last_autocomplete = null;\n    this.is_focused = false;\n    this.elem = null;\n    this.input = null;\n    this.submitted = false;\n    this.pointer_lock = false;\n    this.last_frame = 0;\n    this.out = {}; // Used by spotFocusCheck\n  }\n  applyParams(params) {\n    if (!params) {\n      return;\n    }\n    for (let f in params) {\n      this[f] = params[f];\n    }\n    if (this.text === undefined) {\n      // do not trigger assert if `params` has a `text: undefined` member\n      this.text = '';\n    }\n    this.h = this.font_height;\n    if (this.multiline && this.custom_nav[SPOT_NAV_UP] === undefined) {\n      this.custom_nav[SPOT_NAV_UP] = null;\n    }\n    if (this.multiline && this.custom_nav[SPOT_NAV_DOWN] === undefined) {\n      this.custom_nav[SPOT_NAV_DOWN] = null;\n    }\n  }\n  updateText() {\n    this.text = this.input.value;\n    if (this.max_len > 0) {\n      this.text = this.text.slice(0, this.max_len);\n    }\n  }\n  getText() {\n    return this.text;\n  }\n  setText(new_text) {\n    new_text = String(new_text);\n    if (this.input) {\n      this.input.value = new_text;\n    }\n    this.text = new_text;\n  }\n  focus() {\n    if (this.input) {\n      this.input.focus();\n      setActive(this);\n    } else {\n      this.onetime_focus = true;\n    }\n    spotFocusSteal(this);\n    this.is_focused = true;\n    if (this.pointer_lock && pointerLocked()) {\n      pointerLockExit();\n    }\n  }\n  unfocus() {\n    spotUnfocus();\n  }\n  isFocused() { // call after .run()\n    return this.is_focused;\n  }\n\n  updateFocus(is_reset) {\n    let was_glov_focused = this.is_focused;\n    let spot_ret = spotFocusCheck(this);\n    let { focused } = spot_ret;\n    let dom_focused = this.input && document.activeElement === this.input;\n    if (was_glov_focused !== focused) {\n      // something external (from clicks/keys in GLOV) changed, apply it if it doesn't match\n      if (focused && !dom_focused && this.input) {\n        spotlog('GLOV focused, DOM not, focusing', this);\n        this.input.focus();\n      }\n      if (!focused && dom_focused) {\n        spotlog('DOM focused, GLOV not, and changed, blurring', this);\n        this.input.blur();\n      }\n    } else if (dom_focused && !focused) {\n      spotlog('DOM focused, GLOV not, stealing', this);\n      spotFocusSteal(this);\n      focused = true;\n    } else if (!dom_focused && focused) {\n      if (is_reset) {\n        // Just appeared this frame, steal DOM focus\n        this.onetime_focus = true;\n        spotlog('GLOV focused, DOM not, new edit box, focusing', this);\n      } else if (document.activeElement === engine.canvas || document.activeElement === this.postspan) {\n        // focus explicitly on canvas or left our input element, lose focus\n        spotlog('GLOV focused, DOM canvas focused, unfocusing', this);\n        spotUnfocus();\n      } else {\n        // Leave it alone, it may be a browser pop-up such as for passwords\n      }\n    }\n\n    if (focused) {\n      setActive(this);\n      let key_opt = (this.pointer_lock && !this.text) ? { in_event_cb: pointerLockEnter } : null;\n      if (keyUpEdge(KEYS.ESC, key_opt)) {\n        if (this.text && this.esc_clears) {\n          this.setText('');\n        } else {\n          spotUnfocus();\n          if (this.input) {\n            this.input.blur();\n          }\n          focused = false;\n          this.canceled = true;\n        }\n      }\n    }\n    this.is_focused = focused;\n    return spot_ret;\n  }\n\n  run(params) {\n    this.applyParams(params);\n\n    let is_reset = false;\n    if (!verify(this.last_frame !== engine.frame_index)) {\n      // two calls on one frame (asserts in dev, silently do nothing otherwise?)\n      return null;\n    }\n    if (this.last_frame !== engine.frame_index - 1) {\n      // it's been more than a frame, we must have not been running, discard async events\n      this.submitted = false;\n      is_reset = true;\n    }\n    this.last_frame = engine.frame_index;\n\n    this.canceled = false;\n    let { allow_focus, focused } = this.updateFocus(is_reset);\n\n    this_frame_edit_boxes.push(this);\n    let elem = allow_focus && uiGetDOMElem(this.elem, true);\n    if (elem !== this.elem) {\n      if (elem) {\n        // new DOM element, initialize\n        if (!form_hook_registered) {\n          form_hook_registered = true;\n          let form = document.getElementById('dynform');\n          if (form) {\n            form.addEventListener('submit', formHook, true);\n          }\n        }\n        elem.textContent = '';\n        let input = document.createElement(this.multiline ? 'textarea' : 'input');\n        input.setAttribute('type', this.type);\n        input.setAttribute('placeholder', getStringIfLocalizable(this.placeholder));\n        if (this.max_len) {\n          input.setAttribute('maxLength', this.max_len);\n        }\n        if (this.multiline) {\n          input.setAttribute('rows', this.multiline);\n        }\n        input.setAttribute('tabindex', 2);\n        elem.appendChild(input);\n        let span = document.createElement('span');\n        span.setAttribute('tabindex', 3);\n        this.postspan = span;\n        elem.appendChild(span);\n        input.value = this.text;\n        if (this.uppercase) {\n          input.style['text-transform'] = 'uppercase';\n        }\n        this.input = input;\n        if (this.initial_focus || this.onetime_focus) {\n          input.focus();\n          setActive(this);\n          this.onetime_focus = false;\n        }\n        if (this.initial_select) {\n          input.select();\n        }\n      } else {\n        this.input = null;\n      }\n      this.submitted = false;\n      this.elem = elem;\n    } else {\n      if (this.input) {\n        this.updateText();\n      }\n    }\n    if (elem) {\n      let pos = camera2d.htmlPos(this.x, this.y);\n      if (!this.spellcheck) {\n        elem.spellcheck = false;\n      }\n      elem.style.left = `${pos[0]}%`;\n      elem.style.top = `${pos[1]}%`;\n      let size = camera2d.htmlSize(this.w, 0);\n      elem.style.width = `${size[0]}%`;\n      let old_fontsize = elem.style.fontSize || '?px';\n      let new_fontsize = `${camera2d.virtualToFontSize(this.font_height).toFixed(0)}px`;\n      if (new_fontsize !== old_fontsize) {\n        elem.style.fontSize = new_fontsize;\n      }\n      if (this.zindex) {\n        elem.style['z-index'] = this.zindex;\n      }\n      if (this.last_autocomplete !== this.autocomplete) {\n        this.last_autocomplete = this.autocomplete;\n        this.input.setAttribute('autocomplete', this.autocomplete || `auto_off_${Math.random()}`);\n      }\n    }\n\n    if (focused) {\n      if (this.auto_unfocus) {\n        if (inputClick({ peek: true })) {\n          spotUnfocus();\n        }\n      }\n      // For IFRAMEs with `sandbox` not including `allow-form`, catch Enter ourselves\n      if (keyDownEdge(KEYS.ENTER)) {\n        this.submitted = true;\n      }\n      // keyboard input is handled by the INPUT element, but allow mouse events to trickle\n      eatAllKeyboardInput();\n    }\n    // Eat mouse events going to the edit box\n    mouseConsumeClicks({ x: this.x, y: this.y, w: this.w, h: this.h });\n\n    if (this.submitted) {\n      this.submitted = false;\n      return this.SUBMIT;\n    }\n    if (this.canceled) {\n      this.canceled = false;\n      return this.CANCEL;\n    }\n    return null;\n  }\n  unrun() {\n    // remove from DOM or hide\n    this.elem = null;\n    this.input = null;\n  }\n}\nGlovUIEditBox.prototype.SUBMIT = 'submit';\nGlovUIEditBox.prototype.CANCEL = 'cancel';\n\nexport function editBoxCreate(params) {\n  return new GlovUIEditBox(params);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n// Some code from Turbulenz: Copyright (c) 2012-2013 Turbulenz Limited\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst engine = require('./engine.js');\nconst { renderWidth, renderHeight } = engine;\nconst { framebufferEnd, framebufferStart, framebufferTopOfFrame } = require('./framebuffer.js');\nconst geom = require('./geom.js');\nconst shaders = require('./shaders.js');\nconst { spriteQueueFn } = require('./sprites.js');\nconst textures = require('./textures.js');\nconst { vec2, vec3, vec4, v4set } = require('glov/common/vmath.js');\n\nconst shader_data = {\n  vp_copy: {\n    vp: 'shaders/effects_copy.vp',\n  },\n  copy: {\n    fp: 'shaders/effects_copy.fp',\n  },\n  pixely_expand: {\n    fp: 'shaders/pixely_expand.fp',\n  },\n  gaussian_blur: {\n    fp: 'shaders/effects_gaussian_blur.fp',\n  },\n  // bloom_merge: {\n  //   fp: 'shaders/effects_bloom_merge.fp',\n  // },\n  // bloom_threshold: {\n  //   fp: 'shaders/effects_bloom_threshold.fp',\n  // },\n  color_matrix: {\n    fp: 'shaders/effects_color_matrix.fp',\n  },\n  // distort: {\n  //   fp: 'shaders/effects_distort.fp',\n  // },\n};\n\nexport function registerShader(key, obj) {\n  shader_data[key] = obj;\n}\n\nfunction getShader(key) {\n  let elem = shader_data[key];\n  if (!elem.shader) {\n    if (elem.fp) {\n      elem.shader = shaders.create(elem.fp);\n    } else {\n      elem.shader = shaders.create(elem.vp);\n    }\n  }\n  return elem.shader;\n}\n\n\nlet inited = false;\nlet clip_space = vec4(2, 2, -1, -1);\nlet copy_uv_scale = vec2(1, 1);\nlet shader_params_default = {\n  clip_space,\n  copy_uv_scale,\n};\n// let shader_params_distort;\nlet shader_params_color_matrix;\n// let shader_params_bloom;\n// let shader_params_bloom_merge;\nlet shader_params_gaussian_blur;\nlet shader_params_pixely_expand;\nlet quad_geom;\nfunction startup() {\n  inited = true;\n\n  quad_geom = geom.create(\n    [[shaders.semantic.POSITION, gl.FLOAT, 2, false]],\n    new Float32Array([\n      0, 0,\n      1, 0,\n      1, 1,\n      0, 1,\n    ]), null, geom.QUADS); // TODO: use gl.TRIANGLE_STRIP instead, save index buffer binding\n\n  // shader_params_distort = {\n  //   clip_space,\n  //   copy_uv_scale,\n  //   strength: vec2(0, 0),\n  //   transform: new Float32Array([0, 0, 0, 0, 0, 0]),\n  //   invTransform: vec4(0, 0, 0, 0),\n  // };\n\n  shader_params_color_matrix = {\n    clip_space,\n    copy_uv_scale,\n    colorMatrix: new Float32Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]),\n  };\n\n  // shader_params_bloom = {\n  //   clip_space,\n  //   copy_uv_scale,\n  //   bloomThreshold: 0,\n  //   thresholdCuttoff: 0,\n  // };\n\n  // shader_params_bloom_merge = {\n  //   clip_space,\n  //   copy_uv_scale,\n  //   bloomIntensity: 0,\n  //   bloomSaturation: 0,\n  //   originalIntensity: 0,\n  //   originalSaturation: 0,\n  // };\n\n  // Gaussian Blur effect (also used by bloom)\n  shader_params_gaussian_blur = {\n    clip_space,\n    copy_uv_scale,\n    sampleRadius: vec3(1, 1, 1),\n    Gauss: new Float32Array([0.93, 0.8, 0.7, 0.6, 0.5, 0.4, 0.3, 0.2, 0.1]),\n  };\n\n  shader_params_pixely_expand = {\n    clip_space,\n    copy_uv_scale,\n    orig_pixel_size: vec4(),\n  };\n}\n\nlet num_passes = 0;\nexport function effectsPassAdd() {\n  ++num_passes;\n}\nexport function effectsPassConsume() {\n  assert(num_passes);\n  --num_passes;\n}\n\nfunction doEffect(fn) {\n  effectsPassConsume();\n  fn();\n}\n\nexport function effectsQueue(z, fn) {\n  effectsPassAdd();\n  spriteQueueFn(z, doEffect.bind(null, fn));\n}\n\nexport function effectsTopOfFrame() {\n  // In case of crash on previous frame\n  num_passes = 0;\n  framebufferTopOfFrame();\n}\n\nexport function effectsReset() {\n  assert.equal(num_passes, 0); // otherwise probably still have a framebuffer bound\n}\n\nexport function effectsIsFinal() {\n  return !num_passes;\n}\n\nexport function grayScaleMatrix(dst) {\n  dst[0] = 0.2126;\n  dst[1] = 0.2126;\n  dst[2] = 0.2126;\n  dst[3] = 0.7152;\n  dst[4] = 0.7152;\n  dst[5] = 0.7152;\n  dst[6] = 0.0722;\n  dst[7] = 0.0722;\n  dst[8] = 0.0722;\n  dst[9] = dst[10] = dst[11] = 0;\n}\n\nexport function sepiaMatrix(dst) {\n  dst[0] = 0.393;\n  dst[1] = 0.349;\n  dst[2] = 0.272;\n  dst[3] = 0.769;\n  dst[4] = 0.686;\n  dst[5] = 0.534;\n  dst[6] = 0.189;\n  dst[7] = 0.168;\n  dst[8] = 0.131;\n  dst[9] = dst[10] = dst[11] = 0;\n}\n\nexport function negativeMatrix(dst) {\n  dst[0] = dst[4] = dst[8] = -1;\n  dst[1] = dst[2] = dst[3] = dst[5] = dst[6] = dst[7] = 0;\n  dst[9] = dst[10] = dst[11] = 1;\n}\n\nexport function saturationMatrix(dst, saturationScale) {\n  let is = (1 - saturationScale);\n  dst[0] = (is * 0.2126) + saturationScale;\n  dst[1] = (is * 0.2126);\n  dst[2] = (is * 0.2126);\n  dst[3] = (is * 0.7152);\n  dst[4] = (is * 0.7152) + saturationScale;\n  dst[5] = (is * 0.7152);\n  dst[6] = (is * 0.0722);\n  dst[7] = (is * 0.0722);\n  dst[8] = (is * 0.0722) + saturationScale;\n  dst[9] = dst[10] = dst[11] = 0;\n}\n\nexport function hueMatrix(dst, angle) {\n  ////\n  //// Uncomment to calculate new coeffecients should luminance\n  //// values 0.2126 0.7152 0.0722 change.\n  //let lumR = 0.2126;\n  //let lumG = 0.7152;\n  //let lumB = 0.0722;\n  ////\n  //let r23 = Math.sqrt(2 / 3);\n  //let r12 = 1 / Math.sqrt(2);\n  //let r13 = 1 / Math.sqrt(3);\n  //let r16 = 1 / Math.sqrt(6);\n  //let M = [r23, 0, r13, -r16, r12, r13, -r16, -r12, r13, 0, 0, 0];\n  //let zx = (r23 * lumR) - (r16 * lumG) - (r16 * lumB);\n  //let zy =                (r12 * lumG) - (r12 * lumB);\n  //let zz = (r13 * lumR) + (r13 * lumG) + (r13 * lumB);\n  //let x = zx / zz;\n  //let y = zy / zz;\n  //let C = [1, 0, x, 0, 1, y, 0, 0, 1, 0, 0, 0];\n  //m43mul(M, M, C);\n  //console.log(\"Pre transform = \", M);\n  //let E = [1, 0, -x, 0, 1, -y, 0, 0, 1, 0, 0, 0];\n  //let N = [r23, -r16, -r16, 0, r12, -r12, r13, r13, r13, 0, 0, 0];\n  //m43mul(N, E, N);\n  //console.log(\"Post transform = \", N);\n  ////\n  //// Final matrix is then: m43Mul(Pre, [c, s, 0, -s, c, 0, 0, 0, 1, 0, 0, 0, ], Post);\n  //// for c = cos(angle), s = sin(angle)\n  ////\n  //let out = \"\";\n  //out += \"let c = Math.cos(angle);\\n\";\n  //out += \"let s = Math.sin(angle);\\n\";\n  //out += \"dst[0] = (\" + (N[0]*M[0]+N[3]*M[1]) + \" * c) + (\" + (N[3]*M[0]-N[0]*M[1]) + \" * s) + \" + lumR+\";\\n\";\n  //out += \"dst[1] = (\" + (-lumR)               + \" * c) + (\" + (N[4]*M[0]-N[1]*M[1]) + \" * s) + \" + lumR+\";\\n\";\n  //out += \"dst[2] = (\" + (-lumR)               + \" * c) + (\" + (N[5]*M[0]-N[2]*M[1]) + \" * s) + \" + lumR+\";\\n\";\n  //out += \"dst[3] = (\" + (-lumG)               + \" * c) + (\" + (N[3]*M[3]-N[0]*M[4]) + \" * s) + \" + lumG+\";\\n\";\n  //out += \"dst[4] = (\" + (N[1]*M[3]+N[4]*M[4]) + \" * c) + (\" + (N[4]*M[3]-N[1]*M[4]) + \" * s) + \" + lumG+\";\\n\";\n  //out += \"dst[5] = (\" + (-lumG)               + \" * c) + (\" + (N[5]*M[3]-N[2]*M[4]) + \" * s) + \" + lumG+\";\\n\";\n  //out += \"dst[6] = (\" + (-lumB)               + \" * c) + (\" + (N[3]*M[6]-N[0]*M[7]) + \" * s) + \" + lumB+\";\\n\";\n  //out += \"dst[7] = (\" + (-lumB)               + \" * c) + (\" + (N[4]*M[6]-N[1]*M[7]) + \" * s) + \" + lumB+\";\\n\";\n  //out += \"dst[8] = (\" + (N[2]*M[6]+N[5]*M[7]) + \" * c) + (\" + (N[5]*M[6]-N[2]*M[7]) + \" * s) + \" + lumB+\";\\n\";\n  //console.log(out);\n  let c = Math.cos(angle);\n  let s = Math.sin(angle);\n  dst[0] = (0.7874 * c) + (-0.3712362230889293 * s) + 0.2126;\n  dst[1] = (-0.2126 * c) + (0.20611404610069642 * s) + 0.2126;\n  dst[2] = (-0.2126 * c) + (-0.9485864922785551 * s) + 0.2126;\n  dst[3] = (-0.7152 * c) + (-0.4962902913954023 * s) + 0.7152;\n  dst[4] = (0.2848 * c) + (0.08105997779422341 * s) + 0.7152;\n  dst[5] = (-0.7152 * c) + (0.6584102469838492 * s) + 0.7152;\n  dst[6] = (-0.0722 * c) + (0.8675265144843316 * s) + 0.0722;\n  dst[7] = (-0.0722 * c) + (-0.28717402389491986 * s) + 0.0722;\n  dst[8] = (0.9278 * c) + (0.290176245294706 * s) + 0.0722;\n  dst[9] = dst[10] = dst[11] = 0;\n}\n\nexport function brightnessAddMatrix(dst, brightnessOffset) {\n  dst[0] = dst[4] = dst[8] = 1;\n  dst[1] = dst[2] = dst[3] = dst[5] = dst[6] = dst[7] = 0;\n  dst[9] = dst[10] = dst[11] = brightnessOffset;\n}\n\nexport function brightnessScaleMatrix(dst, scale) {\n  dst[0] = dst[4] = dst[8] = scale;\n  dst[1] = dst[2] = dst[3] = dst[5] = dst[6] = dst[7] = 0;\n  dst[9] = dst[10] = dst[11] = 0;\n}\n\nexport function additiveMatrix(dst, additiveRGB) {\n  dst[0] = dst[4] = dst[8] = 1;\n  dst[1] = dst[2] = dst[3] = dst[5] = dst[6] = dst[7] = 0;\n  dst[9] = additiveRGB[0];\n  dst[10] = additiveRGB[1];\n  dst[11] = additiveRGB[2];\n}\n\nexport function contrastMatrix(dst, contrastScale) {\n  dst[0] = dst[4] = dst[8] = contrastScale;\n  dst[1] = dst[2] = dst[3] = dst[5] = dst[6] = dst[7] = 0;\n  dst[9] = dst[10] = dst[11] = 0.5 * (1 - contrastScale);\n}\n\n// effect: { shader, params, texs, final }\nfunction applyEffect(effect, view_w, view_h) {\n  let final = effect.final !== false && effectsIsFinal() || effect.final;\n  if (effect.no_framebuffer) {\n    // neither starting nor ending a framebuffer, presumably something effectively additive\n    let viewport = engine.viewport;\n    let target_w = viewport[2];\n    let target_h = viewport[3];\n    view_w = view_w || target_w;\n    view_h = view_h || target_h;\n    clip_space[0] = 2.0 * view_w / target_w;\n    clip_space[1] = 2.0 * view_h / target_h;\n  } else if (effect.viewport) {\n    let { viewport } = effect;\n    let target_w = viewport[2];\n    let target_h = viewport[3];\n    view_w = view_w || target_w;\n    view_h = view_h || target_h;\n\n    clip_space[0] = 2.0 * view_w / target_w;\n    clip_space[1] = 2.0 * view_h / target_h;\n\n    framebufferStart({\n      clear: effect.clear,\n      clear_all: effect.clear_all,\n      clear_color: effect.clear_color,\n      viewport,\n      final,\n    });\n  } else {\n    clip_space[0] = 2.0;\n    clip_space[1] = 2.0;\n    view_w = view_w || renderWidth();\n    view_h = view_h || renderHeight();\n\n    framebufferStart({\n      width: view_w, height: view_h,\n      final,\n    });\n  }\n  // clip_space[2] = -1.0;\n  // clip_space[3] = -1.0;\n  // copy_uv_scale[0] = target_w / effect.coord_source.width;\n  // copy_uv_scale[1] = target_h / effect.coord_source.height;\n\n  shaders.bind(getShader('vp_copy'), getShader(effect.shader), effect.params);\n  textures.bindArray(effect.texs);\n  quad_geom.draw();\n}\n\n// // TODO: Update for RTBBCTT and port to new GLOV.js\n// function applyBloomTODO(params) {\n//   let source = params.source;\n//   let blur1 = params.blurTarget1;\n//   let blur2 = params.blurTarget2;\n//   let dest = params.destination;\n//   if (!source || !dest || !blur1 || !blur2 || !blur1.colorTexture0 ||\n//     !blur2.colorTexture0 || blur1 === blur2 || blur1 === dest ||\n//     source === blur1.colorTexture0 || source === dest.colorTexture0) {\n//     return false;\n//   }\n//\n//   let effectParams = this.effectParams;\n//   let techparams;\n//\n//   // Threshold copy.\n//   techparams = this.bloomThresholdParameters;\n//   effectParams.technique = this.bloomThresholdTechnique;\n//   effectParams.params = techparams;\n//\n//   techparams.bloomThreshold = (params.bloomThreshold !== undefined) ? params.bloomThreshold : 0.65;\n//   techparams.thresholdCutoff = Math.exp((params.thresholdCutoff !== undefined) ? params.thresholdCutoff : 3);\n//   techparams.inputTexture0 = source;\n//   effectParams.destination = blur1;\n//   this.applyEffect(effectParams);\n//\n//   // Gaussian blur.\n//   techparams = this.gaussianBlurParameters;\n//   effectParams.technique = this.gaussianBlurTechnique;\n//   effectParams.params = techparams;\n//\n//   let sampleRadius = (params.blurRadius || 20);\n//   techparams.sampleRadius[0] = sampleRadius / source.width;\n//   techparams.sampleRadius[1] = 0;\n//   techparams.sampleRadius[2] = 1;\n//   techparams.inputTexture0 = blur1.colorTexture0;\n//   effectParams.destination = blur2;\n//   this.applyEffect(effectParams);\n//\n//   techparams.sampleRadius[0] = 0;\n//   techparams.sampleRadius[1] = sampleRadius / source.height;\n//   techparams.sampleRadius[2] = 1;\n//   techparams.inputTexture0 = blur2.colorTexture0;\n//   effectParams.destination = blur1;\n//   this.applyEffect(effectParams);\n//\n//   // Merge.\n//   techparams = this.bloomMergeParameters;\n//   effectParams.technique = this.bloomMergeTechnique;\n//   effectParams.params = techparams;\n//\n//   techparams.bloomIntensity = (params.bloomIntensity !== undefined) ? params.bloomIntensity : 1.2;\n//   techparams.bloomSaturation = (params.bloomSaturation !== undefined) ? params.bloomSaturation : 1.2;\n//   techparams.originalIntensity = (params.originalIntensity !== undefined) ? params.originalIntensity : 1.0;\n//   techparams.originalSaturation = (params.originalSaturation !== undefined) ? params.originalSaturation : 1.0;\n//   techparams.inputTexture0 = source;\n//   techparams.inputTexture1 = blur1.colorTexture0;\n//   effectParams.destination = dest;\n//   this.applyEffect(effectParams);\n//\n//   return true;\n// }\n\nexport function applyCopy(params) {\n  if (!inited) {\n    startup();\n  }\n  let source = params.source;\n  if (!source) {\n    source = framebufferEnd({ filter_linear: params.filter_linear, need_depth: params.need_depth });\n  }\n  params.shader = params.shader || 'copy';\n  params.params = params.params ? {\n    ...shader_params_default,\n    ...params.params,\n  } : shader_params_default;\n  if (Array.isArray(source)) {\n    params.texs = source;\n  } else {\n    params.texs = [source];\n  }\n  applyEffect(params);\n}\n\nexport function applyPixelyExpand(params) {\n  if (!inited) {\n    startup();\n  }\n  let source = params.source;\n  assert(!source); // would need linear/non-wrap sampler state set\n  if (!source) {\n    source = framebufferEnd({ filter_linear: true });\n  }\n\n  // do horizontal blur for primary lines\n  let resx = source.width;\n  let resy = source.height;\n  let sampleRadius = (params.hblur || 0.25) / resx;\n  shader_params_gaussian_blur.sampleRadius[0] = sampleRadius;\n  shader_params_gaussian_blur.sampleRadius[1] = 0;\n  shader_params_gaussian_blur.sampleRadius[2] = 1;\n  applyEffect({\n    shader: 'gaussian_blur',\n    params: shader_params_gaussian_blur,\n    texs: [source],\n    final: false,\n  }, resx, resy);\n  let hblur = framebufferEnd({ filter_linear: true });\n\n  // do seperable gaussian blur for scanlines (using horizontal blur from above)\n  sampleRadius = (params.vblur || 0.75) / resy;\n  shader_params_gaussian_blur.sampleRadius[0] = 0;\n  shader_params_gaussian_blur.sampleRadius[1] = sampleRadius;\n  shader_params_gaussian_blur.sampleRadius[2] = 1;\n  applyEffect({\n    shader: 'gaussian_blur',\n    params: shader_params_gaussian_blur,\n    texs: [hblur],\n    final: false,\n  }, resx, resy);\n  let vblur = framebufferEnd({ filter_linear: true });\n\n  // combine at full res\n  v4set(shader_params_pixely_expand.orig_pixel_size,\n    source.width, source.height, 1/source.width, 1/source.height);\n\n  applyEffect({\n    shader: 'pixely_expand',\n    params: shader_params_pixely_expand,\n    texs: [source, hblur, vblur],\n\n    clear: params.clear,\n    clear_all: params.clear_all,\n    clear_color: params.clear_color,\n    viewport: params.viewport,\n  });\n}\n\nexport function applyGaussianBlur(params) {\n  if (!inited) {\n    startup();\n  }\n  let source = framebufferEnd({ filter_linear: true });\n  let max_size = params.max_size || 512;\n  let min_size = params.min_size || 128;\n\n  // Quick shrink down to 512->256->128 (or other specified min/max size)\n  let inputTexture0 = source;\n\n  let viewport = engine.viewport;\n  let res = max_size;\n  while (res > viewport[2] || res > viewport[3]) {\n    res /= 2;\n  }\n\n  while (res > min_size) {\n    applyEffect({\n      shader: params.shader_copy || 'copy',\n      params: shader_params_default,\n      texs: [inputTexture0],\n      final: false,\n    }, res, res);\n    inputTexture0 = framebufferEnd({ filter_linear: true });\n    res /= 2;\n  }\n\n  // Do seperable blur\n  let sampleRadius = (params.blur || 1) / res;\n  shader_params_gaussian_blur.sampleRadius[0] = sampleRadius;\n  shader_params_gaussian_blur.sampleRadius[1] = 0;\n  shader_params_gaussian_blur.sampleRadius[2] = params.glow || 1;\n  applyEffect({\n    shader: 'gaussian_blur',\n    params: shader_params_gaussian_blur,\n    texs: [inputTexture0],\n    final: false,\n  }, res, res);\n  let blur = framebufferEnd({ filter_linear: true });\n\n  shader_params_gaussian_blur.sampleRadius[0] = 0;\n  shader_params_gaussian_blur.sampleRadius[1] = sampleRadius;\n  shader_params_gaussian_blur.sampleRadius[2] = params.glow || 1;\n  applyEffect({\n    shader: 'gaussian_blur',\n    params: shader_params_gaussian_blur,\n    texs: [blur],\n  });\n\n  return true;\n}\n\nexport function applyColorMatrix(params) {\n  if (!inited) {\n    startup();\n  }\n  let source = framebufferEnd({ filter_linear: true });\n\n  let matrix = params.colorMatrix;\n  let mout = shader_params_color_matrix.colorMatrix;\n\n  mout[0] = matrix[0];\n  mout[1] = matrix[3];\n  mout[2] = matrix[6];\n  mout[3] = matrix[9];\n  mout[4] = matrix[1];\n  mout[5] = matrix[4];\n  mout[6] = matrix[7];\n  mout[7] = matrix[10];\n  mout[8] = matrix[2];\n  mout[9] = matrix[5];\n  mout[10] = matrix[8];\n  mout[11] = matrix[11];\n\n  applyEffect({\n    shader: 'color_matrix',\n    params: shader_params_color_matrix,\n    texs: [source],\n  });\n\n  return true;\n}\n\n// // TODO: Update for RTBBCTT and port to new GLOV.js\n// export function applyDistortTODO(params) {\n//   let source = params.source;\n//   let dest = params.destination;\n//   let distort = params.distortion;\n//   if (!source || !dest || !distort || !dest.colorTexture0 ||\n//     source === dest.colorTexture0 || distort === dest.colorTexture0) {\n//     return false;\n//   }\n//\n//   // input transform.\n//   //  a b tx\n//   //  c d ty\n//   let a;\n//   let b;\n//   let c;\n//   let d;\n//   let tx;\n//   let ty;\n//\n//   let transform = params.transform;\n//   if (transform) {\n//     // transform col-major.\n//     a = transform[0];\n//     b = transform[2];\n//     tx = transform[4];\n//     c = transform[1];\n//     d = transform[3];\n//     ty = transform[5];\n//   } else {\n//     a = d = 1;\n//     b = c = 0;\n//     tx = ty = 0;\n//   }\n//\n//   let effectParams = this.effectParams;\n//   let techparams = this.distortParameters;\n//   effectParams.technique = this.distortTechnique;\n//   effectParams.params = techparams;\n//\n//   // TODO: Cache 'transform', 'invTransform', etc in the code below\n//   techparams.transform[0] = a;\n//   techparams.transform[1] = b;\n//   techparams.transform[2] = tx;\n//   techparams.transform[3] = c;\n//   techparams.transform[4] = d;\n//   techparams.transform[5] = ty;\n//\n//   // Compute inverse transform to use in distort texture displacement..\n//   let idet = 1 / (a * d - b * c);\n//   let ia = techparams.invTransform[0] = (idet * d);\n//   let ib = techparams.invTransform[1] = (idet * -b);\n//   let ic = techparams.invTransform[2] = (idet * -c);\n//   let id = techparams.invTransform[3] = (idet * a);\n//\n//   // Compute max pixel offset after transform for normalisation.\n//   let x1 = ((ia + ib) * (ia + ib)) + ((ic + id) * (ic + id));\n//   let x2 = ((ia - ib) * (ia - ib)) + ((ic - id) * (ic - id));\n//   let x3 = ((-ia + ib) * (-ia + ib)) + ((-ic + id) * (-ic + id));\n//   let x4 = ((-ia - ib) * (-ia - ib)) + ((-ic - id) * (-ic - id));\n//   let xmax = 0.5 * Math.sqrt(Math.max(x1, x2, x3, x4));\n//\n//   let strength = (params.strength || 10);\n//   techparams.strength[0] = strength / (source.width * xmax);\n//   techparams.strength[1] = strength / (source.height * xmax);\n//\n//   techparams.inputTexture0 = source;\n//   techparams.distortTexture = distort; // linear / repeat\n//   effectParams.destination = dest;\n//   this.applyEffect(effectParams);\n//\n//   return true;\n// }\n\nexport function clearAlpha() {\n  let old_dt = gl.getParameter(gl.DEPTH_TEST);\n  if (old_dt) {\n    gl.disable(gl.DEPTH_TEST);\n  }\n  gl.colorMask(false, false, false, true);\n  applyCopy({ source: textures.textures.white, no_framebuffer: true });\n  gl.colorMask(true, true, true, true);\n  if (old_dt) {\n    gl.enable(gl.DEPTH_TEST);\n  }\n}\n\nexport function effectsStartup(prelink_effects) {\n  prelink_effects.forEach((name) => {\n    shaders.prelink(getShader('vp_copy'), getShader(name));\n  });\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint-env browser */\n\n/* eslint-disable import/order */\nrequire('./bootstrap.js'); // Just in case it's not in app.js\n\nconst client_config = require('./client_config.js');\nexport let DEBUG = client_config.MODE_DEVELOPMENT;\n\nlet startup_funcs = [];\n\nexports.require = require; // For browser console debugging\n\nrequire('not_worker'); // This module cannot be required from a worker bundle\n\nconst assert = require('assert');\nconst { is_ios_safari } = require('./browser.js');\nconst { buildUIStartup } = require('./build_ui.js');\nconst camera2d = require('./camera2d.js');\nconst cmds = require('./cmds.js');\nconst effects = require('./effects.js');\nconst { effectsReset, effectsTopOfFrame, effectsIsFinal, effectsPassAdd, effectsPassConsume } = effects;\nconst {\n  errorReportDisable,\n  errorReportSetTimeAccum,\n  errorReportSetDetails,\n  glovErrorReportDisableSubmit,\n  glovErrorReportSetCrashCB,\n} = require('./error_report.js');\nconst glov_font = require('./font.js');\nconst { fontTick } = glov_font;\nconst { framebufferStart, framebufferEndOfFrame } = require('./framebuffer.js');\nconst geom = require('./geom.js');\nconst input = require('./input.js');\nconst local_storage = require('./local_storage.js');\nconst mat3FromMat4 = require('gl-mat3/fromMat4');\nconst mat4Copy = require('gl-mat4/copy');\nconst mat4Invert = require('gl-mat4/invert');\nconst mat4Mul = require('gl-mat4/multiply');\nconst mat4Transpose = require('gl-mat4/transpose');\nconst mat4Perspective = require('gl-mat4/perspective');\nconst { asin, cos, floor, min, max, PI, round, sin, sqrt } = Math;\nconst models = require('./models.js');\nconst perf = require('./perf.js');\nconst { profilerFrameStart, profilerGarbageEstimate } = require('./profiler.js');\nconst { profilerUIStartup } = require('./profiler_ui.js');\nconst { perfCounterTick } = require('glov/common/perfcounters.js');\nconst settings = require('./settings.js');\nconst shaders = require('./shaders.js');\nconst { shaderDebugUIStartup } = require('./shader_debug_ui.js');\nconst { soundLoading, soundStartup, soundTick } = require('./sound.js');\nconst { spotEndInput } = require('./spot.js');\nconst { blendModeReset, spriteDraw, spriteStartup } = require('./sprites.js');\nconst textures = require('./textures.js');\nconst { texturesTick } = textures;\nconst glov_transition = require('./transition.js');\nconst {\n  drawRect,\n  internal: {\n    cleanupDOMElems,\n    uiEndFrame,\n    uiSetFonts,\n    uiStartup,\n    uiTick,\n  },\n  uiBindSounds,\n} = require('./ui.js');\nconst urlhash = require('./urlhash.js');\nconst { callEach, clamp, nearSame, ridx } = require('glov/common/util.js');\nconst verify = require('glov/common/verify.js');\nconst {\n  mat3, mat4,\n  vec3, vec4, v3mulMat4, v3iNormalize, v4copy, v4same, v4set,\n} = require('glov/common/vmath.js');\n\nexport let canvas;\nexport let webgl2;\nexport let glov_particles;\n\nexport let width;\nexport let height;\nlet width_3d;\nlet height_3d;\nexport let pixel_aspect = 1;\nexport let dom_to_canvas_ratio = window.devicePixelRatio || 1;\nexport let antialias;\nexport let antialias_unavailable;\n\nexport let game_width;\nexport let game_height;\nlet game_aspect;\n\nexport let render_width;\nexport let render_height;\n\n//eslint-disable-next-line @typescript-eslint/no-use-before-define\nexport let defines = urlhash.register({ key: 'D', type: urlhash.TYPE_SET, change: definesChanged });\n\nexport let ZFAR;\nexport let ZNEAR;\nexport let fov_y = 1;\nexport let fov_x = 1;\n\nexport let mat_projection = mat4();\nexport let mat_view = mat4();\nlet mat_m = mat4();\nexport let mat_vp = mat4();\nlet mat_mv = mat4();\nlet mat_mv_no_skew = mat4();\nlet mat_mvp = mat4();\nlet mat_mv_inv_transform = mat3();\nlet mat_inv_view = mat3();\n// let projection_inverse = vec4();\n\nexport let light_diffuse = vec3(0.75, 0.75, 0.75);\nexport let light_ambient = vec3(0.25, 0.25, 0.25);\nexport let light_dir_ws = vec3(-1, -2, -3);\n\nexport let font;\nexport let app_state = null;\nexport const border_color = vec4(0, 0, 0, 1);\nexport let border_clear_color = vec4(0, 0, 0, 1);\n\nlet no_render = false;\n\nexport function disableRender(new_value) {\n  no_render = new_value;\n  if (no_render) {\n    cleanupDOMElems();\n  }\n}\n\nlet view_space_globals = [];\nexport function addViewSpaceGlobal(name) {\n  let ws_name = `${name}_ws`;\n  let ws_vec = shaders.globals[ws_name];\n  assert(ws_vec);\n  assert.equal(ws_vec.length, 3);\n  let vs_name = `${name}_vs`;\n  let vs_vec = vec3();\n  shaders.addGlobal(vs_name, vs_vec);\n  view_space_globals.push({\n    vs: vs_vec,\n    ws: ws_vec,\n  });\n}\n\nlet mat_temp = mat4();\nexport function setGlobalMatrices(_mat_view) {\n  mat4Copy(mat_view, _mat_view);\n  mat4Mul(mat_vp, mat_projection, mat_view);\n  v3iNormalize(light_dir_ws);\n  for (let ii = 0; ii < view_space_globals.length; ++ii) {\n    let vsg = view_space_globals[ii];\n    v3mulMat4(vsg.vs, vsg.ws, mat_view);\n  }\n  mat4Invert(mat_temp, mat_view);\n  mat3FromMat4(mat_inv_view, mat_temp);\n}\n\n// Just set up mat_vp and mat_projection\nexport function setMatVP(_mat_view) {\n  // eslint-disable-next-line @typescript-eslint/no-use-before-define\n  setupProjection(fov_y, width_3d, height_3d, ZNEAR, ZFAR);\n  mat4Copy(mat_view, _mat_view);\n  mat4Mul(mat_vp, mat_projection, mat_view);\n}\n\nexport function setFOV(fov_min) {\n  let w = width_3d;\n  let h = height_3d;\n  let aspect = w / h;\n  if (aspect > game_aspect) {\n    fov_y = fov_min;\n    let rise = sin(fov_y / 2) / cos(fov_y / 2) * aspect;\n    fov_x = 2 * asin(rise / sqrt(rise * rise + 1));\n  } else {\n    // Calculate what fov_x would be if the screen was game_aspect, then derive fov_y from that\n    let rise = sin(fov_min / 2) / cos(fov_min / 2) * game_aspect;\n    fov_x = 2 * asin(rise / sqrt(rise * rise + 1));\n    // Old method, just apply fov to x (it's the same thing, if game_aspect is 1.0)\n    // fov_x = fov_min;\n    let rise2 = sin(fov_x / 2) / cos(fov_x / 2) / aspect;\n    fov_y = 2 * asin(rise2 / sqrt(rise2 * rise2 + 1));\n  }\n}\n\nexport function setGameDims(w, h) {\n  game_width = w;\n  game_height = h;\n  game_aspect = game_width / game_height;\n}\n\n// Didn't need this for a while, but got slow on iOS recently :(\n// Better when using FBOs for postprocessing now, though!\nconst postprocessing_reset_version = '5';\nexport let postprocessing = local_storage.get('glov_no_postprocessing') !== postprocessing_reset_version;\nexport function postprocessingAllow(allow) {\n  local_storage.set('glov_no_postprocessing', allow ? undefined : postprocessing_reset_version);\n  postprocessing = allow;\n}\n\nexport function glCheckError() {\n  let gl_err = gl.getError();\n  if (gl_err) {\n    console.error(gl_err);\n    throw new Error(gl_err);\n  }\n}\n\nexport function releaseCanvas() {\n  try {\n    if (gl) {\n      let ext = gl.getExtension('WEBGL_lose_context');\n      if (ext) {\n        ext.loseContext();\n      }\n    }\n  } catch (ignored) {\n    // nothing, it's fine\n  }\n}\n\nexport function reloadSafe() {\n  // Do not report any errors after this point\n  errorReportDisable();\n  // Release canvas to not leak memory on Firefox\n  releaseCanvas();\n  if (window.FBInstant) {\n    try {\n      window.top.location.reload();\n    } catch (e) {\n      // Not good, but better than the alternatives, I guess\n      window.FBInstant.quit();\n    }\n  } else {\n    document.location.reload();\n  }\n}\nwindow.reloadSafe = reloadSafe;\n\nlet reloading_defines = {};\nexport function defineCausesReload(define) {\n  reloading_defines[define] = defines[define];\n}\ndefineCausesReload('FORCEWEBGL2');\ndefineCausesReload('NOWEBGL2');\nexport function definesChanged() {\n  for (let key in reloading_defines) {\n    if (defines[key] !== reloading_defines[key]) {\n      urlhash.onURLChange(reloadSafe);\n      break;\n    }\n  }\n  shaders.handleDefinesChanged();\n}\nexport function definesClearAll() {\n  let any_changed = false;\n  for (let key in defines) {\n    defines[key] = false;\n    any_changed = true;\n  }\n  if (any_changed) {\n    definesChanged();\n  }\n  return any_changed;\n}\n\nfunction normalizeRow(m, idx) {\n  let len = m[idx]*m[idx] + m[idx+1]*m[idx+1] + m[idx+2]*m[idx+2];\n  if (len > 0) {\n    len = 1 / sqrt(len);\n    m[idx] *= len;\n    m[idx+1] *= len;\n    m[idx+2] *= len;\n  }\n}\n\nexport function updateMatrices(mat_model) {\n  // PERFTODO: depending on rendering path, only some of these are needed (m + vp or just mvp)\n  mat4Copy(mat_m, mat_model);\n\n  mat4Mul(mat_mv, mat_view, mat_model);\n  mat4Mul(mat_mvp, mat_projection, mat_mv);\n  // TODO: Can expand and simplify all of this, especially below\n  // Compute the inverse transform of thee model_view matrix, discarding scale,\n  // to be used for getting normals into view space\n  mat4Copy(mat_temp, mat_model);\n  normalizeRow(mat_temp, 0);\n  normalizeRow(mat_temp, 4);\n  normalizeRow(mat_temp, 8);\n  mat4Mul(mat_mv_no_skew, mat_view, mat_temp);\n  mat4Invert(mat_temp, mat_mv_no_skew);\n  mat4Transpose(mat_temp, mat_temp);\n  mat3FromMat4(mat_mv_inv_transform, mat_temp);\n}\nexport let frame_timestamp = 0;\nexport function getFrameTimestamp() {\n  return frame_timestamp;\n}\n\nexport let frame_index = 0;\nexport function getFrameIndex() {\n  return frame_index;\n}\n\nexport let frame_dt = 0;\nexport function getFrameDt() {\n  return frame_dt;\n}\n\nexport let hrtime = 0;\n\n// Wall time, may contain large jumps, may be 0 or negative\nlet this_frame_time_actual = 0;\nexport function getFrameDtActual() {\n  return this_frame_time_actual;\n}\n\nlet after_loading_state = null;\nexport let is_loading = true;\nexport function setState(new_state) {\n  if (is_loading) {\n    after_loading_state = new_state;\n  } else {\n    app_state = new_state;\n  }\n}\n\nexport function stateActive(test_state) {\n  if (is_loading) {\n    return after_loading_state === test_state;\n  } else {\n    return app_state === test_state;\n  }\n}\n\nlet mspf = 1000;\nlet mspf_update_time = 0;\nlet mspf_frame_count = 0;\nlet last_tick_cpu = 0;\nlet mspf_tick = 1000;\n// let net_time = 1000;\nlet mspf_tick_accum = 0;\n// let net_time_accum = 0;\nlet garbage_estimate = 0;\nexport const PERF_HISTORY_SIZE = 128;\nexport let perf_state = window.glov_perf_state = {\n  fpsgraph: {\n    index: 0,\n    history: new Float32Array(PERF_HISTORY_SIZE * 2),\n  },\n  gpu_mem: {\n    tex: 0,\n    geom: 0,\n  },\n};\nlet fpsgraph = perf_state.fpsgraph;\n\nperf.addMetric({\n  name: 'fps',\n  show_stat: 'show_fps', // always, if we're showing any metrics\n  show_graph: 'fps_graph',\n  labels: {\n    'fps: ': () => (1000 / mspf).toFixed(1),\n    'ms/f: ': () => mspf.toFixed(0),\n    'cpu: ': () => mspf_tick.toFixed(0),\n    'gc/f: ': () => (garbage_estimate ? garbage_estimate.toFixed(1) : ''),\n    // 'net: ': () => net_time.toFixed(0),\n  },\n  data: fpsgraph, // contain .index and .history (stride of colors.length)\n  line_scale_top: 50,\n  colors: [\n    // vec4(0.161, 0.678, 1, 1), // net time\n    vec4(1, 0.925, 0.153, 1), // cpu/tick time\n    vec4(0, 0.894, 0.212, 1), // total time (GPU)\n  ],\n}, true);\n\nlet do_borders = true;\nlet do_viewport_postprocess = false;\nlet need_repos = 0;\n\nexport function resizing() {\n  return need_repos;\n}\n\nlet app_tick_functions = [];\nexport function addTickFunc(cb) {\n  app_tick_functions.push(cb);\n}\n\nexport function removeTickFunc(cb) {\n  let idx = app_tick_functions.indexOf(cb);\n  if (idx !== -1) {\n    app_tick_functions.splice(idx, 1);\n    return true;\n  }\n  return false;\n}\n\nlet post_tick = [];\nexport function postTick(opts) {\n  opts.ticks = opts.ticks || 1; // run in how many ticks?\n  opts.inactive = opts.inactive || false; // run even if inactive?\n  assert.equal(typeof opts.fn, 'function');\n  post_tick.push(opts);\n}\n\nlet pre_sprite_render = null;\nexport function preSpriteRender(fn) {\n  if (!pre_sprite_render) {\n    pre_sprite_render = [];\n  }\n  pre_sprite_render.push(fn);\n}\n\nlet post_render = null;\nexport function postRender(fn) {\n  if (!post_render) {\n    post_render = [];\n  }\n  post_render.push(fn);\n}\n\nfunction resetEffects() {\n  effectsReset();\n  framebufferEndOfFrame();\n}\n\nexport function renderWidth() {\n  return render_width || width;\n}\nexport function renderHeight() {\n  return render_height || height;\n}\n\nconst SAFARI_FULLSCREEN_ASPECT = (function () {\n  let screen = window.screen;\n  if (!is_ios_safari || !screen) {\n    return 0;\n  }\n  const SAFARI_DIMS = { // wxh : [fullscreen aspect]\n    // iPhone XR\n    // iPhone 11 Pro Max\n    // iPhone XS Max\n    // iPhone 11\n    '896,414': 896/414,\n    // iPhone 11 Pro\n    // iPhone X (probably)\n    '812,375': 812/375,\n    // iPhone 8 Plus\n    '736,414': 736/414,\n    // iPhone 6s+\n    // iPhone 6+\n    '716,414': 736/414, // (screen.availWidth reports 20 less)\n    // iPhone 8\n    // iPhone 7 (10.1)\n    // iPhone 7 (11.4)\n    '667,375': 667/375,\n    // iPhone 6s\n    // iPhone 6\n    '647,375': 667/375, // (screen.availWidth reports 20 less)\n    // iPhone 5s\n    '548,320': 568/320, // (screen.availWidth reports 20 less)\n  };\n  let key = `${max(screen.availWidth, screen.availHeight)},${min(screen.availWidth, screen.availHeight)}`;\n  return SAFARI_DIMS[key] || 0;\n}());\nfunction safariTopSafeArea(view_w, view_h) {\n  // Detect if the URL bar is hidden, but should be a safe area\n  if (SAFARI_FULLSCREEN_ASPECT && nearSame(view_w/view_h, SAFARI_FULLSCREEN_ASPECT, 0.001)) {\n    // Note: if user has scaling enabled, the padding required might be different\n    //   but the same holds true for the safe area padding detected via CSS!\n    return 50 * (window.devicePixelRatio || 1); // seems to be 50pts on all devices\n  }\n  return 0;\n}\n\n\nlet last_canvas_width;\nlet last_canvas_height;\nlet last_body_height;\nlet safearea_elem;\nlet safearea_ignore_bottom = false;\nlet safearea_values = [0,0,0,0];\nlet last_safearea_values = [0,0,0,0];\nfunction checkResize() {\n  profilerStart('checkResize');\n  // use VisualViewport on at least iOS Safari - deal with tabs and keyboard\n  //   shrinking the viewport without changing the window height\n  let vv = window.visualViewport || {};\n  dom_to_canvas_ratio = window.devicePixelRatio || 1;\n  dom_to_canvas_ratio *= settings.render_scale_all;\n  let view_w = (vv.width || window.innerWidth);\n  let view_h = (vv.height || window.innerHeight);\n  if (view_h !== last_body_height) {\n    // set this *before* getting canvas and safearea_elem dims below\n    last_body_height = view_h;\n    if (document.body) {\n      document.body.style.height = `${view_h}px`;\n    }\n  }\n  let rect = canvas.getBoundingClientRect();\n  let new_width = round(rect.width * dom_to_canvas_ratio) || 1;\n  let new_height = round(rect.height * dom_to_canvas_ratio) || 1;\n\n  if (cmds.safearea[0] === -1) {\n    if (safearea_elem) {\n      let sa_width = safearea_elem.offsetWidth;\n      let sa_height = safearea_elem.offsetHeight;\n      if (sa_width && sa_height) {\n        v4set(safearea_values,\n          safearea_elem.offsetLeft * dom_to_canvas_ratio,\n          new_width - (sa_width + safearea_elem.offsetLeft) * dom_to_canvas_ratio,\n          max(safearea_elem.offsetTop * dom_to_canvas_ratio,\n            safariTopSafeArea(view_w, view_h) * settings.render_scale_all),\n          // Note: Possibly ignoring bottom safe area, it seems not useful on iPhones (does not\n          //  adjust when keyboard is up, only obscured in the middle, if obeying left/right safe area)\n          safearea_ignore_bottom ? 0 : new_height - (sa_height + safearea_elem.offsetTop) * dom_to_canvas_ratio);\n      }\n    }\n  } else {\n    v4set(safearea_values,\n      new_width * clamp(cmds.safearea[0], 0, 25)/100,\n      new_width * clamp(cmds.safearea[1], 0, 25)/100,\n      new_height * clamp(cmds.safearea[2], 0, 25)/100,\n      new_height * clamp(cmds.safearea[3], 0, 25)/100);\n  }\n  if (!v4same(safearea_values, last_safearea_values)) {\n    v4copy(last_safearea_values, safearea_values);\n    camera2d.setSafeAreaPadding(safearea_values[0], safearea_values[1], safearea_values[2], safearea_values[3]);\n    need_repos = max(need_repos, 1);\n  }\n\n  if (new_width !== last_canvas_width || new_height !== last_canvas_height) {\n    window.pixel_scale = dom_to_canvas_ratio; // for debug\n    last_canvas_width = canvas.width = new_width || 1;\n    last_canvas_height = canvas.height = new_height || 1;\n\n    width = canvas.width;\n    height = canvas.height;\n\n    // For the next 10 frames, make sure font size is correct\n    need_repos = 10;\n  }\n  if (is_ios_safari && (window.visualViewport || need_repos)) {\n    // we have accurate view information, or screen was just rotated / resized\n    // force scroll to top\n    window.scroll(0,0);\n  }\n  profilerStop('checkResize');\n}\n\nexport let viewport = vec4(0,0,1,1);\nexport function setViewport(xywh) {\n  v4copy(viewport, xywh);\n  gl.viewport(xywh[0], xywh[1], xywh[2], xywh[3]);\n}\n\nlet frames_requested = 0;\nfunction requestFrame(user_time) {\n  let max_fps = settings.max_fps;\n  let desired_frames = (max_fps >= 250) ? 10 : 1;\n  if (frames_requested >= desired_frames) {\n    return;\n  }\n  if (defines.SLOWLOAD && is_loading) {\n    // Safari on CrossBrowserTesting needs this in order to have some time to load/decode audio data\n    // TODO: Instead, generally, if loading, compare last_tick_cpu vs dt, and if\n    //   we're not idle for at least half of the time and we have *internal*\n    //   loads (textures, sounds, models, NOT user code), delay so that we are.\n    max_fps = 2;\n  }\n  if (desired_frames > 1) {\n    // Ensure we have at least that many frames queued up at any point in time, so they\n    // can fire at less than the normal 4ms browser delay of setTimeout()\n    while (frames_requested < desired_frames) {\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      setTimeout(tick, 1);\n      frames_requested++;\n    }\n  } else if (max_fps) {\n    let desired_delay = max(0, round(1000 / max_fps - (user_time || 0)));\n    frames_requested++;\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    setTimeout(tick, desired_delay);\n  } else {\n    frames_requested++;\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    requestAnimationFrame(tick);\n  }\n}\n\nlet mat_projection_10;\nexport let had_3d_this_frame;\n\nexport function clearHad3DThisFrame() {\n  had_3d_this_frame = false;\n}\n\nexport function setupProjection(use_fov_y, use_width, use_height, znear, zfar) {\n  mat4Perspective(mat_projection, use_fov_y, use_width/use_height, znear, zfar);\n  mat_projection_10 = mat_projection[10];\n  // v4set(projection_inverse,\n  //   2 / (use_width * mat_projection[0]), // projection_matrix.m00),\n  //   2 / (use_height * mat_projection[5]), // projection_matrix.m11),\n  //   -(1 + mat_projection[8]) / mat_projection[0], // projection_matrix.m20) / projection_matrix.m00,\n  //   -(1 + mat_projection[9]) / mat_projection[5] // projection_matrix.m21) / projection_matrix.m11\n  // );\n}\n\nexport function setZRange(znear, zfar) {\n  ZNEAR = znear;\n  ZFAR = zfar;\n  if (had_3d_this_frame) {\n    setupProjection(fov_y, width_3d, height_3d, ZNEAR, ZFAR);\n  }\n}\n\nfunction set3DRenderResolution(w, h) {\n  width_3d = w;\n  height_3d = h;\n}\n\nlet want_render_scale_3d_this_frame;\nlet had_render_scale_3d_this_frame;\nexport function start3DRendering(opts) {\n  opts = opts || {};\n  if (opts.width) {\n    set3DRenderResolution(opts.width, opts.height);\n  }\n  setFOV(opts.fov || (settings.fov * PI / 180));\n  had_3d_this_frame = true;\n  if (!opts.width && want_render_scale_3d_this_frame && !defines.NOCOPY) {\n    had_render_scale_3d_this_frame = true;\n    effectsPassAdd();\n  }\n  blendModeReset(true);\n  gl.enable(gl.BLEND);\n  gl.enable(gl.DEPTH_TEST);\n  gl.depthMask(true);\n  let backbuffer_width = width_3d;\n  let backbuffer_height = height_3d;\n  if (opts.viewport) {\n    // Rendering to a viewport within the backbuffer, and postprocessing must be\n    // UI-level and want to grab the whole thing.\n    backbuffer_width = render_width || width;\n    backbuffer_height = render_height || height;\n  }\n  framebufferStart({\n    width: backbuffer_width,\n    height: backbuffer_height,\n    final: effectsIsFinal(),\n    need_depth: opts.need_depth || true,\n    clear: true,\n    clear_all: opts.clear_all === undefined ? settings.render_scale_clear : opts.clear_all,\n    viewport: opts.viewport,\n  });\n\n  setupProjection(fov_y, width_3d, height_3d, ZNEAR, ZFAR);\n\n  gl.enable(gl.CULL_FACE);\n}\n\nfunction renderScaleFinish() {\n  if (defines.NOCOPY) {\n    gl.disable(gl.SCISSOR_TEST);\n    v4set(viewport, 0, 0, width, height);\n    gl.viewport(viewport[0], viewport[1], viewport[2], viewport[3]);\n  } else {\n    effectsPassConsume();\n    if (settings.render_scale_mode === 2) {\n      effects.applyPixelyExpand({ final: effectsIsFinal(), clear: false });\n    } else {\n      effects.applyCopy({ filter_linear: settings.render_scale_mode === 0 });\n    }\n  }\n}\n\nexport function startSpriteRendering() {\n  gl.disable(gl.CULL_FACE);\n  blendModeReset(true);\n  gl.enable(gl.BLEND);\n  gl.disable(gl.DEPTH_TEST);\n  gl.depthMask(false);\n}\n\nexport function projectionZBias(dist, at_z) {\n  if (!dist) {\n    mat_projection[10] = mat_projection_10;\n    return;\n  }\n  //let e = 2 * ZFAR * ZNEAR / (ZFAR - ZNEAR) * (dist / (at_z * (at_z + dist)));\n  let e = 0.2 * (dist / (at_z * (at_z + dist)));\n  e = max(e, 2e-7);\n  mat_projection[10] = mat_projection_10 + e;\n}\n\nexport function fixNatives(is_startup) {\n  // If any browser extensions have added things to the Array prototype, remove them!\n  let b = [];\n  for (let a in b) {\n    console[is_startup ? 'log' : 'error'](`Found invasive enumerable property \"${a}\" on Array.prototype, removing...`);\n    let old_val = b[a];\n    errorReportSetDetails(`had_native_${a}`, typeof old_val);\n    delete Array.prototype[a];\n    // If this fails to work, perhaps try using Object.preventExtensions(Array.prototype) in an inline header script?\n    // eslint-disable-next-line no-extend-native\n    Object.defineProperty(Array.prototype, a, { value: old_val, enumerable: false });\n  }\n  for (let a in b) {\n    // Failed: code that iterates arrays will fail\n    assert(false, `Array.prototype has unremovable member ${a}`);\n  }\n}\n\nfunction resetState() {\n  // Only geom.geomResetState appears to have been strictly needed to work around\n  //  a bug on Chrome 71, but doing the rest of this to be safe.\n  profilerStart('resetState');\n  profilerStart('textures');\n  textures.texturesResetState();\n  profilerStopStart('shaders');\n  shaders.shadersResetState();\n  profilerStopStart('geom;gl');\n  geom.geomResetState();\n\n  // These should already be true:\n  blendModeReset(true);\n  // gl.disable(gl.BLEND);\n  gl.enable(gl.BLEND);\n  // gl.disable(gl.DEPTH_TEST);\n  gl.enable(gl.DEPTH_TEST);\n  // gl.depthMask(false);\n  gl.depthMask(true);\n  // gl.disable(gl.CULL_FACE);\n  gl.enable(gl.CULL_FACE);\n  // gl.depthFunc(gl.GEQUAL);\n  gl.depthFunc(gl.LEQUAL);\n  // gl.enable(gl.SCISSOR_TEST);\n  gl.disable(gl.SCISSOR_TEST);\n  // gl.cullFace(gl.FRONT);\n  gl.cullFace(gl.BACK);\n  gl.viewport(0, 0, width, height);\n  profilerStop();\n  profilerStop('resetState');\n}\n\nlet in_background = false;\nlet enter_background_cb = [];\nlet exit_background_cb = [];\nexport function isInBackground() {\n  return in_background;\n}\nexport function onEnterBackground(fn) {\n  enter_background_cb.push(fn);\n}\nexport function onExitBackground(fn) {\n  exit_background_cb.push(fn);\n}\n\nexport const hrnow = window.performance ? window.performance.now.bind(window.performance) : Date.now.bind(Date);\n\nlet last_tick = 0;\nfunction tick(timestamp) {\n  profilerFrameStart();\n  profilerStart('tick');\n  profilerStart('top');\n  frames_requested--;\n  // if (timestamp < 1e12) { // high resolution timer\n  //   this ends up being a value way back in time, relative to what hrnow() returns,\n  //   and even back in time relative to input events already dispatched,\n  //   causing timing confusion, so ignore it, just call hrnow()\n  //   hrtime = timestamp;\n  // } else { // probably integer milliseconds since epoch, or nothing\n  hrtime = hrnow();\n  // }\n  let now = round(hrtime); // Code assumes integer milliseconds\n  if (!last_tick) {\n    last_tick = now;\n  }\n  this_frame_time_actual = now - last_tick;\n  let dt = min(max(this_frame_time_actual, 1), 250);\n  frame_dt = dt;\n  last_tick = now;\n  frame_timestamp += dt;\n  ++frame_index;\n  errorReportSetTimeAccum(frame_timestamp);\n\n  fixNatives(false);\n\n  // let this_net_time = wsclient.getNetTime();\n  // fpsgraph.history[(fpsgraph.index % PERF_HISTORY_SIZE) * 3 + 0] = this_net_time;\n  fpsgraph.history[(fpsgraph.index % PERF_HISTORY_SIZE) * 2 + 1] = this_frame_time_actual;\n  fpsgraph.index++;\n  fpsgraph.history[(fpsgraph.index % PERF_HISTORY_SIZE) * 2 + 0] = 0;\n\n  ++mspf_frame_count;\n  mspf_tick_accum += last_tick_cpu;\n  // net_time_accum += this_net_time;\n  if (now - mspf_update_time > settings.fps_window * 1000) {\n    if (!mspf_update_time) {\n      mspf_update_time = now;\n    } else {\n      mspf = (now - mspf_update_time) / mspf_frame_count;\n      mspf_tick = mspf_tick_accum / mspf_frame_count;\n      mspf_tick_accum = 0;\n      garbage_estimate = profilerGarbageEstimate() / 1024;\n      // net_time = net_time_accum / mspf_frame_count;\n      // net_time_accum = 0;\n      mspf_frame_count = 0;\n      mspf_update_time = now;\n    }\n  }\n\n  perfCounterTick(dt);\n\n  effectsTopOfFrame();\n\n  if (document.hidden || document.webkitHidden || no_render) {\n    resetEffects();\n    input.tickInputInactive();\n    last_tick_cpu = 0;\n    for (let ii = post_tick.length - 1; ii >= 0; --ii) {\n      if (post_tick[ii].inactive && !--post_tick[ii].ticks) {\n        post_tick[ii].fn();\n        ridx(post_tick, ii);\n      }\n    }\n    requestFrame();\n    profilerStop();\n    return profilerStop('tick');\n  }\n  if (in_background) {\n    in_background = false;\n    callEach(exit_background_cb);\n  }\n\n  checkResize();\n  had_3d_this_frame = false;\n  want_render_scale_3d_this_frame = false;\n  had_render_scale_3d_this_frame = false;\n  if (render_width) {\n    // render_scale not supported with render_width, doesn't make much sense, just use render_width\n    set3DRenderResolution(render_width, render_height);\n    effectsPassAdd();\n  } else {\n    width_3d = max(1, round(width * settings.render_scale));\n    height_3d = max(1, round(height * settings.render_scale));\n    if (width_3d !== width) {\n      want_render_scale_3d_this_frame = true;\n    }\n  }\n\n  resetState();\n\n  textures.bind(0, textures.textures.error);\n\n  fontTick();\n  camera2d.tickCamera2D();\n  glov_transition.render(dt);\n  camera2d.setAspectFixed(game_width, game_height);\n\n  profilerStopStart('mid');\n\n  soundTick(dt);\n  input.tickInput();\n  uiTick(dt);\n\n  if (need_repos) {\n    --need_repos;\n    let ul = [];\n    camera2d.virtualToDom(ul, [0,0]);\n    let lr = [];\n    camera2d.virtualToDom(lr, [game_width-1,game_height-1]);\n    let viewport2 = [ul[0], ul[1], lr[0], lr[1]];\n    let view_height = viewport2[3] - viewport2[1];\n    // default font size of 16 when at height of game_height\n    let font_size = min(256, max(2, floor(view_height/800 * 16)));\n    let elem_fullscreen = document.getElementById('fullscreen');\n    if (elem_fullscreen) {\n      elem_fullscreen.style['font-size'] = `${font_size}px`;\n    }\n  }\n\n  if (do_borders) {\n    // Borders\n    drawRect(camera2d.x0Real(), camera2d.y0Real(), camera2d.x1Real(), 0, Z.BORDERS, border_color);\n    drawRect(camera2d.x0Real(), game_height, camera2d.x1Real(), camera2d.y1Real(), Z.BORDERS, border_color);\n    drawRect(camera2d.x0Real(), 0, 0, game_height, Z.BORDERS, border_color);\n    drawRect(game_width, 0, camera2d.x1Real(), game_height, Z.BORDERS, border_color);\n  }\n\n  perf.draw();\n\n  profilerStopStart('app_state');\n  for (let ii = 0; ii < app_tick_functions.length; ++ii) {\n    app_tick_functions[ii](dt);\n  }\n  if (app_state) {\n    app_state(dt);\n  }\n\n  profilerStopStart('bottom');\n  spotEndInput();\n  glov_particles.tick(dt); // *after* app_tick, so newly added/killed particles can be queued into the draw list\n\n  if (had_3d_this_frame) {\n    if (had_render_scale_3d_this_frame) {\n      renderScaleFinish();\n    }\n  } else {\n    // delayed clear (and general GL init) until after app_state, app might change clear color\n    if (render_width) {\n      // assert(!effectsIsFinal());\n      framebufferStart({\n        width: render_width,\n        height: render_height,\n        clear: true,\n        clear_all: settings.render_scale_clear, // Not sure if this is ever faster in this case?\n        final: effectsIsFinal(),\n        need_depth: false,\n      });\n    } else {\n      framebufferStart({\n        width,\n        height,\n        clear: true,\n        final: effectsIsFinal(),\n        need_depth: false,\n      });\n    }\n  }\n\n  if (pre_sprite_render) {\n    callEach(pre_sprite_render, pre_sprite_render = null);\n  }\n\n  startSpriteRendering();\n  spriteDraw();\n\n  uiEndFrame();\n\n  if (post_render) {\n    callEach(post_render, post_render = null);\n  }\n\n  if (render_width) {\n    effectsPassConsume();\n    let final_viewport = [\n      camera2d.render_offset_x, camera2d.render_offset_y_bottom,\n      camera2d.render_viewport_w, camera2d.render_viewport_h\n    ];\n    let params = {\n      clear: true,\n      clear_all: true,\n      clear_color: border_clear_color,\n      viewport: final_viewport,\n    };\n    if (do_viewport_postprocess) {\n      effects.applyPixelyExpand(params);\n    } else {\n      effects.applyCopy(params);\n    }\n  }\n\n  input.endFrame();\n  resetEffects();\n  texturesTick();\n\n  for (let ii = post_tick.length - 1; ii >= 0; --ii) {\n    if (!--post_tick[ii].ticks) {\n      post_tick[ii].fn();\n      ridx(post_tick, ii);\n    }\n  }\n\n  last_tick_cpu = hrnow() - now;\n  fpsgraph.history[(fpsgraph.index % PERF_HISTORY_SIZE) * 2 + 0] = last_tick_cpu;\n  requestFrame(hrnow() - hrtime);\n  profilerStop('bottom');\n  return profilerStop('tick');\n}\n\nlet blurred = false;\nfunction onBlur(evt) {\n  blurred = true;\n}\n\nfunction onFocus(evt) {\n  blurred = false;\n}\n\nfunction periodiclyRequestFrame() {\n  requestFrame();\n  setTimeout(periodiclyRequestFrame, 1000);\n\n  if (!in_background && blurred) {\n    let now = round(hrnow());\n    if (now - last_tick > 400) {\n      in_background = true;\n      callEach(enter_background_cb);\n    }\n  }\n}\n\n// Must be called out-of-frame (use setTimeout) if not at startup\nexport function setPixelyStrict(on) {\n  if (on) {\n    render_width = game_width;\n    render_height = game_height;\n  } else {\n    render_width = undefined;\n    render_height = undefined;\n  }\n}\n\nexport function getViewportPostprocess() {\n  return do_viewport_postprocess;\n}\nexport function setViewportPostprocess(viewport_postprocess) {\n  do_viewport_postprocess = viewport_postprocess;\n}\n\nexport function setFonts(new_font, title_font) {\n  font = new_font;\n  uiSetFonts(new_font, title_font);\n}\n\nexport function engineStartupFunc(func) {\n  startup_funcs.push(func);\n}\n\nexport function startup(params) {\n  fixNatives(true);\n\n  canvas = document.getElementById('canvas');\n  safearea_elem = document.getElementById('safearea');\n\n  glovErrorReportSetCrashCB(function () {\n    setTimeout(requestFrame, 1);\n  });\n  if (params.error_report === false) {\n    glovErrorReportDisableSubmit();\n  }\n\n  if (DEBUG && !window.spector) {\n    // Add check to catch common error of `const FOO=10; for (let i=0; i < FOO.length; i++) {}`\n    // eslint-disable-next-line no-extend-native\n    Object.defineProperty(Number.prototype, 'length', {\n      get: function () {\n        assert(false, 'Numbers do not have a length property');\n        return undefined;\n      }\n    });\n  }\n\n  safearea_ignore_bottom = params.safearea_ignore_bottom || false;\n\n  // resize the canvas to fill browser window dynamically\n  window.addEventListener('resize', checkResize, false);\n  checkResize();\n\n  let is_pixely = params.pixely && params.pixely !== 'off';\n  antialias = params.antialias || !is_pixely && params.antialias !== false;\n  let powerPreference = params.high ? 'high-performance' : 'default';\n  let context_names = ['webgl2', 'webgl', 'experimental-webgl'];\n  let force_webgl1 = defines.NOWEBGL2;\n  let disable_data = local_storage.getJSON('webgl2_disable');\n  // Check if a previous, recent run had an error that hinted we should disable WebGL2\n  if (disable_data && disable_data.ua === navigator.userAgent && disable_data.ts > Date.now() - 7*24*60*60*1000) {\n    console.log('Disabling WebGL2 because a previous run encountered a related error');\n    force_webgl1 = true;\n  }\n  if (DEBUG && !defines.FORCEWEBGL2) {\n    let rc = local_storage.getJSON('run_count', 0) + 1;\n    local_storage.setJSON('run_count', rc);\n    if (rc % 2) {\n      force_webgl1 = true;\n    }\n  }\n  if (force_webgl1) {\n    context_names.splice(0, 1);\n  }\n  let context_opts = [\n    { antialias, powerPreference, alpha: false },\n    { powerPreference, alpha: false },\n    { antialias, alpha: false },\n    { alpha: false },\n    {},\n  ];\n  let good = false;\n  webgl2 = false;\n  for (let i = 0; !good && i < context_names.length; i += 1) {\n    for (let jj = 0; !good && jj < context_opts.length; ++jj) {\n      try {\n        window.gl = canvas.getContext(context_names[i], context_opts[jj]);\n        if (window.gl) {\n          if (context_names[i] === 'webgl2') {\n            webgl2 = true;\n          }\n          if (antialias && !context_opts[jj].antialias) {\n            antialias_unavailable = true;\n            antialias = false;\n          }\n          good = true;\n          break;\n        }\n      } catch (e) {\n        // ignore\n      }\n    }\n  }\n  if (!window.requestAnimationFrame) {\n    // SamsungBrowser/1.1 - apparently has WebGL, but not requestAnimationFrame; also not binary WebSockets\n    good = false;\n  }\n  if (!good) {\n    // eslint-disable-next-line no-alert\n    window.alert('Sorry, but your browser does not support WebGL or does not have it enabled.');\n    document.getElementById('loading').style.visibility = 'hidden';\n    document.getElementById('nowebgl').style.visibility = 'visible';\n    return false;\n  }\n  let nocanvas = document.getElementById('nocanvas');\n  if (verify(nocanvas)) {\n    // hide the interior of the <canvas> elements, so that the get.webgl.org link is not focusable!\n    nocanvas.style.visibility = 'hidden';\n  }\n  console.log(`Using WebGL${webgl2?2:1}`);\n\n  assert(gl);\n  canvas.focus();\n  setGameDims(params.game_width || 1280, params.game_height || 960);\n  ZNEAR = params.znear || 0.7;\n  ZFAR = params.zfar || 10000;\n  setPixelyStrict(params.pixely === 'strict');\n  if (params.viewport_postprocess) {\n    do_viewport_postprocess = true;\n  }\n  pixel_aspect = params.pixel_aspect || 1;\n\n  gl.depthFunc(gl.LEQUAL);\n  // gl.enable(gl.SCISSOR_TEST);\n  gl.cullFace(gl.BACK);\n  gl.clearColor(0, 0.1, 0.2, 1);\n  gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1); // Allow RGB texture data with non-mult-4 widths\n\n  textures.startup();\n  geom.startup();\n  shaders.startup({\n    light_diffuse,\n    light_dir_ws,\n    ambient: light_ambient,\n    mat_m: mat_m,\n    mat_mv: mat_mv,\n    mat_vp: mat_vp,\n    mvp: mat_mvp,\n    mv_inv_trans: mat_mv_inv_transform,\n    mat_inv_view: mat_inv_view,\n    view: mat_view,\n    projection: mat_projection,\n    // projection_inverse,\n  });\n  addViewSpaceGlobal('light_dir');\n  camera2d.startup();\n  spriteStartup();\n  input.startup(canvas, params);\n  models.startup();\n\n  window.addEventListener('blur', onBlur, false);\n  window.addEventListener('focus', onFocus, false);\n\n  /* eslint-disable global-require */\n  glov_particles = require('./particles.js').create();\n\n  if (is_pixely) {\n    textures.defaultFilters(gl.NEAREST, gl.NEAREST);\n    settings.runTimeDefault('render_scale_mode', 1);\n  } else {\n    textures.defaultFilters(gl.LINEAR_MIPMAP_LINEAR, gl.LINEAR);\n  }\n\n  assert(params.font);\n  // If not, something like:\n  // const font_info_04b03x2 = require('../img/font/04b03_8x2.json');\n  // const font_info_04b03x1 = require('../img/font/04b03_8x1.json');\n  // const font_info_palanquin32 = require('../img/font/palanquin32.json');\n  // if (params.pixely === 'strict') {\n  //   font = glov_font.create(font_info_04b03x1, 'font/04b03_8x1');\n  // } else if (is_pixely) {\n  //   font = glov_font.create(font_info_04b03x2, 'font/04b03_8x2');\n  // } else {\n  //   font = glov_font.create(font_info_palanquin32, 'font/palanquin32');\n  // }\n  params.font = font = glov_font.create(params.font.info, params.font.texture);\n  if (params.title_font) {\n    params.title_font = glov_font.create(params.title_font.info, params.title_font.texture);\n  }\n  uiStartup(params);\n\n  soundStartup(params.sound);\n  uiBindSounds(params.ui_sounds);\n\n  buildUIStartup();\n  shaderDebugUIStartup();\n  profilerUIStartup();\n\n  callEach(startup_funcs, startup_funcs = null);\n\n  camera2d.setAspectFixed(game_width, game_height);\n\n  if (params.state) {\n    setState(params.state);\n  }\n  if (params.do_borders !== undefined) {\n    do_borders = params.do_borders;\n  }\n  if (params.show_fps !== undefined) {\n    settings.show_fps = params.show_fps;\n  }\n\n  periodiclyRequestFrame();\n  return true;\n}\n\nexport function loadsPending() {\n  return textures.load_count + soundLoading() + models.load_count;\n}\n\nfunction loading() {\n  let load_count = loadsPending();\n  let elem_loading_text = document.getElementById('loading_text');\n  if (elem_loading_text) {\n    elem_loading_text.innerText = `Loading (${load_count})...`;\n  }\n  if (!load_count) {\n    is_loading = false;\n    app_state = after_loading_state;\n    // Clear after next frame, so something is rendered to the canvas\n    postTick({\n      ticks: 2,\n      fn: function () {\n        let loading_elem = document.getElementById('loading');\n        if (loading_elem) {\n          loading_elem.style.visibility = 'hidden';\n        }\n      }\n    });\n  }\n}\napp_state = loading;\n\nwindow.glov_engine = exports;\n","import assert from 'assert';\nimport { ErrorCallback } from 'glov/common/types';\nimport { setAbilityReload } from './client_config';\nimport { cmd_parse } from './cmds';\nimport { netForceDisconnect } from './net';\nimport * as urlhash from './urlhash';\n\nexport interface EnvironmentConfig {\n  name: string;\n  link_base?: string;\n  api_path?: string;\n}\n\nlet all_environments: Partial<Record<string, EnvironmentConfig>> = {};\nlet current_environment: EnvironmentConfig | null = null;\nlet default_environment: EnvironmentConfig | null = null;\n\nlet link_base: string;    // Link base like http://foo.bar/ (with trailing slash)\nlet api_path: string;     // API base like http://foo.bar/api/ (with trailing slash)\nlet texture_base: string; // Texture base like http://foo.bar/ (with trailing slash)\n\nfunction applyEnvironment(): void {\n  link_base = (current_environment && current_environment.link_base) || urlhash.getURLBase();\n  api_path = (current_environment && current_environment.api_path) || `${link_base}api/`;\n  texture_base = link_base.replace('//localhost:', '//127.0.0.1:');\n}\n\n// Default initialization\napplyEnvironment();\n\nexport function getCurrentEnvironment<T extends EnvironmentConfig>(): T | null {\n  return current_environment as (T | null);\n}\nexport function setCurrentEnvironment(environment_name: string | undefined | null): void {\n  let prev_environment = current_environment;\n  current_environment = (environment_name && all_environments[environment_name]) || default_environment;\n  if (current_environment !== prev_environment) {\n    applyEnvironment();\n    setAbilityReload(false);\n    netForceDisconnect();\n  }\n}\n\nexport function getLinkBase(): string {\n  return link_base;\n}\nexport function getAPIPath(): string {\n  return api_path;\n}\nexport function getExternalTextureURL(url: string): string {\n  return url.match(/^.{2,7}:/) ? url : `${texture_base}${url}`;\n}\n\nexport function environmentsInit<T extends EnvironmentConfig>(\n  environments: Array<T>,\n  default_environment_name?: string | undefined | null,\n): void {\n  all_environments = {};\n  let all_names = [];\n  for (let i = 0, len = environments.length; i < len; i++) {\n    let env = environments[i];\n    let env_name = env.name;\n    assert(env_name.length > 0);\n    all_environments[env_name] = env;\n    all_names.push(env_name);\n  }\n\n  current_environment = default_environment =\n    (default_environment_name && all_environments[default_environment_name]) || null;\n  applyEnvironment();\n\n  if (!all_names.some((name) => name.toLowerCase() === 'default')) {\n    all_names.push('default');\n  }\n  cmd_parse.registerValue('environment', {\n    type: cmd_parse.TYPE_STRING,\n    help: 'Display or set the current client environment',\n    usage: 'Display the current client environment\\n  Usage: /environment\\n' +\n      `Set the current client environment (${all_names.join(', ')})\\n  Usage: /environment <environment_name>`,\n    label: 'Environment',\n    get: () => JSON.stringify(getCurrentEnvironment() || 'default', null, 2),\n    set: setCurrentEnvironment,\n    access_show: ['sysadmin'],\n  });\n\n  cmd_parse.register({\n    cmd: 'env',\n    help: 'Alias for /environment',\n    access_show: ['sysadmin'],\n    func: function (str: string, resp_func: ErrorCallback<string>) {\n      cmd_parse.handle(this, `environment ${str}`, resp_func);\n    },\n  });\n}\n","/* global location */\n\nexport let session_uid = `${String(Date.now()).slice(-8)}${String(Math.random()).slice(2,8)}`;\n\n/* eslint-disable import/order */\nimport { getAPIPath } from 'glov/client/environments';\n\nconst { fetch } = require('./fetch.js');\nconst { PLATFORM } = require('./client_config.js');\n\nlet error_report_disabled = false;\n\nexport function errorReportDisable() {\n  error_report_disabled = true;\n}\n\nlet ignore_promises = false;\nexport function errorReportIgnoreUncaughtPromises() {\n  ignore_promises = true;\n}\n\nlet error_report_details = {};\nlet error_report_dynamic_details = {};\nexport function errorReportSetDetails(key, value) {\n  if (value) {\n    error_report_details[key] = escape(String(value));\n  } else {\n    delete error_report_details[key];\n  }\n}\nexport function errorReportSetDynamicDetails(key, fn) {\n  error_report_dynamic_details[key] = fn;\n}\n\nerrorReportSetDetails('build', BUILD_TIMESTAMP);\nerrorReportSetDetails('sesuid', session_uid);\nerrorReportSetDetails('platform', PLATFORM);\nconst time_start = Date.now();\nerrorReportSetDetails('time_start', time_start);\nerrorReportSetDynamicDetails('url', function () {\n  return escape(location.href);\n});\nerrorReportSetDynamicDetails('time_up', function () {\n  return Date.now() - time_start;\n});\nlet time_accum = 0;\nexport function errorReportSetTimeAccum(new_value) {\n  time_accum = new_value;\n}\nerrorReportSetDynamicDetails('time_accum', function () {\n  return time_accum;\n});\n\nfunction getDynamicDetail(key) {\n  let value = error_report_dynamic_details[key]();\n  if (!value && value !== 0) {\n    return '';\n  }\n  return `&${key}=${value}`;\n}\nexport function errorReportDetailsString() {\n  return `&${Object.keys(error_report_details)\n    .map((k) => `${k}=${error_report_details[k]}`)\n    .join('&')}` +\n    `${Object.keys(error_report_dynamic_details).map(getDynamicDetail).join('')}`;\n}\n\nlet last_error_time = 0;\nlet crash_idx = 0;\nexport function hasCrashed() {\n  return crash_idx > 0;\n}\n\nexport function errorReportClear() {\n  last_error_time = 0;\n  window.debugmsg('', true);\n}\n\nlet submit_errors = true;\nexport function glovErrorReportDisableSubmit() {\n  submit_errors = false;\n}\n\nlet on_crash_cb = null;\nexport function glovErrorReportSetCrashCB(cb) {\n  on_crash_cb = cb;\n}\n\n// Errors from plugins that we don't want to get reported to us, or show the user!\n// The exact phrase \"Script error.\\n  at (0:0)\" comes from our bootstap.js when we\n//   receive the message 'Script Error.' and no stack.  This happens on the Mi Browser on Redmi phones\n//   and doesn't seem to be indicative of any actual problem.\n// Ignoring null at null for similar reasons and because we get nothing useful from the reports.\n// eslint-disable-next-line no-regex-spaces\nlet filtered_errors = /avast_submit|vc_request_action|^Error: Script error\\.$|^Error: Script error\\.\\n  at \\(0:0\\)$|^Error: null$|^Error: null\\n  at null\\(null:null\\)$|getElementsByTagName\\('video'\\)|document\\.getElementById\\(\"search\"\\)|change_ua|chrome-extension|setConnectedRobot|Failed to (?:start|stop) the audio device|zaloJSV2|getCookie is not defined|originalPrompt|_AutofillCallbackHandler|sytaxError|bannerNight|privateSpecialRepair|__gCrWeb|\\$wrap is not/;\nexport function glovErrorReport(is_fatal, msg, file, line, col) {\n  console.error(msg);\n  if (on_crash_cb) {\n    on_crash_cb();\n  }\n  if (is_fatal) {\n    // Only doing filtering and such on fatal errors, as non-fatal errors are\n    // just logged and should not corrupt state.\n    ++crash_idx;\n    let now = Date.now();\n    let dt = now - last_error_time;\n    last_error_time = now;\n    if (error_report_disabled) {\n      return false;\n    }\n    if (dt < 30*1000) {\n      // Less than 30 seconds since the last error, either we're erroring every\n      // frame, or this is a secondary error caused by the first, do not report it.\n      // Could maybe hash the error message and just report each message once, and\n      // flag errors as primary or secondary.\n      return false;\n    }\n    if (msg.match(filtered_errors)) {\n      return false;\n    }\n  }\n  // Post to an error reporting endpoint that (probably) doesn't exist - it'll get in the logs anyway!\n  let url = getAPIPath(); // base like http://foo.com/bar/ (without index.html)\n  url += `${is_fatal ? 'errorReport' : 'errorLog'}?cidx=${crash_idx}&file=${escape(file)}` +\n    `&line=${line||0}&col=${col||0}` +\n    `&msg=${escape(msg)}${errorReportDetailsString()}`;\n  if (submit_errors) {\n    fetch({ method: 'POST', url }, () => { /* nop */ });\n  }\n  if (ignore_promises && msg.match(/Uncaught \\(in promise\\)/)) {\n    return false;\n  }\n  return true;\n}\n\nwindow.glov_error_report = glovErrorReport.bind(null, true);\n","/* globals FBInstant */\n/* eslint-disable import/order */\nconst { registerExternalUserInfoProvider } = require('./social.js');\nconst urlhash = require('./urlhash.js');\nconst local_storage = require('./local_storage.js');\nconst { ID_PROVIDER_FB_INSTANT } = require('glov/common/enums.js');\nconst { errorReportSetDynamicDetails } = require('glov/client/error_report.js');\nconst { callEach, eatPossiblePromise } = require('glov/common/util.js');\n\nlet onreadycallbacks = [];\nexport function onready(callback) {\n  if (!onreadycallbacks) {\n    return void callback();\n  }\n  onreadycallbacks.push(callback);\n}\n\nexport function fbInstantIsReady() {\n  return onreadycallbacks === null;\n}\n\nlet fb_log = [];\nfunction fbInstantLogEvent(event) {\n  FBInstant.logEvent(event);\n  fb_log.push(event);\n  if (fb_log.length > 10) {\n    fb_log.splice(0, 1);\n  }\n}\n\nlet hasSubscribedAlready = false;\nfunction initSubscribe(callback, skipShortcut) {\n\n  skipShortcut = skipShortcut||false;\n\n  function handleSubscribeToBotComplete() {\n    if (callback) {\n      //Prevents the handleSubscribeToBotComplete promise from eating unfreeze event errors\n      setTimeout(callback,1);\n    }\n  }\n\n  function handleSubscribeToBotFailure(e) {\n    if (e && e.code !== 'USER_INPUT') {\n      console.error('handleSubscribeToBotFailure', e);\n    }\n    fbInstantLogEvent('bot_subscribe_failure');\n    handleSubscribeToBotComplete();\n  }\n\n  function subscribeToBot() {\n    console.warn('Window social trying to bot subscribe');\n    if (FBInstant.getSupportedAPIs().indexOf('player.canSubscribeBotAsync') !== -1) {\n      FBInstant.player.canSubscribeBotAsync().then(function (canSubscribe) {\n        if (canSubscribe) {\n          fbInstantLogEvent('bot_subscribe_show');\n          FBInstant.player.subscribeBotAsync().then(function () {\n            fbInstantLogEvent('bot_subscribe_success');\n            handleSubscribeToBotComplete();\n          },handleSubscribeToBotFailure).catch(handleSubscribeToBotFailure);\n        } else {\n          handleSubscribeToBotComplete();\n        }\n      }).catch(handleSubscribeToBotFailure);\n    } else {\n      handleSubscribeToBotComplete();\n    }\n  }\n\n  function handleHomescreenComplete() {\n    subscribeToBot();\n  }\n\n  function handleCreateShortcutFailure(e) {\n    console.error('handleCreateShortcutFailure', e);\n    fbInstantLogEvent('homescreen_install_failure');\n    handleHomescreenComplete();\n  }\n\n  let hasAddedToHomescreen = local_storage.get('instant.hasInstalledShortcut.v2');\n  function createShortcut() {\n    console.warn('Window social trying to create shortcut');\n    if (FBInstant.getSupportedAPIs().indexOf('canCreateShortcutAsync') !== -1 &&\n      !hasAddedToHomescreen &&\n      !hasSubscribedAlready\n    ) {\n      hasSubscribedAlready = true;\n      FBInstant.canCreateShortcutAsync().then(function (canCreateShortcut) {\n        if (canCreateShortcut) {\n          fbInstantLogEvent('homescreen_install_show');\n          FBInstant.createShortcutAsync().then(function () {\n            local_storage.set('instant.hasInstalledShortcut.v2',true);\n            fbInstantLogEvent('homescreen_install_success');\n            handleHomescreenComplete();\n          },function () {\n            fbInstantLogEvent('homescreen_install_useraborted');\n            handleHomescreenComplete();\n          }).catch(handleCreateShortcutFailure);\n        } else {\n          handleHomescreenComplete();\n        }\n      }).catch(handleCreateShortcutFailure);\n    } else {\n      handleHomescreenComplete();\n    }\n  }\n\n  if (skipShortcut) {\n    subscribeToBot();\n  } else {\n    createShortcut();\n  }\n}\n\nlet on_pause = [];\nexport function fbInstantOnPause(cb) {\n  on_pause.push(cb);\n}\n\nlet can_follow_official_page = false;\nlet can_join_official_group = false;\nlet can_get_live_streams_overlay = false;\n\nexport function fbGetLoginInfo(cb) {\n  onready(() => {\n    window.FBInstant.player.getSignedPlayerInfoAsync().then((result) => {\n      if (cb) {\n        cb(null, {\n          signature: result.getSignature(),\n          display_name: window.FBInstant.player.getName(),\n        });\n        cb = null;\n      }\n    }).catch((err) => {\n      if (cb) {\n        cb(err);\n        cb = null;\n      }\n    });\n  });\n}\n\n/// Maps a player to an ExternalUserInfo\nfunction mapPlayerToExternalUserInfo(player) {\n  return { external_id: player.getID(), name: player.getName(), profile_picture_url: player.getPhoto() };\n}\n\n/// Returns an ExternalUserInfo\nfunction fbInstantGetPlayer(cb) {\n  onready(() => {\n    let player = window.FBInstant.player;\n    cb(null, player ? mapPlayerToExternalUserInfo(player) : undefined);\n  });\n}\n\n/// cb receives an error if any occurs and an array of ExternalUserInfo objects\nfunction fbInstantGetFriends(cb) {\n  onready(() => {\n    window.FBInstant.player.getConnectedPlayersAsync().then((players) => {\n      if (cb) {\n        let local_cb = cb;\n        cb = null;\n        local_cb(null, players?.map(mapPlayerToExternalUserInfo));\n      }\n    }).catch((err) => {\n      if (cb) {\n        let local_cb = cb;\n        cb = null;\n        local_cb(err);\n      }\n    });\n  });\n}\n\nexport function fbGetAppScopedUserId(cb) {\n  onready(() => {\n    window.FBInstant.player.getASIDAsync().then((asid) => {\n      if (cb) {\n        cb(null, asid);\n        cb = null;\n      }\n    }).catch((err) => {\n      if (cb) {\n        cb(err);\n        cb = null;\n      }\n    });\n  });\n}\n\nexport function canFollowOfficialPage() {\n  return window.FBInstant && can_follow_official_page;\n}\n\nexport function canJoinOfficialGroup() {\n  return window.FBInstant && can_join_official_group;\n}\n\nexport function canShowLiveStreamOverlay() {\n  return window.FBInstant && can_get_live_streams_overlay;\n}\n\nexport function fbInstantInit() {\n  if (!window.FBInstant) {\n    return;\n  }\n\n  errorReportSetDynamicDetails('fblog', () => fb_log.join(','));\n  registerExternalUserInfoProvider(ID_PROVIDER_FB_INSTANT, fbInstantGetPlayer, fbInstantGetFriends);\n\n  let left = 1;\n  let fake_load_interval = setInterval(function () {\n    left *= 0.9;\n    eatPossiblePromise(FBInstant.setLoadingProgress(100-(left*100)>>0));\n  },100);\n\n  FBInstant.initializeAsync().then(function () {\n    let entryPointData = FBInstant.getEntryPointData()||{};\n    // let entryPointData = { querystring: { w: '4675', wg: '1' } }; // FRVR\n    // let entryPointData = { querystring: { blueprint: 'RKWVAE26XS24Z' } }; // FRVR\n    let querystring = entryPointData.querystring||{};\n    for (let x in querystring) {\n      urlhash.set(x, querystring[x]);\n    }\n\n    clearInterval(fake_load_interval);\n    FBInstant.startGameAsync().then(function () {\n      callEach(onreadycallbacks, onreadycallbacks = null);\n\n      console.log('Initializing FBInstant');\n      initSubscribe(function () {\n        console.log('All done initing FBInstant');\n\n        window.FBInstant.community.canFollowOfficialPageAsync().then(function (state) {\n          can_follow_official_page = state;\n        }).catch(function (err) {\n          console.error(err);\n        });\n\n        window.FBInstant.community.canJoinOfficialGroupAsync().then(function (state) {\n          can_join_official_group = state;\n        }).catch(function (err) {\n          console.error(err);\n        });\n\n        window.FBInstant.community.canGetLiveStreamsAsync().then(function (state) {\n          can_get_live_streams_overlay = state;\n        }).catch(function (err) {\n          console.error(err);\n        });\n      });\n    });\n  }).catch(function (e) {\n    console.warn('FBInstant initializeAsync failed', e);\n  });\n\n  FBInstant.onPause(() => {\n    callEach(on_pause);\n  });\n}\n","/* global XMLHttpRequest */\n\nconst assert = require('assert');\nconst { once } = require('glov/common/util.js');\n\nexport const ERR_CONNECTION = 'ERR_CONNECTION';\n\nconst regex_with_host = /\\/\\/[^/]+\\/([^?#]+)/;\nconst regex_no_host = /([^?#]+)/;\nfunction labelFromURL(url) {\n  let m = url.match(regex_with_host);\n  if (m) {\n    return m[1];\n  }\n  m = url.match(regex_no_host);\n  return m ? m[1] : url;\n}\n\nexport function fetch(params, cb) {\n  cb = once(cb);\n  let { method, url, response_type, label } = params;\n  method = method || 'GET';\n  assert(url);\n  label = label || labelFromURL(url);\n  let xhr = new XMLHttpRequest();\n  xhr.open(method, url, true);\n  if (response_type && response_type !== 'json') {\n    xhr.responseType = response_type;\n  }\n  xhr.onload = function () {\n    profilerStart(`fetch_onload:${label}`);\n    if (xhr.status !== 200 && xhr.status !== 0) {\n      let text;\n      try {\n        text = xhr.responseText;\n      } catch (e) {\n        // ignored\n      }\n      cb(String(xhr.status), text || '');\n    } else {\n      if (response_type === 'json') {\n        let text;\n        let obj;\n        try {\n          text = xhr.responseText;\n          obj = JSON.parse(text);\n        } catch (e) {\n          console.error(`Received invalid JSON response from ${url}: ${text || '<empty response>'}`);\n          // Probably internal server error or such as the server is restarting\n          cb(e);\n          profilerStop();\n          return;\n        }\n        cb(null, obj);\n      } else if (response_type === 'arraybuffer') {\n        if (xhr.response) {\n          cb(null, xhr.response);\n        } else {\n          cb('empty response');\n        }\n      } else {\n        cb(null, xhr.responseText);\n      }\n    }\n    profilerStop();\n  };\n  xhr.onerror = () => {\n    profilerStart(`fetch_onerror:${label}`);\n    cb(ERR_CONNECTION);\n    profilerStop();\n  };\n  xhr.send(null);\n}\n","const assert = require('assert');\n\nlet by_ext = {};\nlet by_match = [];\n\n// cb(filename)\nexport function filewatchOn(ext_or_search, cb) {\n  if (ext_or_search[0] === '.') {\n    assert(!by_ext[ext_or_search]);\n    by_ext[ext_or_search] = cb;\n  } else {\n    by_match.push([ext_or_search, cb]);\n  }\n}\n\nlet message_cb;\n// cb(message)\nexport function filewatchMessageHandler(cb) {\n  message_cb = cb;\n}\n\nfunction onFileChange(filename) {\n  console.log(`FileWatch change: ${filename}`);\n  let ext_idx = filename.lastIndexOf('.');\n  let did_reload = false;\n  if (ext_idx !== -1) {\n    let ext = filename.slice(ext_idx);\n    if (by_ext[ext]) {\n      if (by_ext[ext](filename) !== false) {\n        did_reload = true;\n      }\n    }\n  }\n  for (let ii = 0; ii < by_match.length; ++ii) {\n    if (filename.match(by_match[ii][0])) {\n      if (by_match[ii][1](filename) !== false) {\n        did_reload = true;\n      }\n    }\n  }\n  if (message_cb && did_reload) {\n    message_cb(`Reloading: ${filename}`);\n  }\n}\n\nexport function filewatchTriggerChange(filename) {\n  onFileChange(filename);\n}\n\nexport function filewatchStartup(client) {\n  client.onMsg('filewatch', onFileChange);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint no-bitwise:off, complexity:off, @typescript-eslint/no-shadow:off */\n\nexports.style = fontStyle; // eslint-disable-line @typescript-eslint/no-use-before-define\nexports.styleColored = fontStyleColored; // eslint-disable-line @typescript-eslint/no-use-before-define\nexports.styleAlpha = fontStyleAlpha; // eslint-disable-line @typescript-eslint/no-use-before-define\nexports.create = fontCreate; // eslint-disable-line @typescript-eslint/no-use-before-define\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst camera2d = require('./camera2d.js');\nconst { transformX, transformY } = require('./camera2d.js');\nconst engine = require('./engine.js');\nconst geom = require('./geom.js');\nconst { getStringFromLocalizable } = require('./localization.js');\nconst { max, min, round } = Math;\n// const settings = require('./settings.js');\nconst shaders = require('./shaders.js');\nconst sprites = require('./sprites.js');\nconst { BLEND_ALPHA, BLEND_PREMULALPHA, spriteChainedStart, spriteChainedStop, spriteDataAlloc } = sprites;\nconst textures = require('./textures.js');\nconst { clamp } = require('glov/common/util.js');\nconst {\n  v3scale,\n  v3set,\n  vec4,\n  v4copy,\n  v4scale,\n} = require('glov/common/vmath.js');\n\n/*\n\nfont_style = glov_font.style(null, {\n  color: 0xFFFFFFff,\n  outline_width: 0,\n  outline_color: 0x00000000,\n  glow_xoffs: 0,\n  glow_yoffs: 0,\n  glow_inner: 0,\n  glow_outer: 0,\n  glow_color: 0x000000ff,\n});\n\n */\n\n// typedef struct FontCharInfo {\n//   int c;\n//   float x0;\n//   float y0;\n//   int w;\n//   int h;\n//   int imgIdx;\n// } FontCharInfo;\n\n// typedef struct FontInfo {\n//   AS_NAME(CharInfo) FontCharInfo **char_infos;\n//   int font_size;\n//   float x0;\n//   float y0;\n//   int imageW;\n//   int imageH;\n//   int spread;\n// } FontInfo;\n\n// export const COLOR_MODE = {\n//   SINGLE: 0,\n//   GRADIENT: 1,\n// };\n\nexport const ALIGN = {\n  HLEFT: 0,\n  HCENTER: 1,\n  HRIGHT: 2,\n  HMASK: 3,\n\n  VTOP: 0 << 2,\n  VCENTER: 1 << 2,\n  VBOTTOM: 2 << 2,\n  VMASK: 3 << 2,\n\n  HFIT: 1 << 4,\n  HWRAP: 1 << 5,\n\n  HCENTERFIT: 1 | (1 << 4),\n  HRIGHTFIT: 2 | (1 << 4),\n  HVCENTER: 1 | (1 << 2), // to avoid doing bitwise ops elsewhere\n  HVCENTERFIT: 1 | (1 << 2) | (1 << 4), // to avoid doing bitwise ops elsewhere\n};\n\nconst ALIGN_NEEDS_WIDTH = ALIGN.HMASK | ALIGN.HFIT;\n\n\n// typedef struct GlovFontStyle\n// {\n//   // These members will never be changed (safe to initialize with GlovFontStyle foo = {1.0, 0xfff, etc};\n//   float outline_width;\n//   U32 outline_color;\n//   // Glow: can be used for a dropshadow as well\n//   //   inner can be negative to have the glow be less opaque (can also just change the alpha of the glow color)\n//   //   a glow would be e.g. (0, 0, -1, 5)\n//   //   a dropshadow would be e.g. (3.25, 3.25, -2.5, 5)\n//   float glow_xoffs;\n//   float glow_yoffs;\n//   float glow_inner;\n//   float glow_outer;\n//   U32 glow_color;\n//   U32 color; // upper left, or single color\n//   // U32 colorUR; // upper right\n//   // U32 colorLR; // lower right\n//   // U32 colorLL; // lower left\n//   // GlovFontColorMode color_mode;\n// } GlovFontStyle;\n\n/* Default GlovFontStyle:\n  font_style = {\n    outline_width: 0, outline_color: 0x00000000,\n    glow_xoffs: 0, glow_yoffs: 0, glow_inner: 0, glow_outer: 0, glow_color: 0x00000000,\n    color: 0xFFFFFFff\n  };\n\n  // font_style = {\n  //   outline_width: 0, outline_color: 0x00000000,\n  //   glow_xoffs: 0, glow_yoffs: 0, glow_inner: 0, glow_outer: 0, glow_color: 0x00000000,\n  //   // Color gradient: UL, UR, LR, LL\n  //   color: 0xFFFFFFff, colorUR: 0xFFFFFFff, colorLR: 0x000000ff, colorLL: 0x000000ff,\n  //   color_mode: glov_font.COLOR_MODE.GRADIENT,\n  // };\n*/\n\nfunction GlovFontStyle() {\n  // Not calling `vec4()` directly, since this constructor may be called during\n  //   initialization before our local `vec4` has been assigned.\n  this.color_vec4 = new Float32Array([1,1,1,1]); // Matches GlovFontStyle.prototype.color below\n}\nGlovFontStyle.prototype.outline_width = 0;\nGlovFontStyle.prototype.outline_color = 0x00000000;\nGlovFontStyle.prototype.glow_xoffs = 0;\nGlovFontStyle.prototype.glow_yoffs = 0;\nGlovFontStyle.prototype.glow_inner = 0;\nGlovFontStyle.prototype.glow_outer = 0;\nGlovFontStyle.prototype.glow_color = 0x00000000;\nGlovFontStyle.prototype.color = 0xFFFFFFff;\n// GlovFontStyle.prototype.colorUR = 0;\n// GlovFontStyle.prototype.colorLR = 0;\n// GlovFontStyle.prototype.colorLL = 0;\n// GlovFontStyle.prototype.color_mode = COLOR_MODE.SINGLE;\n\nexport const font_shaders = {};\n\nexport function intColorFromVec4Color(v) {\n  return ((v[0] * 255 | 0) << 24) |\n    ((v[1] * 255 | 0) << 16) |\n    ((v[2] * 255 | 0) << 8) |\n    ((v[3] * 255 | 0));\n}\n\nexport function vec4ColorFromIntColor(v, c) {\n  v[0] = ((c >> 24) & 0xFF) / 255;\n  v[1] = ((c >> 16) & 0xFF) / 255;\n  v[2] = ((c >> 8) & 0xFF) / 255;\n  v[3] = (c & 0xFF) / 255;\n}\n\nfunction vec4ColorFromIntColorPreMultiplied(v, c) {\n  let a = v[3] = (c & 0xFF) / 255;\n  a *= (1/255);\n  v[0] = ((c >> 24) & 0xFF) * a;\n  v[1] = ((c >> 16) & 0xFF) * a;\n  v[2] = ((c >> 8) & 0xFF) * a;\n}\n\nexport const glov_font_default_style = new GlovFontStyle();\n\nexport function fontStyle(font_style, fields) {\n  let ret = new GlovFontStyle();\n  let { color_vec4 } = ret;\n  if (font_style) {\n    for (let f in font_style) {\n      ret[f] = font_style[f];\n    }\n  }\n  for (let f in fields) {\n    ret[f] = fields[f];\n  }\n  ret.color_vec4 = color_vec4; // Restore\n  vec4ColorFromIntColor(ret.color_vec4, ret.color);\n  return ret;\n}\n\nexport function fontStyleColored(font_style, color) {\n  return fontStyle(font_style, {\n    color\n  });\n}\n\nfunction colorAlpha(color, alpha) {\n  alpha = clamp(round((color & 0xFF) * alpha), 0, 255);\n  return color & 0xFFFFFF00 | alpha;\n}\n\nexport function fontStyleAlpha(font_style, alpha) {\n  return fontStyle(font_style, {\n    color: colorAlpha((font_style || glov_font_default_style).color, alpha),\n    outline_color: colorAlpha((font_style || glov_font_default_style).outline_color, alpha),\n    glow_color: colorAlpha((font_style || glov_font_default_style).glow_color, alpha),\n  });\n}\n\nlet tech_params = null;\nlet tech_params_dirty = false;\nlet tech_params_cache = [];\nlet tech_params_cache_idx = 0;\nlet tech_params_pool = [];\nlet tech_params_pool_idx = 0;\nlet temp_color = vec4();\nlet geom_stats;\n\nlet dsp = {}; // drawScaled param\n\nfunction techParamsAlloc() {\n  if (tech_params_pool_idx === tech_params_pool.length) {\n    tech_params_pool.push({\n      param0: vec4(),\n      outline_color: vec4(),\n      glow_color: vec4(),\n      glow_params: vec4(),\n    });\n  }\n  tech_params = tech_params_pool[tech_params_pool_idx++];\n}\n\nfunction fontStartup() {\n  if (tech_params) {\n    return;\n  }\n\n  geom_stats = geom.stats;\n\n  techParamsAlloc();\n}\n\nfunction techParamsSet(param, value) {\n  let tpv = tech_params[param];\n  // not dirty, if anything changes, we need a new object!\n  if (!tech_params_dirty) {\n    if (tpv[0] !== value[0] || tpv[1] !== value[1] || tpv[2] !== value[2] || tpv[3] !== value[3]) {\n      // clone old values before modifying\n      let old_tech_params = tech_params;\n      techParamsAlloc();\n      v4copy(tech_params.param0, old_tech_params.param0);\n      v4copy(tech_params.outline_color, old_tech_params.outline_color);\n      v4copy(tech_params.glow_color, old_tech_params.glow_color);\n      v4copy(tech_params.glow_params, old_tech_params.glow_params);\n      geom_stats.font_params++;\n      tech_params_dirty = true;\n      tpv = tech_params[param];\n    } else {\n      // identical, do nothing\n      return;\n    }\n  }\n  if (tech_params_dirty) {\n    // just set\n    tpv[0] = value[0];\n    tpv[1] = value[1];\n    tpv[2] = value[2];\n    tpv[3] = value[3];\n    // return;\n  }\n}\n\nconst SHADER_KEYS = ['param0', 'outline_color', 'glow_color', 'glow_params'];\nfunction sameTP(as) {\n  for (let jj = 0; jj < 4; ++jj) {\n    let key = SHADER_KEYS[jj];\n    let v1 = tech_params[key];\n    let v2 = as[key];\n    for (let ii = 0; ii < 4; ++ii) {\n      if (v1[ii] !== v2[ii]) {\n        return false;\n      }\n    }\n  }\n  return true;\n}\n\nfunction techParamsGet() {\n  if (!tech_params_dirty) {\n    return tech_params;\n  }\n  tech_params_dirty = false;\n  for (let ii = 0; ii < tech_params_cache.length; ++ii) {\n    if (sameTP(tech_params_cache[ii])) {\n      // Found a match in the cache, use that instead\n      if (tech_params === tech_params_pool[tech_params_pool_idx-1]) {\n        // and this was just pulled off the pool, put it back on\n        tech_params_pool_idx--;\n      }\n      tech_params = tech_params_cache[ii];\n      if (tech_params_cache_idx === ii) {\n        // about to be overwritten\n        tech_params_cache_idx = (tech_params_cache_idx + 1) % 4;\n      }\n      --geom_stats.font_params;\n      return tech_params;\n    }\n  }\n  tech_params_cache[tech_params_cache_idx] = tech_params;\n  tech_params_cache_idx = (tech_params_cache_idx + 1) % 4;\n  return tech_params;\n}\n\nfunction GlovFont(font_info, texture_name) {\n  assert(font_info.font_size !== 0); // Got lost somewhere\n\n  this.texture = textures.load({\n    url: `img/${texture_name}.png`,\n    filter_min: font_info.noFilter ? gl.NEAREST : gl.LINEAR,\n    filter_mag: font_info.noFilter ? gl.NEAREST : gl.LINEAR,\n    wrap_s: gl.CLAMP_TO_EDGE,\n    wrap_t: gl.CLAMP_TO_EDGE,\n  });\n  this.textures = [this.texture];\n  this.integral = Boolean(font_info.noFilter); // TODO: often only want this for pixely = strict modes?\n\n  this.font_info = font_info;\n  this.font_size = font_info.font_size;\n  this.inv_font_size = 1 / font_info.font_size;\n  this.shader = font_shaders.font_aa;\n  this.tex_w = font_info.imageW;\n  this.tex_h = font_info.imageH;\n\n  // Calculate inverse scale, fixup 0s\n  for (let ii = 0; ii < font_info.char_infos.length; ++ii) {\n    let char_info = font_info.char_infos[ii];\n    char_info.scale = 1 / (char_info.sc || 1);\n    char_info.w = char_info.w || 0;\n  }\n\n  // build lookup\n  this.char_infos = [];\n  for (let ii = 0; ii < font_info.char_infos.length; ++ii) {\n    let char_info = font_info.char_infos[ii];\n    this.char_infos[font_info.char_infos[ii].c] = char_info;\n    char_info.xpad = char_info.xpad || 0;\n    char_info.yoffs = char_info.yoffs || 0;\n    char_info.w_pad_scale = (char_info.w + char_info.xpad) * char_info.scale;\n  }\n  this.replacement_character = this.infoFromChar(0xFFFD);\n  if (!this.replacement_character) {\n    this.replacement_character = this.infoFromChar(63); // '?'\n  }\n  this.whitespace_character = this.infoFromChar(13);\n\n  this.default_style = new GlovFontStyle();\n  this.applied_style = new GlovFontStyle();\n\n  fontStartup();\n}\n\n// General draw functions return width\n// Pass NULL for style to use default style\n// If the function takes a color, this overrides the color on the style\nGlovFont.prototype.drawSizedColor = function (style, x, y, z, size, color, text) {\n  return this.drawSized(fontStyleColored(style, color), x, y, z, size, text);\n};\nGlovFont.prototype.drawSized = function (style, x, y, z, size, text) {\n  dsp.style = style;\n  dsp.x = x;\n  dsp.y = y;\n  dsp.z = z;\n  dsp.xsc = size * this.inv_font_size;\n  dsp.ysc = size * this.inv_font_size;\n  dsp.text = text;\n  return this.drawScaled();\n};\n\nGlovFont.prototype.drawSizedAligned = function (style, x, y, z, size, align, w, h, text) {\n  profilerStartFunc();\n  text = getStringFromLocalizable(text);\n\n  if (align & ALIGN.HWRAP) {\n    let drawn_height = this.drawSizedAlignedWrapped(style, x, y, z, 0, size, align & ~ALIGN.HWRAP, w, h, text);\n    profilerStopFunc();\n    return drawn_height;\n  }\n  let x_size = size;\n  let y_size = size;\n  if (align & ALIGN_NEEDS_WIDTH) {\n    let width = this.getStringWidth(style, x_size, text);\n    if ((align & ALIGN.HFIT) && width > w) {\n      let scale = w / width;\n      x_size *= scale;\n      width = w;\n      // Additionally, if we're really squishing things horizontally, shrink the font size\n      // and offset to be centered.\n      if (scale < 0.5) {\n        if ((align & ALIGN.VMASK) !== ALIGN.VCENTER && (align & ALIGN.VMASK) !== ALIGN.VBOTTOM) {\n          // Offset to be roughly centered in the original line bounds\n          y += (y_size - (y_size * scale * 2)) * 0.5;\n        }\n        y_size *= scale * 2;\n      }\n    }\n    switch (align & ALIGN.HMASK) { // eslint-disable-line default-case\n      case ALIGN.HCENTER:\n        x += (w - width) * 0.5;\n        if (this.integral) {\n          x = round(x);\n        }\n        break;\n      case ALIGN.HRIGHT:\n        x += w - width;\n        break;\n    }\n  }\n  switch (align & ALIGN.VMASK) { // eslint-disable-line default-case\n    case ALIGN.VCENTER:\n      y += (h - y_size) * 0.5;\n      if (this.integral) {\n        y = round(y);\n      }\n      break;\n    case ALIGN.VBOTTOM:\n      y += h - y_size;\n      break;\n  }\n\n  let xsc = x_size * this.inv_font_size;\n  let ysc = y_size * this.inv_font_size;\n  dsp.style = style;\n  dsp.x = x;\n  dsp.y = y;\n  dsp.z = z;\n  dsp.xsc = xsc;\n  dsp.ysc = ysc;\n  dsp.text = text;\n  let drawn_width = this.drawScaled();\n  profilerStopFunc();\n  return drawn_width;\n};\n\nGlovFont.prototype.drawSizedAlignedWrapped = function (style, x, y, z, indent, size, align, w, h, text) {\n  text = getStringFromLocalizable(text);\n  assert(w > 0);\n  assert(typeof h !== 'string'); // Old API did not have `indent` parameter\n  let lines = [];\n  let line_xoffs = [];\n  lines.length = this.wrapLines(style, w, indent, size, text, align, (xoffs, linenum, line) => {\n    line_xoffs[linenum] = xoffs;\n    lines[linenum] = line;\n  });\n\n  let yoffs = 0;\n  let height = size * lines.length;\n  // eslint-disable-next-line default-case\n  switch (align & ALIGN.VMASK) {\n    case ALIGN.VCENTER:\n      yoffs = (h - height) / 2;\n      if (this.integral) {\n        yoffs |= 0;\n      }\n      break;\n    case ALIGN.VBOTTOM:\n      yoffs = h - height;\n      break;\n  }\n  align &= ~ALIGN.VMASK;\n\n  for (let ii = 0; ii < lines.length; ++ii) {\n    let line = lines[ii];\n    if (line && line.trim()) {\n      this.drawSizedAligned(style, x + line_xoffs[ii], y + yoffs, z, size, align, w - line_xoffs[ii], 0, line);\n    }\n    yoffs += size;\n  }\n  return yoffs;\n};\n\n// returns height\nGlovFont.prototype.drawSizedColorWrapped = function (style, x, y, z, w, indent, size, color, text) {\n  return this.drawScaledWrapped(fontStyleColored(style, color), x, y, z, w,\n    indent, size * this.inv_font_size, size * this.inv_font_size, text);\n};\nGlovFont.prototype.drawSizedWrapped = function (style, x, y, z, w, indent, size, text) {\n  return this.drawScaledWrapped(style, x, y, z, w,\n    indent, size * this.inv_font_size, size * this.inv_font_size, text);\n};\n\nlet default_size = 24;\nexport function fontSetDefaultSize(h) {\n  default_size = h;\n}\n\nGlovFont.prototype.draw = function (param) {\n  let { style, color, alpha, x, y, z, size, w, h, align, text, indent } = param;\n  if (color) {\n    style = fontStyleColored(style, color);\n  }\n  if (alpha !== undefined) {\n    style = fontStyleAlpha(style, alpha);\n  }\n  indent = indent || 0;\n  size = size || default_size;\n  z = z || Z.UI;\n  if (align) {\n    if (align & ALIGN.HWRAP) {\n      return this.drawSizedAlignedWrapped(style, x, y, z, indent, size, align & ~ALIGN.HWRAP, w, h, text);\n    }\n    return this.drawSizedAligned(style, x, y, z, size, align, w || 0, h || 0, text);\n  } else {\n    return this.drawSized(style, x, y, z, size, text);\n  }\n};\n\n// line_cb(x0, int linenum, const char *line, x1)\nGlovFont.prototype.wrapLines = function (style, w, indent, size, text, align, line_cb) {\n  assert(typeof style !== 'number'); // old API did not have `style` parameter\n  this.applyStyle(style);\n  return this.wrapLinesScaled(w, indent, size * this.inv_font_size, text, align, line_cb);\n};\n\nGlovFont.prototype.numLines = function (style, w, indent, size, text) {\n  return this.wrapLines(style, w, indent, size, text, 0);\n};\n\nGlovFont.prototype.dims = function (style, w, indent, size, text) {\n  let max_x1 = 0;\n  function lineCallback(ignored1, ignored2, line, x1) {\n    max_x1 = max(max_x1, x1);\n  }\n  let numlines = this.wrapLines(style, w, indent, size, text, 0, lineCallback);\n  return {\n    w: max_x1,\n    h: numlines * size,\n  };\n};\n\nGlovFont.prototype.infoFromChar = function (c) {\n  let ret = this.char_infos[c];\n  if (ret) {\n    return ret;\n  }\n  if (c >= 9 && c <= 13) { // characters that String.trim() strip\n    return this.whitespace_character;\n  }\n  // no char info, not whitespace, show replacement even if ascii, control code\n  return this.replacement_character;\n};\n\nGlovFont.prototype.getCharacterWidth = function (style, x_size, c) {\n  assert.equal(typeof c, 'number');\n  this.applyStyle(style);\n  let char_info = this.infoFromChar(c);\n  let xsc = x_size * this.inv_font_size;\n  let x_advance = this.calcXAdvance(xsc);\n  if (char_info) {\n    return char_info.w_pad_scale * xsc + x_advance;\n  }\n  return 0;\n};\n\nGlovFont.prototype.getStringWidth = function (style, x_size, text) {\n  text = getStringFromLocalizable(text);\n\n  this.applyStyle(style);\n  let ret=0;\n  let xsc = x_size * this.inv_font_size;\n  let x_advance = this.calcXAdvance(xsc);\n  for (let ii = 0; ii < text.length; ++ii) {\n    let c = text.charCodeAt(ii);\n    let char_info = this.infoFromChar(c);\n    if (char_info) {\n      ret += char_info.w_pad_scale * xsc + x_advance;\n    }\n  }\n  return ret;\n};\n\nGlovFont.prototype.getSpaceSize = function (xsc) {\n  let space_info = this.infoFromChar(32); // ' '\n  return (space_info ? (space_info.w + space_info.xpad) * space_info.scale : this.font_size) * xsc;\n};\n\nfunction endsWord(char_code) {\n  return char_code === 32 || // ' '\n    char_code === 0 || // end of string\n    char_code === 10 || // '\\n'\n    char_code === 9; // '\\t'\n}\n\n// line_cb(x0, int linenum, const char *line, x1)\nGlovFont.prototype.wrapLinesScaled = function (w, indent, xsc, text, align, line_cb) {\n  text = getStringFromLocalizable(text);\n  assert(typeof align !== 'function'); // Old API had one less parameter\n  const len = text.length;\n  const max_word_w = w - indent;\n  // \"fit\" mode: instead of breaking the too-long word, output it on a line of its own\n  const hard_wrap_mode_fit = align & ALIGN.HFIT;\n  const x_advance = this.calcXAdvance(xsc);\n  const space_size = this.getSpaceSize(xsc) + x_advance;\n  let idx = 0;\n  let line_start = 0;\n  let line_x0 = 0;\n  let line_x1 = 0;\n  let line_end = -1;\n  let word_start = 0;\n  let word_x0 = 0;\n  let word_w = 0;\n  let word_slice = -1;\n  let word_slice_w = 0;\n  let linenum = 0;\n\n  function flushLine() {\n    if (line_end !== -1 && line_cb) {\n      line_cb(line_x0, linenum, text.slice(line_start, line_end), line_x1);\n    }\n    linenum++;\n    line_x0 = indent;\n    line_x1 = -1;\n    line_start = word_start;\n    line_end = -1;\n    word_x0 = line_x0;\n  }\n\n  do {\n    let c = idx < len ? text.charCodeAt(idx) || 0xFFFD : 0;\n    if (endsWord(c)) {\n      if (word_start !== idx) {\n        let need_line_flush = false;\n        // flush word, take care of space on next loop\n        if (word_x0 + word_w <= w) {\n          // fits fine, add to line, start new word\n        } else if (word_w > max_word_w && !hard_wrap_mode_fit) {\n          // even just this word alone won't fit, needs a hard wrap\n          // output what fits on this line, then continue to next line\n          need_line_flush = true;\n          if (word_slice === -1) {\n            // not even a single letter fits on this line\n            if (line_end !== -1) {\n              // wrap to a new line if not already\n              flushLine();\n            }\n            // just output one letter, start new word from second letter\n            idx = line_start + 1;\n            word_w = max_word_w; // underestimate\n          } else {\n            // output what fits on this line so far\n            idx = word_slice;\n            word_w = word_slice_w;\n          }\n        } else {\n          // won't fit, but fits on next line, soft wrap\n          if (line_end !== -1) {\n            flushLine();\n          }\n        }\n        //addWord();\n        line_end = idx;\n        line_x1 = word_x0 + word_w;\n        word_x0 = line_x1;\n        word_w = 0;\n        word_start = idx;\n        word_slice = -1;\n\n        if (need_line_flush) {\n          flushLine();\n        }\n\n        // we're now either still pointing at the space, or rewound to an earlier point\n        continue;\n      } else {\n        // process the space\n        word_start = idx + 1;\n        word_x0 += space_size;\n        if (c === 10) { // \\n\n          flushLine();\n        }\n      }\n    } else {\n      let char_info = this.infoFromChar(c);\n      if (char_info) {\n        let char_w = char_info.w_pad_scale * xsc + x_advance;\n        word_w += char_w;\n        if (word_x0 + word_w <= w) { // would partially fit up to and including this letter\n          word_slice = idx + 1;\n          word_slice_w = word_w;\n        }\n      }\n    }\n    ++idx;\n  } while (idx <= len);\n  if (line_end !== -1) {\n    flushLine();\n  }\n\n  return linenum;\n};\n\nGlovFont.prototype.drawScaledWrapped = function (style, x, y, z, w, indent, xsc, ysc, text) {\n  if (text === null || text === undefined) {\n    text = '(null)';\n  }\n  assert(w > 0);\n  this.applyStyle(style);\n  // This function returns height instead of width, so leave the maximum width encountered here for caller\n  this.last_width = 0;\n  dsp.style = style;\n  dsp.z = z;\n  dsp.xsc = xsc;\n  dsp.ysc = ysc;\n  let num_lines = this.wrapLinesScaled(w, indent, xsc, text, 0, (xoffs, linenum, line, x1) => {\n    dsp.x = x + xoffs;\n    dsp.y = y + this.font_size * ysc * linenum;\n    dsp.text = line;\n    this.drawScaled();\n    this.last_width = max(this.last_width, x1);\n  });\n  return num_lines * this.font_size * ysc;\n};\n\nGlovFont.prototype.calcXAdvance = function (xsc) {\n  // Assume called: applyStyle(style);\n\n  // scale all supplied values by this so that if we swap in a font with twice the resolution (and twice the spread)\n  //   things look almost identical, just crisper\n  let font_texel_scale = this.font_size / 32;\n  // As a compromise, -2 bias here seems to work well\n  let x_advance = round(xsc * font_texel_scale * max(this.applied_style.outline_width - 2, 0));\n  // As a compromise, there's a -3 bias in there, so it only kicks in under extreme circumstances\n  x_advance = max(x_advance, xsc * font_texel_scale *\n    max(this.applied_style.glow_outer - this.applied_style.glow_xoffs - 3, 0));\n  return x_advance;\n};\n\n//////////////////////////////////////////////////////////////////////////\n// Main implementation\n\nconst temp_vec4_param0 = vec4();\nconst temp_vec4_glow_params = vec4();\nconst padding4 = vec4();\nconst padding_in_font_space = vec4();\nGlovFont.prototype.drawScaled = function () {\n  let { style, x: _x, y, z, xsc, ysc, text } = dsp;\n  profilerStartFunc();\n  text = getStringFromLocalizable(text);\n  let x = _x;\n  assert(isFinite(x));\n  assert(isFinite(y));\n  assert(isFinite(z));\n  let font_info = this.font_info;\n  // Debug: show expect area of glyphs\n  // require('./ui.js').drawRect(_x, y,\n  //   _x + xsc * font_size * 20, y + ysc * font_size,\n  //   1000, [1, 0, 1, 0.5]);\n  y += (font_info.y_offset || 0) * ysc;\n  let texs = this.textures;\n  if (text === null || text === undefined) {\n    text = '(null)';\n  }\n  const len = text.length;\n  if (xsc === 0 || ysc === 0) {\n    profilerStopFunc();\n    return 0;\n  }\n\n  geom_stats.font_calls++;\n\n  this.applyStyle(style);\n\n  let blend_mode = engine.defines.NOPREMUL ? BLEND_ALPHA : BLEND_PREMULALPHA;\n\n  const avg_scale_font = (xsc + ysc) * 0.5;\n  const camera_xscale = camera2d.data[4];\n  const camera_yscale = camera2d.data[5];\n  let avg_scale_combined = (xsc * camera_xscale + ysc * camera_yscale) * 0.5;\n  // Not doing this here, because render_scale_all is not currently reflected in camera_x/yscale\n  // avg_scale_combined *= settings.render_scale_all;\n\n  // scale all supplied values by this so that if we swap in a font with twice the resolution (and twice the spread)\n  //   things look almost identical, just crisper\n  let x_advance = this.calcXAdvance(xsc);\n  let font_texel_scale = this.font_size / 32;\n  let tile_state = 0;\n\n  let applied_style = this.applied_style;\n\n  // Calculate anti-aliasing values\n  let delta_per_source_pixel = 0.5 / font_info.spread;\n  let delta_per_dest_pixel = delta_per_source_pixel / avg_scale_combined;\n  let value = v3set(temp_vec4_param0,\n    1 / delta_per_dest_pixel, // AA Mult and Outline Mult\n    -0.5 / delta_per_dest_pixel + 0.5, // AA Add\n    // Outline Add\n    min(0, -0.5 / delta_per_dest_pixel + 0.5 + applied_style.outline_width*font_texel_scale*avg_scale_combined),\n    // 0, // Unused\n  );\n  let padding1 = max(0, applied_style.outline_width*font_texel_scale*avg_scale_font);\n  const outer_scaled = applied_style.glow_outer*font_texel_scale;\n  padding4[0] = max(outer_scaled*xsc - applied_style.glow_xoffs*font_texel_scale*xsc, padding1);\n  padding4[2] = max(outer_scaled*xsc + applied_style.glow_xoffs*font_texel_scale*xsc, padding1);\n  padding4[1] = max(outer_scaled*ysc - applied_style.glow_yoffs*font_texel_scale*ysc, padding1);\n  padding4[3] = max(outer_scaled*ysc + applied_style.glow_yoffs*font_texel_scale*ysc, padding1);\n\n  techParamsSet('param0', value);\n  let value2 = temp_vec4_glow_params;\n  // Glow mult\n  if (applied_style.glow_outer) {\n    value2[2] = 1 / ((applied_style.glow_outer - applied_style.glow_inner) * delta_per_source_pixel * font_texel_scale);\n    value2[3] = min(0, -(0.5 - applied_style.glow_outer * delta_per_source_pixel * font_texel_scale) /\n      ((applied_style.glow_outer - applied_style.glow_inner) * delta_per_source_pixel * font_texel_scale));\n  } else {\n    // Avoid sending `Infinity` to GPU\n    value2[2] = value[3] = 0;\n  }\n\n  v4scale(padding_in_font_space, padding4, 1 / avg_scale_font);\n  for (let ii = 0; ii < 4; ++ii) {\n    if (padding_in_font_space[ii] > font_info.spread) {\n      // Not enough buffer\n      let sc = font_info.spread / padding_in_font_space[ii];\n      padding4[ii] *= sc;\n      padding_in_font_space[ii] *= sc;\n    }\n  }\n\n  // Choose appropriate z advance so that character are drawn left to right (or RTL if the glow is on the other side)\n  // same Z should be drawn in queue order, so not needed\n  const z_advance = applied_style.glow_xoffs < 0 ? -0.0001 : 0; // 0.0001;\n  if (!z_advance) {\n    spriteChainedStart();\n  }\n\n  const has_glow_offs = applied_style.glow_xoffs || applied_style.glow_yoffs;\n  if (!has_glow_offs) {\n    value2[0] = value2[1] = 0;\n    techParamsSet('glow_params', value2);\n    techParamsGet();\n  }\n\n  // For non-1:1 aspect ration rendering, need to scale our coordinates' padding differently in each axis\n  let rel_x_scale = xsc / avg_scale_font;\n  let rel_y_scale = ysc / avg_scale_font;\n\n  let sort_y = transformY(y);\n  let color = applied_style.color_vec4;\n  let shader = this.shader;\n\n  for (let i=0; i<len; i++) {\n    const c = text.charCodeAt(i);\n    if (c === 9) { // '\\t'.charCodeAt(0)) {\n      let tabsize = xsc * this.font_size * 4;\n      x = ((((x - _x) / tabsize) | 0) + 1) * tabsize + _x;\n    } else {\n      let char_info = this.infoFromChar(c);\n      if (char_info) {\n        let char_scale = char_info.scale;\n        let xsc2 = xsc * char_scale;\n        if (char_info.w) {\n          let ysc2 = ysc * char_scale;\n          let pad_scale = 1 / char_scale;\n          let tile_width = this.tex_w;\n          let tile_height = this.tex_h;\n          // Lazy update params here\n          if (has_glow_offs && char_scale !== tile_state) {\n            value2[0] = -applied_style.glow_xoffs * font_texel_scale * pad_scale / tile_width;\n            value2[1] = -applied_style.glow_yoffs * font_texel_scale * pad_scale / tile_height;\n            techParamsSet('glow_params', value2);\n            if (!z_advance) {\n              spriteChainedStop();\n              spriteChainedStart();\n            }\n            techParamsGet();\n            tile_state = char_scale;\n          }\n\n          let u0 = (char_info.x0 - padding_in_font_space[0] * pad_scale) / tile_width;\n          let u1 = (char_info.x0 + char_info.w + padding_in_font_space[2] * pad_scale) / tile_width;\n          let v0 = (char_info.y0 - padding_in_font_space[1] * pad_scale) / tile_height;\n          let v1 = (char_info.y0 + char_info.h + padding_in_font_space[3] * pad_scale) / tile_height;\n\n          let w = char_info.w * xsc2 + (padding4[0] + padding4[2]) * rel_x_scale;\n          let h = char_info.h * ysc2 + (padding4[1] + padding4[3]) * rel_y_scale;\n\n          let xx = x - rel_x_scale * padding4[0];\n          let yy = y - rel_y_scale * padding4[2] + char_info.yoffs * ysc2;\n          // Below is inlined/optimized version of:\n          // queueraw(\n          //   texs,\n          //   xx, yy,\n          //   z + z_advance * i, w, h,\n          //   u0, v0, u1, v1,\n          //   color,\n          //   shader, tech_params, blend_mode).y = sort_y;\n\n          let y1 = yy + h;\n          let x1 = xx + w;\n          let zz = z + z_advance * i;\n\n          let tx0 = transformX(xx);\n          let ty0 = transformY(yy);\n          let tx1 = transformX(x1);\n          let ty1 = transformY(y1);\n          let elem = spriteDataAlloc(texs, shader, tech_params, blend_mode);\n          let data = elem.data;\n          data[0] = tx0;\n          data[1] = ty0;\n          data[2] = color[0];\n          data[3] = color[1];\n          data[4] = color[2];\n          data[5] = color[3];\n          data[6] = u0;\n          data[7] = v0;\n\n          data[8] = tx0;\n          data[9] = ty1;\n          data[10] = color[0];\n          data[11] = color[1];\n          data[12] = color[2];\n          data[13] = color[3];\n          data[14] = u0;\n          data[15] = v1;\n\n          data[16] = tx1;\n          data[17] = ty1;\n          data[18] = color[0];\n          data[19] = color[1];\n          data[20] = color[2];\n          data[21] = color[3];\n          data[22] = u1;\n          data[23] = v1;\n\n          data[24] = tx1;\n          data[25] = ty0;\n          data[26] = color[0];\n          data[27] = color[1];\n          data[28] = color[2];\n          data[29] = color[3];\n          data[30] = u1;\n          data[31] = v0;\n\n          elem.x = tx0;\n          elem.y = sort_y;\n          elem.queue(zz);\n\n          // require('./ui.js').drawRect(xx, yy, x1, y1, 1000, [i & 1, (i & 2)>>1, (i & 4)>>2, 0.5]);\n        }\n\n        x += (char_info.w + char_info.xpad) * xsc2 + x_advance;\n      }\n    }\n  }\n  if (!z_advance) {\n    spriteChainedStop();\n  }\n  profilerStopFunc();\n  return x - _x;\n};\n\nGlovFont.prototype.determineShader = function () {\n  let outline = this.applied_style.outline_width && (this.applied_style.outline_color & 0xff);\n  let glow = this.applied_style.glow_outer > 0 && (this.applied_style.glow_color & 0xff);\n  if (outline) {\n    if (glow) {\n      this.shader = font_shaders.font_aa_outline_glow;\n    } else {\n      this.shader = font_shaders.font_aa_outline;\n    }\n  } else if (glow) {\n    this.shader = font_shaders.font_aa_glow;\n  } else {\n    this.shader = font_shaders.font_aa;\n  }\n};\n\nGlovFont.prototype.applyStyle = function (style) {\n  if (!style) {\n    style = this.default_style;\n  }\n  if (engine.defines.NOPREMUL) {\n    // outline\n    vec4ColorFromIntColor(temp_color, style.outline_color);\n    techParamsSet('outline_color', temp_color);\n\n    // glow\n    vec4ColorFromIntColor(temp_color, style.glow_color);\n    techParamsSet('glow_color', temp_color);\n  } else {\n    // outline\n    vec4ColorFromIntColorPreMultiplied(temp_color, style.outline_color);\n    techParamsSet('outline_color', temp_color);\n\n    // glow\n    vec4ColorFromIntColorPreMultiplied(temp_color, style.glow_color);\n    techParamsSet('glow_color', temp_color);\n  }\n\n  // everything else\n  this.applied_style.outline_width = style.outline_width;\n  this.applied_style.outline_color = style.outline_color;\n  this.applied_style.glow_xoffs = style.glow_xoffs;\n  this.applied_style.glow_yoffs = style.glow_yoffs;\n  this.applied_style.glow_inner = style.glow_inner;\n  this.applied_style.glow_outer = style.glow_outer;\n  this.applied_style.glow_color = style.glow_color;\n  this.applied_style.color = style.color;\n  if (engine.defines.NOPREMUL) {\n    v4copy(this.applied_style.color_vec4, style.color_vec4);\n  } else {\n    let alpha = this.applied_style.color_vec4[3] = style.color_vec4[3];\n    v3scale(this.applied_style.color_vec4, style.color_vec4, alpha);\n  }\n  // this.applied_style.colorUR = style.colorUR;\n  // this.applied_style.colorLR = style.colorLR;\n  // this.applied_style.colorLL = style.colorLL;\n  // this.applied_style.color_mode = style.color_mode;\n\n  // if (this.applied_style.color_mode === COLOR_MODE.SINGLE) {\n  //   this.applied_style.colorUR = this.applied_style.colorLL = this.applied_style.colorLR = this.applied_style.color;\n  // }\n\n  this.determineShader();\n};\n\n// Replicate constants and utility functions on all font instances as well\n// GlovFont.prototype.COLOR_MODE = COLOR_MODE;\nGlovFont.prototype.ALIGN = ALIGN;\nGlovFont.prototype.style = fontStyle;\nGlovFont.prototype.styleAlpha = fontStyleAlpha;\nGlovFont.prototype.styleColored = fontStyleColored;\n\nfunction fontShadersInit() {\n  if (font_shaders.font_aa) {\n    return;\n  }\n  font_shaders.font_aa = shaders.create('shaders/font_aa.fp');\n  font_shaders.font_aa_glow = shaders.create('shaders/font_aa_glow.fp');\n  font_shaders.font_aa_outline = shaders.create('shaders/font_aa_outline.fp');\n  font_shaders.font_aa_outline_glow = shaders.create('shaders/font_aa_outline_glow.fp');\n  shaders.prelink(sprites.sprite_vshader, font_shaders.font_aa);\n  shaders.prelink(sprites.sprite_vshader, font_shaders.font_aa_glow);\n  shaders.prelink(sprites.sprite_vshader, font_shaders.font_aa_outline);\n  shaders.prelink(sprites.sprite_vshader, font_shaders.font_aa_outline_glow);\n}\n\nexport function fontCreate(font_info, texture_name) {\n  fontShadersInit();\n  return new GlovFont(font_info, texture_name);\n}\n\nexport function fontTick() {\n  tech_params_cache_idx = 0;\n  tech_params_cache.length = 0;\n  tech_params_pool_idx = 0;\n  techParamsAlloc();\n}\n","const assert = require('assert');\nconst { is_ios } = require('./browser.js');\nconst { cmd_parse } = require('./cmds.js');\nconst { applyCopy } = require('./effects.js');\nconst engine = require('./engine.js');\nconst { renderWidth, renderHeight } = engine;\nconst perf = require('./perf.js');\nconst settings = require('./settings.js');\nconst textures = require('./textures.js');\n\nlet last_num_passes = 0;\nlet num_passes = 0;\n\nlet temporary_textures = {};\nlet temporary_depthbuffers = {};\nlet temporary_depthtextures = {};\n\nlet reset_fbos = false;\nfunction resetFBOs() {\n  reset_fbos = true;\n}\n\nlet skip_release = false;\nexport function framebufferSkipRelease() {\n  // Skip releases for one frame, we're making a temporary change for a screenshot/etc\n  skip_release = true;\n}\n\nlet last_temp_idx = 0;\nfunction getTemporaryTexture(w, h, possibly_fbo) {\n  let key = `${w}_${h}`;\n  let is_fbo = possibly_fbo && settings.use_fbos;\n  if (is_fbo) {\n    key += '_fbo';\n  }\n  let temp = temporary_textures[key];\n  if (!temp) {\n    temp = temporary_textures[key] = { list: [], idx: 0 };\n  }\n  if (temp.idx >= temp.list.length) {\n    let tex = textures.createForCapture(`temp_${key}_${++last_temp_idx}`);\n    if (is_fbo) {\n      tex.allocFBO(w, h);\n    }\n    temp.list.push(tex);\n  }\n  let tex = temp.list[temp.idx++];\n  return tex;\n}\n\nfunction bindTemporaryDepthbuffer(w, h) {\n  let key = `${w}_${h}`;\n  let temp = temporary_depthbuffers[key];\n  if (!temp) {\n    temp = temporary_depthbuffers[key] = { list: [], idx: 0 };\n  }\n  if (temp.idx >= temp.list.length) {\n    let depth_buffer = gl.createRenderbuffer();\n    gl.bindRenderbuffer(gl.RENDERBUFFER, depth_buffer);\n    let attachment;\n    if (settings.fbo_depth16) {\n      gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, w, h);\n      attachment = gl.DEPTH_ATTACHMENT;\n    } else {\n      gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_STENCIL, w, h);\n      attachment = gl.DEPTH_STENCIL_ATTACHMENT;\n    }\n    gl.bindRenderbuffer(gl.RENDERBUFFER, null);\n    temp.list.push({ depth_buffer, attachment });\n  }\n  let { depth_buffer, attachment } = temp.list[temp.idx++];\n  gl.framebufferRenderbuffer(gl.FRAMEBUFFER, attachment, gl.RENDERBUFFER, depth_buffer);\n}\n\nfunction bindTemporaryDepthbufferTexture(w, h) {\n  let key = `${w}_${h}`;\n  let temp = temporary_depthtextures[key];\n  if (!temp) {\n    temp = temporary_depthtextures[key] = { list: [], idx: 0 };\n  }\n  if (temp.idx >= temp.list.length) {\n    let tex = textures.createForDepthCapture(`temp_${key}_${++last_temp_idx}`,\n      settings.fbo_depth16 ? textures.format.DEPTH16 : textures.format.DEPTH24);\n    tex.allocDepth(w, h);\n    let attachment = settings.fbo_depth16 ? gl.DEPTH_ATTACHMENT : gl.DEPTH_STENCIL_ATTACHMENT;\n\n    temp.list.push({ tex, attachment });\n  }\n  let { tex, attachment } = temp.list[temp.idx++];\n  gl.framebufferTexture2D(gl.FRAMEBUFFER, attachment, gl.TEXTURE_2D, tex.handle, 0);\n  return tex;\n}\n\nexport function temporaryTextureClaim(tex) {\n  for (let key in temporary_textures) {\n    let temp = temporary_textures[key];\n    let idx = temp.list.indexOf(tex);\n    if (idx !== -1) {\n      temp.list.splice(idx, 1);\n      if (temp.idx > idx) {\n        --temp.idx;\n      }\n      return;\n    }\n  }\n  assert(false);\n}\n\n// Call tex.captureEnd when done\nfunction framebufferCaptureStart(tex, w, h, possibly_fbo) {\n  assert.equal(engine.viewport[0], 0); // maybe allow/require setting viewport *after* starting capture instead?\n  assert.equal(engine.viewport[1], 0);\n  if (!w) {\n    w = renderWidth();\n    h = renderHeight();\n  }\n  if (!tex) {\n    tex = getTemporaryTexture(w, h, possibly_fbo);\n  }\n  tex.captureStart(w, h);\n  return tex;\n}\n\n// Does a capture directly from the framebuffer regardless of current use_fbos setting\n// Warning: Slow on iOS\nexport function framebufferCapture(tex, w, h, filter_linear, wrap) {\n  tex = framebufferCaptureStart(tex, w, h, false);\n  tex.captureEnd(filter_linear, wrap);\n  return tex;\n}\n\n\nlet cur_tex;\nlet cur_depth;\nexport function framebufferStart(opts) {\n  assert(!cur_tex);\n  assert(!cur_depth);\n  let { width, height, viewport, final, clear, need_depth, clear_all, clear_color, force_tex } = opts;\n  ++num_passes;\n  cur_depth = null;\n  if (force_tex) {\n    assert(viewport);\n    cur_tex = force_tex;\n    cur_tex.captureStart();\n  } else if (!final) {\n    cur_tex = framebufferCaptureStart(null, width, height, true);\n    if (settings.use_fbos) {\n      if (need_depth) {\n        if (need_depth === 'texture') {\n          cur_depth = bindTemporaryDepthbufferTexture(width, height);\n        } else {\n          bindTemporaryDepthbuffer(width, height);\n        }\n      } else {\n        // testing: force unbind, in case one was left bound\n        // gl.framebufferRenderbuffer(gl.FRAMEBUFFER, settings.fbo_depth16 ?\n        //   gl.DEPTH_ATTACHMENT : gl.DEPTH_STENCIL_ATTACHMENT, gl.RENDERBUFFER, null);\n      }\n    }\n  }\n  if (clear_color) {\n    gl.clearColor(clear_color[0], clear_color[1], clear_color[2], clear_color[3]);\n  }\n  if (clear && clear_all) {\n    // full clear, before setting viewport\n    gl.disable(gl.SCISSOR_TEST);\n    gl.clear(gl.COLOR_BUFFER_BIT | (need_depth ? gl.DEPTH_BUFFER_BIT : 0));\n  }\n  let need_scissor;\n  if (viewport) {\n    engine.setViewport(viewport);\n    need_scissor = viewport[0] || viewport[1] || viewport[2] !== engine.width || viewport[3] !== engine.height;\n    if (clear_all) { // not sure this logically follows, but we want this anywhere we're clearing all currently\n      need_scissor = false;\n    }\n  } else {\n    engine.setViewport([0, 0, width, height]);\n    need_scissor = width !== engine.width;\n  }\n  if (need_scissor) { // Note: previously `&& !settings.use_fbos`, but that seems wrong, why was it there?\n    gl.enable(gl.SCISSOR_TEST);\n    if (viewport) {\n      gl.scissor(viewport[0], viewport[1], viewport[2], viewport[3]);\n    } else {\n      gl.scissor(0, 0, width, height);\n    }\n  } else {\n    gl.disable(gl.SCISSOR_TEST);\n  }\n  if (clear && !clear_all) {\n    gl.clear(gl.COLOR_BUFFER_BIT | (need_depth ? gl.DEPTH_BUFFER_BIT : 0));\n  }\n}\n\nexport function framebufferEnd(opts) {\n  assert(cur_tex);\n  opts = opts || {};\n  let { filter_linear, wrap, need_depth } = opts;\n  assert.equal(Boolean(cur_depth), need_depth === 'texture');\n\n  cur_tex.captureEnd(filter_linear, wrap);\n  // Capture end for depth texture?  Nope, only works with FBOs in WebGL!\n\n  let ret;\n  if (cur_depth) {\n    ret = [cur_tex, cur_depth];\n  } else {\n    ret = cur_tex;\n  }\n  cur_tex = null;\n  cur_depth = null;\n\n  return ret;\n}\n\nexport function framebufferTopOfFrame() {\n  // In case of crash on previous frame\n  cur_tex = null;\n  cur_depth = null;\n}\n\nexport function framebufferEndOfFrame() {\n  assert(!cur_tex);\n  last_num_passes = num_passes;\n  num_passes = 0;\n  skip_release = skip_release && !reset_fbos;\n\n  for (let key in temporary_textures) {\n    let temp = temporary_textures[key];\n    if (reset_fbos) {\n      // Release all textures\n      temp.idx = 0;\n    }\n    // Release unused textures\n    if (!skip_release) {\n      while (temp.list.length > temp.idx) {\n        temp.list.pop().destroy();\n      }\n    }\n    if (!temp.list.length) {\n      delete temporary_textures[key];\n    } else {\n      temp.idx = 0;\n    }\n  }\n  for (let key in temporary_depthbuffers) {\n    let temp = temporary_depthbuffers[key];\n    if (reset_fbos) {\n      // Release all renderbuffers\n      temp.idx = 0;\n    }\n    // Release unused renderbuffers\n    if (!skip_release) {\n      while (temp.list.length > temp.idx) {\n        let { depth_buffer } = temp.list.pop();\n        // TODO: can this still be bound to a framebuffer? unlikely, but possible?\n        gl.deleteRenderbuffer(depth_buffer);\n      }\n    }\n    if (!temp.list.length) {\n      delete temporary_depthbuffers[key];\n    } else {\n      temp.idx = 0;\n    }\n  }\n  for (let key in temporary_depthtextures) {\n    let temp = temporary_depthtextures[key];\n    if (reset_fbos) {\n      // Release all depth textures\n      temp.idx = 0;\n    }\n    // Release unused depth textures\n    if (!skip_release) {\n      while (temp.list.length > temp.idx) {\n        let { tex } = temp.list.pop();\n        tex.destroy();\n      }\n    }\n    if (!temp.list.length) {\n      delete temporary_depthtextures[key];\n    } else {\n      temp.idx = 0;\n    }\n  }\n  reset_fbos = false;\n  skip_release = false;\n}\n\nexport function framebufferUpdateCanvasForCapture() {\n  if (cur_tex && settings.use_fbos) {\n    let saved_tex = cur_tex;\n    let saved_viewport = engine.viewport.slice(0);\n    // copy to canvas\n    framebufferEnd();\n    applyCopy({\n      source: saved_tex,\n      final: true,\n      viewport: saved_viewport,\n    });\n    // resume rendering to framebuffer\n    framebufferStart({\n      force_tex: saved_tex,\n      viewport: saved_viewport,\n    });\n    return saved_tex; // just for .width/height\n  } else {\n    return { width: engine.viewport[2], height: engine.viewport[3] };\n  }\n}\n\nsettings.register({\n  show_passes: {\n    label: 'Show Postprocessing Passes',\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n  },\n  use_fbos: {\n    label: 'Use Framebuffer Objects for postprocessing',\n    default_value: is_ios ? 1 : 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n    ver: 1,\n  },\n  fbo_depth16: { // This had no effect on performance, tested on iPhone, Xperia or Intel GPU\n    label: 'Use 16-bit depth buffers for offscreen rendering',\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n    on_change: resetFBOs,\n  },\n  fbo_rgba: { // This had no effect on performance, tested on iPhone, Xperia or Intel GPU\n    label: 'Use RGBA color buffers for offscreen rendering',\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n    on_change: resetFBOs,\n  },\n});\nreset_fbos = false; // in case it was flagged while registering settings\n\nperf.addMetric({\n  name: 'passes',\n  show_stat: 'show_passes',\n  labels: {\n    'passes: ': () => last_num_passes.toString(),\n  },\n});\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint no-bitwise:off */\n\nconst assert = require('assert');\nconst { cmd_parse } = require('./cmds.js');\nconst engine = require('./engine.js');\nconst perf = require('./perf.js');\nconst settings = require('./settings.js');\nconst { MAX_SEMANTIC } = require('./shaders.js');\nconst { ceil, max, min } = Math;\n\nexport const TRIANGLES = 4;\nexport const TRIANGLE_FAN = 6;\nexport const QUADS = 7;\n\nconst MAX_VERT_COUNT = 65536 - 4; // WebGL2 treats 65535 as \"primitive restart\" and also dies on iOS 15\n\nsettings.register({\n  show_render_stats: {\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n  },\n});\n\nexport let stats = {\n  draw_calls: 0,\n  draw_calls_geom: 0,\n  draw_calls_sprite: 0,\n  draw_calls_dyn: 0,\n  tris: 0,\n  verts: 0,\n  sprites: 0,\n  dyn: 0,\n  sprite_sort_elems: 0,\n  sprite_sort_cmps: 0,\n  font_calls: 0,\n  font_params: 0,\n};\nlet last_stats = {};\nlet perf_labels = {};\nfor (let key in stats) {\n  perf_labels[`${key}: `] = () => String(last_stats[key]);\n}\nperf.addMetric({\n  name: 'render_stats',\n  show_stat: 'show_render_stats',\n  show_all: true,\n  labels: perf_labels,\n});\n\n\nconst gl_byte_size = {\n  0x1400: 1, // GL_BYTE\n  0x1401: 1, // GL_UNSIGNED_BYTE\n  0x1402: 2, // GL_SHORT\n  0x1403: 2, // GL_UNSIGNED_SHORT\n  0x1406: 4, // GL_FLOAT\n};\n\n// let unit_buf;\n// let unit_buf_len = 0;\n\nlet bound_geom;\n\nlet bound_array_buf = null;\nlet bound_index_buf = null;\n\nlet quad_index_buf;\nlet quad_index_buf_len = 0;\n\nfunction deleteBuffer(handle) {\n  if (!handle) {\n    return;\n  }\n  if (bound_array_buf === handle) {\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\n    bound_array_buf = null;\n  }\n  if (bound_index_buf === handle) {\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n    bound_index_buf = null;\n  }\n  gl.deleteBuffer(handle);\n}\n\nlet attrib_enabled = 0;\nfunction enableVertexAttribArray(bits) {\n  if (bits === attrib_enabled) {\n    return;\n  }\n  let disable_mask = (attrib_enabled & (~bits));\n  let enable_mask = ((~attrib_enabled) & bits);\n  attrib_enabled = bits;\n\n  if (disable_mask) {\n    let n = 0;\n    do {\n      if (disable_mask & 1) {\n        gl.disableVertexAttribArray(n);\n      }\n      n++;\n      disable_mask >>= 1;\n    } while (disable_mask);\n  }\n\n  if (enable_mask) {\n    let n = 0;\n    do {\n      if (enable_mask & 1) {\n        gl.enableVertexAttribArray(n);\n      }\n      n++;\n      enable_mask >>= 1;\n    } while (enable_mask);\n  }\n}\n\n// function bindUnitBuf(arr_idx, len) {\n//   if (len > unit_buf_len) {\n//     deleteBuffer(unit_buf);\n//     unit_buf = gl.createBuffer();\n//     unit_buf_len = max(ceil(unit_buf_len * 1.5), len);\n//     gl.bindBuffer(gl.ARRAY_BUFFER, unit_buf);\n//     bound_array_buf = unit_buf;\n//     let arr = new Uint8Array(unit_buf_len * 4);\n//     for (let ii = 0; ii < unit_buf_len * 4; ++ii) {\n//       arr[ii] = 255;\n//     }\n//     gl.bufferData(gl.ARRAY_BUFFER, arr, gl.STATIC_DRAW);\n//   } else {\n//     if (bound_array_buf !== unit_buf) {\n//       gl.bindBuffer(gl.ARRAY_BUFFER, unit_buf);\n//       bound_array_buf = unit_buf;\n//     }\n//   }\n//   gl.vertexAttribPointer(arr_idx, 4, gl.UNSIGNED_BYTE, true, 0, 0);\n// }\n\n// Verts should be ordered counter-clockwise from the upper left\nfunction getQuadIndexBuf(quad_count) {\n  assert(quad_count <= MAX_VERT_COUNT/4);\n  // If not, need to split into multiple vertex and index buffers (fairly easy),\n  //   or use the OES_element_index_uint extension (trivial, but probably slower, maybe not supported on mobile?)\n  if (quad_count * 6 > quad_index_buf_len) {\n    if (!quad_index_buf) {\n      quad_index_buf = gl.createBuffer();\n    } else {\n      // freeing old one\n      engine.perf_state.gpu_mem.geom -= quad_index_buf_len * 2;\n    }\n    quad_index_buf_len = min(max(ceil(quad_index_buf_len * 1.5), quad_count * 6), MAX_VERT_COUNT*6/4);\n    if (bound_index_buf !== quad_index_buf) {\n      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, quad_index_buf);\n      bound_index_buf = quad_index_buf;\n    }\n    let arr = new Uint16Array(quad_index_buf_len);\n    let vidx = 0;\n    for (let ii = 0; ii < quad_index_buf_len;) {\n      arr[ii++] = vidx + 1;\n      arr[ii++] = vidx + 3;\n      arr[ii++] = vidx++; // 0\n      arr[ii++] = vidx++; // 1\n      arr[ii++] = vidx++; // 2\n      arr[ii++] = vidx++; // 3\n    }\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, arr, gl.STATIC_DRAW);\n    engine.perf_state.gpu_mem.geom += quad_index_buf_len * 2;\n  }\n  return quad_index_buf;\n}\n\nexport function createIndices(idxs) {\n  let ret = {\n    ibo: gl.createBuffer(),\n    ibo_size: idxs.length,\n  };\n  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ret.ibo);\n  bound_index_buf = ret.ibo;\n  gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, idxs, gl.STATIC_DRAW);\n  engine.perf_state.gpu_mem.geom += idxs.length * 2;\n  return ret;\n}\n\nfunction formatInfo(format) {\n  if (!format.info) {\n    let stride = 0;\n    let elem_count = 0;\n    let used_attribs = 0;\n    let common_byte_size = 0;\n    for (let ii = 0; ii < format.length; ++ii) {\n      let fmt = format[ii];\n      let sem = fmt[0];\n      let gltype = fmt[1];\n      let count = fmt[2];\n      used_attribs |= (1 << sem);\n      let byte_size = gl_byte_size[gltype];\n      assert(byte_size);\n      assert(!common_byte_size || byte_size === common_byte_size);\n      common_byte_size = byte_size;\n      fmt[3] = fmt[3] || false;\n      fmt[4] = byte_size;\n      stride += count * byte_size;\n      elem_count += count;\n    }\n    format.info = {\n      stride, elem_count, used_attribs, common_byte_size\n    };\n  }\n  return format.info;\n}\n\n// format is [shaders.semantic.foo, gl.FLOAT/UNSIGNED_BYTE/etc, count, normalized]\nfunction Geom(format, verts, idxs, mode) {\n  this.mode = mode || TRIANGLES;\n  this.format = format;\n  let info = this.format_info = formatInfo(format);\n  this.stride = info.stride;\n  this.used_attribs = info.used_attribs;\n\n  this.vert_count = verts.length / this.format_info.elem_count;\n  this.vert_gpu_mem = verts.length * this.format_info.common_byte_size;\n  if (verts.length) {\n    this.vbo = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.vbo);\n    bound_array_buf = this.vbo;\n    gl.bufferData(gl.ARRAY_BUFFER, verts, gl.STATIC_DRAW);\n    engine.perf_state.gpu_mem.geom += this.vert_gpu_mem;\n  }\n  this.orig_mode = mode;\n  if (idxs) {\n    if (idxs.ibo) {\n      this.ibo = idxs.ibo;\n      this.ibo_owned = false;\n      this.ibo_size = idxs.ibo_size;\n    } else if (idxs.length) {\n      this.ibo = gl.createBuffer();\n      this.ibo_owned = true;\n      this.ibo_size = idxs.length;\n      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.ibo);\n      bound_index_buf = this.ibo;\n      gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, idxs, gl.STATIC_DRAW);\n      engine.perf_state.gpu_mem.geom += idxs.length * 2;\n    } else {\n      // presumably updated later with .updateIndex\n      this.ibo = null;\n      this.ibo_owned = true;\n      this.ibo_size = 0;\n    }\n  } else if (mode === QUADS) {\n    assert.equal(this.vert_count % 4, 0);\n    let quad_count = this.vert_count / 4;\n    // PERFTODO: Use GL_QUADS_OES extension\n    this.ibo = getQuadIndexBuf(quad_count);\n    this.ibo_owned = false;\n    this.ibo_size = quad_count * 6;\n    this.mode = TRIANGLES;\n  } else if (mode === TRIANGLE_FAN) {\n    this.mode = TRIANGLE_FAN;\n  } else {\n    this.ibo = null;\n    this.ibo_owned = false;\n  }\n  this.updateTriCount();\n}\n\nfunction trianglesFromMode(mode, eff_vert_count) {\n  if (mode === TRIANGLES) {\n    return eff_vert_count / 3;\n  } else if (mode === TRIANGLE_FAN) {\n    return eff_vert_count - 2;\n  } else {\n    assert(!eff_vert_count);\n    return 0;\n  }\n}\n\nGeom.prototype.updateTriCount = function () {\n  let eff_vert_count = this.ibo ? this.ibo_size : this.vert_count;\n  this.tri_count = trianglesFromMode(this.mode, eff_vert_count);\n};\n\nGeom.prototype.updateIndex = function (idxs, num_idxs) {\n  assert.equal(this.ibo_owned, true);\n  if (num_idxs > this.ibo_size) {\n    if (bound_geom === this) {\n      bound_geom = null;\n    }\n    engine.perf_state.gpu_mem.geom -= this.ibo_size * 2;\n    deleteBuffer(this.ibo);\n    this.ibo_size = idxs.length;\n    this.ibo = gl.createBuffer();\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.ibo);\n    bound_index_buf = this.ibo;\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, idxs, gl.DYNAMIC_DRAW);\n    engine.perf_state.gpu_mem.geom += idxs.length * 2;\n  } else {\n    // Fits\n    if (bound_index_buf !== this.ibo) {\n      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.ibo);\n      bound_index_buf = this.ibo;\n    }\n    gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER, 0, idxs.subarray(0, num_idxs));\n  }\n  this.updateTriCount();\n};\n\nGeom.prototype.updateSub = function (offset, verts) {\n  if (bound_array_buf !== this.vbo) {\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.vbo);\n    bound_array_buf = this.vbo;\n  }\n  gl.bufferSubData(gl.ARRAY_BUFFER, offset, verts);\n};\n\nGeom.prototype.update = function (verts, num_verts) {\n  if (num_verts > this.vert_count) {\n    if (bound_geom === this) {\n      bound_geom = null;\n    }\n    engine.perf_state.gpu_mem.geom -= this.vert_gpu_mem;\n    deleteBuffer(this.vbo);\n    // Note: matching size, ignoring num_verts\n    this.vert_count = verts.length / this.format_info.elem_count;\n    this.vert_gpu_mem = verts.length * this.format_info.common_byte_size;\n    this.vbo = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.vbo);\n    bound_array_buf = this.vbo;\n    gl.bufferData(gl.ARRAY_BUFFER, verts, gl.DYNAMIC_DRAW);\n    engine.perf_state.gpu_mem.geom += this.vert_gpu_mem;\n  } else {\n    // Fits\n    if (bound_array_buf !== this.vbo) {\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.vbo);\n      bound_array_buf = this.vbo;\n    }\n    gl.bufferSubData(gl.ARRAY_BUFFER, 0, verts.subarray(0, num_verts * this.format_info.elem_count));\n    // gl.bufferData(gl.ARRAY_BUFFER, verts, gl.DYNAMIC_DRAW);\n  }\n  if (this.orig_mode === QUADS) {\n    assert.equal(this.ibo_owned, false);\n    let quad_count = num_verts / 4;\n    this.ibo = getQuadIndexBuf(quad_count);\n    this.ibo_size = quad_count * 6;\n  }\n  this.updateTriCount();\n};\n\nGeom.prototype.dispose = function () {\n  if (this.ibo_owned) {\n    deleteBuffer(this.ibo);\n  }\n  this.ibo = null;\n  deleteBuffer(this.vbo);\n  this.vbo = null;\n  engine.perf_state.gpu_mem.geom -= this.vert_gpu_mem;\n  this.vert_gpu_mem = 0;\n};\n\nlet bound_attribs = (function () {\n  let r = [];\n  for (let ii = 0; ii < 16; ++ii) {\n    r.push({\n      vbo: null,\n      offset: 0,\n    });\n  }\n  return r;\n}());\n\nexport function geomResetState() {\n  // Resetting this avoids a state management bug on Chrome 71-73 on Redmi 6A -\n  //   it seems the browser was leaving something bound at a low level, perhaps\n  //   from generating mipmaps or something?\n  bound_geom = null;\n  bound_index_buf = null;\n  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n  bound_array_buf = null;\n  gl.bindBuffer(gl.ARRAY_BUFFER, null);\n  for (let ii = 0; ii < MAX_SEMANTIC; ++ii) {\n    gl.disableVertexAttribArray(ii);\n  }\n  attrib_enabled = 0;\n  for (let ii = 0; ii < bound_attribs.length; ++ii) {\n    bound_attribs[ii].vbo = null;\n  }\n  // Also resetting stats for metrics here, but could do that separately if needed\n  stats.draw_calls = stats.draw_calls_geom + stats.draw_calls_sprite;\n  for (let key in stats) {\n    last_stats[key] = stats[key];\n    stats[key] = 0;\n  }\n}\n\nGeom.prototype.bind = function () {\n  if (bound_geom !== this) {\n    bound_geom = this;\n    let vbo = this.vbo;\n\n    let offset = 0;\n    for (let ii = 0; ii < this.format.length; ++ii) {\n      let fmt = this.format[ii];\n      let count = fmt[2];\n      let byte_size = fmt[4];\n      let sem = fmt[0];\n      if (bound_attribs[sem].vbo === vbo) { //  && bound_attribs[sem].offset = offset\n        // already bound\n      } else {\n        if (bound_array_buf !== vbo) {\n          gl.bindBuffer(gl.ARRAY_BUFFER, vbo);\n          bound_array_buf = vbo;\n        }\n        let gltype = fmt[1];\n        let normalized = fmt[3];\n        gl.vertexAttribPointer(sem, count, gltype, normalized, this.stride, offset);\n        bound_attribs[sem].vbo = bound_array_buf;\n        // bound_attribs[sem].offset = offset;\n      }\n      offset += count * byte_size;\n    }\n    // if (!used[1]) { // COLOR\n    //   used_attribs |= 1 << shader.semantics.COLOR;\n    //   bindUnitBuf(1, this.vert_count);\n    // }\n    enableVertexAttribArray(this.used_attribs);\n  }\n\n  if (this.ibo && bound_index_buf !== this.ibo) {\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.ibo);\n    bound_index_buf = this.ibo;\n  }\n};\nGeom.prototype.draw = function () {\n  this.bind();\n  ++stats.draw_calls_geom;\n  stats.tris += this.tri_count;\n  stats.verts += this.vert_count;\n  if (this.ibo) {\n    gl.drawElements(this.mode, this.ibo_size, gl.UNSIGNED_SHORT, 0);\n  } else {\n    gl.drawArrays(this.mode, 0, this.vert_count);\n  }\n};\nGeom.prototype.drawSub = function (start, tri_count) {\n  assert.equal(this.mode, TRIANGLES);\n  this.bind();\n  ++stats.draw_calls_geom;\n  if (this.ibo) {\n    stats.tris += tri_count;\n    stats.verts += tri_count*2; // assumes quads\n    gl.drawElements(this.mode, tri_count * 3, gl.UNSIGNED_SHORT, start * 2);\n  } else {\n    gl.drawArrays(this.mode, start, tri_count * 3);\n  }\n};\n\nfunction GeomMultiQuads(format, verts) {\n  let format_info = formatInfo(format);\n  let ec = format_info.elem_count;\n  let vert_count = verts.length / ec;\n  this.geoms = [];\n  for (let idx = 0; idx < vert_count; idx += MAX_VERT_COUNT) {\n    let num_sub_verts = min(vert_count - idx, MAX_VERT_COUNT);\n    let sub_data = new Uint8Array(verts.buffer, idx * ec, num_sub_verts * ec);\n    this.geoms.push(new Geom(format, sub_data, null, QUADS));\n  }\n}\nGeomMultiQuads.prototype.draw = function () {\n  for (let ii = 0; ii < this.geoms.length; ++ii) {\n    this.geoms[ii].draw();\n  }\n};\nGeomMultiQuads.prototype.dispose = function () {\n  for (let ii = 0; ii < this.geoms.length; ++ii) {\n    this.geoms[ii].dispose();\n  }\n  this.geoms = null;\n};\n\nexport function create(format, verts, idxs, mode) {\n  return new Geom(format, verts, idxs, mode);\n}\n\nexport function createQuads(format, verts, fixed_size) {\n  let format_info = formatInfo(format);\n  assert(fixed_size || verts instanceof Uint8Array); // only one handled by GeomMultiQuads for now\n  let vert_count = verts.length / format_info.elem_count;\n  if (vert_count > MAX_VERT_COUNT) {\n    return new GeomMultiQuads(format, verts);\n  }\n  return new Geom(format, verts, null, QUADS);\n}\n\nexport function startup() {\n  // Nothing for now.\n}\n","/* eslint no-bitwise:off */\n// From https://stackoverflow.com/questions/8936984/uint8array-to-string-in-javascript\n\nlet charCache = new Array(128);  // Preallocate the cache for the common single byte chars\nlet charFromCodePt = String.fromCodePoint || String.fromCharCode;\nlet result = [];\nexport function decode(array) {\n  let codePt;\n  let byte1;\n  let buffLen = array.length;\n\n  result.length = 0;\n\n  for (let i = 0; i < buffLen;) {\n    byte1 = array[i++];\n\n    if (byte1 <= 0x7F) {\n      codePt = byte1;\n    } else if (byte1 <= 0xDF) {\n      codePt = ((byte1 & 0x1F) << 6) | (array[i++] & 0x3F);\n    } else if (byte1 <= 0xEF) {\n      codePt = ((byte1 & 0x0F) << 12) | ((array[i++] & 0x3F) << 6) | (array[i++] & 0x3F);\n    } else if (String.fromCodePoint) {\n      codePt = ((byte1 & 0x07) << 18) | ((array[i++] & 0x3F) << 12) | ((array[i++] & 0x3F) << 6) | (array[i++] & 0x3F);\n    } else {\n      codePt = 63;    // Cannot convert four byte code points, so use \"?\" instead\n      i += 3;\n    }\n\n    result.push(charCache[codePt] || (charCache[codePt] = charFromCodePt(codePt)));\n  }\n\n  return result.join('');\n}\n","// Derived from (MIT Licensed) https://github.com/uber-web/loaders.gl/tree/master/modules/gltf\n\nconst TYPES = ['SCALAR', 'VEC2', 'VEC3', 'VEC4'];\n\nexport function getAccessorTypeFromSize(size) {\n  const type = TYPES[size - 1];\n  return type || TYPES[0];\n}\n\n// glTF ACCESSOR CONSTANTS\n\nexport const ATTRIBUTE_TYPE_TO_COMPONENTS = {\n  SCALAR: 1,\n  VEC2: 2,\n  VEC3: 3,\n  VEC4: 4,\n  MAT2: 4,\n  MAT3: 9,\n  MAT4: 16\n};\n\nexport const ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE = {\n  5120: 1,\n  5121: 1,\n  5122: 2,\n  5123: 2,\n  5125: 4,\n  5126: 4\n};\n\nexport const ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY = {\n  5120: Int8Array,\n  5121: Uint8Array,\n  5122: Int16Array,\n  5123: Uint16Array,\n  5125: Uint32Array,\n  5126: Float32Array\n};\n","// Derived from (MIT Licensed) https://github.com/uber-web/loaders.gl/tree/master/modules/gltf\n/* eslint-env browser */\n\n/* eslint-disable import/order */\nconst assert = require('assert');\n\nconst { unpackGLBBuffers } = require('./unpack-glb-buffers.js');\nconst { unpackBinaryJson } = require('./unpack-binary-json.js');\n\nfunction padTo4Bytes(byteLength) {\n  return (byteLength + 3) & ~3;\n}\n\nconst decode_utf8 = require('./decode-utf8.js');\n\nconst {\n  ATTRIBUTE_TYPE_TO_COMPONENTS,\n  ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE,\n  ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY\n} = require('./gltf-type-utils.js');\n\nconst MAGIC_glTF = 0x676c5446; // glTF in Big-Endian ASCII\n\nconst GLB_FILE_HEADER_SIZE = 12;\nconst GLB_CHUNK_HEADER_SIZE = 8;\n\nconst GLB_CHUNK_TYPE_JSON = 0x4e4f534a;\nconst GLB_CHUNK_TYPE_BIN = 0x004e4942;\n\nconst LE = true; // Binary GLTF is little endian.\nconst BE = false; // Magic needs to be written as BE\n\n// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#glb-file-format-specification\nfunction GLBParser() {\n  // Result\n  this.binaryByteOffset = null;\n  this.packedJson = null;\n  this.json = null;\n}\n\nfunction parseBinary(self) {\n  // GLB Header\n  const dataView = new DataView(self.glbArrayBuffer);\n  const magic1 = dataView.getUint32(0, BE); // Magic number (the ASCII string 'glTF').\n  const version = dataView.getUint32(4, LE); // Version 2 of binary glTF container format\n  const fileLength = dataView.getUint32(8, LE); // Total byte length of generated file\n\n  let valid = magic1 === MAGIC_glTF;\n  if (!valid) {\n    console.warn('Invalid GLB magic string');\n  }\n\n  assert(version === 2, `Invalid GLB version ${version}. Only .glb v2 supported`);\n  assert(fileLength > 20);\n\n  // Write the JSON chunk\n  const jsonChunkLength = dataView.getUint32(12, LE); // Byte length of json chunk\n  const jsonChunkFormat = dataView.getUint32(16, LE); // Chunk format as uint32\n\n  valid = jsonChunkFormat === GLB_CHUNK_TYPE_JSON || jsonChunkFormat === 0; // Back compat\n  assert(valid, `JSON chunk format ${jsonChunkFormat}`);\n\n  // Create a \"view\" of the binary encoded JSON data\n  const jsonChunkOffset = GLB_FILE_HEADER_SIZE + GLB_CHUNK_HEADER_SIZE; // First headers: 20 bytes\n  const jsonChunk = new Uint8Array(self.glbArrayBuffer, jsonChunkOffset, jsonChunkLength);\n\n  // Decode the JSON binary array into clear text\n  const jsonText = decode_utf8.decode(jsonChunk);\n\n  // Parse the JSON text into a JavaScript data structure\n  self.json = JSON.parse(jsonText);\n\n  // TODO - BIN chunk can be optional\n  const binaryChunkStart = jsonChunkOffset + padTo4Bytes(jsonChunkLength);\n  self.binaryByteOffset = binaryChunkStart + GLB_CHUNK_HEADER_SIZE;\n\n  const binChunkFormat = dataView.getUint32(binaryChunkStart + 4, LE); // Chunk format as uint32\n  valid = binChunkFormat === GLB_CHUNK_TYPE_BIN || binChunkFormat === 1; // Back compat\n  assert(valid, `BIN chunk format ${binChunkFormat}`);\n\n  return {\n    arrayBuffer: self.glbArrayBuffer,\n    binaryByteOffset: self.binaryByteOffset,\n    json: self.json\n  };\n}\n\nfunction parseInternal(self) {\n  const result = parseBinary(self);\n  self.packedJson = result.json;\n  self.unpackedBuffers = unpackGLBBuffers(self.glbArrayBuffer, self.json, self.binaryByteOffset);\n  self.json = unpackBinaryJson(self.json, self.unpackedBuffers);\n}\n\nGLBParser.prototype.parseSync = function (arrayBuffer) {\n  // Input\n  this.glbArrayBuffer = arrayBuffer;\n\n  // Only parse once\n  if (this.json === null && this.binaryByteOffset === null) {\n    parseInternal(this);\n  }\n  return this;\n};\n\n// Return the gltf JSON and the original arrayBuffer\nGLBParser.prototype.parse = function (arrayBuffer) {\n  return this.parseSync(arrayBuffer);\n};\n\n// Returns application JSON data stored in `key`\nGLBParser.prototype.getApplicationData = function (key) {\n  return this.json[key];\n};\n\n// Returns JSON envelope\nGLBParser.prototype.getJSON = function () {\n  return this.json;\n};\n\n// Return binary chunk\nGLBParser.prototype.getArrayBuffer = function () {\n  return this.glbArrayBuffer;\n};\n\n// Return index into binary chunk\nGLBParser.prototype.getBinaryByteOffset = function () {\n  return this.binaryByteOffset;\n};\n\n// Unpacks a bufferview into a new Uint8Array that is a view into the binary chunk\nGLBParser.prototype.getBufferView = function (glTFBufferView) {\n  const byteOffset = (glTFBufferView.byteOffset || 0) + this.binaryByteOffset;\n  return new Uint8Array(this.glbArrayBuffer, byteOffset, glTFBufferView.byteLength);\n};\n\n// Unpacks a glTF accessor into a new typed array that is a view into the binary chunk\nGLBParser.prototype.getBuffer = function (glTFAccessor) {\n  // Decode the glTF accessor format\n  const ArrayType = ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY[glTFAccessor.componentType];\n  const components = ATTRIBUTE_TYPE_TO_COMPONENTS[glTFAccessor.type];\n  const bytesPerComponent = ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE[glTFAccessor.componentType];\n  const length = glTFAccessor.count * components;\n  const byteLength = glTFAccessor.count * components * bytesPerComponent;\n\n  // Get the boundaries of the binary sub-chunk for this bufferView\n  const glTFBufferView = this.json.bufferViews[glTFAccessor.bufferView];\n  assert(byteLength >= 0 && glTFAccessor.byteOffset + byteLength <= glTFBufferView.byteLength);\n\n  const byteOffset = glTFBufferView.byteOffset + this.binaryByteOffset + glTFAccessor.byteOffset;\n  return new ArrayType(this.glbArrayBuffer, byteOffset, length);\n};\n\n// Unpacks an image into an HTML image\nGLBParser.prototype.getImageData = function (glTFImage) {\n  return {\n    typedArray: this.getBufferView(glTFImage.bufferView),\n    mimeType: glTFImage.mimeType || 'image/jpeg'\n  };\n};\n\nGLBParser.prototype.getImage = function (glTFImage) {\n  const arrayBufferView = this.getBufferView(glTFImage.bufferView);\n  const mimeType = glTFImage.mimeType || 'image/jpeg';\n  const blob = new Blob([arrayBufferView], { type: mimeType });\n  const urlCreator = window.URL || window.webkitURL;\n  const imageUrl = urlCreator.createObjectURL(blob);\n  const img = new Image();\n  img.src = imageUrl;\n  return img;\n};\n\n// GLBParser.prototype.getImageAsync = function (glTFImage) {\n//   return new Promise(resolve => {\n//     const arrayBufferView = this.getBufferView(glTFImage.bufferView);\n//     const mimeType = glTFImage.mimeType || 'image/jpeg';\n//     const blob = new Blob([arrayBufferView], {type: mimeType});\n//     const urlCreator = window.URL || window.webkitURL;\n//     const imageUrl = urlCreator.createObjectURL(blob);\n//     const img = new Image();\n//     img.onload = () => resolve(img);\n//     img.src = imageUrl;\n//   });\n// };\n\nmodule.exports = GLBParser;\nGLBParser.parse = function (data) {\n  let parser = new GLBParser();\n  return parser.parse(data);\n};\n","// Derived from (MIT Licensed) https://github.com/uber-web/loaders.gl/tree/master/modules/gltf\n\nfunction parseJSONPointer(value) {\n  if (typeof value === 'string') {\n    // Remove escape character\n    if (value.indexOf('##/') === 0) {\n      return value.slice(1);\n    }\n\n    let matches = value.match(/#\\/([a-z]+)\\/([0-9]+)/);\n    if (matches) {\n      const index = parseInt(matches[2], 10);\n      return [matches[1], index];\n    }\n\n    // Legacy: `$$$i`\n    matches = value.match(/\\$\\$\\$([0-9]+)/);\n    if (matches) {\n      const index = parseInt(matches[1], 10);\n      return ['accessors', index];\n    }\n  }\n\n  return null;\n}\n\nfunction decodeJSONPointer(object, buffers) {\n  const pointer = parseJSONPointer(object);\n  if (pointer) {\n    const field = pointer[0];\n    const index = pointer[1];\n    const buffer = buffers[field] && buffers[field][index];\n    if (buffer) {\n      return buffer;\n    }\n    console.error(`Invalid JSON pointer ${object}: #/${field}/${index}`);\n  }\n  return null;\n}\n\n// Recursively unpacks objects, replacing \"JSON pointers\" with typed arrays\nfunction unpackJsonArraysRecursive(json, topJson, buffers, options = {}) {\n  const object = json;\n\n  const buffer = decodeJSONPointer(object, buffers);\n  if (buffer) {\n    return buffer;\n  }\n\n  // Copy array\n  if (Array.isArray(object)) {\n    return object.map((element) => unpackJsonArraysRecursive(element, topJson, buffers, options));\n  }\n\n  // Copy object\n  if (object !== null && typeof object === 'object') {\n    const newObject = {};\n    for (const key in object) {\n      newObject[key] = unpackJsonArraysRecursive(object[key], topJson, buffers, options);\n    }\n    return newObject;\n  }\n\n  return object;\n}\n\nexport function unpackBinaryJson(json, buffers, options = {}) {\n  return unpackJsonArraysRecursive(json, json, buffers, options);\n}\n","// Derived from (MIT Licensed) https://github.com/uber-web/loaders.gl/tree/master/modules/gltf\n\nconst assert = require('assert');\n\nconst {\n  ATTRIBUTE_TYPE_TO_COMPONENTS,\n  ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE,\n  ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY\n} = require('./gltf-type-utils.js');\n\n// Creates a new ArrayBuffer starting at the offset, containing all remaining bytes\n// TODO - should not be needed, see above\nfunction getArrayBufferAtOffset(arrayBuffer, byteOffset) {\n  const length = arrayBuffer.byteLength - byteOffset;\n  const binaryBuffer = new ArrayBuffer(length);\n  const sourceArray = new Uint8Array(arrayBuffer);\n  const binaryArray = new Uint8Array(binaryBuffer);\n  for (let i = 0; i < length; i++) {\n    binaryArray[i] = sourceArray[byteOffset + i];\n  }\n  return binaryBuffer;\n}\n\nfunction getArrayTypeAndLength(accessor, bufferView) {\n  const ArrayType = ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY[accessor.componentType];\n  const components = ATTRIBUTE_TYPE_TO_COMPONENTS[accessor.type];\n  const bytesPerComponent = ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE[accessor.componentType];\n  const length = accessor.count * components;\n  const byteLength = accessor.count * components * bytesPerComponent;\n  assert(byteLength >= 0 && byteLength <= bufferView.byteLength);\n  return { ArrayType, length, byteLength };\n}\n\nfunction unpackAccessors(arrayBuffer, bufferViews, json) {\n  // unpack accessors\n  const accessors = json.accessors || [];\n\n  const accessorBuffers = [];\n\n  for (let i = 0; i < accessors.length; ++i) {\n    const accessor = accessors[i];\n    assert(accessor);\n\n    const bufferView = bufferViews[accessor.bufferView];\n    // Draco encoded meshes don't have bufferView in accessor\n    if (bufferView) {\n      // Create a new typed array as a view into the combined buffer\n      const { ArrayType, length } = getArrayTypeAndLength(accessor, bufferView);\n      const array = new ArrayType(arrayBuffer, bufferView.byteOffset, length);\n      // Store the metadata on the array (e.g. needed to determine number of components per element)\n      array.accessor = accessor;\n      accessorBuffers.push(array);\n    }\n  }\n\n  return accessorBuffers;\n}\n\nfunction unpackImages(arrayBuffer, bufferViews, json) {\n  // unpack images\n  const images = json.images || [];\n\n  const imageBuffers = [];\n\n  for (let i = 0; i < images.length; ++i) {\n    const image = images[i];\n    assert(image);\n\n    if (image.bufferView === undefined) {\n      imageBuffers.push(null);\n      continue;\n    }\n\n    const bufferView = bufferViews[image.bufferView];\n    assert(bufferView);\n\n    // Create a new typed array as a view into the combined buffer\n    const array = new Uint8Array(arrayBuffer, bufferView.byteOffset, bufferView.byteLength);\n    // Store the metadata on the array (e.g. needed to determine number of components per element)\n    array.imate = image;\n    imageBuffers.push(array);\n  }\n\n  return imageBuffers;\n}\n\nexport function unpackGLBBuffers(arrayBuffer, json, binaryByteOffset) {\n  // TODO - really inefficient, should just use the offset into the original array buffer\n  if (binaryByteOffset) {\n    arrayBuffer = getArrayBufferAtOffset(arrayBuffer, binaryByteOffset);\n  }\n\n  const bufferViews = json.bufferViews || [];\n\n  for (let i = 0; i < bufferViews.length; ++i) {\n    const bufferView = bufferViews[i];\n    assert(bufferView.byteLength >= 0);\n  }\n\n  return {\n    // TODO: delete unpackAccessors and use buffer views only?\n    accessors: unpackAccessors(arrayBuffer, bufferViews, json),\n    images: unpackImages(arrayBuffer, bufferViews, json)\n  };\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// System for registering callbacks to run in event handlers on the next frame\n// Used to get around restrictions on APIs like pointer lock, fullscreen, or\n// screen orientation.\n\nconst assert = require('assert');\n\nlet cbs = {};\nexport function topOfFrame() {\n  cbs = {};\n}\n\nexport function on(type, code_or_pos, cb) {\n  let list = cbs[type] = cbs[type] || [];\n  if (typeof code_or_pos === 'number') {\n    list[code_or_pos] = cb;\n  } else {\n    list.push([code_or_pos, cb]);\n  }\n}\n\nexport function handle(type, event) {\n  let list = cbs[type];\n  if (!list) {\n    return;\n  }\n  switch (type) {\n    case 'keydown':\n    case 'keyup':\n      if (list[event.keyCode]) {\n        list[event.keyCode](type, event);\n      }\n      break;\n    case 'mouseup':\n    case 'mousedown': {\n      let x = event.pageX;\n      let y = event.pageY;\n      let button = event.button;\n      for (let ii = 0; ii < list.length; ++ii) {\n        let elem = list[ii];\n        let pos = elem[0];\n        if (x >= pos.x && x < pos.x + pos.w &&\n          y >= pos.y && y < pos.y + pos.h &&\n          (pos.button < 0 || pos.button === button)\n        ) {\n          elem[1](type, event);\n          break;\n        }\n      }\n    } break;\n    default:\n      assert(false);\n  }\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n// Some code from Turbulenz: Copyright (c) 2012-2013 Turbulenz Limited\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* global navigator */\n\n/* eslint-disable import/order */\nconst assert = require('assert');\n\nconst UP_EDGE = 0; // only for pads, which use === null as \"up\"\nconst UP = 0; // only for key/mouse\nconst DOWN = 1;\nconst DOWN_EDGE = 2; // only for pads\n\n// per-app overrideable options\nconst TOUCH_AS_MOUSE = true;\nlet map_analog_to_dpad = true;\n\nlet mouse_log = false;\n\nexport const click = mouseUpEdge; // eslint-disable-line @typescript-eslint/no-use-before-define\nexport const inputClick = mouseUpEdge; // eslint-disable-line @typescript-eslint/no-use-before-define\n\nconst { deprecate } = require('glov/common/util.js');\ndeprecate(exports, 'mouseDown', 'mouseDownAnywhere, mouseDownMidClick, mouseDownOverBounds');\n\nimport {\n  ANY,\n  POINTERLOCK,\n} from './input_constants';\n\nexport * from './input_constants';\n\nexport let KEYS = {\n  BACKSPACE: 8,\n  TAB: 9,\n  ENTER: 13,\n  RETURN: 13,\n  SHIFT: 16,\n  CTRL: 17,\n  ALT: 18,\n  ESC: 27,\n  ESCAPE: 27,\n  SPACE: 32,\n  PAGEUP: 33,\n  PAGEDOWN: 34,\n  END: 35,\n  HOME: 36,\n  LEFT: 37,\n  UP: 38,\n  RIGHT: 39,\n  DOWN: 40,\n  INS: 45,\n  DEL: 46,\n\n  0: 48,\n  1: 49,\n  2: 50,\n  3: 51,\n  4: 52,\n  5: 53,\n  6: 54,\n  7: 55,\n  8: 56,\n  9: 57,\n\n  A: 65,\n  B: 66,\n  C: 67,\n  D: 68,\n  E: 69,\n  F: 70,\n  G: 71,\n  H: 72,\n  I: 73,\n  J: 74,\n  K: 75,\n  L: 76,\n  M: 77,\n  N: 78,\n  O: 79,\n  P: 80,\n  Q: 81,\n  R: 82,\n  S: 83,\n  T: 84,\n  U: 85,\n  V: 86,\n  W: 87,\n  X: 88,\n  Y: 89,\n  Z: 90,\n\n  NUMPAD0: 96,\n  NUMPAD1: 97,\n  NUMPAD2: 98,\n  NUMPAD3: 99,\n  NUMPAD4: 100,\n  NUMPAD5: 101,\n  NUMPAD6: 102,\n  NUMPAD7: 103,\n  NUMPAD8: 104,\n  NUMPAD9: 105,\n  NUMPAD_MULTIPLY: 106,\n  NUMPAD_ADD: 107,\n  NUMPAD_SUBTRACT: 109,\n  NUMPAD_DECIMAL_POINT: 110,\n  NUMPAD_DIVIDE: 111,\n\n  F1: 112,\n  F2: 113,\n  F3: 114,\n  F4: 115,\n  F5: 116,\n  F6: 117,\n  F7: 118,\n  F8: 119,\n  F9: 120,\n  F10: 121,\n  F11: 122,\n  F12: 123,\n\n  EQUALS: 187,\n  COMMA: 188,\n  MINUS: 189,\n  PERIOD: 190,\n  SLASH: 191,\n  TILDE: 192,\n};\nif (typeof Proxy === 'function') {\n  // Catch referencing keys that are not in our map\n  KEYS = new Proxy(KEYS, {\n    get: function (target, prop) {\n      let ret = target[prop];\n      assert(ret);\n      return ret;\n    }\n  });\n}\nexport const PAD = {\n  A: 0,\n  SELECT: 0, // GLOV name\n  B: 1,\n  CANCEL: 1, // GLOV name\n  X: 2,\n  Y: 3,\n  LB: 4,\n  LEFT_BUMPER: 4,\n  RB: 5,\n  RIGHT_BUMPER: 5,\n  LT: 6,\n  LEFT_TRIGGER: 6,\n  RT: 7,\n  RIGHT_TRIGGER: 7,\n  BACK: 8,\n  START: 9,\n  LEFT_STICK: 10,\n  RIGHT_STICK: 11,\n  UP: 12,\n  DOWN: 13,\n  LEFT: 14,\n  RIGHT: 15,\n  ANALOG_UP: 20,\n  ANALOG_LEFT: 21,\n  ANALOG_DOWN: 22,\n  ANALOG_RIGHT: 23,\n  LSTICK_UP: 20,\n  LSTICK_LEFT: 21,\n  LSTICK_DOWN: 22,\n  LSTICK_RIGHT: 23,\n  RSTICK_UP: 24,\n  RSTICK_LEFT: 25,\n  RSTICK_DOWN: 26,\n  RSTICK_RIGHT: 27,\n};\n\nconst { is_firefox, is_mac_osx } = require('./browser.js');\nconst camera2d = require('./camera2d.js');\nconst { cmd_parse } = require('./cmds.js');\nconst engine = require('./engine.js');\nconst in_event = require('./in_event.js');\nconst local_storage = require('./local_storage.js');\nconst { abs, max, min, sqrt } = Math;\nconst pointer_lock = require('./pointer_lock.js');\nconst settings = require('./settings.js');\nconst { soundResume } = require('./sound.js');\nconst { spotMouseoverHook } = require('./spot.js');\nconst { empty } = require('glov/common/util.js');\nconst { vec2, v2add, v2copy, v2lengthSq, v2set, v2scale, v2sub } = require('glov/common/vmath.js');\n\nlet pad_to_touch;\n\nlet canvas;\nlet key_state_new = {};\nlet pad_states = []; // One map per gamepad to pad button states\nlet gamepad_data = []; // Other tracking data per gamepad\nlet mouse_pos = vec2(); // in DOM coordinates, not canvas or virtual\nlet last_mouse_pos = vec2();\nlet mouse_pos_is_touch = false;\nlet mouse_over_captured = false;\nlet mouse_down = [];\nlet wheel_events = [];\nlet movement_questionable_frames = 0;\nconst MOVEMENT_QUESTIONABLE_FRAMES = 2; // Need at least 2\n\nlet input_eaten_kb = false;\nlet input_eaten_mouse = false;\n\nlet touches = {}; // `m${button}` or touch_id -> TouchData\nlet no_active_touches = true;\n\nexport let touch_mode = local_storage.getJSON('touch_mode', false);\nexport let pad_mode = !touch_mode && local_storage.getJSON('pad_mode', false);\n\ncmd_parse.registerValue('mouse_log', {\n  type: cmd_parse.TYPE_INT,\n  range: [0, 1],\n  get: () => mouse_log,\n  set: (v) => (mouse_log = v),\n});\n\nexport function inputTouchMode() {\n  return touch_mode;\n}\n\nexport function inputEatenMouse() {\n  return input_eaten_mouse;\n}\n\nfunction eventTimestamp(event) {\n  if (event && event.timeStamp) {\n    // assert((event.timeStamp < 1e12) === (engine.hrtime < 1e12));\n    // Must both be high res times, or both not!\n    if ((event.timeStamp < 1e12) !== (engine.hrtime < 1e12)) {\n      return engine.hrtime;\n    }\n    return event.timeStamp;\n  }\n  return engine.hrtime;\n}\n\nfunction TouchData(pos, touch, button, event) {\n  this.delta = vec2();\n  this.total = 0;\n  this.cur_pos = pos.slice(0);\n  this.start_pos = pos.slice(0);\n  this.touch = touch;\n  this.button = button;\n  this.start_time = Date.now();\n  this.dispatched = false;\n  this.dispatched_drag = false;\n  this.dispatched_drag_over = false;\n  this.was_double_click = false;\n  this.up_edge = 0;\n  this.down_edge = 0;\n  this.state = DOWN;\n  this.down_time = 0;\n  this.origin_time = eventTimestamp(event);\n}\nTouchData.prototype.down = function (event, is_edge) {\n  if (is_edge) {\n    this.down_edge++;\n  }\n  this.state = DOWN;\n  this.origin_time = eventTimestamp(event);\n};\n\nconst MIN_EVENT_TIME_DELTA = 0.01; // fractions of a millisecond\nfunction timeDelta(event, origin_time) {\n  let et = eventTimestamp(event);\n  // timestamps on events are often back in time relative to the last tick time\n  return max(et - origin_time, MIN_EVENT_TIME_DELTA);\n}\n\nfunction KeyData() {\n  this.down_edge = 0;\n  // this.down_start = 0;\n  this.origin_time = 0;\n  this.down_time = 0;\n  this.up_edge = 0;\n  this.state = UP;\n}\nKeyData.prototype.keyUp = function (event) {\n  ++this.up_edge;\n  this.down_time += timeDelta(event, this.origin_time);\n  this.state = UP;\n};\n\nfunction setMouseToMid() {\n  v2set(mouse_pos, engine.width*0.5/camera2d.domToCanvasRatio(), engine.height*0.5/camera2d.domToCanvasRatio());\n}\n\nexport function pointerLocked() {\n  return pointer_lock.isLocked();\n}\nlet pointerlock_touch_id = `m${POINTERLOCK}`;\nlet pointerlock_frame = -1;\n// only works reliably when called from an event handler\nexport function pointerLockEnter(when) {\n  pointer_lock.enter(when);\n}\nfunction onPointerLockEnter() {\n  if (touch_mode) {\n    return;\n  }\n  pointerlock_frame = engine.frame_index;\n  let touch_data = touches[pointerlock_touch_id];\n  setMouseToMid();\n  if (touch_data) {\n    v2copy(touch_data.start_pos, mouse_pos);\n    touch_data.state = DOWN;\n    touch_data.origin_time = engine.hrtime;\n  } else {\n    touch_data = touches[pointerlock_touch_id] = new TouchData(mouse_pos, false, POINTERLOCK, null);\n  }\n  movement_questionable_frames = MOVEMENT_QUESTIONABLE_FRAMES;\n}\nexport function pointerLockJustEntered(num_frames) {\n  return engine.frame_index <= pointerlock_frame + (num_frames || 1);\n}\nexport function pointerLockExit() {\n  let touch_data = touches[pointerlock_touch_id];\n  if (touch_data) {\n    v2copy(touch_data.cur_pos, mouse_pos);\n    // no UP_EDGE for this\n    touch_data.state = UP;\n  }\n  pointer_lock.exit();\n  movement_questionable_frames = MOVEMENT_QUESTIONABLE_FRAMES;\n}\n\nlet last_event;\nconst skip = { isTrusted: 1, sourceCapabilities: 1, path: 1, currentTarget: 1, view: 1 };\nfunction eventlog(event) {\n  if (event === last_event) {\n    return;\n  }\n  last_event = event;\n  let pairs = [];\n  for (let k in event) {\n    let v = event[k];\n    if (!v || typeof v === 'function' || k.toUpperCase() === k || skip[k]) {\n      continue;\n    }\n    pairs.push(`${k}:${v.id || v}`);\n  }\n  console.log(`${engine.frame_index} ${event.type} ${pointerLocked()?'ptrlck':'unlckd'} ${pairs.join(',')}`);\n}\n\nfunction letWheelEventThrough(event) {\n  // *not* checking for `noglov`, as links have these, and we want to capture scroll events even if mouse is over links\n  return event.target && (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA' ||\n    event.target.tagName === 'LABEL');\n}\n\nfunction letEventThrough(event) {\n  return event.target && (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA' ||\n    event.target.tagName === 'LABEL' || String(event.target.className).includes('noglov'));\n}\n\nfunction ignored(event) {\n  // eventlog(event);\n  if (!letEventThrough(event)) {\n    event.preventDefault();\n    event.stopPropagation();\n  }\n}\n\nlet ctrl_checked = false;\nlet unload_protected = false;\nfunction beforeUnload(e) {\n  if (unload_protected && ctrl_checked) {\n    // Exit pointer lock if the browser didn't do that automatically\n    pointerLockExit();\n    // Cancel the event\n    e.preventDefault();\n    // Chrome requires returnValue to be set\n    e.returnValue = 'Are you sure you want to quit?';\n  } else {\n    engine.releaseCanvas();\n  }\n}\nfunction protectUnload(enable) {\n  unload_protected = enable;\n}\n\nlet last_input_time = 0;\nexport function inputLastTime() {\n  return last_input_time;\n}\nfunction onUserInput() {\n  soundResume();\n  last_input_time = Date.now();\n}\n\nfunction releaseAllKeysDown(evt) {\n  for (let code in key_state_new) {\n    let ks = key_state_new[code];\n    if (ks.state === DOWN) {\n      ks.keyUp(evt);\n    }\n  }\n}\n\nfunction onKeyUp(event) {\n  protectUnload(event.ctrlKey);\n  let code = event.keyCode;\n  if (!letEventThrough(event)) {\n    event.stopPropagation();\n    event.preventDefault();\n  }\n\n  if (code === KEYS.ESC && pointerLocked()) {\n    pointerLockExit();\n  }\n  // Letting through to our code regardless of no_stop, because we handle things like ESC in INPUT elements\n\n  let ks = key_state_new[code];\n  if (ks && ks.state === DOWN) {\n    if (is_mac_osx && event.key === 'Meta') {\n      // We don't get keyUp events for any keys released while CMD is held, so we must assume all are released\n      releaseAllKeysDown(event);\n    } else {\n      ks.keyUp(event);\n    }\n  }\n\n  in_event.handle('keyup', event);\n}\n\nfunction onKeyDown(event) {\n  protectUnload(event.ctrlKey);\n  let code = event.keyCode;\n  let no_stop = letEventThrough(event) ||\n    code >= KEYS.F5 && code <= KEYS.F12 || // Chrome debug hotkeys\n    code === KEYS.I && (event.altKey && event.metaKey || event.ctrlKey && event.shiftKey) || // Safari, alternate Chrome\n    code === KEYS.R && event.ctrlKey; // Chrome reload hotkey\n  if (!no_stop) {\n    event.stopPropagation();\n    event.preventDefault();\n  }\n  // console.log(`${event.code} ${event.keyCode}`);\n  onUserInput();\n\n  // Letting through to our code regardless of no_stop, because we handle things like ESC in INPUT elements\n  let ks = key_state_new[code];\n  if (!ks) {\n    ks = key_state_new[code] = new KeyData();\n  }\n  if (ks.state !== DOWN) { // not a repeat event\n    ++ks.down_edge;\n    ks.state = DOWN;\n    ks.origin_time = eventTimestamp(event);\n    // ks.down_start = ks.origin_time;\n\n    in_event.handle('keydown', event);\n  }\n}\n\nlet mouse_move_x = 0;\nexport function debugGetMouseMoveX() {\n  let ret = mouse_move_x;\n  mouse_move_x = 0;\n  return ret;\n}\n\nlet mouse_moved = false;\nlet mouse_button_had_edge = false;\nlet mouse_button_had_up_edge = false;\nlet temp_delta = vec2();\nlet last_abs_move = 0;\nlet last_abs_move_time = 0;\nlet last_move_x = 0;\nlet last_move_y = 0;\nfunction onMouseMove(event, no_stop) {\n  /// eventlog(event);\n  // Don't block mouse button 3, that's the Back button\n  if (!letEventThrough(event) && !no_stop && event.button !== 3) {\n    event.preventDefault();\n    event.stopPropagation();\n    if (touch_mode) {\n      local_storage.setJSON('touch_mode', false);\n      touch_mode = false;\n    }\n    if (pad_mode) {\n      local_storage.setJSON('pad_mode', false);\n      pad_mode = false;\n    }\n  }\n  mouse_moved = true;\n  // offsetX/layerX return position relative to text-entry boxes, not good!\n  // clientX/clientY do not handle weird scrolling that happens on iOS, but\n  //   should not affect mouse events (but maybe on Safari desktop?)\n  mouse_pos[0] = event.pageX;\n  mouse_pos[1] = event.pageY;\n  // if (event.offsetX !== undefined) {\n  //   mouse_pos[0] = event.offsetX;\n  //   mouse_pos[1] = event.offsetY;\n  // } else {\n  //   mouse_pos[0] = event.layerX;\n  //   mouse_pos[1] = event.layerY;\n  // }\n  mouse_pos_is_touch = false;\n\n  let movement_x = event.movementX || event.mozMovementX || event.webkitMovementX || 0;\n  let movement_y = event.movementY || event.mozMovementY || event.webkitMovementY || 0;\n\n  mouse_move_x += movement_x;\n\n  let any_movement = false;\n  if (pointerLocked()) {\n    setMouseToMid();\n    if (movement_x || movement_y) {\n      // Smooth out (ignore) large jumps in movement\n      // This is, I believe, just a bug with Chromium on Windows, as it repositions the hidden mouse cursor\n      let ts = event.timeStamp || Date.now();\n      let abs_x = abs(movement_x);\n      let abs_y = abs(movement_y);\n      let abs_move = abs_x + abs_y;\n      if (abs_move > 200 && (abs_move > 3 * last_abs_move || ts - last_abs_move_time > 1000)) {\n        console.log(`Ignoring mousemove with sudden large delta: ${movement_x},${movement_y}`);\n      } else if (is_firefox && movement_x === last_move_x && movement_y === last_move_y && abs_x < 2 && abs_y < 2) {\n        // Ignoring mousemove similar to previous and with very little delta, due to a Firefox bug\n      } else {\n        v2set(temp_delta, movement_x || 0, movement_y || 0);\n        any_movement = true;\n      }\n      last_abs_move = abs_move;\n      last_abs_move_time = ts;\n      last_move_x = movement_x;\n      last_move_y = movement_y;\n    }\n  } else {\n    v2sub(temp_delta, mouse_pos, last_mouse_pos);\n    if (temp_delta[0] || temp_delta[1]) {\n      any_movement = true;\n    }\n    v2copy(last_mouse_pos, mouse_pos);\n  }\n  if (any_movement && movement_questionable_frames && v2lengthSq(temp_delta) > 100*100) {\n    // giant movement right after entering or exiting pointer lock, ignore (Chrome bug)\n    // We get these unreasonable jumps in both movementXY and the other, presumably\n    // because pointerLocked() is slightly out of sync, though the large .movementX/Y\n    // is clearly erroneous.\n    any_movement = false;\n  }\n  if (any_movement) {\n    for (let button = POINTERLOCK; button < mouse_down.length; ++button) {\n      if (mouse_down[button] || button === POINTERLOCK && pointerLocked()) {\n        let touch_data = touches[`m${button}`];\n        if (touch_data) {\n          v2add(touch_data.delta, touch_data.delta, temp_delta);\n          touch_data.total += abs(temp_delta[0]) + abs(temp_delta[1]);\n          v2copy(touch_data.cur_pos, mouse_pos);\n        }\n      }\n    }\n  }\n}\n\nfunction onMouseDown(event) {\n  if (mouse_log) {\n    eventlog(event);\n  }\n  onMouseMove(event); // update mouse_pos\n  onUserInput();\n  let no_click = letEventThrough(event);\n\n  let button = event.button;\n  mouse_down[button] = true;\n  let touch_id = `m${button}`;\n  if (touches[touch_id]) {\n    v2copy(touches[touch_id].start_pos, mouse_pos);\n  } else {\n    touches[touch_id] = new TouchData(mouse_pos, false, button, event);\n  }\n  touches[touch_id].down(event, !no_click);\n  if (!no_click) {\n    in_event.handle('mousedown', event);\n  }\n  mouse_button_had_edge = true;\n  //This solves input bug when game is running as iframe. E.g. Facebook Instant\n  if (window.focus) {\n    window.focus();\n  }\n}\n\nlet last_up_edges = [{\n  timestamp: 0,\n  pos: vec2(),\n},{\n  timestamp: 0,\n  pos: vec2(),\n}];\nfunction registerMouseUpEdge(touch_data, timestamp) {\n  touch_data.up_edge++;\n  let t = last_up_edges[0];\n  last_up_edges[0] = last_up_edges[1];\n  last_up_edges[1] = t;\n  v2copy(t.pos, touch_data.cur_pos);\n  t.timestamp = timestamp;\n}\n\nfunction onMouseUp(event) {\n  if (mouse_log) {\n    eventlog(event);\n  }\n  onMouseMove(event); // update mouse_pos\n  let no_click = letEventThrough(event);\n  let button = event.button;\n  if (mouse_down[button]) {\n    let touch_id = `m${button}`;\n    let touch_data = touches[touch_id];\n    if (touch_data) {\n      v2copy(touch_data.cur_pos, mouse_pos);\n      if (!no_click) {\n        registerMouseUpEdge(touch_data, eventTimestamp(event));\n      }\n      touch_data.state = UP;\n      touch_data.down_time += timeDelta(event, touch_data.origin_time);\n    }\n    delete mouse_down[button];\n  }\n  mouse_button_had_edge = true;\n  mouse_button_had_up_edge = true;\n  if (!no_click) {\n    in_event.handle('mouseup', event);\n  }\n}\n\nfunction onWheel(event) {\n  let saved = mouse_moved; // don't trigger mouseMoved()\n  onMouseMove(event, true);\n  mouse_moved = saved;\n  let delta = -event.deltaY || event.wheelDelta || -event.detail;\n  wheel_events.push({\n    pos: [event.pageX, event.pageY],\n    delta: delta > 0 ? 1 : -1,\n    dispatched: false,\n  });\n\n  if (!letWheelEventThrough(event)) {\n    event.stopPropagation();\n    event.preventDefault();\n  }\n}\n\nlet touch_pos = vec2();\nlet released_touch_id = 0;\nfunction onTouchChange(event) {\n  // eventlog(event);\n  // Using .pageX/Y here because on iOS when a text entry is selected, it scrolls\n  // our canvas offscreen.  Should maybe have the canvas resize and use clientX\n  // instead, but this works well enough.\n  onUserInput();\n  if (!touch_mode) {\n    local_storage.set('touch_mode', true);\n    touch_mode = true;\n  }\n  if (pad_mode) {\n    local_storage.set('pad_mode', false);\n    pad_mode = false;\n  }\n  if (event.cancelable !== false) {\n    event.preventDefault();\n  }\n  let ct = event.touches;\n  let seen = {};\n\n  let new_count = ct.length;\n  let old_count = 0;\n  // Look for press and movement\n  for (let ii = 0; ii < ct.length; ++ii) {\n    let touch = ct[ii];\n    try {\n      if (!isFinite(touch.pageX) || !isFinite(touch.pageY)) {\n        // getting bad touch events sometimes (Moto phones?), simply ignore\n        --new_count;\n        continue;\n      }\n    } catch (e) {\n      // getting \"Permission denied to access property \"pageX\" rarely on Firefox, simply ignore\n      --new_count;\n      continue;\n    }\n\n    let last_touch = touches[touch.identifier];\n    v2set(touch_pos, touch.pageX, touch.pageY);\n    if (!last_touch) {\n      last_touch = touches[touch.identifier] = new TouchData(touch_pos, true, 0, event);\n      last_touch.down(event, true);\n      mouse_button_had_edge = true;\n      in_event.handle('mousedown', touch);\n    } else {\n      ++old_count;\n      v2sub(temp_delta, touch_pos, last_touch.cur_pos);\n      v2add(last_touch.delta, last_touch.delta, temp_delta);\n      last_touch.total += abs(temp_delta[0]) + abs(temp_delta[1]);\n      v2copy(last_touch.cur_pos, touch_pos);\n    }\n\n    seen[touch.identifier] = true;\n    if (TOUCH_AS_MOUSE && new_count === 1) {\n      // Single touch, treat as mouse movement\n      v2copy(mouse_pos, touch_pos);\n      mouse_pos_is_touch = true;\n    }\n  }\n  // Look for release, if releasing exactly one final touch\n  let released_touch;\n  let released_ids = [];\n  for (let id in touches) {\n    if (!seen[id]) {\n      let touch = touches[id];\n      if (touch.touch && touch.state === DOWN) {\n        ++old_count;\n        released_touch = touch;\n        released_ids.push(id);\n        in_event.handle('mouseup', { pageX: touch.cur_pos[0], pageY: touch.cur_pos[1] });\n        registerMouseUpEdge(touch, eventTimestamp(event));\n        mouse_button_had_edge = true;\n        mouse_button_had_up_edge = true;\n        touch.state = UP;\n        touch.down_time += timeDelta(event, touch.origin_time);\n        touch.release = true;\n      }\n    }\n  }\n  for (let ii = 0; ii < released_ids.length; ++ii) {\n    let id = released_ids[ii];\n    let touch = touches[id];\n    // get new id, not overlapping with touch.identifier values,\n    // so that if we get a new touch event before the next tick, we still see the release, etc\n    let new_id = `r${++released_touch_id}`;\n    delete touches[id];\n    touches[new_id] = touch;\n  }\n  if (TOUCH_AS_MOUSE) {\n    if (old_count === 1 && new_count === 0) {\n      delete mouse_down[0];\n      v2copy(mouse_pos, released_touch.cur_pos);\n      mouse_pos_is_touch = true;\n    } else if (new_count === 1) {\n      let touch = ct[0];\n      if (!old_count) {\n        mouse_down[0] = true;\n      }\n      v2set(mouse_pos, touch.pageX, touch.pageY);\n      mouse_pos_is_touch = true;\n    } else if (new_count > 1) {\n      // multiple touches, release mouse_down without emitting click\n      delete mouse_down[0];\n    }\n  }\n}\n\nfunction onBlurOrFocus(evt) {\n  protectUnload(false);\n  releaseAllKeysDown(evt);\n}\n\nlet ANALOG_MAP = {};\nfunction genAnalogMap() {\n  if (map_analog_to_dpad) {\n    ANALOG_MAP[PAD.LEFT] = [PAD.LSTICK_LEFT, PAD.RSTICK_LEFT];\n    ANALOG_MAP[PAD.RIGHT] = [PAD.LSTICK_RIGHT, PAD.RSTICK_RIGHT];\n    ANALOG_MAP[PAD.UP] = [PAD.LSTICK_UP, PAD.RSTICK_UP];\n    ANALOG_MAP[PAD.DOWN] = [PAD.LSTICK_DOWN, PAD.RSTICK_DOWN];\n  }\n}\n\nlet passive_param = false;\nexport function handleTouches(elem) {\n  elem.addEventListener('touchstart', onTouchChange, passive_param);\n  elem.addEventListener('touchmove', onTouchChange, passive_param);\n  elem.addEventListener('touchend', onTouchChange, passive_param);\n  elem.addEventListener('touchcancel', onTouchChange, passive_param);\n}\n\nexport function startup(_canvas, params) {\n  canvas = _canvas;\n  pointer_lock.startup(canvas, onPointerLockEnter);\n  if (params.map_analog_to_dpad !== undefined) {\n    map_analog_to_dpad = params.map_analog_to_dpad;\n  }\n  pad_to_touch = params.pad_to_touch;\n  genAnalogMap();\n\n  try {\n    let opts = Object.defineProperty({}, 'passive', {\n      get: function () {\n        passive_param = { passive: false };\n        return false;\n      }\n    });\n    window.addEventListener('test', null, opts);\n    window.removeEventListener('test', null, opts);\n  } catch (e) {\n    passive_param = false;\n  }\n\n  window.addEventListener('keydown', onKeyDown, false);\n  window.addEventListener('keyup', onKeyUp, false);\n\n  window.addEventListener('click', ignored, false);\n  //window.addEventListener('click', eventlog, false);\n  window.addEventListener('contextmenu', ignored, false);\n  window.addEventListener('mousemove', onMouseMove, false);\n  window.addEventListener('mousedown', onMouseDown, false);\n  window.addEventListener('mouseup', onMouseUp, false);\n  if (window.WheelEvent) {\n    window.addEventListener('wheel', onWheel, passive_param);\n  } else {\n    window.addEventListener('DOMMouseScroll', onWheel, false);\n    window.addEventListener('mousewheel', onWheel, false);\n  }\n\n  window.addEventListener('blur', onBlurOrFocus, false);\n  window.addEventListener('focus', onBlurOrFocus, false);\n\n  handleTouches(canvas);\n\n  // For iOS, this is needed in test_fullscreen, but not here, for some reason\n  //window.addEventListener('gesturestart', ignored, false);\n\n  window.addEventListener('beforeunload', beforeUnload, false);\n}\n\n\nconst DEADZONE = 0.26;\nconst DEADZONE_SQ = DEADZONE * DEADZONE;\nconst NUM_STICKS = 2;\nconst PAD_THRESHOLD = 0.35; // for turning analog motion into digital events\n\nfunction getGamepadData(idx) {\n  let gpd = gamepad_data[idx];\n  if (!gpd) {\n    gpd = gamepad_data[idx] = {\n      id: idx,\n      timestamp: 0,\n      sticks: new Array(NUM_STICKS),\n    };\n    for (let ii = 0; ii < NUM_STICKS; ++ii) {\n      gpd.sticks[ii] = vec2();\n    }\n    pad_states[idx] = {};\n  }\n  return gpd;\n}\n\nfunction updatePadState(gpd, ps, b, padcode) {\n  if (b && !ps[padcode]) {\n    ps[padcode] = DOWN_EDGE;\n    onUserInput();\n    if (touch_mode) {\n      local_storage.set('touch_mode', false);\n      touch_mode = false;\n    }\n    if (!pad_mode) {\n      local_storage.setJSON('pad_mode', true);\n      pad_mode = true;\n    }\n    if (padcode === pad_to_touch) {\n      let touch_id = `g${gpd.id}`;\n      if (touches[touch_id]) {\n        setMouseToMid();\n        v2copy(touches[touch_id].start_pos, mouse_pos);\n      } else {\n        touches[touch_id] = new TouchData(mouse_pos, false, 0, null);\n      }\n      touches[touch_id].down(null, true);\n    }\n  } else if (!b && ps[padcode]) {\n    ps[padcode] = UP_EDGE;\n    if (padcode === pad_to_touch) {\n      let touch_id = `g${gpd.id}`;\n      let touch_data = touches[touch_id];\n      if (touch_data) {\n        setMouseToMid();\n        v2copy(touch_data.cur_pos, mouse_pos);\n        registerMouseUpEdge(touch_data, engine.hrtime);\n        touch_data.state = UP;\n        touch_data.down_time += max(engine.hrtime - touch_data.origin_time, MIN_EVENT_TIME_DELTA);\n      }\n    }\n  }\n}\n\nfunction gamepadUpdate() {\n  let gamepads;\n  try {\n    gamepads = (navigator.gamepads ||\n      navigator.webkitGamepads ||\n      (navigator.getGamepads && navigator.getGamepads()) ||\n      (navigator.webkitGetGamepads && navigator.webkitGetGamepads()));\n  } catch (e) {\n    // Firefox blocks gamepad access sometimes, just ignore it we can't access it\n  }\n\n  if (gamepads) {\n    let numGamePads = gamepads.length;\n    for (let ii = 0; ii < numGamePads; ii++) {\n      let gamepad = gamepads[ii];\n      if (!gamepad) {\n        continue;\n      }\n      let gpd = getGamepadData(ii);\n      let ps = pad_states[ii];\n      // Update button states\n      if (gpd.timestamp < gamepad.timestamp) {\n        let buttons = gamepad.buttons;\n        gpd.timestamp = gamepad.timestamp;\n\n        let numButtons = buttons.length;\n        for (let n = 0; n < numButtons; n++) {\n          let value = buttons[n];\n          if (typeof value === 'object') {\n            value = value.value;\n          }\n          value = value > 0.5;\n          updatePadState(gpd, ps, value, n);\n        }\n      }\n\n      // Update axes states\n      let axes = gamepad.axes;\n      if (axes.length >= NUM_STICKS * 2) {\n        for (let n = 0; n < NUM_STICKS; ++n) {\n          let pair = gpd.sticks[n];\n          v2set(pair, axes[n*2], -axes[n*2 + 1]);\n          let magnitude = v2lengthSq(pair);\n          if (magnitude > DEADZONE_SQ) {\n            magnitude = sqrt(magnitude);\n\n            // Normalize lX and lY\n            v2scale(pair, pair, 1 / magnitude);\n\n            // Clip the magnitude at its max possible value\n            magnitude = min(magnitude, 1);\n\n            // Adjust magnitude relative to the end of the dead zone\n            magnitude = ((magnitude - DEADZONE) / (1 - DEADZONE));\n\n            v2scale(pair, pair, magnitude);\n          } else {\n            v2set(pair, 0, 0);\n          }\n\n          // Apply \"movement\" to drag events\n          if (n <= 1 && pad_to_touch !== undefined) {\n            let touch_data = touches[`g${gpd.id}`];\n            if (touch_data) {\n              v2scale(temp_delta, pair, engine.frame_dt);\n              v2add(touch_data.delta, touch_data.delta, temp_delta);\n              touch_data.total += abs(temp_delta[0]) + abs(temp_delta[1]);\n              setMouseToMid();\n              v2copy(touch_data.cur_pos, mouse_pos);\n            }\n          }\n        }\n\n        // Calculate virtual directional buttons\n        updatePadState(gpd, ps, gpd.sticks[0][0] < -PAD_THRESHOLD, PAD.LSTICK_LEFT);\n        updatePadState(gpd, ps, gpd.sticks[0][0] > PAD_THRESHOLD, PAD.LSTICK_RIGHT);\n        updatePadState(gpd, ps, gpd.sticks[0][1] < -PAD_THRESHOLD, PAD.LSTICK_DOWN);\n        updatePadState(gpd, ps, gpd.sticks[0][1] > PAD_THRESHOLD, PAD.LSTICK_UP);\n\n        updatePadState(gpd, ps, gpd.sticks[1][0] < -PAD_THRESHOLD, PAD.RSTICK_LEFT);\n        updatePadState(gpd, ps, gpd.sticks[1][0] > PAD_THRESHOLD, PAD.RSTICK_RIGHT);\n        updatePadState(gpd, ps, gpd.sticks[1][1] < -PAD_THRESHOLD, PAD.RSTICK_DOWN);\n        updatePadState(gpd, ps, gpd.sticks[1][1] > PAD_THRESHOLD, PAD.RSTICK_UP);\n      }\n    }\n  }\n}\n\nexport function fakeTouchEvent(is_down) {\n  const touch_id = 'faketouch';\n  let touch_data = touches[touch_id];\n  if (touch_data && !is_down) {\n    setMouseToMid();\n    v2copy(touch_data.cur_pos, mouse_pos);\n    registerMouseUpEdge(touch_data, engine.hrtime);\n    touch_data.state = UP;\n    touch_data.down_time += max(engine.hrtime - touch_data.origin_time, MIN_EVENT_TIME_DELTA);\n  } else if (!touch_data && is_down) {\n    setMouseToMid();\n    touches[touch_id] = new TouchData(mouse_pos, false, 0, null);\n  }\n}\n\nexport function tickInput() {\n  // browser frame has occurred since the call to endFrame(),\n  // we should now have `touches` and `key_state` populated with edge events\n  if (movement_questionable_frames) {\n    --movement_questionable_frames;\n  }\n\n  // update timing of key down states\n  let hrtime = engine.hrtime;\n  for (let code in key_state_new) {\n    let ks = key_state_new[code];\n    if (ks.state === DOWN) {\n      ks.down_time += max(hrtime - ks.origin_time, MIN_EVENT_TIME_DELTA);\n      // assert(hrtime >= ks.origin_time); - should be true, but often isn't\n      ks.origin_time = hrtime;\n    }\n  }\n\n  for (let touch_id in touches) {\n    let touch_data = touches[touch_id];\n    if (touch_data.state === DOWN) {\n      touch_data.down_time += max(hrtime - touch_data.origin_time, MIN_EVENT_TIME_DELTA);\n      // assert(hrtime >= touch_data.origin_time); - should be true, but often isn't\n      touch_data.origin_time = hrtime;\n    }\n  }\n\n  mouse_over_captured = false;\n  gamepadUpdate();\n  in_event.topOfFrame();\n  ctrl_checked = false;\n  if (touches[pointerlock_touch_id] && !pointerLocked()) {\n    pointerLockExit();\n  }\n  no_active_touches = empty(touches);\n}\n\nfunction endFrameTickMap(map) {\n  Object.keys(map).forEach((keycode) => {\n    switch (map[keycode]) {\n      case DOWN_EDGE:\n        map[keycode] = DOWN;\n        break;\n      case UP_EDGE:\n        delete map[keycode];\n        break;\n      default:\n    }\n  });\n}\nexport function endFrame(skip_mouse) {\n  for (let code in key_state_new) {\n    let ks = key_state_new[code];\n    if (ks.state === UP) {\n      key_state_new[code] = null;\n      delete key_state_new[code];\n    } else {\n      ks.up_edge = 0;\n      ks.down_edge = 0;\n      ks.down_time = 0;\n    }\n  }\n\n  pad_states.forEach(endFrameTickMap);\n  if (!skip_mouse) {\n    for (let touch_id in touches) {\n      let touch_data = touches[touch_id];\n      if (touch_data.state === UP) {\n        // Manually null out touches[touch_id] - some Chrome optimizer bug causes\n        // callers to later get this old value (instead of the newly added on with\n        // the same ID) unless we null it out (then they seem to get the new one).\n        touches[touch_id] = null;\n        delete touches[touch_id];\n      } else {\n        touch_data.delta[0] = touch_data.delta[1] = 0;\n        touch_data.dispatched = false;\n        touch_data.dispatched_drag = false;\n        touch_data.dispatched_drag_over = false;\n        if (touch_data.drag_payload_frame === engine.frame_index - 2) {\n          // Clear this after an entire frame of not being set (usually, things\n          // on the next frame will need to get the payload that was set later\n          // in the previous frame)\n          touch_data.drag_payload = null;\n        }\n        touch_data.up_edge = 0;\n        touch_data.down_edge = 0;\n        touch_data.down_time = 0;\n      }\n    }\n    wheel_events.length = 0;\n    input_eaten_mouse = false;\n    mouse_moved = false;\n    mouse_button_had_edge = false;\n    mouse_button_had_up_edge = false;\n  }\n  input_eaten_kb = false;\n}\n\nexport function tickInputInactive() {\n  in_event.topOfFrame();\n  ctrl_checked = false;\n  endFrame();\n}\n\nexport function eatAllInput(skip_mouse) {\n  // destroy touches, remove all down and up edges\n  endFrame(skip_mouse);\n  if (!skip_mouse) {\n    mouse_over_captured = true;\n    input_eaten_mouse = true;\n  }\n  input_eaten_kb = true;\n}\n\nexport function eatAllKeyboardInput() {\n  eatAllInput(true);\n}\n\n// returns position mapped to current camera view\nexport function mousePos(dst) {\n  dst = dst || vec2();\n  camera2d.domToVirtual(dst, mouse_pos);\n  return dst;\n}\n\nexport function mouseDomPos() {\n  return mouse_pos;\n}\n\nexport function mouseMoved() {\n  return mouse_moved;\n}\n\nexport function mouseButtonHadEdge() {\n  return mouse_button_had_edge;\n}\n\nexport function mouseButtonHadUpEdge() {\n  return mouse_button_had_up_edge;\n}\n\nconst full_screen_pos_param = {};\nfunction mousePosParamUnique(param) {\n  param = param || full_screen_pos_param;\n  let pos_param = param.mouse_pos_param;\n  if (!pos_param) {\n    pos_param = param.mouse_pos_param = {};\n  }\n  pos_param.x = param.x === undefined ? camera2d.x0Real() : param.x;\n  pos_param.y = param.y === undefined ? camera2d.y0Real() : param.y;\n  pos_param.w = param.w === undefined ? camera2d.wReal() : param.w;\n  pos_param.h = param.h === undefined ? camera2d.hReal() : param.h;\n  pos_param.button = param.button === undefined ? ANY : param.button;\n  return pos_param;\n}\n\nlet pos_param_temp = {};\nfunction mousePosParam(param) {\n  param = param || {};\n  pos_param_temp.x = param.x === undefined ? camera2d.x0Real() : param.x;\n  pos_param_temp.y = param.y === undefined ? camera2d.y0Real() : param.y;\n  pos_param_temp.w = param.w === undefined ? camera2d.wReal() : param.w;\n  pos_param_temp.h = param.h === undefined ? camera2d.hReal() : param.h;\n  pos_param_temp.button = param.button === undefined ? ANY : param.button;\n  return pos_param_temp;\n}\n\nlet check_pos = vec2();\nfunction checkPos(pos, param) {\n  if (!camera2d.domToVirtual(check_pos, pos)) {\n    return false;\n  }\n  return check_pos[0] >= param.x && (param.w === Infinity || check_pos[0] < param.x + param.w) &&\n    check_pos[1] >= param.y && (param.h === Infinity || check_pos[1] < param.y + param.h);\n}\n\nfunction wasDoubleClick(pos_param) {\n  if (engine.hrtime - last_up_edges[0].timestamp > settings.double_click_time) {\n    return false;\n  }\n  return checkPos(last_up_edges[0].pos, pos_param);\n}\n\nexport function mouseWheel(param) {\n  if (input_eaten_mouse || !wheel_events.length) {\n    return 0;\n  }\n  param = param || {};\n  let pos_param = mousePosParam(param);\n  let ret = 0;\n  for (let ii = 0; ii < wheel_events.length; ++ii) {\n    let data = wheel_events[ii];\n    if (data.dispatched) {\n      continue;\n    }\n    if (checkPos(data.pos, pos_param)) {\n      ret += data.delta;\n      data.dispatched = true;\n    }\n  }\n  return ret;\n}\n\nexport function mouseOverCaptured() {\n  mouse_over_captured = true;\n}\n\nexport function mouseOver(param) {\n  profilerStartFunc();\n  param = param || {};\n  let pos_param = mousePosParamUnique(param);\n  spotMouseoverHook(pos_param, param);\n  if (mouse_over_captured || pointerLocked() && !param.allow_pointerlock) {\n    profilerStopFunc();\n    return false;\n  }\n\n  // eat mouse up/down/drag events\n  if (!param.peek && !param.peek_touch) {\n    for (let id in touches) {\n      let touch = touches[id];\n      if (checkPos(touch.cur_pos, pos_param)) {\n        touch.down_edge = 0;\n        touch.up_edge = 0;\n        if (!param || !param.drag_target) {\n          touch.dispatched = true;\n        }\n      }\n    }\n  }\n\n  let ret = false;\n  if (checkPos(mouse_pos, pos_param)) {\n    if (!param.peek && !param.peek_over) {\n      mouse_over_captured = true;\n    }\n    ret = true;\n  }\n  profilerStopFunc();\n  return ret;\n}\n\nexport function mouseDownAnywhere(button) {\n  if (input_eaten_mouse) {\n    return false;\n  }\n  if (button === undefined) {\n    button = ANY;\n  }\n\n  for (let touch_id in touches) {\n    let touch_data = touches[touch_id];\n    if (touch_data.state !== DOWN ||\n      !(button === ANY || button === touch_data.button)\n    ) {\n      continue;\n    }\n    return true;\n  }\n  return false;\n}\n\nexport function mouseDownMidClick(param) {\n  if (input_eaten_mouse || no_active_touches) {\n    return false;\n  }\n  // Same logic as mouseUpEdge()\n  param = param || {};\n  let pos_param = mousePosParam(param);\n  let button = pos_param.button;\n  let max_click_dist = param.max_dist || 50; // TODO: relative to camera distance?\n\n  for (let touch_id in touches) {\n    let touch_data = touches[touch_id];\n    if (touch_data.state !== DOWN ||\n      !(button === ANY || button === touch_data.button) ||\n      touch_data.total > max_click_dist\n    ) {\n      continue;\n    }\n    if (checkPos(touch_data.cur_pos, pos_param)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nexport function mouseDownOverBounds(param) {\n  if (input_eaten_mouse || no_active_touches) {\n    return false;\n  }\n  param = param || {};\n  let pos_param = mousePosParam(param);\n  let button = pos_param.button;\n\n  for (let touch_id in touches) {\n    let touch_data = touches[touch_id];\n    if (touch_data.state !== DOWN ||\n      !(button === ANY || button === touch_data.button)\n    ) {\n      continue;\n    }\n    if (checkPos(touch_data.cur_pos, pos_param)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nexport function mousePosIsTouch() {\n  return mouse_pos_is_touch;\n}\n\nexport function numTouches() {\n  return Object.keys(touches).length;\n}\n\nexport function keyDown(keycode) {\n  if (keycode === KEYS.CTRL) {\n    ctrl_checked = true;\n  }\n  if (input_eaten_kb) {\n    return 0;\n  }\n  let ks = key_state_new[keycode];\n  if (!ks) {\n    return 0;\n  }\n  if (ks.state === DOWN) {\n    assert(ks.down_time); // Will fire if we call keyDown() before tickInput()\n  }\n  return ks.down_time;\n}\nexport function keyDownEdge(keycode, opts) {\n  if (input_eaten_kb) {\n    return 0;\n  }\n\n  if (opts && opts.in_event_cb) {\n    in_event.on('keydown', keycode, opts.in_event_cb);\n  }\n\n  let ks = key_state_new[keycode];\n  if (!ks) {\n    return 0;\n  }\n  let r = ks.down_edge;\n  ks.down_edge = 0;\n  return r;\n}\nexport function keyUpEdge(keycode, opts) {\n  if (input_eaten_kb) {\n    return 0;\n  }\n\n  if (opts && opts.in_event_cb) {\n    in_event.on('keyup', keycode, opts.in_event_cb);\n  }\n\n  let ks = key_state_new[keycode];\n  if (!ks) {\n    return 0;\n  }\n  let r = ks.up_edge;\n  ks.up_edge = 0;\n  return r;\n}\n\nexport function padGetAxes(out, stickindex, padindex) {\n  assert(stickindex >= 0 && stickindex < NUM_STICKS);\n  if (padindex === undefined) {\n    let sub = vec2();\n    v2set(out, 0, 0);\n    for (let ii = 0; ii < gamepad_data.length; ++ii) {\n      padGetAxes(sub, stickindex, ii);\n      v2add(out, out, sub);\n    }\n    return;\n  }\n  let sticks = getGamepadData(padindex).sticks;\n  v2copy(out, sticks[stickindex]);\n}\n\nfunction padButtonDownInternal(gpd, ps, padcode) {\n  if (ps[padcode]) {\n    return engine.frame_dt;\n  }\n  return 0;\n}\nfunction padButtonDownEdgeInternal(gpd, ps, padcode) {\n  if (ps[padcode] === DOWN_EDGE) {\n    ps[padcode] = DOWN;\n    return 1;\n  }\n  return 0;\n}\nfunction padButtonUpEdgeInternal(gpd, ps, padcode) {\n  if (ps[padcode] === UP_EDGE) {\n    delete ps[padcode];\n    return 1;\n  }\n  return 0;\n}\n\nfunction padButtonShared(fn, padcode, padindex) {\n  assert(padcode !== undefined);\n  let r = 0;\n  // Handle calling without a specific pad index\n  if (padindex === undefined) {\n    for (let ii = 0; ii < pad_states.length; ++ii) {\n      r += padButtonShared(fn, padcode, ii);\n    }\n    return r;\n  }\n\n  if (input_eaten_mouse) {\n    return 0;\n  }\n  let gpd = gamepad_data[padindex];\n  if (!gpd) {\n    return 0;\n  }\n  let ps = pad_states[padindex];\n\n  let am = ANALOG_MAP[padcode];\n  if (am) {\n    for (let ii = 0; ii < am.length; ++ii) {\n      r += fn(gpd, ps, am[ii]) || 0;\n    }\n  }\n  r += fn(gpd, ps, padcode);\n  return r;\n}\nexport function padButtonDown(padcode, padindex) {\n  return padButtonShared(padButtonDownInternal, padcode, padindex);\n}\nexport function padButtonDownEdge(padcode, padindex) {\n  return padButtonShared(padButtonDownEdgeInternal, padcode, padindex);\n}\nexport function padButtonUpEdge(padcode, padindex) {\n  return padButtonShared(padButtonUpEdgeInternal, padcode, padindex);\n}\n\nlet start_pos = vec2();\nlet cur_pos = vec2();\nlet delta = vec2();\n\nexport function mouseUpEdge(param) {\n  param = param || {};\n  if (input_eaten_mouse || !param.in_event_cb && no_active_touches) {\n    return null;\n  }\n  let pos_param = mousePosParam(param);\n  let button = pos_param.button;\n  let max_click_dist = param.max_dist || 50; // TODO: relative to camera distance?\n  let dragged_too_far = false;\n\n  for (let touch_id in touches) {\n    let touch_data = touches[touch_id];\n    if (touch_data.total > max_click_dist) {\n      // Do *not* register in_event_cb, would fire even when we would disregard this click\n      dragged_too_far = true;\n      continue;\n    }\n    if (!touch_data.up_edge) {\n      continue;\n    }\n    if (touch_data.long_press_dispatched) {\n      // If this touch has already triggered a long-press, do not additionally trigger a click\n      continue;\n    }\n    if (!(button === ANY || button === touch_data.button)) {\n      continue;\n    }\n    if (checkPos(touch_data.cur_pos, pos_param)) {\n      if (!param.peek) {\n        touch_data.up_edge = 0;\n      }\n      return {\n        button: touch_data.button,\n        pos: check_pos.slice(0),\n        start_time: touch_data.start_time,\n        was_double_click: wasDoubleClick(pos_param),\n      };\n    }\n  }\n\n  if (param.in_event_cb && !mouse_over_captured && !dragged_too_far) {\n    // TODO: Maybe need to also pass along earlier exclusions?  Working okay for now though.\n    if (!param.phys) {\n      param.phys = {};\n    }\n    param.phys.button = typeof param.in_event_button === 'number' ? param.in_event_button : button;\n    camera2d.virtualToDomPosParam(param.phys, pos_param);\n    in_event.on('mouseup', param.phys, param.in_event_cb);\n  }\n  return null;\n}\n\nexport function mouseDownEdge(param) {\n  param = param || {};\n  if (input_eaten_mouse || !param.in_event_cb && no_active_touches) {\n    return null;\n  }\n  let pos_param = mousePosParam(param);\n  let button = pos_param.button;\n\n  for (let touch_id in touches) {\n    let touch_data = touches[touch_id];\n    if (!touch_data.down_edge ||\n      !(button === ANY || button === touch_data.button)\n    ) {\n      continue;\n    }\n    if (checkPos(touch_data.cur_pos, pos_param)) {\n      if (!param.peek) {\n        touch_data.down_edge = 0;\n      }\n      return {\n        button: touch_data.button,\n        pos: check_pos.slice(0),\n        start_time: touch_data.start_time,\n      };\n    }\n  }\n\n  if (param.in_event_cb && !mouse_over_captured) {\n    // TODO: Maybe need to also pass along earlier exclusions?  Working okay for now though.\n    if (!param.phys) {\n      param.phys = {};\n    }\n    param.phys.button = button;\n    camera2d.virtualToDomPosParam(param.phys, pos_param);\n    in_event.on('mousedown', param.phys, param.in_event_cb);\n  }\n  return null;\n}\n\n// Completely consume any clicks or drags coming from a mouse down event in this\n// area - used to catch focus leaving an edit box without wanting to do what\n// a click would normally do.\nexport function mouseConsumeClicks(param) {\n  if (no_active_touches) {\n    return;\n  }\n  param = param || {};\n  let pos_param = mousePosParam(param);\n  let button = pos_param.button;\n  for (let touch_id in touches) {\n    let touch_data = touches[touch_id];\n    // Skipping those that already dispatched a drag this frame, must have been handled, do not consume it!\n    if (!(button === ANY || button === touch_data.button) || touch_data.dispatched_drag) {\n      continue;\n    }\n    if (checkPos(touch_data.start_pos, pos_param)) {\n      touch_data.down_edge = 0;\n      // Set start pos so that it will not pass checkPos\n      touch_data.start_pos[0] = touch_data.start_pos[1] = Infinity;\n      // Set .total so that mouseUpEdge will not detect it as a click\n      touch_data.total = Infinity;\n    }\n  }\n}\n\nexport function drag(param) {\n  if (input_eaten_mouse || no_active_touches) {\n    return null;\n  }\n  param = param || {};\n  let pos_param = mousePosParam(param);\n  let button = pos_param.button;\n  let min_dist = param.min_dist || 0;\n\n  for (let touch_id in touches) {\n    let touch_data = touches[touch_id];\n    if (!(button === ANY || button === touch_data.button) || touch_data.dispatched_drag) {\n      continue;\n    }\n    if (checkPos(touch_data.start_pos, pos_param)) {\n      camera2d.domDeltaToVirtual(delta, [touch_data.total/2, touch_data.total/2]);\n      let total = delta[0] + delta[1];\n      if (total < min_dist) {\n        continue;\n      }\n      if (!param.peek) {\n        touch_data.dispatched_drag = true;\n      }\n      let is_down_edge = touch_data.down_edge;\n      if (param.eat_clicks) {\n        touch_data.down_edge = touch_data.up_edge = 0;\n      }\n      if (param.payload) {\n        touch_data.drag_payload = param.payload;\n        touch_data.drag_payload_frame = engine.frame_index;\n      }\n      camera2d.domToVirtual(start_pos, touch_data.start_pos);\n      camera2d.domToVirtual(cur_pos, touch_data.cur_pos);\n      camera2d.domDeltaToVirtual(delta, touch_data.delta);\n      return {\n        cur_pos,\n        start_pos,\n        delta, // this frame's delta\n        total, // total (linear) distance dragged\n        button: touch_data.button,\n        touch: touch_data.touch,\n        start_time: touch_data.start_time,\n        is_down_edge,\n        down_time: touch_data.down_time,\n      };\n    }\n  }\n  return null;\n}\n\n// a lot like drag(), refactor to share more?\nexport function longPress(param) {\n  if (input_eaten_mouse || no_active_touches) {\n    return null;\n  }\n  param = param || {};\n  let pos_param = mousePosParam(param);\n  let button = pos_param.button;\n  let max_dist = param.long_press_max_dist || 50;\n  let min_time = param.min_time || 500;\n\n  for (let touch_id in touches) {\n    let touch_data = touches[touch_id];\n    if (!(button === ANY || button === touch_data.button) || touch_data.long_press_dispatched) {\n      continue;\n    }\n    if (checkPos(touch_data.start_pos, pos_param)) {\n      camera2d.domDeltaToVirtual(delta, [touch_data.total/2, touch_data.total/2]);\n      let total = delta[0] + delta[1];\n      if (total > max_dist) {\n        continue;\n      }\n      let time = Date.now() - touch_data.start_time;\n      if (time < min_time) {\n        continue;\n      }\n      if (!param.peek) {\n        // ? touch_data.dispatched = true;\n        touch_data.long_press_dispatched = true;\n      }\n      let is_down_edge = touch_data.down_edge;\n      if (param.eat_clicks) {\n        touch_data.down_edge = touch_data.up_edge = 0;\n      }\n      camera2d.domToVirtual(start_pos, touch_data.start_pos);\n      camera2d.domToVirtual(cur_pos, touch_data.cur_pos);\n      camera2d.domDeltaToVirtual(delta, touch_data.delta);\n      return {\n        long_press: true,\n        cur_pos,\n        start_pos,\n        delta, // this frame's delta\n        total, // total (linear) distance dragged\n        button: touch_data.button,\n        touch: touch_data.touch,\n        start_time: touch_data.start_time,\n        is_down_edge,\n        down_time: touch_data.down_time,\n      };\n    }\n  }\n  return null;\n}\n\nexport function dragDrop(param) {\n  if (input_eaten_mouse || no_active_touches) {\n    return null;\n  }\n  param = param || {};\n  let pos_param = mousePosParam(param);\n  let button = pos_param.button;\n\n  for (let touch_id in touches) {\n    let touch_data = touches[touch_id];\n    // Maybe touch_data.dispatched_drag_over instead/as well?\n    if (!(button === ANY || button === touch_data.button) || touch_data.dispatched || !touch_data.drag_payload) {\n      continue;\n    }\n    if (!touch_data.up_edge) {\n      continue;\n    }\n    if (checkPos(touch_data.cur_pos, pos_param)) {\n      if (!param.peek) {\n        // don't want the source (possibly called later this frame) to still think it's dragging\n        touch_data.dispatched_drag_over = true;\n        touch_data.dispatched_drag = true;\n        touch_data.dispatched = true;\n      }\n      return { drag_payload: touch_data.drag_payload };\n    }\n  }\n  return null;\n}\n\nexport function dragOver(param) {\n  if (input_eaten_mouse || no_active_touches) {\n    return null;\n  }\n  param = param || {};\n  let pos_param = mousePosParam(param);\n  let button = pos_param.button;\n\n  for (let touch_id in touches) {\n    let touch_data = touches[touch_id];\n    if (!(button === ANY || button === touch_data.button) ||\n      touch_data.dispatched_drag_over ||\n      !touch_data.drag_payload\n    ) {\n      continue;\n    }\n    if (touch_data.state !== DOWN) {\n      continue;\n    }\n    if (checkPos(touch_data.cur_pos, pos_param)) {\n      // Separate 'dispatched' for dragOver (target) and drag (source) - they both need one dispatch per frame\n      if (!param.peek) {\n        touch_data.dispatched_drag_over = true;\n      }\n      camera2d.domToVirtual(cur_pos, touch_data.cur_pos);\n      return {\n        cur_pos,\n        drag_payload: touch_data.drag_payload\n      };\n    }\n  }\n  return null;\n}\n","export type ButtonIndex = 0 | 1 | 2 | -1 | -2;\n\nexport const BUTTON_LEFT = <ButtonIndex>0;\nexport const BUTTON_MIDDLE = <ButtonIndex>1;\nexport const BUTTON_RIGHT = <ButtonIndex>2;\nexport const BUTTON_ANY = <ButtonIndex>-2;\nexport const BUTTON_POINTERLOCK = <ButtonIndex>-1;\nexport const ANY = BUTTON_ANY;\nexport const POINTERLOCK = BUTTON_POINTERLOCK;\n","// Portions Copyright 2020 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst engine = require('./engine.js');\nconst { style } = require('./font.js');\nconst camera2d = require('./camera2d.js');\nconst in_event = require('./in_event.js');\nconst input = require('./input.js');\nconst { abs } = Math;\nconst { uiGetDOMElem } = require('./ui.js');\nconst ui = require('./ui.js');\nconst settings = require('./settings.js');\nconst { SPOT_DEFAULT_BUTTON, spot, spotFocusSteal, spotKey } = require('./spot.js');\n\nlet style_link_default = style(null, {\n  color: 0x5040FFff,\n  outline_width: 1.0,\n  outline_color: 0x00000020,\n});\nlet style_link_hover_default = style(null, {\n  color: 0x0000FFff,\n  outline_width: 1.0,\n  outline_color: 0x00000020,\n});\n\nexport function linkGetDefaultStyle() {\n  return style_link_default;\n}\n\nlet state_cache = {};\nlet good_url = /https?:\\/\\//;\n\nfunction preventFocus(evt) {\n  evt.preventDefault();\n  if (evt.relatedTarget) {\n    // Revert focus back to previous blurring element (canvas or edit box)\n    evt.relatedTarget.focus();\n  } else {\n    // No previous focus target, blur instead\n    evt.currentTarget.blur();\n  }\n}\n\n// Create an invisible A elem in the DOM so we get all of the good browsery\n// behavior for a link area.\nexport function link(param) {\n  let { x, y, w, h, url, internal, allow_modal } = param;\n  if (!url.match(good_url)) {\n    url = `${document.location.protocol}//${url}`;\n  }\n  let key = spotKey(param);\n  let state = state_cache[key];\n  if (!state) {\n    state = state_cache[key] = { clicked: false };\n  }\n  state.frame = engine.frame_index;\n\n  let rect = { x, y, w, h };\n\n  // TODO: use spot_ret.allow_focus instead of all of this?\n  if (camera2d.clipTestRect(rect) && !(settings.shader_debug || settings.show_profiler)) {\n    // at least some is not clipped\n    let elem = uiGetDOMElem(state.elem, allow_modal);\n    if (elem !== state.elem) {\n      state.elem = elem;\n      if (elem) {\n        // new DOM element, initialize\n        elem.textContent = '';\n        let a_elem = document.createElement('a');\n        a_elem.setAttribute('draggable', false);\n        a_elem.textContent = ' ';\n        a_elem.className = 'glovui_link noglov';\n        a_elem.setAttribute('target', '_blank');\n        a_elem.setAttribute('href', url);\n        // Make the element unfocusable, so that pressing enter at some point\n        //   after clicking a link does not re-activate the link, additionally\n        //   pressing tab should not (in the browser) focus these links.\n        a_elem.setAttribute('tabindex', '-1');\n        a_elem.addEventListener('focus', preventFocus);\n        state.url = url;\n        if (internal) {\n          let down_x;\n          let down_y;\n          input.handleTouches(a_elem);\n          a_elem.onmousedown = function (ev) {\n            down_x = ev.pageX;\n            down_y = ev.pageY;\n          };\n          a_elem.onclick = function (ev) {\n            ev.preventDefault();\n            if (down_x) {\n              let dist = abs(ev.pageX - down_x) + abs(ev.pageY - down_y);\n              if (dist > 50) {\n                return;\n              }\n            }\n            state.clicked = true;\n            in_event.handle('mouseup', ev);\n          };\n        }\n        elem.appendChild(a_elem);\n        state.a_elem = a_elem;\n      }\n    }\n    if (elem) {\n      if (url !== state.url) {\n        state.a_elem.setAttribute('href', url);\n        state.url = url;\n      }\n\n      let pos = camera2d.htmlPos(rect.x, rect.y);\n      elem.style.left = `${pos[0]}%`;\n      elem.style.top = `${pos[1]}%`;\n      let size = camera2d.htmlSize(rect.w, rect.h);\n      elem.style.width = `${size[0]}%`;\n      elem.style.height = `${size[1]}%`;\n    }\n  }\n  let clicked = state.clicked;\n  state.clicked = false;\n  return clicked;\n}\n\nexport function linkText(param) {\n  let { style_link, style_link_hover, x, y, z, font_size, text, url, internal } = param;\n  text = text || url;\n  z = z || Z.UI;\n  font_size = font_size || ui.font_height;\n  // Also: any parameter to link(), e.g. url\n  let w = ui.font.getStringWidth(style_link || style_link_default, font_size, text);\n  let h = font_size;\n  param.w = w;\n  param.h = h;\n  param.def = SPOT_DEFAULT_BUTTON;\n  let spot_ret = spot(param);\n  let style_use = spot_ret.focused ?\n    (style_link_hover || style_link_hover_default) :\n    (style_link || style_link_default);\n  ui.font.drawSized(style_use, x, y, z, font_size, text);\n  let underline_w = 1;\n  ui.drawLine(x, y + h - underline_w, x + w, y + h - underline_w, z - 0.5, underline_w, 1, style_use.color_vec4);\n  let clicked = link(param);\n  if (clicked) {\n    spotFocusSteal(param);\n  }\n  if (spot_ret.ret && !internal) {\n    // activated (via keyboard or gamepad), and an external link, act as if we clicked it\n    let key = spotKey(param);\n    let state = state_cache[key];\n    assert(state);\n    assert(state.a_elem);\n    state.a_elem.click();\n  }\n  return clicked || spot_ret.ret;\n}\n\nexport function linkTick() {\n  for (let key in state_cache) {\n    let state = state_cache[key];\n    if (state.frame !== engine.frame_index - 1) {\n      delete state_cache[key];\n    }\n  }\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint-env browser */\n\nimport assert from 'assert';\n\nlet storage_prefix = 'demo';\n\nlet is_set = false;\nexport function setStoragePrefix(prefix: string): void {\n  if (is_set) {\n    return;\n  }\n  is_set = true;\n  storage_prefix = prefix;\n}\nexport function getStoragePrefix(): string {\n  assert(is_set);\n  return storage_prefix;\n}\n\nlet lsd = (function () {\n  try {\n    localStorage.setItem('test', 'test');\n    localStorage.removeItem('test');\n    return localStorage;\n  } catch (e) {\n    return null; // Use lsd_overlay only instead\n  }\n}());\n\n// Overlay to use if we lose access to localStorage at run-time (Firefox \"quota exceeded\" error)\nlet lsd_overlay: Partial<Record<string, string>> = {};\n\nexport function localStorageGet(key: string): string | undefined {\n  assert(is_set);\n  key = `${storage_prefix}_${key}`;\n  let ret: string | null | undefined = lsd_overlay[key] || (lsd && lsd.getItem(key));\n  if (ret === 'undefined') {\n    ret = undefined;\n  } else if (ret === null) {\n    ret = undefined;\n  }\n  return ret;\n}\n\nexport function localStorageSet(key: string, value: unknown): void {\n  assert(is_set);\n  key = `${storage_prefix}_${key}`;\n  if (value === undefined || value === null) {\n    if (lsd) {\n      lsd.removeItem(key);\n    }\n    delete lsd_overlay[key];\n  } else {\n    let str = String(value);\n    lsd_overlay[key] = str;\n    try {\n      if (lsd) {\n        lsd.setItem(key, str);\n      }\n    } catch (e) {\n      // ignored, it's in the overlay for the current session at least\n      // FireFox throws \"The quota has been exceeded\" errors here\n    }\n  }\n}\n\nexport function localStorageSetJSON(key: string, value: unknown): void {\n  localStorageSet(key, JSON.stringify(value));\n}\n\nexport function localStorageGetJSON<T = unknown>(key: string, def?: T): T | undefined {\n  let value = localStorageGet(key);\n  if (value === undefined) {\n    return def;\n  }\n  try {\n    return JSON.parse(value);\n  } catch (e) {\n    // ignore\n  }\n  return def;\n}\n\nexport function localStorageClearAll(key_prefix?: string): void {\n  let prefix = new RegExp(`^${storage_prefix}_${key_prefix || ''}`, 'u');\n  if (lsd) {\n    let keysToRemove = [];\n    for (let i = 0; i < lsd.length; i++) {\n      let key = lsd.key(i);\n      assert(key);\n      if (key.match(prefix)) {\n        keysToRemove.push(key);\n      }\n    }\n    for (let i = 0; i < keysToRemove.length; i++) {\n      lsd.removeItem(keysToRemove[i]);\n    }\n  }\n  for (let key in lsd_overlay) {\n    if (key.match(prefix)) {\n      delete lsd_overlay[key];\n    }\n  }\n}\n\nexport type LocalStorageData = Partial<Record<string, string>>;\n\nexport function localStorageExportAll(filter_prefix: string): LocalStorageData {\n  let obj: LocalStorageData = {};\n  let prefix = new RegExp(`^${storage_prefix}_(${filter_prefix || ''}.*)`, 'u');\n  if (lsd) {\n    for (let i = 0; i < lsd.length; i++) {\n      let key = lsd.key(i);\n      assert(key);\n      let m = key.match(prefix);\n      if (m) {\n        let v = lsd.getItem(key);\n        if (v && v !== 'undefined') {\n          obj[m[1]] = v;\n        }\n      }\n    }\n  }\n  for (let key in lsd_overlay) {\n    let m = key.match(prefix);\n    if (m) {\n      obj[m[1]] = lsd_overlay[key];\n    }\n  }\n  return obj;\n}\n\nexport function localStorageImportAll(serialized: LocalStorageData): void {\n  localStorageClearAll();\n  for (let key in serialized) {\n    localStorageSet(key, serialized[key]);\n  }\n}\n\n// Old API exports\nexports.get = localStorageGet;\nexports.set = localStorageSet;\nexports.setJSON = localStorageSetJSON;\nexports.getJSON = localStorageGetJSON;\nexports.clearAll = localStorageClearAll;\n","export interface LocalizableString {\n  toLocalString(): string;\n}\n\nexport function getStringFromLocalizable(s: string | LocalizableString): string {\n  return s && (s as LocalizableString).toLocalString ?\n    (s as LocalizableString).toLocalString() :\n    (s as string);\n}\n\nexport function getStringIfLocalizable<T>(s: T | LocalizableString): T | string {\n  return s && (s as LocalizableString).toLocalString ?\n    (s as LocalizableString).toLocalString() :\n    (s as T);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n// Some code from Turbulenz: Copyright (c) 2012-2013 Turbulenz Limited\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nexport function mat43() {\n  let r = new Float32Array(12);\n  r[0] = r[4] = r[8] = 1;\n  return r;\n}\n\nexport function m43identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 1;\n  out[5] = 0;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 1;\n  out[9] = 0;\n  out[10] = 0;\n  out[11] = 0;\n}\n\nexport function m43mul(out, a, b) {\n  let a0 = a[0];\n  let a1 = a[1];\n  let a2 = a[2];\n  let a3 = a[3];\n  let a4 = a[4];\n  let a5 = a[5];\n  let a6 = a[6];\n  let a7 = a[7];\n  let a8 = a[8];\n  let a9 = a[9];\n  let a10 = a[10];\n  let a11 = a[11];\n\n  let b0 = b[0];\n  let b1 = b[1];\n  let b2 = b[2];\n  let b3 = b[3];\n  let b4 = b[4];\n  let b5 = b[5];\n  let b6 = b[6];\n  let b7 = b[7];\n  let b8 = b[8];\n\n  out[0] = (b0 * a0 + b3 * a1 + b6 * a2);\n  out[1] = (b1 * a0 + b4 * a1 + b7 * a2);\n  out[2] = (b2 * a0 + b5 * a1 + b8 * a2);\n  out[3] = (b0 * a3 + b3 * a4 + b6 * a5);\n  out[4] = (b1 * a3 + b4 * a4 + b7 * a5);\n  out[5] = (b2 * a3 + b5 * a4 + b8 * a5);\n  out[6] = (b0 * a6 + b3 * a7 + b6 * a8);\n  out[7] = (b1 * a6 + b4 * a7 + b7 * a8);\n  out[8] = (b2 * a6 + b5 * a7 + b8 * a8);\n  out[9] = (b0 * a9 + b3 * a10 + b6 * a11 + b[9]);\n  out[10] = (b1 * a9 + b4 * a10 + b7 * a11 + b[10]);\n  out[11] = (b2 * a9 + b5 * a10 + b8 * a11 + b[11]);\n\n  return out;\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/*\n  Convert models to GLB with:\n  node_modules\\.bin\\gltf-pipeline.cmd -t -i src/client/models/box.gltf -o src/client/models/box.glb\n  // The -t tells it not to embed the textures, but just leave the URIs\n */\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst geom = require('./geom.js');\nconst glb_parser = require('./glb/parser.js');\nconst { ATTRIBUTE_TYPE_TO_COMPONENTS } = require('./glb/gltf-type-utils.js');\nconst renderer = require('./engine.js');\nconst { fetch } = require('./fetch.js');\nconst shaders = require('./shaders.js');\nconst textures = require('./textures.js');\nconst { vec4 } = require('glov/common/vmath.js');\nconst { webFSGetFile } = require('./webfs.js');\n\nexport let load_count = 0;\n\nexport let models = {};\n\nexport let default_vshader;\nexport let default_fshader;\n\nfunction initShaders() {\n  default_vshader = shaders.create('shaders/default.vp');\n  default_fshader = shaders.create('shaders/default.fp');\n  shaders.prelink(default_vshader, default_fshader);\n}\n\nfunction Model(url) {\n  this.url = url;\n  let idx = url.lastIndexOf('/');\n  if (idx !== -1) {\n    this.base_url = url.slice(0, idx + 1);\n  } else {\n    this.base_url = '';\n  }\n}\n\nModel.prototype.load = function () {\n  ++load_count;\n  fetch({\n    url: this.url,\n    response_type: 'arraybuffer',\n  }, (err, array_buffer) => {\n    --load_count;\n    if (err) {\n      window.onerror('Model loading error', 'models.js', 0, 0, err);\n    } else {\n      try {\n        this.parse(array_buffer);\n      } catch (e) {\n        window.onerror('Model loading error', 'models.js', 0, 0, e);\n      }\n    }\n  });\n};\n\nconst skip_attr = {\n  'TANGENT': true,\n};\n\nModel.prototype.parse = function (glb_data) {\n  let glb = glb_parser.parse(glb_data);\n  if (!glb) {\n    return;\n  }\n  // Make Geoms for each primitives within each mesh\n  let glb_json = glb.getJSON();\n  let objs = [];\n  for (let ii = 0; ii < glb_json.meshes.length; ++ii) {\n    let mesh = glb_json.meshes[ii];\n    for (let jj = 0; jj < mesh.primitives.length; ++jj) {\n      let primitives = mesh.primitives[jj];\n      let material = glb_json.materials[primitives.material];\n      let texture = null;\n      if (material) {\n        // Just grabbing the base color texture, nothing else\n        let bct = (material.pbrMetallicRoughness || {}).baseColorTexture || {};\n        let texture_def = glb_json.textures && glb_json.textures[bct.index] || {};\n        let sampler_def = glb_json.samplers && glb_json.samplers[texture_def.sampler] || {};\n        let image = glb_json.images && glb_json.images[texture_def.source] || {};\n        if (image.uri) {\n          let params = {\n            url: `${this.base_url}${image.uri}`,\n            filter_mag: sampler_def.magFilter,\n            filter_min: sampler_def.minFilter,\n            wrap_s: sampler_def.wrapS,\n            wrap_t: sampler_def.wrapT,\n          };\n          texture = textures.load(params);\n        }\n      }\n      let format = [];\n      let buffers = [];\n      let bidx = [];\n      let total_size = 0;\n      let vert_count = 0;\n      for (let attr in primitives.attributes) {\n        if (skip_attr[attr]) {\n          continue;\n        }\n        assert(shaders.semantic[attr] !== undefined);\n        let accessor = glb_json.accessors[primitives.attributes[attr]];\n        assert.equal(accessor.componentType, 5126); // F32\n        let geom_format = gl.FLOAT;\n        let geom_count = ATTRIBUTE_TYPE_TO_COMPONENTS[accessor.type];\n        assert(geom_count);\n        let my_vert_count = accessor.count/* / geom_count*/;\n        if (!vert_count) {\n          vert_count = my_vert_count;\n        } else {\n          assert.equal(vert_count, my_vert_count);\n        }\n        format.push([shaders.semantic[attr], geom_format, geom_count]);\n        let buffer = glb.getBuffer(accessor);\n        buffers.push(buffer);\n        bidx.push(0);\n        total_size += buffer.length;\n      }\n      // Interleave\n      let verts = new Float32Array(total_size);\n      let idx = 0;\n      for (let vert = 0; vert < vert_count; ++vert) {\n        for (let attr = 0; attr < format.length; ++attr) {\n          for (let kk = 0; kk < format[attr][2]; ++kk) {\n            verts[idx++] = buffers[attr][bidx[attr]++];\n          }\n        }\n      }\n      // Get indices\n      let accessor = glb_json.accessors[primitives.indices];\n      assert(accessor); // must be an indexed primitive set\n      assert.equal(accessor.type, 'SCALAR');\n      let idxs = glb.getBuffer(accessor);\n      if (accessor.componentType === 5125) { // Uint32\n        assert(vert_count < 65535); // Fits in 16-bits, doesn't use index 65535\n        // Just convert to 16-bit\n        idxs = new Uint16Array(idxs);\n      } else {\n        assert.equal(accessor.componentType, 5123); // Uint16\n      }\n      objs.push({\n        geom: geom.create(format, verts, idxs, primitives.mode),\n        texture,\n      });\n    }\n  }\n  // TODO: Something with nodes to tie together and position the meshes\n  this.data = {\n    objs,\n    // glb, - Don't keep this, release it and any unreferenced data/buffers\n  };\n};\n\nModel.prototype.draw = function (mat) {\n  renderer.updateMatrices(mat); // before setting shader\n  shaders.bind(default_vshader, default_fshader, {\n    color: vec4(1, 1, 1, 1),\n  });\n  let objs = this.data.objs;\n  for (let ii = 0; ii < objs.length; ++ii) {\n    let obj = objs[ii];\n    if (obj.texture) {\n      textures.bind(0, obj.texture);\n    }\n    obj.geom.draw();\n  }\n};\n\n// Just draw the geometry, without any other binding\nModel.prototype.drawGeom = function () {\n  let objs = this.data.objs;\n  for (let ii = 0; ii < objs.length; ++ii) {\n    let obj = objs[ii];\n    obj.geom.draw();\n  }\n};\n\nexport function load(url) {\n  if (models[url]) {\n    return models[url];\n  }\n  let model = models[url] = new Model(url);\n  model.data = models.box.data; // stub until loaded\n  model.load();\n  return model;\n}\n\nexport function startup() {\n  initShaders();\n  let model_box = models.box = new Model('box');\n  model_box.parse(webFSGetFile('models/box_textured_embed.glb').buffer);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// eslint-disable-next-line @typescript-eslint/no-use-before-define\nexports.netBuildString = buildString;\n// eslint-disable-next-line @typescript-eslint/no-use-before-define\nexports.netInit = init;\n\n/* eslint-disable import/order */\nconst { filewatchStartup } = require('./filewatch.js');\nconst { packetEnableDebug } = require('glov/common/packet.js');\nconst subscription_manager = require('./subscription_manager.js');\nconst wsclient = require('./wsclient.js');\nconst wscommon = require('glov/common/wscommon.js');\nconst WSClient = wsclient.WSClient;\n\nlet client;\nlet subs;\n\nexport function init(params) {\n  params = params || {};\n  if (params.ver) {\n    wsclient.CURRENT_VERSION = params.ver;\n  }\n  if (String(document.location).match(/^https?:\\/\\/localhost/)) {\n    if (!params.no_packet_debug) {\n      console.log('PacketDebug: ON');\n      packetEnableDebug(true);\n    }\n    if (!params.no_net_delay) {\n      wscommon.netDelaySet();\n    }\n  }\n  client = new WSClient(params.path);\n  subs = subscription_manager.create(client, params.cmd_parse);\n  subs.auto_create_user = Boolean(params.auto_create_user);\n  subs.no_auto_login = Boolean(params.no_auto_login);\n  subs.allow_anon = Boolean(params.allow_anon);\n  window.subs = subs; // for debugging\n  exports.subs = subs;\n  exports.client = client;\n  filewatchStartup(client);\n\n  if (params.engine) {\n    params.engine.addTickFunc((dt) => {\n      client.checkDisconnect();\n      subs.tick(dt);\n    });\n  }\n}\n\nconst build_timestamp_string = new Date(Number(BUILD_TIMESTAMP))\n  .toISOString()\n  .replace('T', ' ')\n  .slice(5, -8);\nexport function buildString() {\n  return wsclient.CURRENT_VERSION ? `${wsclient.CURRENT_VERSION} (${build_timestamp_string})` : build_timestamp_string;\n}\n\nexport function netDisconnectedRaw() {\n  return !client || !client.connected || client.disconnected ||\n    !client.socket || client.socket.readyState !== 1;\n}\n\nexport function netDisconnected() {\n  return netDisconnectedRaw() || subs.logging_in;\n}\n\nexport function netForceDisconnect() {\n  if (subs) {\n    subs.was_logged_in = false;\n  }\n  client?.socket?.close?.();\n}\n\nexport function netClient() {\n  return client;\n}\n\nexport function netClientId() {\n  return client.id;\n}\n\nexport function netUserId() {\n  return subs.getUserId();\n}\n\nexport function netSubs() {\n  return subs;\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n//////////////////////////////////////////////////////////////////////////\n// Particle System Spec\n\n/*\n// Definitions\n// value = number or\n// value = [base, add_max] -> generates a number in the range [base, base + add_max)\nlet def_fire = {\n  particles: {\n    fire: {\n      blend: 'additive',\n      texture: 'fire.png',\n      color: [1,1,1,1], // multiplied by animation track, default 1,1,1,1, can be omitted\n      color_track: [ // just values, NOT random range\n        { t: 0.0, v: [1,0.4,0.4,1] },\n        { t: 0.7, v: [1,0,0,1] },\n        { t: 0.9, v: [0.2,0,0,1] },\n        { t: 1.0, v: [0,0,0,1] },\n      ],\n      size: [[32,16], [32,16]], // multiplied by animation track\n      size_track: [ // just values, NOT random range\n        { t: 0.0, v: [1,1] },\n        { t: 0.4, v: [0.5,0.5] },\n        { t: 0.7, v: [1,1] },\n        { t: 1.0, v: [1.5,1.5] },\n      ],\n      accel: [0,0],\n      rot: [0,360], // degrees\n      rot_vel: [10,2], // degrees per second\n      lifespan: [450,0], // milliseconds\n      kill_time_accel: 5,\n    },\n  },\n  emitters: {\n    fire: {\n      particle: 'fire',\n      // Random ranges affect each emitted particle:\n      pos: [[0,28], [0,28]],\n      vel: [0,0],\n      emit_rate: [60,20], // emissions per second\n      // Random ranges only calculated upon instantiation:\n      emit_time: [0,Infinity],\n      emit_initial: 10,\n    },\n  },\n  system_lifespan: Infinity, // must be manually killed\n};\n\n// Usage\nlet system = glov_engine.glov_particles.createSystem(def_fire, [50, 50, Z.PARTICLES]);\nsystem.updatePos(75, 75);\nsystem.killSoft(); // stops emitting and speeds up particles by kill_time_accel\nsystem.killHard(); // immediately stops drawing\n\n*/\n\n//////////////////////////////////////////////////////////////////////////\n// Implementation\n\nconst assert = require('assert');\nconst {\n  vec2, v2copy, v2lerp, v2mul,\n  vec3, vec4, v3add, v4copy, v4lerp, v4mul,\n} = require('glov/common/vmath.js');\nconst sprites = require('./sprites.js');\nconst textures = require('./textures.js');\n\nconst blend_map = {\n  alpha: sprites.BLEND_ALPHA,\n  additive: sprites.BLEND_ADDITIVE,\n};\n\nexport function preloadParticleData(particle_data) {\n  // Preload all referenced particle textures\n  for (let key in particle_data.defs) {\n    let def = particle_data.defs[key];\n    for (let part_name in def.particles) {\n      let part_def = def.particles[part_name];\n      textures.load({ url: `img/${part_def.texture}.png` });\n    }\n  }\n}\n\n// Expect all values to be a pair of [base, add_max]\nfunction normalizeValue(v) {\n  if (v instanceof Float32Array && v.length >= 2) {\n    return v;\n  } else if (typeof v === 'number') {\n    return vec2(v, 0);\n  } else if (Array.isArray(v) || v instanceof Float32Array) {\n    // already an array, convert to Vec2\n    return vec2(v[0] || 0, v[1] || 0);\n  } else {\n    return assert(false);\n  }\n}\n\nfunction normalizeValueVec(vec, length) {\n  assert(length);\n  assert(Array.isArray(vec) || vec instanceof Float32Array);\n  let ret = new Array(length);\n  for (let ii = 0; ii < length; ++ii) {\n    ret[ii] = normalizeValue(vec[ii]);\n  }\n  return ret;\n}\n\nfunction normalizeParticle(def, particle_manager) {\n  if (!def.normalized) {\n    let norm = def.normalized = {\n      blend: blend_map[def.blend] || sprites.BLEND_ALPHA,\n      texture: textures.load({ url: def.texture ? `img/${def.texture}.png` : 'img/glov/util_circle.png' }),\n      color: normalizeValueVec(def.color || [1,1,1,1], 4),\n      color_track: null,\n      size: normalizeValueVec(def.size || [1,1], 2),\n      size_track: null,\n      accel: normalizeValueVec(def.accel || [0,0,0], 3),\n      rot: normalizeValue(def.rot || 0),\n      rot_vel: normalizeValue(def.rot || 0),\n      lifespan: normalizeValue(def.lifespan || 1000),\n      kill_time_accel: normalizeValue(def.kill_time_accel || 1),\n    };\n    assert(norm.kill_time_accel[0] >= 1); // cannot slow down on kill!\n    if (def.color_track && def.color_track.length) {\n      assert(def.color_track.length > 1);\n      norm.color_track = [];\n      for (let ii = 0; ii < def.color_track.length; ++ii) {\n        let e = def.color_track[ii];\n        assert(typeof e.t === 'number');\n        let arr = new Float32Array(5);\n        arr[0] = e.v[0];\n        arr[1] = e.v[1];\n        arr[2] = e.v[2];\n        arr[3] = e.v[3];\n        arr[4] = e.t;\n        norm.color_track.push(arr);\n      }\n    }\n    if (def.size_track && def.size_track.length) {\n      assert(def.size_track.length > 1);\n      norm.size_track = [];\n      for (let ii = 0; ii < def.size_track.length; ++ii) {\n        let e = def.size_track[ii];\n        assert(typeof e.t === 'number');\n        let arr = new Float32Array(3);\n        arr[0] = e.v[0];\n        arr[1] = e.v[1];\n        arr[2] = e.t;\n        norm.size_track.push(arr);\n      }\n    }\n  }\n  return def.normalized;\n}\n\nfunction findParticle(particles, name) {\n  assert(particles[name] !== undefined);\n  return particles[name];\n}\n\nfunction normalizeEmitter(def, part_map) {\n  if (!def.normalized) {\n    def.normalized = {\n      part_idx: findParticle(part_map, def.particle),\n      pos: normalizeValueVec(def.pos || [0,0,0], 3),\n      vel: normalizeValueVec(def.vel || [0,0,0], 3),\n      emit_rate: normalizeValue(def.emit_rate || 10),\n      emit_time: normalizeValueVec(def.emit_time || [0,Infinity], 2),\n      emit_initial: normalizeValue(def.emit_initial || 1),\n    };\n    // convert particles per second to ms per emission\n    let min = def.normalized.emit_rate[0];\n    let max = def.normalized.emit_rate[0] + def.normalized.emit_rate[1];\n    def.normalized.emit_rate[0] = 1000 / max;\n    def.normalized.emit_rate[1] = 1000 / min;\n    assert(def.normalized.emit_rate[0] > 1); // Not more than 1000 per second, that's ridic'.\n  }\n  return def.normalized;\n}\n\nfunction normalizeDef(def, particle_manager) {\n  if (!def.normalized) {\n    let norm = def.normalized = {\n      system_lifespan: normalizeValue(def.system_lifespan || Infinity),\n      particles: [],\n      emitters: [],\n    };\n    let part_map = {};\n    for (let key in def.particles) {\n      part_map[key] = norm.particles.length;\n      norm.particles.push(normalizeParticle(def.particles[key], particle_manager));\n    }\n    for (let key in def.emitters) {\n      norm.emitters.push(normalizeEmitter(def.emitters[key], part_map));\n    }\n  }\n  return def.normalized;\n}\n\nfunction instValue(v) {\n  return v[0] + Math.random() * v[1];\n}\nfunction instValueVec(v) {\n  let ret = new Float32Array(v.length);\n  for (let ii = 0; ii < v.length; ++ii) {\n    ret[ii] = instValue(v[ii]);\n  }\n  return ret;\n}\n\nlet temp_color = vec4();\nlet temp_color2 = vec4();\nlet temp_size = vec2();\nlet temp_size2 = vec2();\n// let temp_pos = v3allocZero();\n\nclass ParticleSystem {\n  constructor(parent, def_in, pos) {\n    assert(pos.length === 3);\n    this.parent = parent;\n    this.def = normalizeDef(def_in, parent);\n    this.system_lifespan = instValue(this.def.system_lifespan);\n    assert(this.system_lifespan > 0);\n    this.age = 0;\n    this.kill_hard = false;\n    this.kill_soft = false;\n    this.pos = vec3(pos[0], pos[1], pos[2]);\n    this.part_sets = [];\n    for (let ii = 0; ii < this.def.particles.length; ++ii) {\n      let def = this.def.particles[ii];\n      let part_set = {\n        def,\n        parts: [],\n      };\n      this.part_sets.push(part_set);\n    }\n    this.emitters = [];\n    // Instantiate emitters\n    for (let ii = 0; ii < this.def.emitters.length; ++ii) {\n      let def = this.def.emitters[ii];\n      let emitter = {\n        def,\n        emit_time: instValueVec(def.emit_time),\n        countdown: 0,\n        started: false,\n        stopped: false,\n      };\n      this.emitters.push(emitter);\n    }\n    // Do *not* do this here, causes them to be drawn twice on the first frame,\n    //   they'll be ticked as usual.\n    // // do initial tick for things that have an emit_time[0] of 0 and have an emit_initial\n    // this.tick(0);\n  }\n\n  tickParticle(part, dt) { // eslint-disable-line class-methods-use-this\n    let def = part.def;\n    part.age += dt;\n    let age_norm = part.age / part.lifespan;\n    if (age_norm >= 1) {\n      return true;\n    }\n\n    // Pos, vel - incrementally computed\n    let dts = dt / 1000;\n    part.pos[0] += part.vel[0] * dts;\n    part.pos[1] += part.vel[1] * dts;\n    part.pos[2] += part.vel[2] * dts;\n    part.vel[0] += part.accel[0] * dts;\n    part.vel[1] += part.accel[1] * dts;\n    part.vel[2] += part.accel[2] * dts;\n\n    // Color, size, rot - explicitly computed\n    v4copy(temp_color, part.color, temp_color);\n    if (def.color_track) {\n      if (age_norm < def.color_track[0][4]) {\n        v4mul(temp_color, temp_color, def.color_track[0]);\n      } else if (age_norm >= def.color_track[def.color_track.length - 1][4]) {\n        v4mul(temp_color, temp_color, def.color_track[def.color_track.length - 1]);\n      } else {\n        for (let ii = 0; ii < def.color_track.length - 1; ++ii) {\n          if (age_norm >= def.color_track[ii][4] && age_norm < def.color_track[ii + 1][4]) {\n            let weight = (age_norm - def.color_track[ii][4]) / (def.color_track[ii + 1][4] - def.color_track[ii][4]);\n            v4lerp(temp_color2, weight, def.color_track[ii], def.color_track[ii + 1]);\n            v4mul(temp_color, temp_color, temp_color2);\n            break;\n          }\n        }\n      }\n    }\n\n    v2copy(temp_size, part.size);\n    if (def.size_track) {\n      if (age_norm < def.size_track[0][2]) {\n        v2mul(temp_size, temp_size, def.size_track[0]);\n      } else if (age_norm >= def.size_track[def.size_track.length - 1][2]) {\n        v2mul(temp_size, temp_size, def.size_track[def.size_track.length - 1]);\n      } else {\n        for (let ii = 0; ii < def.size_track.length - 1; ++ii) {\n          if (age_norm >= def.size_track[ii][2] && age_norm < def.size_track[ii + 1][2]) {\n            let weight = (age_norm - def.size_track[ii][2]) / (def.size_track[ii + 1][2] - def.size_track[ii][2]);\n            v2lerp(temp_size2, weight, def.size_track[ii], def.size_track[ii + 1]);\n            v2mul(temp_size, temp_size, temp_size2);\n            break;\n          }\n        }\n      }\n    }\n\n    // TODO: let rot = part.rot + part.age * part.rot_vel;\n\n    // TODO: draw using:\n    //   rot\n    let w = temp_size[0];\n    let h = temp_size[1];\n    let x = part.pos[0] - w/2;\n    let y = part.pos[1] - h/2;\n    let z = part.pos[2];\n    sprites.queueraw4color([def.texture],\n      x, y, temp_color, 0, 0,\n      x, y + h, temp_color, 0, 1,\n      x + w, y + h, temp_color, 1, 1,\n      x + w, y, temp_color, 1, 0,\n      z,\n      null, null, def.blend);\n\n    return false;\n  }\n\n  tickPartSet(dt_orig, part_set) {\n    //let def = part_set.def;\n    let parts = part_set.parts;\n    for (let ii = parts.length - 1; ii >= 0; --ii) {\n      let part = parts[ii];\n      let dt = this.kill_soft ? dt_orig * part.kill_time_accel : dt_orig;\n      if (this.tickParticle(part, dt)) {\n        parts[ii] = parts[parts.length - 1];\n        parts.pop();\n      }\n    }\n  }\n\n  emitParticle(init_dt, emitter) {\n    let emitter_def = emitter.def;\n    let part_set = this.part_sets[emitter_def.part_idx];\n    let def = part_set.def;\n    let pos = instValueVec(emitter_def.pos, 3);\n    v3add(pos, pos, this.pos);\n    // PERFTODO: Make the whole Particle just a data[] Float32Array\n    let part = {\n      def,\n      pos,\n      color: instValueVec(def.color, 4),\n      size: instValueVec(def.size, 4),\n      vel: instValueVec(emitter_def.vel, 3),\n      accel: instValueVec(def.accel, 3),\n      rot: instValue(def.rot),\n      rot_vel: instValue(def.rot_vel),\n      lifespan: instValue(def.lifespan),\n      kill_time_accel: instValue(def.kill_time_accel),\n      age: 0,\n    };\n    if (!this.tickParticle(part, init_dt)) {\n      part_set.parts.push(part);\n    }\n  }\n\n  tickEmitter(dt, emitter) {\n    let def = emitter.def;\n    // check for initial emission\n    if (!emitter.started && this.age >= emitter.emit_time[0]) {\n      emitter.started = true;\n      // ignore time before we started emitting\n      dt = this.age - emitter.emit_time[0];\n      let num = instValue(def.emit_initial);\n      for (let ii = 0; ii < num; ++ii) {\n        this.emitParticle(dt, emitter);\n      }\n      emitter.countdown = instValue(def.emit_rate);\n    }\n    if (emitter.started && !emitter.stopped && !this.kill_soft) {\n      // should we stop?\n      let remaining_dt = dt;\n      let emit_dt = dt;\n      if (this.age >= emitter.emit_time[1]) {\n        emitter.stopped = true;\n        // Do not emit during time after we stopped\n        emit_dt -= this.age - emitter.emit_time[1];\n      }\n      // Emit dt's worth of particles\n      while (emit_dt >= emitter.countdown) {\n        emit_dt -= emitter.countdown;\n        remaining_dt -= emitter.countdown;\n        emitter.countdown = instValue(def.emit_rate);\n        this.emitParticle(remaining_dt, emitter);\n      }\n      emitter.countdown -= emit_dt;\n    }\n  }\n\n  tick(dt) {\n    if (this.kill_hard) {\n      return true;\n    }\n    // tick existing particles\n    for (let ii = this.part_sets.length - 1; ii >= 0; --ii) {\n      this.tickPartSet(dt, this.part_sets[ii]);\n    }\n    // advance time and spawn new ones (with partial ticks)\n    this.age += dt;\n    for (let ii = 0; ii < this.emitters.length; ++ii) {\n      this.tickEmitter(dt, this.emitters[ii]);\n    }\n\n    return this.age >= this.system_lifespan; // kill if past lifespan\n  }\n\n  shift(delta) {\n    if (this.def.no_shift) {\n      return;\n    }\n    this.pos[0] += delta[0];\n    this.pos[1] += delta[1];\n    this.pos[2] += delta[2];\n    for (let ii = 0; ii < this.part_sets.length; ++ii) {\n      let parts = this.part_sets[ii].parts;\n      for (let jj = 0; jj < parts.length; ++jj) {\n        let part = parts[jj];\n        part.pos[0] += delta[0];\n        part.pos[1] += delta[1];\n        part.pos[2] += delta[2];\n      }\n    }\n  }\n}\n\nclass ParticleManager {\n  constructor() {\n    this.systems = [];\n  }\n\n  createSystem(def, pos) {\n    let system = new ParticleSystem(this, def, pos);\n    this.systems.push(system);\n    return system;\n  }\n\n  tick(dt) {\n    for (let ii = this.systems.length - 1; ii >= 0; --ii) {\n      if (this.systems[ii].tick(dt)) {\n        this.systems[ii] = this.systems[this.systems.length - 1];\n        this.systems.pop();\n      }\n    }\n  }\n\n  killAll() {\n    this.systems = [];\n  }\n\n  shift(delta) {\n    for (let ii = 0; ii < this.systems.length; ++ii) {\n      this.systems[ii].shift(delta);\n    }\n  }\n}\n\nexport function create() {\n  return new ParticleManager();\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nexport let perf_mem_counters = {};\n\n/* eslint-disable import/order */\nconst engine = require('./engine.js');\nlet metrics = [];\nexport function addMetric(metric, first) {\n  if (metric.show_graph) {\n    metric.num_lines = metric.colors.length;\n    metric.history_size = metric.data.history.length / metric.num_lines;\n  }\n  metric.num_labels = Object.keys(metric.labels).length;\n  if (metric.interactable === undefined) {\n    metric.interactable = engine.DEBUG && (metric.num_labels > 1 && !metric.show_all || metric.show_graph);\n  }\n  if (first) {\n    metrics.splice(0, 0, metric);\n  } else {\n    metrics.push(metric);\n  }\n}\n\n\nconst camera2d = require('./camera2d.js');\nconst { cmd_parse } = require('./cmds.js');\nconst glov_font = require('./font.js');\nconst input = require('./input.js');\nconst { max } = Math;\nconst { netClient, netClientId, netDisconnected } = require('./net.js');\nconst { perfCounterHistory } = require('glov/common/perfcounters.js');\nconst { profilerUI } = require('./profiler_ui.js');\nconst settings = require('./settings.js');\nconst { spriteChainedStart, spriteChainedStop } = require('./sprites.js');\nconst ui = require('./ui.js');\nconst { vec4, v3copy } = require('glov/common/vmath.js');\nrequire('./perf_net.js');\n\nconst METRIC_PAD = 2;\n\nlet bg_default = vec4(0,0,0,0.5);\nlet bg_mouse_over = vec4(0,0,0,0.75);\nlet bg_fade = vec4();\n\n// referenced in engine.js\nsettings.register({\n  show_metrics: {\n    default_value: 1,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n  },\n  show_fps: {\n    label: 'Show FPS',\n    default_value: engine.DEBUG ? 1 : 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,4],\n  },\n  fps_graph: {\n    label: 'FPS Graph',\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n  },\n  fps_window: {\n    label: 'FPS Time Window (seconds)',\n    default_value: 1,\n    type: cmd_parse.TYPE_FLOAT,\n    range: [0.001, 120],\n  },\n  show_perf_counters: {\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n  },\n  show_perf_memory: {\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n    access_run: ['sysadmin'], // only fetches from server, currently\n  },\n  perf_provider: {\n    default_value: 'client',\n    type: cmd_parse.TYPE_STRING,\n    usage: 'Set the perf provider for /show_perf_counters and /show_perf_memory\\n' +\n      '  CLIENT : show client values\\n' +\n      '  AUTO : automatically determine appropriate server\\n' +\n      '  user.1234 : use server hosting a particular worker',\n    access_run: ['sysadmin'],\n  },\n});\n\ncmd_parse.register({\n  cmd: 'fps',\n  help: 'Toggles FPS display',\n  func: function (str, resp_func) {\n    if (settings.show_fps && settings.show_metrics || str === '0') {\n      settings.set('show_fps', 0);\n    } else {\n      settings.set('show_fps', 1);\n      settings.set('show_metrics', 1);\n    }\n    resp_func();\n  },\n});\n\nlet fps_style = glov_font.style({\n  outline_width: 2, outline_color: 0x00000080,\n  color: 0xFFFFFFff,\n});\n\nfunction friendlyUnit(table, value) {\n  let unit = 0;\n  while (unit < table.length - 1 && value >= table[unit+1][0]) {\n    unit++;\n  }\n  if (unit === 0) {\n    return `${value} ${table[unit][1]}`;\n  }\n  return `${(value/table[unit][0]).toFixed(2)} ${table[unit][1]}`;\n}\nconst UNIT_BYTES = [\n  [1, 'bytes'],\n  [1024, 'KB'],\n  [1024*1024, 'MB'],\n  [1024*1024*1024, 'GB'],\n];\nconst UNIT_COUNT = [\n  [1, ''],\n  [1000, 'k'],\n  [1000*1000, 'm'],\n  [1000*1000*1000, 'g'],\n];\nexport function friendlyBytes(bytes) {\n  return friendlyUnit(UNIT_BYTES, bytes);\n}\nfunction friendlyCount(count) {\n  return friendlyUnit(UNIT_COUNT, count);\n}\n\nfunction showMetric(y, metric) {\n  let font = engine.font;\n  let pad = METRIC_PAD;\n  let line_height = settings.render_scale_all < 1 ? ui.font_height / settings.render_scale_all : ui.font_height;\n  let METRIC_VALUE_WIDTH = line_height * (metric.width || 2.5);\n  let x = camera2d.x1Real() - METRIC_VALUE_WIDTH - pad;\n  let y0 = y;\n  y += pad;\n  let max_label_w = 0;\n  let max_labels = metric.show_all ? Infinity : settings[metric.show_stat];\n  let drew_any = false;\n  let alpha = 1;\n  for (let label in metric.labels) {\n    let value = metric.labels[label]();\n    if (value) {\n      let style = fps_style;\n      if (value.alpha) {\n        alpha = value.alpha;\n        value = value.value;\n        style = glov_font.styleAlpha(fps_style, alpha);\n      }\n      let label_w = font.drawSizedAligned(style, x, y, Z.FPSMETER + 3, line_height,\n        glov_font.ALIGN.HRIGHT, 0, 0, label);\n      max_label_w = max(max_label_w, label_w);\n      font.drawSizedAligned(style, x, y, Z.FPSMETER + 3, line_height,\n        glov_font.ALIGN.HFIT, METRIC_VALUE_WIDTH, 0, value);\n      y += line_height;\n      drew_any = true;\n    }\n    if (!--max_labels) {\n      break;\n    }\n  }\n  let w = METRIC_VALUE_WIDTH + max_label_w + METRIC_PAD;\n  x -= max_label_w + METRIC_PAD;\n\n  if (!drew_any) {\n    return y - pad;\n  }\n\n  y += pad;\n  let bg = bg_default;\n  let pos_param = {\n    x: x - pad,\n    y: y0,\n    w: w + pad * 2,\n    h: y - y0,\n  };\n  if (metric.interactable) {\n    if (input.mouseUpEdge(pos_param)) {\n      if (metric.num_labels > 1 && settings[metric.show_stat] <= 1) {\n        settings.set(metric.show_stat, metric.num_labels);\n      } else if (metric.show_graph && !settings[metric.show_graph]) {\n        settings.set(metric.show_graph, 1);\n      } else {\n        if (metric.show_graph) {\n          settings.set(metric.show_graph, 0);\n        }\n        settings.set(metric.show_stat, 1);\n      }\n    }\n    if (input.mouseOver(pos_param)) {\n      bg = bg_mouse_over;\n    }\n  }\n  if (alpha !== 1) {\n    bg_fade[3] = bg[3] * alpha;\n    bg = v3copy(bg_fade, bg);\n  }\n  ui.drawRect(pos_param.x, pos_param.y, pos_param.x + pos_param.w, y, Z.FPSMETER+2, bg);\n  return y;\n}\n\nfunction showMetricGraph(y, metric) {\n  const small = engine.game_height < 300;\n  const LINE_WIDTH = small ? 1 : 3;\n  const LINE_PAD = small ? 0 : 1;\n  const LINE_HEIGHT = small ? 64 : 128;\n  const NUM_LINES = metric.history_size - 1;\n  let w = (LINE_WIDTH + LINE_PAD) * NUM_LINES;\n  let x = camera2d.x1Real() - w;\n  let h = LINE_HEIGHT + LINE_PAD * 2;\n  let z = Z.FPSMETER;\n  spriteChainedStart();\n  ui.drawRect(x, y - h, x + w, y, z++, bg_default);\n  x += LINE_PAD;\n  y -= LINE_PAD;\n  let history_index = metric.data.index;\n  let line_scale = LINE_HEIGHT / metric.line_scale_top;\n  for (let ii = 0; ii < NUM_LINES; ii++) {\n    let line_index = ((ii + history_index + 1) % metric.history_size) * metric.num_lines;\n    let data = metric.data.history;\n    let bar_max = 0;\n    for (let jj = 0; jj < metric.num_lines; jj++) {\n      let line_jj = data[line_index + jj];\n      let bar_min;\n      if (metric.bars_stack) {\n        bar_min = bar_max;\n        bar_max += line_jj;\n      } else {\n        // bars overlap, figure out how big this bar should be relative to next smallest\n        let lesser = 0;\n        for (let kk = 0; kk < metric.num_lines; kk++) {\n          if (kk === jj) {\n            continue;\n          }\n          let line_kk = data[line_index + kk];\n          if ((line_kk < line_jj || line_kk === line_jj && kk < jj) && line_kk > lesser) {\n            lesser = line_kk;\n          }\n        }\n        bar_min = lesser;\n        bar_max = line_jj;\n      }\n      let color = metric.colors[jj];\n      ui.drawRect(x, y - bar_max * line_scale, x + LINE_WIDTH, y - bar_min * line_scale, z, color);\n    }\n    x += LINE_WIDTH + LINE_PAD;\n  }\n  z += NUM_LINES;\n  y -= LINE_HEIGHT + LINE_PAD;\n  spriteChainedStop();\n  return y;\n}\n\nfunction perfDefaultAutoChannel() {\n  let client_id = netClientId();\n  if (client_id) {\n    return `client.${client_id}`;\n  }\n  return null;\n}\nlet auto_channel_cb = perfDefaultAutoChannel;\nexport function perfSetAutoChannel(cb) {\n  auto_channel_cb = cb;\n}\nconst PERF_NET_CACHE_TIME = 10000;\nconst PERF_NET_CACHE_TIME_MEM = 2500;\nlet perf_provider_data = {\n  last_update: -Infinity,\n  data: null,\n};\nfunction updatePerfProvider() {\n  let cache_time = PERF_NET_CACHE_TIME;\n  let fields = {\n  };\n  if (settings.show_perf_counters) {\n    fields.counters = 1;\n  }\n  if (settings.show_perf_memory) {\n    fields.memory = 1;\n    cache_time = PERF_NET_CACHE_TIME_MEM;\n  }\n  let provider = settings.perf_provider.toLowerCase();\n  if (provider === 'client') {\n    let ret = {\n      source: 'client',\n    };\n    if (fields.counters) {\n      ret.counters = perfCounterHistory();\n    }\n    if (fields.memory) {\n      ret.memory = perf_mem_counters;\n    }\n    return ret;\n  }\n  // Fetch from server\n  if (perf_provider_data.in_flight || netDisconnected()) {\n    return perf_provider_data.data;\n  }\n  let now = engine.frame_timestamp;\n  if (now - perf_provider_data.last_update < cache_time) {\n    return perf_provider_data.data;\n  }\n  let channel_id;\n  if (provider === 'auto') {\n    channel_id = auto_channel_cb();\n  } else if (provider.match(/^[^.]+\\.[^.]+$/)) { // seemingly valid channel ID\n    channel_id = provider;\n  }\n  if (channel_id) {\n    perf_provider_data.in_flight = true;\n    netClient().send('perf_fetch', { channel_id, fields }, function (err, data) {\n      if (err) {\n        console.error(`Error getting perf data: ${Object.keys(fields)}: ${err}`);\n      }\n      perf_provider_data.data = data;\n      perf_provider_data.last_update = engine.frame_timestamp;\n      perf_provider_data.in_flight = false;\n    });\n  }\n  return perf_provider_data.data;\n}\n\nfunction perfMemObjToLines(out, obj, prefix) {\n  for (let key in obj) {\n    let v = obj[key];\n    if (v && typeof v === 'object') {\n      perfMemObjToLines(out, v, `${prefix}${key}.`);\n    } else {\n      if (typeof v === 'number') {\n        if (key.endsWith('bytes') || prefix.includes('data_size')) {\n          v = friendlyBytes(v);\n        } else {\n          v = friendlyCount(v);\n        }\n      }\n      out.push(`${prefix}${key}: ${v}`);\n    }\n  }\n}\n\nlet graph_override = null;\n// `override` is like a `metric` passed to addMetric.  Contains:\n// history_size\n// num_lines\n// data: { history[history_size * num_lines], index }\n// line_scale_top\n// bars_stack : boolean\n// colors : vec4[]\nexport function perfGraphOverride(override) {\n  graph_override = override;\n}\n\nexport function draw() {\n  camera2d.push();\n  profilerUI();\n  camera2d.setAspectFixed(engine.game_width, engine.game_height);\n  if (settings.show_metrics) {\n    let y = camera2d.y0Real();\n    let y_graph = camera2d.y1Real();\n    if (graph_override) {\n      y_graph = showMetricGraph(y_graph, graph_override);\n      y_graph -= METRIC_PAD;\n    }\n    for (let ii = 0; ii < metrics.length; ++ii) {\n      let metric = metrics[ii];\n      if (settings[metric.show_stat]) {\n        y = showMetric(y, metric);\n        y += METRIC_PAD;\n      }\n      if (!graph_override && settings[metric.show_graph]) {\n        y_graph = showMetricGraph(y_graph, metric);\n        y_graph -= METRIC_PAD;\n      }\n    }\n  }\n  if (settings.show_perf_counters || settings.show_perf_memory) {\n    let font = engine.font;\n    let perf_data = updatePerfProvider() || {};\n    let y = camera2d.y0Real();\n    let y0 = y;\n    let line_height = settings.render_scale_all < 1 ? ui.font_height / settings.render_scale_all : ui.font_height;\n    let column_width = line_height * 6;\n    let x0 = camera2d.x0Real();\n    let x = x0 + column_width * 2;\n    let maxx = x + column_width;\n    let z = Z.FPSMETER + 1;\n    let header_x = x0 + column_width;\n    if (perf_data.source) {\n      font.drawSized(fps_style, header_x, y, z, line_height, `Source: ${perf_data.source}`);\n      y += line_height;\n    }\n    if (perf_data.log) {\n      let w = camera2d.wReal() *0.67;\n      maxx = max(maxx, header_x + w);\n      y += font.drawSizedWrapped(fps_style, header_x, y, z, w, 20, line_height, perf_data.log) + 4;\n    }\n\n    if (perf_data.memory && settings.show_perf_memory) {\n      let lines = [];\n      perfMemObjToLines(lines, perf_data.memory, '');\n      for (let ii = 0; ii < lines.length; ++ii) {\n        font.drawSized(fps_style, x, y, z, line_height, lines[ii]);\n        y += line_height;\n      }\n    }\n\n    if (perf_data.counters && settings.show_perf_counters) {\n      let hist = perf_data.counters || [];\n      let by_key = {};\n      for (let ii = 0; ii < hist.length; ++ii) {\n        let set = hist[ii];\n        for (let key in set) {\n          by_key[key] = by_key[key] || [];\n          by_key[key][ii] = set[key];\n        }\n      }\n      let keys = Object.keys(by_key);\n      keys.sort();\n      for (let ii = 0; ii < keys.length; ++ii) {\n        let key = keys[ii];\n        let data = by_key[key];\n        font.drawSizedAligned(fps_style, x - column_width * 2, y, z, line_height,\n          glov_font.ALIGN.HRIGHT|glov_font.ALIGN.HFIT, column_width * 2, 0, `${key}: `);\n        for (let jj = 0; jj < data.length; ++jj) {\n          if (data[jj]) {\n            font.drawSizedAligned(fps_style, x + column_width * jj, y, z, line_height,\n              glov_font.ALIGN.HFIT, column_width, 0, `${data[jj]} `);\n          }\n        }\n        maxx = max(maxx, x + column_width * data.length);\n        y += line_height;\n      }\n    }\n    ui.drawRect(x0, y0, maxx, y, z - 0.1, bg_default);\n  }\n  camera2d.pop();\n  graph_override = null;\n}\n","import { wsstats, wsstats_out } from 'glov/common/wscommon';\nimport { cmd_parse } from './cmds';\nimport * as perf from './perf';\nimport * as settings from './settings';\n\nconst { min } = Math;\n\ntype StatsType = typeof wsstats;\ntype StatsTracking = StatsType & {\n  dm: number;\n  db: number;\n  time: number;\n};\n\nsettings.register({\n  show_net: {\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,2],\n  },\n});\nlet last_wsstats: StatsTracking = { msgs: 0, bytes: 0, time: Date.now(), dm: 0, db: 0 };\nlet last_wsstats_out: StatsTracking = { msgs: 0, bytes: 0, time: Date.now(), dm: 0, db: 0 };\nfunction bandwidth(stats: StatsType, last: StatsTracking): string {\n  let now = Date.now();\n  if (now - last.time > 1000) {\n    last.dm = stats.msgs - last.msgs;\n    last.db = stats.bytes - last.bytes;\n    last.msgs = stats.msgs;\n    last.bytes = stats.bytes;\n    if (now - last.time > 2000) { // stall\n      last.time = now;\n    } else {\n      last.time += 1000;\n    }\n  }\n  return `${(last.db/1024).toFixed(2)} kb (${last.dm})`;\n}\nperf.addMetric({\n  name: 'net',\n  show_stat: 'show_net',\n  width: 5,\n  labels: {\n    'down: ': bandwidth.bind(null, wsstats, last_wsstats),\n    'up: ': bandwidth.bind(null, wsstats_out, last_wsstats_out),\n  },\n});\n\nlet ping_providers = 0;\nexport type PingData = {\n  ping: number;\n  fade: number;\n};\nexport function registerPingProvider(fn: () => PingData | null): void {\n  ++ping_providers;\n  let suffix = ping_providers === 1 ? '' : `${ping_providers}`;\n\n  settings.register({\n    [`show_ping${suffix}`]: {\n      default_value: 0,\n      type: cmd_parse.TYPE_INT,\n      range: [0,1],\n    },\n  });\n  perf.addMetric({\n    name: `ping${suffix}`,\n    show_stat: `show_ping${suffix}`,\n    labels: {\n      'ping: ': () => {\n        let pt = fn();\n        if (!pt || pt.fade < 0.001) {\n          return '';\n        }\n        return { value: `${pt.ping.toFixed(1)}`, alpha: min(1, pt.fade * 3) };\n      },\n    },\n  });\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nconst { eatPossiblePromise } = require('glov/common/util.js');\n\nlet user_want_locked = false;\nlet elem;\nlet on_ptr_lock;\n\nexport function isLocked() {\n  return user_want_locked; // Either it's locked, or there's an async attempt to lock it outstanding\n}\n\nfunction pointerLog(msg) {\n  console.log(`PointerLock: ${msg}`); // TODO: Disable this after things settle\n}\n\nexport function exit() {\n  pointerLog('Lock exit requested');\n  user_want_locked = false;\n  eatPossiblePromise(document.exitPointerLock());\n}\n\nexport function enter(when) {\n  user_want_locked = true;\n  on_ptr_lock();\n  pointerLog(`Trying pointer lock in response to ${when}`);\n  eatPossiblePromise(elem.requestPointerLock());\n}\n\nfunction onPointerLockChange() {\n  if (document.pointerLockElement || document.mozPointerLockElement || document.webkitPointerLockElement) {\n    pointerLog('Lock successful');\n    if (!user_want_locked) {\n      pointerLog('User canceled lock');\n      eatPossiblePromise(document.exitPointerLock());\n    }\n  } else {\n    if (user_want_locked) {\n      pointerLog('Lock lost');\n      user_want_locked = false;\n    }\n  }\n}\n\nfunction onPointerLockError(e) {\n  pointerLog('Error');\n  user_want_locked = false;\n}\n\nexport function startup(_elem, _on_ptr_lock) {\n  elem = _elem;\n  on_ptr_lock = _on_ptr_lock;\n\n  elem.requestPointerLock = elem.requestPointerLock || elem.mozRequestPointerLock ||\n    elem.webkitRequestPointerLock || function () { /* nop */ };\n  document.exitPointerLock = document.exitPointerLock || document.mozExitPointerLock ||\n    document.webkitExitPointerLock || function () { /* nop */ };\n\n  document.addEventListener('pointerlockchange', onPointerLockChange, false);\n  document.addEventListener('mozpointerlockchange', onPointerLockChange, false);\n  document.addEventListener('webkitpointerlockchange', onPointerLockChange, false);\n\n  document.addEventListener('pointerlockerror', onPointerLockError, false);\n  document.addEventListener('mozpointerlockerror', onPointerLockError, false);\n  document.addEventListener('webkitpointerlockerror', onPointerLockError, false);\n}\n","/* eslint no-extend-native:off */\n\n// TypedArray.slice, fill, join, sort, etc - not supported on IE, some older Safari, older Android, Chrome 44\nlet typedarrays = [Int8Array, Uint8Array, Int16Array, Uint16Array, Int32Array, Uint32Array, Float32Array];\n\nif (!Uint8Array.prototype.slice) {\n  typedarrays.forEach(function (ArrayType) {\n    Object.defineProperty(ArrayType.prototype, 'slice', {\n      value: function (begin, end) {\n        if (end === undefined) {\n          end = this.length;\n        }\n        if (end < 0) {\n          end = this.length - end;\n        }\n        begin = begin || 0;\n        if (begin >= this.length) {\n          begin = this.length - 1;\n        }\n        if (end > this.length) {\n          end = this.length;\n        }\n        if (end < begin) {\n          end = begin;\n        }\n        let len = end - begin;\n        let ret = new ArrayType(len);\n        for (let ii = 0; ii < len; ++ii) {\n          ret[ii] = this[begin + ii];\n        }\n        return ret;\n      }\n    });\n  });\n}\n\nfunction cmpDefault(a, b) {\n  return a - b;\n}\nlet replacements = {\n  join: function (delim) {\n    return Array.prototype.join.call(this, delim);\n  },\n  fill: function (value, begin, end) {\n    if (end === undefined) {\n      end = this.length;\n    }\n    for (let ii = begin || 0; ii < end; ++ii) {\n      this[ii] = value;\n    }\n    return this;\n  },\n  sort: function (cmp) {\n    Array.prototype.sort.call(this, cmp || cmpDefault);\n  },\n};\n\nfor (let key in replacements) {\n  if (!Uint8Array.prototype[key]) {\n    typedarrays.forEach(function (ArrayType) {\n      Object.defineProperty(ArrayType.prototype, key, {\n        value: replacements[key],\n      });\n    });\n  }\n}\n\nif (!String.prototype.endsWith) {\n  Object.defineProperty(String.prototype, 'endsWith', {\n    value: function (test) {\n      return this.slice(-test.length) === test;\n    },\n  });\n  Object.defineProperty(String.prototype, 'startsWith', {\n    value: function (test) {\n      return this.slice(0, test.length) === test;\n    },\n  });\n}\nif (!String.prototype.includes) {\n  Object.defineProperty(String.prototype, 'includes', {\n    value: function (search, start) {\n      return this.indexOf(search, start) !== -1;\n    },\n  });\n}\n\nif (!Array.prototype.includes) {\n  Object.defineProperty(Array.prototype, 'includes', {\n    value: function (search, start) {\n      return this.indexOf(search, start) !== -1;\n    },\n  });\n}\n\nif (!Object.values) {\n  Object.values = function values(obj) {\n    return Object.keys(obj).map((k) => obj[k]);\n  };\n}\nif (!Object.entries) {\n  Object.entries = function entries(obj) {\n    let keys = Object.keys(obj);\n    let ret = new Array(keys.length);\n    for (let ii = keys.length - 1; ii >= 0; --ii) {\n      ret[ii] = [keys[ii], obj[keys[ii]]];\n    }\n    return ret;\n  };\n}\n\nif (!Object.assign) {\n  Object.assign = function assign(target, source1) {\n    for (let argindex = 1; argindex < arguments.length; ++argindex) {\n      // eslint-disable-next-line prefer-rest-params\n      let source = arguments[argindex];\n      for (let key in source) {\n        target[key] = source[key];\n      }\n    }\n    return target;\n  };\n}\n\nif (!Math.sign) {\n  Math.sign = function sign(a) {\n    return a < 0 ? -1 : a > 0 ? 1 : 0;\n  };\n}\n\nif (typeof window !== 'undefined') {\n  if (!window.Intl) {\n    window.Intl = {};\n  }\n  if (!window.Intl.NumberFormat) {\n    window.Intl.NumberFormat = function () {\n      // Constructor\n    };\n    window.Intl.NumberFormat.prototype.format = function (v) {\n      return String(v);\n    };\n  }\n  if (!window.Intl.DateTimeFormat) {\n    window.Intl.DateTimeFormat = function () {\n      // Constructor\n    };\n    window.Intl.DateTimeFormat.prototype.format = function (v) {\n      return String(v);\n    };\n  }\n}\n","// Portions Copyright 2008-2022 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// Initially derived from libGlov:utilPerf.h/GlovPerf.cpp\n// For good memory profiling, Chrome must be launched with --enable-precise-memory-info\n\n// eslint-disable-next-line @typescript-eslint/no-redeclare\n/* globals performance*/\n\nexport const HAS_MEMSIZE = Boolean(window.performance && performance.memory && performance.memory.usedJSHeapSize);\nexport const HIST_SIZE = 128;\nexport const HIST_COMPONENTS = 3; // count, time, dmem\nexport const HIST_TOT = HIST_SIZE * HIST_COMPONENTS;\n// Default `mem_depth` very low, as every profile section with\n//    memory adds about 12s and 56bytes, compared to 1s and 24bytes without\nexport const MEM_DEPTH_DEFAULT = 2;\n\nconst assert = require('assert');\nconst engine = require('./engine.js');\nconst { floor, max, min, round } = Math;\n\n// For profiler_ui.js\nconst { localStorageGetJSON, localStorageSetJSON } = require('./local_storage.js');\nlet profiler_open_keys = localStorageGetJSON('profiler_open_keys', {});\n\nlet last_id = 0;\nfunction ProfilerEntry(parent, name) {\n  this.parent = parent;\n  this.depth = parent ? parent.depth + 1 : 0;\n  this.next = null;\n  this.child = null;\n  this.name = name;\n  this.count = 0;\n  this.time = 0;\n  this.dmem = 0;\n  this.start_time = 0;\n  this.start_mem = 0;\n  this.history = new Float32Array(HIST_TOT);\n  // For profiler_ui.js\n  this.id = ++last_id;\n  this.show_children = !(parent && parent.parent) || profiler_open_keys[this.getKey()] || false;\n  this.color_override = null;\n}\nProfilerEntry.prototype.isEmpty = function () {\n  for (let ii = 0; ii < HIST_TOT; ii+=HIST_COMPONENTS) {\n    if (this.history[ii]) {\n      return false;\n    }\n  }\n  return true;\n};\nProfilerEntry.prototype.toJSON = function () {\n  let { next, child } = this;\n  while (next && next.isEmpty()) {\n    next = next.next;\n  }\n  while (child && child.isEmpty()) {\n    child = child.next;\n  }\n  let ret = {\n    i: this.name,\n    h: Array.prototype.slice.call(this.history), // Float32Array -> Array\n  };\n  if (next) {\n    ret.n = next;\n  }\n  if (child) {\n    ret.c = child;\n  }\n  return ret;\n};\nfunction profilerEntryFromJSON(parent, obj) {\n  let ret = new ProfilerEntry(parent, obj.i);\n  assert.equal(obj.h.length, ret.history.length);\n  for (let ii = 0; ii < obj.h.length; ++ii) {\n    ret.history[ii] = obj.h[ii];\n  }\n  if (obj.n) {\n    ret.next = profilerEntryFromJSON(parent, obj.n);\n  }\n  if (obj.c) {\n    ret.child = profilerEntryFromJSON(ret, obj.c);\n  }\n  return ret;\n}\n\n// For profiler_ui.js\nProfilerEntry.prototype.getKey = function () {\n  if (!this.parent) {\n    return '';\n  } else {\n    return `${this.parent.getKey()}.${this.name}`;\n  }\n};\n// For profiler_ui.js\nProfilerEntry.prototype.toggleShowChildren = function () {\n  this.show_children = !this.show_children;\n  if (this.show_children) {\n    profiler_open_keys[this.getKey()] = 1;\n  } else {\n    delete profiler_open_keys[this.getKey()];\n  }\n  localStorageSetJSON('profiler_open_keys', profiler_open_keys);\n};\n\nlet root = new ProfilerEntry(null, 'root');\n// Add static node to the tree that we will reference later\n// Note: profiler_ui.js assumes this is always `root.child`\nlet node_out_of_tick = new ProfilerEntry(root, 'GPU/idle');\nroot.child = node_out_of_tick;\n// Immediately add `tick` node, so it's always second in the list\nlet node_tick = new ProfilerEntry(root, 'tick');\nnode_out_of_tick.next = node_tick;\n\nlet current = root;\nlet last_child = null;\nlet history_index = 0; // index to the last written frame of data\nlet paused = false;\nlet mem_depth = MEM_DEPTH_DEFAULT;\n\nfunction memSizeChrome() {\n  return performance.memory.usedJSHeapSize;\n}\nfunction memSizeNop() {\n  return 0;\n}\nlet memSize = HAS_MEMSIZE ? memSizeChrome : memSizeNop;\nlet mem_is_high_res = 10;\n\nexport function profilerChildCallCount(node, with_mem, do_average) {\n  let walk = node.child;\n  let count = 0;\n  while (walk) {\n    if (do_average) {\n      let total = 0;\n      let sum_count = 0;\n      for (let ii = 0; ii < HIST_TOT; ii+=HIST_COMPONENTS) {\n        if (!with_mem || walk.history[ii+2]) {\n          sum_count++;\n          total += walk.history[ii]; // count\n        }\n      }\n      if (sum_count) {\n        count += round(total / sum_count);\n      }\n    } else {\n      if (!with_mem || walk.history[history_index + 2]) {\n        count += walk.history[history_index];\n      }\n    }\n    count += profilerChildCallCount(walk, with_mem, do_average);\n    walk = walk.next;\n  }\n  return count;\n}\nconst WARN_CALLS_COUNT = 1000;\nexport function profilerWarning() {\n  let total_calls = profilerChildCallCount(root, false, true);\n  if (total_calls > WARN_CALLS_COUNT) {\n    return `Warning: Too many per-frame profilerStart() calls (${total_calls} > ${WARN_CALLS_COUNT})`;\n  } else if (!HAS_MEMSIZE) {\n    return 'To access memory profiling, run in Chrome';\n  } else if (mem_depth > 1 && mem_is_high_res < 10) {\n    return 'For precise memory profiling, launch Chrome with --enable-precise-memory-info';\n  }\n  return '';\n}\n\nexport function profilerNodeRoot() {\n  return root;\n}\nexport function profilerNodeTick() {\n  return node_tick;\n}\nexport function profilerHistoryIndex() {\n  return history_index;\n}\n\nlet garbage_accum = [0, 0];\nlet garbage_count = [0, 0, 0];\nexport function profilerFrameStart() {\n  root.count = 1;\n  let now = performance.now();\n  root.time = now - root.start_time;\n  root.start_time = now;\n  if (mem_depth > 0) {\n    let memnow = memSize();\n    root.dmem = memnow - root.start_mem;\n    root.start_mem = memnow;\n  }\n  node_out_of_tick.count = 1;\n  // Place the unaccounted portion of the root's time in `node_out_of_tick`\n  node_out_of_tick.time = root.time;\n  node_out_of_tick.dmem = root.dmem;\n  for (let walk = root.child; walk; walk = walk.next) {\n    if (walk === node_out_of_tick) {\n      continue;\n    }\n    node_out_of_tick.time -= walk.time;\n    node_out_of_tick.dmem -= walk.dmem;\n    if (mem_depth > 1) {\n      if (walk.count) {\n        // Should basically never see a `0` for dmem, if we do, probably low-precision memory tracking\n        if (walk.dmem) {\n          mem_is_high_res++;\n        } else {\n          mem_is_high_res-=5;\n        }\n      }\n    }\n  }\n  let pos = 0;\n  let neg = 0;\n  for (let walk = root.child; walk; walk = walk.next) {\n    if (walk.dmem < 0) {\n      neg -= walk.dmem;\n    } else {\n      pos += walk.dmem;\n    }\n  }\n  if (pos > neg) {\n    garbage_accum[0] += pos;\n    garbage_count[0]++;\n  } else {\n    garbage_accum[1] += neg;\n    garbage_count[1]++;\n  }\n  if (current !== root) {\n    console.error('Profiler starting new frame but some section was not stopped', current && current.name);\n    current = root;\n  }\n  if (!paused) {\n    history_index = (history_index + HIST_COMPONENTS) % HIST_TOT;\n  }\n  let walk = root;\n  while (walk) {\n    let recursing_down = true;\n    if (!paused) {\n      walk.history[history_index] = walk.count;\n      walk.history[history_index+1] = walk.time;\n      walk.history[history_index+2] = walk.dmem;\n    }\n    walk.count = 0;\n    walk.time = 0;\n    walk.dmem = 0;\n    do {\n      if (recursing_down && walk.child) {\n        walk = walk.child;\n      } else if (walk.next) {\n        walk = walk.next;\n      } else {\n        walk = walk.parent;\n        recursing_down = false;\n        if (walk) {\n          continue;\n        }\n      }\n      break;\n    } while (true);\n  }\n}\n\nfunction profilerStart(name) {\n  // Find us in current's children\n  let instance;\n  if (last_child && last_child.name === name) {\n    instance = last_child;\n  } else if (last_child && last_child.next && last_child.next.name === name) {\n    instance = last_child.next;\n  } else {\n    let last = null;\n    for (instance = current.child; instance; last = instance, instance = instance.next) {\n      if (instance.name === name) {\n        break;\n      }\n    }\n    if (!instance) {\n      if (!last) {\n        // No children yet\n        assert(!current.child);\n        instance = new ProfilerEntry(current, name);\n        current.child = instance;\n      } else if (last_child) {\n        instance = new ProfilerEntry(current, name);\n        instance.next = last_child.next;\n        last_child.next = instance;\n      } else {\n        instance = new ProfilerEntry(current, name);\n        last.next = instance;\n      }\n    }\n  }\n  assert(instance.parent === current);\n  // instance is set to us now!\n\n  current = instance;\n  instance.start_time = performance.now();\n  if (instance.depth < mem_depth) {\n    instance.start_mem = memSize();\n  }\n  last_child = null;\n}\n\nfunction profilerStop(old_name) {\n  if (old_name) {\n    assert.equal(old_name, current.name);\n  }\n  current.time += performance.now() - current.start_time;\n  if (current.depth < mem_depth) {\n    current.dmem += memSize() - current.start_mem;\n  }\n  current.count++;\n  last_child = current;\n  current = current.parent;\n}\n\nfunction profilerStopStart(name) {\n  // TODO: only sample timestamp once\n  profilerStop(null);\n  profilerStart(name);\n}\n\nif (window.performance && window.performance.now) {\n  window.profilerStart = profilerStart;\n  window.profilerStop = profilerStop;\n  window.profilerStopStart = profilerStopStart;\n} // else set to `nop` in bootstrap.js\n\nexport function profilerPaused() {\n  return paused;\n}\nexport function profilerPause(new_value) {\n  paused = new_value;\n}\n\nexport function profilerMemDepthGet() {\n  return mem_depth;\n}\n\nexport function profilerMemDepthSet(value) {\n  mem_depth = value;\n}\n\nlet bloat_inner = { time: 0, mem: 0 };\nlet bloat_outer = { time: 0, mem: 0 };\nlet bloat = { inner: bloat_inner, outer: bloat_outer };\nconst MEASURE_KEY1 = 'profilerMeasureBloat';\nconst MEASURE_KEY2 = 'profilerMeasureBloat:child';\nconst MEASURE_HIST = 10;\nexport function profilerMeasureBloat() {\n  let mem_depth_saved = mem_depth;\n  if (mem_depth >= 2) {\n    mem_depth = Infinity;\n  }\n  profilerStart(MEASURE_KEY1);\n  profilerStart(MEASURE_KEY2);\n  profilerStopStart(MEASURE_KEY2);\n  profilerStopStart(MEASURE_KEY2);\n  profilerStopStart(MEASURE_KEY2);\n  profilerStop(MEASURE_KEY2);\n  profilerStop(MEASURE_KEY1);\n  mem_depth = mem_depth_saved;\n\n  let walk = null;\n  for (walk = current.child; walk.name !== MEASURE_KEY1; walk = walk.next) {\n    // just walk until we find it, should just be the first entry, though!\n  }\n  let child = walk.child;\n  assert.equal(child.name, MEASURE_KEY2);\n  bloat_inner.time = Infinity;\n  bloat_inner.mem = 0;\n  bloat_outer.time = Infinity;\n  bloat_outer.mem = 0;\n  let count_mem = 0;\n  let idx_start = ((history_index - HIST_COMPONENTS * (MEASURE_HIST - 1)) + HIST_TOT) % HIST_TOT;\n  for (let offs = 0; offs < MEASURE_HIST; offs++) {\n    let idx = (idx_start + offs * HIST_COMPONENTS) % HIST_TOT;\n    bloat_inner.time = min(bloat_inner.time, child.history[idx+1]);\n    bloat_outer.time = min(bloat_outer.time, walk.history[idx+1]);\n    if (child.history[idx+2] > 0 && walk.history[idx+2] > 0) {\n      bloat_inner.mem += child.history[idx+2];\n      bloat_outer.mem += walk.history[idx+2];\n      ++count_mem;\n    }\n  }\n  bloat_inner.time /= 4;\n  bloat_outer.time = max(0, bloat_outer.time - bloat_inner.time) / 4;\n  let avg_inner_mem = bloat_inner.mem / count_mem / 4;\n  bloat_outer.mem = count_mem ? max(0, floor((bloat_outer.mem / count_mem - avg_inner_mem) / 4)) : 0;\n  bloat_inner.mem = count_mem ? max(0, floor(avg_inner_mem)) : 0;\n  // Code above semi-accurately measures the bloat in small scales, but seems\n  //   to overestimate on the grand scale (possibly some measurements are being\n  //   optimized away?), so, using this default value for memory instead\n  //   as measured Chrome 103 as an average over ~800 profiler calls in a\n  //   real app.\n  // On second consideration, not doing this: memory profiling is most useful when\n  //   looking at the leaf nodes, and the measured values best match the leaf\n  //   node values.\n  // bloat_outer.mem = 56;\n  return bloat;\n}\n\nexport function profilerGarbageEstimate() {\n  let ret;\n  if (garbage_count[0] > garbage_count[1]) {\n    ret = garbage_accum[0] / garbage_count[0];\n  } else {\n    ret = garbage_accum[1] / garbage_count[1];\n  }\n  garbage_count[0] = garbage_count[1] = 0;\n  garbage_accum[0] = garbage_accum[1] = 0;\n  return ret;\n}\n\nexport function profilerWalkTree(use_root, cb) {\n  let depth = 0;\n  let walk = use_root;\n  while (walk) {\n    let recursing_down = true;\n    if (walk !== use_root) {\n      if (!cb(walk, depth)) {\n        recursing_down = false;\n      }\n    }\n    do {\n      if (recursing_down && walk.child) {\n        depth++;\n        walk = walk.child;\n      } else if (walk.next) {\n        walk = walk.next;\n      } else {\n        depth--;\n        walk = walk.parent;\n        recursing_down = false;\n        if (walk) {\n          continue;\n        }\n      }\n      break;\n    } while (true);\n  }\n}\n\nexport function profilerAvgTime(entry) {\n  let sum = 0;\n  for (let ii = 0; ii < HIST_TOT; ii+=HIST_COMPONENTS) {\n    if (entry.history[ii]) {\n      sum += entry.history[ii+1];\n    }\n  }\n  return sum / HIST_SIZE;\n}\n\nexport function profilerMaxMem(entry) {\n  let dmem_max = 0;\n  for (let ii = 0; ii < HIST_TOT; ii+=HIST_COMPONENTS) {\n    if (entry.history[ii]) {\n      dmem_max = max(dmem_max, entry.history[ii+2]);\n    }\n  }\n  return dmem_max;\n}\n\nexport function profilerAvgMem(entry) {\n  let dmem_avg = 0;\n  let dmem_count = 0;\n  for (let ii = 0; ii < HIST_TOT; ii+=HIST_COMPONENTS) {\n    if (entry.history[ii]) {\n      let dmem = entry.history[ii+2];\n      if (dmem >= 0) {\n        dmem_avg += dmem;\n        dmem_count++;\n      }\n    }\n  }\n  if (dmem_count) {\n    dmem_avg /= dmem_count;\n  }\n  return dmem_avg;\n}\n\nexport function profilerExport() {\n  let obj = {\n    history_index,\n    root,\n    mem_depth: HAS_MEMSIZE ? mem_depth : 0,\n    // Include some device info\n    device: {\n      ua: window.navigator.userAgent,\n      vendor: gl.getParameter(gl.VENDOR),\n      renderer: gl.getParameter(gl.RENDERER),\n      webgl: engine.webgl2 ? 2 : 1,\n      width: engine.width,\n      height: engine.height,\n    },\n  };\n  let debug_info = gl.getExtension('WEBGL_debug_renderer_info');\n  if (debug_info) {\n    obj.device.renderer_unmasked = gl.getParameter(debug_info.UNMASKED_RENDERER_WEBGL);\n    obj.device.vendor_unmasked = gl.getParameter(debug_info.UNMASKED_VENDOR_WEBGL);\n  }\n  let str = JSON.stringify(obj);\n  // Round all numbers (in text form) to 3 digits of precision, that's the most\n  //   we're getting from performance.now anyway, and JSON ends up with lots\n  //   of 0.12299999999999 strings otherwise.\n  str = str.replace(/\\d\\.\\d\\d\\d\\d+/g, (a) => {\n    a = a[5]>'4' ? a.slice(0,4) + (Number(a[4])+1) : a.slice(0,5);\n    while (a.slice(-1) === '0' || a.slice(-1) === '.') {\n      a = a.slice(0, -1);\n    }\n    return a;\n  });\n\n  return str;\n}\nexport function profilerImport(text) {\n  let obj;\n  try {\n    obj = JSON.parse(text);\n  } catch (e) {\n    // handled below\n  }\n  if (!obj) {\n    return null;\n  }\n\n  obj.root = profilerEntryFromJSON(null, obj.root);\n  return obj;\n}\n\n// For calling manually in the console for debugging\nexport function profilerDump() {\n  assert(current === root);\n  let lines = ['','','# PROFILER RESULTS'];\n\n  // Using \"% of frame\" and \"average\" equivalent options from profiler_ui\n  let total_frame_time = profilerAvgTime(root);\n\n  profilerWalkTree(root, function (walk, depth) {\n    let time_sum=0;\n    let count_sum=0;\n    let time_max=0;\n    let sum_count=0;\n    let dmem_max=0;\n    for (let ii = 0; ii < HIST_TOT; ii+=HIST_COMPONENTS) {\n      if (walk.history[ii]) {\n        sum_count++;\n        count_sum += walk.history[ii]; // count\n        time_sum += walk.history[ii+1]; // time\n        time_max = max(time_max, walk.history[ii+1]);\n        dmem_max = max(dmem_max, walk.history[ii+2]);\n      }\n    }\n    if (!count_sum) {\n      return true;\n    }\n    let percent = (time_sum/HIST_SIZE) / total_frame_time;\n\n    let ms = time_sum / sum_count;\n    let count = (count_sum / sum_count).toFixed(0);\n\n    let buf = '';\n    for (let ii = 1; ii < depth; ++ii) {\n      buf += '* ';\n    }\n    buf += `${(percent * 100).toFixed(0)}% ${walk.name} `;\n    buf += `${(ms*1000).toFixed(0)} (${count}) max:${(time_max*1000).toFixed(0)}`;\n    if (HAS_MEMSIZE) {\n      buf += ` dmem:${dmem_max}`;\n    }\n    lines.push(buf);\n    return true;\n  });\n  let warning = profilerWarning();\n  if (warning) {\n    lines.push('', warning);\n  }\n  lines.push('', '');\n  console.log(lines.join('\\n'));\n}\n\nwindow.profilerDump = profilerDump;\n","// Portions Copyright 2008-2022 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// Initially derived from libGlov:utilPerf.h/GlovPerf.cpp\n// For good memory profiling, Chrome must be launched with --enable-precise-memory-info\n\n\n/* eslint-disable import/order */\nconst camera2d = require('./camera2d.js');\nconst { cmd_parse } = require('./cmds.js');\nconst engine = require('./engine.js');\nconst { style } = require('./font.js');\nconst input = require('./input.js');\nconst { floor, max, min, round } = Math;\nconst { netClient, netDisconnected } = require('./net.js');\nconst ui = require('./ui.js');\nconst { perfGraphOverride, friendlyBytes } = require('./perf.js');\nconst {\n  HIST_SIZE,\n  HIST_COMPONENTS,\n  HIST_TOT,\n  HAS_MEMSIZE,\n  MEM_DEPTH_DEFAULT,\n  profilerAvgTime,\n  profilerChildCallCount,\n  profilerImport,\n  profilerExport,\n  profilerHistoryIndex,\n  profilerAvgMem,\n  profilerMaxMem,\n  profilerMeasureBloat,\n  profilerMemDepthGet,\n  profilerMemDepthSet,\n  profilerNodeTick,\n  profilerNodeRoot,\n  profilerPause,\n  profilerPaused,\n  profilerWalkTree,\n  profilerWarning,\n} = require('./profiler.js');\nconst settings = require('./settings.js');\nconst { spriteChainedStart, spriteChainedStop } = require('./sprites.js');\nconst { lerp } = require('glov/common/util.js');\nconst { vec2, vec4 } = require('glov/common/vmath.js');\n\nZ.PROFILER = Z.PROFILER || 9950; // above Z.BUILD_ERRORS\nlet color_gpu = vec4(0.5, 0.5, 1, 1);\n\nlet loaded_profile = null;\nlet node_out_of_tick;\nlet root;\n\nfunction useNewRoot(new_root) {\n  root = new_root;\n  node_out_of_tick = root.child;\n  if (node_out_of_tick) {\n    node_out_of_tick.color_override = color_gpu;\n  }\n}\n\nfunction useSavedProfile(text) {\n  let obj = profilerImport(text);\n  if (!obj) {\n    ui.modalDialog({\n      title: 'Error loading profile',\n      text: text || 'No data',\n      buttons: {\n        Ok: null,\n      },\n    });\n    return;\n  }\n  useNewRoot(obj.root);\n  loaded_profile = obj;\n}\n\nfunction useLiveProfile() {\n  useNewRoot(profilerNodeRoot());\n  loaded_profile = null;\n}\n\nfunction profilerToggle(data, resp_func) {\n  useLiveProfile();\n  if (data === '1') {\n    settings.set('show_profiler', 1);\n  } else if (data === '0') {\n    settings.set('show_profiler', 0);\n    profilerMemDepthSet(MEM_DEPTH_DEFAULT);\n  } else {\n    if (settings.show_profiler) {\n      if (profilerPaused()) {\n        profilerPause(false);\n      } else {\n        settings.set('show_profiler', 0);\n        profilerMemDepthSet(MEM_DEPTH_DEFAULT);\n      }\n    } else {\n      settings.set('show_profiler', 1);\n      profilerPause(true);\n    }\n  }\n\n  if (resp_func) {\n    resp_func();\n  }\n}\nconst access_show = engine.DEBUG ? undefined : ['hidden'];\ncmd_parse.register({\n  cmd: 'profiler_toggle',\n  help: 'Show or toggle profiler visibility',\n  access_show,\n  func: profilerToggle,\n});\nconst PROFILER_RELATIVE_LABELS = ['% of user', '% of parent', '% of frame', '% of mem'];\nsettings.register({\n  show_profiler: {\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n    access_show,\n  },\n  profiler_average: {\n    default_value: 1,\n    type: cmd_parse.TYPE_INT,\n    range: [0,2],\n    access_show: ['hidden'],\n  },\n  profiler_relative: {\n    default_value: 1,\n    type: cmd_parse.TYPE_INT,\n    range: [0, PROFILER_RELATIVE_LABELS.length-1],\n    access_show: ['hidden'],\n  },\n  profiler_interactable: {\n    default_value: 1,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n    access_show: ['hidden'],\n  },\n  profiler_graph: {\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n    access_show: ['hidden'],\n  },\n  profiler_mem_depth: {\n    default_value: MEM_DEPTH_DEFAULT,\n    type: cmd_parse.TYPE_INT,\n    range: [0,100],\n    access_show: ['hidden'],\n  },\n  profiler_hide_bloat: {\n    default_value: 1,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n    access_show,\n  },\n});\n\nlet font;\nlet y;\nconst style_time_spike = style(null, {\n  color: 0xFF7F7Fff,\n});\nconst style_number = style(null, {\n  color: 0xFFFFD0ff,\n});\nconst style_percent = style(null, {\n  color: 0xFFFFD0ff,\n});\nconst style_ms = style(null, {\n  color: 0xD0FFFFff,\n});\nconst style_mem = style(null, {\n  color: 0xD0FFD0ff,\n});\nconst style_header = style(null, {\n  color: 0xFFFFFFff,\n  outline_width: 0.8,\n  outline_color: 0xFFFFFFff,\n});\nconst style_name = style(null, {\n  color: 0xFFFFFFff,\n  outline_width: 1,\n  outline_color: 0x00000080,\n});\nconst FONT_SIZE = 22;\nconst LINE_HEIGHT = 24;\nconst LINE_YOFFS = (LINE_HEIGHT - FONT_SIZE)/2;\nlet font_number_scale;\nlet font_size_number;\nlet number_yoffs;\nlet bar_w;\n// Different Zs for better batching\nconst Z_BAR = Z.PROFILER;\nconst Z_GRAPH = Z.PROFILER+1;\nconst Z_TREE = Z.PROFILER+2;\nconst Z_NAMES = Z.PROFILER+3;\nconst Z_NUMBER = Z.PROFILER+4;\nconst Z_MS = Z.PROFILER+5;\nconst MS_W = 58;\nconst COUNT_W = 56;\nconst MSPAIR_W = MS_W + 4 + COUNT_W;\nconst MEM_W = 120;\nconst COL_HEADERS = ['Profiler', 's (count)', 'max', 'GC / mem'];\nconst COL_W = [400, MSPAIR_W, MS_W, MEM_W];\nconst COL_X = [];\nlet bar_x0;\nCOL_X[0] = 0;\nfor (let ii = 0; ii < COL_W.length; ++ii) {\n  COL_X[ii+1] = COL_X[ii] + COL_W[ii] + 4;\n}\nconst LINE_WIDTH_WITH_MEM = COL_X[COL_W.length];\nconst LINE_WIDTH_NO_MEM = COL_X[COL_W.length-1];\nlet color_hint = vec4(0,0.25,0,0.85);\nlet color_bar = vec4(0,0,0,0.85);\nlet color_bar2 = vec4(0.2,0.2,0.2,0.85);\nlet color_bar_header = vec4(0.3,0.3,0.3,0.85);\nlet color_bar_over = vec4(0,0,0.5,0.85);\nlet color_bar_over2 = vec4(0.2,0.2,0.7,0.85);\nlet color_bar_parent = vec4(0,0,0.3,0.85);\nlet color_bar_parent2 = vec4(0.2,0.2,0.4,0.85);\nlet color_timing = vec4(1, 1, 0.5, 1);\nlet color_bar_highlight = vec4(0,0,0, 0.5);\nconst GRAPH_FRAME_TIME = 16;\nlet GRAPH_MAX_MEM = 4096;\nlet total_frame_time;\nlet total_frame_mem;\nlet show_index_count;\nlet show_index_time;\nlet show_index_mem;\nlet do_average;\nlet history_index;\nlet do_ui;\nlet line_width;\nlet show_mem;\nlet mouseover_elem = {};\nlet mouseover_main_elem;\nlet mouseover_bar_idx;\nlet dmem_max_value = 0;\nlet perf_graph = {\n  history_size: HIST_SIZE,\n  num_lines: 2,\n  data: {\n    history: new Float32Array(HIST_SIZE * 2),\n    index: 0,\n  },\n  line_scale_top: GRAPH_FRAME_TIME,\n  bars_stack: true,\n  colors: [\n    vec4(0.5, 1.0, 0.5, 1),\n    color_gpu,\n  ],\n};\nlet bloat;\nlet mouseover_param = { x: 0, peek: true, h: LINE_HEIGHT };\nfunction profilerShowEntryEarly(walk, depth) {\n  if (settings.profiler_relative === 0 && walk === node_out_of_tick) {\n    // doesn't make sense to show\n    return false;\n  }\n  let count_sum=0;\n  for (let ii = 0; ii < HIST_TOT; ii+=HIST_COMPONENTS) {\n    count_sum += walk.history[ii];\n  }\n  if (!count_sum) {\n    return true;\n  }\n  mouseover_param.y = y;\n  mouseover_param.w = line_width;\n  if (input.mouseOver(mouseover_param)) {\n    mouseover_main_elem = walk;\n    mouseover_elem[walk.id] = 1;\n    for (let parent = walk.parent; parent; parent = parent.parent) {\n      mouseover_elem[parent.id] = 2;\n    }\n  }\n  y += LINE_HEIGHT;\n  if (!walk.show_children) {\n    return false;\n  }\n  return true;\n}\nfunction hasActiveChildren(walk) {\n  walk = walk.child;\n  if (!walk) {\n    return false;\n  }\n  while (walk) {\n    for (let ii = 0; ii < HIST_TOT; ii+=HIST_COMPONENTS) {\n      if (walk.history[ii]) {\n        return true;\n      }\n    }\n    walk = walk.next;\n  }\n  return false;\n}\nfunction childMemCallCount(node, idx) {\n  let walk = node.child;\n  let count = 0;\n  while (walk) {\n    if (walk.history[idx+2]) {\n      count += walk.history[idx];\n    }\n    count += childMemCallCount(walk, idx);\n    walk = walk.next;\n  }\n  return count;\n}\nfunction nodeMemValue(node, idx) {\n  let count = node.history[idx];\n  let dmem = node.history[idx+2];\n  if (show_mem && settings.profiler_hide_bloat && dmem > 0) {\n    dmem = max(0, dmem - count * bloat.inner.mem - childMemCallCount(node, idx) * bloat.outer.mem);\n  }\n  return dmem;\n}\nlet click_param = { x: 0, h: LINE_HEIGHT };\nfunction profilerShowEntry(walk, depth) {\n  if (settings.profiler_relative === 0 && walk === node_out_of_tick) {\n    // doesn't make sense to show\n    return false;\n  }\n  let time_sum=0;\n  let count_sum=0;\n  let time_max=0;\n  let sum_count=0;\n  let dmem_min=Infinity;\n  let dmem_max=-Infinity;\n  let dmem_avg=0;\n  let dmem_count=0;\n  for (let ii = 0; ii < HIST_TOT; ii+=HIST_COMPONENTS) {\n    if (walk.history[ii]) {\n      sum_count++;\n      count_sum += walk.history[ii]; // count\n      time_sum += walk.history[ii+1]; // time\n      time_max = max(time_max, walk.history[ii+1]);\n      let dmem = nodeMemValue(walk, ii);\n      dmem_max_value = max(dmem_max_value, dmem); // global max, for graph scaling\n      dmem_min = min(dmem_min, dmem);\n      dmem_max = max(dmem_max, dmem);\n      if (dmem >= 0) {\n        dmem_avg += dmem;\n        ++dmem_count;\n      }\n    }\n  }\n  if (!count_sum) {\n    return true;\n  }\n  if (dmem_count) {\n    dmem_avg = round(dmem_avg / dmem_count);\n  }\n  let over = mouseover_elem[walk.id] === 1;\n  let parent_over = mouseover_elem[walk.id] === 2;\n  if (do_ui) {\n    click_param.y = y;\n    click_param.w = line_width;\n    let click = input.click(click_param);\n    if (click) {\n      if (click.button === 1) {\n        walk.parent.toggleShowChildren();\n      } else {\n        walk.toggleShowChildren();\n      }\n    }\n  }\n\n  profilerStart('bar graph');\n  spriteChainedStart();\n\n  // Draw background\n  let color_top = over ? color_bar_over : parent_over ? color_bar_parent : color_bar;\n  let color_bot = over ? color_bar_over2 : parent_over ? color_bar_parent2 : color_bar2;\n  if (!engine.defines.NORECTS) {\n    ui.drawRect4Color(0, y, line_width, y + LINE_HEIGHT, Z_BAR,\n      color_top, color_top, color_bot, color_bot);\n  }\n\n  // Draw bar graph\n  let x = bar_x0;\n  let offs = 1 + settings.profiler_graph;\n  let graph_max = settings.profiler_graph ? GRAPH_MAX_MEM : GRAPH_FRAME_TIME;\n  for (let ii = 0; ii < HIST_SIZE; ++ii) {\n    let value = walk.history[(history_index + (ii+1)*HIST_COMPONENTS) % HIST_TOT + offs];\n    if (value > 0) {\n      let hv = value / graph_max;\n      let h = min(hv * LINE_HEIGHT, LINE_HEIGHT);\n      if (hv < 1) {\n        color_timing[0] = hv;\n        color_timing[1] = 1;\n      } else {\n        color_timing[0] = 1;\n        color_timing[1] = max(0, 2 - hv);\n      }\n      let color = walk.color_override || color_timing;\n      if (!engine.defines.NORECTS) {\n        let elem = ui.drawRect(x + ii*bar_w, y + LINE_HEIGHT - h, x + (ii + 1)*bar_w, y + LINE_HEIGHT, Z_GRAPH, color);\n        elem.x = elem.y = 0; // no sorting by x/y required\n      }\n    }\n  }\n\n  spriteChainedStop();\n  profilerStop('bar graph');\n\n  y += LINE_YOFFS;\n\n  let prefix;\n  if (hasActiveChildren(walk)) {\n    if (!walk.show_children) {\n      prefix = ''; // '+';\n    } else {\n      prefix = ''; // '-';\n    }\n  }\n  let percent = 0;\n  if (settings.profiler_relative === 1) {\n    // \"% of parent\"\n    if (walk.parent) {\n      if (do_average) {\n        percent = (time_sum/HIST_SIZE) / profilerAvgTime(walk.parent);\n      } else {\n        percent = walk.history[show_index_time] ?\n          walk.history[show_index_time] / walk.parent.history[show_index_time] :\n          0;\n      }\n    }\n  } else if (settings.profiler_relative === 3) {\n    // % of mem\n    if (do_average === 2) {\n      percent = dmem_max / total_frame_mem;\n    } else if (do_average) {\n      percent = dmem_avg / total_frame_mem;\n    } else {\n      percent = walk.history[show_index_mem] / total_frame_mem;\n    }\n  } else {\n    if (do_average) {\n      percent = (time_sum/HIST_SIZE) / total_frame_time;\n    } else {\n      percent = walk.history[show_index_time] / total_frame_time;\n    }\n  }\n  x = depth * FONT_SIZE;\n  if (prefix) {\n    font.drawSized(null, x - 16, y, Z_TREE, FONT_SIZE, prefix);\n  }\n  x += FONT_SIZE*2;\n  font.drawSizedAligned(style_percent, x, y + number_yoffs, Z_NUMBER, font_size_number, font.ALIGN.HRIGHT, 0, 0,\n    `${(percent * 100).toFixed(0)}%`);\n  x += 4;\n  font.drawSized(style_name, x, y, Z_NAMES, FONT_SIZE,\n    walk.name);\n\n  x = COL_X[1];\n  let ms = do_average ? time_sum / sum_count : walk.history[show_index_time];\n  // TODO: removing timing bloat here (and in percents above? much more complicated...)\n  let count = do_average ? (count_sum / sum_count).toFixed(0) : walk.history[show_index_count];\n  font.drawSizedAligned(style_ms, x, y + number_yoffs, Z_MS, font_size_number, font.ALIGN.HRIGHT, MS_W, 0,\n    (ms*1000).toFixed(0));\n  x += MS_W + 4;\n  font.drawSizedAligned(style_number, x, y + number_yoffs, Z_NUMBER, font_size_number, font.ALIGN.HFIT, COUNT_W, 0,\n    `(${count})`);\n\n  x = COL_X[2];\n  let spike = (time_max * 0.25 > (time_sum / sum_count)) && (time_max > 500);\n  font.drawSizedAligned(spike ? style_time_spike : style_ms, x, y + number_yoffs, Z_MS, font_size_number,\n    font.ALIGN.HRIGHT, COL_W[2], 0,\n    (time_max*1000).toFixed(0));\n\n  if (show_mem) {\n    x = COL_X[3];\n\n    let mem_value = do_average === 2 ? dmem_max : do_average ? dmem_avg : nodeMemValue(walk, show_index_count);\n\n    if (dmem_min < 0) {\n      // Had a GC\n      font.drawSizedAligned(style_time_spike, x, y + number_yoffs, Z_MS, font_size_number,\n        font.ALIGN.HLEFT|font.ALIGN.HFIT, MEM_W/2, 0,\n        `${friendlyBytes(-dmem_min)}`);\n      font.drawSizedAligned(style_mem, x + MEM_W/2, y + number_yoffs, Z_MS, font_size_number,\n        font.ALIGN.HRIGHT|font.ALIGN.HFIT, MEM_W/2, 0,\n        `${mem_value}`);\n    } else {\n      // Just increase\n      font.drawSizedAligned(style_mem, x, y + number_yoffs, Z_MS, font_size_number, font.ALIGN.HRIGHT, MEM_W, 0,\n        `${mem_value}`);\n    }\n  }\n\n  y += FONT_SIZE + LINE_YOFFS;\n  if (!walk.show_children) {\n    return false;\n  }\n  return true;\n}\n\nfunction doZoomedGraph() {\n  if (settings.profiler_graph) {\n    perf_graph.line_scale_top = GRAPH_MAX_MEM;\n    if (!mouseover_main_elem) {\n      mouseover_main_elem = profilerNodeTick();\n    }\n  } else if (!mouseover_main_elem || mouseover_main_elem === node_out_of_tick) {\n    perf_graph.line_scale_top = GRAPH_FRAME_TIME * 2;\n  } else {\n    perf_graph.line_scale_top = GRAPH_FRAME_TIME;\n  }\n  let offs = 1 + settings.profiler_graph;\n  if (mouseover_main_elem) {\n    let elem = mouseover_main_elem;\n    for (let ii = 0; ii < HIST_SIZE; ++ii) {\n      perf_graph.data.history[ii*2] = elem.history[ii*HIST_COMPONENTS + offs];\n      perf_graph.data.history[ii*2+1] = 0;\n    }\n  } else {\n    for (let ii = 0; ii < HIST_SIZE; ++ii) {\n      let idx = ii*HIST_COMPONENTS + offs;\n      perf_graph.data.history[ii*2] = root.history[idx] - node_out_of_tick.history[idx];\n      perf_graph.data.history[ii*2+1] = node_out_of_tick.history[idx];\n    }\n  }\n  perf_graph.data.index = history_index/HIST_COMPONENTS;\n  perfGraphOverride(perf_graph);\n}\n\nconst BUTTON_W = 140;\nconst BUTTON_H = 48;\nconst BUTTON_FONT_HEIGHT = 24;\nlet mouse_pos = vec2();\nlet bloat_none = { inner: { time: 0, mem: 0 }, outer: { time: 0, mem: 0 } };\nlet button_overlay;\nlet button_close;\nlet button_paused;\nlet button_relative;\nlet button_average;\nlet button_graph;\nlet button_mem_dec;\nlet button_mem_depth;\nlet button_mem_inc;\nlet button_max_fps;\nlet button_save;\nlet button_load;\nlet last_line_width;\nfunction buttonInit() {\n  let z = Z.PROFILER + 10;\n  y = 0;\n  let x = line_width;\n  button_overlay = {\n    x, y, z,\n    w: BUTTON_W, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n    // text: settings.profiler_interactable ? 'interactable' : 'overlay',\n  };\n  button_close = {\n    x: x + BUTTON_W, y, z,\n    w: BUTTON_H, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n    text: 'X',\n  };\n  y += BUTTON_H;\n  button_paused = {\n    x, y, z,\n    w: BUTTON_W, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n    // text: loaded_profile ? 'loaded' : profilerPaused() ? 'paused' : 'live';\n  };\n  y += BUTTON_H;\n  button_relative = {\n    x, y, z,\n    w: BUTTON_W, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n    // text: PROFILER_RELATIVE_LABELS[settings.profiler_relative],\n  };\n  y += BUTTON_H;\n  button_average = {\n    x, y, z,\n    w: BUTTON_W, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n  };\n  y += BUTTON_H;\n  button_graph = {\n    x, y, z,\n    w: BUTTON_W, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n    // text: settings.profiler_graph ? 'graph: mem' : 'graph: CPU',\n  };\n  y += BUTTON_H;\n  y += LINE_HEIGHT;\n  button_mem_dec = {\n    x, y, z,\n    w: BUTTON_W/3, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n    text: '-',\n    // disabled: loaded_profile || cur_depth === 0,\n  };\n  button_mem_depth = {\n    x: x + BUTTON_W/3, y, z,\n    w: BUTTON_W/3, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n    // text: `${cur_depth || 'OFF'}`,\n    // disabled: loaded_profile,\n  };\n  button_mem_inc = {\n    x: x + 2*BUTTON_W/3, y, z,\n    w: BUTTON_W/3, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n    text: '+',\n    // disabled: loaded_profile,\n  };\n  y += BUTTON_H;\n  button_max_fps = {\n    x, y, z,\n    w: BUTTON_W, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n    // text: settings.max_fps ? 'max CPU' : 'anim frame',\n  };\n  y += BUTTON_H;\n  y += LINE_HEIGHT;\n  button_save = {\n    x, y, z,\n    w: BUTTON_W/2, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n    text: 'save',\n    // disabled: loaded_profile,\n  };\n  button_load = {\n    x: x + BUTTON_W/2, y, z,\n    w: BUTTON_W/2, h: BUTTON_H, font_height: BUTTON_FONT_HEIGHT,\n    text: 'load',\n  };\n}\nfunction profilerUIRun() {\n  profilerStart('profilerUIRun');\n  profilerStart('top+buttons');\n  bloat = bloat_none;\n  if (!loaded_profile && settings.profiler_hide_bloat) {\n    bloat = profilerMeasureBloat();\n  }\n  if (engine.render_width) {\n    let scale = FONT_SIZE / ui.font_height;\n    camera2d.set(0, 0, scale * engine.render_width, scale * engine.render_height);\n    font_number_scale = 1;\n    bar_w = scale;\n  } else {\n    camera2d.setScreen(true);\n    font_number_scale = 0.9;\n    bar_w = 2;\n  }\n  bar_x0 = COL_X[1] - HIST_SIZE*bar_w;\n  font_size_number = FONT_SIZE * font_number_scale;\n  number_yoffs = (FONT_SIZE - font_size_number) / 2;\n\n  if (profilerMemDepthGet() !== settings.profiler_mem_depth) {\n    // First time opening the UI this session, restore previous mem_depth values\n    profilerMemDepthSet(settings.profiler_mem_depth);\n  }\n\n  if (loaded_profile) {\n    history_index = loaded_profile.history_index;\n    show_mem = loaded_profile.mem_depth > 0;\n  } else {\n    history_index = profilerHistoryIndex();\n    show_mem = HAS_MEMSIZE;\n  }\n  line_width = show_mem ? LINE_WIDTH_WITH_MEM : LINE_WIDTH_NO_MEM;\n\n  if (!button_overlay || line_width !== last_line_width) {\n    last_line_width = line_width;\n    buttonInit();\n  }\n\n  let z = Z.PROFILER + 10;\n  y = 0;\n  let x = line_width;\n  button_overlay.text = settings.profiler_interactable ? 'interactable' : 'overlay';\n  if (ui.buttonText(button_overlay)) {\n    settings.set('profiler_interactable', 1 - settings.profiler_interactable);\n  }\n  do_ui = settings.profiler_interactable;\n  if (do_ui && ui.buttonText(button_close)) {\n    settings.set('show_profiler', 0);\n  }\n  y += BUTTON_H;\n\n  let text = loaded_profile ? 'loaded' : profilerPaused() ? 'paused' : 'live';\n  if (do_ui) {\n    button_paused.text = text;\n    if (ui.buttonText(button_paused)) {\n      if (loaded_profile) {\n        useLiveProfile();\n      } else {\n        profilerPause(!profilerPaused());\n      }\n    }\n  } else {\n    font.drawSizedAligned(null, x, y, z, FONT_SIZE, font.ALIGN.HVCENTERFIT, BUTTON_W, BUTTON_H, text);\n  }\n  y += BUTTON_H;\n\n  if (do_ui) {\n    button_relative.text = PROFILER_RELATIVE_LABELS[settings.profiler_relative];\n    if (ui.buttonText(button_relative)) {\n      settings.set('profiler_relative', (settings.profiler_relative + 1) % PROFILER_RELATIVE_LABELS.length);\n    }\n  } else {\n    font.drawSizedAligned(null, x, y, z, FONT_SIZE, font.ALIGN.HVCENTERFIT, BUTTON_W, BUTTON_H,\n      PROFILER_RELATIVE_LABELS[settings.profiler_relative]);\n  }\n  y += BUTTON_H;\n\n  text = settings.profiler_average === 2 ? 'max' : settings.profiler_average ? 'average' : 'last frame';\n  if (do_ui) {\n    button_average.text = text;\n    if (ui.buttonText(button_average)) {\n      let num_values = HAS_MEMSIZE ? 3 : 2;\n      settings.set('profiler_average', (settings.profiler_average + 1) % num_values);\n    }\n  } else {\n    font.drawSizedAligned(null, x, y, z, FONT_SIZE, font.ALIGN.HVCENTERFIT, BUTTON_W, BUTTON_H, text);\n  }\n  y += BUTTON_H;\n\n  text = settings.profiler_graph ? 'graph: mem' : 'graph: CPU';\n  if (do_ui) {\n    button_graph.text = text;\n    if (ui.buttonText(button_graph)) {\n      settings.set('profiler_graph', 1 - settings.profiler_graph);\n    }\n  } else {\n    font.drawSizedAligned(null, x, y, z, FONT_SIZE, font.ALIGN.HVCENTERFIT, BUTTON_W, BUTTON_H, text);\n  }\n  y += BUTTON_H;\n\n  if (loaded_profile ? true : HAS_MEMSIZE) {\n    let cur_depth = loaded_profile ? loaded_profile.mem_depth : profilerMemDepthGet();\n    font.drawSizedAligned(null, x, y, z, FONT_SIZE, font.ALIGN.HVCENTERFIT, BUTTON_W, LINE_HEIGHT,\n      'Mem Depth');\n    y += LINE_HEIGHT;\n    text = `${cur_depth || 'OFF'}`;\n    if (do_ui) {\n      button_mem_dec.disabled = loaded_profile || cur_depth === 0;\n      if (ui.buttonText(button_mem_dec)) {\n        profilerMemDepthSet(cur_depth - 1);\n        settings.set('profiler_mem_depth', profilerMemDepthGet());\n      }\n      button_mem_depth.disabled = loaded_profile;\n      button_mem_depth.text = text;\n      if (ui.buttonText(button_mem_depth)) {\n        if (cur_depth === MEM_DEPTH_DEFAULT) {\n          profilerMemDepthSet(99);\n        } else {\n          profilerMemDepthSet(MEM_DEPTH_DEFAULT);\n        }\n        settings.set('profiler_mem_depth', profilerMemDepthGet());\n      }\n      button_mem_inc.disabled = loaded_profile;\n      if (ui.buttonText(button_mem_inc)) {\n        profilerMemDepthSet(cur_depth + 1);\n        settings.set('profiler_mem_depth', profilerMemDepthGet());\n      }\n    } else {\n      font.drawSizedAligned(null, x, y, z, FONT_SIZE, font.ALIGN.HVCENTERFIT, BUTTON_W, BUTTON_H, text);\n    }\n  } else {\n    y += LINE_HEIGHT;\n  }\n  y += BUTTON_H;\n\n  text = settings.max_fps === 1000 ? 'max CPU' : settings.max_fps === 0 ? 'anim frame' : '?';\n  if (do_ui) {\n    button_max_fps.text = text;\n    if (ui.buttonText(button_max_fps)) {\n      settings.set('max_fps', settings.max_fps === 0 ? 1000 : 0);\n    }\n  } else {\n    font.drawSizedAligned(null, x, y, z, FONT_SIZE, font.ALIGN.HVCENTERFIT, BUTTON_W, BUTTON_H, text);\n  }\n  y += BUTTON_H;\n\n  let total_calls = profilerChildCallCount(root, false, settings.profiler_average);\n  font.drawSizedAligned(null, x, y, z, FONT_SIZE, font.ALIGN.HVCENTERFIT, BUTTON_W, LINE_HEIGHT,\n    `${total_calls} calls`);\n  y += LINE_HEIGHT;\n\n  if (do_ui) {\n    button_save.disabled = loaded_profile;\n    if (ui.buttonText(button_save)) {\n      // Note: doesn't work in IE, but we probably don't care\n      let a = document.createElement('a');\n      a.href = `data:application/json,${encodeURIComponent(profilerExport())}`;\n      a.setAttribute('download', 'profile.json');\n      a.click();\n    }\n    if (ui.buttonText(button_load)) {\n      let input_elem = document.createElement('input');\n      input_elem.setAttribute('type', 'file');\n      let reader = new FileReader();\n      reader.onload = () => {\n        if (reader.readyState === 2) {\n          useSavedProfile(reader.error || reader.result);\n        }\n      };\n      input_elem.onchange = () => {\n        reader.readAsText(input_elem.files[0]);\n      };\n      input_elem.click();\n    }\n    y += BUTTON_H;\n  }\n\n  ui.drawRect(x, 0, x + BUTTON_W, y, z-1, color_bar);\n\n  y = 0;\n\n  font.drawSizedAligned(style_header, COL_X[0], y, z, FONT_SIZE, font.ALIGN.HLEFT, COL_W[0], 0, COL_HEADERS[0]);\n  for (let ii = 1; ii < COL_HEADERS.length - (show_mem ? 0 : 1); ++ii) {\n    font.drawSizedAligned(style_header, COL_X[ii], y, z, FONT_SIZE, font.ALIGN.HCENTER, COL_W[ii], 0, COL_HEADERS[ii]);\n  }\n  ui.drawRect(0, y, line_width, y + LINE_HEIGHT, z-1, color_bar_header);\n  y += LINE_HEIGHT;\n\n  let y0 = y;\n\n  // first determine mouseover tree\n  mouseover_main_elem = null;\n  mouseover_bar_idx = -1;\n  if (do_ui) {\n    mouseover_elem = {};\n    profilerWalkTree(root, profilerShowEntryEarly);\n    if (mouseover_main_elem) {\n      if (loaded_profile || profilerPaused()) {\n        let xx = input.mousePos(mouse_pos)[0] - bar_x0;\n        mouseover_bar_idx = floor(xx / bar_w);\n        if (mouseover_bar_idx < 0 || mouseover_bar_idx >= HIST_SIZE) {\n          mouseover_bar_idx = -1;\n        }\n      }\n      // Just use this one elem's values\n      dmem_max_value = 0;\n      for (let ii = 0; ii < HIST_TOT; ii+=HIST_COMPONENTS) {\n        if (mouseover_main_elem.history[ii]) {\n          dmem_max_value = max(dmem_max_value, mouseover_main_elem.history[ii+2]);\n        }\n      }\n    }\n  }\n\n  if (dmem_max_value < GRAPH_MAX_MEM * 0.25 || dmem_max_value > GRAPH_MAX_MEM) {\n    GRAPH_MAX_MEM = lerp(0.1, GRAPH_MAX_MEM, dmem_max_value);\n  }\n  dmem_max_value = 0;\n  do_average = settings.profiler_average;\n  show_index_count = history_index;\n\n  if (mouseover_bar_idx !== -1) {\n    // override do_average if the mouse is over a particular frame in the bar graph\n    do_average = false;\n    show_index_count = (show_index_count - (HIST_SIZE - mouseover_bar_idx - 1) * HIST_COMPONENTS + HIST_TOT) % HIST_TOT;\n  }\n\n  show_index_time = show_index_count + 1;\n  show_index_mem = show_index_count + 2;\n\n  if (do_average) {\n    // use average for percents and timing\n    if (settings.profiler_relative === 0) {\n      // \"% of user\"\n      total_frame_time = 0;\n      let walk = root.child;\n      while (walk) {\n        if (walk !== node_out_of_tick) {\n          total_frame_time += profilerAvgTime(walk);\n        }\n        walk = walk.next;\n      }\n      total_frame_time = max(total_frame_time, 0.001);\n    } else if (settings.profiler_relative === 2) {\n      // \"% of frame\"\n      total_frame_time = profilerAvgTime(root);\n    } else if (settings.profiler_relative === 3) {\n      if (do_average === 2) {\n        total_frame_mem = profilerMaxMem(root);\n      } else {\n        total_frame_mem = profilerAvgMem(root);\n      }\n    }\n  } else {\n    // use last frame for percents\n    if (settings.profiler_relative === 0) {\n      // \"% of user\"\n      total_frame_time = 0;\n      let walk = root.child;\n      while (walk) {\n        if (walk !== node_out_of_tick) {\n          total_frame_time += walk.history[show_index_time];\n        }\n        walk = walk.next;\n      }\n      total_frame_time = max(total_frame_time, 0.001);\n    } else if (settings.profiler_relative === 2) {\n      // \"% of frame\"\n      total_frame_time = root.history[show_index_time];\n    } else if (settings.profiler_relative === 3) {\n      total_frame_mem = root.history[show_index_mem];\n      if (total_frame_mem < 0) {\n        // sum positive children instead, for better estimate\n        let walk = root.child;\n        total_frame_mem = 0;\n        while (walk) {\n          total_frame_mem += max(0, walk.history[show_index_mem]);\n          walk = walk.next;\n        }\n      }\n    }\n  }\n\n  profilerStopStart('interface');\n\n  // then render / do UI\n  y = y0;\n  profilerWalkTree(root, profilerShowEntry);\n  let hint = !loaded_profile && profilerWarning();\n  if (hint) {\n    font.drawSizedAligned(style_name, FONT_SIZE, y, Z_NAMES, FONT_SIZE,\n      font.ALIGN.HVCENTERFIT, line_width - FONT_SIZE*2, LINE_HEIGHT*1.5,\n      hint);\n    ui.drawRect(0, y,\n      line_width, y + LINE_HEIGHT*1.5, Z_NAMES - 0.5,\n      color_hint);\n  }\n\n  // profilerStopStart('bottom'); // nothing\n\n  if (mouseover_bar_idx !== -1) {\n    ui.drawRect(bar_x0 + mouseover_bar_idx * bar_w, y0,\n      bar_x0 + (mouseover_bar_idx + 1) * bar_w, y, Z_GRAPH + 0.5,\n      color_bar_highlight);\n  }\n\n  if (do_ui) {\n    // consume mouseover regardless\n    input.mouseOver({ x: 0, y: 0, w: line_width, h: y });\n  }\n\n  doZoomedGraph();\n\n  profilerStop();\n  profilerStop('profilerUIRun');\n}\n\nexport function profilerUIStartup() {\n  ({ font } = ui);\n  useLiveProfile();\n}\n\nexport function profilerUI() {\n  if (engine.DEBUG && input.keyUpEdge(input.KEYS.F7)) {\n    profilerToggle();\n  }\n  if (settings.show_profiler) {\n    profilerUIRun();\n  }\n  if (engine.DEBUG || settings.show_profiler) {\n    // TODO: warn if more than some number of profiler calls per frame\n  }\n}\n\ncmd_parse.register({\n  cmd: 'profile',\n  help: 'Captures a performance profile for developer investigation',\n  prefix_usage_with_help: true,\n  usage: 'Optionally delays for DELAY seconds before capturing the profile.\\n' +\n    'Usage: /profile [DELAY]',\n  func: function (str, resp_func) {\n    function doit() {\n      let profile = profilerExport();\n      if (netDisconnected()) {\n        ui.provideUserString('Profiler Snapshot', profile);\n        resp_func();\n      } else {\n        netClient().send('profile', profile, function (err, data) {\n          if (data?.id) {\n            ui.provideUserString('Profile submitted', `ID=${data.id}`);\n            resp_func(null, `Profile submitted with ID=${data.id}`);\n          } else {\n            resp_func(err, data);\n          }\n        });\n      }\n    }\n    if (Number(str)) {\n      setTimeout(doit, Number(str) * 1000);\n    } else {\n      doit();\n    }\n  },\n});\n","// Portions Copyright 2022 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nimport assert from 'assert';\nimport { clamp, merge } from 'glov/common/util.js';\nimport verify from 'glov/common/verify.js';\nimport { Vec4, vec2, vec4 } from 'glov/common/vmath';\nimport * as camera2d from './camera2d.js';\nimport * as engine from './engine.js';\nimport { Box } from './geom_types';\nimport * as input from './input.js';\nimport {\n  BUTTON_LEFT,\n  KEYS,\n  PAD,\n} from './input.js';\nimport {\n  SPOT_DEFAULT_BUTTON,\n  SPOT_STATE_DOWN,\n  SPOT_STATE_FOCUSED,\n  spot,\n  spotPadMode,\n  spotSubBegin,\n  spotSubEnd,\n  spotUnfocus,\n} from './spot.js';\nimport { spriteClipPop, spriteClipPush } from './sprites.js';\nimport * as ui from './ui.js';\n\nconst { max, min, round } = Math;\n\n// TODO: move FocusableElement to appropriate TS file after conversion (probably input)\ninterface FocusableElement {\n  focus: () => void;\n  is_focused: boolean;\n}\n\nconst MAX_OVERSCROLL = 50;\nconst OVERSCROLL_DELAY_WHEEL = 180;\n\nfunction darken(color: Vec4, factor: number): Vec4 {\n  return vec4(color[0] * factor, color[1] * factor, color[2] * factor, color[3]);\n}\n\nlet default_pixel_scale = 1;\nexport function scrollAreaSetPixelScale(scale: number): void {\n  default_pixel_scale = scale;\n}\n\ninterface ScrollAreaOptsAll extends Box {\n  // configuration options\n  z: number;\n  // h: number (from Box) is height of visible area, not interior scrolled area\n  rate_scroll_click: number;\n  pixel_scale: number;\n  top_pad: boolean; // set to false it the top/bottom \"buttons\" don't look like buttons\n  color: Vec4;\n  background_color: Vec4 | null;\n  auto_scroll: boolean; // If true, will scroll to the bottom if the height changes and we're not actively scrolling\n  auto_hide: boolean; // If true, will hide the scroll bar when the scroll area does not require it\n  no_disable: boolean; // Use with auto_hide=false to always do scrolling actions (overscroll, mousewheel)\n  focusable_elem: FocusableElement | null; // Another element to call .focus() on if we think we are focused\n  min_dist: number | undefined; // Minimum drag distance for background drag\n  disabled: boolean;\n\n  // Calculated (only once) if not set\n  rate_scroll_wheel: number;\n  rollover_color: Vec4;\n  rollover_color_light: Vec4;\n  disabled_color: Vec4;\n}\n\nexport type ScrollAreaOpts = Partial<ScrollAreaOptsAll>;\n\nexport interface ScrollArea extends Readonly<ScrollAreaOptsAll> {\n  resetScroll(): void;\n  barWidth(): number;\n  isFocused(): boolean;\n  consumedClick(): boolean;\n  isVisible(): boolean;\n  begin(params?: ScrollAreaOpts): void;\n  // Includes overscroll - actual visible scroll pos for this frame\n  getScrollPos(): number;\n  keyboardScroll(): void;\n  end(h: number): void;\n}\n\nlet temp_pos = vec2();\nlet last_scroll_area_id = 0;\nclass ScrollAreaInternal implements ScrollArea {\n  id = `sa:${++last_scroll_area_id}`;\n  x = 0;\n  y = 0;\n  z = Z.UI;\n  w = 10;\n  h = 10;\n  rate_scroll_click = ui.font_height;\n  pixel_scale = default_pixel_scale;\n  top_pad = true;\n  color = vec4(1,1,1,1);\n  background_color: Vec4 | null = vec4(0.4, 0.4, 0.4, 1);\n  auto_scroll = false;\n  auto_hide = false;\n  no_disable = false;\n  focusable_elem: FocusableElement | null = null;\n  min_dist: number | undefined;\n  disabled = false;\n\n  // Calculated (only once) if not set\n  rate_scroll_wheel;\n  rollover_color;\n  rollover_color_light;\n  disabled_color;\n\n  // run-time state\n  scroll_pos = 0;\n  overscroll = 0; // overscroll beyond beginning or end\n  overscroll_delay = 0;\n  grabbed_pos = 0;\n  grabbed = false;\n  consumed_click = false;\n  drag_start: number | null = null;\n  began = false;\n  last_internal_h = 0;\n  last_frame = 0;\n  was_disabled = false;\n  scrollbar_visible = false;\n  last_max_value = 0;\n\n  constructor(params?: ScrollAreaOpts) {\n    params = params || {};\n    this.applyParams(params);\n    this.rate_scroll_wheel = params.rate_scroll_wheel || this.rate_scroll_click * 2;\n    this.rollover_color = params.rollover_color || darken(this.color, 0.75);\n    this.rollover_color_light = params.rollover_color_light || darken(this.color, 0.95);\n    // equality is used to detect if this gets used and prevent rollover\n    assert(this.rollover_color_light !== this.color);\n    this.disabled_color = params.disabled_color || this.rollover_color;\n  }\n\n  applyParams(params?: ScrollAreaOpts): void {\n    if (!params) {\n      return;\n    }\n    merge(this, params);\n  }\n\n  barWidth(): number {\n    let { pixel_scale } = this;\n    let { scrollbar_top } = ui.sprites;\n    return scrollbar_top.uidata.total_w * pixel_scale;\n  }\n\n  isFocused(): boolean {\n    assert(false, 'deprecated?');\n    return false;\n  }\n\n  consumedClick(): boolean {\n    return this.consumed_click;\n  }\n\n  isVisible(): boolean {\n    return this.scrollbar_visible;\n  }\n\n  begin(params?: ScrollAreaOpts): void {\n    this.applyParams(params);\n    let { x, y, w, h, z, id } = this;\n    verify(!this.began); // Checking mismatched begin/end\n    this.began = true;\n    spotSubBegin({ x, y, w, h, key: id });\n    // Set up camera and clippers\n    spriteClipPush(z + 0.05, x, y, w - this.barWidth(), h);\n    let camera_orig_x0 = camera2d.x0();\n    let camera_orig_x1 = camera2d.x1();\n    let camera_orig_y0 = camera2d.y0();\n    let camera_orig_y1 = camera2d.y1();\n    // map (0,0) onto (x,y) in the current camera space, keeping w/h scale the same\n    let camera_new_x0 = -(x - camera_orig_x0);\n    let camera_new_y0 = -(y - camera_orig_y0) + this.getScrollPos();\n    let camera_new_x1 = camera_new_x0 + camera_orig_x1 - camera_orig_x0;\n    let camera_new_y1 = camera_new_y0 + camera_orig_y1 - camera_orig_y0;\n    camera2d.push();\n    camera2d.set(camera_new_x0, camera_new_y0, camera_new_x1, camera_new_y1);\n  }\n\n  // Includes overscroll - actual visible scroll pos for this frame\n  getScrollPos(): number {\n    return round(this.scroll_pos + this.overscroll);\n  }\n\n  clampScrollPos(): void {\n    let clamped_pos = clamp(this.scroll_pos, 0, this.last_max_value);\n    if (this.scroll_pos < 0) {\n      this.overscroll = max(this.scroll_pos, -MAX_OVERSCROLL);\n    } else if (this.scroll_pos > this.last_max_value) {\n      this.overscroll = min(this.scroll_pos - this.last_max_value, MAX_OVERSCROLL);\n    }\n    this.scroll_pos = clamped_pos;\n  }\n\n  keyboardScroll(): void {\n    if (this.was_disabled) {\n      return;\n    }\n    let modified = false;\n    let pad_shift = input.padButtonDown(PAD.RIGHT_TRIGGER) || input.padButtonDown(PAD.LEFT_TRIGGER);\n    let value = input.keyDownEdge(KEYS.PAGEDOWN) +\n      (pad_shift ? input.padButtonDownEdge(PAD.DOWN) : 0);\n    if (value) {\n      // don't overscroll on pageup/pagedown unless we're already at the end\n      this.scroll_pos = min(this.scroll_pos + this.h,\n        this.scroll_pos === this.last_max_value ? Infinity : this.last_max_value);\n      modified = true;\n    }\n    value = input.keyDownEdge(KEYS.PAGEUP) +\n      (pad_shift ? input.padButtonDownEdge(PAD.UP) : 0);\n    if (value) {\n      this.scroll_pos = max(this.scroll_pos - this.h,\n        this.scroll_pos === 0 ? -this.h : 0);\n      modified = true;\n    }\n\n    if (modified) {\n      this.clampScrollPos();\n    }\n  }\n\n  end(h: number): void {\n    //ScrollAreaDisplay *display = OR(this.display, &scroll_area_display_default);\n    assert(h >= 0);\n    h = max(h, 1); // prevent math from going awry on height of 0\n    assert(this.began); // Checking mismatched begin/end\n    this.began = false;\n    this.consumed_click = false;\n    let focused_sub_elem = spotSubEnd();\n    // restore camera and clippers\n    camera2d.pop();\n    spriteClipPop();\n\n    if (focused_sub_elem && spotPadMode()) {\n      // assumes the focus'd spot was in the same camera transform, if not, need to adapt to use .dom_pos instead\n      this.scrollIntoFocus(focused_sub_elem.y, focused_sub_elem.y + focused_sub_elem.h + 1, this.h);\n    }\n\n    let maxvalue = max(h - this.h+1, 0);\n    if (this.scroll_pos >= maxvalue) {\n      // internal height must have shrunk\n      this.scroll_pos = max(0, maxvalue);\n    }\n\n    let was_at_bottom = this.scroll_pos === this.last_max_value;\n    if (this.auto_scroll && (\n      this.last_frame !== engine.getFrameIndex() - 1 || // was not seen last frame, do a reset\n      this.last_internal_h !== h && was_at_bottom\n    )) {\n      // We were at the bottom, but we are now not, and auto-scroll is enabled\n      // want to be at the bottom, scroll down (effective next frame for the contents,\n      // but this frame for the handle, to prevent flicker)\n      this.overscroll = max(0, this.scroll_pos + this.overscroll - maxvalue);\n      this.scroll_pos = maxvalue;\n    }\n    this.last_internal_h = h;\n    this.last_frame = engine.getFrameIndex();\n\n\n    if (this.overscroll) {\n      let dt = engine.getFrameDt();\n      if (dt >= this.overscroll_delay) {\n        this.overscroll_delay = 0;\n        this.overscroll *= max(1 - dt * 0.008, 0);\n      } else {\n        this.overscroll_delay -= dt;\n      }\n    }\n\n    let {\n      auto_hide,\n      pixel_scale,\n      rollover_color,\n      rollover_color_light,\n    } = this;\n\n    let {\n      scrollbar_top, scrollbar_bottom, scrollbar_trough, scrollbar_handle, scrollbar_handle_grabber\n    } = ui.sprites;\n\n    let bar_w = scrollbar_top.uidata.total_w * pixel_scale;\n    let button_h = min(scrollbar_top.uidata.total_h * pixel_scale, this.h / 3);\n    let button_h_nopad = this.top_pad ? button_h : 0;\n    let bar_x0 = this.x + this.w - bar_w;\n    let handle_h = this.h / h; // How much of the area is visible\n    handle_h = clamp(handle_h, 0, 1);\n    let handle_pos = (this.h >= h) ? 0 : (this.scroll_pos / (h - this.h));\n    handle_pos = clamp(handle_pos, 0, 1);\n    assert(isFinite(handle_pos));\n    let handle_pixel_h = handle_h * (this.h - button_h_nopad * 2);\n    let handle_pixel_min_h = scrollbar_handle.uidata.total_h * pixel_scale;\n    let trough_height = this.h - button_h * 2;\n    handle_pixel_h = max(handle_pixel_h, min(handle_pixel_min_h, trough_height * 0.75));\n    let handle_screenpos = this.y + button_h_nopad + handle_pos * (this.h - button_h_nopad * 2 - handle_pixel_h);\n    // TODO: round handle_screenpos in pixely modes?\n    let top_color = this.color;\n    let bottom_color = this.color;\n    let handle_color = this.color;\n    let trough_color = this.color;\n    let disabled = this.disabled;\n    let auto_hidden = false;\n    if (!this.h) {\n      disabled = true;\n      auto_hidden = true;\n    } else if (handle_h === 1) {\n      auto_hidden = true;\n      if (this.no_disable) {\n        // Just *look* disabled, but still do overscroll, eat mousewheel events\n        trough_color = top_color = bottom_color = handle_color = this.disabled_color;\n      } else {\n        disabled = true;\n      }\n    }\n    this.was_disabled = disabled;\n\n    let gained_focus = false;\n\n    // Handle UI interactions\n    if (disabled) {\n      trough_color = top_color = bottom_color = handle_color = this.disabled_color;\n      this.drag_start = null;\n    } else {\n      // handle scroll wheel\n      let wheel_delta = input.mouseWheel({\n        x: this.x,\n        y: this.y,\n        w: this.w,\n        h: this.h\n      });\n      if (wheel_delta) {\n        this.overscroll_delay = OVERSCROLL_DELAY_WHEEL;\n        this.scroll_pos -= this.rate_scroll_wheel * wheel_delta;\n        if (focused_sub_elem) {\n          spotUnfocus();\n        }\n      }\n\n      // handle drag of handle\n      // before end buttons, as those might be effectively hidden in some UIs\n      let handle_rect = {\n        x: bar_x0,\n        y: handle_screenpos,\n        w: bar_w,\n        h: handle_pixel_h,\n        button: 0,\n        spot_debug_ignore: true,\n      };\n\n      let down = input.mouseDownEdge(handle_rect);\n      if (down) {\n        this.grabbed_pos = (down.pos[1] - handle_screenpos);\n        this.grabbed = true;\n        handle_color = rollover_color_light;\n      }\n      if (this.grabbed) {\n        gained_focus = true;\n      }\n      if (this.grabbed) {\n        // update pos\n        let up = input.mouseUpEdge({ button: 0 });\n        if (up) {\n          temp_pos[1] = up.pos[1];\n          this.consumed_click = true;\n        } else if (!input.mouseDownAnywhere(0)) {\n          // released but someone else ate it, release anyway!\n          this.grabbed = false;\n          this.consumed_click = true;\n        } else {\n          input.mousePos(temp_pos);\n        }\n        if (this.grabbed) {\n          let delta = temp_pos[1] - (this.y + button_h_nopad) - this.grabbed_pos;\n          let denom = this.h - button_h_nopad * 2 - handle_pixel_h;\n          if (denom > 0) {\n            this.scroll_pos = (h - this.h) * delta / denom;\n            assert(isFinite(this.scroll_pos));\n          }\n          handle_color = rollover_color_light;\n        }\n      }\n      if (input.mouseOver(handle_rect)) {\n        if (handle_color !== rollover_color_light) {\n          handle_color = rollover_color;\n        }\n      }\n\n      // handle clicking on end buttons\n      let button_param_up = {\n        x: bar_x0,\n        y: this.y,\n        w: bar_w,\n        h: button_h,\n        button: BUTTON_LEFT,\n        pad_focusable: false,\n        disabled: this.grabbed,\n        disabled_focusable: false,\n        def: SPOT_DEFAULT_BUTTON,\n      };\n      let button_param_down = {\n        ...button_param_up,\n        y: this.y + this.h - button_h,\n      };\n      let button_spot_ret = spot(button_param_up);\n      while (button_spot_ret.ret) {\n        --button_spot_ret.ret;\n        gained_focus = true;\n        this.scroll_pos -= this.rate_scroll_click;\n        this.consumed_click = true;\n      }\n      if (button_spot_ret.spot_state === SPOT_STATE_DOWN) {\n        top_color = rollover_color_light;\n      } else if (button_spot_ret.spot_state === SPOT_STATE_FOCUSED) {\n        top_color = rollover_color;\n      }\n      button_spot_ret = spot(button_param_down);\n      while (button_spot_ret.ret) {\n        --button_spot_ret.ret;\n        gained_focus = true;\n        this.scroll_pos += this.rate_scroll_click;\n        this.consumed_click = true;\n      }\n      if (button_spot_ret.spot_state === SPOT_STATE_DOWN) {\n        bottom_color = rollover_color_light;\n      } else if (button_spot_ret.spot_state === SPOT_STATE_FOCUSED) {\n        bottom_color = rollover_color;\n      }\n\n      // handle clicking trough if not caught by anything above +/-\n      let bar_param = {\n        key: `bar_${this.id}`,\n        x: bar_x0,\n        y: this.y,\n        w: bar_w,\n        h: this.h,\n        button: BUTTON_LEFT,\n        sound_rollover: null,\n        pad_focusable: false,\n        def: SPOT_DEFAULT_BUTTON,\n      };\n      let bar_spot_ret = spot(bar_param);\n      while (bar_spot_ret.ret) {\n        --bar_spot_ret.ret;\n        gained_focus = true;\n        this.consumed_click = true;\n        if (bar_spot_ret.pos) {\n          if (bar_spot_ret.pos[1] > handle_screenpos + handle_pixel_h/2) {\n            this.scroll_pos += this.h;\n          } else {\n            this.scroll_pos -= this.h;\n          }\n        }\n      }\n\n      // handle dragging the scroll area background\n      let drag = input.drag({ x: this.x, y: this.y, w: this.w - bar_w, h: this.h, button: 0, min_dist: this.min_dist });\n      if (drag) {\n        // Drag should not steal focus\n        // This also fixes an interaction with chat_ui where clicking on the chat background (which causes\n        //   a flicker of a drag) would cause pointer lock to be lost\n        //spotFocusSteal(this);\n        if (this.drag_start === null) {\n          this.drag_start = this.scroll_pos;\n        }\n        this.scroll_pos = this.drag_start - drag.cur_pos[1] + drag.start_pos[1];\n        this.consumed_click = true;\n      } else {\n        this.drag_start = null;\n      }\n      // Also eat drag for bar area, we handle it\n      input.drag({ x: this.x + this.w - bar_w, y: this.y, w: bar_w, h: this.h, button: 0 });\n    }\n\n    if (gained_focus && this.focusable_elem) {\n      this.focusable_elem.focus();\n    }\n\n    this.last_max_value = maxvalue;\n    this.clampScrollPos();\n\n    if (this.background_color) {\n      ui.drawRect(this.x, this.y, this.x + this.w, this.y + this.h, this.z, this.background_color);\n    }\n\n    if (disabled && (auto_hide && auto_hidden || !this.h)) {\n      this.scrollbar_visible = false;\n      return;\n    }\n    this.scrollbar_visible = true;\n\n    scrollbar_top.draw({\n      x: bar_x0, y: this.y, z: this.z + 0.2,\n      w: bar_w, h: button_h,\n      color: top_color,\n    });\n    scrollbar_bottom.draw({\n      x: bar_x0, y: this.y + this.h - button_h, z: this.z + 0.2,\n      w: bar_w, h: button_h,\n      color: bottom_color,\n    });\n    let trough_draw_pad = button_h / 2;\n    let trough_draw_height = trough_height + trough_draw_pad * 2;\n    let trough_v0 = -trough_draw_pad / pixel_scale / scrollbar_trough.uidata.total_h;\n    let trough_v1 = trough_v0 + trough_draw_height / pixel_scale / scrollbar_trough.uidata.total_h;\n    scrollbar_trough.draw({\n      x: bar_x0, y: this.y + trough_draw_pad, z: this.z+0.1,\n      w: bar_w, h: trough_draw_height,\n      uvs: [scrollbar_trough.uvs[0], trough_v0, scrollbar_trough.uvs[2], trough_v1],\n      color: trough_color,\n    });\n\n    ui.drawVBox({\n      x: bar_x0, y: handle_screenpos, z: this.z + 0.3,\n      w: bar_w, h: handle_pixel_h,\n    }, scrollbar_handle, handle_color);\n    let grabber_h = scrollbar_handle_grabber.uidata.total_h * pixel_scale;\n    scrollbar_handle_grabber.draw({\n      x: bar_x0, y: handle_screenpos + (handle_pixel_h - grabber_h) / 2, z: this.z + 0.4,\n      w: bar_w, h: grabber_h,\n      color: handle_color,\n    });\n  }\n\n  // h is height of visible area\n  scrollIntoFocus(miny: number, maxy: number, h: number): void {\n    let old_scroll_pos = this.scroll_pos;\n    let changed = false;\n    miny = max(miny, 0);\n    if (miny < this.scroll_pos) {\n      this.scroll_pos = miny;\n      changed = true;\n    }\n    maxy -= h;\n    if (maxy > this.scroll_pos) {\n      this.scroll_pos = maxy;\n      changed = true;\n    }\n    if (changed) {\n      // Make it smooth/bouncy a bit\n      this.overscroll = old_scroll_pos - this.scroll_pos;\n    }\n  }\n\n  scrollToEnd(): void {\n    this.scroll_pos = this.last_max_value;\n  }\n\n  resetScroll(): void {\n    this.scroll_pos = 0;\n    this.overscroll = 0;\n  }\n}\n\nexport function scrollAreaCreate(params?: ScrollAreaOpts): ScrollArea {\n  return new ScrollAreaInternal(params);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nlet modified = {};\nexports.true = true; // for perf.js\n\nconst assert = require('assert');\nconst { titleCase } = require('glov/common/util.js');\nconst { cmd_parse } = require('./cmds.js');\nconst engine = require('./engine.js');\n\nlet change_cbs = {};\n\nexport function get(key) {\n  return exports[key];\n}\n\nexport function set(key, value) {\n  if (exports[key] !== value) {\n    cmd_parse.handle(null, `${key} ${value}`, null); // uses default cmd_parse handler\n  }\n}\n\nexport function setAsync(key, value) {\n  engine.postTick({ fn: set.bind(null, key, value) });\n}\n\nexport function runTimeDefault(key, new_default) {\n  assert(!change_cbs[key]); // If so, we set `default_clear_on` below, and may have discarded a desired setting.\n  // Set a default value that cannot be determined at load time\n  // Only set if this has never been modified\n  if (!modified[key]) {\n    // Does *not* call cmd_parse.set - will not write to storage, still at \"default\" setting\n    exports[key] = new_default;\n  }\n}\n\nlet settings_stack = null;\nexport function push(pairs) {\n  assert(!settings_stack);\n  settings_stack = {};\n  for (let key in pairs) {\n    settings_stack[key] = exports[key];\n    exports[key] = pairs[key];\n    let cb = change_cbs[key];\n    if (cb) {\n      cb(false);\n    }\n  }\n}\n\nexport function pop() {\n  assert(settings_stack);\n  for (let key in settings_stack) {\n    exports[key] = settings_stack[key];\n    let cb = change_cbs[key];\n    if (cb) {\n      cb(false);\n    }\n  }\n  settings_stack = null;\n}\n\nexport function register(defs) {\n  Object.keys(defs).forEach(function (key) {\n    let def = defs[key];\n    exports[key] = def.default_value;\n    if (def.on_change) {\n      change_cbs[key] = def.on_change;\n    }\n    cmd_parse.registerValue(key, {\n      type: def.type,\n      label: def.label || titleCase(key.replace(/_/g, ' ')),\n      range: def.range,\n      get: () => exports[key],\n      set: (v) => {\n        modified[key] = true;\n        exports[key] = v;\n      },\n      store: def.store !== false,\n      ver: def.ver,\n      help: def.help,\n      usage: def.usage,\n      prefix_usage_with_help: def.prefix_usage_with_help,\n      on_change: def.on_change,\n      access_run: def.access_run,\n      access_show: def.access_show,\n      default_value: def.default_value,\n    });\n  });\n}\n\nregister({\n  max_fps: {\n    label: 'Maximum frame rate (FPS)',\n    prefix_usage_with_help: true,\n    usage:\n      'Display current maximum: /max_fps\\n' +\n      'Disable maximum FPS limit: /max_fps 0 (highly recommended)\\n' +\n      'Set maximum FPS limit: /max_fps 30\\n' +\n      'Default: /max_fps 0',\n    default_value: 0,\n    type: cmd_parse.TYPE_FLOAT,\n    ver: 1,\n  },\n  render_scale: {\n    label: 'Render Scale (3D)',\n    default_value: 1,\n    type: cmd_parse.TYPE_FLOAT,\n    range: [0.1,1],\n  },\n  render_scale_mode: {\n    label: 'Render Scale Mode',\n    default_value: 0,\n    type: cmd_parse.TYPE_INT,\n    range: [0,2],\n  },\n  render_scale_all: {\n    label: 'Render Scale (All)',\n    default_value: 1,\n    type: cmd_parse.TYPE_FLOAT,\n    range: [0.3333,4],\n  },\n  render_scale_clear: {\n    label: 'Render Scale Full Clear',\n    default_value: 1,\n    type: cmd_parse.TYPE_INT,\n    range: [0,1],\n  },\n  fov: {\n    default_value: 60,\n    type: cmd_parse.TYPE_FLOAT,\n    range: [1,100],\n  },\n  double_click_time: {\n    default_value: 500,\n    type: cmd_parse.TYPE_INT,\n    range: [0,2500],\n  },\n});\n","/* eslint-disable import/order */\nconst camera2d = require('./camera2d.js');\nconst { cmd_parse } = require('./cmds.js');\nconst engine = require('./engine.js');\nconst { fetch } = require('./fetch.js');\nconst glov_font = require('./font.js');\nconst input = require('glov/client/input.js');\nconst { min } = Math;\nconst { scrollAreaCreate } = require('./scroll_area.js');\nconst { shadersGetDebug } = require('./shaders.js');\nconst settings = require('./settings.js');\nconst ui = require('./ui.js');\nconst { errorString } = require('glov/common/util.js');\nconst { vec4 } = require('glov/common/vmath.js');\n\nZ.SHADER_DEBUG = Z.SHADER_DEBUG || 900;\n\nconst SHADER_STATS_SERVER = 'http://localhost:3000/api/shaderstats';\n\nlet shader_stats_cache = {};\nfunction getShaderStats(text, stage, peek) {\n  if (shader_stats_cache[text]) {\n    return shader_stats_cache[text].data;\n  }\n  if (peek) {\n    return null;\n  }\n  let cache = shader_stats_cache[text] = {\n    data: null,\n  };\n  fetch({\n    url: `${SHADER_STATS_SERVER}?stage=${stage}&text=${encodeURIComponent(text)}`,\n    response_type: 'json',\n  }, (err, obj) => {\n    if (err) {\n      cache.data = { err: `Fetch error: ${errorString(err)}` };\n    } else {\n      cache.data = obj;\n    }\n  });\n  return cache.data;\n}\n\nconst PAD = 4;\nconst style_title = glov_font.styleColored(null, 0x8090FFff);\nconst style = glov_font.styleColored(null, 0x222222ff);\nconst style_error = glov_font.styleColored(null, 0xDD2222ff);\nconst color_line = vec4(0.4,0.4,0.4,1);\nconst color_panel = vec4(1,1,1,1);\nconst color_invalid = vec4(0.8,0,0,1);\nconst color_selected = vec4(0.4, 0.6, 1, 1);\nlet scroll_area;\nlet scroll_area_source;\nlet selected_shader;\nfunction shaderDebugUITick() {\n  const PANEL_PAD = ui.tooltip_pad;\n  let x0 = camera2d.x0() + PANEL_PAD;\n  const y0 = camera2d.y0() + PANEL_PAD;\n  let z = Z.SHADER_DEBUG;\n  const { font, title_font, font_height } = ui;\n  let w = font_height * 20;\n  let x = x0;\n  let y = y0;\n\n  let shaders = shadersGetDebug();\n\n  title_font.drawSizedAligned(style_title, x, y, z, font_height, font.ALIGN.HCENTERFIT, w, 0,\n    `Shaders (${shaders.length})`);\n\n  if (!scroll_area) {\n    scroll_area = scrollAreaCreate({\n      z,\n      background_color: null,\n      auto_hide: true,\n    });\n    scroll_area_source = scrollAreaCreate({\n      z,\n      background_color: null,\n      auto_hide: true,\n    });\n  }\n  let sub_w = w - PAD - scroll_area.barWidth();\n  let score_w = sub_w * 0.3;\n  let subscore_w = score_w/2;\n  let button_w = sub_w - score_w - PAD;\n\n  font.draw({\n    x: x + button_w + PAD, y: y + ui.font_height * 0.5, z,\n    w: subscore_w - 1,\n    color: 0x404040ff,\n    size: ui.font_height * 0.5,\n    text: 'Ops',\n    align: font.ALIGN.HCENTERFIT,\n  });\n  font.draw({\n    x: x + button_w + PAD + subscore_w + 1, y: y + ui.font_height * 0.5, z,\n    w: subscore_w - 1,\n    color: 0x404040ff,\n    size: ui.font_height * 0.5,\n    text: 'Bytes',\n    align: font.ALIGN.HCENTERFIT,\n  });\n\n  y += font_height + 1;\n  ui.drawLine(x0 + w * 0.3, y, x0 + w * 0.7, y, z, 0.5, true, color_line);\n  y += PAD;\n\n  const max_h = camera2d.y1() - PAD - y;\n  let scroll_y_start = y;\n  scroll_area.begin({\n    x, y, w, h: max_h,\n  });\n  x = 0;\n  y = 0;\n  z = Z.UI;\n\n\n  for (let ii = 0; ii < shaders.length; ++ii) {\n    let shader = shaders[ii];\n    let filename = shader.filename.replace('shaders/', '');\n    if (shader.defines_arr.length) {\n      filename += `(${shader.defines_arr.join(',')})`;\n    }\n    if (ui.buttonText({\n      text: filename,\n      x, y, z,\n      w: button_w,\n      h: font_height,\n      color: selected_shader === shader ? color_selected : shader.valid ? undefined : color_invalid,\n      align: glov_font.ALIGN.HFIT,\n    })) {\n      if (selected_shader === shader) {\n        selected_shader = undefined;\n      } else {\n        selected_shader = shader;\n      }\n    }\n\n    let stats = getShaderStats(shader.shader_source_text, shader.type === gl.FRAGMENT_SHADER ? 'frag' : 'vert', false);\n    if (!stats || stats.err) {\n      font.draw({\n        x: x + button_w + PAD, y, z,\n        w: score_w,\n        color: stats?.err ? 0x800000ff : 0x808080ff,\n        text: stats?.err ? 'ERR' : '...',\n        align: font.ALIGN.HCENTERFIT,\n      });\n    } else {\n      let color = 0x000000ff;\n      font.draw({\n        x: x + button_w + PAD, y, z,\n        w: subscore_w - 1,\n        color,\n        text: `${stats.spirv?.count_total}`,\n        align: font.ALIGN.HCENTERFIT,\n      });\n      font.draw({\n        x: x + button_w + PAD + subscore_w + 1, y, z,\n        w: subscore_w - 1,\n        color,\n        text: stats.bin_size.toLocaleString(),\n        align: font.ALIGN.HCENTERFIT,\n      });\n    }\n\n    y += font_height;\n  }\n\n  scroll_area.end(y);\n  y = scroll_y_start + min(max_h, y);\n  z = Z.SHADER_DEBUG;\n\n  let close_button_size = ui.font_height;\n  if (ui.buttonText({\n    x: x0 + w - close_button_size,\n    y: y0, z: z + 1,\n    w: close_button_size, h: close_button_size,\n    text: 'X',\n  })) {\n    settings.set('shader_debug', 0);\n  }\n\n  ui.panel({\n    x: x0 - PANEL_PAD, y: y0 - PANEL_PAD, z: z - 1,\n    w: w + PANEL_PAD * 2, h: y - y0 + PANEL_PAD * 2,\n    color: color_panel,\n  });\n\n  if (!selected_shader) {\n    return;\n  }\n  let shader = selected_shader;\n  x0 += w + PANEL_PAD * 2;\n  w = camera2d.x1() - PAD - x0;\n  x = x0;\n  y = y0;\n\n  font.draw({\n    x, y, z,\n    w,\n    style, text: shader.filename,\n    align: font.ALIGN.HCENTERFIT,\n  });\n  y += font_height + 1;\n  ui.drawLine(x0 + w * 0.3, y, x0 + w * 0.7, y, z, 0.5, true, color_line);\n  y += PAD;\n\n  scroll_y_start = y;\n  scroll_area_source.begin({\n    x, y, w, h: max_h,\n  });\n  sub_w = w - PAD - scroll_area_source.barWidth();\n  x = 0;\n  y = 0;\n  z = Z.UI;\n\n  if (shader.error_text) {\n    y += font.draw({\n      x, y, z,\n      w: sub_w,\n      color: 0x800000ff,\n      style, text: shader.error_text,\n      align: font.ALIGN.HWRAP,\n    });\n  }\n\n  function flatten(obj, path) {\n    for (let key in obj) {\n      if (key === 'text' || key === 'spirv_raw') {\n        continue;\n      }\n      let value = obj[key];\n      let subpath = path ? `${path}.${key}` : key;\n      if (typeof value === 'object') {\n        flatten(value, subpath);\n      } else {\n        font.draw({\n          x, y, z,\n          w: sub_w,\n          style,\n          text: `${subpath}: ${value}`,\n          align: font.ALIGN.HFIT,\n        });\n        y += ui.font_height;\n      }\n    }\n  }\n  let stats = getShaderStats(shader.shader_source_text, shader.type === gl.FRAGMENT_SHADER ? 'frag' : 'vert');\n  if (!stats) {\n    y += font.draw({\n      x, y, z,\n      w,\n      style,\n      text: 'Loading shader stats...',\n      align: font.ALIGN.HWRAP,\n    });\n  } else if (stats.err) {\n    y += font.draw({\n      x, y, z,\n      w: sub_w,\n      style: style_error,\n      text: String(stats.err),\n      align: font.ALIGN.HWRAP,\n    });\n  } else {\n    flatten(stats);\n  }\n\n  let source_height = ui.font_height * 0.5;\n\n  if (stats?.text) {\n    y += PAD;\n    ui.drawLine(x + w * 0.3, y, x + w * 0.7, y, z, 0.5, true, color_line);\n    y += PAD/2;\n    font.draw({\n      x, y, z,\n      w,\n      style, text: 'Analyzed Shader Source',\n      align: font.ALIGN.HCENTERFIT,\n    });\n    y += font_height + 1;\n\n    let h = font.draw({\n      x, y, z,\n      w,\n      size: source_height,\n      style, text: stats.text,\n      align: font.ALIGN.HWRAP,\n    });\n    if (input.click({ x, y, w, h })) {\n      ui.provideUserString('Analyzed shader source', stats.text);\n    }\n    y += h;\n  }\n\n  if (stats?.spirv_raw) {\n    y += PAD;\n    ui.drawLine(x + w * 0.3, y, x + w * 0.7, y, z, 0.5, true, color_line);\n    y += PAD/2;\n    font.draw({\n      x, y, z,\n      w,\n      style, text: 'SPIR-V Disassembly',\n      align: font.ALIGN.HCENTERFIT,\n    });\n    y += font_height + 1;\n\n    let h = font.draw({\n      x, y, z,\n      w,\n      size: source_height,\n      style, text: stats.spirv_raw,\n      align: font.ALIGN.HWRAP,\n    });\n    if (input.click({ x, y, w, h })) {\n      ui.provideUserString('SPIR-V Disassembly', stats.spirv_raw);\n    }\n    y += h;\n  }\n\n  y += PAD;\n  ui.drawLine(x + w * 0.3, y, x + w * 0.7, y, z, 0.5, true, color_line);\n  y += PAD/2;\n  font.draw({\n    x, y, z,\n    w,\n    style, text: 'Actual WebGL Shader Source',\n    align: font.ALIGN.HCENTERFIT,\n  });\n  y += font_height + 1;\n\n  let h = font.draw({\n    x, y, z,\n    w,\n    size: source_height,\n    style, text: shader.shader_source_text,\n    align: font.ALIGN.HWRAP,\n  });\n  if (input.click({ x, y, w, h })) {\n    ui.provideUserString('Used WebGL shader source', shader.shader_source_text);\n  }\n  y += h;\n\n  scroll_area_source.end(y);\n  y = scroll_y_start + min(max_h, y);\n  z = Z.SHADER_DEBUG;\n\n  ui.panel({\n    x: x0 - PANEL_PAD, y: y0 - PANEL_PAD, z: z - 1,\n    w: w + PANEL_PAD * 2, h: y - y0 + PANEL_PAD * 2,\n    color: color_panel,\n  });\n}\n\nexport function shaderDebugUIStartup() {\n  // Registering after startup because of needing to call engine.addTickFunc()\n  settings.register({\n    shader_debug: {\n      label: 'Shader Debug',\n      default_value: 0,\n      type: cmd_parse.TYPE_INT,\n      range: [0,1],\n      access_show: ['sysadmin'],\n      on_change: () => {\n        engine.removeTickFunc(shaderDebugUITick);\n        if (settings.shader_debug) {\n          engine.addTickFunc(shaderDebugUITick);\n        }\n      },\n    },\n  });\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nexport const MAX_SEMANTIC = 5;\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst engine = require('./engine.js');\nconst { errorReportClear, errorReportSetDetails, glovErrorReport } = require('./error_report.js');\nconst { filewatchOn } = require('./filewatch.js');\nconst { matchAll, nop } = require('glov/common/util.js');\nconst { texturesUnloadDynamic } = require('./textures.js');\nconst { webFSGetFile } = require('./webfs.js');\n\nlet last_id = 0;\n\nlet bound_prog = null;\n\nexport const semantic = {\n  'ATTR0': 0,\n  'POSITION': 0,\n  'ATTR1': 1,\n  'COLOR': 1,\n  'COLOR_0': 1,\n  'ATTR2': 2,\n  'TEXCOORD': 2,\n  'TEXCOORD_0': 2,\n  'ATTR3': 3,\n  'NORMAL': 3,\n  'ATTR4': 4,\n  'TEXCOORD_1': 4,\n};\n\nexport let globals;\nlet globals_used;\nlet global_defines;\n\nlet error_fp;\nlet error_fp_webgl2;\nlet error_vp;\n\nlet shaders = [];\n\nconst vp_attr_regex = /attribute [^ ]+ ([^ ;]+);/g;\nconst uniform_regex = /uniform (?:(?:low|medium|high)p )?((?:(?:vec|mat)\\d(?:x\\d)?|float) [^ ;]+);/g;\nconst sampler_regex = /uniform sampler(?:2D|Cube) ([^ ;]+);/g;\nconst include_regex = /\\n#include \"([^\"]+)\"/g;\n\nconst type_size = {\n  float: 1,\n  vec2: 2*1,\n  vec3: 3*1,\n  vec4: 4*1,\n  mat3: 3*3,\n  mat4: 4*4,\n};\n\nfunction loadInclude(filename) {\n  let text = webFSGetFile(filename, 'text');\n  return `\\n// from include \"${filename}\":\\n${text}\\n`;\n}\n\nexport function shadersResetState() {\n  for (let ii = 0; ii < shaders.length; ++ii) {\n    let shader = shaders[ii];\n    if (shader.programs) {\n      for (let fpid in shader.programs) {\n        let prog = shader.programs[fpid];\n        //gl.useProgram(prog.handle);\n        for (let jj = 0; jj < prog.uniforms.length; ++jj) {\n          let unif = prog.uniforms[jj];\n          for (let kk = 0; kk < unif.size; ++kk) {\n            unif.value[kk] = NaN;\n          }\n          //uniformSetValue(unif);\n        }\n      }\n    }\n  }\n  bound_prog = null;\n  gl.useProgram(null);\n}\n\nexport function setGLErrorReportDetails() {\n  // Set some debug details we might want\n  let details = {\n    max_fragment_uniform_vectors: gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS),\n    max_varying_vectors: gl.getParameter(gl.MAX_VARYING_VECTORS),\n    max_vertex_attribs: gl.getParameter(gl.MAX_VERTEX_ATTRIBS),\n    max_vertex_uniform_vectors: gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS),\n    vendor: gl.getParameter(gl.VENDOR),\n    renderer: gl.getParameter(gl.RENDERER),\n    webgl: engine.webgl2 ? 2 : 1,\n  };\n  let debug_info = gl.getExtension('WEBGL_debug_renderer_info');\n  if (debug_info) {\n    details.renderer_unmasked = gl.getParameter(debug_info.UNMASKED_RENDERER_WEBGL);\n    details.vendor_unmasked = gl.getParameter(debug_info.UNMASKED_VENDOR_WEBGL);\n  }\n  for (let key in details) {\n    errorReportSetDetails(key, details[key]);\n  }\n}\n\nlet report_queued = false;\nlet shader_errors;\nlet shader_errors_any_fatal;\nlet reported_shader_errors = false;\nfunction reportShaderError(non_fatal, err) {\n  function doReport() {\n    report_queued = false;\n    setGLErrorReportDetails();\n    let msg = `Shader error(s):\\n    ${shader_errors.join('\\n    ')}`;\n    reported_shader_errors = true;\n    if (!shader_errors_any_fatal) {\n      glovErrorReport(false, msg, 'shaders.js');\n    } else {\n      assert(false, msg);\n    }\n    shader_errors = null;\n  }\n  if (!report_queued) {\n    setTimeout(doReport, 1000);\n    report_queued = true;\n    shader_errors = [];\n    shader_errors_any_fatal = false;\n  }\n  shader_errors_any_fatal = shader_errors_any_fatal || !non_fatal;\n  shader_errors.push(err);\n}\n\nfunction parseIncludes(parent_name, text) {\n  let supplied_uniforms = {};\n  text.replace(uniform_regex, function (str, key) {\n    supplied_uniforms[key] = true;\n  });\n  text = text.replace(include_regex, function (str, filename) {\n    let include_path = parent_name.split('/');\n    include_path.pop();\n    include_path.push(filename);\n    include_path = include_path.join('/');\n    let replacement = loadInclude(include_path);\n    if (!replacement) {\n      console.error(`Could not evaluate ${str}`);\n      return str;\n    }\n    // Remove duplicate uniforms\n    replacement = replacement.replace(uniform_regex, function (str2, key) {\n      if (supplied_uniforms[key]) {\n        return `// [removed ${key}]`;\n      }\n      supplied_uniforms[key] = true;\n      return str2;\n    });\n    return replacement;\n  });\n  return text;\n}\n\nconst webgl2_header = [\n  '#version 300 es',\n  '#define WEBGL2',\n].join('\\n');\nconst webgl2_header_fp = [\n  webgl2_header,\n  '#define varying in',\n  'out lowp vec4 fragColor;',\n  '#define gl_FragColor fragColor',\n  '#define texture2D texture',\n  '#define textureCube texture',\n  ''\n].join('\\n');\nconst webgl2_header_vp = [\n  webgl2_header,\n  '#define varying out',\n  '#define attribute in',\n  ''\n].join('\\n');\n\nfunction Shader(params) {\n  let { filename, defines, non_fatal } = params;\n  assert.equal(typeof filename, 'string');\n  let type = filename.endsWith('.fp') ? gl.FRAGMENT_SHADER : filename.endsWith('.vp') ? gl.VERTEX_SHADER : 0;\n  assert(type);\n  this.type = type;\n  this.filename = filename;\n  this.non_fatal = non_fatal;\n  this.defines_arr = (defines || []);\n  this.defines = this.defines_arr.map((a) => `#define ${a}\\n`).join('');\n  this.shader = gl.createShader(type);\n  this.id = ++last_id;\n  if (type === gl.VERTEX_SHADER) {\n    this.programs = {};\n  }\n  shaders.push(this);\n  this.compile();\n}\n\nexport function shadersGetDebug() {\n  return shaders;\n}\n\nfunction cleanShaderError(error_text) {\n  if (error_text) { // sometimes null on iOS\n    error_text = error_text.replace(/\\0/g, '').trim();\n  }\n  return error_text;\n}\n\nShader.prototype.compile = function () {\n  let { type, filename } = this;\n  let header = '';\n  let text = webFSGetFile(filename, 'text');\n  if (engine.webgl2 && text.includes('#pragma WebGL2')) {\n    header = type === gl.VERTEX_SHADER ? webgl2_header_vp : webgl2_header_fp;\n  }\n  text = `${header}${global_defines}${this.defines}${text}`;\n  text = parseIncludes(filename, text);\n  text = text.replace(/#pragma WebGL2?/g, '');\n  if (type === gl.VERTEX_SHADER) {\n    this.attributes = matchAll(text, vp_attr_regex);\n    // Ensure they are known names so we can give them indices\n    // Add to semantic[] above as needed\n    this.attributes.forEach((v) => assert(semantic[v] !== undefined));\n  } else {\n    this.samplers = matchAll(text, sampler_regex);\n    // Ensure all samplers end in a unique number\n    let found = [];\n    this.samplers.forEach((v) => {\n      let num = Number(v.slice(-1));\n      assert(!isNaN(num));\n      assert(!found[num]);\n      found[num] = true;\n    });\n  }\n  this.uniforms = matchAll(text, uniform_regex);\n  // Ensure a known type\n  this.uniforms.forEach((v) => {\n    let type_name = v.split(' ')[0];\n    assert(type_size[type_name]);\n  });\n  this.shader_source_text = text;\n  gl.shaderSource(this.shader, text);\n  gl.compileShader(this.shader);\n\n  if (!gl.getShaderParameter(this.shader, gl.COMPILE_STATUS)) {\n    this.valid = false;\n    let error_text = this.error_text = cleanShaderError(gl.getShaderInfoLog(this.shader));\n    if (this.defines_arr.length) {\n      filename += `(${this.defines_arr.join(',')})`;\n    }\n    console[this.non_fatal ? 'warn' : 'error'](`Error compiling ${filename}: ${error_text}`);\n    reportShaderError(this.non_fatal, `${filename}: ${error_text}`);\n    console.log(text.split('\\n').map((line, idx) => `${idx+1}: ${line}`).join('\\n'));\n  } else {\n    this.valid = true;\n    if (this.error_text) {\n      delete this.error_text;\n    }\n  }\n};\n\nexport function create(filename) {\n  if (typeof filename === 'object') {\n    return new Shader(filename);\n  }\n  return new Shader({ filename });\n}\n\nfunction uniformSetValue(unif) {\n  switch (unif.width) { // eslint-disable-line default-case\n    case 1:\n      gl.uniform1fv(unif.location, unif.value);\n      break;\n    case 2:\n      gl.uniform2fv(unif.location, unif.value);\n      break;\n    case 3:\n      gl.uniform3fv(unif.location, unif.value);\n      break;\n    case 4:\n      gl.uniform4fv(unif.location, unif.value);\n      break;\n    case 9:\n      gl.uniformMatrix3fv(unif.location, false, unif.value);\n      break;\n    case 16:\n      gl.uniformMatrix4fv(unif.location, false, unif.value);\n      break;\n  }\n}\n\nlet require_prelink = false;\nexport function shadersRequirePrelink(ensure) {\n  let old = require_prelink;\n  require_prelink = ensure;\n  return old;\n}\n\nfunction link(vp, fp, on_error) {\n  assert(!require_prelink);\n  let prog = vp.programs[fp.id] = {\n    handle: gl.createProgram(),\n    uniforms: null,\n  };\n  if (!prog.handle) {\n    assert(false, `gl.createProgram() returned ${prog.handle}${gl.createProgram() ? ', retry would succeed' : ''}`);\n  }\n  gl.attachShader(prog.handle, vp.shader);\n  gl.attachShader(prog.handle, fp.shader);\n  // call this for all relevant semantic\n  for (let ii = 0; ii < vp.attributes.length; ++ii) {\n    gl.bindAttribLocation(prog.handle, semantic[vp.attributes[ii]], vp.attributes[ii]);\n  }\n  gl.linkProgram(prog.handle);\n\n  prog.valid = gl.getProgramParameter(prog.handle, gl.LINK_STATUS);\n  if (!prog.valid) {\n    let error_text = cleanShaderError(gl.getProgramInfoLog(prog.handle));\n    console.error(`Shader link error: ${error_text}`);\n    // Currently, not calling on_error if `engine.DEBUG`, we want to see our\n    //   shader errors immediately!\n    if (on_error && (!engine.DEBUG || on_error === nop)) {\n      on_error(error_text);\n    } else {\n      reportShaderError(false, `Shader link error (${vp.filename} & ${fp.filename}):` +\n        ` ${error_text}`);\n    }\n    prog.uniforms = [];\n    return prog;\n  }\n\n  gl.useProgram(prog.handle);\n  bound_prog = prog;\n\n  let uniforms = vp.uniforms.slice(0);\n  for (let ii = 0; ii < fp.uniforms.length; ++ii) {\n    let name = fp.uniforms[ii];\n    if (uniforms.indexOf(name) === -1) {\n      uniforms.push(name);\n    }\n  }\n  prog.uniforms = uniforms.map((v) => {\n    v = v.split(' ');\n    let type = v[0];\n    let name = v[1];\n    let count = 1;\n    let m = name.match(/([^[]+)\\[(\\d+)\\]/);\n    if (m) {\n      name = m[1];\n      count = Number(m[2]);\n    }\n    let location = gl.getUniformLocation(prog.handle, name);\n    if (location === null) {\n      // Not in either shader, (commented out?), remove (via filter below)\n      return null;\n    }\n    let width = type_size[type];\n    let size = width * count;\n    let glob = globals[name];\n    globals_used[name] = true;\n    let value = new Float32Array(size);\n    // set initial value\n    let unif = {\n      name,\n      size,\n      width,\n      count,\n      value,\n      location,\n      glob,\n    };\n    uniformSetValue(unif);\n    return unif;\n  }).filter((v) => v);\n\n  for (let ii = 0; ii < fp.samplers.length; ++ii) {\n    let name = fp.samplers[ii];\n    let num = Number(name.slice(-1));\n    let location = gl.getUniformLocation(prog.handle, name);\n    if (location !== null) {\n      gl.uniform1i(location, num);\n    }\n  }\n  return prog;\n}\n\nfunction autoLink(vp, fp, on_error) {\n  let prog = vp.programs[fp.id];\n  if (!prog) {\n    prog = link(vp, fp, on_error);\n  }\n  if (!prog.valid) {\n    prog = link(vp, error_fp, nop);\n    if (!prog.valid && error_fp_webgl2) {\n      prog = link(vp, error_fp_webgl2, nop);\n    }\n    if (!prog.valid) {\n      prog = link(error_vp, error_fp, nop);\n    }\n    vp.programs[fp.id] = prog;\n  }\n  return prog;\n}\n\nexport function bind(vp, fp, params) {\n  let prog = vp.programs[fp.id];\n  if (!prog) {\n    prog = autoLink(vp, fp);\n  }\n  if (prog !== bound_prog) {\n    bound_prog = prog;\n    gl.useProgram(prog.handle);\n  }\n  for (let ii = 0; ii < prog.uniforms.length; ++ii) {\n    let unif = prog.uniforms[ii];\n    let value = params[unif.name] || unif.glob;\n    if (!value) {\n      continue;\n    }\n    let diff = false;\n    for (let jj = 0; jj < unif.size; ++jj) {\n      if (value[jj] !== unif.value[jj]) {\n        diff = true;\n        break;\n      }\n    }\n    if (diff) {\n      for (let jj = 0; jj < unif.size; ++jj) {\n        unif.value[jj] = value[jj];\n      }\n      uniformSetValue(unif);\n    }\n  }\n}\n\nexport function prelink(vp, fp, params = {}, on_error) {\n  let prog = autoLink(vp, fp, on_error);\n  // In theory, only need to link, not bind, but let's push it through the pipe as far as it can to be safe.\n  if (prog.valid) {\n    bind(vp, fp, params);\n  }\n  return prog.valid;\n}\n\nconst reserved = { WEBGL2: 1 };\nexport function addReservedDefine(key) {\n  reserved[key] = 1;\n}\nlet internal_defines = {};\nfunction applyDefines() {\n  global_defines = Object.keys(engine.defines).filter((v) => !reserved[v])\n    .concat(Object.keys(internal_defines))\n    .map((v) => `#define ${v}\\n`)\n    .join('');\n}\n\nfunction shaderReload() {\n  shadersRequirePrelink(false);\n  if (shaders.length) {\n    if (reported_shader_errors) {\n      errorReportClear();\n      reported_shader_errors = false;\n    }\n    gl.useProgram(null);\n    for (let ii = 0; ii < shaders.length; ++ii) {\n      let programs = shaders[ii].programs;\n      if (programs) {\n        for (let id in programs) {\n          gl.deleteProgram(programs[id].handle);\n        }\n        shaders[ii].programs = {};\n      }\n    }\n    for (let ii = 0; ii < shaders.length; ++ii) {\n      shaders[ii].compile();\n    }\n    texturesUnloadDynamic();\n  }\n}\n\nexport function handleDefinesChanged() {\n  applyDefines();\n  shaderReload();\n}\n\nexport function setInternalDefines(new_values) {\n  for (let key in new_values) {\n    if (new_values[key]) {\n      internal_defines[key] = new_values[key];\n    } else {\n      delete internal_defines[key];\n    }\n  }\n  handleDefinesChanged();\n}\n\nfunction onShaderChange(filename) {\n  shaderReload();\n}\n\nexport function startup(_globals) {\n  applyDefines();\n  globals = _globals;\n  globals_used = {};\n\n  error_fp = create('shaders/error.fp');\n  if (engine.webgl2) {\n    error_fp_webgl2 = create('shaders/error_gl2.fp');\n  }\n  error_vp = create('shaders/error.vp');\n\n  filewatchOn('.fp', onShaderChange);\n  filewatchOn('.vp', onShaderChange);\n}\n\nexport function addGlobal(key, vec) {\n  assert(!globals[key]);\n  assert(!globals_used[key]); // A shader has already been prelinked referencing this global\n  globals[key] = vec;\n  for (let ii = 0; ii < vec.length; ++ii) {\n    assert(isFinite(vec[ii]));\n  }\n}\n","import * as assert from 'assert';\nconst { round, max } = Math;\nimport { clamp } from 'glov/common/util.js';\nimport { vec4 } from 'glov/common/vmath.js';\nimport * as input from './input.js';\nimport {\n  SPOT_DEFAULT_BUTTON,\n  SPOT_NAV_LEFT,\n  SPOT_NAV_RIGHT,\n  spot,\n} from './spot.js';\nimport { Z_MIN_INC, drawHBox, playUISound } from './ui.js';\nimport * as ui from './ui.js';\n\nconst SPOT_DEFAULT_SLIDER = {\n  ...SPOT_DEFAULT_BUTTON,\n  sound_button: null,\n  custom_nav: {\n    [SPOT_NAV_RIGHT]: null,\n    [SPOT_NAV_LEFT]: null,\n  },\n};\n\nlet slider_default_vshrink = 1.0;\nlet slider_default_handle_shrink = 1.0;\nlet slider_default_inset = 0.0;\nexport function sliderSetDefaultShrink(vshrink, handle_shrink, slider_inset) {\n  slider_default_vshrink = vshrink;\n  slider_default_handle_shrink = handle_shrink;\n  slider_default_inset = slider_inset || 0;\n}\nconst color_slider_handle = vec4(1,1,1,1);\nconst color_slider_handle_grab = vec4(0.5,0.5,0.5,1);\nconst color_slider_handle_over = vec4(0.75,0.75,0.75,1);\nlet slider_dragging = false; // for caller polling\nlet slider_focused = false; // for caller polling\nexport function sliderIsDragging() {\n  return slider_dragging;\n}\nexport function sliderIsFocused() {\n  return slider_focused;\n}\n// Returns new value\nexport function slider(value, param) {\n  // required params\n  assert(typeof param.x === 'number');\n  assert(typeof param.y === 'number');\n  assert(param.min < param.max); // also must be numbers\n  // optional params\n  param.z = param.z || Z.UI;\n  param.w = param.w || ui.button_width;\n  param.h = param.h || ui.button_height;\n  param.max_dist = param.max_dist || Infinity;\n  // below: param.step = param.step || (param.max - param.min)/16;\n  let vshrink = param.vshrink || slider_default_vshrink;\n  let handle_shrink = param.handle_shrink || slider_default_handle_shrink;\n  let disabled = param.disabled || false;\n  let handle_h = param.h * handle_shrink;\n  let handle_w = ui.sprites.slider_handle.uidata.wh[0] * handle_h;\n  let pad_focusable = param.pad_focusable;\n\n  slider_dragging = false;\n\n  let shrinkdiff = handle_shrink - vshrink + slider_default_inset;\n  drawHBox({\n    x: param.x + param.h * shrinkdiff/2,\n    y: param.y + param.h * (1 - vshrink)/2,\n    z: param.z,\n    w: param.w - param.h * shrinkdiff,\n    h: param.h * vshrink,\n  }, ui.sprites.slider, param.color);\n\n  let xoffs = round(max(ui.sprites.slider.uidata.wh[0] * param.h * vshrink, handle_w) / 2);\n  let draggable_width = param.w - xoffs * 2;\n\n  // Draw notches - would also need to quantize the values below\n  // if (!slider->no_notches) {\n  //   float space_for_notches = width - xoffs * 4;\n  //   int num_notches = max - 1;\n  //   float notch_w = tile_scale * glov_ui_slider_notch->GetTileWidth();\n  //   float notch_h = tile_scale * glov_ui_slider_notch->GetTileHeight();\n  //   float max_notches = space_for_notches / (notch_w + 2);\n  //   int notch_inc = 1;\n  //   if (num_notches > max_notches)\n  //     notch_inc = ceil(num_notches / floor(max_notches));\n\n  //   for (int ii = 1; ii*notch_inc <= num_notches; ii++) {\n  //     float notch_x_mid = x + xoffs + draggable_width * ii * notch_inc / (float)max;\n  //     if (notch_x_mid - notch_w/2 < x + xoffs * 2)\n  //       continue;\n  //     if (notch_x_mid + notch_w/2 > x + width - xoffs * 2)\n  //       continue;\n  //     glov_ui_slider_notch->DrawStretchedColor(notch_x_mid - notch_w / 2, y + yoffs,\n  //       z + 0.25, notch_w, notch_h, 0, color);\n  //   }\n  // }\n\n  // Handle\n  let drag = !disabled && input.drag(param);\n  let grabbed = Boolean(drag);\n  param.def = SPOT_DEFAULT_SLIDER;\n  if (grabbed) {\n    param.focus_steal = true;\n  }\n  param.pad_focusable = pad_focusable;\n  let spot_ret = spot(param);\n  slider_focused = spot_ret.focused;\n  if (spot_ret.ret && spot_ret.pos) {\n    // was actually clicked (not\n    grabbed = false;\n    // update pos\n    value = (spot_ret.pos[0] - (param.x + xoffs)) / draggable_width;\n    value = param.min + (param.max - param.min) * clamp(value, 0, 1);\n    playUISound('button_click');\n  } else if (grabbed) {\n    // update pos\n    value = (drag.cur_pos[0] - (param.x + xoffs)) / draggable_width;\n    value = param.min + (param.max - param.min) * clamp(value, 0, 1);\n    // Eat all mouseovers while dragging\n    input.mouseOver();\n    slider_dragging = true;\n    slider_focused = true;\n  }\n  if (spot_ret.nav) {\n    playUISound('button_click');\n    let step = param.step || (param.max - param.min)/16;\n    if (spot_ret.nav === SPOT_NAV_RIGHT) {\n      value = clamp(value + step, param.min, param.max);\n    } else if (spot_ret.nav === SPOT_NAV_LEFT) {\n      value = clamp(value - step, param.min, param.max);\n    }\n  }\n  let handle_center_pos = param.x + xoffs + draggable_width * (value - param.min) / (param.max - param.min);\n  let handle_x = handle_center_pos - handle_w / 2;\n  let handle_y = param.y + param.h / 2 - handle_h / 2;\n  let handle_color = color_slider_handle;\n  if (grabbed) {\n    handle_color = color_slider_handle_grab;\n  } else if (spot_ret.focused) {\n    handle_color = color_slider_handle_over;\n  }\n\n  ui.sprites.slider_handle.draw({\n    x: handle_x,\n    y: handle_y,\n    z: param.z + Z_MIN_INC,\n    w: handle_w,\n    h: handle_h,\n    color: handle_color,\n    frame: 0,\n  });\n\n  return value;\n}\n","// Portions Copyright 2020 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/* eslint-env browser */\n\nimport assert from 'assert';\nimport { PLATFORM_FBINSTANT } from 'glov/client/client_config';\nimport {\n  ID_PROVIDER_FB_GAMING,\n  ID_PROVIDER_FB_INSTANT,\n  PRESENCE_ACTIVE,\n  PRESENCE_INACTIVE,\n  PRESENCE_OFFLINE,\n} from 'glov/common/enums';\nimport { FriendData, FriendStatus, FriendsData } from 'glov/common/friends_data';\nimport {\n  ClientPresenceData,\n  ErrorCallback,\n  FriendCmdResponse,\n  ServerPresenceData,\n} from 'glov/common/types';\nimport { deepEqual } from 'glov/common/util';\nimport { Vec4 } from 'glov/common/vmath';\nimport { cmd_parse } from './cmds';\nimport { ExternalUserInfo } from './external_user_info';\nimport * as input from './input';\nimport { netDisconnected, netSubs } from './net';\nimport { Sprite, spriteCreate } from './sprites';\nimport * as textures from './textures';\n\ndeclare let gl: WebGLRenderingContext | WebGL2RenderingContext;\n\nconst IDLE_TIME = 60000;\n\nlet friend_list: FriendsData | null = null;\n\nexport function friendsGet(): FriendsData {\n  return friend_list ?? Object.create(null);\n}\n\nexport function isFriend(user_id: string): boolean {\n  let value = friend_list?.[user_id];\n  return value?.status === FriendStatus.Added || value?.status === FriendStatus.AddedAuto;\n}\n\nexport function friendIsBlocked(user_id: string): boolean {\n  let value = friend_list?.[user_id];\n  return value?.status === FriendStatus.Blocked;\n}\n\nfunction makeFriendCmdRequest(cmd: string, user_id: string, cb: ErrorCallback<string>): void {\n  user_id = user_id.toLowerCase();\n  let requesting_user_id = netSubs().loggedIn();\n  if (netDisconnected()) {\n    return void cb('ERR_DISCONNECTED');\n  }\n  if (!requesting_user_id) {\n    return void cb('ERR_NOT_LOGGED_IN');\n  }\n  netSubs().getMyUserChannel().cmdParse(`${cmd} ${user_id}`, function (err: string, resp: FriendCmdResponse) {\n    if (err) {\n      return void cb(err);\n    } else if (requesting_user_id !== netSubs().loggedIn() || !friend_list) {\n      // Logged out or switched user meanwhile, so ignore the result\n      return void cb('Invalid data');\n    }\n\n    if (resp.friend) {\n      friend_list[user_id] = resp.friend;\n    } else {\n      delete friend_list[user_id];\n    }\n    cb(null, resp.msg);\n  });\n}\n\nexport function friendAdd(user_id: string, cb: ErrorCallback<string>): void {\n  makeFriendCmdRequest('friend_add', user_id, cb);\n}\nexport function friendRemove(user_id: string, cb: ErrorCallback<string>): void {\n  makeFriendCmdRequest('friend_remove', user_id, cb);\n}\nexport function friendBlock(user_id: string, cb: ErrorCallback<string>): void {\n  makeFriendCmdRequest('friend_block', user_id, cb);\n}\nexport function friendUnblock(user_id: string, cb: ErrorCallback<string>): void {\n  makeFriendCmdRequest('friend_unblock', user_id, cb);\n}\n\n// Pass-through commands\ncmd_parse.register({\n  cmd: 'friend_add',\n  help: 'Add a friend',\n  func: friendAdd,\n});\ncmd_parse.register({\n  cmd: 'friend_remove',\n  help: 'Remove a friend',\n  func: friendRemove,\n});\ncmd_parse.register({\n  cmd: 'friend_block',\n  help: 'Block someone from seeing your rich presence, also removes from your friends list',\n  func: friendBlock,\n});\ncmd_parse.register({\n  cmd: 'friend_unblock',\n  help: 'Reset a user to allow seeing your rich presence again',\n  func: friendUnblock,\n});\ncmd_parse.register({\n  cmd: 'friend_list',\n  help: 'List all friends',\n  func: function (str: string, resp_func: ErrorCallback<string>) {\n    if (!friend_list) {\n      return void resp_func('Friends list not loaded');\n    }\n    resp_func(null, Object.keys(friend_list).filter(isFriend).join(',') ||\n      'You have no friends');\n  },\n});\ncmd_parse.register({\n  cmd: 'friend_block_list',\n  help: 'List all blocked users',\n  func: function (str: string, resp_func: ErrorCallback<string>) {\n    if (!friend_list) {\n      return void resp_func('Friends list not loaded');\n    }\n    resp_func(null, Object.keys(friend_list).filter(friendIsBlocked).join(',') ||\n      'You have no blocked users');\n  },\n});\n\nlet invisible = 0;\ncmd_parse.registerValue('invisible', {\n  type: cmd_parse.TYPE_INT,\n  help: 'Hide rich presence information from other users',\n  label: 'Invisible',\n  range: [0,1],\n  get: () => invisible,\n  set: (v: number) => (invisible = v),\n});\n\nlet afk = 0;\ncmd_parse.registerValue('afk', {\n  type: cmd_parse.TYPE_INT,\n  help: 'Appear as idle to other users',\n  label: 'AFK',\n  range: [0,1],\n  get: () => afk,\n  set: (v: number) => (afk = v),\n});\n\nfunction onPresence(this: { presence_data?: ServerPresenceData }, data: ServerPresenceData): void {\n  let user_channel = this;\n  user_channel.presence_data = data;\n}\n\nlet last_presence: ClientPresenceData | null = null;\nlet send_queued = false;\nfunction richPresenceSend(): void {\n  if (!netSubs().loggedIn() || !last_presence || send_queued) {\n    return;\n  }\n  send_queued = true;\n  netSubs().onceConnected(() => {\n    send_queued = false;\n    if (!netSubs().loggedIn() || !last_presence) {\n      return;\n    }\n    let pak = netSubs().getMyUserChannel().pak('presence_set');\n    pak.writeInt(last_presence.active);\n    pak.writeAnsiString(last_presence.state);\n    pak.writeJSON(last_presence.payload);\n    pak.send();\n  });\n}\nexport function richPresenceSet(active: number, state: string, payload?: unknown): void {\n  active = !active || afk || (Date.now() - input.inputLastTime() > IDLE_TIME) ? PRESENCE_INACTIVE : PRESENCE_ACTIVE;\n  if (invisible) {\n    active = PRESENCE_OFFLINE;\n  }\n  payload = payload || null;\n  if (!last_presence ||\n    active !== last_presence.active || state !== last_presence.state ||\n    !deepEqual(last_presence.payload, payload)\n  ) {\n    last_presence = {\n      active,\n      state,\n      payload,\n    };\n    richPresenceSend();\n  }\n}\n\n/// Current user info by provider\nlet external_current_users: Record<string, ExternalUserInfo> = Object.create(null);\n/// Friends info by provider and user id\nlet external_friends: Record<string, Record<string, ExternalUserInfo>> = Object.create(null);\n\nexport function getExternalCurrentUserInfos(): Record<string, ExternalUserInfo> {\n  return external_current_users;\n}\n\nexport function getExternalFriendInfos(user_id: string): Record<string, ExternalUserInfo> | undefined {\n  return external_friends[user_id];\n}\n\nexport function getExternalUserInfos(user_id: string): Record<string, ExternalUserInfo> | undefined {\n  if (user_id === netSubs().loggedIn()) {\n    return getExternalCurrentUserInfos();\n  } else {\n    return getExternalFriendInfos(user_id);\n  }\n}\n\nfunction setExternalCurrentUser(provider: string, user_info: ExternalUserInfo): void {\n  if (user_info) {\n    external_current_users[provider] = user_info;\n  } else {\n    delete external_current_users[provider];\n  }\n}\n\nfunction updateExternalFriendsOnServer(provider: string, to_add: ExternalUserInfo[], to_remove: string[]): void {\n  if (to_add.length === 0 && to_remove.length === 0 || netDisconnected()) {\n    return;\n  }\n\n  let requesting_user_id = netSubs().loggedIn();\n  let pak = netSubs().getMyUserChannel().pak('friend_auto_update');\n  pak.writeAnsiString(provider);\n  for (let ii = 0; ii < to_add.length; ++ii) {\n    pak.writeAnsiString(to_add[ii].external_id);\n  }\n  pak.writeAnsiString('');\n  for (let ii = 0; ii < to_remove.length; ++ii) {\n    pak.writeAnsiString(to_remove[ii]);\n  }\n  pak.writeAnsiString('');\n  pak.send(function (err: string, resp: Record<string, FriendData>) {\n    if (requesting_user_id !== netSubs().loggedIn() || !friend_list) {\n      // Logged out or switched user meanwhile, so ignore the result\n      return;\n    } else if (err) {\n      // Unable to get external friends\n      return;\n    } else if (!resp) {\n      // Nothing to do\n      return;\n    }\n\n    // Add all new friends\n    let friends_external_to_user_ids: Record<string, string> = Object.create(null);\n    for (let user_id in resp) {\n      let friend = friend_list[user_id] = resp[user_id];\n      if (friend.ids) {\n        let external_id = friend.ids[provider];\n        friends_external_to_user_ids[external_id] = user_id;\n      }\n    }\n\n    // Map all the external friends by their corresponding user id\n    to_add.forEach((provider_friend) => {\n      let external_id = provider_friend.external_id;\n      let user_id = friends_external_to_user_ids[external_id];\n      if (user_id) {\n        let external_friend_infos = external_friends[user_id];\n        if (!external_friend_infos) {\n          external_friend_infos = external_friends[user_id] = Object.create(null);\n        }\n        external_friend_infos[provider] = provider_friend;\n      }\n    });\n  });\n}\n\nfunction setExternalFriends(provider: string, provider_friends: ExternalUserInfo[]): void {\n  let friends_external_to_user_ids: Record<string, string> = Object.create(null);\n  for (let user_id in friend_list) {\n    let friend = friend_list[user_id];\n    let external_id = friend.ids?.[provider];\n    if (external_id) {\n      friends_external_to_user_ids[external_id] = user_id;\n    }\n  }\n\n  // Delete all existing infos for this provider\n  for (let user_id in external_friends) {\n    delete external_friends[user_id][provider];\n  }\n\n  let to_add: ExternalUserInfo[] = [];\n  provider_friends.forEach((provider_friend) => {\n    let external_id = provider_friend.external_id;\n    let user_id = friends_external_to_user_ids[external_id];\n    if (user_id) {\n      let external_friend_infos = external_friends[user_id];\n      if (!external_friend_infos) {\n        external_friend_infos = external_friends[user_id] = Object.create(null);\n      }\n      external_friend_infos[provider] = provider_friend;\n      // Delete it, so that in the end the only ones left are the ones that need to be removed\n      delete friends_external_to_user_ids[external_id];\n    } else {\n      // New friend, needs to be added\n      to_add.push(provider_friend);\n    }\n  });\n\n  // The only ones left are the ones that need to be removed\n  let to_remove: string[] = [];\n  for (let external_id in friends_external_to_user_ids) {\n    to_remove.push(external_id);\n  }\n\n  if (to_add.length !== 0 || to_remove.length !== 0) {\n    updateExternalFriendsOnServer(provider, to_add, to_remove);\n  }\n}\n\nfunction requestExternalCurrentUser(provider: string,\n  request_func: (cb: ErrorCallback<ExternalUserInfo>) => void): void {\n  let requesting_user_id = netSubs().loggedIn();\n  request_func((err, user_info) => {\n    if (requesting_user_id !== netSubs().loggedIn()) {\n      // Logged out or switched user meanwhile, so ignore the result\n      return;\n    } else if (err || !user_info) {\n      // Unable to get external current user\n      return;\n    }\n\n    setExternalCurrentUser(provider, user_info);\n  });\n}\n\nfunction requestExternalFriends(provider: string,\n  request_func: (cb: ErrorCallback<ExternalUserInfo[]>) => void): void {\n  let requesting_user_id = netSubs().loggedIn();\n  request_func((err, friends) => {\n    if (requesting_user_id !== netSubs().loggedIn() || !friend_list) {\n      // Logged out or switched user meanwhile, so ignore the result\n      return;\n    } else if (err || !friends) {\n      // Unable to get external friends\n      return;\n    }\n\n    setExternalFriends(provider, friends);\n  });\n}\n\nexport type UserProfileImage = {\n  img: Sprite;\n  img_color?: Vec4;\n  frame?: number;\n};\nlet profile_images: Record<string, UserProfileImage> = {};\nlet default_profile_image: UserProfileImage;\nexport function getUserProfileImage(user_id: string): UserProfileImage {\n  let image = profile_images[user_id];\n  if (image) {\n    return image;\n  }\n\n  let url = null;\n  if (PLATFORM_FBINSTANT) {\n    url = getExternalUserInfos(user_id)?.[ID_PROVIDER_FB_INSTANT]?.profile_picture_url;\n  } else {\n    url = getExternalUserInfos(user_id)?.[ID_PROVIDER_FB_GAMING]?.profile_picture_url;\n  }\n\n  if (url) {\n    let tex = textures.load({\n      url: url,\n      filter_min: gl.LINEAR_MIPMAP_LINEAR,\n      filter_mag: gl.LINEAR,\n      soft_error: true,\n      auto_unload: () => delete profile_images[user_id],\n    });\n    if (tex && tex.loaded) {\n      image = profile_images[user_id] = {\n        img: spriteCreate({ tex }),\n      };\n      return image;\n    }\n  }\n\n  return default_profile_image;\n}\n\nexport function setDefaultUserProfileImage(image: UserProfileImage): void {\n  default_profile_image = image;\n}\n\nlet external_user_info_providers = Object.create(null);\nexport function registerExternalUserInfoProvider(\n  provider: string,\n  get_current_user: ((cb: ErrorCallback<ExternalUserInfo>) => void) | null,\n  get_friends: ((cb: ErrorCallback<ExternalUserInfo[]>) => void) | null,\n): void {\n  if (get_current_user || get_friends) {\n    assert(!friend_list);\n    assert(!netSubs()?.loggedIn());\n\n    external_user_info_providers[provider] = { get_current_user, get_friends };\n  } else {\n    delete external_user_info_providers[provider];\n  }\n}\n\n// Init\nexport function socialInit(): void {\n  netSubs().on('login', function () {\n    let user_channel = netSubs().getMyUserChannel();\n    let user_id = netSubs().loggedIn();\n    richPresenceSend();\n    friend_list = null;\n    if (netDisconnected()) {\n      return;\n    }\n    user_channel.pak('friend_list').send((err: unknown, resp: FriendsData) => {\n      if (err || user_id !== netSubs().loggedIn()) {\n        // disconnected, etc\n        return;\n      }\n      friend_list = resp;\n\n      // Sync friend list with external providers' friends\n      for (const provider in external_user_info_providers) {\n        let { get_current_user, get_friends } = external_user_info_providers[provider];\n        if (get_current_user) {\n          requestExternalCurrentUser(provider, get_current_user);\n        }\n        if (get_friends) {\n          requestExternalFriends(provider, get_friends);\n        }\n      }\n    });\n  });\n  netSubs().on('logout', function () {\n    friend_list = null;\n    external_current_users = Object.create(null);\n    external_friends = Object.create(null);\n  });\n\n  netSubs().onChannelMsg('user', 'presence', onPresence);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nexport const FADE_DEFAULT = 0;\nexport const FADE_OUT = 1;\nexport const FADE_IN = 2;\nexport const FADE = FADE_OUT + FADE_IN;\n\nimport assert from 'assert';\nimport { ErrorCallback } from 'glov/common/types';\nimport { callEach, defaults, ridx } from 'glov/common/util';\nimport { is_firefox } from './browser';\nimport { cmd_parse } from './cmds';\nimport { fbInstantOnPause } from './fbinstant';\nimport { filewatchOn } from './filewatch';\nimport * as urlhash from './urlhash';\n\nconst { Howl, Howler } = require('@jimbly/howler/src/howler.core.js');\n// TODO: Replace with \"import * as settings\" and replace settings.x with settings.get('x')\nconst settings = require('./settings');\nconst { abs, floor, max, min, random } = Math;\n\nconst DEFAULT_FADE_RATE = 0.001;\n\ninterface SoundLoadOpts {\n  streaming?: boolean;\n  for_reload?: boolean;\n  loop?: boolean;\n}\n\n// Workaround to have interface to Howl object available (alongside glov_load_opts).\ninterface HowlSound {\n  glov_load_opts: SoundLoadOpts;\n  play: (sprite?: string | number, volume?: number) => number;\n  stop: (id?: number) => HowlSound;\n  volume: (vol?: number, id?: number) => void;\n  seek: (seek?: number, id?: number) => HowlSound | number;\n  playing: (id?: number) => boolean;\n  duration: (id?: number) => number;\n}\n\n// Sound wrapper returned by soundPlay to external code\nexport interface GlovSoundSetUp {\n  name: string;\n  stop: (id: number) => HowlSound;\n  volume: (vol: number) => void;\n  playing: (id?: number) => boolean;\n  duration: (id?: number) => number;\n  location: () => number;\n  fade: (target_volume: number, time: number) => void;\n}\n\n// Placeholder to track reference to sound whenever it's played\nexport interface GlovSoundStreamedPlaceholder {\n  name: string;\n  is_placeholder: true;\n}\n\nexport type GlovSound = GlovSoundSetUp | GlovSoundStreamedPlaceholder;\n\nexport function isPlaceholderSound(sound: GlovSound): sound is GlovSoundStreamedPlaceholder {\n  return (sound as GlovSoundStreamedPlaceholder).is_placeholder;\n}\n\ninterface GlovMusic {\n  sound: HowlSound | null;\n  id: number;\n  current_volume: number;\n  target_volume: number;\n  sys_volume: number;\n  need_play: boolean;\n}\n\ninterface Fade {\n  sound: GlovSoundSetUp;\n  target_volume: number;\n  id: number;\n  time: number;\n  volume: number;\n  settingsVolume: () => number;\n}\n\nlet sounds : Record<string, HowlSound> = {};\nlet active_sfx_as_music: {\n  sound: GlovSoundSetUp;\n  play_volume: number;\n  set_volume_when_played: number;\n}[] = [];\nlet num_loading = 0;\n\n// Howler.usingWebAudio = false; // Disable WebAudio for testing HTML5 fallbacks\n\nconst default_params = {\n  // Note: as of Firefox v71 (2019), all major browsers support MP3\n  ext_list: ['mp3', 'wav'], // (recommended) try loading .mp3 versions first, then fallback to .wav\n  //  also covers all browsers: ['webm', 'mp3']\n  fade_rate: DEFAULT_FADE_RATE,\n};\nlet sound_params: {\n  ext_list: string[];\n  fade_rate: number;\n};\n\nlet last_played : Record<string, number> = {};\nlet frame_timestamp = 0;\nlet fades : Fade[] = [];\nlet music : GlovMusic[];\n\nexport function fadesCount(): number {\n  return fades.length;\n}\n\nlet volume_override = 1;\nlet volume_override_target = 1;\n\nsettings.register({\n  volume: {\n    default_value: 1,\n    type: cmd_parse.TYPE_FLOAT,\n    range: [0,1],\n  },\n});\n\nsettings.register({\n  volume_music: {\n    default_value: 1,\n    type: cmd_parse.TYPE_FLOAT,\n    range: [0,1],\n  },\n});\n\nsettings.register({\n  volume_sound: {\n    default_value: 1,\n    type: cmd_parse.TYPE_FLOAT,\n    range: [0,1],\n  },\n});\n\nfunction musicVolume(): number {\n  return settings.volume * settings.volume_music;\n}\n\nfunction soundVolume(): number {\n  return settings.volume * settings.volume_sound;\n}\n\nlet sounds_loading : Record<string, ErrorCallback<never, string>[]> = {};\nlet on_load_fail: (base: string) => void;\nexport function soundOnLoadFail(cb: (base: string) => void): void {\n  on_load_fail = cb;\n}\n\nexport type SoundID = string | { file: string; volume: number };\n\nexport function soundLoad(soundid: SoundID | SoundID[], opts?: SoundLoadOpts, cb?: ErrorCallback<never, string>): void {\n  opts = opts || {};\n  if (opts.streaming && is_firefox) {\n    // TODO: Figure out workaround and fix!\n    //   On slow connections, sounds set to streaming sometimes never load on Firefox,\n    //   possibly related to preload options or something ('preload=meta' not guaranteed to fire 'canplay')\n    opts.streaming = false;\n  }\n  const { streaming, loop } = opts;\n  if (Array.isArray(soundid)) {\n    assert(!cb);\n    for (let ii = 0; ii < soundid.length; ++ii) {\n      soundLoad(soundid[ii], opts);\n    }\n    return;\n  }\n  let key = typeof soundid === 'string' ? soundid : soundid.file;\n  if (sounds[key]) {\n    if (cb) {\n      cb();\n    }\n    return;\n  }\n  if (sounds_loading[key]) {\n    if (cb) {\n      sounds_loading[key].push(cb);\n    }\n    return;\n  }\n  let cbs : ErrorCallback<never, string>[] = [];\n  if (cb) {\n    cbs.push(cb);\n  }\n  sounds_loading[key] = cbs;\n  let soundname = key;\n  let m = soundname.match(/^(.*)\\.(mp3|ogg|wav|webm)$/u);\n  let preferred_ext;\n  if (m) {\n    soundname = m[1];\n    preferred_ext = m[2];\n  }\n  let src = `sounds/${soundname}`;\n  let srcs : string[] = [];\n  let suffix = '';\n  if (opts.for_reload) {\n    suffix = `?rl=${Date.now()}`;\n  }\n  if (preferred_ext) {\n    srcs.push(`${urlhash.getURLBase()}${src}.${preferred_ext}${suffix}`);\n  }\n  for (let ii = 0; ii < sound_params.ext_list.length; ++ii) {\n    let ext = sound_params.ext_list[ii];\n    if (ext !== preferred_ext) {\n      srcs.push(`${urlhash.getURLBase()}${src}.${ext}${suffix}`);\n    }\n  }\n  // Try loading desired sound types one at a time.\n  // Cannot rely on Howler's built-in support for this because it only continues\n  //   through the list on *some* load errors, not all :(.\n  function tryLoad(idx: number): void {\n    if (idx === srcs.length) {\n      console.error(`Error loading sound ${soundname}: All fallbacks exhausted, giving up`);\n      if (on_load_fail) {\n        on_load_fail(soundname);\n      }\n      callEach(cbs, delete sounds_loading[key], 'Error loading sound');\n      return;\n    }\n    if (!streaming) {\n      ++num_loading;\n    }\n    let once = false;\n    let sound = new Howl({\n      src: srcs.slice(idx),\n      html5: Boolean(streaming),\n      loop: Boolean(loop),\n      volume: 0,\n      onload: function () {\n        if (!once) {\n          if (!streaming) {\n            --num_loading;\n          }\n          once = true;\n          sound.glov_load_opts = opts;\n          sounds[key] = sound;\n          callEach(cbs, delete sounds_loading[key], null);\n        }\n      },\n      onloaderror: function (id: unknown, err: string, extra: unknown) {\n        if (idx === srcs.length - 1) {\n          console.error(`Error loading sound ${srcs[idx]}: ${err}`);\n        } else {\n          console.log(`Error loading sound ${srcs[idx]}: ${err}, trying fallback...`);\n        }\n        if (!once) {\n          if (!streaming) {\n            --num_loading;\n          }\n          once = true;\n          tryLoad(idx + 1);\n        }\n      },\n    });\n  }\n  tryLoad(0);\n}\n\nfunction soundReload(filename: string): void {\n  let name_match = filename.match(/^sounds\\/([^.]+)\\.\\w+$/);\n  let sound_name = name_match && name_match[1];\n  if (!sound_name) {\n    return;\n  }\n  if (!sounds[sound_name]) {\n    console.log(`Reload trigged for non-existent sound: ${filename}`);\n    return;\n  }\n  let opts = sounds[sound_name].glov_load_opts;\n  opts.for_reload = true;\n  delete sounds[sound_name];\n  soundLoad(sound_name, opts);\n}\n\nexport function soundPause(): void {\n  volume_override = volume_override_target = 0;\n  // Immediately mute all the music\n  // Can't do a nice fade out here because we stop getting ticked when we're not in the foreground\n  soundTick(0); // eslint-disable-line @typescript-eslint/no-use-before-define\n}\n\nexport function soundResume(): void {\n  volume_override_target = 1;\n\n  // Actual context resuming handled internally by Howler, except for gamepad\n  //   which calls soundResume, so let's poke howler to unlock.\n  Howler.manualUnlock();\n}\n\nexport function soundStartup(params: { ext_list?: string[]; fade_rate?: number }): void {\n  sound_params = defaults(params || {}, default_params);\n\n  // Music\n  music = []; // 0 is current, 1 is previous (fading out)\n  for (let ii = 0; ii < 2; ++ii) {\n    music.push({\n      sound: null,\n      id: 0,\n      current_volume: 0,\n      target_volume: 0,\n      sys_volume: 0,\n      need_play: false,\n    });\n  }\n  filewatchOn('.mp3', soundReload);\n  filewatchOn('.ogg', soundReload);\n  filewatchOn('.wav', soundReload);\n  filewatchOn('.webm', soundReload);\n\n  fbInstantOnPause(soundPause);\n}\n\nexport function soundResumed(): boolean {\n  return !Howler.noAudio && Howler.safeToPlay;\n}\n\nexport function soundTick(dt: number): void {\n  frame_timestamp += dt;\n  if (volume_override !== volume_override_target) {\n    let delta = dt * 0.004;\n    if (volume_override < volume_override_target) {\n      volume_override = min(volume_override + delta, volume_override_target);\n    } else {\n      volume_override = max(volume_override - delta, volume_override_target);\n    }\n  }\n  if (!soundResumed()) {\n    return;\n  }\n  for (let i = 0; i < active_sfx_as_music.length; ++i) {\n    let { sound, play_volume, set_volume_when_played } = active_sfx_as_music[i];\n    if (!sound.playing()) {\n      ridx(active_sfx_as_music, i);\n    } else if (set_volume_when_played !== musicVolume()) {\n      sound.volume(play_volume);\n      active_sfx_as_music[i].set_volume_when_played = musicVolume();\n    }\n  }\n  // Do music fading\n  // Cannot rely on Howler's fading because starting a fade when one is in progress\n  //   messes things up, as well causes snaps in volume :(\n  let max_fade = dt * sound_params.fade_rate;\n  for (let ii = 0; ii < music.length; ++ii) {\n    let mus = music[ii];\n    if (!mus.sound) {\n      continue;\n    }\n    let target = (settings.volume * settings.volume_music === 0) ? 0 : mus.target_volume;\n    if (mus.current_volume !== target) {\n      let delta = target - mus.current_volume;\n      let fade_amt = min(abs(delta), max_fade);\n      if (delta < 0) {\n        mus.current_volume = max(target, mus.current_volume - fade_amt);\n      } else {\n        mus.current_volume = min(target, mus.current_volume + fade_amt);\n      }\n      if (!mus.target_volume && !mus.current_volume) {\n        if (!mus.need_play) {\n          mus.sound.stop(mus.id);\n        }\n        mus.sound = null;\n      }\n    }\n    if (mus.sound) {\n      let sys_volume = mus.current_volume * musicVolume() * volume_override;\n      if (mus.need_play) {\n        mus.need_play= false;\n        mus.id = mus.sound.play();\n        mus.sys_volume = -1;\n      }\n      if (mus.sys_volume !== sys_volume) {\n        mus.sound.volume(sys_volume, mus.id);\n        mus.sys_volume = sys_volume;\n      }\n    }\n  }\n\n  for (let ii = fades.length - 1; ii >= 0; --ii) {\n    let fade = fades[ii];\n    let delta = fade.target_volume - fade.volume;\n    let fade_amt = min(abs(delta), fade.time ? dt / fade.time : max_fade);\n    if (delta < 0) {\n      fade.volume = max(fade.target_volume, fade.volume - fade_amt);\n    } else {\n      fade.volume = min(fade.target_volume, fade.volume + fade_amt);\n    }\n    fade.sound.volume(fade.volume);\n    if (fade.volume === fade.target_volume) {\n      ridx(fades, ii);\n      if (!fade.volume) {\n        fade.sound.stop(fade.id);\n      }\n    }\n  }\n}\n\nexport function soundPlay(soundid: SoundID, volume?: number, as_music?: boolean): GlovSoundSetUp | null {\n  volume = volume || 1;\n  if (settings.volume * (as_music ? settings.volume_music : settings.volume_sound) === 0) {\n    return null;\n  }\n  if (!soundResumed()) {\n    return null;\n  }\n  if (Array.isArray(soundid)) {\n    soundid = soundid[floor(random() * soundid.length)];\n  }\n  if (typeof soundid === 'object') {\n    volume *= (soundid.volume || 1);\n    soundid = soundid.file;\n  }\n  let sound = sounds[soundid];\n  if (!sound) {\n    return null;\n  }\n  let last_played_time = last_played[soundid] || -9e9;\n  if (frame_timestamp - last_played_time < 45) {\n    return null;\n  }\n  let settingsVolume = as_music ? musicVolume : soundVolume;\n  let id = sound.play(undefined, volume * settingsVolume() * volume_override);\n  // sound.volume(volume * settingsVolume() * volume_override, id);\n  last_played[soundid] = frame_timestamp;\n  let played_sound = {\n    name: soundid,\n    volume_current: volume,\n    stop: sound.stop.bind(sound, id),\n    playing: sound.playing.bind(sound, id), // not reliable if it hasn't started yet? :(\n    location: () => { // get current location\n      let v = sound.seek(id);\n      if (typeof v !== 'number') {\n        // Howler sometimes returns `self` from `seek()`\n        return 0;\n      }\n      return v;\n    },\n    duration: sound.duration.bind(sound, id),\n    volume: (vol: number) => {\n      played_sound.volume_current = vol;\n      sound.volume(vol * settingsVolume() * volume_override, id);\n    },\n    fade: (target_volume: number, time: number) => {\n      let new_fade = {\n        sound: played_sound,\n        volume: played_sound.volume_current,\n        target_volume,\n        id,\n        time,\n        settingsVolume,\n      };\n      for (let ii = 0; ii < fades.length; ++ii) {\n        if (fades[ii].id === id) {\n          fades[ii] = new_fade;\n          return;\n        }\n      }\n      fades.push(new_fade);\n    },\n  };\n  if (as_music) {\n    active_sfx_as_music.push({\n      sound: played_sound,\n      play_volume: volume,\n      set_volume_when_played: musicVolume(),\n    });\n  }\n  return played_sound;\n}\n\nexport function soundPlayStreaming(\n  soundname: string, volume: number, as_music: boolean, on_played_sound: (sound: GlovSoundSetUp | null) => void\n): GlovSound | null {\n  if (settings.volume * (as_music ? settings.volume_music : settings.volume_sound) === 0) {\n    return null;\n  }\n  if (Array.isArray(soundname)) {\n    soundname = soundname[floor(random() * soundname.length)];\n  }\n  let played_sound: GlovSound | null = { name: soundname, is_placeholder: true };\n  soundLoad(soundname, { streaming: true, loop: false }, (err) => {\n    if (!err) {\n      played_sound = soundPlay(soundname, volume, as_music);\n      if (on_played_sound) {\n        on_played_sound(played_sound);\n      }\n    }\n  });\n  return played_sound;\n}\n\nexport function soundPlayMusic(soundname: string, volume: number, transition: number): void {\n  if (settings.volume * settings.volume_music === 0) {\n    return;\n  }\n  if (volume === undefined) {\n    volume = 1;\n  }\n  transition = transition || FADE_DEFAULT;\n  soundLoad(soundname, { streaming: true, loop: true }, (err) => {\n    assert(!err);\n    let sound = sounds[soundname];\n    assert(sound);\n    if (music[0].sound === sound) {\n      // Same sound, just adjust volume, if required\n      music[0].target_volume = volume;\n      if (!transition) {\n        if (!volume) {\n          sound.stop(music[0].id);\n          music[0].sound = null;\n        } else {\n          let sys_volume = music[0].sys_volume = volume * musicVolume() * volume_override;\n          sound.volume(sys_volume, music[0].id);\n          if (!sound.playing()) {\n            sound.play(undefined, sys_volume);\n          }\n        }\n      }\n      return;\n    }\n    // fade out previous music, if any\n    if (music[0].current_volume) {\n      if (transition & FADE_OUT) {\n        // swap to position 1, start fadeout\n        let temp = music[1];\n        music[1] = music[0];\n        music[0] = temp;\n        music[1].target_volume = 0;\n      }\n    }\n    if (music[0].sound) {\n      music[0].sound.stop(music[0].id);\n    }\n    music[0].sound = sound;\n    music[0].target_volume = volume;\n    let start_vol = (transition & FADE_IN) ? 0 : volume;\n    music[0].current_volume = start_vol;\n    if (soundResumed()) {\n      let sys_volume = start_vol * musicVolume() * volume_override;\n      music[0].id = sound.play(undefined, sys_volume);\n      // sound.volume(sys_volume, music[0].id);\n      music[0].sys_volume = sys_volume;\n      music[0].need_play = false;\n    } else {\n      music[0].need_play = true;\n    }\n  });\n}\n\nexport function soundLoading(): number {\n  return num_loading;\n}\n","// eslint-disable-next-line import/order\nimport {\n  BUTTON_ANY,\n  ButtonIndex,\n} from './input_constants';\n\nexport const SPOT_NAV_NONE = 0;\nexport const SPOT_NAV_LEFT = 1;\nexport const SPOT_NAV_UP = 2;\nexport const SPOT_NAV_RIGHT = 3;\nexport const SPOT_NAV_DOWN = 4;\nexport const SPOT_NAV_NEXT = 5;\nexport const SPOT_NAV_PREV = 6;\nconst SPOT_NAV_MAX = 7;\n\ntype SpotNavEnum = typeof SPOT_NAV_LEFT |\n  typeof SPOT_NAV_UP |\n  typeof SPOT_NAV_RIGHT |\n  typeof SPOT_NAV_DOWN |\n  typeof SPOT_NAV_NEXT |\n  typeof SPOT_NAV_PREV;\ntype SpotNavEnumOrNone = SpotNavEnum | typeof SPOT_NAV_NONE;\n\nexport const SPOT_STATE_REGULAR = 1;\nexport const SPOT_STATE_DOWN = 2;\nexport const SPOT_STATE_FOCUSED = 3;\nexport const SPOT_STATE_DISABLED = 4;\nexport type SpotStateEnum = typeof SPOT_STATE_REGULAR |\n  typeof SPOT_STATE_DOWN |\n  typeof SPOT_STATE_FOCUSED |\n  typeof SPOT_STATE_DISABLED;\n\n\ntype SpotCustomNavTarget = null | // indicates the spot should do no navigation, but allow the caller to handle\n  undefined | // indicates navigation should target nothing (keys not consumed)\n  string; // the key of a custom element\n\ntype SpotCustomNav = Partial<Record<SpotNavEnum, SpotCustomNavTarget>>;\n\n\n// See SPOT_DEFAULT for defaults\nexport interface SpotParamBase {\n  key?: string; // defaults to from x,y otherwise\n  disabled: boolean;\n  in_event_cb: EventCallback | null; // for clicks and key presses\n  drag_target: boolean; // receive dragDrop events\n  drag_over: boolean; // consume dragOver events\n  button: ButtonIndex; // respond to which mouse button\n  is_button: boolean; // can be activated/clicked/etc\n  button_long_press: boolean; // detect long press differently than a regular click/tap\n  pad_focusable: boolean; // is a target for keyboard/gamepad focus; set to false if only accessible via hotkey/button\n  spatial_focus: boolean; // if pad_focusable: can be focused spatialy (via d-pad/etc), otherwise only through tab\n  auto_focus: boolean; // if this spot is new this frame, and doing pad (not mouse/touch) focusing, automatically focus\n  long_press_focuses: boolean; // a long press will focus an element (triggering tooltips, etc, on touch devices)\n  sound_button: string | null; // when activated\n  sound_rollover: string | null; // when mouse movement triggers focus\n  touch_focuses: boolean; // first touch focuses (on touch devices), showing tooltip, etc, second activates the button\n  disabled_focusable: boolean; // allow focusing even if disabled (e.g. to show tooltip)\n  hotkey: number | null; // optional keyboard hotkey\n  hotpad: number | null; // optional gamepad button\n  // (silently) ensures we have the focus this frame (e.g. if dragging a slider, the slider\n  // should retain focus even without mouseover)\n  focus_steal: boolean;\n  sticky_focus: boolean; // focus is not lost due to mouseover elsewhere\n  // optional map of SPOT_NAV_* to either:\n  //   null: indicates the spot should not do navigation, but allow the caller to handle (sets param.out.nav)\n  //   undefined: indicates navigation should target nothing (and those keys will not be consumed)\n  //   a string key: a custom element to target with navigation\n  custom_nav: SpotCustomNav | null;\n}\n\nexport const SPOT_DEFAULT = {\n  key: undefined, // defaults to from x,y\n  disabled: false,\n  in_event_cb: null,\n  drag_target: false,\n  drag_over: false,\n  button: BUTTON_ANY,\n  is_button: false,\n  button_long_press: false,\n  pad_focusable: true,\n  spatial_focus: true,\n  auto_focus: false,\n  long_press_focuses: true,\n  sound_button: 'button_click',\n  sound_rollover: 'rollover',\n  touch_focuses: false,\n  disabled_focusable: true,\n  hotkey: null,\n  hotpad: null,\n  focus_steal: false,\n  sticky_focus: false,\n  custom_nav: null,\n};\n\nexport const SPOT_DEFAULT_BUTTON: SpotParamBase = {\n  ...SPOT_DEFAULT,\n  is_button: true,\n};\n\nexport const SPOT_DEFAULT_BUTTON_DISABLED: SpotParamBase = {\n  ...SPOT_DEFAULT,\n  disabled: true,\n  sound_rollover: null,\n};\n\nexport const SPOT_DEFAULT_BUTTON_DRAW_ONLY: SpotParamBase = {\n  // Matches previous { draw_only: true, draw_only_mouseover: true, disabled_mouseover: true } option to ui.buttonShared\n  ...SPOT_DEFAULT,\n  pad_focusable: false,\n};\n\nexport const SPOT_DEFAULT_LABEL: SpotParamBase = {\n  ...SPOT_DEFAULT,\n  sound_rollover: null,\n  touch_focuses: true, // usually want this?\n};\n\ntype SpotKeyableKeyed = {\n  key: string;\n};\ntype SpotKeyableAuto = Point2D;\n\nexport type SpotKeyable = (SpotKeyableKeyed | SpotKeyableAuto) & {\n  // computed\n  key_computed?: string;\n};\n\ntype SpotRet = {\n  focused: boolean; // focused by any means\n  kb_focused: boolean; // focused for the purpose of receiving keyboard input (focused and no other sticky focus)\n  spot_state: SpotStateEnum;\n  ret: number; // if `param.is_button` and was activated (0/1 or more if clicked multiple times in a frame)\n  long_press?: boolean; // if button_long_press and ret and was a long press, set to true\n  button?: number; // if ret, set to mouse button used to click it\n  pos?: Vec2 | null | undefined; // if ret, set to position of the click\n  double_click?: boolean; // if ret, set to true if it was a double click/tap/button press/etc\n  drag_drop?: unknown | null; // if drag_target and a drop happened, contains dragDrop event { drag_payload }\n  nav?: SpotNavEnumOrNone; // if custom_nav, and the user navigated, set to the navigation event\n  allow_focus?: boolean; // set and used internally if this spot is allowed to be focused\n};\n\ntype SpotComputedFields = {\n  // internal run-time fields that might be useful to callers\n  key_computed?: string;\n  dom_pos?: Box;\n  out?: SpotRet;\n};\n\nexport interface SpotParam extends Partial<SpotParamBase>, Box, SpotComputedFields {\n  def: SpotParamBase; // inherit all undefined SpotParamBase members from this\n  tooltip?: TooltipValue | null;\n  hook?: string;\n}\n\nexport interface SpotSubParam extends Box, SpotComputedFields {\n  key: string;\n}\n\ninterface SpotInternal extends SpotParam {\n  // internal run-time fields\n  dom_pos: Box;\n  key_computed: string;\n  sub_rect: SpotSubInternal | null;\n  out: SpotRet;\n\n  // only on fake Spots from spotMouseoverHook\n  only_mouseover?: true;\n  spot_debug_ignore?: boolean;\n}\n\ninterface SpotSubInternal extends SpotSubParam {\n  // internal run-time fields\n  dom_pos: Box;\n  key_computed: string;\n  sub_rect: SpotSubInternal | null;\n\n  is_sub_rect: true;\n  is_empty_sub_rect: boolean;\n}\n\ntype SpotListElem = SpotInternal | SpotSubInternal;\n\n// TODO: move to input.js when converted to TypeScript\ntype MouseOverParam = {\n  peek?: boolean;\n  eat_clicks?: boolean;\n  spot_debug_ignore?: boolean;\n};\n\nimport assert from 'assert';\nconst { abs, max } = Math;\nimport verify from 'glov/common/verify';\nimport { Vec2, Vec4 } from 'glov/common/vmath.js';\nimport * as camera2d from './camera2d.js';\nimport * as engine from './engine.js';\nimport {\n  FontStyle,\n  fontStyle,\n} from './font.js';\nimport { Box, Point2D } from './geom_types';\nimport {\n  KEYS,\n  PAD,\n  dragDrop,\n  dragOver,\n  inputClick,\n  inputEatenMouse,\n  inputTouchMode,\n  keyDown,\n  keyDownEdge,\n  longPress,\n  mouseButtonHadEdge,\n  mouseDomPos,\n  mouseDownAnywhere,\n  mouseDownEdge,\n  mouseDownMidClick,\n  mouseMoved,\n  mouseOver,\n  mousePosIsTouch,\n  padButtonDownEdge,\n} from './input.js';\nimport * as settings from './settings.js';\nimport * as ui from './ui.js';\nimport {\n  EventCallback,\n  TooltipBoxParam,\n  TooltipValue,\n  drawLine,\n  drawRect,\n  drawTooltipBox,\n  playUISound,\n} from './ui.js';\nconst { checkHooks } = ui.internal;\n\nlet focus_sub_rect = null as (SpotSubInternal | null);\nlet focus_sub_rect_elem = null as (SpotInternal | null);\nlet sub_stack: [typeof focus_sub_rect, typeof focus_sub_rect_elem][] = [];\nlet focus_key: string | null = null;\n// sticky focus: used for edit boxes so that they do not lose focus even when\n//   mousing over other elements (those elements become the temporary `nonsticky`\n//   focus.\nlet focus_is_sticky = false;\nlet focus_key_nonsticky: string | null = null;\nlet focus_pos: Box = { x: 0, y: 0, w: 0, h: 0 };\nlet last_frame_spots: SpotListElem[] = [];\nlet frame_spots: SpotListElem[] = [];\nlet focus_next: (SpotInternal|null|undefined)[] = []; // indexed by SPOT_NAV_*\nlet focus_next_via: (SpotSubInternal|undefined)[] = []; // just for spotDebug\nlet frame_autofocus_spots: Partial<Record<string, SpotInternal>> = {};\nlet last_frame_autofocus_spots: typeof frame_autofocus_spots = {};\n// pad_mode: really \"non-mouse-mode\" - touch triggers this in various situations\n// non-pad_mode (mouse mode) requires constant mouse over state to maintain focus\nlet pad_mode = false;\nlet suppress_pad = false;\nlet async_activate_key: string | null = null;\n\nfunction isSubRect(area: SpotListElem): area is SpotSubInternal {\n  return (area as SpotSubInternal).is_sub_rect;\n}\n\nexport function spotPadMode(): boolean {\n  return pad_mode;\n}\n\nexport function spotSetPadMode(new_mode: boolean): void {\n  pad_mode = new_mode;\n}\n\nexport function spotlog(...args: unknown[]): void {\n  // const { getFrameIndex } = require('./engine.js'); // eslint-disable-line global-require\n  // console.log(`spotlog(${getFrameIndex()}): `, ...args);\n}\n\nexport function spotGet(key: string, last_frame: boolean): SpotListElem | null {\n  let frames = last_frame ? last_frame_spots : frame_spots;\n  let key_computed_spot = null;\n  // Match first by key, and afterwards by key_computed\n  for (let ii = 0; ii < frames.length; ++ii) {\n    if (key === frames[ii].key) {\n      return frames[ii];\n    }\n    if (key === frames[ii].key_computed) {\n      key_computed_spot = frames[ii];\n    }\n  }\n  return key_computed_spot;\n}\n\nexport function spotKey(param: SpotKeyable): string {\n  if (param.key_computed) {\n    // already computed, early this frame, or in a persistent object, use it\n    if (!engine.defines.SPOT_DEBUG) {\n      return param.key_computed;\n    }\n  }\n  profilerStartFunc();\n  let key = (param as SpotKeyableKeyed).key ||\n    (`${focus_sub_rect ? focus_sub_rect.key_computed : ''}_` +\n    `${(param as SpotKeyableAuto).x}_${(param as SpotKeyableAuto).y}`);\n  if (param.key_computed) {\n    // ensure two different spots on the same frame are not using the same param object\n    assert.equal(param.key_computed, key);\n  } else {\n    param.key_computed = key;\n  }\n  profilerStopFunc();\n  return param.key_computed;\n}\n\nfunction spotFocusSet(param: SpotInternal, from_mouseover: boolean, force: boolean, log: string): boolean {\n  if (from_mouseover && (!mouseMoved() || mousePosIsTouch())) {\n    return false;\n  }\n  const def = param.def || SPOT_DEFAULT;\n  const sound_rollover = param.sound_rollover === undefined ? def.sound_rollover : param.sound_rollover;\n  const key = param.key_computed || spotKey(param);\n  const use_nonsticky = focus_is_sticky && !force && from_mouseover && key !== focus_key;\n  const key_prev = use_nonsticky ? focus_key_nonsticky : focus_key;\n  if ((sound_rollover || !from_mouseover) && key_prev !== key) {\n    playUISound(sound_rollover || SPOT_DEFAULT.sound_rollover);\n  }\n  if (key_prev !== key || pad_mode !== !from_mouseover) {\n    spotlog('spotFocusSet', key, log, from_mouseover ? '' : 'pad_mode', use_nonsticky ? 'nonsticky' : '');\n  }\n  pad_mode = !from_mouseover;\n  if (use_nonsticky) {\n    focus_key_nonsticky = key;\n  } else {\n    focus_key = key;\n    const sticky_focus = param.sticky_focus === undefined ? def.sticky_focus : param.sticky_focus;\n    focus_is_sticky = sticky_focus;\n    focus_key_nonsticky = null;\n  }\n  assert(param.dom_pos);\n  return true;\n}\n\nexport function spotUnfocus(): void {\n  spotlog('spotUnfocus');\n  focus_key = null;\n  focus_is_sticky = false;\n  focus_key_nonsticky = null;\n  pad_mode = false;\n}\n\n\nconst TARGET_QUAD = 0;\nconst TARGET_HALF = 1;\nconst TARGET_ALL = 2;\ntype TargetTypeEnum = typeof TARGET_QUAD | typeof TARGET_HALF | typeof TARGET_ALL;\n\nfunction findBestTargetInternal(\n  nav: SpotNavEnum,\n  dom_pos: Box,\n  targets: SpotListElem[],\n  precision: TargetTypeEnum,\n  filter: (param: SpotListElem) => boolean\n): SpotListElem | null {\n  let start_w2 = dom_pos.w/2;\n  let start_h2 = dom_pos.h/2;\n  let start_x = dom_pos.x + start_w2;\n  let start_y = dom_pos.y + start_h2;\n  let start_left = dom_pos.x;\n  let start_right = dom_pos.x + dom_pos.w;\n  let start_top = dom_pos.y;\n  let start_bottom = dom_pos.y + dom_pos.h;\n  let best = null;\n  let bestd;\n  for (let ii = 0; ii < targets.length; ++ii) {\n    let param = targets[ii];\n    if (!filter(param)) {\n      continue;\n    }\n    let target = param.dom_pos;\n    let d;\n    if (precision === TARGET_QUAD) {\n      let quadrant;\n      // edge facing quadrant calc: to be to the \"left\" our right edge must be\n      //   in the quadrant formed by the 2 45-degree lines passing through the\n      //   left 2 points of the start rect.\n      // In this case, for `d`, use the Manhattan distance from the center of\n      //   the start edge to the nearest point in the target, this will favor\n      //   those that are nearby and aligned without skipping past a large, wide\n      //   button in favor of a small (closer) button on the other side of it.\n      let target_right = target.x + target.w;\n      let target_bottom = target.y + target.h;\n      let left_dx = start_left - target_right;\n      let right_dx = target.x - start_right;\n      let top_dy = start_top - target_bottom;\n      let bottom_dy = target.y - start_bottom;\n      if (left_dx >= -start_w2 && target_bottom > start_top - left_dx && target.y < start_bottom + left_dx) {\n        quadrant = SPOT_NAV_LEFT;\n        d = left_dx + max(target.y - start_y, start_y - target_bottom, 0);\n      } else if (right_dx >= -start_w2 && target_bottom > start_top - right_dx && target.y < start_bottom + right_dx) {\n        quadrant = SPOT_NAV_RIGHT;\n        d = right_dx + max(target.y - start_y, start_y - target_bottom, 0);\n      } else if (top_dy >= -start_h2 && target_right >= start_left - top_dy && target.x <= start_right + top_dy) {\n        quadrant = SPOT_NAV_UP;\n        d = top_dy + max(target.x - start_x, start_x - target_right, 0);\n      } else if (bottom_dy >= -start_h2 && target_right >= start_left - bottom_dy &&\n        target.x <= start_right + bottom_dy\n      ) {\n        quadrant = SPOT_NAV_DOWN;\n        d = bottom_dy + max(target.x - start_x, start_x - target_right, 0);\n      }\n\n      if (quadrant === undefined) {\n        // smart logic didn't work, perhaps heavily overlapping, instead use\n        // simple center-point quadrant calc:\n        let x = target.x + target.w/2;\n        let y = target.y + target.h/2;\n        let dx = x - start_x;\n        let dy = y - start_y;\n        d = abs(dx) + abs(dy);\n        if (abs(dx) > abs(dy)) {\n          if (dx > 0) {\n            quadrant = SPOT_NAV_RIGHT;\n          } else {\n            quadrant = SPOT_NAV_LEFT;\n          }\n        } else {\n          if (dy > 0) {\n            quadrant = SPOT_NAV_DOWN;\n          } else {\n            quadrant = SPOT_NAV_UP;\n          }\n        }\n      }\n      if (quadrant !== nav) {\n        continue;\n      }\n    } else {\n      let x = target.x + target.w/2;\n      let y = target.y + target.h/2;\n      let dx = x - start_x;\n      let dy = y - start_y;\n      d = abs(dx) + abs(dy);\n      if (precision === TARGET_HALF) {\n        if (dx <= 0 && nav === SPOT_NAV_RIGHT ||\n          dx >= 0 && nav === SPOT_NAV_LEFT ||\n          dy <= 0 && nav === SPOT_NAV_DOWN ||\n          dy >= 0 && nav === SPOT_NAV_UP\n        ) {\n          continue;\n        }\n      } else {\n        // allow any, just find closest\n      }\n    }\n    if (!best || (d as number) < (bestd as number)) {\n      best = param;\n      bestd = d;\n    }\n  }\n  return best;\n}\n\nconst EPSILON = 0.00001;\nlet debug_style: FontStyle;\nfunction spotDebugList(show_all: boolean, list: SpotListElem[]): void {\n  if (!debug_style) {\n    debug_style = fontStyle(null, {\n      color: 0x000000ff,\n      outline_color: 0xFFFFFFcc,\n      outline_width: 2,\n    });\n  }\n  for (let ii = 0; ii < list.length; ++ii) {\n    let area = list[ii];\n    let pos = area.dom_pos;\n    let color: Vec4 | undefined;\n    if (isSubRect(area)) {\n      if (show_all) {\n        ui.font.drawSizedAligned(debug_style, pos.x, pos.y, Z.DEBUG, 8,\n          ui.font.ALIGN.HVCENTERFIT, pos.w, pos.h, area.key_computed || 'unknown');\n      }\n      continue;\n    }\n    if (area.spot_debug_ignore) {\n      continue;\n    }\n    if (area.only_mouseover) {\n      color = [1,0.5,0, 0.5];\n    } else {\n      const def = area.def || SPOT_DEFAULT;\n      const pad_focusable = area.pad_focusable === undefined ? def.pad_focusable : area.pad_focusable;\n      if (!pad_focusable) {\n        continue;\n      }\n      const spatial_focus = area.spatial_focus === undefined ? def.spatial_focus : area.spatial_focus;\n      if (!spatial_focus) {\n        continue;\n      }\n      for (let jj = 0; jj < list.length; ++jj) {\n        if (ii === jj) {\n          continue;\n        }\n        let other = list[jj];\n        if (isSubRect(other)) {\n          continue;\n        }\n        if (other.sub_rect !== area.sub_rect) {\n          continue;\n        }\n        const other_def = other.def || SPOT_DEFAULT;\n        const other_pad_focusable = other.pad_focusable === undefined ? other_def.pad_focusable : other.pad_focusable;\n        if (other.only_mouseover || !other_pad_focusable) {\n          continue;\n        }\n        const other_spatial_focus = other.spatial_focus === undefined ? other_def.spatial_focus : other.spatial_focus;\n        if (!other_spatial_focus) {\n          continue;\n        }\n        let other_pos = other.dom_pos;\n        if (pos.x < other_pos.x + other_pos.w - EPSILON && pos.x + pos.w > other_pos.x + EPSILON &&\n          pos.y < other_pos.y + other_pos.h - EPSILON && pos.y + pos.h > other_pos.y + EPSILON\n        ) {\n          color = [1,0,0, 0.5];\n        }\n      }\n    }\n    if (!show_all && !color) {\n      continue;\n    }\n    drawRect(pos.x, pos.y, pos.x + pos.w, pos.y + pos.h, Z.DEBUG, color || [1,1,0, 0.5]);\n    ui.font.drawSizedAligned(debug_style, pos.x, pos.y, Z.DEBUG, 8,\n      ui.font.ALIGN.HVCENTERFIT, pos.w, pos.h, area.key_computed || 'unknown');\n  }\n}\nfunction spotDebug(): void {\n  camera2d.push();\n  camera2d.setDOMMapped();\n  let show_all = keyDown(KEYS.SHIFT);\n  spotDebugList(show_all, frame_spots);\n\n  if (pad_mode || show_all) {\n    for (let ii = SPOT_NAV_LEFT; ii <= SPOT_NAV_DOWN; ++ii) {\n      let next_spot = focus_next[ii];\n      if (next_spot) {\n        let pos = focus_pos;\n        let next = next_spot.dom_pos;\n        let via = focus_next_via[ii];\n        if (via) {\n          pos = via.dom_pos;\n          drawLine(pos.x + pos.w/2, pos.y + pos.h/2, next.x + next.w/2, next.y+next.h/2,\n            Z.DEBUG, 1, 0.95, [1, 0.5, 0, 1]);\n          pos = focus_pos;\n          next = via.dom_pos;\n        }\n        drawLine(pos.x + pos.w/2, pos.y + pos.h/2, next.x + next.w/2, next.y+next.h/2,\n          Z.DEBUG, 1, 0.95, [1, 1, 0, 1]);\n      }\n    }\n  }\n\n  camera2d.pop();\n}\n\nlet filter_sub_rect: SpotSubInternal | null;\nlet filter_not: SpotListElem | null;\nfunction filterMatchesSubrect(param: SpotListElem): boolean {\n  return param !== filter_not && param.sub_rect === filter_sub_rect;\n}\n\nfunction overlaps(r1: Box, r2: Box): boolean {\n  return r1.x + r1.w > r2.x && r1.x < r2.x + r2.w &&\n    r1.y + r1.h > r2.y && r1.y < r2.y + r2.h;\n}\nfunction contains(outer: Box, inner: Box): boolean {\n  return inner.x >= outer.x && inner.x + inner.w <= outer.x + outer.w &&\n    inner.y >= outer.y && inner.y + inner.h <= outer.y + outer.h;\n}\n\nfunction filterInSubrectView(param: SpotListElem): boolean {\n  if (param.sub_rect !== filter_sub_rect) {\n    return false;\n  }\n  return overlaps(param.dom_pos, (filter_sub_rect as SpotSubInternal).dom_pos);\n}\n\nfunction filterMatchesSubrectOrInVisibleChild(param: SpotListElem): boolean {\n  if (param === filter_not) {\n    return false;\n  }\n  if (param.sub_rect === filter_sub_rect) {\n    return true;\n  }\n  if (param.sub_rect && param.sub_rect.sub_rect === filter_sub_rect) {\n    // in immediate child\n    return overlaps(param.dom_pos, param.sub_rect.dom_pos);\n  }\n  return false;\n}\n\nconst SUBRECT_FILTERS = [filterInSubrectView, filterMatchesSubrect];\nfunction findBestWithinSubrect(\n  nav: SpotNavEnum,\n  dom_pos: Box,\n  pad_focusable_list: SpotListElem[],\n  best: SpotSubInternal,\n  precision_max: TargetTypeEnum,\n): SpotInternal | null {\n  // we hit a sub rect, find the best target inside it, first trying all\n  //   in view (all precision), then all out of view\n  filter_sub_rect = best;\n  for (let jj = 0; jj < SUBRECT_FILTERS.length; ++jj) {\n    let filter = SUBRECT_FILTERS[jj];\n    for (let precision = 0 as TargetTypeEnum; precision <= precision_max; ++precision) {\n      let best_inside = findBestTargetInternal(nav, dom_pos, pad_focusable_list, precision, filter);\n      if (best_inside) {\n        assert(!isSubRect(best_inside));\n        return best_inside;\n      }\n    }\n  }\n  return null;\n}\n\nfunction findBestTargetFromSubRect(\n  start_sub_rect: SpotSubInternal | null,\n  nav: SpotNavEnum,\n  dom_pos: Box,\n  pad_focusable_list: SpotListElem[],\n  precision: TargetTypeEnum,\n): SpotInternal | null {\n  // Go to the one in the appropriate quadrant which has the smallest Manhattan distance\n  filter_sub_rect = start_sub_rect;\n  let best = findBestTargetInternal(nav, dom_pos, pad_focusable_list, precision, filterMatchesSubrectOrInVisibleChild);\n  if (best) {\n    if (isSubRect(best)) {\n      focus_next_via[nav] = best;\n      best = findBestWithinSubrect(nav, dom_pos, pad_focusable_list, best, precision);\n      if (!best) {\n        focus_next_via[nav] = undefined;\n      }\n    }\n  }\n  return best;\n}\n\nfunction spotCalcNavTargets(): void {\n  // Computes, for each direction, where we would target from the current focus\n  //   state, to be used next frame if a focus key is pressed.\n  // Note: cannot compute this trivially only upon keypress since we do not know\n  //   which keys to check until we reached a focused / focusable element.  We\n  //   could, however, instead, do this at the beginning of the frame only if\n  //   we peek at the key/pad state and see that it *might be* pressed this\n  //   frame.\n  for (let ii = 1; ii < SPOT_NAV_MAX; ++ii) {\n    focus_next[ii] = undefined;\n    focus_next_via[ii] = undefined;\n  }\n  // First, find current focused element (if any) and gather the list of potentially\n  //  focusable elements, computing where \"prev\" and \"next should go (based on\n  //  the in-frame order).\n  let start;\n  let pad_focusable_list = [];\n  let prev;\n  let first_non_sub_rect;\n  for (let ii = 0; ii < frame_spots.length; ++ii) {\n    let param = frame_spots[ii];\n    if (isSubRect(param)) {\n      // Not actually \"focusable\", but need to target it to then target its contents\n      if (!param.is_empty_sub_rect) {\n        pad_focusable_list.push(param);\n      }\n    } else if (param.key_computed === focus_key) {\n      if (!focus_next[SPOT_NAV_PREV] && prev) {\n        focus_next[SPOT_NAV_PREV] = prev;\n      }\n      start = param;\n    } else {\n      const def = param.def || SPOT_DEFAULT;\n      const pad_focusable = param.pad_focusable === undefined ? def.pad_focusable : param.pad_focusable;\n      if (pad_focusable) {\n        if (!first_non_sub_rect) {\n          first_non_sub_rect = param;\n        }\n        prev = param;\n        if (!focus_next[SPOT_NAV_NEXT] && start) {\n          focus_next[SPOT_NAV_NEXT] = param;\n        }\n        const spatial_focus = param.spatial_focus === undefined ? def.spatial_focus : param.spatial_focus;\n        if (spatial_focus) {\n          pad_focusable_list.push(param);\n        }\n      }\n    }\n  }\n  if (!focus_next[SPOT_NAV_PREV] && prev) {\n    // but, didn't trigger above, must have been first, wrap to end\n    focus_next[SPOT_NAV_PREV] = prev;\n  }\n  if (!focus_next[SPOT_NAV_NEXT]) {\n    // nothing next, go to first non-sub_rect\n    focus_next[SPOT_NAV_NEXT] = first_non_sub_rect;\n  }\n  let precision_max;\n  let start_sub_rect: SpotSubInternal | null;\n  if (start) {\n    start_sub_rect = start.sub_rect;\n    focus_pos.x = start.dom_pos.x;\n    focus_pos.y = start.dom_pos.y;\n    focus_pos.w = start.dom_pos.w;\n    focus_pos.h = start.dom_pos.h;\n    precision_max = TARGET_HALF;\n  } else {\n    // use the subrect overlapped, if any\n    start_sub_rect = null;\n    for (let ii = 0; ii < frame_spots.length; ++ii) {\n      let param = frame_spots[ii];\n      if (isSubRect(param)) {\n        if (contains(param.dom_pos, focus_pos)) {\n          start_sub_rect = param;\n        }\n      }\n    }\n    if (start_sub_rect) {\n      precision_max = TARGET_HALF;\n    } else {\n      precision_max = TARGET_ALL;\n    }\n  }\n\n  // Second, using the currently focused rect as a starting point, find\n  //   appropriate elements to focus in each of the cardinal directions.\n  for (let nav = 1 as SpotNavEnum; nav <= SPOT_NAV_DOWN; ++nav) {\n    for (let precision = 0 as TargetTypeEnum; precision <= precision_max; ++precision) {\n      filter_not = null;\n      let best = findBestTargetFromSubRect(start_sub_rect, nav, focus_pos, pad_focusable_list, precision);\n      if (best) {\n        focus_next[nav] = best;\n        break;\n      }\n      if (start_sub_rect) {\n        // Did not find anything within our subrect, try searching outside, from the subrect itself\n        filter_not = start_sub_rect; // do not target oneself\n        best = findBestTargetFromSubRect(start_sub_rect.sub_rect, nav, focus_pos,\n          pad_focusable_list, precision);\n        if (best) {\n          focus_next[nav] = best;\n          break;\n        }\n      }\n    }\n  }\n\n  // Finally, apply any custom navigation instructions (keys which should not change\n  //   focus or which target a particular other element by key) based on the currently\n  //   focused element.\n  if (start) {\n    const def = start.def || SPOT_DEFAULT;\n    const custom_nav = start.custom_nav === undefined ? def.custom_nav : start.custom_nav;\n    if (custom_nav) {\n      let by_key: Partial<Record<string,SpotInternal>> | undefined;\n      for (let key_string in custom_nav) {\n        let key = Number(key_string) as SpotNavEnum;\n        let target = custom_nav[key];\n        if (target === null || target === undefined) {\n          focus_next[key] = target;\n        } else {\n          if (!by_key) {\n            by_key = {};\n            for (let ii = 0; ii < frame_spots.length; ++ii) {\n              let param = frame_spots[ii];\n              if (!isSubRect(param)) {\n                by_key[param.key_computed] = param;\n              }\n            }\n          }\n          if (by_key[target]) {\n            focus_next[key] = by_key[target];\n          }\n        }\n      }\n    }\n  }\n}\n\nexport function spotTopOfFrame(): void {\n  if (mouseMoved()) {\n    let pos = mouseDomPos();\n    focus_pos.x = pos[0];\n    focus_pos.y = pos[1];\n    focus_pos.w = 0;\n    focus_pos.h = 0;\n  }\n  if (mouseDownEdge({ peek: true })) {\n    pad_mode = false;\n  }\n  sub_stack.length = 0;\n}\n\nexport function spotSuppressPad(): void {\n  suppress_pad = true;\n  if (pad_mode && focus_key && !focus_is_sticky) {\n    spotUnfocus();\n    pad_mode = true; // but, keep pad_mode set\n  }\n}\n\nexport function spotPadSuppressed(): boolean {\n  return suppress_pad;\n}\n\nexport function spotEndOfFrame(): void {\n  spotCalcNavTargets();\n\n  last_frame_autofocus_spots = frame_autofocus_spots;\n  suppress_pad = false;\n  last_frame_spots = frame_spots;\n  frame_spots = [];\n  frame_autofocus_spots = {};\n  async_activate_key = null;\n}\n\nfunction frameSpotsPush(param: SpotListElem): void {\n  assert(param.dom_pos);\n  verify(isFinite(param.dom_pos.x));\n  verify(isFinite(param.dom_pos.y));\n  verify(isFinite(param.dom_pos.w));\n  verify(isFinite(param.dom_pos.h));\n  param.sub_rect = focus_sub_rect;\n  frame_spots.push(param);\n  if (focus_sub_rect) {\n    focus_sub_rect.is_empty_sub_rect = false;\n  }\n}\n\ntype HasPosCache = {\n  dom_pos: Box;\n};\n\nfunction spotEntirelyObscured(param: HasPosCache): boolean {\n  let pos = param.dom_pos;\n  for (let ii = 0; ii < frame_spots.length; ++ii) {\n    let other = frame_spots[ii];\n    if (isSubRect(other)) {\n      continue;\n    }\n    if (other.sub_rect !== focus_sub_rect) {\n      continue;\n    }\n    let other_pos = other.dom_pos;\n    if (other_pos.x <= pos.x && other_pos.x + other_pos.w >= pos.x + pos.w &&\n      other_pos.y <= pos.y && other_pos.y + other_pos.h >= pos.y + pos.h\n    ) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function spotSubPush(): void {\n  sub_stack.push([focus_sub_rect, focus_sub_rect_elem]);\n  focus_sub_rect = null;\n}\nexport function spotSubPop(): void {\n  ([focus_sub_rect, focus_sub_rect_elem] = verify(sub_stack.pop()));\n}\n\nexport function spotSubBegin(param_in: SpotSubParam): void {\n  assert(param_in.key);\n  assert(!focus_sub_rect); // no recursive nesting supported yet\n  spotKey(param_in);\n  let sub_rect = param_in as SpotSubInternal;\n  sub_rect.is_sub_rect = true;\n  if (!sub_rect.dom_pos) {\n    sub_rect.dom_pos = {} as Box;\n  }\n  camera2d.virtualToDomPosParam(sub_rect.dom_pos, sub_rect);\n  if (!spotEntirelyObscured(sub_rect)) {\n    frameSpotsPush(sub_rect);\n  }\n  focus_sub_rect = sub_rect;\n  focus_sub_rect.is_empty_sub_rect = true;\n  focus_sub_rect_elem = null;\n}\n\nexport function spotSubEnd(): SpotParam | null {\n  assert(focus_sub_rect);\n  focus_sub_rect = null;\n  return focus_sub_rect_elem;\n}\n\nexport function spotMouseoverHook(pos_param_in: Box, param: MouseOverParam): void {\n  if (inputEatenMouse() || param.peek) {\n    return;\n  }\n  if ((param as SpotParam).key_computed) { // presumably in a call to `spot()`\n    return;\n  }\n  let pos_param = pos_param_in as Box & HasPosCache;\n  if (!pos_param.dom_pos) {\n    pos_param.dom_pos = {} as Box;\n  }\n  camera2d.virtualToDomPosParam(pos_param.dom_pos, pos_param);\n  if (!spotEntirelyObscured(pos_param)) {\n    let area = pos_param as SpotInternal;\n    area.only_mouseover = true;\n    area.pad_focusable = false;\n    if (engine.defines.SPOT_DEBUG) {\n      area.spot_debug_ignore = param.eat_clicks || // just consuming mouseover, not a button / etc\n        param.spot_debug_ignore;\n    }\n    frameSpotsPush(area);\n  }\n}\n\nfunction keyCheck(nav_dir: SpotNavEnum): boolean {\n  if (suppress_pad) {\n    return false;\n  }\n  switch (nav_dir) {\n    case SPOT_NAV_LEFT:\n      return keyDownEdge(KEYS.LEFT) || padButtonDownEdge(PAD.LEFT);\n    case SPOT_NAV_UP:\n      return keyDownEdge(KEYS.UP) || padButtonDownEdge(PAD.UP);\n    case SPOT_NAV_RIGHT:\n      return keyDownEdge(KEYS.RIGHT) || padButtonDownEdge(PAD.RIGHT);\n    case SPOT_NAV_DOWN:\n      return keyDownEdge(KEYS.DOWN) || padButtonDownEdge(PAD.DOWN);\n    case SPOT_NAV_PREV:\n      return keyDown(KEYS.SHIFT) && keyDownEdge(KEYS.TAB) || padButtonDownEdge(PAD.LEFT_BUMPER);\n    case SPOT_NAV_NEXT:\n      return !keyDown(KEYS.SHIFT) && keyDownEdge(KEYS.TAB) || padButtonDownEdge(PAD.RIGHT_BUMPER);\n    default:\n      assert(false);\n  }\n  return false;\n}\n\ntype SpotParamWithOut = SpotParam & {\n  out: SpotRet;\n};\n\nfunction spotFocusCheckNavButtonsFocused(param: SpotParamWithOut): void {\n  for (let ii = 1 as SpotNavEnum; ii < SPOT_NAV_MAX; ++ii) {\n    let elem = focus_next[ii];\n    if (elem !== undefined && keyCheck(ii)) {\n      if (elem) {\n        spotFocusSet(elem, false, false, 'nav_focused');\n      } else {\n        param.out.nav = ii;\n      }\n    }\n  }\n}\n\nfunction spotFocusCheckNavButtonsUnfocused(param: SpotParamWithOut): void {\n  for (let ii = 1 as SpotNavEnum; ii < SPOT_NAV_MAX; ++ii) {\n    let elem = focus_next[ii];\n    if (elem && elem.key_computed === param.key_computed && keyCheck(ii)) {\n      spotFocusSet(elem, false, false, 'nav_unfocused');\n    }\n  }\n}\n\n// Silently steal (keep) focus\nfunction spotFocusSetSilent(param: SpotParam): void {\n  const key = spotKey(param);\n  const def = param.def || SPOT_DEFAULT;\n  focus_key = key;\n  const sticky_focus = param.sticky_focus === undefined ? def.sticky_focus : param.sticky_focus;\n  focus_is_sticky = sticky_focus;\n  focus_key_nonsticky = null;\n}\n\nexport function spotFocusSteal(param: SpotParam): void {\n  const key = spotKey(param);\n  spotlog('spotFocusSteal', key, false);\n  // Silent, no sound, no checking parameters, just set the key string\n  pad_mode = true;\n  spotFocusSetSilent(param);\n}\n\nfunction spotParamAddOut(param: SpotParam): asserts param is SpotParamWithOut {\n  if (!param.out) {\n    param.out = {} as SpotRet;\n  }\n}\n\nfunction spotParamAddPosCache(param: SpotParamWithOut): asserts param is SpotInternal {\n  assert(param.key_computed);\n  if (!param.dom_pos) {\n    param.dom_pos = {} as Box;\n  }\n}\n\nfunction spotParamIsSpotInternal(param: SpotParam): asserts param is SpotInternal {\n  // nothing, just for TypeScript\n}\n\n// sets param.out.allow_focus, param.out.nav, and param.dom_pos (if allow_focus)\nexport function spotFocusCheck(param: SpotParam): SpotRet {\n  spotParamAddOut(param);\n  let out = param.out;\n  out.focused = false;\n  out.kb_focused = false;\n  out.allow_focus = false;\n  const key = spotKey(param); // Doing this even if disabled for spotDebug()\n  const def = param.def || SPOT_DEFAULT;\n  const disabled = param.disabled === undefined ? def.disabled : param.disabled;\n  if (disabled) {\n    const disabled_focusable = param.disabled_focusable === undefined ? def.disabled_focusable :\n      param.disabled_focusable;\n    if (!disabled_focusable) {\n      return out;\n    }\n    // Otherwise disabled_focusable - allow focusing\n  }\n  const focus_steal = param.focus_steal === undefined ? def.focus_steal : param.focus_steal;\n  if (focus_steal) {\n    // Silently steal (keep) focus\n    spotFocusSetSilent(param);\n  }\n  if (focus_key === key) {\n    // last_frame_focus_found = true;\n    spotFocusCheckNavButtonsFocused(param);\n  } else {\n    spotFocusCheckNavButtonsUnfocused(param);\n  }\n  let focused = focus_key === key || focus_key_nonsticky === key;\n  if (inputEatenMouse()) {\n    if (focus_key === key) {\n      spotUnfocus();\n      focused = false;\n    }\n    if (focus_key_nonsticky === key) {\n      focus_key_nonsticky = null;\n      focused = false;\n    }\n  } else {\n    out.allow_focus = true;\n    spotParamAddPosCache(param);\n    camera2d.virtualToDomPosParam(param.dom_pos, param);\n    const auto_focus = param.auto_focus === undefined ? def.auto_focus : param.auto_focus;\n    if (!spotEntirelyObscured(param) || focused && focus_is_sticky) {\n      frameSpotsPush(param);\n      if (auto_focus) {\n        if (!focused && !last_frame_autofocus_spots[key] && pad_mode) {\n          spotlog('auto_focus', key);\n          // play no sound, etc, just silently steal focus\n          spotFocusSetSilent(param);\n          focused = true;\n        }\n      }\n    }\n    if (auto_focus) {\n      frame_autofocus_spots[key] = param;\n    }\n    if (focus_sub_rect && focus_key === key) {\n      focus_sub_rect_elem = param;\n    }\n  }\n\n  out.kb_focused = focus_key === key;\n  out.focused = focused;\n  return out;\n}\n\nexport function spotEndInput(): void {\n  if (engine.defines.SPOT_DEBUG) {\n    spotDebug();\n  }\n}\n\n// This is useful for preemptively triggering a button press within an in_event_cb that has\n// a side-effect (such as rotating the screen) that might cause the actual button press to\n// not reach the appropriate button.\nexport function spotAsyncActivateButton(key: string): void {\n  async_activate_key = key;\n}\n\nlet last_signal = {\n  key: '',\n  timestamp: 0,\n};\nfunction spotSignalRet(param: SpotInternal): void {\n  let out = param.out;\n  let key = param.key_computed;\n  assert(key);\n  out.double_click = key === last_signal.key &&\n    engine.frame_timestamp - last_signal.timestamp <\n    // TODO: After input.js and settings.js are converted to TypeScript, remove type casts\n    (settings as unknown as { double_click_time:number }).double_click_time;\n  last_signal.key = key;\n  last_signal.timestamp = engine.frame_timestamp;\n  out.ret++;\n}\n\n// param:\n//   See SPOT_DEFAULT, additionally:\n//   x,y,w,h : number // only parameters not inherited from `def`\n//   def: used for any undefined parameters (defaults to SPOT_DEFAULT)\n//   out: object // holds return values, lazy-allocated if needed\n// returns/modifies param.out:\n//   focused : boolean // focused by any means\n//   kb_focused : boolean // focused for the purpose of receiving keyboard input (focused and no other sticky focus)\n//   spot_state: one of SPOT_STATE_*\n//   ret: number // if `param.is_button` and was activated (0/1 or more if clicked multiple times in a frame)\n//   long_press: boolean // if button_long_press and ret and was a long press, set to true\n//   button: number // if ret, set to mouse button used to click it\n//   pos: vec2 // if ret, set to position of the click\n//   double_click: boolean // if ret, set to true if it was a double click/tap/button press/etc\n//   drag_drop: any // if drag_target and a drop happened, contains dragDrop event { drag_payload }\n//   nav: SPOT_NAV_* // if custom_nav, and the user navigated, set to the navigation event\nexport function spot(param: SpotParam): SpotRet {\n  profilerStartFunc();\n  const def = param.def || SPOT_DEFAULT;\n  const disabled = param.disabled === undefined ? def.disabled : param.disabled;\n  const is_button = param.is_button === undefined ? def.is_button : param.is_button;\n  const button_long_press = param.button_long_press === undefined ? def.button_long_press : param.button_long_press;\n  const in_event_cb = param.in_event_cb === undefined ? def.in_event_cb : param.in_event_cb;\n  const drag_target = param.drag_target === undefined ? def.drag_target : param.drag_target;\n  const drag_over = param.drag_over === undefined ? def.drag_over : param.drag_over;\n  const touch_focuses = param.touch_focuses === undefined ? def.touch_focuses : param.touch_focuses;\n  const focus_steal = param.focus_steal === undefined ? def.focus_steal : param.focus_steal;\n  const custom_nav = param.custom_nav === undefined ? def.custom_nav : param.custom_nav;\n\n  spotParamAddOut(param);\n  let out = param.out;\n  out.focused = false;\n  out.ret = 0;\n  if (button_long_press) {\n    out.long_press = false;\n  }\n  if (drag_target) {\n    out.drag_drop = null;\n  }\n  if (custom_nav) {\n    out.nav = SPOT_NAV_NONE;\n  }\n\n  let state: SpotStateEnum = SPOT_STATE_REGULAR;\n  let { focused, allow_focus, kb_focused } = spotFocusCheck(param);\n  spotParamIsSpotInternal(param); // massaged in spotFocusCheck(), but type assertion is lost\n  if (disabled) {\n    state = SPOT_STATE_DISABLED;\n  } else {\n    let button_click;\n    let long_press_ret;\n    if (drag_target && (out.drag_drop = dragDrop(param))) {\n      spotFocusSet(param, true, true, 'drag_drop');\n      spotSignalRet(param);\n      focused = true;\n    } else if (button_long_press && (long_press_ret = longPress(param)) ||\n        is_button && (button_click = inputClick(param))\n    ) {\n      // TODO: change `ret` to be a count of how many clicks/taps happened?\n      if (long_press_ret) {\n        out.long_press = long_press_ret.long_press;\n        out.button = long_press_ret.button;\n        out.pos = undefined;\n      } else {\n        assert(button_click);\n        out.button = button_click.button;\n        out.pos = button_click.pos as Vec2;\n      }\n      // Not using button_click.was_double_click: relying on doubly activating this exact spot instead\n      // out.double_click = button_click.was_double_click;\n      if (mousePosIsTouch()) {\n        if (touch_focuses) {\n          if (!focused) {\n            // Just focus, show tooltip\n            // touch_changed_focus = true;\n            // Considering this a \"pad\" focus, not mouse, as it's sticky\n            spotFocusSet(param, false, false, 'touch_focus');\n            focused = true;\n          } else {\n            // activate, and also unfocus\n            spotSignalRet(param);\n            spotUnfocus();\n            focused = false;\n          }\n        } else {\n          // not focusing, would flicker a tooltip for 1 frame\n          // also, unfocusing, in case it was focused via long_press_focuses\n          spotSignalRet(param);\n          spotUnfocus();\n          focused = false;\n        }\n      } else {\n        spotSignalRet(param);\n        spotFocusSet(param, true, true, 'click');\n        focused = true;\n      }\n    } else if (!is_button && touch_focuses && mousePosIsTouch() && inputClick(param)) {\n      // Considering this a \"pad\" focus, not mouse, as it's sticky\n      spotFocusSet(param, false, false, 'touch_focus');\n      focused = true;\n    } else if (drag_target && dragOver(param)) {\n      spotFocusSet(param, true, false, 'drag_over');\n      focused = true;\n      if (mouseDownAnywhere()) {\n        state = SPOT_STATE_DOWN;\n      }\n    } else if (drag_over && dragOver(param)) {\n      // do nothing, just consume event\n      // not even set focus?\n    }\n  }\n  // Long-press (on touch) focuses, a la mouse rollover\n  if (allow_focus && inputTouchMode()) {\n    const long_press_focuses = param.long_press_focuses === undefined ?\n      def.long_press_focuses : param.long_press_focuses;\n    if (long_press_focuses && longPress(param)) {\n      // Considering this a \"pad\" focus, not mouse, as it's sticky\n      spotFocusSet(param, false, false, 'long_press');\n      focused = true;\n    }\n  }\n  let is_mouseover = mouseOver(param);\n  if (focused && !focus_steal && !is_mouseover) {\n    // Want to unfocus if mouse is in use\n    if (mouseButtonHadEdge()) {\n      // Unfocus regardless\n      focused = false;\n      spotUnfocus();\n    } else if (mouseMoved()) {\n      // Unfocus just focus_non_sticky if appropriate\n      focused = false;\n      if (focus_key === param.key_computed) {\n        spotUnfocus();\n      } else if (focus_key_nonsticky === param.key_computed) {\n        focus_key_nonsticky = null;\n      }\n    }\n  }\n  if (is_mouseover) {\n    if (allow_focus) {\n      if (spotFocusSet(param, true, false, 'mouseover')) {\n        focused = true;\n      }\n    }\n  }\n  if (is_button && is_mouseover && mouseDownMidClick(param)) {\n    if (!disabled) {\n      state = SPOT_STATE_DOWN;\n    }\n  }\n\n  let button_activate = false;\n  if (focused) {\n    if (state === SPOT_STATE_REGULAR) {\n      state = SPOT_STATE_FOCUSED;\n    }\n    if (is_button && !disabled && kb_focused && !suppress_pad) {\n      let key_opts = in_event_cb ? { in_event_cb } : null;\n      if (keyDownEdge(KEYS.SPACE, key_opts) || keyDownEdge(KEYS.RETURN, key_opts) || padButtonDownEdge(PAD.A)) {\n        button_activate = true;\n      }\n    }\n  }\n  if (!disabled) {\n    const hotkey = param.hotkey === undefined ? def.hotkey : param.hotkey;\n    const hotpad = param.hotpad === undefined ? def.hotpad : param.hotpad;\n    if (hotkey) {\n      let key_opts = in_event_cb ? { in_event_cb } : null;\n      if (keyDownEdge(hotkey, key_opts)) {\n        button_activate = true;\n      }\n    }\n    if (hotpad) {\n      if (padButtonDownEdge(hotpad)) {\n        button_activate = true;\n      }\n    }\n    if (async_activate_key === param.key_computed) {\n      button_activate = true;\n    }\n  }\n  if (button_activate) {\n    spotSignalRet(param);\n    out.button = 0;\n    out.pos = null;\n  }\n\n  out.focused = focused;\n  if (out.ret) {\n    state = SPOT_STATE_DOWN;\n    const sound_button = param.sound_button === undefined ? def.sound_button : param.sound_button;\n    if (sound_button) {\n      playUISound(sound_button);\n    }\n  }\n  if (out.focused && param.tooltip) {\n    drawTooltipBox(param as TooltipBoxParam);\n  }\n  checkHooks(param, Boolean(out.ret));\n  out.spot_state = state;\n\n  profilerStopFunc();\n  return out;\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n// Some code from Turbulenz: Copyright (c) 2012-2013 Turbulenz Limited\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// Legacy APIs\n// eslint-disable-next-line @typescript-eslint/no-use-before-define\nexports.createSprite = spriteCreate;\n// eslint-disable-next-line @typescript-eslint/no-use-before-define\nexports.create = spriteCreate;\n\nexport const BlendMode = {\n  BLEND_ALPHA: 0,\n  BLEND_ADDITIVE: 1,\n  BLEND_PREMULALPHA: 2,\n};\nexport const BLEND_ALPHA = 0;\nexport const BLEND_ADDITIVE = 1;\nexport const BLEND_PREMULALPHA = 2;\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst camera2d = require('./camera2d.js');\nconst { dynGeomQueueSprite } = require('./dyn_geom.js');\nconst engine = require('./engine.js');\nconst geom = require('./geom.js');\nconst { cos, max, min, round, sin } = Math;\nconst textures = require('./textures.js');\nconst { cmpTextureArray } = textures;\nconst shaders = require('./shaders.js');\nconst { deprecate, nextHighestPowerOfTwo } = require('glov/common/util.js');\nconst { vec2, vec4 } = require('glov/common/vmath.js');\n\ndeprecate(exports, 'clip', 'spriteClip');\ndeprecate(exports, 'clipped', 'spriteClipped');\ndeprecate(exports, 'clipPush', 'spriteClipPush');\ndeprecate(exports, 'clipPop', 'spriteClipPop');\ndeprecate(exports, 'clipPause', 'spriteClipPause');\ndeprecate(exports, 'clipResume', 'spriteClipResume');\ndeprecate(exports, 'queuefn', 'spriteQueueFn');\ndeprecate(exports, 'draw', 'spriteDraw');\ndeprecate(exports, 'drawPartial', 'spriteDrawPartial');\n\nexport let sprite_vshader;\nexport let sprite_fshader;\nlet sprite_dual_fshader;\nlet clip_space = vec4();\nlet sprite_shader_params = {\n  clip_space\n};\nlet last_uid = 0;\nlet geom_stats;\n\nlet sprite_queue = [];\n\nlet sprite_freelist = [];\n\nlet sprite_queue_stack = [];\nexport function spriteQueuePush(new_list) {\n  assert(sprite_queue_stack.length < 10); // probably leaking\n  sprite_queue_stack.push(sprite_queue);\n  sprite_queue = new_list || [];\n}\nexport function spriteQueuePop(for_pause) {\n  assert(sprite_queue_stack.length);\n  assert(for_pause || !sprite_queue.length);\n  sprite_queue = sprite_queue_stack.pop();\n}\n\nfunction SpriteData() {\n  // x y cr cg cb ca u v (x4)\n  // data for GL queuing\n  this.data = new Float32Array(32);\n  // data for sorting/binding/etc\n  this.texs = null;\n  this.shader = null;\n  this.shader_params = null;\n  this.x = 0;\n  this.y = 0;\n  this.z = 0;\n  this.blend = 0; // BLEND_ALPHA\n  this.uid = 0;\n  this.chained = false;\n  this.next = null;\n}\n\nSpriteData.prototype.queue = function (z) {\n  ++geom_stats.sprites;\n  if (!this.chained) {\n    this.z = z;\n    this.uid = ++last_uid;\n    sprite_queue.push(this);\n  }\n};\n\nlet is_chained = false;\nlet chained_prev = null;\nexport function spriteChainedStart() {\n  is_chained = true;\n  chained_prev = null;\n}\nexport function spriteChainedStop() {\n  is_chained = false;\n  chained_prev = null;\n}\n\nexport function spriteDataAlloc(texs, shader, shader_params, blend) {\n  let ret;\n  if (sprite_freelist.length) {\n    ret = sprite_freelist.pop();\n  } else {\n    ret = new SpriteData();\n  }\n  ret.texs = texs;\n  if (is_chained && chained_prev) {\n    ret.chained = true;\n    chained_prev.next = ret;\n  } else {\n    ret.chained = false;\n    ret.shader = shader || null;\n    if (shader_params) {\n      shader_params.clip_space = sprite_shader_params.clip_space;\n      ret.shader_params = shader_params;\n    } else {\n      ret.shader_params = null;\n    }\n    ret.blend = blend || 0; // BLEND_ALPHA\n  }\n  if (is_chained) {\n    chained_prev = ret;\n  }\n  return ret;\n}\n\nfunction cmpSprite(a, b) {\n  ++geom_stats.sprite_sort_cmps;\n  if (a.z !== b.z) {\n    return a.z - b.z;\n  }\n  if (a.blend === BLEND_ADDITIVE && b.blend === BLEND_ADDITIVE) {\n    // both additive at the same Z, do not sort for performance reasons\n    return 0;\n  }\n  if (a.y !== b.y) {\n    return a.y - b.y;\n  }\n  if (a.x !== b.x) {\n    return a.x - b.x;\n  }\n  return a.uid - b.uid;\n}\n\nexport function spriteQueueFn(z, fn) {\n  assert(isFinite(z));\n  sprite_queue.push({\n    fn,\n    x: 0,\n    y: 0,\n    z,\n    uid: ++last_uid,\n  });\n}\n\n// 4 arbitrary positions, colors, uvs\n// coordinates must be in counter-clockwise winding order\nexport function queueraw4color(\n  texs,\n  x0, y0, c0, u0, v0,\n  x1, y1, c1, u1, v1,\n  x2, y2, c2, u2, v2,\n  x3, y3, c3, u3, v3,\n  z,\n  shader, shader_params, blend\n) {\n  assert(isFinite(z));\n  let elem = spriteDataAlloc(texs, shader, shader_params, blend);\n  let data = elem.data;\n  // x1 y1 x2 y2 x3 y3 x4 y4 - vertices [0,8)\n  // cr cg cb ca u1 v1 u2 v2 - normalized color + texture [8,16)\n  // Minor perf improvement: convert by clip_space here (still just a single MAD\n  //   if pre-calculated in the camera) and remove it from the shader.\n  data[0] = (x0 - camera2d.data[0]) * camera2d.data[4];\n  data[1] = (y0 - camera2d.data[1]) * camera2d.data[5];\n  // Note: measurably slower: data.set(c0, 2);\n  data[2] = c0[0];\n  data[3] = c0[1];\n  data[4] = c0[2];\n  data[5] = c0[3];\n  data[6] = u0;\n  data[7] = v0;\n\n  data[8] = (x1 - camera2d.data[0]) * camera2d.data[4];\n  data[9] = (y1 - camera2d.data[1]) * camera2d.data[5];\n  data[10] = c1[0];\n  data[11] = c1[1];\n  data[12] = c1[2];\n  data[13] = c1[3];\n  data[14] = u1;\n  data[15] = v1;\n\n  data[16] = (x2 - camera2d.data[0]) * camera2d.data[4];\n  data[17] = (y2 - camera2d.data[1]) * camera2d.data[5];\n  data[18] = c2[0];\n  data[19] = c2[1];\n  data[20] = c2[2];\n  data[21] = c2[3];\n  data[22] = u2;\n  data[23] = v2;\n\n  data[24] = (x3 - camera2d.data[0]) * camera2d.data[4];\n  data[25] = (y3 - camera2d.data[1]) * camera2d.data[5];\n  data[26] = c3[0];\n  data[27] = c3[1];\n  data[28] = c3[2];\n  data[29] = c3[3];\n  data[30] = u3;\n  data[31] = v3;\n\n  elem.x = data[0];\n  elem.y = data[1];\n  elem.queue(z);\n  return elem;\n}\n\n// 4 arbitrary positions\n// coordinates must be in counter-clockwise winding order\nexport function queueraw4(\n  texs, x0, y0, x1, y1, x2, y2, x3, y3, z,\n  u0, v0, u1, v1,\n  color, shader, shader_params, blend\n) {\n  return queueraw4color(texs,\n    x0, y0, color, u0, v0,\n    x1, y1, color, u0, v1,\n    x2, y2, color, u1, v1,\n    x3, y3, color, u1, v0,\n    z,\n    shader, shader_params, blend);\n}\n\n// allocate with spriteDataAlloc() and then fill .data\nexport function queueSpriteData(elem, z) {\n  assert(isFinite(z));\n  let data = elem.data;\n  data[0] = (data[0] - camera2d.data[0]) * camera2d.data[4];\n  data[1] = (data[1] - camera2d.data[1]) * camera2d.data[5];\n\n  data[8] = (data[8] - camera2d.data[0]) * camera2d.data[4];\n  data[9] = (data[9] - camera2d.data[1]) * camera2d.data[5];\n\n  data[16] = (data[16] - camera2d.data[0]) * camera2d.data[4];\n  data[17] = (data[17] - camera2d.data[1]) * camera2d.data[5];\n\n  data[24] = (data[24] - camera2d.data[0]) * camera2d.data[4];\n  data[25] = (data[25] - camera2d.data[1]) * camera2d.data[5];\n\n  elem.x = data[0];\n  elem.y = data[1];\n  elem.queue(z);\n  return elem;\n}\n\n// Expects a buffer in the form of:\n//   x, y, r, g, b, a, u, v, (x4)\nexport function queueraw4colorBuffer(\n  texs, buf,\n  z, shader, shader_params, blend\n) {\n  assert(isFinite(z));\n  let elem = spriteDataAlloc(texs, shader, shader_params, blend);\n  let data = elem.data;\n  for (let ii = 0; ii < 32; ++ii) {\n    data[ii] = buf[ii];\n  }\n  queueSpriteData(elem, z);\n  return elem;\n}\n\n\nexport function queueraw(\n  texs, x, y, z, w, h,\n  u0, v0, u1, v1,\n  color, shader, shader_params, blend\n) {\n  return queueraw4color(texs,\n    x, y, color, u0, v0,\n    x, y + h, color, u0, v1,\n    x + w, y + h, color, u1, v1,\n    x + w, y, color, u1, v0,\n    z,\n    shader, shader_params, blend);\n}\n\nlet temp_uvs = vec4();\nfunction fillUVs(tex, w, h, nozoom, uvs) {\n  let ubias = 0;\n  let vbias = 0;\n  if (!nozoom && !tex.nozoom) {\n    // Bias the texture coordinates depending on the minification/magnification\n    //   level so we do not get pixels from neighboring frames bleeding in\n    // Use min here (was max in libGlov), to solve tooltip edges being wrong in strict pixely\n    // Use max here to solve box buttons not lining up, but instead using nozoom in drawBox/drawHBox,\n    //   but, that only works for magnification - need the max here for minification!\n    let zoom_level = max(\n      (uvs[2] - uvs[0]) * tex.width / w,\n      (uvs[3] - uvs[1]) * tex.height / h,\n    ); // in texels per pixel\n    if (zoom_level < 1) { // magnification\n      if (tex.filter_mag === gl.LINEAR) {\n        // Need to bias by half a texel, so we're doing absolutely no blending with the neighboring texel\n        ubias = vbias = 0.5;\n      } else if (tex.filter_mag === gl.NEAREST) {\n        if (engine.antialias) {\n          // When antialiasing is on, even nearest sampling samples from adjacent texels, do slight bias\n          // Want to bias by one *pixel's* worth\n          ubias = vbias = zoom_level / 2;\n        } else {\n          // even without it, running into problems, just add a tiny bias!\n          // In theory, don't want this if UVs are 0/1 and we're clamping?\n          ubias = vbias = zoom_level * 0.01;\n        }\n      }\n    } else if (zoom_level > 1) { // minification\n      // need to apply this bias even with nearest filtering, not exactly sure why\n      let mipped_texels = zoom_level / 2;\n      ubias = vbias = 0.5 + mipped_texels;\n\n    }\n    if (uvs[0] > uvs[2]) {\n      ubias *= -1;\n    }\n    if (uvs[1] > uvs[3]) {\n      vbias *= -1;\n    }\n  }\n\n  temp_uvs[0] = uvs[0] + ubias / tex.width;\n  temp_uvs[1] = uvs[1] + vbias / tex.height;\n  temp_uvs[2] = uvs[2] - ubias / tex.width;\n  temp_uvs[3] = uvs[3] - vbias / tex.height;\n}\n\nlet qsp = {};\nfunction queuesprite4colorObj() {\n  let {\n    rot, z, sprite,\n    color_ul, color_ll, color_lr, color_ur,\n  } = qsp;\n  assert(isFinite(z));\n  let elem = spriteDataAlloc(sprite.texs, qsp.shader, qsp.shader_params, qsp.blend);\n  let x = (qsp.x - camera2d.data[0]) * camera2d.data[4];\n  let y = (qsp.y - camera2d.data[1]) * camera2d.data[5];\n  let w = qsp.w * camera2d.data[4];\n  let h = qsp.h * camera2d.data[5];\n  if (qsp.pixel_perfect) {\n    x |= 0;\n    y |= 0;\n    w |= 0;\n    h |= 0;\n  }\n  elem.x = x;\n  elem.y = y;\n  let data = elem.data;\n  if (!rot) {\n    let x1 = x - sprite.origin[0] * w;\n    let y1 = y - sprite.origin[1] * h;\n    let x2 = x1 + w;\n    let y2 = y1 + h;\n    data[0] = x1;\n    data[1] = y1;\n    data[8] = x1;\n    data[9] = y2;\n    data[16] = x2;\n    data[17] = y2;\n    data[24] = x2;\n    data[25] = y1;\n  } else {\n    let dx = sprite.origin[0] * w;\n    let dy = sprite.origin[1] * h;\n\n    let cosr = cos(rot);\n    let sinr = sin(rot);\n\n    let x1 = x - cosr * dx + sinr * dy;\n    let y1 = y - sinr * dx - cosr * dy;\n    let ch = cosr * h;\n    let cw = cosr * w;\n    let sh = sinr * h;\n    let sw = sinr * w;\n\n    data[0] = x1;\n    data[1] = y1;\n    data[8] = x1 - sh;\n    data[9] = y1 + ch;\n    data[16] = x1 + cw - sh;\n    data[17] = y1 + sw + ch;\n    data[24] = x1 + cw;\n    data[25] = y1 + sw;\n  }\n\n  fillUVs(elem.texs[0], w, h, qsp.nozoom, qsp.uvs);\n  data[2] = color_ul[0];\n  data[3] = color_ul[1];\n  data[4] = color_ul[2];\n  data[5] = color_ul[3];\n  data[6] = temp_uvs[0];\n  data[7] = temp_uvs[1];\n\n  data[10] = color_ll[0];\n  data[11] = color_ll[1];\n  data[12] = color_ll[2];\n  data[13] = color_ll[3];\n  data[14] = temp_uvs[0];\n  data[15] = temp_uvs[3];\n\n  data[18] = color_lr[0];\n  data[19] = color_lr[1];\n  data[20] = color_lr[2];\n  data[21] = color_lr[3];\n  data[22] = temp_uvs[2];\n  data[23] = temp_uvs[3];\n\n  data[26] = color_ur[0];\n  data[27] = color_ur[1];\n  data[28] = color_ur[2];\n  data[29] = color_ur[3];\n  data[30] = temp_uvs[2];\n  data[31] = temp_uvs[1];\n\n  elem.queue(z);\n  return elem;\n}\n\nexport function queuesprite(\n  sprite, x, y, z, w, h, rot, uvs, color, shader, shader_params, nozoom,\n  pixel_perfect, blend,\n) {\n  color = color || sprite.color;\n  qsp.sprite = sprite;\n  qsp.x = x;\n  qsp.y = y;\n  qsp.z = z;\n  qsp.w = w;\n  qsp.h = h;\n  qsp.rot = rot;\n  qsp.uvs = uvs;\n  qsp.color_ul = color;\n  qsp.color_ll = color;\n  qsp.color_lr = color;\n  qsp.color_ur = color;\n  qsp.shader = shader;\n  qsp.shader_params = shader_params;\n  qsp.nozoom = nozoom;\n  qsp.pixel_perfect = pixel_perfect;\n  qsp.blend = blend;\n  return queuesprite4colorObj(qsp);\n}\n\nlet clip_temp_xy = vec2();\nlet clip_temp_wh = vec2();\nfunction clipCoordsScissor(x, y, w, h) {\n  camera2d.virtualToCanvas(clip_temp_xy, [x, y]);\n  clip_temp_xy[0] = round(clip_temp_xy[0]);\n  clip_temp_xy[1] = round(clip_temp_xy[1]);\n  camera2d.virtualToCanvas(clip_temp_wh, [x + w, y + h]);\n  clip_temp_wh[0] = round(clip_temp_wh[0]) - clip_temp_xy[0];\n  clip_temp_wh[1] = round(clip_temp_wh[1]) - clip_temp_xy[1];\n\n  // let gd_w = engine.render_width || engine.width;\n  let gd_h = engine.render_height || engine.height;\n  return [clip_temp_xy[0], gd_h - (clip_temp_xy[1] + clip_temp_wh[1]), clip_temp_wh[0], clip_temp_wh[1]];\n}\n\nfunction clipCoordsDom(x, y, w, h) {\n  let xywh = vec4();\n  camera2d.virtualToDom(xywh, [x + w, y + h]);\n  xywh[2] = xywh[0];\n  xywh[3] = xywh[1];\n  camera2d.virtualToDom(xywh, [x, y]);\n  xywh[0] = round(xywh[0]);\n  xywh[1] = round(xywh[1]);\n  xywh[2] = round(xywh[2]) - xywh[0];\n  xywh[3] = round(xywh[3]) - xywh[1];\n\n  return xywh;\n}\n\nexport function spriteClip(z_start, z_end, x, y, w, h) {\n  let scissor = clipCoordsScissor(x, y, w, h);\n  spriteQueueFn(z_start - 0.01, () => {\n    gl.enable(gl.SCISSOR_TEST);\n    gl.scissor(scissor[0], scissor[1], scissor[2], scissor[3]);\n  });\n  spriteQueueFn(z_end - 0.01, () => {\n    gl.disable(gl.SCISSOR_TEST);\n  });\n}\n\nlet clip_stack = [];\nexport function spriteClipped() {\n  return clip_stack.length > 0;\n}\n\nexport function spriteClipPush(z, x, y, w, h) {\n  assert(clip_stack.length < 10); // probably leaking\n  let scissor = clipCoordsScissor(x, y, w, h);\n  let dom_clip = clipCoordsDom(x, y, w, h);\n  camera2d.setInputClipping(dom_clip);\n  spriteQueuePush();\n  clip_stack.push({\n    z, scissor, dom_clip,\n  });\n}\n\nexport function spriteClipPop() {\n  assert(spriteClipped());\n  spriteQueueFn(Z.TOOLTIP - 0.1, () => {\n    gl.disable(gl.SCISSOR_TEST);\n  });\n  let { z, scissor } = clip_stack.pop();\n  let sprites = sprite_queue;\n  spriteQueuePop(true);\n  if (clip_stack.length) {\n    let { dom_clip } = clip_stack[clip_stack.length - 1];\n    camera2d.setInputClipping(dom_clip);\n  } else {\n    camera2d.setInputClipping(null);\n  }\n  spriteQueueFn(z, () => {\n    gl.enable(gl.SCISSOR_TEST);\n    gl.scissor(scissor[0], scissor[1], scissor[2], scissor[3]);\n    spriteQueuePush();\n    sprite_queue = sprites;\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    spriteDraw();\n    spriteQueuePop();\n    // done at Z.TOOLTIP: gl.disable(gl.SCISSOR_TEST);\n  });\n}\n\nlet clip_paused;\nexport function spriteClipPause() {\n  // Queue back into the root sprite queue\n  assert(spriteClipped());\n  assert(!clip_paused);\n  clip_paused = true;\n  spriteQueuePush(sprite_queue_stack[0]);\n  camera2d.setInputClipping(null);\n  // push onto the clip stack so if there's another clip push/pop we get back to\n  // escaped when it pops.\n  clip_stack.push({ dom_clip: null });\n}\nexport function spriteClipResume() {\n  assert(spriteClipped());\n  assert(clip_paused);\n  clip_stack.pop(); // remove us\n  clip_paused = false;\n  assert(spriteClipped());\n  let { dom_clip } = clip_stack[clip_stack.length - 1];\n  spriteQueuePop(true);\n  camera2d.setInputClipping(dom_clip);\n}\n\nlet batch_state;\nlet sprite_geom;\nlet sprite_buffer; // Float32Array with 8 entries per vert\nlet sprite_buffer_len = 0; // in verts\nlet sprite_buffer_batch_start = 0;\nlet sprite_buffer_idx = 0; // in verts\n\nlet last_blend_mode;\nlet last_bound_shader;\nconst MAX_VERT_COUNT = 65532; // strictly less than 65536, as index 65535 is special in WebGL2\nlet batches = [];\n\nfunction commit() {\n  if (sprite_buffer_idx === sprite_buffer_batch_start) {\n    return;\n  }\n  batches.push({\n    state: batch_state,\n    start: sprite_buffer_batch_start,\n    end: sprite_buffer_idx,\n  });\n  sprite_buffer_batch_start = sprite_buffer_idx;\n}\n\nexport function blendModeSet(blend) {\n  if (last_blend_mode !== blend) {\n    last_blend_mode = blend;\n    if (last_blend_mode === BLEND_ADDITIVE) {\n      gl.blendFunc(gl.SRC_ALPHA, gl.ONE);\n    } else if (last_blend_mode === BLEND_PREMULALPHA) {\n      gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n    } else {\n      gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n    }\n  }\n}\n\nexport function blendModeReset(force) {\n  if (last_blend_mode !== BLEND_ALPHA || force) {\n    // always reset to this\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n    last_blend_mode = BLEND_ALPHA;\n  }\n}\n\nfunction commitAndFlush() {\n  commit();\n  if (!batches.length) {\n    return;\n  }\n  assert(sprite_buffer_idx);\n  sprite_geom.update(sprite_buffer, sprite_buffer_idx);\n  sprite_geom.bind();\n\n  for (let ii = 0; ii < batches.length; ++ii) {\n    let batch = batches[ii];\n    let { state, start, end } = batch;\n    if (last_bound_shader !== state.shader || state.shader_params) {\n      shaders.bind(sprite_vshader,\n        state.shader || sprite_fshader,\n        state.shader_params || sprite_shader_params);\n      last_bound_shader = state.shader;\n    }\n    if (last_blend_mode !== state.blend) {\n      blendModeSet(state.blend);\n    }\n    textures.bindArray(state.texs);\n    ++geom_stats.draw_calls_sprite;\n    gl.drawElements(sprite_geom.mode, (end - start) * 3 / 2, gl.UNSIGNED_SHORT, start * 3);\n  }\n\n  batches.length = 0;\n  sprite_buffer_idx = 0;\n  sprite_buffer_batch_start = 0;\n}\n\nfunction drawSetup() {\n  if (engine.defines.NOSPRITES) {\n    sprite_queue.length = 0;\n  }\n  if (!sprite_queue.length) {\n    return;\n  }\n\n  clip_space[0] = 2 / engine.viewport[2];\n  clip_space[1] = -2 / engine.viewport[3];\n\n  last_blend_mode = -1;\n  last_bound_shader = -1;\n\n  if (!sprite_geom) {\n    sprite_geom = geom.create([\n      [shaders.semantic.POSITION, gl.FLOAT, 2, false],\n      [shaders.semantic.COLOR, gl.FLOAT, 4, false],\n      [shaders.semantic.TEXCOORD, gl.FLOAT, 2, false],\n    ], [], null, geom.QUADS);\n    sprite_buffer = new Float32Array(1024);\n    sprite_buffer_len = sprite_buffer.length / 8;\n  }\n\n  profilerStart('sort');\n  sprite_queue.sort(cmpSprite);\n  geom_stats.sprite_sort_elems += sprite_queue.length;\n  profilerStop('sort');\n\n  batch_state = null;\n  assert.equal(sprite_buffer_idx, 0);\n  assert.equal(sprite_buffer_batch_start, 0);\n  assert.equal(batches.length, 0);\n}\n\nfunction growSpriteBuffer() {\n  let new_length = min((sprite_buffer_len * 1.25 + 3) & ~3, MAX_VERT_COUNT);\n  sprite_buffer_len = new_length;\n  sprite_buffer = new Float32Array(new_length * 8);\n}\n\nfunction drawElem(elem) {\n  let count = 0;\n  if (elem.fn) {\n    commitAndFlush();\n    batch_state = null;\n    elem.fn();\n    last_bound_shader = -1;\n    last_blend_mode = -1;\n    assert.equal(sprite_buffer_idx, 0);\n    assert.equal(sprite_buffer_batch_start, 0);\n    assert.equal(batches.length, 0);\n\n    clip_space[0] = 2 / engine.viewport[2];\n    clip_space[1] = -2 / engine.viewport[3];\n    count++;\n  } else {\n    if (!batch_state ||\n      cmpTextureArray(elem.texs, batch_state.texs) ||\n      elem.shader !== batch_state.shader ||\n      elem.shader_params !== batch_state.shader_params ||\n      elem.blend !== batch_state.blend\n    ) {\n      commit();\n      batch_state = elem;\n    }\n    do {\n      if (sprite_buffer_idx + 4 > sprite_buffer_len) {\n        commitAndFlush();\n        // batch_state left alone\n        if (sprite_buffer_len !== MAX_VERT_COUNT) {\n          growSpriteBuffer();\n        }\n      }\n\n      let index = sprite_buffer_idx * 8;\n      sprite_buffer_idx += 4;\n\n      // measurably slower:\n      // for (let ii = 0; ii < 32; ++ii) {\n      //   sprite_buffer[index + ii] = elem.data[ii];\n      // }\n      sprite_buffer.set(elem.data, index);\n      count++;\n\n      sprite_freelist.push(elem);\n      let next = elem.next;\n      elem.next = null;\n      elem = next;\n    } while (elem);\n  }\n  return count;\n}\n\nfunction finishDraw() {\n  commitAndFlush();\n  blendModeReset();\n}\n\nexport function spriteDraw() {\n  profilerStart('sprites:draw');\n  drawSetup();\n  profilerStart('drawElem');\n  for (let ii = 0; ii < sprite_queue.length; ++ii) {\n    let elem = sprite_queue[ii];\n    drawElem(elem);\n  }\n  profilerStop('drawElem');\n  sprite_queue.length = 0;\n  finishDraw();\n  profilerStop('sprites:draw');\n}\n\nexport function spriteDrawPartial(z) {\n  profilerStart('sprites:drawPartial');\n  drawSetup();\n  profilerStart('drawElem');\n  for (let ii = 0; ii < sprite_queue.length; ++ii) {\n    let elem = sprite_queue[ii];\n    if (elem.z > z) {\n      sprite_queue = sprite_queue.slice(ii);\n      break;\n    }\n    drawElem(elem);\n  }\n  profilerStop('drawElem');\n  finishDraw();\n  profilerStop('sprites:drawPartial');\n}\n\nexport function buildRects(ws, hs, tex) {\n  let rects = [];\n  let total_w = 0;\n  for (let ii = 0; ii < ws.length; ++ii) {\n    total_w += ws[ii];\n  }\n  let total_h = 0;\n  for (let ii = 0; ii < hs.length; ++ii) {\n    total_h += hs[ii];\n  }\n  let tex_w;\n  let tex_h;\n  if (!tex || nextHighestPowerOfTwo(tex.src_width) === tex.width &&\n    nextHighestPowerOfTwo(tex.src_height) === tex.height\n  ) {\n    // texture is in fact power of two, or assume it will be\n    tex_w = nextHighestPowerOfTwo(total_w);\n    tex_h = nextHighestPowerOfTwo(total_h);\n  } else {\n    // Assume snuggly fitting, use the summed w/h, which might be a multiple of\n    //   the actual w/h, but should be correct relative to the specified `ws` and `hs`\n    tex_w = total_w;\n    tex_h = total_h;\n  }\n  let wh = [];\n  for (let ii = 0; ii < ws.length; ++ii) {\n    wh.push(ws[ii] / total_h);\n  }\n  let hw = [];\n  for (let ii = 0; ii < hs.length; ++ii) {\n    hw.push(hs[ii] / total_w);\n  }\n  let aspect = [];\n  let non_square = false;\n  let y = 0;\n  for (let jj = 0; jj < hs.length; ++jj) {\n    let x = 0;\n    for (let ii = 0; ii < ws.length; ++ii) {\n      let r = vec4(x / tex_w, y / tex_h,\n        (x + ws[ii]) / tex_w, (y + hs[jj]) / tex_h);\n      rects.push(r);\n      let asp = ws[ii] / hs[jj];\n      if (asp !== 1) {\n        non_square = true;\n      }\n      aspect.push(asp);\n      x += ws[ii];\n    }\n    y += hs[jj];\n  }\n  return {\n    widths: ws,\n    heights: hs,\n    wh,\n    hw,\n    rects,\n    aspect: non_square ? aspect : null,\n    total_w,\n    total_h,\n  };\n}\n\nfunction Sprite(params) {\n  if (params.texs) {\n    this.texs = params.texs;\n  } else {\n    let ext = params.ext || '.png';\n    this.texs = [];\n    if (params.tex) {\n      this.texs.push(params.tex);\n    } else if (params.layers) {\n      assert(params.name);\n      this.texs = [];\n      for (let ii = 0; ii < params.layers; ++ii) {\n        this.texs.push(textures.load({\n          url: `img/${params.name}_${ii}${ext}`,\n          filter_min: params.filter_min,\n          filter_mag: params.filter_mag,\n          wrap_s: params.wrap_s,\n          wrap_t: params.wrap_t,\n        }));\n      }\n    } else if (params.name) {\n      this.texs.push(textures.load({\n        url: `img/${params.name}${ext}`,\n        filter_min: params.filter_min,\n        filter_mag: params.filter_mag,\n        wrap_s: params.wrap_s,\n        wrap_t: params.wrap_t,\n      }));\n    } else {\n      assert(params.url);\n      this.texs.push(textures.load(params));\n    }\n  }\n\n  this.origin = params.origin || vec2(0, 0); // [0,1] range\n  this.size = params.size || vec2(1, 1);\n  this.color = params.color || vec4(1,1,1,1);\n  this.uvs = params.uvs || vec4(0, 0, 1, 1);\n  if (!params.uvs) {\n    // Fix up non-power-of-two textures\n    this.texs[0].onLoad((tex) => {\n      this.uvs[2] = tex.src_width / tex.width;\n      this.uvs[3] = tex.src_height / tex.height;\n    });\n  }\n\n  if (params.ws) {\n    this.uidata = buildRects(params.ws, params.hs);\n    this.texs[0].onLoad((tex) => {\n      this.uidata = buildRects(params.ws, params.hs, tex);\n    });\n  }\n  this.shader = params.shader || null;\n}\n\n// params:\n//   required: x, y\n//   optional: z, w, h, uvs, color, nozoom, pixel_perfect\nSprite.prototype.draw = function (params) {\n  if (params.w === 0 || params.h === 0) {\n    return null;\n  }\n  let w = (params.w || 1) * this.size[0];\n  let h = (params.h || 1) * this.size[1];\n  let uvs = (typeof params.frame === 'number') ? this.uidata.rects[params.frame] : (params.uvs || this.uvs);\n  let color = params.color || this.color;\n  qsp.sprite = this;\n  qsp.x = params.x;\n  qsp.y = params.y;\n  qsp.z = params.z || Z.UI;\n  qsp.w = w;\n  qsp.h = h;\n  qsp.rot = params.rot;\n  qsp.uvs = uvs;\n  qsp.color_ul = color;\n  qsp.color_ll = color;\n  qsp.color_lr = color;\n  qsp.color_ur = color;\n  qsp.shader = params.shader || this.shader;\n  qsp.shader_params = params.shader_params;\n  qsp.nozoom = params.nozoom;\n  qsp.pixel_perfect = params.pixel_perfect;\n  qsp.blend = params.blend;\n  return queuesprite4colorObj(qsp);\n};\n\nSprite.prototype.drawDualTint = function (params) {\n  params.shader = sprite_dual_fshader;\n  params.shader_params = {\n    color1: params.color1,\n  };\n  return this.draw(params);\n};\n\nSprite.prototype.draw4Color = function (params) {\n  if (params.w === 0 || params.h === 0) {\n    return null;\n  }\n  let w = (params.w || 1) * this.size[0];\n  let h = (params.h || 1) * this.size[1];\n  let uvs = (typeof params.frame === 'number') ? this.uidata.rects[params.frame] : (params.uvs || this.uvs);\n  qsp.sprite = this;\n  qsp.x = params.x;\n  qsp.y = params.y;\n  qsp.z = params.z || Z.UI;\n  qsp.w = w;\n  qsp.h = h;\n  qsp.rot = params.rot;\n  qsp.uvs = uvs;\n  qsp.color_ul = params.color_ul;\n  qsp.color_ll = params.color_ll;\n  qsp.color_lr = params.color_lr;\n  qsp.color_ur = params.color_ur;\n  qsp.shader = params.shader || this.shader;\n  qsp.shader_params = params.shader_params;\n  qsp.nozoom = params.nozoom;\n  qsp.pixel_perfect = params.pixel_perfect;\n  qsp.blend = params.blend;\n  return queuesprite4colorObj(qsp);\n};\n\nSprite.prototype.draw3D = function (params) {\n  // Note: ignoring this.size[] for now for simplicity, is this useful?\n  // let w = (params.size[0] || 1) * this.size[0];\n  // let h = (params.size[1] || 1) * this.size[1];\n  if (typeof params.frame === 'number') {\n    params.uvs = this.uidata.rects[params.frame];\n  } else if (!params.uvs) {\n    params.uvs = this.uvs;\n  }\n  dynGeomQueueSprite(this, params);\n};\n\n\nexport function spriteCreate(params) {\n  return new Sprite(params);\n}\n\nexport function spriteStartup() {\n  geom_stats = geom.stats;\n  clip_space[2] = -1;\n  clip_space[3] = 1;\n  sprite_vshader = shaders.create('shaders/sprite.vp');\n  sprite_fshader = shaders.create('shaders/sprite.fp');\n  sprite_dual_fshader = shaders.create('shaders/sprite_dual.fp');\n  shaders.prelink(sprite_vshader, sprite_fshader);\n  shaders.prelink(sprite_vshader, sprite_dual_fshader);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nimport assert from 'assert';\nimport { PLATFORM_FBINSTANT } from 'glov/client/client_config';\nimport {\n  chunkedReceiverFinish,\n  chunkedReceiverFreeFile,\n  chunkedReceiverGetFile,\n  chunkedReceiverInit,\n  chunkedReceiverOnChunk,\n  chunkedReceiverStart,\n} from 'glov/common/chunked_send';\nimport * as dot_prop from 'glov/common/dot-prop';\nimport * as md5 from 'glov/common/md5';\nimport { isPacket } from 'glov/common/packet';\nimport { perfCounterAdd } from 'glov/common/perfcounters';\nimport * as EventEmitter from 'glov/common/tiny-events';\nimport * as util from 'glov/common/util';\nimport { errorString } from 'glov/common/util';\nimport { fbGetLoginInfo } from './fbinstant';\nimport * as local_storage from './local_storage';\nimport { netDisconnectedRaw } from './net';\nimport * as walltime from './walltime';\n\n// relevant events:\n//   .on('channel_data', cb(data [, mod_key, mod_value]));\n\nfunction ClientChannelWorker(subs, channel_id, base_handlers, base_event_listeners) {\n  EventEmitter.call(this);\n  this.subs = subs;\n  this.channel_id = channel_id;\n  this.subscriptions = 0;\n  this.subscribe_failed = false;\n  this.got_subscribe = false;\n  this.immediate_subscribe = 0;\n  this.channel_data_ver = 0; // for polling for changes\n  this.handlers = Object.create(base_handlers);\n  this.base_event_listeners = base_event_listeners;\n  this.data = {};\n}\nutil.inherits(ClientChannelWorker, EventEmitter);\n\nClientChannelWorker.prototype.emit = function (event) {\n  // Using `arguments` instead of rest params because Babel is generating pretty\n  //   bloated code and this is a hot path.\n  // eslint-disable-next-line prefer-rest-params\n  let args = arguments;\n  EventEmitter.prototype.emit.apply(this, args);\n  if (this.base_event_listeners) {\n    let listeners = this.base_event_listeners[event];\n    if (listeners) {\n      for (let ii = 0; ii < listeners.length; ++ii) {\n        listeners[ii].apply(this, Array.prototype.slice.call(args, 1));\n      }\n    }\n  }\n};\n\n// cb(data)\nClientChannelWorker.prototype.onSubscribe = function (cb) {\n  assert(this.subscriptions || this.autosubscribed);\n  this.on('subscribe', cb);\n  if (this.got_subscribe) {\n    cb(this.data);\n  }\n};\n\n// cb(data)\nClientChannelWorker.prototype.onceSubscribe = function (cb) {\n  assert(this.subscriptions || this.autosubscribed);\n  if (this.got_subscribe) {\n    cb(this.data);\n  } else {\n    this.once('subscribe', cb);\n  }\n};\n\nClientChannelWorker.prototype.numSubscriptions = function () {\n  return this.subscriptions;\n};\n\nClientChannelWorker.prototype.handleChannelData = function (data, resp_func) {\n  console.log(`got channel_data(${this.channel_id}):  ${JSON.stringify(data)}`);\n  this.data = data;\n  ++this.channel_data_ver;\n  this.emit('channel_data', this.data);\n  this.got_subscribe = true;\n  this.emit('subscribe', this.data);\n\n  // Get command list upon first connect\n  let channel_type = this.channel_id.split('.')[0];\n  let cmd_list = this.subs.cmds_fetched_by_type;\n  if (cmd_list && !cmd_list[channel_type]) {\n    cmd_list[channel_type] = true;\n    this.send('cmdparse', 'cmd_list', (err, resp) => {\n      if (err) { // already unsubscribed?\n        console.error(`Error getting cmd_list for ${channel_type}`);\n        delete cmd_list[channel_type];\n      } else {\n        this.subs.cmd_parse.addServerCommands(resp);\n      }\n    });\n  }\n\n  resp_func();\n};\n\nClientChannelWorker.prototype.handleApplyChannelData = function (data, resp_func) {\n  // already logged in handleChannelMessage\n  // if (!data.q) {\n  //   console.log(`got channel data mod: ${JSON.stringify(data)}`);\n  // }\n  if (data.value === undefined) {\n    dot_prop.delete(this.data, data.key);\n  } else {\n    dot_prop.set(this.data, data.key, data.value);\n  }\n  ++this.channel_data_ver;\n  this.emit('channel_data', this.data, data.key, data.value);\n  resp_func();\n};\n\nClientChannelWorker.prototype.handleBatchSet = function (data, resp_func) {\n  for (let ii = 0; ii < data.length; ++ii) {\n    let [key, value] = data[ii];\n    if (value === undefined) {\n      dot_prop.delete(this.data.public, key);\n    } else {\n      dot_prop.set(this.data.public, key, value);\n    }\n    // Question: Should this just be one event at the end?\n    ++this.channel_data_ver;\n    this.emit('channel_data', this.data, `public.${key}`, value);\n  }\n  resp_func();\n};\n\nClientChannelWorker.prototype.getChannelData = function (key, default_value) {\n  return dot_prop.get(this.data, key, default_value);\n};\n\nClientChannelWorker.prototype.setChannelData = function (key, value, skip_predict, resp_func) {\n  if (!skip_predict) {\n    dot_prop.set(this.data, key, value);\n  }\n  let q = value && value.q || undefined;\n  let pak = this.subs.client.pak('set_channel_data');\n  pak.writeAnsiString(this.channel_id);\n  pak.writeBool(q);\n  pak.writeAnsiString(key);\n  pak.writeJSON(value);\n  pak.send(resp_func);\n};\n\nClientChannelWorker.prototype.removeMsgHandler = function (msg, cb) {\n  assert(this.handlers[msg] === cb);\n  delete this.handlers[msg];\n};\n\nClientChannelWorker.prototype.onMsg = function (msg, cb) {\n  assert(!this.handlers[msg] || this.handlers[msg] === cb);\n  this.handlers[msg] = cb;\n};\n\nClientChannelWorker.prototype.pak = function (msg) {\n  let pak = this.subs.client.pak('channel_msg');\n  pak.writeAnsiString(this.channel_id);\n  pak.writeAnsiString(msg);\n  // pak.writeInt(flags);\n  return pak;\n};\n\nClientChannelWorker.prototype.send = function (msg, data, resp_func, old_fourth) {\n  assert(!resp_func || typeof resp_func === 'function');\n  assert(!old_fourth);\n  this.subs.client.send('channel_msg', {\n    channel_id: this.channel_id,\n    msg, data,\n  }, resp_func);\n};\n\nClientChannelWorker.prototype.cmdParse = function (cmd, resp_func) {\n  this.send('cmdparse', cmd, resp_func);\n};\n\nClientChannelWorker.prototype.unsubscribe = function () {\n  this.subs.unsubscribe(this.channel_id);\n};\n\nfunction SubscriptionManager(client, cmd_parse) {\n  EventEmitter.call(this);\n  this.client = client;\n  this.channels = {};\n  this.logged_in = false;\n  this.login_credentials = null;\n  this.logged_in_username = null;\n  this.logged_in_display_name = null;\n  this.was_logged_in = false;\n  this.logging_in = false;\n  this.logging_out = false;\n  this.auto_create_user = false;\n  this.allow_anon = false;\n  this.no_auto_login = false;\n  this.cmd_parse = cmd_parse;\n  if (cmd_parse) {\n    this.cmds_fetched_by_type = {};\n  }\n  this.base_handlers = {};\n  this.channel_handlers = {}; // channel type -> msg -> handler\n  this.channel_event_listeners = {}; // channel type -> event -> array of listeners\n\n  this.first_connect = true;\n  this.server_time = 0;\n  this.server_time_interp = 0;\n  this.cack_data = {};\n  client.onMsg('connect', this.handleConnect.bind(this));\n  client.onMsg('disconnect', this.handleDisconnect.bind(this));\n  client.onMsg('channel_msg', this.handleChannelMessage.bind(this));\n  client.onMsg('server_time', this.handleServerTime.bind(this));\n  client.onMsg('chat_broadcast', this.handleChatBroadcast.bind(this));\n  client.onMsg('restarting', this.handleRestarting.bind(this));\n  if (cmd_parse) {\n    client.onMsg('csr_to_client', this.handleCSRToClient.bind(this));\n  }\n  this.chunked = null;\n  client.onMsg('upload_start', this.handleUploadStart.bind(this));\n  client.onMsg('upload_chunk', this.handleUploadChunk.bind(this));\n  client.onMsg('upload_finish', this.handleUploadFinish.bind(this));\n  // Add handlers for all channel types\n  this.onChannelMsg(null, 'channel_data', ClientChannelWorker.prototype.handleChannelData);\n  this.onChannelMsg(null, 'apply_channel_data', ClientChannelWorker.prototype.handleApplyChannelData);\n  this.onChannelMsg(null, 'batch_set', ClientChannelWorker.prototype.handleBatchSet);\n}\nutil.inherits(SubscriptionManager, EventEmitter);\n\nSubscriptionManager.prototype.onceConnected = function (cb) {\n  if (this.client.connected && this.client.socket.readyState === 1) {\n    return void cb();\n  }\n  this.once('connect', cb);\n};\n\nSubscriptionManager.prototype.getBaseHandlers = function (channel_type) {\n  let handlers = this.channel_handlers[channel_type];\n  if (!handlers) {\n    handlers = this.channel_handlers[channel_type] = Object.create(this.base_handlers);\n  }\n  return handlers;\n};\n\nSubscriptionManager.prototype.onChannelMsg = function (channel_type, msg, cb) {\n  let handlers = channel_type ? this.getBaseHandlers(channel_type) : this.base_handlers;\n  assert(!handlers[msg]);\n  handlers[msg] = cb;\n};\n\nSubscriptionManager.prototype.onChannelEvent = function (channel_type, event, cb) {\n  let listeners = this.channel_event_listeners[channel_type];\n  if (!listeners) {\n    listeners = this.channel_event_listeners[channel_type] = {};\n  }\n  if (!listeners[event]) {\n    listeners[event] = [];\n  }\n  listeners[event].push(cb);\n};\n\nSubscriptionManager.prototype.handleChatBroadcast = function (data) {\n  console.error(`[${data.src}] ${data.msg}`);\n  this.emit('chat_broadcast', data);\n};\n\nSubscriptionManager.prototype.handleRestarting = function (data) {\n  this.restarting = data;\n  this.emit('restarting', data);\n};\n\nSubscriptionManager.prototype.handleDisconnect = function (data) {\n  this.emit('disconnect', data);\n};\n\nSubscriptionManager.prototype.handleConnect = function (data) {\n  let reconnect = false;\n  if (this.first_connect) {\n    this.first_connect = false;\n  } else {\n    reconnect = true;\n  }\n  this.restarting = Boolean(data.restarting);\n  this.cack_data = data;\n  walltime.sync(data.time);\n\n  if (netDisconnectedRaw()) {\n    // we got disconnected while trying to log in, we'll retry after reconnecting\n    return;\n  }\n\n  let subs = this;\n  function resub() {\n    // (re-)subscribe to all channels\n    for (let channel_id in subs.channels) {\n      let channel = subs.channels[channel_id];\n      if (channel.subscriptions) {\n        subs.client.send('subscribe', channel_id, function (err) {\n          if (err) {\n            channel.subscribe_failed = true;\n            console.error(`Error subscribing to ${channel_id}: ${err}`);\n            channel.emit('subscribe_fail', err);\n          }\n        });\n      }\n    }\n    subs.emit('connect', reconnect);\n  }\n\n  if (this.logging_in) {\n    // already have a login in-flight, it should error before we try again\n  } else if (this.was_logged_in) {\n    // Try to re-connect to existing login\n    this.loginInternal(this.login_credentials, (err) => {\n      if (err && err === 'ERR_FAILALL_DISCONNECT') {\n        // we got disconnected while trying to log in, we'll retry after reconnection\n      } else if (err) {\n        // Error logging in upon re-connection, no good way to handle this?\n        // TODO: Show some message to the user and prompt them to refresh?  Stay in \"disconnected\" state?\n        let credentials_str = this.login_credentials && this.login_credentials.password ?\n          'user_id, password' :\n          JSON.stringify(this.login_credentials);\n        assert(false, `Login failed for ${credentials_str}: ${errorString(err)}`);\n      } else {\n        resub();\n      }\n    });\n  } else if (!this.no_auto_login) {\n    // Try auto-login\n    let auto_login_enabled = PLATFORM_FBINSTANT;\n\n    if (auto_login_enabled) {\n      let login_cb = () => {\n        // ignore error on auto-login\n      };\n      if (PLATFORM_FBINSTANT) {\n        this.loginFacebook(login_cb);\n      }\n    } else if (local_storage.get('name') && local_storage.get('password')) {\n      this.login(local_storage.get('name'), local_storage.get('password'), function () {\n        // ignore error on auto-login\n      });\n    }\n\n    resub();\n  } else {\n    resub();\n  }\n\n  this.fetchCmds();\n};\n\nSubscriptionManager.prototype.fetchCmds = function () {\n  let channel_type = 'client';\n  let cmd_list = this.cmds_fetched_by_type;\n  if (cmd_list && !cmd_list[channel_type]) {\n    cmd_list[channel_type] = true;\n    this.client.send('cmd_parse_list_client', null, (err, resp) => {\n      if (!err) {\n        this.cmd_parse.addServerCommands(resp);\n      }\n    });\n  }\n};\n\nSubscriptionManager.prototype.handleChannelMessage = function (pak, resp_func) {\n  assert(isPacket(pak));\n  let channel_id = pak.readAnsiString();\n  let msg = pak.readAnsiString();\n  let is_packet = pak.readBool();\n  let data = is_packet ? pak : pak.readJSON();\n  if (!data || !data.q) {\n    let debug_msg;\n    if (!is_packet) {\n      debug_msg = JSON.stringify(data);\n    } else if (typeof data.contents === 'function') {\n      debug_msg = data.contents();\n    } else {\n      debug_msg = '(pak)';\n    }\n    console.log(`got channel_msg(${channel_id}) ${msg}: ${debug_msg}`);\n  }\n  let channel = this.getChannel(channel_id);\n  let handler = channel.handlers[msg];\n  if (!handler) {\n    console.error(`no handler for channel_msg(${channel_id}) ${msg}: ${JSON.stringify(data)}`);\n    return;\n  }\n  let msg_name = `${channel_id.split('.')[0]}.${msg}`;\n  perfCounterAdd(`cm.${msg_name}`);\n  profilerStart(msg_name);\n  handler.call(channel, data, resp_func);\n  profilerStop(msg_name);\n};\n\nSubscriptionManager.prototype.handleServerTime = function (pak) {\n  this.server_time = pak.readInt();\n  if (this.server_time < this.server_time_interp && this.server_time > this.server_time_interp - 250) {\n    // slight time travel backwards, this one packet must have been delayed,\n    // since we once got a packet quicker. Just ignore this, interpolate from\n    // where we were before\n    // TODO: If the server had a short stall (less than 250ms) we might be\n    // ahead from now on!  Slowly interp back to the specified time\n    // (run speed at 90% until it matches?, same thing for catching up to\n    // small jumps ahead)\n  } else {\n    this.server_time_interp = this.server_time;\n  }\n  walltime.sync(pak.readInt());\n};\n\n// DEPRECATED: Not actually a useful unit of time, if your client worker is on a\n//   different process than a particular game worker.\nSubscriptionManager.prototype.getServerTime = function () {\n  // Interpolated server time as of start of last tick\n  return this.server_time_interp;\n};\n\nSubscriptionManager.prototype.tick = function (dt) {\n  this.server_time_interp += dt;\n  for (let channel_id in this.channels) {\n    let channel = this.channels[channel_id];\n    if (channel.immediate_subscribe) {\n      if (dt >= channel.immediate_subscribe) {\n        channel.immediate_subscribe = 0;\n        this.unsubscribe(channel_id);\n      } else {\n        channel.immediate_subscribe -= dt;\n      }\n    }\n  }\n};\n\n\nSubscriptionManager.prototype.onUploadProgress = function (mime_type, cb) {\n  if (!this.upload_progress_cbs) {\n    this.upload_progress_cbs = {};\n  }\n  assert(!this.upload_progress_cbs[mime_type]);\n  this.upload_progress_cbs[mime_type] = cb;\n  if (!this.chunked) {\n    this.chunked = chunkedReceiverInit('client_receive', Infinity);\n  }\n  if (!this.chunked.on_progress) {\n    this.chunked.on_progress = (progress, total, type) => {\n      if (this.upload_progress_cbs[type]) {\n        this.upload_progress_cbs[type](progress, total);\n      }\n    };\n  }\n};\n\nSubscriptionManager.prototype.handleUploadStart = function (pak, resp_func) {\n  if (!this.chunked) {\n    this.chunked = chunkedReceiverInit('client_receive', Infinity);\n  }\n  chunkedReceiverStart(this.chunked, pak, resp_func);\n};\n\nSubscriptionManager.prototype.handleUploadChunk = function (pak, resp_func) {\n  chunkedReceiverOnChunk(this.chunked, pak, resp_func);\n};\n\nSubscriptionManager.prototype.handleUploadFinish = function (pak, resp_func) {\n  chunkedReceiverFinish(this.chunked, pak, resp_func);\n};\n\nSubscriptionManager.prototype.uploadGetFile = function (file_id) {\n  return chunkedReceiverGetFile(this.chunked, file_id);\n};\n\nSubscriptionManager.prototype.uploadFreeFile = function (file_data) {\n  return chunkedReceiverFreeFile(file_data);\n};\n\n\nSubscriptionManager.prototype.subscribe = function (channel_id) {\n  this.getChannel(channel_id, true);\n};\n\nSubscriptionManager.prototype.getChannel = function (channel_id, do_subscribe) {\n  let channel = this.channels[channel_id];\n  if (!channel) {\n    let channel_type = channel_id.split('.')[0];\n    let handlers = this.getBaseHandlers(channel_type);\n    let event_listeners = this.channel_event_listeners[channel_type];\n    channel = this.channels[channel_id] = new ClientChannelWorker(this, channel_id, handlers, event_listeners);\n  }\n  if (do_subscribe) {\n    channel.subscriptions++;\n    if (!netDisconnectedRaw() && channel.subscriptions === 1) {\n      channel.subscribe_failed = false;\n      this.client.send('subscribe', channel_id, function (err) {\n        if (err) {\n          channel.subscribe_failed = true;\n          console.error(`Error subscribing to ${channel_id}: ${err}`);\n          channel.emit('subscribe_fail', err);\n        }\n      });\n    }\n  }\n  return channel;\n};\n\nSubscriptionManager.prototype.getUserId = function () {\n  return this.loggedIn();\n};\n\nSubscriptionManager.prototype.getDisplayName = function () {\n  return this.logged_in_display_name;\n};\n\nSubscriptionManager.prototype.getMyUserChannel = function () {\n  let user_id = this.loggedIn();\n  if (!user_id) {\n    return null;\n  }\n  let channel = this.getChannel(`user.${user_id}`);\n  if (!this.logging_out) {\n    channel.autosubscribed = true;\n  }\n  return channel;\n};\n\nSubscriptionManager.prototype.unsubscribe = function (channel_id) {\n  let channel = this.channels[channel_id];\n  assert(channel);\n  assert(channel.subscriptions);\n  channel.subscriptions--;\n  if (!channel.subscriptions) {\n    channel.got_subscribe = false;\n  }\n  if (!netDisconnectedRaw() && !channel.subscriptions && !channel.subscribe_failed) {\n    this.client.send('unsubscribe', channel_id);\n  }\n};\n\n// Immediate-mode channel subscription; will unsubscribe automatically on logout\n//   or if not accessed for some time\nSubscriptionManager.prototype.getChannelImmediate = function (channel_id, timeout) {\n  timeout = timeout || 60000;\n  let channel = this.getChannel(channel_id);\n  if (!channel.immediate_subscribe) {\n    this.subscribe(channel_id);\n  }\n  channel.immediate_subscribe = timeout;\n  return channel;\n};\n\nSubscriptionManager.prototype.onLogin = function (cb) {\n  this.on('login', cb);\n  if (this.logged_in) {\n    return void cb();\n  }\n};\n\nSubscriptionManager.prototype.loggedIn = function () {\n  return this.logging_out ? false : this.logged_in ? this.logged_in_username || 'missing_name' : false;\n};\n\nSubscriptionManager.prototype.userOnChannelData = function (expected_user_id, data, key, value) {\n  if (expected_user_id !== this.getUserId()) {\n    // must have logged out\n    return;\n  }\n  if (key === 'public.display_name') {\n    this.logged_in_display_name = value;\n  }\n};\n\nSubscriptionManager.prototype.handleLoginResponse = function (resp_func, err, resp) {\n  this.logging_in = false;\n  if (!err) {\n    this.logged_in_username = resp.user_id;\n    this.logged_in_display_name = resp.display_name;\n    this.logged_in = true;\n    this.was_logged_in = true;\n    let user_channel = this.getMyUserChannel(); // auto-subscribe to it\n    user_channel.onceSubscribe(() => {\n      if (!this.did_master_subscribe && user_channel.getChannelData('public.permissions.sysadmin')) {\n        // For cmd_parse access\n        this.did_master_subscribe = true;\n        this.subscribe('master.master');\n        this.subscribe('global.global');\n      }\n    });\n\n    if (!user_channel.subs_added_user_on_channel_data) {\n      user_channel.on('channel_data', this.userOnChannelData.bind(this, this.logged_in_username));\n      user_channel.subs_added_user_on_channel_data = true;\n    }\n    this.emit('login');\n  } else {\n    this.emit('login_fail', err);\n  }\n  resp_func(err);\n};\n\nSubscriptionManager.prototype.loginInternal = function (login_credentials, resp_func) {\n  if (this.logging_in) {\n    return void resp_func('Login already in progress');\n  }\n  this.logging_in = true;\n  this.logged_in = false;\n\n  if (login_credentials.fb) {\n    fbGetLoginInfo((err, result) => {\n      if (err) {\n        return void this.handleLoginResponse(resp_func, err);\n      }\n      if (netDisconnectedRaw()) {\n        return void this.handleLoginResponse(resp_func, 'ERR_DISCONNECTED');\n      }\n      this.client.send('login_facebook_instant', result, this.handleLoginResponse.bind(this, resp_func));\n    });\n  } else {\n    this.client.send('login', {\n      user_id: login_credentials.user_id,\n      password: md5(this.client.secret + login_credentials.password),\n    }, this.handleLoginResponse.bind(this, resp_func));\n  }\n};\n\nSubscriptionManager.prototype.userCreateInternal = function (params, resp_func) {\n  if (this.logging_in) {\n    return resp_func('Login already in progress');\n  }\n  this.logging_in = true;\n  this.logged_in = false;\n  return this.client.send('user_create', params, this.handleLoginResponse.bind(this, resp_func));\n};\n\nfunction hashedPassword(user_id, password) {\n  if (password.split('$$')[0] === 'prehashed') {\n    password = password.split('$$')[1];\n  } else {\n    password = md5(md5(user_id.toLowerCase()) + password);\n  }\n  return password;\n}\n\n\nSubscriptionManager.prototype.login = function (username, password, resp_func) {\n  username = (username || '').trim();\n  if (!username) {\n    return resp_func('Missing username');\n  }\n  password = (password || '').trim();\n  if (!password) {\n    return resp_func('Missing password');\n  }\n  let hashed_password = hashedPassword(username, password);\n  if (hashed_password !== password) {\n    local_storage.set('password', `prehashed$$${hashed_password}`);\n  }\n  this.login_credentials = { user_id: username, password: hashed_password };\n  if (!this.auto_create_user) {\n    // Just return result directly\n    return this.loginInternal(this.login_credentials, resp_func);\n  }\n  return this.loginInternal(this.login_credentials, (err, data) => {\n    if (!err || err !== 'ERR_USER_NOT_FOUND') {\n      return void resp_func(err, data);\n    }\n    // user not found, auto-create\n    this.userCreate({\n      user_id: username,\n      password,\n      password_confirm: password,\n      email: 'autocreate@glovjs.org',\n    }, resp_func);\n  });\n};\n\nSubscriptionManager.prototype.loginFacebook = function (resp_func) {\n  this.login_credentials = { fb: true };\n  return this.loginInternal(this.login_credentials, resp_func);\n};\n\nSubscriptionManager.prototype.userCreate = function (params, resp_func) {\n  params.user_id = (params.user_id || '').trim();\n  if (!params.user_id) {\n    return resp_func('Missing username');\n  }\n  params.password = (params.password || '').trim();\n  if (!params.password) {\n    return resp_func('Missing password');\n  }\n  params.password_confirm = (params.password_confirm || '').trim();\n  if (!this.auto_create_user && !params.password_confirm) {\n    return resp_func('Missing password confirmation');\n  }\n  params.email = (params.email || '').trim();\n  if (!this.auto_create_user && !params.email) {\n    return resp_func('Missing email');\n  }\n  params.display_name = (params.display_name || '').trim();\n  let hashed_password = hashedPassword(params.user_id, params.password);\n  if (hashed_password !== params.password) {\n    local_storage.set('password', `prehashed$$${hashed_password}`);\n  }\n  let hashed_password_confirm = hashedPassword(params.user_id, params.password_confirm);\n  if (hashed_password !== hashed_password_confirm) {\n    return resp_func('Passwords do not match');\n  }\n  this.login_credentials = { user_id: params.user_id, password: hashed_password };\n  return this.userCreateInternal({\n    display_name: params.display_name || params.user_id,\n    user_id: params.user_id,\n    email: params.email,\n    password: hashed_password,\n  }, resp_func);\n};\n\n\nSubscriptionManager.prototype.logout = function () {\n  assert(this.logged_in);\n  assert(!this.logging_in);\n  assert(!this.logging_out);\n  // Don't know how to gracefully handle logging out with app-level subscriptions\n  //   currently, clean up those we can, assert we have no others\n  if (this.did_master_subscribe) {\n    this.did_master_subscribe = false;\n    this.unsubscribe('master.master');\n    this.unsubscribe('global.global');\n  }\n  for (let channel_id in this.channels) {\n    let channel = this.channels[channel_id];\n    if (channel.immediate_subscribe) {\n      channel.immediate_subscribe = 0;\n      this.unsubscribe(channel_id);\n    }\n    assert(!channel.subscriptions, `Remaining active subscription for ${channel_id}`);\n    if (channel.autosubscribed) {\n      channel.autosubscribed = false;\n    }\n  }\n\n  this.logging_out = true;\n  this.client.send('logout', null, (err) => {\n    this.logging_out = false;\n    if (!err) {\n      local_storage.set('password', undefined);\n      this.logged_in = false;\n      this.logged_in_username = null;\n      this.logged_in_display_name = null;\n      this.was_logged_in = false;\n      this.login_credentials = null;\n      this.emit('logout');\n    }\n  });\n};\n\nSubscriptionManager.prototype.serverLog = function (type, data) {\n  this.onceConnected(() => {\n    this.client.send('log', { type, data });\n  });\n};\n\nSubscriptionManager.prototype.sendCmdParse = function (command, resp_func) {\n  this.onceConnected(() => {\n    let pak = this.client.pak('cmd_parse_auto');\n    pak.writeString(command);\n    pak.send(resp_func);\n  });\n};\n\nSubscriptionManager.prototype.handleCSRToClient = function (pak, resp_func) {\n  let cmd = pak.readString();\n  let access = pak.readJSON();\n  this.cmd_parse.handle({ access }, cmd, (err, resp) => {\n    if (err && this.cmd_parse.was_not_found) {\n      // bounce back to server\n      return resp_func(null, { found: 0, err });\n    }\n    return resp_func(err, { found: 1, resp });\n  });\n};\n\nexport function create(client, cmd_parse) {\n  return new SubscriptionManager(client, cmd_parse);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/*eslint no-bitwise:off */\n\nimport * as assert from 'assert';\nconst { abs, floor, max, min } = Math;\nimport { clamp } from 'glov/common/util.js';\nimport { vec4 } from 'glov/common/vmath.js';\nimport * as engine from './engine.js';\nimport * as glov_font from './font.js';\nimport * as input from './input.js';\nimport * as ui from './ui.js';\n\nZ.BACKGROUND = Z.BACKGROUND || 1;\n\nconst { KEYS } = input;\n\nconst mode_regex1 = /^((?:\\d+;)*\\d+m)/u;\nconst mode_regex2 = /(\\d+)[;m]/gu;\nconst ESC = '\\u001b';\nconst ansi_to_unicode = [\n  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\n  0,0,0,0,0,0,0,0,0,0,0,199,252,233,226,228,224,229,231,234,235,232,239,238,236,\n  196,197,201,230,198,244,246,242,251,249,255,214,220,162,163,165,8359,402,225,\n  237,243,250,241,209,170,186,191,8976,172,189,188,161,171,187,9617,9618,9619,\n  9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,\n  9516,9500,9472,9532,9566,9567,9562,9556,9577,9574,9568,9552,9580,9575,9576,\n  9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,9604,9612,9616,9600,\n  945,223,915,960,931,963,181,964,934,920,937,948,8734,966,949,8745,8801,177,\n  8805,8804,8992,8993,247,8776,176,8729,183,8730,8319,178,9632,160\n];\n\nconst MOD_CH = 1;\nconst MOD_SCROLL = 2;\nconst MOD_CLEAR = 3;\nconst MOD_CLEAREOL = 4;\n\nconst ansi_to_vga = [\n  0, // black\n  4, // red\n  2, // green\n  6, // yellow\n  1, // blue\n  5, // magenta\n  3, // cyan\n  7, // white\n];\n\nfunction toch(ch) {\n  if (typeof ch === 'string') {\n    let idx = ch.charCodeAt(0);\n    if (ansi_to_unicode[idx]) {\n      return String.fromCharCode(ansi_to_unicode[idx]);\n    } else {\n      return ch;\n    }\n  }\n  if (typeof ch === 'number') {\n    return String.fromCharCode(ansi_to_unicode[ch] || ch);\n  } else {\n    return String(ch)[0] || ' ';\n  }\n}\nconst ATTR = {\n  BLINK: 1,\n  UNDERLINE: 2, // unimplemented\n  REVERSE: 4, // unimplemented\n  NUM_BITS: 3,\n};\n\nclass CharInfo {\n  constructor(fg, bg, attr) {\n    this.ch = ' ';\n    this.fg = fg;\n    this.bg = bg;\n    this.attr = attr;\n  }\n}\n\nclass GlovTerminal {\n  constructor(params) {\n    params = params || {};\n    this.baud = params.baud ?? 9600;\n    this.frame = 0;\n    this.draw_cursor = params.draw_cursor ?? [1,4];\n    // screen buffer\n    this.render_x = params.x || 0;\n    this.render_y = params.y || 0;\n    this.render_z = params.z || Z.BACKGROUND;\n    this.w = params.w || 80;\n    this.h = params.h || 25;\n    // cursor\n    this.x = 0;\n    this.y = 0;\n    this.fg = 7;\n    this.bg = 0;\n    this.attr = 0;\n    this.saved_x = 0;\n    this.saved_y = 0;\n    this.playback = {\n      x: 0,\n      y: 0,\n      fg: 7,\n      bg: 0,\n      attr: 0,\n    };\n    this.mod_head = null;\n    this.mod_tail = null;\n    this.mod_countdown = 0;\n    // Current sub-view\n    this.sub_view = null; // { x, y, w, h }\n    this.x0 = 0;\n    this.y0 = 0;\n    this.x1 = this.w;\n    this.y1 = this.h;\n\n    this.palette = params.palette || [\n      vec4(0/64,0/64,0/63,1),\n      vec4(0/64,0/64,42/63,1),\n      vec4(0/64,42/64,0/63,1),\n      vec4(0/64,42/64,42/63,1),\n      vec4(42/64,0/64,0/63,1),\n      vec4(42/64,0/64,42/63,1),\n      vec4(42/64,21/64,0/63,1),\n      vec4(42/64,42/64,42/63,1),\n      vec4(18/64,18/64,18/63,1),\n      vec4(21/64,21/64,63/63,1),\n      vec4(21/64,63/64,21/63,1),\n      vec4(21/64,63/64,63/63,1),\n      vec4(63/64,21/64,21/63,1),\n      vec4(63/64,21/64,63/63,1),\n      vec4(63/64,63/64,21/63,1),\n      vec4(63/64,63/64,63/63,1),\n    ];\n    this.font_styles = [];\n    for (let ii = 0; ii < this.palette.length; ++ii) {\n      this.font_styles.push(glov_font.style(null, {\n        color: glov_font.intColorFromVec4Color(this.palette[ii]),\n      }));\n    }\n    this.char_width = params.char_width || 9;\n    this.char_height = params.char_height || 16;\n    this.font = params.font || engine.font;\n    this.auto_scroll = params.auto_scroll ?? true;\n    this.buffer = new Array(this.h);\n    this.prebuffer = new Array(this.h); // before applying the mods\n    for (let ii = 0; ii < this.h; ++ii) {\n      this.buffer[ii] = new Array(this.w);\n      this.prebuffer[ii] = new Array(this.w);\n      for (let jj = 0; jj < this.w; ++jj) {\n        this.buffer[ii][jj] = new CharInfo(this.fg, this.bg, this.attr);\n        this.prebuffer[ii][jj] = new CharInfo(this.fg, this.bg, this.attr);\n      }\n    }\n  }\n\n  domod(buffer, mod) {\n    let mod_playback = buffer === this.buffer;\n    switch (mod.type) { // eslint-disable-line default-case\n      case MOD_CH:\n        buffer[mod.y][mod.x].ch = mod.ch;\n        buffer[mod.y][mod.x].attr = mod.attr;\n        buffer[mod.y][mod.x].fg = mod.fg;\n        buffer[mod.y][mod.x].bg = mod.bg;\n        if (mod_playback) {\n          this.playback.x = mod.x + 1;\n          this.playback.y = mod.y;\n        }\n        break;\n      case MOD_SCROLL:\n        if (mod.sub_view) {\n          let x1 = mod.sub_view.x + mod.sub_view.w;\n          let y1 = mod.sub_view.y + mod.sub_view.h;\n          for (let yy = mod.sub_view.y; yy < y1 - 1; ++yy) {\n            let rout = buffer[yy];\n            let rin = buffer[yy+1];\n            for (let xx = mod.sub_view.x; xx < x1; ++xx) {\n              rout[xx] = rin[xx];\n            }\n          }\n          let row = buffer[y1 - 1];\n          for (let xx = mod.sub_view.x; xx < x1; ++xx) {\n            row[xx] = new CharInfo(mod.fg, mod.bg, 0);\n          }\n        } else {\n          let row = buffer[0];\n          buffer.splice(0, 1);\n          buffer.push(row);\n          for (let ii = 0; ii < row.length; ++ii) {\n            row[ii].fg = mod.fg;\n            row[ii].bg = mod.bg;\n            row[ii].ch = ' ';\n            row[ii].attr = 0;\n          }\n        }\n        break;\n      case MOD_CLEAR:\n        if (mod.sub_view) {\n          for (let ii = mod.sub_view.y; ii < mod.sub_view.y + mod.sub_view.h; ++ii) {\n            let line = buffer[ii];\n            for (let jj = mod.sub_view.x; jj < mod.sub_view.x + mod.sub_view.w; ++jj) {\n              line[jj].attr = mod.attr;\n              line[jj].fg = mod.fg;\n              line[jj].bg = mod.bg;\n              line[jj].ch = ' ';\n            }\n          }\n        } else {\n          for (let ii = 0; ii < this.h; ++ii) {\n            let line = buffer[ii];\n            for (let jj = 0; jj < this.w; ++jj) {\n              line[jj].attr = mod.attr;\n              line[jj].fg = mod.fg;\n              line[jj].bg = mod.bg;\n              line[jj].ch = ' ';\n            }\n          }\n        }\n        if (mod_playback) {\n          this.playback.x = this.playback.y = 0;\n        }\n        break;\n      case MOD_CLEAREOL: {\n        assert(!mod.sub_view); // Not yet implemented\n        let line = buffer[mod.y];\n        for (let jj = mod.x; jj < this.w; ++jj) {\n          line[jj].ch = ' ';\n          line[jj].attr = 0;\n          line[jj].fg = mod.fg;\n          line[jj].bg = mod.bg;\n        }\n        if (mod_playback) {\n          this.playback.x = this.w;\n          this.playback.y = mod.y;\n        }\n      } break;\n    }\n    if (mod_playback) {\n      this.playback.timestamp = engine.getFrameTimestamp();\n      if (this.playback.x >= this.w) {\n        this.playback.x = 0;\n        this.playback.y++;\n      }\n      if (this.playback.y >= this.h) {\n        this.playback.y = this.h - 1;\n      }\n    }\n  }\n\n  mod(type, ch) {\n    let mod = {\n      type,\n      ch,\n      x: this.x,\n      y: this.y,\n      fg: this.fg,\n      bg: this.bg,\n      attr: this.attr,\n      sub_view: this.sub_view,\n    };\n    if (type === MOD_CH) {\n      let char_info = this.prebuffer[mod.y][mod.x];\n      if (char_info.ch === ch &&\n        char_info.fg === mod.fg &&\n        char_info.bg === mod.bg &&\n        char_info.attr === mod.attr\n      ) {\n        // no change, discard mod\n        return;\n      }\n    }\n    this.domod(this.prebuffer, mod);\n    if (!this.baud) {\n      this.domod(this.buffer, mod);\n      return;\n    }\n    if (this.mod_tail) {\n      this.mod_tail.next = mod;\n      this.mod_tail = mod;\n    } else {\n      this.mod_head = this.mod_tail = mod;\n    }\n  }\n\n  normal() {\n    this.color(7, 0);\n    this.attr = 0;\n  }\n\n  color(fg, bg) {\n    if (typeof fg === 'number') {\n      this.fg = fg;\n    }\n    if (typeof bg === 'number') {\n      this.bg = bg;\n    }\n  }\n\n  moveto(x, y) {\n    if (typeof x === 'number') {\n      this.x = this.x0 + x;\n    }\n    if (typeof y === 'number') {\n      this.y = this.y0 + y;\n    }\n    this.checkwrap();\n  }\n  offset(x, y) {\n    if (typeof x === 'number') {\n      this.x += x;\n    }\n    if (typeof y === 'number') {\n      this.y += y;\n    }\n    this.checkwrap();\n  }\n  autoScroll(b) {\n    this.auto_scroll = b;\n  }\n  checkwrap() {\n    if (this.x < this.x0) {\n      this.x = this.x0;\n    }\n    if (this.x >= this.x1) {\n      this.x = this.x0;\n      this.y++;\n    }\n    if (this.y >= this.y1) {\n      this.y = this.y1 - 1;\n      if (this.auto_scroll) {\n        this.mod(MOD_SCROLL);\n      }\n    }\n  }\n  cr() {\n    this.x = this.x0;\n    this.checkwrap();\n  }\n  lf() {\n    this.y++;\n    this.checkwrap();\n  }\n  crlf() {\n    this.x = this.x0;\n    this.y++;\n    this.checkwrap();\n  }\n  clear() {\n    this.moveto(0, 0);\n    this.mod(MOD_CLEAR);\n  }\n  cleareol() {\n    this.mod(MOD_CLEAREOL);\n    this.x = this.w; // probably?\n    this.checkwrap();\n  }\n\n  subViewPush(sub_view) {\n    assert(!this.sub_view);\n    if (sub_view.cursor_x) {\n      this.moveto(sub_view.cursor_x, sub_view.cursor_y);\n    }\n    this.sub_view = sub_view;\n    this.x0 = sub_view.x || 0;\n    this.y0 = sub_view.y || 0;\n    this.x1 = sub_view.x + sub_view.w;\n    this.y1 = sub_view.y + sub_view.h;\n  }\n  subViewPop() {\n    assert(this.sub_view);\n    this.sub_view.cursor_x = this.x;\n    this.sub_view.cursor_y = this.y;\n    this.sub_view = null;\n    this.x0 = this.y0 = 0;\n    this.x1 = this.w;\n    this.y1 = this.h;\n  }\n\n  print(params) {\n    this.moveto(params.x, params.y);\n    this.color(params.fg, params.bg);\n    let text = params.text || '';\n    if (text && !text.length) {\n      text = [text];\n    }\n    if (typeof text === 'string') {\n      text = text.split('');\n    }\n    text = text.map(toch).join('');\n    for (let ii = 0; ii < text.length;) {\n      let ch = text[ii];\n      let handled = false;\n      if (ch === ESC && text[ii + 1] === '[') {\n        // ANSI escape code\n        handled = true;\n        let code = text.slice(ii + 2, ii + 12);\n        let m;\n        if (code.match(/^\\?7h/u)) {\n          // screen mode, ignore\n          ii += 5;\n        } else if (code.match(/^2J/u)) {\n          // clear screen and home cursor\n          this.clear();\n          ii += 4;\n        } else if (code.match(/^s/u)) {\n          // save pos\n          this.saved_x = this.x;\n          this.saved_y = this.y;\n          ii += 3;\n        } else if (code.match(/^u/u)) {\n          // restore pos\n          this.moveto(this.saved_x, this.saved_y);\n          ii += 3;\n        } else if (code.match(/^K/u)) {\n          // clear to EOL\n          this.cleareol();\n          ii += 3;\n        } else if ((m = code.match(/^(\\d*)A/u))) {\n          // move up\n          this.offset(null, -Number(m[1] || '1'));\n          ii += m[0].length + 2;\n        } else if ((m = code.match(/^(\\d*)B/u))) {\n          // move down\n          this.offset(null, Number(m[1] || '1'));\n          ii += m[0].length + 2;\n        } else if ((m = code.match(/^(\\d*)C/u))) {\n          // move right\n          this.offset(Number(m[1] || '1'), null);\n          ii += m[0].length + 2;\n        } else if ((m = code.match(/^(\\d*)D/u))) {\n          // move left\n          this.offset(-Number(m[1] || '1'), null);\n          ii += m[0].length + 2;\n        } else if ((m = code.match(/^(\\d+)(?:;(\\d+))?(H|f)/u))) {\n          this.moveto(Number(m[2] || '1') - 1, Number(m[1]) - 1);\n          ii += m[0].length + 2;\n        } else if ((m = code.match(mode_regex1))) {\n          let ii_save = ii;\n          ii += m[0].length + 2;\n          let sub_str = m[1];\n          m = mode_regex2.exec(sub_str);\n          do {\n            let sub_code = Number(m[1]);\n            if (sub_code >= 40) {\n              this.color(null, ansi_to_vga[sub_code - 40]);\n            } else if (sub_code >= 30) {\n              this.color(ansi_to_vga[sub_code - 30] + (this.fg >= 8 ? 8 : 0), null);\n            } else if (sub_code === 1) {\n              if (this.fg < 8) {\n                this.fg += 8;\n              }\n            } else if (sub_code === 0) {\n              this.normal();\n              this.color(params.fg, params.bg);\n            } else if (sub_code === 4) {\n              this.attr |= ATTR.UNDERLINE;\n            } else if (sub_code === 5) {\n              this.attr |= ATTR.BLINK;\n            } else if (sub_code === 7) {\n              this.attr |= ATTR.REVERSE;\n            } else {\n              // unhandled\n              handled = false;\n              ii = ii_save;\n            }\n            m = mode_regex2.exec(sub_str);\n          } while (m);\n        } else {\n          // unhandled, advance past escape and print\n          handled = false;\n        }\n      } else if (ch === '\\n') {\n        handled = true;\n        ++ii;\n        this.lf();\n      } else if (ch === '\\r') {\n        handled = true;\n        ++ii;\n        this.cr();\n      }\n      if (!handled) {\n        if (this.x >= 0 && this.x < this.w && this.y >= 0 && this.y < this.h) {\n          this.mod(MOD_CH, ch);\n        }\n        ++this.x;\n        this.checkwrap();\n        ++ii;\n      }\n    }\n  }\n  fill(params) {\n    let x = params.x || 0;\n    let y = params.y || 0;\n    let w = params.w || this.w;\n    let h = params.h || this.h;\n    this.color(params.fg, params.bg);\n    let eff_w = this.sub_view ? this.sub_view.w : this.w;\n    let eff_h = this.sub_view ? this.sub_view.h : this.h;\n    let x0 = clamp(x, 0, eff_w);\n    let x1 = clamp(x + w, 0, eff_w);\n    let y0 = clamp(y, 0, eff_h);\n    let y1 = clamp(y + h, 0, eff_h);\n    let ch = toch(params.ch || ' ');\n    for (let ii = y0; ii < y1; ++ii) {\n      this.moveto(x0, ii);\n      for (let jj = x0; jj < x1; ++jj) {\n        this.mod(MOD_CH, ch);\n        this.x++;\n      }\n    }\n  }\n\n  ansiCharsTo(mod) {\n    // Adjust attributes\n    let count = 0;\n    let m = false;\n    if (mod.fg !== this.playback.fg) {\n      this.playback.fg = mod.fg;\n      m = true;\n      count += 3;\n    }\n    if (mod.bg !== this.playback.bg) {\n      this.playback.bg = mod.bg;\n      m = true;\n      count += 3;\n    }\n    if (mod.attr !== this.playback.attr) {\n      m = true;\n      let clear = 0;\n      let add = 0;\n      for (let ii = 0; ii < ATTR.NUM_BITS; ++ii) {\n        let bit = (1 << ii);\n        if ((this.playback.attr & bit) !== (mod.attr & bit)) {\n          if (mod.attr & bit) {\n            add++;\n          } else {\n            clear = 1;\n          }\n        }\n      }\n      count += (add + clear) * 2;\n    }\n    if (m) {\n      count += 2;\n    }\n\n    switch (mod.type) { // eslint-disable-line default-case\n      case MOD_SCROLL:\n        // Happens as a result of other actions, instant\n        return count;\n      case MOD_CLEAR:\n        // ESC[2J\n        return count + 4;\n    }\n    // Get to location\n    let dx = mod.x - this.playback.x;\n    let dy = mod.y - this.playback.y;\n    if (dx || dy) {\n      let horiz = dx ? (3 + (dx === 1 ? 0 : ((abs(dx) >= 10 ? 2 : 1) + (dx < 0 ? 1 : 0)))) : 0;\n      let vert = dy ? (3 + (dy === 1 ? 0 : ((abs(dy) >= 10 ? 2 : 1) + (dy < 0 ? 1 : 0)))) : 0;\n      let setpos = 4 + (mod.x ? mod.x > 10 ? 2 : 1 : 0) + (mod.y ? mod.y > 10 ? 2 : 1 : 0);\n      count += min(horiz + vert, setpos);\n    }\n    switch (mod.type) { // eslint-disable-line default-case\n      case MOD_CH:\n        return count + 1;\n      case MOD_CLEAREOL:\n        // ESC[K\n        return count + 3;\n    }\n    return count;\n  }\n\n  cells(params) {\n    let { x, y, ws, hs, header } = params;\n    let charset = [\n      '',\n      '',\n      '',\n      '',\n    ][params.charset || 0];\n\n    // draw top\n    let terminal = this;\n    function drawHorizLine(base, text_list) {\n      let line = [charset[base]];\n      if (!Array.isArray(text_list)) {\n        text_list = [text_list];\n      }\n      for (let jj = 0; jj < ws.length; ++jj) {\n        let w = ws[jj];\n        let text = text_list[jj];\n        if (text) {\n          let extra = w - text.length;\n          let left = floor(extra / 2);\n          let right = extra - left;\n          for (let kk = 0; kk < left; ++kk) {\n            line.push(charset[1]);\n          }\n          if (params.header_format) {\n            line.push(params.header_format);\n          }\n          line.push(text);\n          if (params.header_format) {\n            line.push('\u001b[0m');\n          }\n          for (let kk = 0; kk < right; ++kk) {\n            line.push(charset[1]);\n          }\n        } else {\n          for (let kk = 0; kk < w; ++kk) {\n            line.push(charset[1]);\n          }\n        }\n        if (jj !== ws.length - 1) {\n          line.push(charset[base + 1]);\n        } else {\n          line.push(charset[base + 2]);\n        }\n      }\n      terminal.print({ x, y, text: line.join('') });\n      y++;\n    }\n    drawHorizLine(2, header);\n    for (let ii = 0; ii < hs.length; ++ii) {\n      // draw rows\n      let h = hs[ii];\n      for (let jj = 0; jj < h; ++jj) {\n        let xx = x + 1;\n        this.print({ x, y, text: charset[0] });\n        for (let kk = 0; kk < ws.length; ++kk) {\n          xx += ws[kk];\n          this.print({ x: xx, y, text: charset[0] });\n          xx++;\n        }\n        y++;\n      }\n      // draw separator\n      if (ii !== hs.length - 1) {\n        drawHorizLine(8);\n      } else {\n        drawHorizLine(5);\n      }\n    }\n  }\n\n  menu(params) {\n    let { x, y, items } = params;\n    let color_sel = params.color_sel || { fg: 15, bg: 8 };\n    let color_unsel = params.color_unsel || { fg: 7, bg: 0 };\n    let color_execute = params.color_execute || { fg: 8, bg: 0 };\n    let pre_sel = params.pre_sel || ' ';\n    let pre_unsel = params.pre_unsel || '  ';\n    let post_sel = params.post_sel || '';\n    let post_unsel = params.post_unsel || '';\n    let menu_key = params.key || `${x}_${y}_${items.join()}`;\n    if (this.last_menu_frame !== this.frame - 1 || this.last_menu_key !== menu_key) {\n      // reset\n      this.menu_idx = params.def_idx || 0;\n    }\n    this.last_menu_frame = this.frame;\n    this.last_menu_key = menu_key;\n\n    if (input.keyDownEdge(KEYS.DOWN) || input.keyDownEdge(KEYS.S)) {\n      this.menu_idx++;\n    }\n    if (input.keyDownEdge(KEYS.UP) || input.keyDownEdge(KEYS.W)) {\n      this.menu_idx--;\n    }\n    if (input.keyDownEdge(KEYS.HOME)) {\n      this.menu_idx = 0;\n    }\n    if (input.keyDownEdge(KEYS.END)) {\n      this.menu_idx = items.length - 1;\n    }\n\n    let max_w = 0;\n    for (let ii = 0; ii < items.length; ++ii) {\n      let item = items[ii];\n      if (typeof item === 'object') {\n        item = item.label;\n      }\n      max_w = max(max_w, item.length);\n    }\n    max_w += pre_sel.length + post_sel.length;\n\n    let ret = -1;\n    this.menu_select_delta = 1;\n    // First check anything tha changes menu index\n    for (let ii = 0; ii < items.length; ++ii) {\n      let item = items[ii];\n      let effx = x;\n      let effy = y + ii;\n      let hotkey;\n      if (typeof item === 'object') {\n        effx = item.x;\n        effy = item.y;\n        hotkey = item.hotkey;\n\n        item = item.label;\n      }\n      if (!hotkey) {\n        let m = item.match(/\\[([A-Z0-9])\\]/u);\n        if (m) {\n          hotkey = m[1];\n        }\n      }\n      let param = {\n        x: this.render_x + effx * this.char_width,\n        y: this.render_y + effy * this.char_height,\n        w: max_w * this.char_width,\n        h: this.char_height,\n      };\n      let click;\n      if ((click = input.click(param))) {\n        if (click.button === 2) {\n          this.menu_select_delta = -1;\n        }\n        this.menu_idx = ii;\n        ret = ii;\n      } else if (input.mouseMoved() && input.mouseOver(param)) {\n        this.menu_idx = ii;\n      }\n      if (hotkey && input.keyDownEdge(KEYS.A + hotkey.charCodeAt(0) - 'A'.charCodeAt(0))) {\n        this.menu_idx = ii;\n        ret = ii;\n      }\n      if ((hotkey && hotkey === '0' || items.length === 1) && input.keyDownEdge(KEYS.ESCAPE)) {\n        this.menu_idx = ii;\n        ret = ii;\n      }\n    }\n\n    this.menu_idx = (this.menu_idx + items.length) % items.length;\n\n    let left_select = false;\n    if (input.keyDownEdge(KEYS.SPACE) ||\n      input.keyDownEdge(KEYS.ENTER) ||\n      ret === -1 && (\n        input.keyDownEdge(KEYS.D) || input.keyDownEdge(KEYS.RIGHT) ||\n        (left_select = (input.keyDownEdge(KEYS.A) || input.keyDownEdge(KEYS.LEFT)))\n      )\n    ) {\n      ret = this.menu_idx;\n      if (left_select) {\n        this.menu_select_delta = -1;\n      }\n    }\n\n    for (let ii = 0; ii < items.length; ++ii) {\n      let item = items[ii];\n      let selected = ii === this.menu_idx;\n      let executing = ii === ret;\n      let colors = executing ? color_execute : selected ? color_sel : color_unsel;\n      let effx = x;\n      let effy = y + ii;\n      let eff_pre_sel = pre_sel;\n      let eff_pre_unsel = pre_unsel;\n      if (typeof item === 'object') {\n        effx = item.x;\n        effy = item.y;\n        colors = executing ? item.color_execute : selected ? item.color_sel : item.color_unsel;\n        eff_pre_sel = item.pre_sel;\n        eff_pre_unsel = item.pre_unsel;\n        item = item.label;\n      }\n      let param = {\n        x: effx,\n        y: effy,\n        fg: colors.fg,\n        bg: colors.bg,\n      };\n      param.text = `${selected ? eff_pre_sel : eff_pre_unsel}${item}${selected ? post_sel : post_unsel}`;\n      this.print(param);\n    }\n\n    this.color(color_unsel.fg, color_unsel.bg);\n\n    return ret;\n  }\n\n  render() {\n    let dt = engine.getFrameDt();\n    this.frame++;\n\n    while (dt >= this.mod_countdown && this.mod_head) {\n      dt -= this.mod_countdown;\n      let mod = this.mod_head;\n      this.mod_head = mod.next;\n      if (!mod.next) {\n        this.mod_tail = null;\n      }\n      this.domod(this.buffer, mod);\n      let next = mod.next;\n      if (next) {\n        let ms_per_char = 1000 / (this.baud / 10); // 10 bits per byte\n        if (!isFinite(ms_per_char)) {\n          ms_per_char = 0;\n        }\n        this.mod_countdown = ms_per_char * this.ansiCharsTo(next);\n      } else {\n        this.mod_countdown = 0;\n      }\n    }\n    this.mod_countdown = max(0, this.mod_countdown - dt);\n\n    const { w, h, buffer, char_width, char_height, palette, draw_cursor } = this;\n    const blink = engine.getFrameTimestamp() % 1000 > 500;\n    const x = this.render_x;\n    const y = this.render_y;\n    const z = this.render_z;\n    // Draw foreground text\n    for (let ii = 0; ii < h; ++ii) {\n      let jj = 0;\n      let line = buffer[ii];\n      while (jj < w) {\n        while (jj < w && line[jj].ch === ' ') {\n          ++jj;\n        }\n        if (jj === w) {\n          continue;\n        }\n        // found first non-empty character\n        let jj0 = jj;\n        let fg = line[jj].fg;\n        let text = [];\n        while (jj < w && (line[jj].fg === fg || line[jj].ch === ' ')) {\n          let ch = line[jj].ch;\n          if (blink && (line[jj].attr & ATTR.BLINK)) {\n            ch = ' ';\n          }\n          text.push(ch);\n          ++jj;\n        }\n        text = text.join('');\n        engine.font.drawSized(this.font_styles[fg],\n          x + jj0 * char_width, y + ii * char_height, z + 0.5,\n          char_height, text);\n      }\n    }\n    // Draw cursor\n    if (draw_cursor) {\n      let { playback } = this;\n      let cx = x + (this.mod_head ? playback.x : this.x) * char_width;\n      let cy = y + (this.mod_head ? playback.y : this.y) * char_height;\n      let cursor_blink = (engine.getFrameTimestamp() - playback.timestamp) % 1000 < 500;\n      if (cursor_blink) {\n        ui.drawRect(cx, cy + char_height - draw_cursor[1] - 1,\n          cx + char_width, cy + char_height - draw_cursor[0],\n          z + 0.75, palette[playback.fg]);\n      }\n    }\n    // Draw background rects\n    // This could be made more efficient when the pattern is like:\n    //   ABBA\n    //   ABBA\n    // Right now it draws 6 rects, could be done in 3\n    let box_x0 = 0;\n    let box_y0 = 0;\n    let last_x;\n    let last_y;\n    let box_color = buffer[0][0].bg;\n    function flush() {\n      ui.drawRect(x + box_x0 * char_width, y + box_y0 * char_height,\n        x + (last_x + 1) * char_width, y + (last_y + 1) * char_height, z, palette[box_color]);\n      if (box_y0 !== last_y && last_y !== w - 1) {\n        // A was draw, draw B:\n        // AAABB\n        // AAA..\n        ui.drawRect(x + (last_x + 1) * char_width, y + box_y0 * char_height,\n          x + w * char_width, y + last_y * char_height, z, palette[box_color]);\n      }\n    }\n    for (let ii = 0; ii < h; ++ii) {\n      let line = buffer[ii];\n      for (let jj = 0; jj < w; ++jj) {\n        let color = line[jj].bg;\n        if (color !== box_color || box_x0 > jj) {\n          flush();\n          box_color = color;\n          box_x0 = jj;\n          box_y0 = ii;\n        }\n        last_x = jj;\n        last_y = ii;\n      }\n    }\n    flush();\n  }\n}\n\nexport function terminalCreate(params) {\n  return new GlovTerminal(params);\n}\n\n// Convenience functions for generating ANSI strings from named colors\nexport const ansi = { bg: {} };\n[\n  'black',\n  'red',\n  'green',\n  'yellow',\n  'blue',\n  'magenta',\n  'cyan',\n  'white',\n].forEach(function (color, idx) {\n  ansi[color] = function (str) {\n    return `${ESC}[${30 + idx}m${str}${ESC}[0m`;\n  };\n  ansi[color].bright = function (str) {\n    return `${ESC}[${30 + idx};1m${str}${ESC}[0m`;\n  };\n  ansi.bg[color] = function (str) {\n    return `${ESC}[${40 + idx}m${str}${ESC}[0m`;\n  };\n});\nansi.normal = function (str) {\n  return `${ESC}[0m${str}`;\n};\nansi.blink = function (str) {\n  return `${ESC}[5m${str}${ESC}[0m`;\n};\n\n// eslint-disable-next-line no-control-regex\nconst strip_ansi = /\\u001b\\[(?:[0-9;]*)[0-9A-ORZcf-nqry=><]/g;\nexport function padRight(str, width) {\n  let len = str.replace(strip_ansi, '').length;\n  if (len < width) {\n    str += new Array(width - len + 1).join(' ');\n  }\n  return str;\n}\n\nexport function padLeft(str, width) {\n  let len = str.replace(strip_ansi, '').length;\n  if (len < width) {\n    str = new Array(width - len + 1).join(' ') + str;\n  }\n  return str;\n}\n","const engine = require('./engine.js');\nconst input = require('./input.js');\nconst { KEYS } = require('./input.js');\nconst { ansi, padRight, terminalCreate } = require('./terminal.js');\n\nlet settings_terminal;\nlet base_terminal;\nlet settings_up = false;\n\nconst MODEMS = [\n  { baud: 2400, label: 'Hayes Smartmodem 2400bps' },\n  { baud: 9600, label: 'Motorola V.3225 9600bps' },\n  { baud: 28800, label: 'USR Sportster V.34 28.8kbps' },\n  { baud: Infinity, label: 'NULL' },\n];\n\nexport function terminalSettingsShow() {\n  settings_up = true;\n}\n\nfunction settingsOverlay(dt) {\n  if (input.keyDownEdge(KEYS.O)) {\n    settings_up = !settings_up;\n  }\n  if (settings_up) {\n    settings_terminal.print({\n      fg: 6+8,\n      x: 10, y: 0,\n      text: 'TERMINAL OPTIONS'\n    });\n    let modem_idx = 0;\n    for (let ii = 0; ii < MODEMS.length; ++ii) {\n      if (MODEMS[ii].baud === base_terminal.baud) {\n        modem_idx = ii;\n      }\n    }\n    let sel = settings_terminal.menu({\n      x: 0, y: 1,\n      color_sel: { fg: 7, bg: 0 },\n      color_unsel: { fg: 7+8, bg: 1 },\n      color_execute: { fg: 1, bg: 6+8 },\n      pre_sel: '  ',\n      pre_unsel: '   ',\n      key: 'terminal_settings',\n      items: [\n        padRight(`Modem: ${MODEMS[modem_idx].label}`, 34),\n        padRight(`Display: ${engine.getViewportPostprocess() ? 'CRT' : 'LCD'}`, 34),\n        padRight(`Exit ${ansi.yellow.bright('[O]')}ptions`, 34),\n      ],\n    });\n    if (sel === 0) {\n      modem_idx = (modem_idx + settings_terminal.menu_select_delta + MODEMS.length) % MODEMS.length;\n      base_terminal.baud = MODEMS[modem_idx].baud;\n    } else if (sel === 1) {\n      engine.setViewportPostprocess(!engine.getViewportPostprocess());\n    } else if (sel === 2 || input.keyDownEdge(KEYS.ESCAPE)) {\n      settings_up = false;\n    }\n\n    settings_terminal.render();\n  }\n}\n\nexport function terminalSettingsInit(terminal) {\n  base_terminal = terminal;\n  settings_terminal = terminalCreate({\n    auto_scroll: false,\n    baud: 0,\n    x: 10 * terminal.char_width,\n    y: 2 * terminal.char_height,\n    z: Z.DEBUG,\n    w: 38,\n    h: 6,\n    draw_cursor: false,\n  });\n  settings_terminal.color(7+8, 1);\n  settings_terminal.clear();\n  settings_terminal.color(null, 0);\n  settings_terminal.fill({\n    x: 0, y: settings_terminal.h-1, w: 1, h: 1,\n  });\n  settings_terminal.fill({\n    x: settings_terminal.w-1, y: 0, w: 1, h: 1,\n  });\n  settings_terminal.color(8, 0);\n  settings_terminal.fill({\n    x: 1, y: settings_terminal.h-1, w: settings_terminal.w-1, h: 1,\n    ch: '',\n  });\n  settings_terminal.fill({\n    x: settings_terminal.w-1, y: 1, w: 1, h: settings_terminal.h-2,\n    ch: '',\n  });\n\n  engine.addTickFunc(settingsOverlay);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint-env browser */\n\n// eslint-disable-next-line @typescript-eslint/no-use-before-define\nexports.textureLoad = load;\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst engine = require('./engine.js');\nconst { filewatchOn } = require('./filewatch.js');\nconst local_storage = require('./local_storage.js');\nconst settings = require('./settings.js');\nconst { setGLErrorReportDetails } = require('./shaders.js');\nconst urlhash = require('./urlhash.js');\nconst { callEach, isPowerOfTwo, nextHighestPowerOfTwo, ridx } = require('glov/common/util.js');\n\nconst TEX_UNLOAD_TIME = 5 * 60 * 1000; // for textures loaded (each frame) with auto_unload: true\n\nexport let textures = {};\nexport let load_count = 0;\nlet aniso = 4;\nlet max_aniso = 0;\nlet aniso_enum;\n\nlet default_filter_min;\nlet default_filter_mag;\n\nconst cube_faces = [\n  { target: 'TEXTURE_CUBE_MAP_NEGATIVE_X', pos: [0,1] },\n  { target: 'TEXTURE_CUBE_MAP_POSITIVE_X', pos: [0,0] },\n  { target: 'TEXTURE_CUBE_MAP_NEGATIVE_Y', pos: [1,0] },\n  { target: 'TEXTURE_CUBE_MAP_POSITIVE_Y', pos: [1,1] },\n  { target: 'TEXTURE_CUBE_MAP_NEGATIVE_Z', pos: [2,0] },\n  { target: 'TEXTURE_CUBE_MAP_POSITIVE_Z', pos: [2,1] },\n];\n\nexport const format = {\n  R8: { count: 1 },\n  RGB8: { count: 3 },\n  RGBA8: { count: 4 },\n  DEPTH16: { count: 1 },\n  DEPTH24: { count: 1 },\n};\n\nexport function defaultFilters(min, mag) {\n  default_filter_min = min;\n  default_filter_mag = mag;\n}\n\nlet bound_unit = null;\nlet bound_tex = [];\n\nlet handle_loading;\nlet handle_error;\n\nlet frame_timestamp;\n\nfunction setUnit(unit) {\n  if (unit !== bound_unit) {\n    gl.activeTexture(gl.TEXTURE0 + unit);\n    bound_unit = unit;\n  }\n}\n\nfunction bindHandle(unit, target, handle) {\n  if (bound_tex[unit] !== handle) {\n    setUnit(unit);\n    gl.bindTexture(target, handle);\n    bound_tex[unit] = handle;\n  }\n}\n\nfunction unbindAll(target) {\n  for (let unit = 0; unit < bound_tex.length; ++unit) {\n    setUnit(unit);\n    gl.bindTexture(target, target === gl.TEXTURE_2D ? handle_loading : null);\n    bound_tex[unit] = null;\n  }\n}\n\nexport function bind(unit, tex) {\n  tex.last_use = frame_timestamp;\n  // May or may not change the unit\n  bindHandle(unit, tex.target, tex.eff_handle);\n}\n\n// hot path inlined for perf\nexport function bindArray(texs) {\n  for (let ii = 0; ii < texs.length; ++ii) {\n    let tex = texs[ii];\n    tex.last_use = frame_timestamp;\n    let handle = tex.eff_handle;\n    if (bound_tex[ii] !== handle) {\n      if (ii !== bound_unit) {\n        gl.activeTexture(gl.TEXTURE0 + ii);\n        bound_unit = ii;\n      }\n      gl.bindTexture(tex.target, handle);\n      bound_tex[ii] = handle;\n    }\n  }\n}\n\nexport function cmpTextureArray(texsa, texsb) {\n  let d = texsa.length - texsb.length;\n  if (d) {\n    return d;\n  }\n  for (let ii = 0; ii < texsa.length; ++ii) {\n    d = texsa[ii].id - texsb[ii].id;\n    if (d) {\n      return d;\n    }\n  }\n  return 0;\n}\n\nexport function isArrayBound(texs) {\n  for (let ii = 0; ii < texs.length; ++ii) {\n    let tex = texs[ii];\n    let handle = tex.eff_handle;\n    if (bound_tex[ii] !== handle) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function texturesResetState() {\n  bound_unit = -1;\n  if (engine.webgl2) {\n    unbindAll(gl.TEXTURE_2D_ARRAY);\n  }\n  unbindAll(gl.TEXTURE_2D);\n  setUnit(0);\n  // Disabling this.  In theory clearing the GL error at the beginning of the frame\n  //   is good for debugging, and shouldn't actually harm anything (possibly stall\n  //   as it's the first GL call of the frame, but theoretically not much more than\n  //   whatever the next GL call would be), however in practice this is adding up\n  //   to a couple ms (when running at /max_fps 1000) in Chrome.  Does not seem to\n  //   have any effect either way under GPU-bound conditions though.\n  // profilerStart('gl.getError()');\n  // gl.getError();\n  // profilerStop('gl.getError()');\n}\n\n\nlet auto_unload_textures = [];\n\nlet last_id = 0;\nfunction Texture(params) {\n  this.id = ++last_id;\n  this.name = params.name;\n  this.loaded = false;\n  this.load_fail = false;\n  this.target = params.target || gl.TEXTURE_2D;\n  this.is_array = this.target === gl.TEXTURE_2D_ARRAY;\n  this.is_cube = this.target === gl.TEXTURE_CUBE_MAP;\n  this.handle = gl.createTexture();\n  this.eff_handle = handle_loading;\n  this.setSamplerState(params);\n  this.src_width = this.src_height = 1;\n  this.width = this.height = 1;\n  this.nozoom = params.nozoom || false;\n  this.on_load = [];\n  this.gpu_mem = 0;\n  this.soft_error = params.soft_error || false;\n  this.last_use = frame_timestamp;\n  this.auto_unload = params.auto_unload || false;\n  if (this.auto_unload) {\n    auto_unload_textures.push(this);\n  }\n\n  this.format = params.format || format.RGBA8;\n\n  if (params.data) {\n    let err = this.updateData(params.width, params.height, params.data);\n    if (err) {\n      setGLErrorReportDetails();\n      assert(false, `Error loading ${params.name}: ${err}`);\n    }\n  } else {\n    // texture is not valid, do not leave bound\n    unbindAll(this.target);\n    if (params.url) {\n      this.url = params.url;\n      this.loadURL(params.url);\n    }\n  }\n}\n\nTexture.prototype.updateGPUMem = function () {\n  let new_size = this.width * this.height * this.format.count;\n  if (this.mipmaps) {\n    new_size *= 1.5;\n  }\n  let diff = new_size - this.gpu_mem;\n  engine.perf_state.gpu_mem.tex += diff;\n  this.gpu_mem = diff;\n};\n\nfunction bindForced(tex) {\n  let target = tex.target;\n  setUnit(0);\n  bound_tex[0] = null; // Force a re-bind, no matter what\n  bindHandle(0, target, tex.handle);\n}\n\nTexture.prototype.setSamplerState = function (params) {\n  let target = this.target;\n  bindForced(this);\n\n  this.filter_min = params.filter_min || default_filter_min;\n  this.filter_mag = params.filter_mag || default_filter_mag;\n  gl.texParameteri(target, gl.TEXTURE_MIN_FILTER, this.filter_min);\n  gl.texParameteri(target, gl.TEXTURE_MAG_FILTER, this.filter_mag);\n  this.wrap_s = params.wrap_s || gl.REPEAT;\n  this.wrap_t = params.wrap_t || gl.REPEAT;\n  gl.texParameteri(target, gl.TEXTURE_WRAP_S, this.wrap_s);\n  gl.texParameteri(target, gl.TEXTURE_WRAP_T, this.wrap_t);\n\n  this.mipmaps = this.filter_min >= 0x2700 && this.filter_min <= 0x2703 || // Probably gl.LINEAR_MIPMAP_LINEAR\n    params.force_mipmaps;\n\n  if (max_aniso) {\n    if (this.mipmaps && params.filter_mag !== gl.NEAREST) {\n      gl.texParameterf(gl.TEXTURE_2D, aniso_enum, aniso);\n    } else {\n      gl.texParameterf(gl.TEXTURE_2D, aniso_enum, 1);\n    }\n  }\n};\n\nTexture.prototype.updateData = function updateData(w, h, data) {\n  profilerStart('Texture:updateData');\n  assert(!this.destroyed);\n  bindForced(this);\n  this.last_use = frame_timestamp;\n  this.src_width = w;\n  this.src_height = h;\n  this.width = w;\n  this.height = h;\n  // clear the error flag(s) if there are any\n  for (let ii = 0; ii < 10 && gl.getError(); ++ii) {\n    // Error cleared with gl.getError()\n  }\n  // Resize NP2 if this is not being used for a texture array, and it is not explicitly allowed (non-mipmapped, wrapped)\n  let np2 = (!isPowerOfTwo(w) || !isPowerOfTwo(h)) && !this.is_array && !this.is_cube &&\n    !(!this.mipmaps && this.wrap_s === gl.CLAMP_TO_EDGE && this.wrap_t === gl.CLAMP_TO_EDGE);\n  if (np2) {\n    this.width = nextHighestPowerOfTwo(w);\n    this.height = nextHighestPowerOfTwo(h);\n    gl.texImage2D(this.target, 0, this.format.internal_type, this.width, this.height, 0,\n      this.format.internal_type, this.format.gl_type, null);\n  }\n  if (data instanceof Uint8Array) {\n    assert(data.length >= w * h * this.format.count);\n    assert(!this.is_cube);\n    if (this.is_array) {\n      let num_images = h / w; // assume square\n      gl.texImage3D(this.target, 0, this.format.internal_type, w, w,\n        num_images, 0, this.format.internal_type, this.format.gl_type, data);\n    } else if (np2) {\n      // Could do multiple upload thing like below, but smarter, but we really shouldn't be doing this for\n      // in-process generated images!\n      gl.texSubImage2D(this.target, 0, 0, 0, w, h, this.format.internal_type, this.format.gl_type, data);\n    } else {\n      gl.texImage2D(this.target, 0, this.format.internal_type, w, h, 0,\n        this.format.internal_type, this.format.gl_type, data);\n    }\n  } else {\n    // Ensure this is an Image or Canvas\n    if (!data.width) {\n      profilerStop();\n      return `Missing width (${data.width}) (\"${String(data).slice(0, 100)}\")`;\n    }\n    if (this.is_cube) {\n      assert.equal(w * 2, h * 3);\n      let tex_size = h / 2;\n      let canvas = document.createElement('canvas');\n      canvas.width = tex_size;\n      canvas.height = tex_size;\n      let ctx = canvas.getContext('2d');\n      for (let ii = 0; ii < cube_faces.length; ++ii) {\n        let face = cube_faces[ii];\n        ctx.drawImage(data, face.pos[0] * tex_size, face.pos[1] * tex_size, tex_size, tex_size,\n          0, 0, tex_size, tex_size);\n        gl.texImage2D(gl[face.target], 0, this.format.internal_type, this.format.internal_type, this.format.gl_type,\n          canvas);\n      }\n    } else if (this.is_array) {\n      let num_images = h / w;\n      gl.texImage3D(this.target, 0, this.format.internal_type, w, w,\n        num_images, 0, this.format.internal_type, this.format.gl_type, data);\n\n      if (gl.getError()) {\n        // Fix for Samsung devices (Chris's and Galaxy S8 on CrossBrowserTesting)\n        // Also fixes locally on Chrome when using a 8K source texture (was 896x57344),\n        //  perhaps some auto-scaling is going on in the gl.texImage3D call if required?\n        // Try drawing to canvas first\n        let canvas = document.createElement('canvas');\n        canvas.width = w;\n        canvas.height = h;\n        let ctx = canvas.getContext('2d');\n        ctx.drawImage(data, 0, 0);\n        gl.texImage3D(this.target, 0, this.format.internal_type, w, w,\n          num_images, 0, this.format.internal_type, this.format.gl_type, canvas);\n      }\n\n    } else if (np2) {\n      // Pad up to power of two\n      // Duplicate right and bottom pixel row by sending image 3 times\n      if (w !== this.width) {\n        gl.texSubImage2D(this.target, 0, 1, 0, this.format.internal_type, this.format.gl_type, data);\n      }\n      if (h !== this.height) {\n        gl.texSubImage2D(this.target, 0, 0, 1, this.format.internal_type, this.format.gl_type, data);\n      }\n      gl.texSubImage2D(this.target, 0, 0, 0, this.format.internal_type, this.format.gl_type, data);\n    } else {\n      gl.texImage2D(this.target, 0, this.format.internal_type, this.format.internal_type, this.format.gl_type, data);\n    }\n  }\n  let err = null;\n  let gl_err = gl.getError();\n  if (gl_err) {\n    err = `GLError(${gl_err})`;\n  }\n  if (!err && this.mipmaps) {\n    gl.generateMipmap(this.target);\n    gl_err = gl.getError();\n    if (gl_err) {\n      err = `GLError(${gl_err})`;\n    }\n  }\n  if (!err) {\n    this.updateGPUMem();\n    this.eff_handle = this.handle;\n    this.loaded = true;\n\n    callEach(this.on_load, this.on_load = null, this);\n  }\n\n  profilerStop();\n  return err;\n};\n\nTexture.prototype.onLoad = function (cb) {\n  if (this.loaded) {\n    cb(this);\n  } else {\n    this.on_load.push(cb);\n  }\n};\n\nconst TEX_RETRY_COUNT = 4;\nTexture.prototype.loadURL = function loadURL(url, filter) {\n  let tex = this;\n  assert(!tex.destroyed);\n\n  // When our browser's location has been changed from 'site.com/foo/' to\n  //  'site.com/foo/bar/7' our relative image URLs are still relative to the\n  //  base.  Maybe should set some meta tag to do this instead?\n  if (!url.match(/^.{2,7}:/)) {\n    url = `${urlhash.getURLBase()}${url}`;\n  }\n\n  let load_gen = tex.load_gen = (tex.load_gen || 0) + 1;\n  function tryLoad(next) {\n    profilerStart('Texture:tryLoad');\n    let did_next = false;\n    function done(img) {\n      if (!did_next) {\n        did_next = true;\n        return void next(img);\n      }\n    }\n\n    let img = new Image();\n    img.onload = function () {\n      profilerStart('Texture:onload');\n      done(img);\n      profilerStop();\n    };\n    function fail() {\n      done(null);\n    }\n    img.onerror = fail;\n    img.crossOrigin = 'anonymous';\n    img.src = url;\n    profilerStop();\n  }\n\n  ++load_count;\n  let retries = 0;\n  function handleLoad(img) {\n    if (tex.load_gen !== load_gen || tex.destroyed) {\n      // someone else requested this texture to be loaded!  Or, it was already unloaded\n      --load_count;\n      return;\n    }\n    let err_details = '';\n    if (img) {\n      tex.format = format.RGBA8;\n      if (filter) {\n        img = filter(tex, img);\n      }\n      let err = tex.updateData(img.width, img.height, img);\n      if (err) {\n        err_details = `: ${err}`;\n        // Samsung TV gets 1282 on texture arrays\n        // Samsung Galaxy S6 gets 1281 on texture arrays\n        // Note: Any failed image load (partial read of a bad png, etc) also results in 1281!\n        if (tex.is_array && (err === 'GLError(1282)' || err === 'GLError(1281)') && engine.webgl2 && !engine.DEBUG) {\n          local_storage.setJSON('webgl2_disable', {\n            ua: navigator.userAgent,\n            ts: Date.now(),\n          });\n          console.error(`Error loading array texture \"${url}\"${err_details}, reloading without WebGL2..`);\n          engine.reloadSafe();\n          return;\n        }\n        if (!tex.for_reload) {\n          retries = TEX_RETRY_COUNT; // do not retry this\n        }\n      } else {\n        --load_count;\n        return;\n      }\n    }\n    let err_url = url && url.length > 200 ? `${url.slice(0, 200)}...` : url;\n    let err = `Error loading texture \"${err_url}\"${err_details}`;\n    retries++;\n    if (retries > TEX_RETRY_COUNT) {\n      --load_count;\n      tex.eff_handle = handle_error;\n      tex.load_fail = true;\n      console.error(`${err}${err_details ? '' : ', retries failed'}`);\n      if (tex.soft_error) {\n        tex.err = 'Load failed';\n      } else {\n        setGLErrorReportDetails();\n        assert(false, err);\n      }\n      return;\n    }\n    console.error(`${err}, retrying... `);\n    setTimeout(tryLoad.bind(null, handleLoad), 100 * retries * retries);\n  }\n  tryLoad(handleLoad);\n};\n\nTexture.prototype.allocFBO = function (w, h) {\n  const fbo_format = settings.fbo_rgba ? gl.RGBA : gl.RGB;\n  bindForced(this);\n  gl.texImage2D(this.target, 0, fbo_format, w, h, 0, fbo_format, gl.UNSIGNED_BYTE, null);\n\n  this.fbo = gl.createFramebuffer();\n  gl.bindFramebuffer(gl.FRAMEBUFFER, this.fbo);\n  gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.handle, 0);\n\n  this.last_use = frame_timestamp;\n  this.src_width = this.width = w;\n  this.src_height = this.height = h;\n  this.updateGPUMem();\n};\n\nTexture.prototype.allocDepth = function (w, h) {\n  bindForced(this);\n  gl.texImage2D(gl.TEXTURE_2D, 0, this.format.internal_type,\n    w, h, 0, this.format.format, this.format.gl_type, null);\n\n  this.last_use = frame_timestamp;\n  this.src_width = this.width = w;\n  this.src_height = this.height = h;\n  this.updateGPUMem();\n};\n\nTexture.prototype.captureStart = function (w, h) {\n  assert(!this.capture);\n  this.capture = { w, h };\n  if (this.fbo) {\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this.fbo);\n  }\n};\n\nTexture.prototype.captureEnd = function (filter_linear, wrap) {\n  assert(this.capture);\n  let capture = this.capture;\n  this.capture = null;\n  if (this.fbo) {\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n  } else {\n    this.copyTexImage(0, 0, capture.w, capture.h);\n  }\n  let filter = filter_linear ? gl.LINEAR : gl.NEAREST;\n  this.setSamplerState({\n    filter_min: filter,\n    filter_mag: filter,\n    wrap_s: wrap ? gl.REPEAT : gl.CLAMP_TO_EDGE,\n    wrap_t: wrap ? gl.REPEAT : gl.CLAMP_TO_EDGE,\n  });\n};\n\nTexture.prototype.copyTexImage = function (x, y, w, h) {\n  assert(!this.destroyed);\n  assert(w && h);\n  bindHandle(0, this.target, this.handle);\n  gl.copyTexImage2D(this.target, 0, gl.RGB, x, y, w, h, 0);\n  this.last_use = frame_timestamp;\n  this.src_width = this.width = w;\n  this.src_height = this.height = h;\n  this.updateGPUMem();\n};\n\nTexture.prototype.destroy = function () {\n  if (this.destroyed) {\n    return;\n  }\n  profilerStart('Texture:destroy');\n  assert(this.name);\n  let auto_unload = this.auto_unload;\n  if (auto_unload) {\n    this.auto_unload = null;\n    let idx = auto_unload_textures.indexOf(this);\n    assert(idx !== -1);\n    ridx(auto_unload_textures, idx);\n  }\n  delete textures[this.name];\n  unbindAll(this.target);\n  gl.deleteTexture(this.handle);\n  if (this.fbo) {\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.deleteFramebuffer(this.fbo);\n  }\n  this.width = this.height = 0;\n  this.updateGPUMem();\n  this.destroyed = true;\n  if (typeof auto_unload === 'function') {\n    auto_unload();\n  }\n  profilerStop('Texture:destroy');\n};\n\nfunction create(params) {\n  assert(params.name);\n  let texture = new Texture(params);\n  textures[params.name] = texture;\n  return texture;\n}\n\nlet last_temporary_id = 0;\nexport function createForCapture(unique_name, auto_unload) {\n  let name = unique_name || `screen_temporary_tex_${++last_temporary_id}`;\n  assert(!textures[name]);\n  let texture = create({\n    filter_min: gl.NEAREST,\n    filter_mag: gl.NEAREST,\n    wrap_s: gl.CLAMP_TO_EDGE,\n    wrap_t: gl.CLAMP_TO_EDGE,\n    format: format.RGB8,\n    name,\n    auto_unload,\n  });\n  texture.loaded = true;\n  texture.eff_handle = texture.handle;\n  return texture;\n}\n\nexport function createForDepthCapture(unique_name, tex_format) {\n  let name = unique_name || `screen_temporary_tex_${++last_temporary_id}`;\n  assert(!textures[name]);\n  let texture = create({\n    filter_min: gl.NEAREST,\n    filter_mag: gl.NEAREST,\n    wrap_s: gl.CLAMP_TO_EDGE,\n    wrap_t: gl.CLAMP_TO_EDGE,\n    format: tex_format,\n    name,\n  });\n  texture.loaded = true;\n  texture.eff_handle = texture.handle;\n  return texture;\n}\n\nexport function load(params) {\n  let key = params.name = params.name || params.url;\n  assert(key);\n  let tex = textures[key];\n  if (!tex) {\n    tex = create(params);\n  }\n  tex.last_use = frame_timestamp;\n  return tex;\n}\n\nexport function cname(key) {\n  let idx = key.lastIndexOf('/');\n  if (idx !== -1) {\n    key = key.slice(idx+1);\n  }\n  idx = key.indexOf('.');\n  if (idx !== -1) {\n    key = key.slice(0, idx);\n  }\n  return key.toLowerCase();\n}\nexport function findTexForReplacement(search_key) {\n  search_key = cname(search_key);\n  for (let key in textures) {\n    let compare_key = cname(key);\n    if (compare_key === search_key) {\n      return textures[key];\n    }\n  }\n  return null;\n}\n\nlet tick_next_tex = 0;\nexport function texturesTick() {\n  frame_timestamp = engine.frame_timestamp;\n  let len = auto_unload_textures.length;\n  if (!len) {\n    return;\n  }\n  if (tick_next_tex >= len) {\n    tick_next_tex = 0;\n  }\n  let tex = auto_unload_textures[tick_next_tex];\n  if (tex.last_use < frame_timestamp - TEX_UNLOAD_TIME) {\n    console.log(`Unloading texture ${tex.name}`);\n    tex.destroy();\n  } else {\n    ++tick_next_tex;\n  }\n}\n\nexport function texturesUnloadDynamic() {\n  while (auto_unload_textures.length) {\n    auto_unload_textures[0].destroy();\n  }\n}\n\nfunction textureReload(filename) {\n  let tex = textures[filename];\n  if (tex && tex.url) {\n    tex.for_reload = true;\n    tex.loadURL(`${tex.url}?rl=${Date.now()}`);\n    return true;\n  }\n  return false;\n}\n\nlet depth_supported;\nexport function textureSupportsDepth() {\n  return depth_supported;\n}\n\nexport function startup() {\n\n  default_filter_min = gl.LINEAR_MIPMAP_LINEAR;\n  default_filter_mag = gl.LINEAR;\n\n  format.R8.internal_type = gl.LUMINANCE;\n  format.R8.gl_type = gl.UNSIGNED_BYTE;\n  format.RGB8.internal_type = gl.RGB;\n  format.RGB8.gl_type = gl.UNSIGNED_BYTE;\n  format.RGBA8.internal_type = gl.RGBA;\n  format.RGBA8.gl_type = gl.UNSIGNED_BYTE;\n\n  let UNSIGNED_INT_24_8;\n  if (engine.webgl2) {\n    depth_supported = true;\n    UNSIGNED_INT_24_8 = gl.UNSIGNED_INT_24_8;\n  } else {\n    let ext = gl.getExtension('WEBGL_depth_texture');\n    if (ext) {\n      UNSIGNED_INT_24_8 = ext.UNSIGNED_INT_24_8_WEBGL;\n      depth_supported = true;\n    }\n  }\n  if (depth_supported) {\n    format.DEPTH16.internal_type = engine.webgl2 ? gl.DEPTH_COMPONENT16 : gl.DEPTH_COMPONENT;\n    format.DEPTH16.format = gl.DEPTH_COMPONENT;\n    format.DEPTH16.gl_type = gl.UNSIGNED_SHORT;\n    format.DEPTH24.internal_type = engine.webgl2 ? gl.DEPTH24_STENCIL8 : gl.DEPTH_STENCIL;\n    format.DEPTH24.format = gl.DEPTH_STENCIL;\n    format.DEPTH24.gl_type = UNSIGNED_INT_24_8;\n  }\n\n  let ext_anisotropic = (\n    gl.getExtension('EXT_texture_filter_anisotropic') ||\n    gl.getExtension('MOZ_EXT_texture_filter_anisotropic') ||\n    gl.getExtension('WEBKIT_EXT_texture_filter_anisotropic')\n  );\n  if (ext_anisotropic) {\n    aniso_enum = ext_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT;\n    aniso = max_aniso = gl.getParameter(ext_anisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT);\n  }\n\n  handle_error = load({\n    name: 'error',\n    width: 2, height: 2,\n    nozoom: true,\n    format: format.RGBA8,\n    filter_mag: gl.NEAREST,\n    data: new Uint8Array([\n      255, 20, 147, 255,\n      255, 0, 0, 255,\n      255, 255, 255, 255,\n      255, 20, 147, 255\n    ]),\n  }).handle;\n\n  handle_loading = load({\n    name: 'loading',\n    width: 2, height: 2,\n    nozoom: true,\n    format: format.RGBA8,\n    data: new Uint8Array([\n      127, 127, 127, 255,\n      0, 0, 0, 255,\n      64, 64, 64, 255,\n      127, 127, 127, 255,\n    ]),\n  }).handle;\n\n  load({\n    name: 'white',\n    width: 2, height: 2,\n    nozoom: true,\n    format: format.RGBA8,\n    data: new Uint8Array([\n      255, 255, 255, 255,\n      255, 255, 255, 255,\n      255, 255, 255, 255,\n      255, 255, 255, 255,\n    ]),\n  });\n\n  load({\n    name: 'invisible',\n    width: 2, height: 2,\n    nozoom: true,\n    format: format.RGBA8,\n    data: new Uint8Array([\n      0, 0, 0, 0,\n      0, 0, 0, 0,\n      0, 0, 0, 0,\n      0, 0, 0, 0,\n    ]),\n  });\n\n  filewatchOn('.png', textureReload);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst camera2d = require('./camera2d.js');\nconst glov_engine = require('./engine.js');\nconst { applyCopy, effectsQueue, effectsIsFinal } = require('./effects.js');\nconst { framebufferCapture, framebufferStart, framebufferEnd, temporaryTextureClaim } = require('./framebuffer.js');\nconst { floor, min, pow, random } = Math;\nconst sprites = require('./sprites.js');\nconst shaders = require('./shaders.js');\nconst textures = require('./textures.js');\nconst glov_ui = require('./ui.js');\nconst { easeOut } = require('glov/common/util.js');\nconst { unit_vec, vec4 } = require('glov/common/vmath.js');\nconst verify = require('glov/common/verify.js');\n\nlet transitions = [];\n\nexport const IMMEDIATE = 'immediate';\n\nexport const REMOVE = 'remove';\nexport const CONTINUE = 'continue';\n\nconst shader_data = {\n  transition_pixelate: {\n    fp: 'shaders/transition_pixelate.fp',\n  },\n};\n\nfunction getShader(key) {\n  let elem = shader_data[key];\n  if (!elem.shader) {\n    elem.shader = shaders.create(elem.fp);\n  }\n  return elem.shader;\n}\n\nfunction GlovTransition(z, func) {\n  this.z = z;\n  this.capture = null;\n  this.func = func;\n  this.accum_time = 0;\n}\n\nfunction transitionCapture(trans) {\n  // Warning: Slow on iOS\n  assert(!trans.capture);\n  trans.capture = textures.createForCapture();\n  framebufferCapture(trans.capture);\n}\n\nfunction transitionCaptureFramebuffer(trans) {\n  assert(!trans.capture);\n  trans.capture = framebufferEnd();\n  temporaryTextureClaim(trans.capture);\n  if (trans.capture.fbo) {\n    // new framebuffer bound, effectively cleared, need to blit this to it!\n    applyCopy({ source: trans.capture, final: effectsIsFinal() });\n  } else {\n    framebufferStart({\n      width: trans.capture.width,\n      height: trans.capture.height,\n      final: effectsIsFinal(),\n    });\n  }\n}\n\nexport function queue(z, fn) {\n  assert(!glov_engine.had_3d_this_frame); // Cannot queue a transition after we've already started 3d rendering/cleared\n  let immediate = false;\n  if (z === IMMEDIATE) {\n    immediate = true;\n    z = Z.TRANSITION_FINAL;\n  }\n\n  for (let ii = 0; ii < transitions.length; ++ii) {\n    let trans = transitions[ii];\n    if (trans.z === z) {\n      // same Z\n      if (!verify(trans.capture)) {\n        // two transitions at the same Z on one frame!  ignore second\n        return false;\n      }\n    }\n  }\n  let trans = new GlovTransition(z, fn);\n  transitions.push(trans);\n\n  if (immediate) {\n    transitionCapture(trans);\n  } else {\n    // queue up a capture past the specified Z, so transitions rendering at that Z (plus a handful) get captured\n    effectsQueue(z + Z.TRANSITION_RANGE, transitionCaptureFramebuffer.bind(null, trans));\n    //spriteQueueFn(z + Z.TRANSITION_RANGE, transitionCapture.bind(null, trans));\n  }\n  return true;\n}\n\nfunction destroyTexture(tex) {\n  profilerStart('transition:destroyTexture');\n  tex.destroy();\n  profilerStop();\n}\n\nexport function render(dt) {\n  dt = min(dt, 100); // debug: clamp frame times\n  for (let trans_idx = 0; trans_idx < transitions.length; ++trans_idx) {\n    let trans = transitions[trans_idx];\n    trans.accum_time += dt;\n    assert(trans.capture);\n    // call the function and give them the Z\n    // If not the last one, want it to end now!\n    let force_end = trans_idx < transitions.length - 1;\n    let ret = trans.func(trans.z, trans.capture, trans.accum_time, force_end);\n    if (ret === REMOVE) {\n      setTimeout(destroyTexture.bind(null, trans.capture), 0);\n      transitions.splice(trans_idx, 1);\n      trans_idx--;\n    }\n  }\n}\n\nexport function active() {\n  return transitions.length;\n}\n\nfunction glovTransitionFadeFunc(fade_time, z, initial, ms_since_start, force_end) {\n  let progress = min(ms_since_start / fade_time, 1);\n  let alpha = (1 - easeOut(progress, 2));\n  let color = vec4(1, 1, 1, alpha);\n  camera2d.setNormalized();\n  sprites.queueraw4([initial],\n    0, 0, 0, 1,\n    1, 1, 1, 0,\n    z,\n    0, 1, 1, 0,\n    color);\n\n  if (force_end || progress === 1) {\n    return REMOVE;\n  }\n  return CONTINUE;\n}\n\n\n/*\n  // Doesn't work because we need more than just 2 UV values in the queue call\nfunction glovTransitionWipeFunc(wipe_time, wipe_angle, z, tex, ms_since_start, force_end) {\n  let progress = min(ms_since_start / wipe_time, 1);\n\n  camera2d.setNormalized();\n\n  let uvs = [[0,1], [1,0]];\n\n  let points = [{}, {}, {}, {}];\n  for (let ii = 0; ii < 4; ii++) {\n    let x = (ii === 1 || ii === 2) ? 1 : 0;\n    let y = (ii >= 2) ? 1 : 0;\n    points[ii].x = x;\n    points[ii].y = y;\n  }\n\n  while (wipe_angle > PI) {\n    wipe_angle -= (2 * PI);\n  }\n  while (wipe_angle < -PI) {\n    wipe_angle += (2 * PI);\n  }\n\n  // TODO: if anyone ever uses this, change 0 degrees to be up, not right, to match other things?\n  if (wipe_angle >= -PI_4 && wipe_angle <= PI_4) {\n    // horizontal wipe from left to right\n    let x0 = progress * 2; // rightmost x\n    let x1 = x0 - sin(abs(wipe_angle)) / SQRT1_2; // leftmost x\n    if (wipe_angle < 0) {\n      points[0].x = x1;\n      points[3].x = x0;\n    } else {\n      points[0].x = x0;\n      points[3].x = x1;\n    }\n    points[1].x = points[2].x = 2;\n  } else if (wipe_angle >= PI_2 + PI_4 || wipe_angle <= -PI_2 - PI_4) {\n    // horizontal wipe from right to left\n    let x0 = 1 - progress * 2; // leftmost x\n    let x1 = x0 + sin(abs(wipe_angle)) / SQRT1_2; // rightmost x,\n    if (wipe_angle < 0) {\n      points[1].x = x1;\n      points[2].x = x0;\n    } else {\n      points[1].x = x0;\n      points[2].x = x1;\n    }\n    points[0].x = points[3].x = -1;\n  } else if (wipe_angle > PI_4 && wipe_angle <= PI_2 + PI_4) {\n    // vertical wipe, top to bottom\n    let y0 = progress * 2; // bottommost y\n    let offs = cos(wipe_angle) / SQRT1_2;\n    let y1 = y0 - abs(offs); // topmost y,\n    if (offs > 0) {\n      points[0].y = y0;\n      points[1].y = y1;\n    } else {\n      points[0].y = y1;\n      points[1].y = y0;\n    }\n    points[2].y = points[3].y = 2;\n  } else {\n    // vertical wipe, bottom to top\n    let y0 = 1 - progress * 2; // topmost y\n    let offs = cos(wipe_angle) / SQRT1_2;\n    let y1 = y0 + abs(offs); // bottommost y,\n    if (offs > 0) {\n      points[2].y = y1;\n      points[3].y = y0;\n    } else {\n      points[2].y = y0;\n      points[3].y = y1;\n    }\n    points[0].y = points[1].y = -1;\n  }\n  // interp UVs based on points\n  points[0].u = lerp(points[0].x, uvs[0][0], uvs[1][0]);\n  points[1].u = lerp(points[1].x, uvs[0][0], uvs[1][0]);\n  points[2].u = lerp(points[2].x, uvs[0][0], uvs[1][0]);\n  points[3].u = lerp(points[3].x, uvs[0][0], uvs[1][0]);\n  points[0].v = lerp(points[0].y, uvs[0][1], uvs[1][1]);\n  points[1].v = lerp(points[1].y, uvs[0][1], uvs[1][1]);\n  points[2].v = lerp(points[2].y, uvs[0][1], uvs[1][1]);\n  points[3].v = lerp(points[3].y, uvs[0][1], uvs[1][1]);\n\n  sprites.queueraw4([tex],\n    points[0].x, points[0].y, points[3].x, points[3].y,\n    points[2].x, points[2].y, points[1].x, points[1].y,\n    z,\n    points[0].u, points[0].v, points[2].u, points[2].v,\n    unit_vec, 'alpha_nearest');\n\n  if (force_end || progress === 1) {\n    return REMOVE;\n  }\n  return CONTINUE;\n}\n\n*/\n\nfunction glovTransitionSplitScreenFunc(time, border_width, slide_window, z, tex, ms_since_start, force_end) {\n  let border_color = vec4(1, 1, 1, 1);\n  let progress = easeOut(min(ms_since_start / time, 1), 2);\n  camera2d.setNormalized();\n\n  let uvs = [[0,1], [1,0]];\n\n  let xoffs = progress;\n  let v_half = uvs[0][1] + (uvs[1][1] - uvs[0][1]) / 2;\n  if (slide_window) { // slide window\n    sprites.queueraw([tex], 0, 0, z, 1 - xoffs, 1 / 2,\n      0, uvs[0][1], uvs[1][0] * (1 - progress), v_half,\n      unit_vec);\n    sprites.queueraw([tex], 0 + xoffs, 1 / 2, z, 1 - xoffs, 1 / 2,\n      uvs[1][0] * progress, v_half, uvs[1][0], uvs[1][1],\n      unit_vec);\n  } else { // slide image\n    sprites.queueraw([tex], 0 - xoffs, 0, z, 1, 1 / 2,\n      uvs[0][0], uvs[0][1], uvs[1][0], v_half,\n      unit_vec);\n    sprites.queueraw([tex], 0 + xoffs, 1 / 2, z, 1, 1 / 2,\n      uvs[0][0], v_half, uvs[1][0], uvs[1][1],\n      unit_vec);\n  }\n  let border_grow_progress = min(progress * 4, 1);\n  border_color[3] = border_grow_progress;\n  border_width *= border_grow_progress;\n  // TODO: Would look better if the horizontal border grew from the middle out, so the overlapping bit is identical\n  // on both sides\n  glov_ui.drawRect(0, 0.5 - border_width, 1 - xoffs, 0.5, z + 1, border_color);\n  glov_ui.drawRect(1 - xoffs - border_width, 0, 1 - xoffs, 0.5, z + 1, border_color);\n  glov_ui.drawRect(xoffs, 0.5, 1, 0.5 + border_width, z + 1, border_color);\n  glov_ui.drawRect(xoffs, 0.5, xoffs + border_width, 1, z + 1, border_color);\n\n  if (force_end || progress === 1) {\n    return REMOVE;\n  }\n  return CONTINUE;\n}\n\nconst render_scale = 1;\nlet transition_pixelate_textures = [null];\n\nfunction transitionPixelateCapture() {\n  let tex = framebufferEnd();\n  framebufferStart({\n    width: tex.width,\n    height: tex.height,\n    final: effectsIsFinal(),\n  });\n  transition_pixelate_textures[0] = tex;\n}\n\nfunction glovTransitionPixelateFunc(time, z, tex, ms_since_start, force_end) {\n  //ms_since_start %= time;\n  //let viewport = glov_engine.graphics_device.getViewport();\n  //let gd_width = viewport[2];\n  let gd_width = glov_engine.width;\n  let progress = min(ms_since_start / time, 1);\n  camera2d.setNormalized();\n\n  transition_pixelate_textures[0] = tex;\n  if (progress > 0.5) {\n    effectsQueue(z, transitionPixelateCapture); // modifies transition_pixelate_textures[]\n  }\n\n  let partial_progress = (progress > 0.5 ? 1 - progress : progress) * 2;\n  // Use power of two scalings, but then scale relative to a 1024px virtual screen, so the biggest\n  //  pixel is about the same percentage of the screen regardless of resolution.\n  let pixel_scale = pow(2, floor(partial_progress * 8.9)) / 1024 * gd_width * render_scale;\n\n  let param0 = vec4(tex.width / pixel_scale, tex.height / pixel_scale,\n    pixel_scale / tex.width, pixel_scale / tex.height);\n  let param1 = vec4(0.5 / tex.width, 0.5 / tex.height,\n    (tex.texSizeX - 1) / tex.width, (tex.texSizeY - 1) / tex.height);\n\n\n  sprites.queueraw(transition_pixelate_textures, 0, 0, z + 1, 1, 1,\n    0, 1, 1, 0,\n    unit_vec, getShader('transition_pixelate'), {\n      param0,\n      param1,\n    });\n\n  if (force_end || progress === 1) {\n    return REMOVE;\n  }\n  return CONTINUE;\n}\n\nexport function fade(fade_time) {\n  return glovTransitionFadeFunc.bind(null, fade_time);\n}\n\n// export function wipe(wipe_time, wipe_angle) {\n//   return glovTransitionWipeFunc.bind(null, wipe_time, wipe_angle);\n// }\n\n// border_width in camera-relative size\nexport function splitScreen(time, border_width, slide_window) {\n  border_width /= camera2d.w(); // convert to normalized units\n  return glovTransitionSplitScreenFunc.bind(null, time, border_width, slide_window);\n}\n\nexport function pixelate(fade_time) {\n  return glovTransitionPixelateFunc.bind(null, fade_time);\n}\n\n// export function logoZoom(time, logo) {\n//   return glovTransitionLogoZoomFunc.bind(null, time, logo);\n// }\n\nexport function randomTransition(fade_time_scale) {\n  fade_time_scale = fade_time_scale || 1;\n  let idx = floor(random() * 3);\n  switch (idx) {\n    case 0:\n      return fade(500 * fade_time_scale);\n    case 1:\n      return splitScreen(250 * fade_time_scale, 2, false);\n    case 2:\n      return pixelate(750 * fade_time_scale);\n    // case 3:\n    //   return wipe(250 * fade_time_scale, random() * 2 * PI);\n    // case 4:\n    //   if (!logo) {\n    //     GlovTextureLoadOptions options;\n    //     options.clamp_s = options.clamp_t = true;\n    //     logo = GlovTextures::loadtex(\"data/SampleLogoTransition.png\", &options);\n    //   }\n    //   glovTransitionQueue(Z_TRANSITION_FINAL, glovTransitionLogoZoom(500, logo));\n    //   break;\n    default:\n      assert(0);\n  }\n  return null;\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint no-underscore-dangle:off */\n\nwindow.Z = window.Z || {};\nexport const Z = window.Z;\n\nexport const Z_MIN_INC = 1e-5;\n\nZ.BORDERS = Z.BORDERS || 90;\nZ.UI = Z.UI || 100;\nZ.MODAL = Z.MODAL || 1000;\nZ.TOOLTIP = Z.TOOLTIP || 2000;\nZ.DEBUG = Z.DEBUG || 9800;\n\n// very high, but can still add integers\nZ.TRANSITION_FINAL = Z.TRANSITION_FINAL || 9900;\n// how much Z range can be used for rendering transitions - the capture happens at z + Z_TRANSITION_RANGE\nZ.TRANSITION_RANGE = Z.TRANSITION_RANGE || 10;\n\nZ.FPSMETER = Z.FPSMETER || 10000;\n\nexport const LINE_ALIGN = 1<<0;\nexport const LINE_CAP_SQUARE = 1<<1;\nexport const LINE_CAP_ROUND = 1<<2;\n\nexport const internal = {\n  checkHooks, // eslint-disable-line @typescript-eslint/no-use-before-define\n  cleanupDOMElems, // eslint-disable-line @typescript-eslint/no-use-before-define\n  uiEndFrame, // eslint-disable-line @typescript-eslint/no-use-before-define\n  uiSetFonts, // eslint-disable-line @typescript-eslint/no-use-before-define\n  uiStartup, // eslint-disable-line @typescript-eslint/no-use-before-define\n  uiTick, // eslint-disable-line @typescript-eslint/no-use-before-define\n};\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst camera2d = require('./camera2d.js');\nconst { editBoxCreate, editBoxTick } = require('./edit_box.js');\nconst effects = require('./effects.js');\nconst { effectsQueue } = effects;\nconst glov_engine = require('./engine.js');\nconst glov_font = require('./font.js');\nconst { fontSetDefaultSize, fontStyle, fontStyleColored } = glov_font;\nconst glov_input = require('./input.js');\nconst { linkTick } = require('./link.js');\nconst { getStringFromLocalizable } = require('./localization.js');\nconst { abs, floor, max, min, round, sqrt } = Math;\nconst { scrollAreaSetPixelScale } = require('./scroll_area.js');\nconst { sliderSetDefaultShrink } = require('./slider.js');\nconst { soundLoad, soundPlay } = require('./sound.js');\nconst {\n  SPOT_DEFAULT_BUTTON,\n  SPOT_DEFAULT_BUTTON_DRAW_ONLY,\n  SPOT_DEFAULT_LABEL,\n  SPOT_STATE_REGULAR,\n  SPOT_STATE_DOWN,\n  SPOT_STATE_FOCUSED,\n  SPOT_STATE_DISABLED,\n  spot,\n  spotEndOfFrame,\n  spotKey,\n  spotPadMode,\n  spotPadSuppressed,\n  spotTopOfFrame,\n  spotUnfocus,\n} = require('./spot.js');\nconst glov_sprites = require('./sprites.js');\nconst {\n  BLEND_PREMULALPHA,\n  spriteClipped,\n  spriteClipPause,\n  spriteClipResume,\n  spriteChainedStart,\n  spriteChainedStop,\n  spriteCreate,\n} = glov_sprites;\nconst textures = require('./textures.js');\nconst { clamp, clone, defaults, deprecate, lerp, merge } = require('glov/common/util.js');\nconst { mat43, m43identity, m43mul } = require('./mat43.js');\nconst { vec2, vec4, v3scale, unit_vec } = require('glov/common/vmath.js');\n\ndeprecate(exports, 'slider_dragging', 'slider.js:sliderIsDragging()');\ndeprecate(exports, 'slider_rollover', 'slider.js:sliderIsFocused()');\ndeprecate(exports, 'setSliderDefaultShrink', 'slider.js:sliderSetDefaultShrink()');\ndeprecate(exports, 'slider', 'slider.js:slider()');\ndeprecate(exports, 'bindSounds', 'uiBindSounds');\ndeprecate(exports, 'modal_font_style', 'uiFontStyleModal()');\ndeprecate(exports, 'font_style_noraml', 'uiFontStyleNoraml()');\ndeprecate(exports, 'font_style_focused', 'uiFontStyleFocused()');\n\n\nconst MODAL_DARKEN = 0.75;\nlet KEYS;\nlet PAD;\n\nconst menu_fade_params_default = {\n  blur: [0.125, 0.865],\n  saturation: [0.5, 0.1],\n  brightness: [1, 1 - MODAL_DARKEN],\n  fallback_darken: vec4(0, 0, 0, MODAL_DARKEN),\n  z: Z.MODAL,\n};\n\nlet color_set_shades = vec4(1, 1, 1, 1);\n\nlet color_sets = [];\nfunction applyColorSet(color_set) {\n  v3scale(color_set.regular, color_set.color, color_set_shades[0]);\n  v3scale(color_set.rollover, color_set.color, color_set_shades[1]);\n  v3scale(color_set.down, color_set.color, color_set_shades[2]);\n  v3scale(color_set.disabled, color_set.color, color_set_shades[3]);\n}\nexport function makeColorSet(color) {\n  let ret = {\n    color,\n    regular: vec4(),\n    rollover: vec4(),\n    down: vec4(),\n    disabled: vec4(),\n  };\n  for (let field in ret) {\n    ret[field][3] = color[3];\n  }\n  color_sets.push(ret);\n  applyColorSet(ret);\n  return ret;\n}\n\nlet hooks = [];\nexport function addHook(draw, click) {\n  hooks.push({\n    draw,\n    click,\n  });\n}\n\nlet ui_elem_data = {};\n// Gets per-element state data that allows a paradigm of inter-frame state but\n//   without the caller being required to allocate a state container.\nexport function getUIElemData(type, param, allocator) {\n  let key = spotKey(param);\n  let by_type = ui_elem_data[type];\n  if (!by_type) {\n    by_type = ui_elem_data[type] = {};\n  }\n  let elem_data = by_type[key];\n  if (!elem_data) {\n    elem_data = by_type[key] = allocator ? allocator(param) : {};\n  }\n  elem_data.frame_index = glov_engine.frame_index;\n  return elem_data;\n}\n\nfunction doBlurEffect(factor) {\n  effects.applyGaussianBlur({\n    blur: factor,\n    // min_size: 128,\n  });\n}\n\nlet desaturate_xform = mat43();\nlet desaturate_tmp = mat43();\nfunction doDesaturateEffect(saturation, brightness) {\n  m43identity(desaturate_xform);\n\n  effects.saturationMatrix(desaturate_tmp, saturation);\n  m43mul(desaturate_xform, desaturate_xform, desaturate_tmp);\n\n  effects.brightnessScaleMatrix(desaturate_tmp, brightness);\n  m43mul(desaturate_xform, desaturate_xform, desaturate_tmp);\n\n  // if ((hue % (Math.PI * 2)) !== 0) {\n  //   effects.hueMatrix(tmp, hue);\n  //   m43mul(xform, xform, tmp);\n  // }\n  // if (contrast !== 1) {\n  //   effects.contrastMatrix(tmp, contrast);\n  //   m43mul(xform, xform, tmp);\n  // }\n  // if (brightness !== 0) {\n  //   effects.brightnessMatrix(tmp, brightness);\n  //   m43mul(xform, xform, tmp);\n  // }\n  // if (additiveRGB[0] !== 0 || additiveRGB[1] !== 0 || additiveRGB[2] !== 0) {\n  //   effects.additiveMatrix(tmp, additiveRGB);\n  //   m43mul(xform, xform, tmp);\n  // }\n  // if (grayscale) {\n  //   effects.grayScaleMatrix(tmp);\n  //   m43mul(xform, xform, tmp);\n  // }\n  // if (negative) {\n  //   effects.negativeMatrix(tmp);\n  //   m43mul(xform, xform, tmp);\n  // }\n  // if (sepia) {\n  //   effects.sepiaMatrix(tmp);\n  //   m43mul(xform, xform, tmp);\n  // }\n  effects.applyColorMatrix({\n    colorMatrix: desaturate_xform,\n  });\n}\n\n// overrideable default parameters\nexport let button_height = 32;\nexport let font_height = 24;\nexport let button_width = 200;\nexport let modal_button_width = 100;\nexport let button_img_size = button_height;\nexport let modal_width = 600;\nexport let modal_y0 = 200;\nexport let modal_title_scale = 1.2;\nexport let modal_pad = 16;\nexport let panel_pixel_scale = 32 / 13; // button_height / button pixel resolution\nexport let tooltip_panel_pixel_scale = panel_pixel_scale;\nexport let tooltip_width = 400;\nexport let tooltip_pad = 8;\n\n// export let font_style_focused = fontStyle(null, {\n//   color: 0x000000ff,\n//   outline_width: 2,\n//   outline_color: 0xFFFFFFff,\n// });\nlet font_style_normal;\nlet font_style_focused;\nlet font_style_disabled;\nlet font_style_modal;\n\nexport function setFontStyles(normal, focused, modal, disabled) {\n  font_style_normal = normal || fontStyleColored(null, 0x000000ff);\n  font_style_focused = focused || fontStyle(font_style_normal, {});\n  font_style_modal = modal || fontStyle(font_style_normal, {});\n  font_style_disabled = disabled || fontStyleColored(font_style_normal, 0x222222ff);\n}\nsetFontStyles();\n\nexport function uiFontStyleNormal() {\n  return font_style_normal;\n}\nexport function uiFontStyleFocused() {\n  return font_style_focused;\n}\nexport function uiFontStyleDisabled() {\n  return font_style_modal;\n}\nexport function uiFontStyleModal() {\n  return font_style_modal;\n}\n\nexport let font;\nexport let title_font;\nexport const sprites = {};\n\nexport const color_button = makeColorSet([1,1,1,1]);\nexport const color_panel = vec4(1, 1, 0.75, 1);\n\n\nlet sounds = {};\nexport let button_mouseover = false; // for callers to poll the very last button\nexport let button_focused = false; // for callers to poll the very last button\nexport let button_click = null; // on click, for callers to poll which mouse button, etc\n\nexport function buttonWasFocused() {\n  return button_focused;\n}\n\nlet modal_dialog = null;\nexport let menu_up = false; // Boolean to be set by app to impact behavior, similar to a modal\nlet menu_fade_params = merge({}, menu_fade_params_default);\nlet menu_up_time = 0;\n\nlet dom_elems = [];\nlet dom_elems_issued = 0;\n\n// for modal dialogs\nlet button_keys;\n\nlet default_line_mode;\n\n// These can be of types string or LocalizableString\nlet buttons_default_labels = {\n  ok: 'OK',\n  cancel: 'Cancel',\n  yes: 'Yes',\n  no: 'No',\n};\nlet default_copy_success_msg = 'Text copied to clipboard!';\nlet default_copy_failure_msg = 'Copy to clipboard FAILED, please copy from below.';\n\nexport function colorSetSetShades(rollover, down, disabled) {\n  color_set_shades[1] = rollover;\n  color_set_shades[2] = down;\n  color_set_shades[3] = disabled;\n  for (let ii = 0; ii < color_sets.length; ++ii) {\n    applyColorSet(color_sets[ii]);\n  }\n}\n\nexport function uiGetFontStyleFocused() {\n  return font_style_focused;\n}\n\nexport function uiSetFontStyleFocused(new_style) {\n  font_style_focused = new_style;\n}\n\nexport function loadUISprite(name, ws, hs) {\n  let wrap_s = gl.CLAMP_TO_EDGE;\n  let wrap_t = gl.CLAMP_TO_EDGE;\n  sprites[name] = spriteCreate({\n    name: `ui/${name}`,\n    ws,\n    hs,\n    wrap_s,\n    wrap_t,\n  });\n}\n\nexport function loadUISprite2(name, param) {\n  if (param === null) {\n    // skip it, assume not used\n    return;\n  }\n  let wrap_s = gl.CLAMP_TO_EDGE;\n  let wrap_t = param.wrap_t ? gl.REPEAT : gl.CLAMP_TO_EDGE;\n  let sprite_param = {\n    ws: param.ws,\n    hs: param.hs,\n    wrap_s,\n    wrap_t,\n    layers: param.layers,\n  };\n  if (param.url) {\n    sprite_param.url = param.url;\n  } else {\n    sprite_param.name = `ui/${param.name || name}`;\n  }\n  sprites[name] = spriteCreate(sprite_param);\n}\n\nfunction uiSetFonts(new_font, new_title_font) {\n  font = new_font;\n  title_font = new_title_font || font;\n}\n\nexport function setButtonsDefaultLabels(buttons_labels) {\n  for (const key in buttons_labels) {\n    buttons_default_labels[key.toLowerCase()] = buttons_labels[key];\n  }\n}\n\nexport function setProvideUserStringDefaultMessages(success_msg, failure_msg) {\n  default_copy_success_msg = success_msg;\n  default_copy_failure_msg = failure_msg;\n}\n\nconst base_ui_sprites = {\n  color_set_shades: [1, 1, 1],\n\n  white: { url: 'white' },\n\n  button: { ws: [8, 112, 8], hs: [128] },\n  button_rollover: { ws: [8, 112, 8], hs: [128] },\n  button_down: { ws: [8, 112, 8], hs: [128] },\n  button_disabled: { ws: [8, 112, 8], hs: [128] },\n  panel: { ws: [32, 64, 32], hs: [32, 64, 32] },\n\n  menu_entry: { ws: [8, 112, 8], hs: [128] },\n  menu_selected: { ws: [8, 112, 8], hs: [128] },\n  menu_down: { ws: [8, 112, 8], hs: [128] },\n  menu_header: { ws: [8, 112, 136], hs: [128] },\n  slider: { ws: [56, 16, 56], hs: [128] },\n  // slider_notch: { ws: [3], hs: [13] },\n  slider_handle: { ws: [64], hs: [128] },\n\n  scrollbar_bottom: { ws: [64], hs: [64] },\n  scrollbar_trough: { ws: [64], hs: [8], wrap_t: true },\n  scrollbar_top: { ws: [64], hs: [64] },\n  scrollbar_handle_grabber: { ws: [64], hs: [64] },\n  scrollbar_handle: { ws: [64], hs: [24, 16, 24] },\n  progress_bar: { ws: [48, 32, 48], hs: [128] },\n  progress_bar_trough: { ws: [48, 32, 48], hs: [128] },\n};\n\nfunction uiStartup(param) {\n  font = param.font;\n  title_font = param.title_font || font;\n  let overrides = param.ui_sprites;\n  KEYS = glov_input.KEYS;\n  PAD = glov_input.PAD;\n\n  let ui_sprites = {\n    ...base_ui_sprites,\n    ...param.ui_sprites,\n  };\n\n  for (let key in ui_sprites) {\n    let base_elem = base_ui_sprites[key];\n    if (typeof base_elem === 'object' && !Array.isArray(base_elem)) {\n      let override = overrides && overrides[key];\n      loadUISprite2(key, override === undefined ? base_elem : override);\n    }\n  }\n  sprites.button_regular = sprites.button;\n\n  if (ui_sprites.color_set_shades) {\n    colorSetSetShades(...ui_sprites.color_set_shades);\n  }\n  if (ui_sprites.slider_params) {\n    sliderSetDefaultShrink(...ui_sprites.slider_params);\n  }\n\n  if (sprites.button_rollover && color_set_shades[1] !== 1) {\n    colorSetSetShades(1, color_set_shades[2], color_set_shades[3]);\n  }\n  if (sprites.button_down && color_set_shades[2] !== 1) {\n    colorSetSetShades(color_set_shades[1], 1, color_set_shades[3]);\n  }\n  if (sprites.button_disabled && color_set_shades[3] !== 1) {\n    colorSetSetShades(color_set_shades[1], color_set_shades[2], 1);\n  }\n\n  button_keys = {\n    ok: { key: [KEYS.O], pad: [PAD.X], low_key: [KEYS.ESC] },\n    cancel: { key: [KEYS.ESC], pad: [PAD.B, PAD.Y] },\n  };\n  button_keys.yes = clone(button_keys.ok);\n  button_keys.yes.key.push(KEYS.Y);\n  button_keys.no = clone(button_keys.cancel);\n  button_keys.no.key.push(KEYS.N);\n\n  if (param.line_mode !== undefined) {\n    default_line_mode = param.line_mode;\n  } else {\n    default_line_mode = LINE_ALIGN|LINE_CAP_ROUND;\n    // let is_pixely = param.pixely && param.pixely !== 'off';\n    // if (is_pixely) {\n    //   // Maybe want to not do aligning here, causes inconsistencies when smoothly scrolling\n    //   default_line_mode = 0;\n    // }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-use-before-define\n  scaleSizes(1);\n}\n\nlet dynamic_text_elem;\nlet per_frame_dom_alloc = [0,0,0,0,0,0,0];\nlet per_frame_dom_suppress = 0;\nexport function suppressNewDOMElemWarnings() {\n  per_frame_dom_suppress = glov_engine.frame_index + 1;\n}\nexport function uiGetDOMElem(last_elem, allow_modal) {\n  if (modal_dialog && !allow_modal) {\n    // Note: this case is no longer needed for edit boxes (spot's focus logic\n    //   handles this), but links still rely on this\n    return null;\n  }\n  if (dom_elems_issued >= dom_elems.length || !last_elem) {\n    let elem = document.createElement('div');\n    if (glov_engine.DEBUG && !glov_engine.resizing() && glov_engine.frame_index > per_frame_dom_suppress) {\n      per_frame_dom_alloc[glov_engine.frame_index % per_frame_dom_alloc.length] = 1;\n      let sum = 0;\n      for (let ii = 0; ii < per_frame_dom_alloc.length; ++ii) {\n        sum += per_frame_dom_alloc[ii];\n      }\n      assert(sum < per_frame_dom_alloc.length, 'Allocated new DOM elements for too many consecutive frames');\n    }\n    elem.setAttribute('class', 'glovui_dynamic');\n    if (!dynamic_text_elem) {\n      dynamic_text_elem = document.getElementById('dynamic_text');\n    }\n    dynamic_text_elem.appendChild(elem);\n    dom_elems.push(elem);\n    last_elem = elem;\n  }\n  if (dom_elems[dom_elems_issued] !== last_elem) {\n    for (let ii = dom_elems_issued + 1; ii < dom_elems.length; ++ii) {\n      if (dom_elems[ii] === last_elem) {\n        dom_elems[ii] = dom_elems[dom_elems_issued];\n        dom_elems[dom_elems_issued] = last_elem;\n      }\n    }\n  }\n  let elem = dom_elems[dom_elems_issued];\n  dom_elems_issued++;\n  return elem;\n}\n\nconst base_ui_sounds = {\n  button_click: 'button_click',\n  rollover: 'rollover',\n};\n\nexport function uiBindSounds(_sounds) {\n  sounds = defaults(_sounds || {}, base_ui_sounds);\n  for (let key in sounds) {\n    soundLoad(sounds[key]);\n  }\n}\n\nlet draw_box_param = {\n  nozoom: true, // nozoom since different parts of the box get zoomed differently\n};\nexport function drawHBox(coords, s, color) {\n  spriteChainedStart();\n  let uidata = s.uidata;\n  let x = coords.x;\n  let ws = [uidata.wh[0] * coords.h, 0, uidata.wh[2] * coords.h];\n  if (coords.no_min_width && ws[0] + ws[2] > coords.w) {\n    let scale = coords.w / (ws[0] + ws[2]);\n    ws[0] *= scale;\n    ws[2] *= scale;\n  } else {\n    ws[1] = max(0, coords.w - ws[0] - ws[2]);\n  }\n  draw_box_param.y = coords.y;\n  draw_box_param.z = coords.z;\n  draw_box_param.h = coords.h;\n  draw_box_param.color = color;\n  draw_box_param.color1 = coords.color1;\n  draw_box_param.shader = null; // gets overridden in drawDualTint\n  for (let ii = 0; ii < ws.length; ++ii) {\n    let my_w = ws[ii];\n    if (my_w) {\n      draw_box_param.x = x;\n      draw_box_param.w = my_w;\n      draw_box_param.uvs = uidata.rects[ii];\n      if (coords.color1) {\n        s.drawDualTint(draw_box_param);\n      } else {\n        s.draw(draw_box_param);\n      }\n    }\n    x += my_w;\n  }\n  spriteChainedStop();\n}\n\nexport function drawVBox(coords, s, color) {\n  spriteChainedStart();\n  let uidata = s.uidata;\n  let hs = [uidata.hw[0] * coords.w, 0, uidata.hw[2] * coords.w];\n  let y = coords.y;\n  hs[1] = max(0, coords.h - hs[0] - hs[2]);\n  draw_box_param.x = coords.x;\n  draw_box_param.z = coords.z;\n  draw_box_param.w = coords.w;\n  draw_box_param.color = color;\n  draw_box_param.shader = null;\n  for (let ii = 0; ii < hs.length; ++ii) {\n    let my_h = hs[ii];\n    draw_box_param.y = y;\n    draw_box_param.h = my_h;\n    draw_box_param.uvs = uidata.rects[ii];\n    s.draw(draw_box_param);\n    y += my_h;\n  }\n  spriteChainedStop();\n}\n\nexport function drawBox(coords, s, pixel_scale, color) {\n  spriteChainedStart();\n  let uidata = s.uidata;\n  let scale = pixel_scale;\n  let ws = [uidata.widths[0] * scale, 0, uidata.widths[2] * scale];\n  ws[1] = max(0, coords.w - ws[0] - ws[2]);\n  let hs = [uidata.heights[0] * scale, 0, uidata.heights[2] * scale];\n  hs[1] = max(0, coords.h - hs[0] - hs[2]);\n  let x = coords.x;\n  draw_box_param.z = coords.z;\n  draw_box_param.color = color;\n  draw_box_param.shader = null;\n  for (let ii = 0; ii < ws.length; ++ii) {\n    let my_w = ws[ii];\n    if (my_w) {\n      draw_box_param.x = x;\n      draw_box_param.w = my_w;\n      let y = coords.y;\n      for (let jj = 0; jj < hs.length; ++jj) {\n        let my_h = hs[jj];\n        if (my_h) {\n          draw_box_param.y = y;\n          draw_box_param.h = my_h;\n          draw_box_param.uvs = uidata.rects[jj * 3 + ii];\n          s.draw(draw_box_param);\n          y += my_h;\n        }\n      }\n      x += my_w;\n    }\n  }\n  spriteChainedStop();\n}\n\nexport function drawMultiPartBox(coords, scaleable_data, s, pixel_scale, color) {\n  spriteChainedStart();\n  let uidata = s.uidata;\n  let scale = pixel_scale;\n\n  let ws = [];\n  let fixed_w_sum = 0;\n  let scaleable_sum = 0;\n  for (let i = 0; i < uidata.widths.length; i++) {\n    if (scaleable_data.widths[i] < 0) {\n      ws.push(uidata.widths[i] * scale);\n      fixed_w_sum += uidata.widths[i] * scale;\n    } else {\n      ws.push(0);\n      scaleable_sum += scaleable_data.widths[i];\n    }\n  }\n  assert(scaleable_sum === 1);\n  for (let i = 0; i < uidata.widths.length; i++) {\n    if (scaleable_data.widths[i] >= 0) {\n      ws[i] = max(0, (coords.w - fixed_w_sum) * scaleable_data.widths[i]);\n    }\n  }\n\n  scaleable_sum = 0;\n  let hs = [];\n  let fixed_h_sum = 0;\n  for (let i = 0; i < uidata.heights.length; i++) {\n    if (scaleable_data.heights[i] < 0) {\n      hs.push(uidata.heights[i] * scale);\n      fixed_h_sum += uidata.heights[i] * scale;\n    } else {\n      hs.push(0);\n      scaleable_sum += scaleable_data.heights[i];\n    }\n  }\n  assert(scaleable_sum === 1);\n  for (let i = 0; i < uidata.heights.length; i++) {\n    if (scaleable_data.heights[i] >= 0) {\n      hs[i] = max(0, (coords.h - fixed_h_sum) * scaleable_data.heights[i]);\n    }\n  }\n  let x = coords.x;\n  for (let ii = 0; ii < ws.length; ++ii) {\n    let my_w = ws[ii];\n    if (my_w) {\n      let y = coords.y;\n      for (let jj = 0; jj < hs.length; ++jj) {\n        let my_h = hs[jj];\n        if (my_h) {\n          s.draw({\n            x, y, z: coords.z,\n            color,\n            w: my_w,\n            h: my_h,\n            uvs: uidata.rects[jj * ws.length + ii],\n            nozoom: true, // nozoom since different parts of the box get zoomed differently\n          });\n          y += my_h;\n        }\n      }\n      x += my_w;\n    }\n  }\n  spriteChainedStop();\n}\n\nexport function playUISound(name, volume) {\n  profilerStartFunc();\n  if (name === 'select') {\n    name = 'button_click';\n  }\n  if (sounds[name]) {\n    soundPlay(sounds[name], volume);\n  }\n  profilerStopFunc();\n}\n\nexport function focusCanvas() {\n  spotUnfocus();\n}\n\n// Returns true if the navigation inputs (arrows, etc) should go to the UI, not the app\nexport function uiHandlingNav() {\n  return menu_up || !spotPadSuppressed();\n}\n\nexport function panel(param) {\n  assert(typeof param.x === 'number');\n  assert(typeof param.y === 'number');\n  assert(typeof param.w === 'number');\n  assert(typeof param.h === 'number');\n  param.z = param.z || (Z.UI - 1);\n  param.eat_clicks = param.eat_clicks === undefined ? true : param.eat_clicks;\n  let color = param.color || color_panel;\n  drawBox(param, param.sprite || sprites.panel, param.pixel_scale || panel_pixel_scale, color);\n  if (param.eat_clicks) {\n    glov_input.mouseOver(param);\n  }\n}\n\nexport function drawTooltip(param) {\n  let { tooltip } = param;\n  if (typeof tooltip === 'function') {\n    tooltip = tooltip(param);\n    if (!tooltip) {\n      return;\n    }\n  }\n  tooltip = getStringFromLocalizable(tooltip);\n\n  assert(typeof param.x === 'number');\n  assert(typeof param.y === 'number');\n  assert(typeof tooltip === 'string');\n\n  let clip_pause = spriteClipped();\n  if (clip_pause) {\n    spriteClipPause();\n  }\n\n  let tooltip_w = param.tooltip_width || tooltip_width;\n  let z = param.z || Z.TOOLTIP;\n  let tooltip_y0 = param.y;\n  let eff_tooltip_pad = param.tooltip_pad || tooltip_pad;\n  let w = tooltip_w - eff_tooltip_pad * 2;\n  let dims = font.dims(font_style_modal, w, 0, font_height, tooltip);\n  let above = param.tooltip_above;\n  if (!above && param.tooltip_auto_above_offset) {\n    above = tooltip_y0 + dims.h + eff_tooltip_pad * 2 > camera2d.y1();\n  }\n  let x = param.x;\n  let eff_tooltip_w = dims.w + eff_tooltip_pad * 2;\n  if (x + eff_tooltip_w > camera2d.x1()) {\n    x = camera2d.x1() - eff_tooltip_w;\n  }\n\n  if (above) {\n    tooltip_y0 -= dims.h + eff_tooltip_pad * 2 + (param.tooltip_auto_above_offset || 0);\n  }\n  let y = tooltip_y0 + eff_tooltip_pad;\n  y += font.drawSizedWrapped(font_style_modal,\n    x + eff_tooltip_pad, y, z+1, w, 0, font_height,\n    tooltip);\n  y += eff_tooltip_pad;\n  let pixel_scale = param.pixel_scale || tooltip_panel_pixel_scale;\n\n  panel({\n    x,\n    y: tooltip_y0,\n    z,\n    w: eff_tooltip_w,\n    h: y - tooltip_y0,\n    pixel_scale,\n    eat_clicks: false,\n  });\n  if (clip_pause) {\n    spriteClipResume();\n  }\n}\n\nfunction checkHooks(param, click) {\n  if (param.hook) {\n    for (let ii = 0; ii < hooks.length; ++ii) {\n      if (click) {\n        hooks[ii].click(param);\n      }\n      hooks[ii].draw(param);\n    }\n  }\n}\n\nexport function drawTooltipBox(param) {\n  let { tooltip } = param;\n  if (typeof tooltip === 'function') {\n    tooltip = tooltip(param);\n    if (!tooltip) {\n      return;\n    }\n  }\n  drawTooltip({\n    x: param.x,\n    y: param.y + param.h + 2,\n    tooltip_auto_above_offset: param.h + 4,\n    tooltip_above: param.tooltip_above,\n    tooltip,\n    tooltip_width: param.tooltip_width,\n  });\n}\n\nexport function progressBar(param) {\n  drawHBox(param, sprites.progress_bar_trough, param.color_trough || param.color || unit_vec);\n  let progress = clamp(param.progress, 0, 1);\n  drawHBox({\n    x: param.x + (param.centered ? param.w * (1-progress) * 0.5 : 0),\n    y: param.y,\n    z: (param.z || Z.UI) + Z_MIN_INC,\n    w: param.w * progress,\n    h: param.h,\n    no_min_width: true,\n  }, sprites.progress_bar, param.color || unit_vec);\n  if (param.tooltip) {\n    spot({\n      x: param.x, y: param.y,\n      w: param.w, h: param.h,\n      tooltip: param.tooltip,\n      def: SPOT_DEFAULT_LABEL,\n    });\n  }\n}\n\n// TODO: refactor so callers all use the new states 'focused'\nconst SPOT_STATE_TO_UI_BUTTON_STATE = {\n  [SPOT_STATE_REGULAR]: 'regular',\n  [SPOT_STATE_DOWN]: 'down',\n  [SPOT_STATE_FOCUSED]: 'rollover',\n  [SPOT_STATE_DISABLED]: 'disabled',\n};\n\nconst UISPOT_BUTTON_DISABLED = {\n  ...SPOT_DEFAULT_BUTTON,\n  disabled: true,\n  disabled_focusable: false,\n  sound_rollover: null,\n};\n\n\nexport function buttonShared(param) {\n  profilerStartFunc();\n  param.z = param.z || Z.UI;\n  if (param.rollover_quiet) {\n    param.sound_rollover = null;\n  }\n  let spot_ret;\n  if (param.draw_only && !param.draw_only_mouseover) {\n    // no spot() needed\n    spot_ret = { ret: false, state: 'regular', focused: false };\n  } else {\n    if (param.draw_only) {\n      assert(!param.def || param.def === SPOT_DEFAULT_BUTTON_DRAW_ONLY);\n      param.def = SPOT_DEFAULT_BUTTON_DRAW_ONLY;\n    } else if (param.disabled && !param.disabled_focusable) {\n      param.def = param.def || UISPOT_BUTTON_DISABLED;\n    } else {\n      param.def = param.def || SPOT_DEFAULT_BUTTON;\n    }\n    if (param.sound) {\n      param.sound_button = param.sound;\n    }\n    spot_ret = spot(param);\n    spot_ret.state = SPOT_STATE_TO_UI_BUTTON_STATE[spot_ret.spot_state];\n    if (spot_ret.ret) {\n      // TODO: refactor callers to gather this from spot_ret, passes as return from button()/etc\n      button_click = spot_ret;\n      button_click.was_double_click = spot_ret.double_click;\n    }\n  }\n\n  button_focused = button_mouseover = spot_ret.focused;\n  param.z += param.z_bias && param.z_bias[spot_ret.state] || 0;\n  profilerStopFunc();\n  return spot_ret;\n}\n\nexport let button_last_color;\nexport function buttonBackgroundDraw(param, state) {\n  profilerStartFunc();\n  let colors = param.colors || color_button;\n  let color = button_last_color = param.color || colors[state];\n  if (!param.no_bg) {\n    let base_name = param.base_name || 'button';\n    let sprite_name = `${base_name}_${state}`;\n    let sprite = sprites[sprite_name];\n    // Note: was if (sprite) color = colors.regular for specific-sprite matches\n    if (!sprite) {\n      sprite = sprites[base_name];\n    }\n\n    drawHBox(param, sprite, color);\n  }\n  profilerStopFunc();\n}\n\nexport function buttonSpotBackgroundDraw(param, spot_state) {\n  profilerStartFunc();\n  let state = SPOT_STATE_TO_UI_BUTTON_STATE[spot_state];\n  let colors = param.colors || color_button;\n  let color = button_last_color = param.color || colors[state];\n  if (!param.no_bg) {\n    let base_name = param.base_name || 'button';\n    let sprite_name = `${base_name}_${state}`;\n    let sprite = sprites[sprite_name];\n    // Note: was if (sprite) color = colors.regular for specific-sprite matches\n    if (!sprite) {\n      sprite = sprites[base_name];\n    }\n\n    drawHBox(param, sprite, color);\n  }\n  profilerStopFunc();\n}\n\nexport function buttonTextDraw(param, state, focused) {\n  profilerStartFunc();\n  buttonBackgroundDraw(param, state);\n  let hpad = min(param.font_height * 0.25, param.w * 0.1);\n  let disabled = state === 'disabled';\n  font.drawSizedAligned(\n    disabled ? font_style_disabled : focused ? font_style_focused : font_style_normal,\n    param.x + hpad, param.y, param.z + 0.1,\n    param.font_height, param.align || glov_font.ALIGN.HVCENTERFIT, param.w - hpad * 2, param.h, param.text);\n  profilerStopFunc();\n}\n\nexport function buttonText(param) {\n  profilerStartFunc();\n  param.text = getStringFromLocalizable(param.text);\n\n  // required params\n  assert(typeof param.x === 'number');\n  assert(typeof param.y === 'number');\n  assert(typeof param.text === 'string');\n  // optional params\n  // param.z = param.z || Z.UI;\n  param.w = param.w || button_width;\n  param.h = param.h || button_height;\n  param.font_height = param.font_height || font_height;\n\n  let spot_ret = buttonShared(param);\n  let { ret, state, focused } = spot_ret;\n  buttonTextDraw(param, state, focused);\n  profilerStopFunc();\n  return ret ? spot_ret : null;\n}\n\nfunction buttonImageDraw(param, state, focused) {\n  profilerStartFunc();\n  let uvs = param.img_rect;\n  let img = param.imgs && param.imgs[state] || param.img;\n  if (typeof param.frame === 'number') {\n    uvs = img.uidata.rects[param.frame];\n  }\n  buttonBackgroundDraw(param, state);\n  let color = button_last_color;\n  let img_origin = img.origin;\n  let img_w = img.size[0];\n  let img_h = img.size[1];\n  let aspect = img_w / img_h;\n  if (typeof param.frame === 'number') {\n    aspect = img.uidata.aspect ? img.uidata.aspect[param.frame] : 1;\n  }\n  let largest_w_horiz = param.w * param.shrink;\n  let largest_w_vert = param.h * param.shrink * aspect;\n  img_w = min(largest_w_horiz, largest_w_vert);\n  img_h = img_w / aspect;\n  let pad_top = (param.h - img_h) / 2;\n  let draw_param = {\n    x: param.x + (param.left_align ? pad_top : (param.w - img_w) / 2) + img_origin[0] * img_w,\n    y: param.y + pad_top + img_origin[1] * img_h,\n    z: param.z + (param.z_inc || Z_MIN_INC),\n    // use img_color if provided, use explicit tint if doing dual-tinting, otherwise button color\n    color: param.img_color || param.color1 && param.color || color,\n    color1: param.color1,\n    w: img_w / img.size[0],\n    h: img_h / img.size[1],\n    uvs,\n    rot: param.rotation,\n  };\n  if (param.flip) {\n    let { x, w } = draw_param;\n    draw_param.x = x + w;\n    draw_param.w = -w;\n  }\n  if (param.color1) {\n    img.drawDualTint(draw_param);\n  } else {\n    img.draw(draw_param);\n  }\n  profilerStopFunc();\n}\n\nexport function buttonImage(param) {\n  profilerStartFunc();\n  // required params\n  assert(typeof param.x === 'number');\n  assert(typeof param.y === 'number');\n  assert(param.imgs || param.img && param.img.draw); // should be a sprite\n  // optional params\n  param.z = param.z || Z.UI;\n  param.w = param.w || button_img_size;\n  param.h = param.h || param.w || button_img_size;\n  param.shrink = param.shrink || 0.75;\n  //param.img_rect; null -> full image\n\n  let spot_ret = buttonShared(param);\n  let { ret, state, focused } = spot_ret;\n  buttonImageDraw(param, state, focused);\n  profilerStopFunc();\n  return ret ? spot_ret : null;\n}\n\nexport function button(param) {\n  if (param.img && !param.text) {\n    return buttonImage(param);\n  } else if (param.text && !param.img) {\n    return buttonText(param);\n  }\n  profilerStartFunc();\n\n  // required params\n  assert(typeof param.x === 'number');\n  assert(typeof param.y === 'number');\n  assert(param.img && param.img.draw); // should be a sprite\n  // optional params\n  param.z = param.z || Z.UI;\n  // w/h initialize differently than either buttonText or buttonImage\n  param.h = param.h || button_img_size;\n  param.w = param.w || button_width;\n  param.shrink = param.shrink || 0.75;\n  //param.img_rect; null -> full image\n  param.left_align = true; // always left-align images\n  param.font_height = param.font_height || font_height;\n\n  let spot_ret = buttonShared(param);\n  let { ret, state, focused } = spot_ret;\n  buttonImageDraw(param, state, focused);\n  // Hide some stuff on the second draw\n  let saved_no_bg = param.no_bg;\n  let saved_w = param.w;\n  let saved_x = param.x;\n  param.no_bg = true;\n  param.x += param.h * param.shrink;\n  param.w -= param.h * param.shrink;\n  buttonTextDraw(param, state, focused);\n\n  param.no_bg = saved_no_bg;\n  param.w = saved_w;\n  param.x = saved_x;\n  profilerStopFunc();\n  return ret ? spot_ret : null;\n}\n\nexport function print(style, x, y, z, text) {\n  return font.drawSized(style, x, y, z, font_height, text);\n}\n\nexport function label(param) {\n  profilerStartFunc();\n  let { style, x, y, align, w, h, text, tooltip } = param;\n  text = getStringFromLocalizable(text);\n  let use_font = param.font || font;\n  let z = param.z || Z.UI;\n  let size = param.size || font_height;\n  assert(isFinite(x));\n  assert(isFinite(y));\n  assert.equal(typeof text, 'string');\n  if (tooltip) {\n    if (!w) {\n      w = use_font.getStringWidth(style, size, text);\n    }\n    assert(isFinite(w));\n    assert(isFinite(h));\n    let spot_ret = spot({\n      x, y, w, h,\n      tooltip: tooltip,\n      def: SPOT_DEFAULT_LABEL,\n    });\n    if (spot_ret.focused && spotPadMode()) {\n      if (param.style_focused) {\n        style = param.style_focused;\n      } else {\n        // No focused style provided, do a generic glow instead?\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n        drawElipse(x - w*0.25, y-h*0.25, x + w*1.25, y + h*1.25, z - 0.001, 0.5, unit_vec);\n      }\n    }\n  }\n  if (text) {\n    if (align) {\n      use_font.drawSizedAligned(style, x, y, z, size, align, w, h, text);\n    } else {\n      use_font.drawSized(style, x, y, z, size, text);\n    }\n  }\n  profilerStopFunc();\n}\n\n// Note: modal dialogs not really compatible with HTML overlay on top of the canvas!\nexport function modalDialog(param) {\n  param.title = getStringFromLocalizable(param.title);\n  param.text = `${getStringFromLocalizable(param.text) || ''}`;\n\n  assert(!param.title || typeof param.title === 'string');\n  assert(!param.text || typeof param.text === 'string');\n  assert(!param.buttons || typeof param.buttons === 'object');\n  if (param.buttons) {\n    for (let key in param.buttons) {\n      if (typeof param.buttons[key] !== 'object') {\n        // Button is function or null\n        param.buttons[key] = { cb: param.buttons[key] };\n      }\n    }\n  }\n  // assert(Object.keys(param.buttons).length);\n  modal_dialog = param;\n}\n\nexport function modalDialogClear() {\n  modal_dialog = null;\n}\n\nlet dom_requirement = vec2(24,24);\nlet virtual_size = vec2();\nfunction modalDialogRun() {\n  camera2d.domDeltaToVirtual(virtual_size, dom_requirement);\n  let fullscreen_mode = false;\n  let eff_font_height = modal_dialog.font_height || font_height;\n  let eff_button_height = button_height;\n  let pad = modal_pad;\n  let vpad = modal_pad * 0.5;\n  let general_scale = 1;\n  let exit_lock = true;\n  let num_lines;\n  if (virtual_size[0] > 0.05 * camera2d.h() && camera2d.w() > camera2d.h() * 2) {\n    // If a 24-pt font is more than 5% of the camera height, we're probably super-wide-screen\n    // on a mobile device due to keyboard being visible\n    fullscreen_mode = true;\n    eff_button_height = eff_font_height;\n    vpad = pad = 4;\n\n    let old_h = camera2d.h();\n    camera2d.push();\n    // Find a number of lines (and implicit scaling) such they all fit\n    for (num_lines = 1; ; num_lines++) {\n      camera2d.setAspectFixed2(1, eff_font_height * (modal_title_scale + 1 + num_lines) + pad * 4.5);\n      general_scale = camera2d.h() / old_h;\n      if (!modal_dialog.text) {\n        break;\n      }\n      const game_width = camera2d.x1() - camera2d.x0();\n      const text_w = game_width - pad * 2;\n      let wrapped_numlines = font.numLines(font_style_modal, text_w, 0, eff_font_height, modal_dialog.text);\n      if (wrapped_numlines <= num_lines) {\n        break;\n      }\n    }\n  }\n\n  let { buttons, click_anywhere } = modal_dialog;\n  let keys = Object.keys(buttons || {});\n\n  const game_width = camera2d.x1() - camera2d.x0();\n  const eff_modal_width = fullscreen_mode ? game_width : (modal_dialog.width || modal_width);\n  let eff_button_width = modal_dialog.button_width || modal_button_width;\n  let max_total_button_width = eff_modal_width * 2 / 3;\n  eff_button_width = min(eff_button_width, max_total_button_width / keys.length);\n  const text_w = eff_modal_width - pad * 2;\n  const x0 = camera2d.x0() + round((game_width - eff_modal_width) / 2);\n  let x = x0 + pad;\n  const y0 = fullscreen_mode ? 0 : (modal_dialog.y0 || modal_y0);\n  let y = round(y0 + pad);\n\n  if (modal_dialog.title) {\n    if (fullscreen_mode) {\n      title_font.drawSizedAligned(font_style_modal, x, y, Z.MODAL, eff_font_height * modal_title_scale,\n        glov_font.ALIGN.HFIT, text_w, 0, modal_dialog.title);\n      y += eff_font_height * modal_title_scale;\n    } else {\n      y += title_font.drawSizedWrapped(font_style_modal,\n        x, y, Z.MODAL, text_w, 0, eff_font_height * modal_title_scale,\n        modal_dialog.title);\n    }\n    y = round(y + vpad * 1.5);\n  }\n\n  if (modal_dialog.text || fullscreen_mode) {\n    if (fullscreen_mode) {\n      if (modal_dialog.text) {\n        font.drawSizedAligned(font_style_modal, x, y, Z.MODAL, eff_font_height,\n          glov_font.ALIGN.HWRAP, text_w, 0, modal_dialog.text);\n      }\n      y += eff_font_height * num_lines;\n    } else {\n      y += font.drawSizedWrapped(font_style_modal, x, y, Z.MODAL, text_w, 0, eff_font_height,\n        modal_dialog.text);\n    }\n    y = round(y + vpad);\n  }\n\n  let panel_color = modal_dialog.color || null; // tick might clear modalDialog\n\n  let tick_key;\n  if (modal_dialog.tick) {\n    let avail_width = eff_modal_width - pad * 2;\n    if (fullscreen_mode) {\n      avail_width -= (pad + eff_button_width) * keys.length;\n    }\n    let param = {\n      x0, y0, x, y,\n      modal_width: eff_modal_width,\n      avail_width,\n      font_height: eff_font_height,\n      fullscreen_mode,\n    };\n    tick_key = modal_dialog.tick(param);\n    y = param.y;\n  }\n\n  x = x0 + eff_modal_width - (pad + eff_button_width) * keys.length;\n  let did_button = -1;\n  for (let ii = 0; ii < keys.length; ++ii) {\n    let key = keys[ii];\n    let key_lower = key.toLowerCase();\n    let cur_button = buttons[key] = buttons[key] || {};\n    let eff_button_keys = button_keys[key_lower];\n    let pressed = 0;\n    if (eff_button_keys) {\n      for (let jj = 0; jj < eff_button_keys.key.length; ++jj) {\n        pressed += glov_input.keyDownEdge(eff_button_keys.key[jj], cur_button.in_event_cb);\n        if (eff_button_keys.key[jj] === tick_key) {\n          pressed++;\n        }\n      }\n      for (let jj = 0; jj < eff_button_keys.pad.length; ++jj) {\n        pressed += glov_input.padButtonDownEdge(eff_button_keys.pad[jj]);\n      }\n    }\n    if (click_anywhere && ii === 0 && glov_input.click()) {\n      ++pressed;\n    }\n    if (pressed) {\n      did_button = ii;\n    }\n    let but_label = cur_button.label || buttons_default_labels[key_lower] || key;\n    if (buttonText(defaults({\n      key: `md_${key}`,\n      x, y, z: Z.MODAL,\n      w: eff_button_width,\n      h: eff_button_height,\n      text: but_label,\n      auto_focus: ii === 0,\n    }, cur_button))) {\n      did_button = ii;\n    }\n    x = round(x + pad + eff_button_width);\n  }\n  // Also check low-priority keys\n  if (did_button === -1) {\n    for (let ii = 0; ii < keys.length; ++ii) {\n      let key = keys[ii];\n      let eff_button_keys = button_keys[key.toLowerCase()];\n      if (eff_button_keys && eff_button_keys.low_key) {\n        for (let jj = 0; jj < eff_button_keys.low_key.length; ++jj) {\n          if (glov_input.keyDownEdge(eff_button_keys.low_key[jj], buttons[key].in_event_cb) ||\n          eff_button_keys.low_key[jj] === tick_key) {\n            did_button = ii;\n          }\n        }\n      }\n    }\n  }\n  if (did_button !== -1) {\n    let key = keys[did_button];\n    playUISound('button_click');\n    modal_dialog = null;\n    if (buttons[key].cb) {\n      buttons[key].cb();\n    }\n    exit_lock = false;\n  }\n  if (keys.length > 0) {\n    y += eff_button_height;\n  }\n  y = round(y + vpad + pad);\n  panel({\n    x: x0,\n    y: y0,\n    z: Z.MODAL - 1,\n    w: eff_modal_width,\n    h: (fullscreen_mode ? camera2d.y1() : y) - y0,\n    pixel_scale: panel_pixel_scale * general_scale,\n    color: panel_color,\n  });\n\n  if (glov_input.pointerLocked() && exit_lock) {\n    glov_input.pointerLockExit();\n  }\n\n  glov_input.eatAllInput();\n  if (fullscreen_mode) {\n    camera2d.pop();\n  }\n}\n\nexport function modalTextEntry(param) {\n  let eb = editBoxCreate({\n    initial_focus: true,\n    spellcheck: false,\n    initial_select: true,\n    text: param.edit_text,\n    max_len: param.max_len,\n    esc_clears: false,\n  });\n  let buttons = {};\n  for (let key in param.buttons) {\n    let cb = param.buttons[key];\n    if ((cb !== null) && (typeof cb === 'object') && ('cb' in cb)) {\n      cb = param.buttons[key].cb;\n    }\n    if (typeof cb === 'function') {\n      cb = (function (old_fn) {\n        return function () {\n          old_fn(eb.getText());\n        };\n      }(cb));\n    }\n    buttons[key] = defaults({ cb }, param.buttons[key]);\n  }\n  param.buttons = buttons;\n  param.text = `${param.text || ''}`;\n  let old_tick = param.tick;\n  param.tick = function (params) {\n    let eb_ret = eb.run({\n      x: params.x,\n      y: params.y,\n      w: params.avail_width || param.edit_w,\n      font_height: params.font_height,\n    });\n    if (!params.fullscreen_mode) {\n      params.y += params.font_height + modal_pad;\n    }\n    let ret;\n    if (eb_ret === eb.SUBMIT) {\n      ret = KEYS.O; // Do OK, Yes\n    } else if (eb_ret === eb.CANCEL) {\n      ret = KEYS.ESC; // Do Cancel, No\n    }\n    if (old_tick) {\n      ret = old_tick(params) || ret;\n    }\n    return ret;\n  };\n  modalDialog(param);\n}\n\n\nexport function createEditBox(param) {\n  return editBoxCreate(param);\n}\n\nlet pp_bad_frames = 0;\n\nexport function isMenuUp() {\n  return modal_dialog || menu_up;\n}\n\nfunction releaseOldUIElemData() {\n  for (let type in ui_elem_data) {\n    let by_type = ui_elem_data[type];\n    let any = false;\n    for (let key in by_type) {\n      let elem_data = by_type[key];\n      if (elem_data.frame_index < glov_engine.frame_index - 1) {\n        delete by_type[key];\n      } else {\n        any = true;\n      }\n    }\n    if (!any) {\n      delete ui_elem_data[type];\n    }\n  }\n}\n\nfunction uiTick(dt) {\n  per_frame_dom_alloc[glov_engine.frame_index % per_frame_dom_alloc.length] = 0;\n  releaseOldUIElemData();\n\n  editBoxTick();\n  linkTick();\n\n  dom_elems_issued = 0;\n\n  let pp_this_frame = false;\n  if (modal_dialog || menu_up) {\n    let params = menu_fade_params;\n    if (!menu_up) {\n      // Modals get defaults\n      params = menu_fade_params_default;\n    }\n    menu_up_time += dt;\n    // Effects during modal dialogs\n    let factor = min(menu_up_time / 500, 1);\n    if (glov_engine.postprocessing && !glov_engine.defines.NOPP) {\n      // Note: this lerp used to be done later in the frame (during drawing, not queueing) a problem?\n      let blur_factor = lerp(factor, params.blur[0], params.blur[1]);\n      if (blur_factor) {\n        effectsQueue(params.z - 2, doBlurEffect.bind(null, blur_factor));\n      }\n      let saturation = lerp(factor, params.saturation[0], params.saturation[1]);\n      let brightness = lerp(factor, params.brightness[0], params.brightness[1]);\n      if (saturation !== 1 || brightness !== 1) {\n        effectsQueue(params.z - 1, doDesaturateEffect.bind(null, saturation, brightness));\n      }\n      pp_this_frame = true;\n    } else {\n      // Or, just darken\n      sprites.white.draw({\n        x: camera2d.x0Real(),\n        y: camera2d.y0Real(),\n        z: params.z - 2,\n        color: params.fallback_darken,\n        w: camera2d.wReal(),\n        h: camera2d.hReal(),\n      });\n    }\n  } else {\n    menu_up_time = 0;\n  }\n  menu_up = false;\n\n  if (!glov_engine.is_loading && glov_engine.getFrameDtActual() > 50 && pp_this_frame) {\n    pp_bad_frames = (pp_bad_frames || 0) + 1;\n    if (pp_bad_frames >= 6) { // 6 in a row, disable superfluous postprocessing\n      glov_engine.postprocessingAllow(false);\n    }\n  } else if (pp_bad_frames) {\n    pp_bad_frames = 0;\n  }\n\n  spotTopOfFrame();\n\n  if (modal_dialog) {\n    modalDialogRun();\n  }\n}\n\nfunction uiEndFrame() {\n  spotEndOfFrame();\n\n  if (glov_input.click({\n    x: -Infinity, y: -Infinity,\n    w: Infinity, h: Infinity,\n  })) {\n    spotUnfocus();\n  }\n\n  while (dom_elems_issued < dom_elems.length) {\n    let elem = dom_elems.pop();\n    dynamic_text_elem.removeChild(elem);\n  }\n}\n\nfunction cleanupDOMElems() {\n  while (dom_elems.length) {\n    let elem = dom_elems.pop();\n    dynamic_text_elem.removeChild(elem);\n  }\n}\n\nexport function menuUp(param) {\n  merge(menu_fade_params, menu_fade_params_default);\n  if (param) {\n    merge(menu_fade_params, param);\n  }\n  menu_up = true;\n  glov_input.eatAllInput();\n}\n\nexport function copyTextToClipboard(text) {\n  let textArea = document.createElement('textarea');\n  textArea.style.position = 'fixed';\n  textArea.style.top = 0;\n  textArea.style.left = 0;\n  textArea.style.width = '2em';\n  textArea.style.height = '2em';\n  textArea.style.border = 'none';\n  textArea.style.outline = 'none';\n  textArea.style.boxShadow = 'none';\n  textArea.style.background = 'transparent';\n  textArea.value = text;\n\n  document.body.appendChild(textArea);\n  textArea.focus();\n  textArea.select();\n\n  let ret = false;\n  try {\n    ret = document.execCommand('copy');\n  } catch (err) {\n    // do nothing\n  }\n\n  document.body.removeChild(textArea);\n  return ret;\n}\n\nexport function provideUserString(title, str) {\n  let copy_success = copyTextToClipboard(str);\n  modalTextEntry({\n    edit_w: 400,\n    edit_text: str.replace(/[\\n\\r]/g, ' '),\n    title,\n    text: copy_success ?\n      default_copy_success_msg :\n      default_copy_failure_msg,\n    buttons: { ok: null },\n  });\n}\n\nconst draw_rect_param = {};\nexport function drawRect(x0, y0, x1, y1, z, color) {\n  let mx = min(x0, x1);\n  let my = min(y0, y1);\n  let Mx = max(x0, x1);\n  let My = max(y0, y1);\n  draw_rect_param.x = mx;\n  draw_rect_param.y = my;\n  draw_rect_param.z = z;\n  draw_rect_param.w = Mx - mx;\n  draw_rect_param.h = My - my;\n  draw_rect_param.color = color;\n  return sprites.white.draw(draw_rect_param);\n}\n\nexport function drawRect2(param) {\n  return sprites.white.draw(param);\n}\n\nconst draw_rect_4color_param = {};\nexport function drawRect4Color(x0, y0, x1, y1, z, color_ul, color_ur, color_ll, color_lr) {\n  let mx = min(x0, x1);\n  let my = min(y0, y1);\n  let Mx = max(x0, x1);\n  let My = max(y0, y1);\n  draw_rect_4color_param.x = mx;\n  draw_rect_4color_param.y = my;\n  draw_rect_4color_param.z = z;\n  draw_rect_4color_param.w = Mx - mx;\n  draw_rect_4color_param.h = My - my;\n  draw_rect_4color_param.color_ul = color_ul;\n  draw_rect_4color_param.color_ll = color_ll;\n  draw_rect_4color_param.color_lr = color_lr;\n  draw_rect_4color_param.color_ur = color_ur;\n  return sprites.white.draw4Color(draw_rect_4color_param);\n}\n\nfunction spreadTechParams(spread) {\n  // spread=0 -> 1\n  // spread=0.5 -> 2\n  // spread=0.75 -> 4\n  // spread=1 -> large enough to AA\n  spread = min(max(spread, 0), 0.99);\n\n  let tech_params = {\n    param0: vec4(0,0,0,0),\n  };\n\n  tech_params.param0[0] = 1 / (1 - spread);\n  tech_params.param0[1] = -0.5 * tech_params.param0[0] + 0.5;\n  return tech_params;\n}\n\nlet temp_color = vec4();\nfunction premulAlphaColor(color) {\n  temp_color[0] = color[0] * color[3];\n  temp_color[1] = color[1] * color[3];\n  temp_color[2] = color[2] * color[3];\n  temp_color[3] = color[3];\n  return temp_color;\n}\nfunction drawElipseInternal(sprite, x0, y0, x1, y1, z, spread, tu0, tv0, tu1, tv1, color, blend) {\n  if (!blend && !glov_engine.defines.NOPREMUL) {\n    blend = BLEND_PREMULALPHA;\n    color = premulAlphaColor(color);\n  }\n  glov_sprites.queueraw(sprite.texs,\n    x0, y0, z, x1 - x0, y1 - y0,\n    tu0, tv0, tu1, tv1,\n    color, glov_font.font_shaders.font_aa, spreadTechParams(spread), blend);\n}\n\nfunction drawCircleInternal(sprite, x, y, z, r, spread, tu0, tv0, tu1, tv1, color, blend) {\n  let x0 = x - r * 2 + r * 4 * tu0;\n  let x1 = x - r * 2 + r * 4 * tu1;\n  let y0 = y - r * 2 + r * 4 * tv0;\n  let y1 = y - r * 2 + r * 4 * tv1;\n  drawElipseInternal(sprite, x0, y0, x1, y1, z, spread, tu0, tv0, tu1, tv1, color, blend);\n}\n\nfunction initCircleSprite() {\n  const CIRCLE_SIZE = 32;\n  let data = new Uint8Array(CIRCLE_SIZE*CIRCLE_SIZE);\n  let midp = (CIRCLE_SIZE - 1) / 2;\n  for (let i = 0; i < CIRCLE_SIZE; i++) {\n    for (let j = 0; j < CIRCLE_SIZE; j++) {\n      let d = sqrt((i - midp)*(i - midp) + (j - midp)*(j - midp)) / midp;\n      let v = clamp(1 - d, 0, 1);\n      data[i + j*CIRCLE_SIZE] = v * 255;\n    }\n  }\n  sprites.circle = spriteCreate({\n    url: 'circle',\n    width: CIRCLE_SIZE, height: CIRCLE_SIZE,\n    format: textures.format.R8,\n    data,\n    filter_min: gl.LINEAR,\n    filter_mag: gl.LINEAR,\n    wrap_s: gl.CLAMP_TO_EDGE,\n    wrap_t: gl.CLAMP_TO_EDGE,\n    origin: vec2(0.5, 0.5),\n  });\n}\n\nexport function drawElipse(x0, y0, x1, y1, z, spread, color, blend) {\n  if (!sprites.circle) {\n    initCircleSprite();\n  }\n  drawElipseInternal(sprites.circle, x0, y0, x1, y1, z, spread, 0, 0, 1, 1, color, blend);\n}\n\nexport function drawCircle(x, y, z, r, spread, color, blend) {\n  if (!sprites.circle) {\n    initCircleSprite();\n  }\n  drawCircleInternal(sprites.circle, x, y, z, r, spread, 0, 0, 1, 1, color, blend);\n}\n\nexport function drawHollowCircle(x, y, z, r, spread, color, blend) {\n  if (!sprites.hollow_circle) {\n    const CIRCLE_SIZE = 128;\n    const LINE_W = 2;\n    let data = new Uint8Array(CIRCLE_SIZE*CIRCLE_SIZE);\n    let midp = (CIRCLE_SIZE - 1) / 2;\n    for (let i = 0; i < CIRCLE_SIZE; i++) {\n      for (let j = 0; j < CIRCLE_SIZE; j++) {\n        let d = sqrt((i - midp)*(i - midp) + (j - midp)*(j - midp)) / midp;\n        let v = clamp(1 - d, 0, 1);\n        if (v > 0.5) {\n          v = 1 - v;\n        }\n        v += (LINE_W / CIRCLE_SIZE);\n        data[i + j*CIRCLE_SIZE] = v * 255;\n      }\n    }\n    sprites.hollow_circle = spriteCreate({\n      url: 'hollow_circle',\n      width: CIRCLE_SIZE, height: CIRCLE_SIZE,\n      format: textures.format.R8,\n      data,\n      filter_min: gl.LINEAR,\n      filter_mag: gl.LINEAR,\n      wrap_s: gl.CLAMP_TO_EDGE,\n      wrap_t: gl.CLAMP_TO_EDGE,\n      origin: vec2(0.5, 0.5),\n    });\n  }\n  drawCircleInternal(sprites.hollow_circle, x, y, z, r, spread, 0, 0, 1, 1, color, blend);\n}\n\n\nconst LINE_TEX_W=16;\nconst LINE_TEX_H=16; // Only using 15, so we can have a value of 255 in the middle\nconst LINE_MIDP = floor((LINE_TEX_H - 1) / 2);\nconst LINE_V0 = 0.5/LINE_TEX_H;\nconst LINE_V1 = 1-1.5/LINE_TEX_H;\nconst LINE_U0 = 0.5/LINE_TEX_W;\nconst LINE_U1 = (LINE_MIDP + 0.5) / LINE_TEX_W;\nconst LINE_U2 = 1 - LINE_U1; // 1 texel away from LINE_U1\nconst LINE_U3 = 1 - 0.5/LINE_TEX_W;\nexport function drawLine(x0, y0, x1, y1, z, w, precise, color, mode) {\n  if (mode === undefined) {\n    mode = default_line_mode;\n  }\n  let blend;\n  if (!glov_engine.defines.NOPREMUL) {\n    blend = BLEND_PREMULALPHA;\n    color = premulAlphaColor(color);\n  }\n\n  let tex_key = mode & LINE_CAP_ROUND ? 'line3' : 'line2';\n  if (!sprites[tex_key]) {\n    let data = new Uint8Array(LINE_TEX_W * LINE_TEX_H);\n    let i1 = LINE_MIDP;\n    let i2 = LINE_TEX_W - 1 - LINE_MIDP;\n    if (tex_key === 'line2') {\n      // rectangular caps\n      for (let j = 0; j < LINE_TEX_H; j++) {\n        let d = abs((j - LINE_MIDP) / LINE_MIDP);\n        let j_value = round(clamp(1 - d, 0, 1) * 255);\n        for (let i = 0; i < LINE_TEX_W; i++) {\n          d = i < i1 ? i/LINE_MIDP : i >= i2 ? 1 - (i-i2) / LINE_MIDP : 1;\n          let i_value = round(clamp(d, 0, 1) * 255);\n          data[i + j*LINE_TEX_W] = min(i_value, j_value);\n        }\n      }\n    } else {\n      // round caps\n      for (let j = 0; j < LINE_TEX_H; j++) {\n        let d = abs((j - LINE_MIDP) / LINE_MIDP);\n        for (let i = 0; i < LINE_TEX_W; i++) {\n          let id = i < i1 ? 1-i/LINE_MIDP : i >= i2 ? (i-i2) / LINE_MIDP : 0;\n          let dv = sqrt(id*id + d*d);\n          dv = clamp(1-dv, 0, 1);\n          data[i + j*LINE_TEX_W] = round(dv * 255);\n        }\n      }\n    }\n    sprites[tex_key] = spriteCreate({\n      url: tex_key,\n      width: LINE_TEX_W, height: LINE_TEX_H,\n      format: textures.format.R8,\n      data,\n      filter_min: gl.LINEAR,\n      filter_mag: gl.LINEAR,\n      wrap_s: gl.CLAMP_TO_EDGE,\n      wrap_t: gl.CLAMP_TO_EDGE,\n    });\n  }\n  let texs = sprites[tex_key].texs;\n\n  const camera_xscale = camera2d.data[4];\n  const camera_yscale = camera2d.data[5];\n  let virtual_to_pixels = (camera_xscale + camera_yscale) * 0.5;\n  let pixels_to_virutal = 1/virtual_to_pixels;\n  let w_in_pixels = w * virtual_to_pixels;\n  let draw_w_pixels = w_in_pixels + 2*2;\n  let half_draw_w_pixels = draw_w_pixels * 0.5;\n  let draw_w = half_draw_w_pixels * pixels_to_virutal;\n  // let tex_delta_for_pixel = 1 / draw_w_pixels; // should be 51/255 for width=1 (draw_w_pixels = 5)\n\n  let dx = x1 - x0;\n  let dy = y1 - y0;\n  let length = sqrt(dx*dx + dy*dy);\n  dx /= length;\n  dy /= length;\n  let tangx = -dy * draw_w;\n  let tangy = dx * draw_w;\n\n  if (mode & LINE_ALIGN) {\n    // align drawing so that the edge of the line is aligned with a pixel edge\n    //   (avoids a 0.1,1.0,0.1 line drawing in favor of 1.0,0.2, which will be crisper, if slightly visually offset)\n    let y0_real = (y0 - camera2d.data[1]) * camera2d.data[5];\n    let y0_real_aligned = round(y0_real - half_draw_w_pixels) + half_draw_w_pixels;\n    let yoffs = (y0_real_aligned - y0_real) / camera2d.data[5];\n    y0 += yoffs;\n    y1 += yoffs;\n\n    let x0_real = (x0 - camera2d.data[0]) * camera2d.data[4];\n    let x0_real_aligned = round(x0_real - half_draw_w_pixels) + half_draw_w_pixels;\n    let xoffs = (x0_real_aligned - x0_real) / camera2d.data[4];\n    x0 += xoffs;\n    x1 += xoffs;\n  }\n\n  let tex_delta_for_pixel = 2/draw_w_pixels;\n  let step_start = 1 - (w_in_pixels + 1) / draw_w_pixels;\n  let step_end = step_start + tex_delta_for_pixel;\n  step_end = 1 + precise * (step_end - 1);\n  let A = 1.0 / (step_end - step_start);\n  let B = -step_start * A;\n  let shader_param = { param0: [A, B] };\n\n  glov_sprites.queueraw4(texs,\n    x1 + tangx, y1 + tangy,\n    x1 - tangx, y1 - tangy,\n    x0 - tangx, y0 - tangy,\n    x0 + tangx, y0 + tangy,\n    z,\n    LINE_U1, LINE_V0, LINE_U2, LINE_V1,\n    color, glov_font.font_shaders.font_aa, shader_param, blend);\n\n  if (mode & (LINE_CAP_ROUND|LINE_CAP_SQUARE)) {\n    // round caps (line3) - square caps (line2)\n    let nx = dx * w/2;\n    let ny = dy * w/2;\n    glov_sprites.queueraw4(texs,\n      x1 - tangx, y1 - tangy,\n      x1 + tangx, y1 + tangy,\n      x1 + tangx + nx, y1 + tangy + ny,\n      x1 - tangx + nx, y1 - tangy + ny,\n      z,\n      LINE_U2, LINE_V1, LINE_U3, LINE_V0,\n      color, glov_font.font_shaders.font_aa, shader_param, blend);\n    glov_sprites.queueraw4(texs,\n      x0 - tangx, y0 - tangy,\n      x0 + tangx, y0 + tangy,\n      x0 + tangx - nx, y0 + tangy - ny,\n      x0 - tangx - nx, y0 - tangy - ny,\n      z,\n      LINE_U1, LINE_V1, LINE_U0, LINE_V0,\n      color, glov_font.font_shaders.font_aa, shader_param, blend);\n  }\n}\n\nexport function drawHollowRect(x0, y0, x1, y1, z, w, precise, color, mode) {\n  drawLine(x0, y0, x1, y0, z, w, precise, color, mode);\n  drawLine(x1, y0, x1, y1, z, w, precise, color, mode);\n  drawLine(x1, y1, x0, y1, z, w, precise, color, mode);\n  drawLine(x0, y1, x0, y0, z, w, precise, color, mode);\n}\n\nexport function drawHollowRect2(param) {\n  drawHollowRect(param.x, param.y, param.x + param.w, param.y + param.h,\n    param.z || Z.UI, param.line_width || 1, param.precise || 1, param.color || unit_vec);\n}\n\nexport function drawCone(x0, y0, x1, y1, z, w0, w1, spread, color) {\n  let blend;\n  if (!glov_engine.defines.NOPREMUL) {\n    blend = BLEND_PREMULALPHA;\n    color = premulAlphaColor(color);\n  }\n  if (!sprites.cone) {\n    const CONE_SIZE = 32;\n    let data = new Uint8Array(CONE_SIZE*CONE_SIZE);\n    let midp = (CONE_SIZE - 1) / 2;\n    for (let i = 0; i < CONE_SIZE; i++) {\n      for (let j = 0; j < CONE_SIZE; j++) {\n        let dx = 0;\n        let dy = 0;\n        let d = 0;\n        if (i > midp) {\n          dx = (i - midp) / midp;\n          dy = abs(j - midp) / midp;\n          let dCircle = sqrt(dx*dx + dy*dy);\n          d = dx * dCircle;\n        }\n        let v = clamp(1 - d, 0, 1);\n        data[i + j*CONE_SIZE] = v * 255;\n      }\n    }\n    sprites.cone = spriteCreate({\n      url: 'cone',\n      width: CONE_SIZE, height: CONE_SIZE,\n      format: textures.format.R8,\n      data,\n      filter_min: gl.LINEAR,\n      filter_mag: gl.LINEAR,\n      wrap_s: gl.CLAMP_TO_EDGE,\n      wrap_t: gl.CLAMP_TO_EDGE,\n      origin: vec2(0.5, 0.5),\n    });\n  }\n  let dx = x1 - x0;\n  let dy = y1 - y0;\n  let length = sqrt(dx*dx + dy*dy);\n  dx /= length;\n  dy /= length;\n  let tangx = -dy;\n  let tangy = dx;\n  glov_sprites.queueraw4(sprites.cone.texs,\n    x0 - tangx*w0, y0 - tangy*w0,\n    x0 + tangx*w0, y0 + tangy*w0,\n    x1 + tangx*w1, y1 + tangy*w1,\n    x1 - tangx*w1, y1 - tangy*w1,\n    z,\n    0, 0, 1, 1,\n    color, glov_font.font_shaders.font_aa, spreadTechParams(spread), blend);\n}\n\nexport function setFontHeight(_font_height) {\n  font_height = _font_height;\n  fontSetDefaultSize(font_height);\n}\n\nexport function scaleSizes(scale) {\n  button_height = round(32 * scale);\n  setFontHeight(round(24 * scale));\n  button_width = round(200 * scale);\n  button_img_size = button_height;\n  modal_button_width = round(button_width / 2);\n  modal_width = round(600 * scale);\n  modal_y0 = round(200 * scale);\n  modal_title_scale = 1.2;\n  modal_pad = round(16 * scale);\n  tooltip_width = round(400 * scale);\n  tooltip_pad = round(8 * scale);\n  panel_pixel_scale = button_height / sprites.panel.uidata.total_h; // button_height / panel pixel resolution\n  tooltip_panel_pixel_scale = panel_pixel_scale;\n  scrollAreaSetPixelScale(button_height / sprites.button.uidata.total_h);\n}\n\nexport function setPanelPixelScale(scale) {\n  tooltip_panel_pixel_scale = panel_pixel_scale = scale;\n}\n\nexport function setModalSizes(_modal_button_width, width, y0, title_scale, pad) {\n  modal_button_width = _modal_button_width || round(button_width / 2);\n  modal_width = width || 600;\n  modal_y0 = y0 || 200;\n  modal_title_scale = title_scale || 1.2;\n  modal_pad = pad || modal_pad;\n}\n\nexport function setTooltipWidth(_tooltip_width, _tooltip_panel_pixel_scale) {\n  tooltip_width = _tooltip_width;\n  tooltip_panel_pixel_scale = _tooltip_panel_pixel_scale;\n  tooltip_pad = modal_pad / 2 * _tooltip_panel_pixel_scale;\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/*\n  API usage:\n  engine.defines = urlhash.register({\n    key: 'D',\n    type: SET,\n  });\n  urlhash.register({\n    key: 'pos',\n    // type: TYPE_STRING,\n    change: (newvalue) => {},\n    title: (value) => 'string',\n    def: '1,2',\n    hides: { otherfield: true },\n    push: true, // do a pushState instead of replaceState when this changes\n    hide_values: { foo: true }, // do not add to URL if values is in the provided set\n    route_only: true, // never show this value, but still use it to influence routes - use with routeFixed()\n  });\n  urlhash.set('pos', '3,4');\n  urlhash.get('pos')\n\n  urlhash.route('w/:w')     // use URLs like foo.com/w/1   instead of foo.com/?w=1\n  urlhash.route('w/:w/:wg')  // use URLs like foo.com/w/1/2 instead of foo.com/?w=1&wg=2\n\n  // Called whenever the URL state is pushed, even if to exactly the same URL (e.g. on link click)\n  urlhash.onChange(cb)\n*/\n\nconst assert = require('assert');\nconst { callEach } = require('glov/common/util.js');\n\nconst HISTORY_UPDATE_TIME = 1000;\n\nexport let TYPE_SET = 'set';\nexport let TYPE_STRING = 'string';\n\nlet params = {};\n\nlet title_transformer;\n\nlet page_base = (document.location.href || '').match(/^[^#?]+/)[0]; // remove search and anchor\nif (!page_base.endsWith('/')) { // e.g. http://foo.bar/index.html\n  page_base += '?';\n}\n// Removes index.html et all\nlet url_base = page_base.replace(/[^/]*$/,'');\nlet on_change = [];\n\nexport function getURLBase() {\n  return url_base;\n}\n\nexport function getURLPageBase() {\n  return page_base;\n}\n\nexport function onChange(cb) {\n  on_change.push(cb);\n}\n\nfunction cmpNumKeys(a, b) {\n  let d = b.keys.length - a.keys.length;\n  if (d) {\n    return d;\n  }\n  // otherwise alphabetical for stability\n  for (let ii = 0; ii < a.keys.length; ++ii) {\n    if (a.keys[ii] < b.keys[ii]) {\n      return -1;\n    } else if (a.keys[ii] > b.keys[ii]) {\n      return 1;\n    }\n  }\n  assert(false); // two routes with identical keys\n  return 0;\n}\n\nconst route_param_regex = /:(\\w+)/g;\nlet routes = [];\n\nfunction queryString() {\n  let href = String(document.location);\n  return href.slice(page_base.length);\n}\n\nconst regex_value = /[^\\w]\\w+=([^&]+)/;\nfunction getValue(query_string, opts) {\n  if (opts.routes) {\n    for (let ii = 0; ii < opts.routes.length; ++ii) {\n      let r = opts.routes[ii];\n      let m = query_string.match(r.regex);\n      if (m) {\n        if (r.value) {\n          return r.value;\n        }\n        let idx = r.keys.indexOf(opts.key);\n        return m[1 + idx];\n      }\n    }\n  }\n  let m = query_string.match(opts.regex) || [];\n  if (opts.type === TYPE_SET) {\n    let r = {};\n    for (let ii = 0; ii < m.length; ++ii) {\n      let m2 = m[ii].match(regex_value);\n      assert(m2);\n      r[m2[1]] = 1;\n    }\n    return r;\n  } else {\n    return m[1] || opts.def;\n  }\n}\n\nlet last_history_str = null; // always re-set it on the first update\n\nfunction goInternal(query_string) { // with the '?'\n  // Update all values, except those hidden by what is currently in the query string\n  let hidden = {};\n  for (let key in params) {\n    let opts = params[key];\n    if (opts.hides) {\n      if (getValue(query_string, opts)) {\n        for (let otherkey in opts.hides) {\n          hidden[otherkey] = 1;\n        }\n      }\n    }\n  }\n\n  let dirty = {};\n  for (let key in params) {\n    if (hidden[key]) {\n      continue;\n    }\n    let opts = params[key];\n    let new_value = getValue(query_string, opts);\n    if (opts.type === TYPE_SET) {\n      for (let v in new_value) {\n        if (!opts.value[v]) {\n          opts.value[v] = 1;\n          dirty[key] = true;\n        }\n      }\n      for (let v in opts.value) {\n        if (!new_value[v]) {\n          delete opts.value[v];\n          dirty[key] = true;\n        }\n      }\n    } else {\n      if (new_value !== opts.value) {\n        dirty[key] = true;\n        opts.value = new_value;\n      }\n    }\n  }\n\n  // Call all change callbacks\n  for (let key in dirty) {\n    let opts = params[key];\n    if (opts.change) {\n      opts.change(opts.value);\n    }\n  }\n  callEach(on_change);\n}\n\nlet eff_title;\nfunction toString() {\n  eff_title = '';\n  let values = [];\n  let hidden = {};\n  for (let key in params) {\n    let opts = params[key];\n    if (opts.hides && opts.value) {\n      for (let otherkey in opts.hides) {\n        hidden[otherkey] = 1;\n      }\n    }\n  }\n  let root_value = '';\n  outer: // eslint-disable-line no-labels\n  for (let ii = 0; ii < routes.length; ++ii) {\n    let r = routes[ii];\n    let route_title = '';\n    for (let jj = 0; jj < r.keys.length; ++jj) {\n      let key = r.keys[jj];\n      if (hidden[key]) {\n        continue outer; // eslint-disable-line no-labels\n      }\n      let opts = params[key];\n      if (opts.hide_values[opts.value]) {\n        continue outer; // eslint-disable-line no-labels\n      }\n      // has a value, is not hidden, continue\n      if (!route_title && opts.title) {\n        route_title = opts.title(opts.value);\n      }\n    }\n    for (let jj = 0; jj < r.keys.length; ++jj) {\n      let key = r.keys[jj];\n      if (params[key].route_only) {\n        hidden[key] = true;\n      }\n    }\n    // route is good!\n    root_value = r.route_string.replace(route_param_regex, function (ignored, key) {\n      hidden[key] = true;\n      return String(params[key].value);\n    });\n    if (!eff_title && route_title) {\n      eff_title = route_title;\n    }\n    break;\n  }\n  for (let key in params) {\n    if (hidden[key]) {\n      continue;\n    }\n    let opts = params[key];\n    if (opts.type === TYPE_SET) {\n      for (let v in opts.value) {\n        values.push(`${key}=${v}`);\n      }\n    } else {\n      if (!opts.hide_values[opts.value]) {\n        values.push(`${key}=${opts.value}`);\n        if (!eff_title && opts.title) {\n          eff_title = opts.title(opts.value);\n        }\n      }\n    }\n  }\n  if (title_transformer) {\n    eff_title = title_transformer(eff_title);\n  }\n  eff_title = String(eff_title);\n  return `${root_value}${values.length ? '?' : ''}${values.join('&')}`;\n}\n\nexport function refreshTitle() {\n  toString();\n  if (eff_title && eff_title !== document.title) {\n    document.title = eff_title;\n  }\n}\n\nfunction periodicRefreshTitle() {\n  profilerStart('periodicRefreshTitle');\n  refreshTitle();\n  setTimeout(periodicRefreshTitle, 1000);\n  profilerStop();\n}\n\nfunction onPopState() {\n  let query_string = queryString();\n  last_history_str = query_string;\n  goInternal(query_string);\n  refreshTitle();\n}\n\nlet on_url_change;\nexport function onURLChange(cb) {\n  on_url_change = cb;\n}\n\nlet last_history_set_time = 0;\nlet scheduled = false;\nlet need_push_state = false;\nfunction updateHistoryCommit() {\n  profilerStart('updateHistoryCommit');\n  scheduled = false;\n  last_history_set_time = Date.now();\n  let url = `${page_base}${last_history_str}`;\n  if (url.endsWith('?')) {\n    url = url.slice(0, -1);\n  }\n  try {\n    if (need_push_state) {\n      need_push_state = false;\n      window.history.pushState(undefined, eff_title, url);\n    } else {\n      window.history.replaceState(undefined, eff_title, url);\n    }\n  } catch (e) {\n    // ignore; some browsers disallow this, I guess\n  }\n  if (eff_title) {\n    document.title = eff_title;\n  }\n  if (on_url_change) {\n    on_url_change();\n  }\n  //window.history.replaceState(undefined, eff_title, `#${last_history_str}`);\n  profilerStop();\n}\nfunction updateHistory(new_need_push_state) {\n  let new_str = toString();\n  if (last_history_str === new_str) {\n    return;\n  }\n  need_push_state = need_push_state || new_need_push_state;\n  last_history_str = new_str;\n  if (scheduled) {\n    // already queued up\n    return;\n  }\n  let delay = HISTORY_UPDATE_TIME;\n  if (Date.now() - last_history_set_time > HISTORY_UPDATE_TIME) {\n    // Been awhile, apply \"instantly\" (but still wait until next tick to ensure\n    //   any other immediate changes are registered)\n    delay = 1;\n  }\n  scheduled = true;\n  setTimeout(updateHistoryCommit, delay);\n}\n\n// Optional startup\nexport function startup(param) {\n  assert(!title_transformer);\n  title_transformer = param.title_transformer;\n  if (!title_transformer && (param.title_suffix || param.title_default)) {\n    const { title_suffix, title_default } = param;\n    title_transformer = function (title) {\n      if (title_suffix && title) {\n        return `${title} | ${title_suffix}`;\n      }\n      return title || title_default || title_suffix;\n    };\n  }\n\n  // Refresh the current URL, it might be in the non-route format\n  updateHistory(false);\n\n  if (title_transformer) {\n    refreshTitle();\n    setTimeout(periodicRefreshTitle, 1000);\n  }\n}\n\nfunction routeEx(new_route) {\n  let { keys } = new_route;\n  for (let ii = 0; ii < keys.length; ++ii) {\n    let opts = params[keys[ii]];\n    // Must have already registered these keys\n    assert(opts);\n    opts.routes = opts.routes || [];\n    opts.routes.push(new_route);\n    // Update initial value\n    opts.value = getValue(queryString(), opts);\n  }\n  routes.push(new_route);\n  routes.sort(cmpNumKeys);\n}\n\nexport function route(route_string) {\n  let keys = [];\n  // foo/:key/:bar => foo/([^/&?]+)/([^/&?]+)\n  let base = route_string.replace(route_param_regex, function (ignored, match) {\n    keys.push(match);\n    return '([^/&?]+)';\n  });\n  let regex = new RegExp(`^${base}(?:$|\\\\?)`);\n  routeEx({\n    route_string,\n    regex,\n    keys,\n  });\n}\n\n// For a route that has no parameters, e.g. `foo.html`\n// Needs an associated key already registered, then set(key, '1') and set(key, '') enter and leave this route\nexport function routeFixed(route_string, key) {\n  let regex = new RegExp(`^${route_string}(?:$|\\\\?)`);\n  routeEx({\n    route_string,\n    regex,\n    value: '1', // Just need something\n    keys: [key],\n  });\n}\n\nexport function register(opts) {\n  assert(opts.key);\n  assert(!params[opts.key]);\n  opts.type = opts.type || TYPE_STRING;\n  let regex_search = `(?:[^\\\\w])${opts.key}=([^&]+)`;\n  let regex_type = '';\n  if (opts.type === TYPE_SET) {\n    regex_type = 'g';\n  } else {\n    opts.def = opts.def || '';\n    opts.hide_values = opts.hide_values || {};\n    opts.hide_values[opts.def] = true;\n  }\n  opts.regex = new RegExp(regex_search, regex_type);\n  params[opts.key] = opts;\n  // Get initial value\n  opts.value = getValue(queryString(), opts);\n  let ret = opts.value;\n  if (opts.type === TYPE_SET && typeof Proxy === 'function') {\n    // Auto-apply changes to URL if someone modifies the proxy\n    ret = new Proxy(opts.value, {\n      set: function (target, prop, value) {\n        if (value) {\n          target[prop] = 1;\n        } else {\n          delete target[prop];\n        }\n        updateHistory();\n        return true;\n      }\n    });\n  }\n\n  if (!window.onpopstate) {\n    window.onpopstate = onPopState;\n  }\n\n  return ret;\n}\n\nexport function set(key, value, value2) {\n  let opts = params[key];\n  assert(opts);\n  if (opts.type === TYPE_SET) {\n    if (Boolean(opts.value[value]) !== Boolean(value2)) {\n      opts.value[value] = value2 ? 1 : 0;\n      updateHistory(opts.push);\n    }\n  } else {\n    if (opts.value !== value) {\n      opts.value = value;\n      updateHistory(opts.push);\n    }\n  }\n}\n\nexport function setMulti(values) {\n  let any = false;\n  let push = false;\n  for (let key in values) {\n    let value = values[key];\n    let opts = params[key];\n    assert(opts);\n    assert(opts.type !== TYPE_SET);\n    if (opts.value !== value) {\n      opts.value = value;\n      any = true;\n      push = push || opts.push;\n    }\n  }\n  if (any) {\n    updateHistory(push);\n  }\n}\n\nexport function get(key) {\n  let opts = params[key];\n  assert(opts);\n  return opts.value;\n}\n\nexport function go(query_string) { // with the '?'\n  goInternal(query_string);\n  updateHistory(true);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nconst { floor, min } = Math;\n\nlet offs = 0;\nfunction now() {\n  return Date.now() + offs;\n}\nmodule.exports = exports = now;\nexports.now = now;\nlet first = true;\nexports.sync = function (server_time) {\n  if (first) {\n    offs = server_time - Date.now();\n  } else {\n    offs = min(offs, server_time - Date.now());\n  }\n};\nfunction toSS2020(milliseconds) {\n  // Seconds since Jan 1st, 2020\n  return floor(milliseconds / 1000) - 1577836800;\n}\nexports.toSS2020 = toSS2020;\nexports.seconds = function () {\n  // Seconds since Jan 1st, 2020\n  return toSS2020(now());\n};\n","/* eslint-disable import/order */\nconst assert = require('assert');\nconst { filewatchOn, filewatchTriggerChange } = require('./filewatch.js');\nconst urlhash = require('./urlhash.js');\nconst { clone, deepEqual } = require('glov/common/util.js');\n\nlet fs = window.glov_webfs || {};\nlet decoded = {};\nlet used = {};\nlet active_reload = false; // after an active reload, do data cloning to better detect which files changed\n// export function webFSReady() {\n//   // TODO: async ready state?\n// }\n\nfunction decode(data) {\n  let len = data[0];\n  let str = data[1];\n  let u8 = new Uint8Array(len);\n  let idxo = 0;\n  let idxi = 0;\n  while (idxo < len) {\n    let byte = str.charCodeAt(idxi++);\n    if (byte === 126) {\n      byte = 0;\n    } else if (byte === 27) {\n      byte = str.charCodeAt(idxi++);\n    }\n    u8[idxo++] = byte;\n  }\n  assert.equal(idxi, str.length);\n  assert.equal(idxo, len);\n  return u8;\n}\n\nexport function webFSGetFileNames(directory) {\n  let ret = [];\n  for (let filename in fs) {\n    if (filename.startsWith(directory)) {\n      ret.push(filename);\n    }\n  }\n  return ret;\n}\n\nexport function webFSGetFile(filename, encoding) {\n  let ret = decoded[filename];\n  if (ret) {\n    return ret;\n  }\n  used[filename] = true;\n  assert(window.glov_webfs, 'Failed to load fsdata.js');\n  let data = fs[filename];\n  assert(data, `Error loading file: ${filename}`);\n  if (encoding === 'jsobj') {\n    assert(!Array.isArray(data));\n    ret = active_reload ? clone(data) : data;\n  } else {\n    assert(Array.isArray(data));\n    if (encoding === 'text') {\n      ret = data[1];\n    } else {\n      ret = decode(data);\n    }\n  }\n  decoded[filename] = ret;\n  return ret;\n}\n\nexport function webFSExists(filename) {\n  return Boolean(fs[filename]);\n}\n\nexport function webFSReportUnused(ignore_regex) {\n  // Don't report on files we know are loaded dynamically, and are small\n  ignore_regex = ignore_regex || /\\.(fp|vp)$/;\n  let tot_size = 0;\n  for (let filename in fs) {\n    if (!used[filename] && !filename.match(ignore_regex)) {\n      console.warn(`WebFS file bundled but unreferenced: ${filename}`);\n      tot_size += fs[filename][0];\n    }\n  }\n  if (tot_size) {\n    console.warn(`WebFS wasting ${tot_size} bytes`);\n  }\n}\n\nfunction webFSReload() {\n  active_reload = true;\n  window.glov_webfs = null;\n  let scriptTag = document.createElement('script');\n  scriptTag.src = `${urlhash.getURLBase()}fsdata.js?rl=${Date.now()}`;\n  scriptTag.onload = function () {\n    if (window.glov_webfs) {\n      let old_fs = fs;\n      fs = window.glov_webfs;\n      decoded = {};\n      used = {};\n      for (let key in fs) {\n        let old_value = old_fs[key];\n        let new_value = fs[key];\n        if (Array.isArray(old_value)) {\n          for (let ii = 0; ii < new_value.length; ++ii) {\n            if (!old_value || new_value[ii] !== old_value[ii]) {\n              filewatchTriggerChange(key);\n              break;\n            }\n          }\n        } else {\n          // Raw object\n          if (!deepEqual(old_value, new_value)) {\n            filewatchTriggerChange(key);\n          }\n        }\n      }\n    }\n  };\n  document.getElementsByTagName('head')[0].appendChild(scriptTag);\n}\n\nfilewatchOn('fsdata.js', webFSReload);\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* global WebSocket */\n\n/* eslint-disable import/order */\nimport { getAPIPath, setCurrentEnvironment } from 'glov/client/environments';\n\nconst ack = require('glov/common/ack.js');\nconst { ackInitReceiver } = ack;\nconst assert = require('assert');\nconst { errorReportSetDetails, session_uid } = require('./error_report.js');\nconst { fetch, ERR_CONNECTION } = require('./fetch.js');\nconst { min, random } = Math;\nconst { perfCounterAdd } = require('glov/common/perfcounters.js');\nconst urlhash = require('./urlhash.js');\nconst wscommon = require('glov/common/wscommon.js');\nconst { wsHandleMessage } = wscommon;\nconst { PLATFORM, getAbilityReload } = require('glov/client/client_config.js');\n\n// let net_time = 0;\n// export function getNetTime() {\n//   let r = net_time;\n//   net_time = 0;\n//   return r;\n// }\n\n// Values exposed for `client.connect_error`\nexport const ERR_CONNECTING = 'ERR_CONNECTING';\nexport const ERR_RESTARTING = 'ERR_RESTARTING';\nexport const ERR_CLIENT_VERSION_NEW = 'ERR_CLIENT_VERSION_NEW';\nexport const ERR_CLIENT_VERSION_OLD = 'ERR_CLIENT_VERSION_OLD';\n\nexports.CURRENT_VERSION = 0;\n\nexport function WSClient(path) {\n  this.id = null;\n  this.my_ids = {}; // set of all IDs I've been during this session\n  this.handlers = {};\n  this.socket = null;\n  this.net_delayer = null;\n  this.connected = false;\n  this.disconnected = false;\n  this.retry_scheduled = false;\n  this.retry_count = 0;\n  this.disconnect_time = Date.now();\n  this.last_receive_time = Date.now();\n  this.idle_counter = 0;\n  this.last_send_time = Date.now();\n  this.connect_error = ERR_CONNECTING;\n  ackInitReceiver(this);\n\n  if (path) {\n    this.path = path;\n  }\n\n  this.connect(false);\n\n  this.onMsg('cack', this.onConnectAck.bind(this));\n  this.onMsg('build', this.onBuildTimestamp.bind(this));\n  this.onMsg('error', this.onError.bind(this));\n}\n\nWSClient.prototype.logPacketDispatch = function (source, pak, buf_offs, msg) {\n  perfCounterAdd(`ws.${msg}`);\n};\n\nWSClient.prototype.timeSinceDisconnect = function () {\n  return Date.now() - this.disconnect_time;\n};\n\nfunction getVersionUrlParams() {\n  return `plat=${PLATFORM}&ver=${exports.CURRENT_VERSION}&build=${BUILD_TIMESTAMP}`;\n}\n\nfunction jsonParseResponse(response) {\n  if (!response) {\n    return null;\n  }\n  if (response.trim()[0] === '<') {\n    // html response\n    return null;\n  }\n  try {\n    return JSON.parse(response);\n  } catch (e) {\n    return null;\n  }\n}\n\nfunction whenServerReady(cb) {\n  let retry_count = 0;\n  function doit() {\n    fetch({\n      url: `${getAPIPath()}ready?${getVersionUrlParams()}`,\n    }, (err, response) => {\n      if (err) {\n        let response_data = jsonParseResponse(response);\n        let status = response_data?.status;\n        if (status !== 'ERR_CLIENT_VERSION_OLD') {\n          ++retry_count;\n          setTimeout(doit, min(retry_count * retry_count * 100, 15000) * (0.75 + random() * 0.5));\n          return;\n        }\n      }\n      cb();\n    });\n  }\n  doit();\n}\n\nWSClient.prototype.onBuildTimestamp = function (build_timestamp) {\n  if (build_timestamp !== BUILD_TIMESTAMP) {\n    if (this.on_build_timestamp_mismatch) {\n      this.on_build_timestamp_mismatch();\n    } else {\n      if (getAbilityReload()) {\n        console.error(`App build mismatch (server: ${build_timestamp}, client: ${BUILD_TIMESTAMP}), reloading`);\n        whenServerReady(function () {\n          if (window.reloadSafe) {\n            window.reloadSafe();\n          } else {\n            document.location.reload();\n          }\n        });\n      } else {\n        // Not allowed to reload\n        console.warn(`App build mismatch (server: ${build_timestamp}, client: ${BUILD_TIMESTAMP}), ignoring`);\n      }\n    }\n  }\n};\n\nWSClient.prototype.onConnectAck = function (data, resp_func) {\n  let client = this;\n  client.connected = true;\n  client.connect_error = null;\n  client.disconnected = false;\n  client.id = data.id;\n  client.my_ids[data.id] = true;\n  errorReportSetDetails('client_id', client.id);\n  client.secret = data.secret;\n  if (data.build) {\n    client.onBuildTimestamp(data.build);\n  }\n  // Fire subscription_manager connect handler\n  assert(client.handlers.connect);\n  data.client_id = client.id;\n  client.handlers.connect(client, data);\n  resp_func();\n};\n\n\nWSClient.prototype.pak = function (msg) {\n  return wscommon.wsPak(msg, null, this);\n};\n\nWSClient.prototype.send = function (msg, data, resp_func) {\n  wscommon.sendMessage.call(this, msg, data, resp_func);\n};\n\nWSClient.prototype.onError = function (e) {\n  console.error('WSClient Error');\n  console.error(e);\n  if (!(e instanceof Error)) {\n    e = new Error(e);\n  }\n  throw e;\n};\n\n// cb(client, data, resp_func)\nWSClient.prototype.onMsg = function (msg, cb) {\n  assert.ok(!this.handlers[msg]);\n  this.handlers[msg] = function wrappedCallback(client, data, resp_func) {\n    // Client interface does not need a client passed to it!\n    return cb(data, resp_func);\n  };\n};\n\nWSClient.prototype.checkForNewAppBuild = function () {\n  if (!getAbilityReload()) {\n    // would do nothing with it, don't bother checking\n    return;\n  }\n  if (this.new_build_check_in_progress) {\n    return;\n  }\n  this.new_build_check_in_progress = true;\n  fetch({\n    url: `${urlhash.getURLBase()}app.ver.json`,\n    response_type: 'json'\n  }, (err, obj) => {\n    this.new_build_check_in_progress = false;\n    if (obj && obj.ver) {\n      this.onBuildTimestamp(obj.ver);\n    }\n    if (err && err !== ERR_CONNECTION) {\n      // If this is not triggered on connection errors, only if we got a (non-parseable) response from the server\n      if (!this.delayed_recheck) {\n        this.delayed_recheck = true;\n        setTimeout(() => {\n          this.delayed_recheck = false;\n          this.checkForNewAppBuild();\n        }, 1000);\n      }\n    }\n  });\n};\n\nWSClient.prototype.retryConnection = function () {\n  let client = this;\n  assert(!client.socket);\n  assert(!client.retry_scheduled);\n  client.retry_scheduled = true;\n  ++client.retry_count;\n  this.checkForNewAppBuild();\n  setTimeout(function () {\n    assert(client.retry_scheduled);\n    assert(!client.socket);\n    client.retry_scheduled = false;\n    client.connect(true);\n  }, min(client.retry_count * client.retry_count * 100, 15000) * (0.75 + random() * 0.5));\n};\n\nWSClient.prototype.checkDisconnect = function () {\n  if (this.connected && this.socket.readyState !== 1) { // WebSocket.OPEN\n    // We think we're connected, but we're not, we must have received an\n    // animation frame before the close event when phone was locked or something\n    this.on_close();\n    assert(!this.connected);\n  }\n};\n\nWSClient.prototype.connect = function (for_reconnect) {\n  let client = this;\n  client.socket = { readyState: 0 }; // Placeholder so it appears disconnected\n\n  assert(!this.ready_check_in_progress);\n  this.ready_check_in_progress = true;\n  // retry hitting status endpoint until it says it's okay to make a WebSocket connection\n  fetch({\n    url: `${getAPIPath()}ready?${getVersionUrlParams()}`,\n  }, (err, response) => {\n    let response_data = jsonParseResponse(response);\n    let status = response_data?.status;\n    let redirect_environment = response_data?.redirect_environment;\n    let update_available = response_data?.update_available;\n    let should_reload = update_available && getAbilityReload();\n\n    assert(this.ready_check_in_progress);\n    this.ready_check_in_progress = false;\n    this.connect_error = ERR_CONNECTING;\n\n    if (!err && !redirect_environment && !should_reload) {\n      if (update_available) {\n        // TODO: Inform the user that a new version is available,\n        // even though the current version is still supported\n      }\n      return void this.connectAfterReady(for_reconnect);\n    }\n\n    console.log(`Server not ready, err=${err}, response=${response}`);\n    // Handle known error strings\n    if (status === 'ERR_RESTARTING' || status === 'ERR_STARTUP') {\n      client.connect_error = ERR_RESTARTING;\n    } else if (status === 'ERR_CLIENT_VERSION_NEW') {\n      client.connect_error = ERR_CLIENT_VERSION_NEW;\n    } else if (status === 'ERR_CLIENT_VERSION_OLD') {\n      client.connect_error = ERR_CLIENT_VERSION_OLD;\n    }\n\n    if (redirect_environment) {\n      setCurrentEnvironment(redirect_environment);\n    }\n\n    client.socket = null;\n    client.net_delayer = null;\n    this.retryConnection();\n  });\n};\n\nWSClient.prototype.connectAfterReady = function (for_reconnect) {\n  let client = this;\n\n  let path = client.path ||\n    getAPIPath()      // 'https://foo.com/product/api/'\n    .replace(/^http/, 'ws')\n    .replace(/api\\/$/, 'ws'); // 'wss://foo.com/product/ws';\n  path = `${path}?${getVersionUrlParams()}${\n    for_reconnect && client.id && client.secret ? `&reconnect=${client.id}&secret=${client.secret}` : ''\n  }&sesuid=${session_uid}`;\n  let socket = new WebSocket(path);\n  socket.binaryType = 'arraybuffer';\n  client.socket = socket;\n\n  // Protect callbacks from ever firing if we've already disconnected this socket\n  //   from the WSClient\n  function guard(fn) {\n    return function (...args) {\n      if (client.socket !== socket) {\n        return;\n      }\n      fn(...args);\n    };\n  }\n\n  function abort(skip_close) {\n    client.socket = null;\n    client.net_delayer = null;\n    if (client.connected) {\n      client.disconnect_time = Date.now();\n      client.disconnected = true;\n      errorReportSetDetails('disconnected', 1);\n    }\n    client.connected = false;\n    client.connect_error = ERR_CONNECTING;\n    if (!skip_close) {\n      try {\n        socket.close();\n      } catch (e) {\n        // ignore\n      }\n    }\n    // Fire subscription_manager disconnect handler\n    client.handlers.disconnect();\n    ack.failAll(client);\n  }\n\n  function retry(skip_close) {\n    abort(skip_close);\n    client.retryConnection();\n  }\n\n  // Local state, for this one connection\n  let connected = false;\n  client.socket.addEventListener('error', guard(function (err) {\n    if (!connected) {\n      console.log('WebSocket error during initial connection, retrying...', err);\n      retry();\n    } else {\n      console.error('WebSocket error', err);\n      // Disconnect and reconnect here, is this a terminal error? Probably not, we'll get a 'close' event if it is?\n      // We some error occasionally on iOS, not sure what error, but it auto-reconnects fine, so let's\n      // not do a throw\n      // client.onError(err);\n    }\n  }));\n\n  client.socket.addEventListener('message', guard(function (message) {\n    profilerStart('WS');\n    // net_time -= Date.now();\n    assert(message.data instanceof ArrayBuffer);\n    wsHandleMessage(client, new Uint8Array(message.data));\n    // net_time += Date.now();\n    profilerStop('WS');\n  }));\n\n  client.socket.addEventListener('open', guard(function () {\n    console.log('WebSocket open');\n    connected = true;\n    // reset retry count so next retry is fast if we get disconnected\n    client.retry_count = 0;\n  }));\n\n  // This may get called before the close event gets to use\n  client.on_close = guard(function () {\n    console.log('WebSocket close, retrying connection...');\n    retry(true);\n  });\n  client.socket.addEventListener('close', client.on_close);\n\n  let doPing = guard(function () {\n    if (Date.now() - client.last_send_time >= wscommon.PING_TIME &&\n      client.connected && client.socket.readyState === 1\n    ) {\n      client.send('ping');\n    }\n    setTimeout(doPing, wscommon.PING_TIME / 2);\n  });\n  setTimeout(doPing, wscommon.PING_TIME / 2);\n\n  // For debugging reconnect handling\n  // setTimeout(function () {\n  //   if (connected) {\n  //     socket.close();\n  //   }\n  // }, 5000);\n};\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint no-bitwise:off */\n\nconst assert = require('assert');\nconst { isPacket } = require('./packet.js');\nconst { perfCounterAddValue } = require('./perfcounters.js');\n\nexport function ackInitReceiver(receiver) {\n  receiver.last_pak_id = 0;\n  receiver.resp_cbs = {};\n  receiver.responses_waiting = 0;\n}\n\nconst ERR_FAILALL_DISCONNECT = 'ERR_FAILALL_DISCONNECT';\n\nconst ACKFLAG_IS_RESP = 1<<3;\nconst ACKFLAG_ERR = 1<<4;\nconst ACKFLAG_DATA_JSON = 1<<5;\n// `receiver` is really the sender, here, but will receive any response\nexport function ackWrapPakStart(pak, receiver, msg) {\n  let flags = 0;\n\n  pak.ack_data = {\n    receiver,\n  };\n\n  if (typeof msg === 'number') {\n    flags |= ACKFLAG_IS_RESP;\n    pak.writeInt(msg);\n  } else {\n    pak.writeAnsiString(msg);\n  }\n  let resp_pak_id = receiver ? ++receiver.last_pak_id : 0;\n  pak.ack_data.resp_pak_id = resp_pak_id;\n  pak.ack_data.resp_pak_id_offs = pak.getOffset();\n  pak.writeInt(resp_pak_id);\n\n  pak.ack_data.data_offs = pak.getOffset();\n  pak.ack_data.flags = flags;\n}\n\nexport function ackWrapPakPayload(pak, data) {\n  if (isPacket(data)) {\n    pak.appendRemaining(data);\n  } else {\n    pak.ack_data.flags |= ACKFLAG_DATA_JSON;\n    pak.writeJSON(data);\n  }\n}\n\nexport function ackWrapPakFinish(pak, err, resp_func) {\n  let flags = pak.ack_data.flags;\n  let offs = pak.getOffset();\n  if (err) {\n    // Nothing else must have been written\n    assert.equal(pak.ack_data.data_offs, offs);\n    flags |= ACKFLAG_ERR;\n    pak.writeString(String(err));\n    offs = pak.getOffset();\n  }\n  pak.makeReadable();\n  let resp_pak_id = 0;\n  if (resp_func && resp_func.expecting_response !== false) {\n    resp_pak_id = pak.ack_data.resp_pak_id;\n    assert(resp_pak_id);\n    assert(pak.ack_data.receiver);\n    pak.ack_data.receiver.resp_cbs[resp_pak_id] = resp_func;\n  } else {\n    pak.seek(pak.ack_data.resp_pak_id_offs);\n    pak.zeroInt();\n    pak.seek(offs);\n  }\n  pak.updateFlags(flags);\n  delete pak.ack_data;\n  return resp_pak_id;\n}\n\nexport function ackReadHeader(pak) {\n  let flags = pak.getFlags();\n  let msg = (flags & ACKFLAG_IS_RESP) ? pak.readInt() : pak.readAnsiString();\n  let pak_id = pak.readInt();\n  let err = (flags & ACKFLAG_ERR) ? pak.readString() : undefined;\n  let data;\n  if (flags & ACKFLAG_DATA_JSON) {\n    data = pak.readJSON();\n  } else {\n    data = pak;\n  }\n  return {\n    msg,\n    err,\n    data,\n    pak_id,\n  };\n}\n\nexport function failAll(receiver, err) {\n  err = err || ERR_FAILALL_DISCONNECT;\n  let cbs = receiver.resp_cbs;\n  receiver.resp_cbs = {};\n  receiver.responses_waiting = 0;\n  for (let pak_id in cbs) {\n    cbs[pak_id](err);\n  }\n}\n\n// `source` is a string for debug/logging only\n// `receiver` needs initReceicver called on it, have .onError() in the prototype and optionally .log()\n// sendFunc(msg, err, data, resp_func)\n// handleFunc(msg, data, resp_func)\nexport function ackHandleMessage(receiver, source, pak, send_func, pak_func, handle_func, filter_func) {\n  let pak_initial_offs = pak.getOffset();\n  let { err, data, msg, pak_id } = ackReadHeader(pak);\n  if (receiver.logPacketDispatch) {\n    perfCounterAddValue('net.recv_bytes.total', pak.totalSize());\n    let msg_name = typeof msg === 'number' ? 'ack' : msg;\n    perfCounterAddValue(`net.recv_bytes.${msg_name}`, pak.totalSize());\n    receiver.logPacketDispatch(source, pak, pak_initial_offs, msg_name);\n  }\n  let now = Date.now();\n  let expecting_response = Boolean(pak_id);\n  let timeout_id;\n  if (expecting_response) {\n    timeout_id = 'pending';\n  }\n  let sent_response = false;\n  let start_time = now;\n\n  if (filter_func && !filter_func(receiver, msg, data)) {\n    // Simply discard this message\n    return;\n  }\n\n  function preSendResp(err) {\n    assert(!sent_response, 'Response function called twice');\n    sent_response = true;\n\n    if (expecting_response) {\n      if (timeout_id) {\n        if (timeout_id !== 'pending') {\n          clearTimeout(timeout_id);\n        }\n      } else {\n        if (err === ERR_FAILALL_DISCONNECT) {\n          // this is the result of a failAll() call, a response was not actually sent!\n        } else {\n          (receiver.log ? receiver : console).log(`Response finally sent for ${msg\n          } after ${((Date.now() - start_time) / 1000).toFixed(1)}s`);\n        }\n      }\n      receiver.responses_waiting--;\n    }\n  }\n\n  function respFunc(err, resp_data, resp_func) {\n    preSendResp(err);\n    // the callback wants to send a response, and possibly get a response from that!\n    if (!expecting_response) {\n      // But, the other end is not expecting a response from this packet, black-hole it\n      if (resp_func) {\n        // We better not be expecting a response to our response!\n        receiver.onError(`Sending a response to a packet (${msg}) that did not expect` +\n          ' one, but we are expecting a response');\n        return;\n      }\n      // however, if there was an error, let's forward that along as an error message\n      if (err) {\n        send_func('error', null, err, null);\n      }\n      return;\n    }\n    send_func(pak_id, err, resp_data, resp_func);\n  }\n  respFunc.expecting_response = expecting_response;\n  respFunc.pak = function (ref_pak) {\n    assert(expecting_response);\n    let pak = pak_func(pak_id, ref_pak);\n    let orig_send = pak.send;\n    pak.send = function (err, resp_func) {\n      preSendResp(err);\n      orig_send.call(pak, err, resp_func);\n    };\n    return pak;\n  };\n\n  if (typeof msg === 'number') {\n    let cb = receiver.resp_cbs[msg];\n    if (!cb) {\n      return void receiver.onError(`Received response to unknown packet with id ${msg} from ${source}`);\n    }\n    delete receiver.resp_cbs[msg];\n    profilerStart('response');\n    cb(err, data, respFunc);\n    profilerStop('response');\n  } else {\n    if (!msg) {\n      return void receiver.onError(`Received message with no .msg from ${source}`);\n    }\n    profilerStart(msg);\n    handle_func(msg, data, respFunc);\n    profilerStop(msg);\n  }\n  if (expecting_response) {\n    // Note, this may be -1 if respFunc has already been called\n    receiver.responses_waiting++;\n    if (!sent_response && !respFunc.suppress_timeout) {\n      // timeout warning for response\n      timeout_id = setTimeout(function () {\n        timeout_id = null;\n        if (!respFunc.suppress_timeout) {\n          (receiver.log ? receiver : console).log(`Response not sent for ${msg\n          } from ${source} after ${((Date.now() - start_time) / 1000).toFixed(1)}s`);\n        }\n      }, 15*1000);\n    }\n  }\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint no-bitwise:off */\n\n\n// Encoding is fastest with non-native calls: http://jsperf.com/base64-encode\n// Decoding is fastest using window.btoa: http://jsperf.com/base64-decode\n\nconst { floor } = Math;\n\nconst chr_table = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'.split('');\nconst PAD = '=';\n\n// dv is a DataView with a .u8 property\nfunction encode(dv, offset, length) {\n  let data = dv.u8;\n  let result = '';\n  let i;\n  let effi;\n  // Convert every three bytes to 4 ascii characters.\n  for (i = 0; i < (length - 2); i += 3) {\n    effi = offset + i;\n    result += chr_table[data[effi] >> 2];\n    result += chr_table[((data[effi] & 0x03) << 4) + (data[effi + 1] >> 4)];\n    result += chr_table[((data[effi + 1] & 0x0f) << 2) + (data[effi + 2] >> 6)];\n    result += chr_table[data[effi + 2] & 0x3f];\n  }\n\n  // Convert the remaining 1 or 2 bytes, pad out to 4 characters.\n  if (length % 3) {\n    i = length - (length % 3);\n    effi = offset + i;\n    result += chr_table[data[effi] >> 2];\n    if ((length % 3) === 2) {\n      result += chr_table[((data[effi] & 0x03) << 4) + (data[effi + 1] >> 4)];\n      result += chr_table[(data[effi + 1] & 0x0f) << 2];\n      result += PAD;\n    } else {\n      result += chr_table[(data[effi] & 0x03) << 4];\n      result += PAD + PAD;\n    }\n  }\n\n  return result;\n}\n\nfunction decodeNativeBrowser(data, allocator) {\n  let str = window.atob(data);\n  let len = str.length;\n  let dv = allocator(len);\n  let u8 = dv.u8;\n  for (let ii = 0; ii < len; ++ii) {\n    u8[ii] = str.charCodeAt(ii);\n  }\n  dv.decode_size = len;\n  return dv;\n}\n\nfunction encodeNativeNode(dv, offset, length) {\n  // Allocates a Buffer() object each time - could have our allocDataView do that if needed for perf\n  return Buffer.from(dv.buffer).toString('base64', offset, offset + length);\n}\n// Faster, but uses an internal function that might break:\n// function encodeNativeNode(dv, offset, length) {\n//   return Buffer.prototype.base64Slice.call(dv.u8, offset, offset + length);\n// }\n\nfunction decodeNativeNode(data, allocator) {\n  let buffer_len = (data.length >> 2) * 3 + floor((data.length % 4) / 1.5);\n  let dv = allocator(buffer_len);\n  let buffer = Buffer.from(dv.buffer);\n  dv.decode_size = buffer.write(data, 'base64');\n  return dv;\n}\n\nconst BROWSER = typeof window !== 'undefined';\n\n// string -> Uint8Array or Buffer\nexports.base64Decode = BROWSER ? decodeNativeBrowser : decodeNativeNode;\n// Uint8Array or Buffer -> string\nexports.base64Encode = BROWSER ? encode : encodeNativeNode;\n\nexports.base64CharTable = chr_table;\n","// Portions Copyright 2020 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nconst assert = require('assert');\nconst { asyncParallelLimit, asyncSeries } = require('glov-async');\nconst crc32 = require('./crc32.js');\nconst { ceil, min } = Math;\nconst { packetBufPoolAlloc, packetBufPoolFree } = require('./packet.js');\n\n// combined size of all chunked sends at any given time\nexport const MAX_CLIENT_UPLOAD_SIZE = 2*1024*1024;\n\nconst CHUNK_SIZE = 8192 - 100; // Should fit in a 8kb packet after headers and such; used by sender only\n\nfunction cleanupFile(state, file_id, pool) {\n  let file_data = state.files[file_id];\n  if (file_data.dv) {\n    // Pool?\n    packetBufPoolFree(file_data.dv);\n    delete file_data.dv;\n  }\n  state.buffer_size -= file_data.length;\n  assert(state.buffer_size >= 0);\n  delete state.files[file_id];\n}\n\nexport function chunkedReceiverInit(name, max_buffer_size) {\n  return {\n    name,\n    max_buffer_size,\n    last_file_id: 0,\n    buffer_size: 0,\n    files: {},\n  };\n}\n\nexport function chunkedReceiverCleanup(state) {\n  if (!state || !state.files) {\n    return;\n  }\n  for (let file_id in state.files) {\n    cleanupFile(state, file_id);\n  }\n}\n\nexport function chunkedReceiverFreeFile(container) {\n  let { buffer, dv } = container;\n  assert(buffer);\n  assert(dv);\n  packetBufPoolFree(dv);\n  delete container.buffer;\n}\n\nexport function chunkedReceiverGetFile(state, file_id) {\n  if (!state) {\n    return { err: 'ERR_NOT_INITIALIZED' };\n  }\n  function err(msg) {\n    console.error(`${state.name}: chunkedReceiverGetFile(${file_id}): ${msg}`);\n    return { err: msg };\n  }\n  if (!state.files) {\n    return err('ERR_FILE_NOT_FOUND');\n  }\n  let file_data = state.files[file_id];\n  if (!file_data) {\n    return err('ERR_FILE_NOT_FOUND');\n  }\n  if (!file_data.finished) {\n    cleanupFile(state, file_id);\n    return err('ERR_UPLOAD_UNFINISHED');\n  }\n  let { dv, mime_type, length } = file_data;\n  file_data.buffer = null;\n  file_data.dv = null;\n  cleanupFile(state, file_id);\n  let buffer = new Uint8Array(dv.buffer, dv.byteOffset, length);\n  return {\n    dv,\n    mime_type,\n    buffer,\n  };\n}\n\nexport function chunkedReceiverStart(state, pak, resp_func) {\n  assert(state);\n  let length = pak.readInt();\n  let crc = pak.readU32();\n  let mime_type = pak.readAnsiString();\n  let log = `${state.name}: chunkedReceiverStart length=${length} crc=${crc} mime=${mime_type}`;\n\n  if (length > state.max_buffer_size) {\n    console.error(`${log}: ERR_TOO_LARGE`);\n    return void resp_func('ERR_TOO_LARGE');\n  }\n  if (state.buffer_size + length > state.max_buffer_size) {\n    console.error(`${log}: ERR_OUT_OF_SPACE`);\n    return void resp_func('ERR_OUT_OF_SPACE');\n  }\n\n  state.buffer_size += length;\n\n  let id = ++state.last_file_id;\n  console.log(`${log} id=${id}`);\n  state.files[id] = {\n    length,\n    crc,\n    mime_type,\n    total: 0,\n    dv: packetBufPoolAlloc(length),\n  };\n  resp_func(null, id);\n}\n\nexport function chunkedReceiverOnChunk(state, pak, resp_func) {\n  if (!state) {\n    pak.pool();\n    return void resp_func('ERR_NOT_INITED');\n  }\n  let id = pak.readInt();\n  let offs = pak.readInt();\n  let buf = pak.readBuffer(false);\n  let log = `${state.name}: chunkedReceiverOnChunk id=${id} offs=${offs} length=${buf.length}`;\n  let file_data = state.files && state.files[id];\n  if (!file_data) {\n    console.error(`${log}: ERR_INVALID_FILE_ID`);\n    return void resp_func('ERR_INVALID_FILE_ID');\n  }\n  if (file_data.total + buf.length > file_data.length) {\n    cleanupFile(state, id);\n    console.error(`${log}: ERR_BUFFER_OVERRUN`);\n    return void resp_func('ERR_BUFFER_OVERRUN');\n  }\n  console.debug(log);\n  file_data.total += buf.length;\n  file_data.dv.u8.set(buf, offs);\n  if (state.on_progress) {\n    state.on_progress(file_data.total, file_data.length, file_data.mime_type, id);\n  }\n  resp_func();\n}\n\n// Optional? do some final checks\nexport function chunkedReceiverFinish(state, pak, resp_func) {\n  let id = pak.readInt();\n  if (!state) {\n    return void resp_func('ERR_NOT_INITED');\n  }\n  let file_data = state.files && state.files[id];\n  let log = `${state.name}: chunkedReceiverFinish id=${id}`;\n  if (!file_data) {\n    console.error(`${log}: ERR_INVALID_FILE_ID`);\n    return void resp_func('ERR_INVALID_FILE_ID');\n  }\n  if (file_data.total !== file_data.length) {\n    cleanupFile(state, id);\n    console.error(`${log}: ERR_INCOMPLETE (total=${file_data.total} length=${file_data.length})`);\n    return void resp_func('ERR_INCOMPLETE');\n  }\n  let crc = crc32(file_data.dv.u8, file_data.length);\n  if (crc !== file_data.crc) {\n    cleanupFile(state, id);\n    console.error(`${log}: ERR_CRC_MISMATCH (expected=${file_data.crc} actual=${crc})`);\n    return void resp_func('ERR_CRC_MISMATCH');\n  }\n  file_data.finished = true;\n  resp_func();\n}\n\n// cb(err, id)\nexport function chunkedSend(opts, cb) {\n  let { client, buffer, mime_type, max_in_flight } = opts;\n  assert(buffer instanceof Uint8Array, 'Invalid data type');\n  assert(mime_type, 'Missing mime_type');\n\n  let length = buffer.length;\n  assert(length);\n  let crc = crc32(buffer);\n\n  let id;\n  asyncSeries([\n    function getID(next) {\n      let pak = client.pak('upload_start');\n      pak.writeInt(length);\n      pak.writeU32(crc);\n      pak.writeAnsiString(mime_type);\n      pak.send(function (err, assigned_id) {\n        id = assigned_id;\n        next(err);\n      });\n    },\n    function streamFile(next) {\n      let num_chunks = ceil(length / CHUNK_SIZE);\n\n      let any_error = false;\n      function sendChunk(idx, next) {\n        if (any_error) {\n          // Already had an error, fail-fast, don't try to send on disconnected link, etc\n          return void next();\n        }\n        assert(idx < num_chunks);\n        let pak = client.pak('upload_chunk');\n        pak.writeInt(id);\n        let start = idx * CHUNK_SIZE;\n        pak.writeInt(start);\n        let chunk_len = min(CHUNK_SIZE, length - start);\n        pak.writeBuffer(new Uint8Array(buffer.buffer, buffer.byteOffset + start, chunk_len));\n        pak.send(function (err) {\n          if (err) {\n            any_error = true;\n          }\n          next(err);\n        });\n      }\n      let tasks = [];\n      for (let ii = 0; ii < num_chunks; ++ii) {\n        tasks.push(sendChunk.bind(null, ii));\n      }\n      asyncParallelLimit(tasks, max_in_flight, next);\n    },\n    function finish(next) {\n      let pak = client.pak('upload_finish');\n      pak.writeInt(id);\n      pak.send(next);\n    },\n  ], function (err) {\n    cb(err, id);\n  });\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst { isInteger } = require('./util.js');\nconst { perfCounterAdd } = require('./perfcounters.js');\n\nexport function canonical(cmd) {\n  return cmd.toLowerCase().replace(/[_.]/g, '');\n}\n\nexport const TYPE_INT = 0;\nexport const TYPE_FLOAT = 1;\nexport const TYPE_STRING = 2;\nconst TYPE_NAME = ['INTEGER', 'NUMBER', 'STRING'];\n\nexport function defaultHandler(err, resp) {\n  if (err) {\n    console.error(err, resp);\n  } else {\n    console.info(resp);\n  }\n}\n\nfunction checkAccess(access, list) {\n  if (list) {\n    for (let ii = 0; ii < list.length; ++ii) {\n      if (!access || !access[list[ii]]) {\n        return false;\n      }\n    }\n  }\n  return true;\n}\n\nfunction formatUsage(usage, help, prefix_help) {\n  return !usage ? undefined :\n    prefix_help ? `${help}\\n${usage}`:\n    help ? String(usage).replace(/\\$HELP/, help) :\n    String(usage);\n}\n\nfunction CmdParse(params) {\n  this.cmds = {};\n  this.cmds_for_complete = this.cmds;\n  this.was_not_found = false;\n  this.storage = params && params.storage; // expects .setJSON(), .getJSON()\n  this.default_handler = defaultHandler;\n  this.last_access = null;\n  this.register({\n    cmd: 'cmd_list',\n    func: this.cmdList.bind(this),\n    access_show: ['hidden'],\n  });\n}\nCmdParse.prototype.cmdList = function (str, resp_func) {\n  if (!this.cmd_list) {\n    let list = this.cmd_list = {};\n    for (let cmd in this.cmds) {\n      let cmd_data = this.cmds[cmd];\n      let access = []; // combine for data compaction\n      if (cmd_data.access_show) {\n        access = access.concat(cmd_data.access_show);\n      }\n      if (cmd_data.access_run) {\n        access = access.concat(cmd_data.access_run);\n      }\n      if (access.indexOf('hidden') !== -1) {\n        continue;\n      }\n      let data = {\n        name: cmd_data.name,\n        help: String(cmd_data.help),\n      };\n      if (cmd_data.usage) {\n        data.usage = formatUsage(cmd_data.usage, cmd_data.help, cmd_data.prefix_usage_with_help);\n      }\n      if (access.length) {\n        data.access_show = access;\n      }\n      list[cmd] = data;\n    }\n  }\n  resp_func(null, this.cmd_list);\n};\n\nCmdParse.prototype.setDefaultHandler = function (fn) {\n  assert(this.default_handler === defaultHandler); // Should only set this once\n  this.default_handler = fn;\n};\nCmdParse.prototype.checkAccess = function (access_list) {\n  return checkAccess(this.last_access, access_list);\n};\nCmdParse.prototype.handle = function (self, str, resp_func) {\n  resp_func = resp_func || this.default_handler;\n  this.was_not_found = false;\n  let m = str.match(/^([^\\s]+)(?:\\s+(.*))?$/);\n  if (!m) {\n    resp_func('Missing command');\n    return true;\n  }\n  let cmd = canonical(m[1]);\n  let cmd_data = this.cmds[cmd];\n  this.last_access = self && self.access;\n  if (cmd_data && !checkAccess(this.last_access, cmd_data.access_run)) {\n    // this.was_not_found = true;\n    resp_func(`Access denied: \"${m[1]}\"`);\n    return false;\n  }\n  if (!cmd_data) {\n    this.was_not_found = true;\n    resp_func(`Unknown command: \"${m[1]}\"`);\n    this.was_not_found = false;\n    return false;\n  }\n  perfCounterAdd(`cmd.${cmd}`);\n  cmd_data.fn.call(self, m[2] || '', resp_func);\n  return true;\n};\n\nCmdParse.prototype.register = function (param) {\n  assert.equal(typeof param, 'object');\n  let { cmd, func, help, usage, prefix_usage_with_help, access_show, access_run, store_data } = param;\n  assert(cmd);\n  assert(func, `Missing function for command \"${cmd}\"`);\n  let help_lower = String(help || '').toLowerCase();\n  if (help_lower.includes('(admin)')) {\n    assert(access_run && access_run.includes('sysadmin'));\n  }\n  if (help_lower.includes('(hidden)')) {\n    assert(access_show && access_show.length);\n  }\n  let canon = canonical(cmd);\n  assert(!this.cmds[canon], `Duplicate commands registered as \"${canon}\"`);\n  this.cmds[canon] = {\n    name: cmd,\n    fn: func,\n    help,\n    usage,\n    prefix_usage_with_help,\n    access_show,\n    access_run,\n    store_data, // just for resetSettings\n  };\n};\n\nfunction formatRangeValue(type, value) {\n  let ret = String(value);\n  if (type === TYPE_FLOAT && !ret.includes('.')) {\n    ret += '.00';\n  }\n  return ret;\n}\n\nconst CMD_STORAGE_PREFIX = 'cmd_parse_';\n\n// Optional param.on_change(is_startup:boolean)\nCmdParse.prototype.registerValue = function (cmd, param) {\n  assert(TYPE_NAME[param.type] || !param.set);\n  assert(param.set || param.get);\n  let label = param.label || cmd;\n  let store = param.store && this.storage || false;\n  let store_key = `${CMD_STORAGE_PREFIX}${canonical(cmd)}`;\n  if (param.ver) {\n    store_key += `_${param.ver}`;\n  }\n  let store_data;\n  if (store) {\n    assert(param.set);\n    store_data = {\n      store_key,\n      param,\n    };\n    let init_value = this.storage.getJSON(store_key);\n    if (init_value !== undefined) {\n      // enforce stored values within current range\n      if (param.range) {\n        init_value = Number(init_value);\n        if (!isFinite(init_value) || init_value < param.range[0] || init_value > param.range[1]) {\n          init_value = undefined;\n        }\n      }\n      if (init_value !== undefined) {\n        param.set(init_value);\n      }\n      if (param.on_change) {\n        param.on_change(true);\n      }\n    }\n  }\n  let fn = (str, resp_func) => {\n    function value() {\n      resp_func(null, `${label} = ${param.get()}`);\n    }\n    function usage() {\n      resp_func(`Usage: /${cmd} ${TYPE_NAME[param.type]}`);\n    }\n    if (!str) {\n      if (param.get && param.set) {\n        // More explicit help for these automatic value settings\n        let is_bool = param.type === TYPE_INT && param.range && param.range[0] === 0 && param.range[1] === 1;\n        let help = [\n          `${label}:`,\n        ];\n        if (param.range) {\n          help.push(`Valid range: [${formatRangeValue(param.type, param.range[0])}...` +\n            `${formatRangeValue(param.type, param.range[1])}]`);\n        }\n        let cur_value = param.get();\n        if (is_bool) {\n          help.push(`To disable: /${cmd} 0`);\n          help.push(`To enable: /${cmd} 1`);\n        } else {\n          help.push(`To change: /${cmd} NewValue`);\n          help.push(`  example: /${cmd} ${param.range ?\n            cur_value === param.range[0] ? param.range[1] : param.range[0] : 1}`);\n        }\n        let def_value = param.default_value;\n        if (def_value !== undefined) {\n          help.push(`Default value = ${def_value}${is_bool ? ` (${def_value ? 'Enabled' : 'Disabled'})`: ''}`);\n        }\n        help.push(`Current value = ${cur_value}${is_bool ? ` (${cur_value ? 'Enabled' : 'Disabled'})`: ''}`);\n        return resp_func(null, help.join('\\n'));\n      } else if (param.get) {\n        return value();\n      } else {\n        return usage();\n      }\n    }\n    if (!param.set) {\n      return resp_func(`Usage: /${cmd}`);\n    }\n    let n = Number(str);\n    if (param.range) {\n      if (n < param.range[0]) {\n        n = param.range[0];\n      } else if (n > param.range[1]) {\n        n = param.range[1];\n      }\n    }\n    let store_value = n;\n    if (param.type === TYPE_INT) {\n      if (!isInteger(n)) {\n        return usage();\n      }\n      param.set(n);\n    } else if (param.type === TYPE_FLOAT) {\n      if (!isFinite(n)) {\n        return usage();\n      }\n      param.set(n);\n    } else {\n      store_value = str;\n      param.set(str);\n    }\n    if (store) {\n      this.storage.setJSON(store_key, store_value);\n    }\n    if (param.on_change) {\n      param.on_change(false);\n    }\n    if (param.get) {\n      return value();\n    } else {\n      return resp_func(null, `${label} udpated`);\n    }\n  };\n  this.register({\n    cmd,\n    func: fn,\n    help: param.help || ((param.get && param.set) ?\n      `Set or display \"${label}\" value` :\n      param.set ? `Set \"${label}\" value` : `Display \"${label}\" value`),\n    usage: param.usage || ((param.get ? `Display \"${label}\" value\\n  Usage: /${cmd}\\n` : '') +\n      (param.set ? `Set \"${label}\" value\\n  Usage: /${cmd} NewValue` : '')),\n    prefix_usage_with_help: param.prefix_usage_with_help,\n    access_show: param.access_show,\n    access_run: param.access_run,\n    store_data,\n  });\n};\n\nCmdParse.prototype.resetSettings = function () {\n  let results = [];\n  let all_saved_data = this.storage.localStorageExportAll(CMD_STORAGE_PREFIX);\n  let count = 0;\n  for (let key in all_saved_data) {\n    let value = all_saved_data[key];\n    let cmd_name = key.slice(CMD_STORAGE_PREFIX.length);\n    let version;\n    ([cmd_name, version] = cmd_name.split('_')); // grab and strip version\n    let cmd_data = this.cmds[cmd_name];\n    if (!cmd_data) {\n      this.storage.set(key, undefined);\n      results.push(`Cleared unknown setting \"${cmd_name}\" = ${value}`);\n      ++count;\n    } else {\n      let { name, store_data } = cmd_data;\n      let default_value = store_data?.param?.default_value;\n      if (store_data && store_data.store_key !== key) {\n        this.storage.set(key, undefined);\n        results.push(`Cleared old setting \"${name} (v${version || 0})\"`);\n        ++count;\n      } else if (default_value !== undefined) {\n        if (JSON.stringify(default_value) === value) {\n          // Already at default value, \"clear\" this silently, just remove from storage\n          this.storage.set(key, undefined);\n          // results.push(`Cleared setting \"${name}\" already at default value`);\n          // ++count;\n        } else {\n          this.storage.set(key, undefined);\n          results.push(`Cleared setting \"${name}\" = ${value} (default = ${default_value})`);\n          ++count;\n        }\n      } else {\n        this.storage.set(key, undefined);\n        results.push(`Cleared setting \"${name}\" = ${value}`);\n        ++count;\n      }\n    }\n  }\n\n  if (results.length) {\n    results.push(`Reset ${count} setting(s)`);\n  }\n  return results;\n};\n\nfunction cmpCmd(a, b) {\n  if (a.cname < b.cname) {\n    return -1;\n  }\n  return 1;\n}\n\n// for auto-complete\nCmdParse.prototype.addServerCommands = function (new_cmds) {\n  let cmds = this.cmds_for_complete;\n  if (this.cmds_for_complete === this.cmds) {\n    cmds = this.cmds_for_complete = {};\n    for (let cname in this.cmds) {\n      cmds[cname] = this.cmds[cname];\n    }\n  }\n  for (let cname in new_cmds) {\n    if (!cmds[cname]) {\n      cmds[cname] = new_cmds[cname];\n    }\n  }\n};\n\nCmdParse.prototype.autoComplete = function (str, access) {\n  let list = [];\n  str = str.split(' ');\n  let first_tok = canonical(str[0]);\n  for (let cname in this.cmds_for_complete) {\n    if (str.length === 1 && cname.slice(0, first_tok.length) === first_tok ||\n      str.length > 1 && cname === first_tok\n    ) {\n      let cmd_data = this.cmds_for_complete[cname];\n      if (checkAccess(access, cmd_data.access_show) && checkAccess(access, cmd_data.access_run)) {\n        list.push({\n          cname,\n          cmd: cmd_data.name,\n          help: String(cmd_data.help),\n          usage: formatUsage(cmd_data.usage, cmd_data.help, cmd_data.prefix_usage_with_help),\n        });\n      }\n    }\n  }\n  list.sort(cmpCmd);\n  return list; // .slice(0, 20); Maybe?\n};\n\nCmdParse.prototype.canonical = canonical;\n\nCmdParse.prototype.TYPE_INT = TYPE_INT;\nCmdParse.prototype.TYPE_FLOAT = TYPE_FLOAT;\nCmdParse.prototype.TYPE_STRING = TYPE_STRING;\n\nexport function create(params) {\n  return new CmdParse(params);\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n// Possibly originally from PNG Specification Appendix: https://www.w3.org/TR/PNG-CRCAppendix.html\n\n// Table of CRCs of all 8-bit messages.\nlet crc_table = new Array(256);\n\n// Make the table for a fast CRC.\n(function () {\n  for (let n = 0; n < 256; n++) {\n    let c = n;\n    for (let k = 0; k < 8; k++) {\n      if (c & 1) {\n        c = -306674912 ^ (c >>> 1);\n      } else {\n        c >>>= 1;\n      }\n    }\n    crc_table[n] = c;\n  }\n}());\n\n\n/* Update a running CRC with the bytes buf[0..len-1]--the CRC\nshould be initialized to all 1's, and the transmitted value\nis the 1's complement of the final running CRC (see the\ncrc32() routine below)). */\n\nfunction update_crc(crc, buf, len) {\n  for (let n = 0; n < len; n++) {\n    crc = crc_table[(crc ^ buf[n]) & 0xff] ^ (crc >>> 8);\n  }\n  return crc;\n}\n\n// Return the CRC of the bytes buf[0..len-1].\nfunction crc32(buf, len) {\n  len = len || buf.length;\n  return (update_crc(0xffffffff, buf, len) ^ 0xffffffff) >>> 0;\n}\nmodule.exports = crc32;\nmodule.exports.crc32 = crc32;\n","/* eslint prefer-template:off */\n// From https://github.com/sindresorhus/dot-prop\n// MIT License\n// Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)\n\n// Adjusted to work on old browsers (if through Babel) and to not crash on Arrays\n\nconst { arrayToSet } = require('./util.js');\n\nconst disallowedKeys = arrayToSet([\n  '__proto__',\n  'prototype',\n  'constructor'\n]);\n\nfunction isObject(value) {\n  const type = typeof value;\n  return value !== null && (type === 'object' || type === 'function');\n}\n\nfunction isValidPath(pathSegments) {\n  for (let ii = 0; ii < pathSegments.length; ++ii) {\n    if (disallowedKeys[pathSegments[ii]]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction getPathSegments(path) {\n  const pathArray = path.split('.');\n  const parts = [];\n\n  for (let i = 0; i < pathArray.length; i++) {\n    let p = pathArray[i];\n\n    while (p[p.length - 1] === '\\\\' && pathArray[i + 1] !== undefined) {\n      p = p.slice(0, -1) + '.';\n      p += pathArray[++i];\n    }\n\n    parts.push(p);\n  }\n\n  if (!isValidPath(parts)) {\n    return [];\n  }\n\n  return parts;\n}\n\nmodule.exports = {\n  get(object, path, value) {\n    if (!isObject(object) || typeof path !== 'string') {\n      return value === undefined ? object : value;\n    }\n\n    const pathArray = getPathSegments(path);\n    if (pathArray.length === 0) {\n      return value;\n    }\n\n    for (let i = 0; i < pathArray.length; i++) {\n      object = object[pathArray[i]];\n\n      if (object === undefined || object === null) {\n        // `object` is either `undefined` or `null` so we want to stop the loop, and\n        // if this is not the last bit of the path, and\n        // if it did't return `undefined`\n        // it would return `null` if `object` is `null`\n        // but we want `get({foo: null}, 'foo.bar')` to equal `undefined`, or the supplied value, not `null`\n        if (i !== pathArray.length - 1) {\n          return value;\n        }\n\n        break;\n      }\n    }\n\n    return object === undefined ? value : object;\n  },\n\n  set(object, path, value) {\n    if (!isObject(object) || typeof path !== 'string') {\n      return object;\n    }\n\n    const root = object;\n    const pathArray = getPathSegments(path);\n\n    for (let i = 0; i < pathArray.length; i++) {\n      const p = pathArray[i];\n\n      if (i === pathArray.length - 1) {\n        object[p] = value;\n      } else if (!isObject(object[p])) {\n        object[p] = {};\n      }\n\n\n      object = object[p];\n    }\n\n    return root;\n  },\n\n  // eslint-disable-next-line consistent-return\n  delete(object, path) {\n    if (!isObject(object) || typeof path !== 'string') {\n      return false;\n    }\n\n    const pathArray = getPathSegments(path);\n\n    for (let i = 0; i < pathArray.length; i++) {\n      const p = pathArray[i];\n\n      if (i === pathArray.length - 1) {\n        delete object[p];\n        return true;\n      }\n\n      object = object[p];\n\n      if (!isObject(object)) {\n        return false;\n      }\n    }\n  },\n\n  has(object, path) {\n    if (!isObject(object) || typeof path !== 'string') {\n      return false;\n    }\n\n    const pathArray = getPathSegments(path);\n    if (pathArray.length === 0) {\n      return false;\n    }\n\n    for (let i = 0; i < pathArray.length; i++) {\n      if (isObject(object)) {\n        if (!(pathArray[i] in object)) {\n          return false;\n        }\n\n        object = object[pathArray[i]];\n      } else {\n        return false;\n      }\n    }\n\n    return true;\n  }\n};\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nexport let PRESENCE_OFFLINE = 0; // for invisible, etc\nexport let PRESENCE_ACTIVE = 1;\nexport let PRESENCE_INACTIVE = 2;\n\nexport const ID_PROVIDER_APPLE = 'apl';\nexport const ID_PROVIDER_FB_GAMING = 'fbg';\nexport const ID_PROVIDER_FB_INSTANT = 'fbi';\n\nexport type NumberEnum<K extends string, V extends number> = Record<K, V> & Partial<Record<string, V | string>>;\nexport type StringEnum<K extends string, V extends string> = Record<K, V>;\n\nexport function getStringEnumValues<K extends string, V extends string>(e: StringEnum<K, V>): V[] {\n  return Object.values(e);\n}\nexport function isValidNumberEnumKey<K extends string, V extends number>(e: NumberEnum<K, V>, k: string): k is K {\n  return typeof e[k] === 'number';\n}\nexport function isValidStringEnumKey<K extends string, V extends string>(e: StringEnum<K, V>, k: string): k is K {\n  return k in e;\n}\nexport function isValidStringEnumValue<K extends string, V extends string>(\n  e: StringEnum<K, V>,\n  v: string | undefined | null,\n): v is V {\n  for (let key in e) {\n    if (e[key] === v) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport enum Platform {\n  Android = 'android',\n  FBInstant = 'fbinstant',\n  IOS = 'ios',\n  Web = 'web',\n  Yandex = 'yandex',\n}\nexport function getPlatformValues(): Platform[] {\n  return getStringEnumValues(Platform);\n}\nexport function isValidPlatform(v: string | undefined | null): boolean {\n  return isValidStringEnumValue(Platform, v);\n}\n","export enum FriendStatus {\n  Added = 1,\n  AddedAuto = 2,\n  Removed = 3,\n  Blocked = 4,\n}\n\nexport interface FriendData {\n  status: FriendStatus;\n  ids?: Record<string, string>;\n}\n\nexport type FriendsData = Record<string, FriendData>;\n","/**\n *\n *  MD5 (Message-Digest Algorithm)\n *  http://www.webtoolkit.info/\n *\n * Modified by railGun to handle node.js Buffer objects\n *\n **/\n\n/* eslint no-bitwise:off, new-cap:off*/\nconst assert = require('assert');\n\nfunction stringUtf8Encode(str) {\n  let c;\n  let n;\n  let utftext = [];\n  str = str.replace(/\\r\\n/g, '\\n');\n  for (n = 0; n < str.length; ++n) {\n    c = str.charCodeAt(n);\n    if (c < 128) {\n      utftext.push(String.fromCharCode(c));\n    } else if ((c > 127) && (c < 2048)) {\n      utftext.push(String.fromCharCode((c >> 6) | 192));\n      utftext.push(String.fromCharCode((c & 63) | 128));\n    } else {\n      utftext.push(String.fromCharCode((c >> 12) | 224));\n      utftext.push(String.fromCharCode(((c >> 6) & 63) | 128));\n      utftext.push(String.fromCharCode((c & 63) | 128));\n    }\n  }\n  return utftext.join('');\n}\n\n\nfunction rotateLeft(lValue, iShiftBits) {\n  return (lValue<<iShiftBits) | (lValue>>>(32-iShiftBits));\n}\n\nfunction addUnsigned(lX,lY) {\n  let lX8 = (lX & 0x80000000);\n  let lY8 = (lY & 0x80000000);\n  let lX4 = (lX & 0x40000000);\n  let lY4 = (lY & 0x40000000);\n  let lResult = (lX & 0x3FFFFFFF)+(lY & 0x3FFFFFFF);\n  if (lX4 & lY4) {\n    return (lResult ^ 0x80000000 ^ lX8 ^ lY8);\n  }\n  if (lX4 | lY4) {\n    if (lResult & 0x40000000) {\n      return (lResult ^ 0xC0000000 ^ lX8 ^ lY8);\n    } else {\n      return (lResult ^ 0x40000000 ^ lX8 ^ lY8);\n    }\n  } else {\n    return (lResult ^ lX8 ^ lY8);\n  }\n}\n\nfunction F(x,y,z) {\n  return (x & y) | ((~x) & z);\n}\nfunction G(x,y,z) {\n  return (x & z) | (y & (~z));\n}\nfunction H(x,y,z) {\n  return (x ^ y ^ z);\n}\nfunction I(x,y,z) {\n  return (y ^ (x | (~z)));\n}\n\nfunction FF(a,b,c,d,x,s,ac) {\n  a = addUnsigned(a, addUnsigned(addUnsigned(F(b, c, d), x), ac));\n  return addUnsigned(rotateLeft(a, s), b);\n}\n\nfunction GG(a,b,c,d,x,s,ac) {\n  a = addUnsigned(a, addUnsigned(addUnsigned(G(b, c, d), x), ac));\n  return addUnsigned(rotateLeft(a, s), b);\n}\n\nfunction HH(a,b,c,d,x,s,ac) {\n  a = addUnsigned(a, addUnsigned(addUnsigned(H(b, c, d), x), ac));\n  return addUnsigned(rotateLeft(a, s), b);\n}\n\nfunction II(a,b,c,d,x,s,ac) {\n  a = addUnsigned(a, addUnsigned(addUnsigned(I(b, c, d), x), ac));\n  return addUnsigned(rotateLeft(a, s), b);\n}\n\nfunction convertToWordArray(string) {\n  let lWordCount;\n  let lMessageLength = string.length;\n  let lNumberOfWords_temp1=lMessageLength + 8;\n  let lNumberOfWords_temp2=\n    (lNumberOfWords_temp1-(lNumberOfWords_temp1 % 64))/64;\n  let lNumberOfWords = (lNumberOfWords_temp2+1)*16;\n  let lWordArray=new Array(lNumberOfWords-1);\n  let lBytePosition = 0;\n  let lByteCount = 0;\n  while (lByteCount < lMessageLength) {\n    lWordCount = (lByteCount-(lByteCount % 4))/4;\n    lBytePosition = (lByteCount % 4)*8;\n    lWordArray[lWordCount] |= string.charCodeAt(lByteCount) << lBytePosition;\n    lByteCount++;\n  }\n  lWordCount = (lByteCount-(lByteCount % 4))/4;\n  lBytePosition = (lByteCount % 4)*8;\n  lWordArray[lWordCount] |= (0x80<<lBytePosition);\n  lWordArray[lNumberOfWords-2] = lMessageLength<<3;\n  lWordArray[lNumberOfWords-1] = lMessageLength>>>29;\n  return lWordArray;\n}\n\n// function convertByteArraytoWordArray(arr) {\n//   let lWordCount;\n//   let lMessageLength = arr.length;\n//   let lNumberOfWords_temp1 = lMessageLength + 8;\n//   let lNumberOfWords_temp2 =\n//     (lNumberOfWords_temp1 - (lNumberOfWords_temp1 % 64)) / 64;\n//   let lNumberOfWords = (lNumberOfWords_temp2 + 1) * 16;\n//   let lWordArray = new Array(lNumberOfWords - 1);\n//   let lBytePosition = 0;\n//   let lByteCount = 0;\n//   while (lByteCount < lMessageLength) {\n//     lWordCount = (lByteCount - (lByteCount % 4)) / 4;\n//     lBytePosition = (lByteCount % 4) * 8;\n//     lWordArray[lWordCount] |= arr[lByteCount] << lBytePosition;\n//     lByteCount++;\n//   }\n//   lWordCount = (lByteCount - (lByteCount % 4)) / 4;\n//   lBytePosition = (lByteCount % 4) * 8;\n//   lWordArray[lWordCount] |= 0x80 << lBytePosition;\n//   lWordArray[lNumberOfWords - 2] = lMessageLength << 3;\n//   lWordArray[lNumberOfWords - 1] = lMessageLength >>> 29;\n//   return lWordArray;\n// }\n\nfunction wordToHex(lValue) {\n  let wordToHexValue='';\n\n\n  let wordToHexValue_temp='';\n\n\n  let lByte;\n  let lCount;\n  for (lCount = 0; lCount<=3; lCount++) {\n    lByte = (lValue>>>(lCount*8)) & 255;\n    wordToHexValue_temp = `0${lByte.toString(16)}`;\n    wordToHexValue +=\n      wordToHexValue_temp.substr(wordToHexValue_temp.length-2,2);\n  }\n  return wordToHexValue;\n}\n\n// string can either be a string, node.js Buffer, array (of numbers < 256)\n// or a typed array\nmodule.exports = function md5(string) {\n  let AA;\n  let BB;\n  let CC;\n  let DD;\n  let a;\n  let b;\n  let c;\n  let d;\n  let k;\n  let S11=7;\n  let S12=12;\n  let S13=17;\n  let S14=22;\n  let S21=5;\n  let S22=9;\n  let S23=14;\n  let S24=20;\n  let S31=4;\n  let S32=11;\n  let S33=16;\n  let S34=23;\n  let S41=6;\n  let S42=10;\n  let S43=15;\n  let S44=21;\n\n  let x;\n  if (typeof string === 'string') {\n    string = stringUtf8Encode(string);\n    x = convertToWordArray(string);\n  } else {\n    assert(false); // disable due to not used\n    // node.js buffer or Array\n    // x = convertByteArraytoWordArray(string);\n  }\n\n  a = 0x67452301;\n  b = 0xEFCDAB89;\n  c = 0x98BADCFE;\n  d = 0x10325476;\n\n  for (k=0; k<x.length; k+=16) {\n    AA=a;\n    BB=b;\n    CC=c;\n    DD=d;\n    a=FF(a,b,c,d,x[k], S11,0xD76AA478);\n    d=FF(d,a,b,c,x[k+1], S12,0xE8C7B756);\n    c=FF(c,d,a,b,x[k+2], S13,0x242070DB);\n    b=FF(b,c,d,a,x[k+3], S14,0xC1BDCEEE);\n    a=FF(a,b,c,d,x[k+4], S11,0xF57C0FAF);\n    d=FF(d,a,b,c,x[k+5], S12,0x4787C62A);\n    c=FF(c,d,a,b,x[k+6], S13,0xA8304613);\n    b=FF(b,c,d,a,x[k+7], S14,0xFD469501);\n    a=FF(a,b,c,d,x[k+8], S11,0x698098D8);\n    d=FF(d,a,b,c,x[k+9], S12,0x8B44F7AF);\n    c=FF(c,d,a,b,x[k+10],S13,0xFFFF5BB1);\n    b=FF(b,c,d,a,x[k+11],S14,0x895CD7BE);\n    a=FF(a,b,c,d,x[k+12],S11,0x6B901122);\n    d=FF(d,a,b,c,x[k+13],S12,0xFD987193);\n    c=FF(c,d,a,b,x[k+14],S13,0xA679438E);\n    b=FF(b,c,d,a,x[k+15],S14,0x49B40821);\n    a=GG(a,b,c,d,x[k+1], S21,0xF61E2562);\n    d=GG(d,a,b,c,x[k+6], S22,0xC040B340);\n    c=GG(c,d,a,b,x[k+11],S23,0x265E5A51);\n    b=GG(b,c,d,a,x[k], S24,0xE9B6C7AA);\n    a=GG(a,b,c,d,x[k+5], S21,0xD62F105D);\n    d=GG(d,a,b,c,x[k+10],S22,0x2441453);\n    c=GG(c,d,a,b,x[k+15],S23,0xD8A1E681);\n    b=GG(b,c,d,a,x[k+4], S24,0xE7D3FBC8);\n    a=GG(a,b,c,d,x[k+9], S21,0x21E1CDE6);\n    d=GG(d,a,b,c,x[k+14],S22,0xC33707D6);\n    c=GG(c,d,a,b,x[k+3], S23,0xF4D50D87);\n    b=GG(b,c,d,a,x[k+8], S24,0x455A14ED);\n    a=GG(a,b,c,d,x[k+13],S21,0xA9E3E905);\n    d=GG(d,a,b,c,x[k+2], S22,0xFCEFA3F8);\n    c=GG(c,d,a,b,x[k+7], S23,0x676F02D9);\n    b=GG(b,c,d,a,x[k+12],S24,0x8D2A4C8A);\n    a=HH(a,b,c,d,x[k+5], S31,0xFFFA3942);\n    d=HH(d,a,b,c,x[k+8], S32,0x8771F681);\n    c=HH(c,d,a,b,x[k+11],S33,0x6D9D6122);\n    b=HH(b,c,d,a,x[k+14],S34,0xFDE5380C);\n    a=HH(a,b,c,d,x[k+1], S31,0xA4BEEA44);\n    d=HH(d,a,b,c,x[k+4], S32,0x4BDECFA9);\n    c=HH(c,d,a,b,x[k+7], S33,0xF6BB4B60);\n    b=HH(b,c,d,a,x[k+10],S34,0xBEBFBC70);\n    a=HH(a,b,c,d,x[k+13],S31,0x289B7EC6);\n    d=HH(d,a,b,c,x[k], S32,0xEAA127FA);\n    c=HH(c,d,a,b,x[k+3], S33,0xD4EF3085);\n    b=HH(b,c,d,a,x[k+6], S34,0x4881D05);\n    a=HH(a,b,c,d,x[k+9], S31,0xD9D4D039);\n    d=HH(d,a,b,c,x[k+12],S32,0xE6DB99E5);\n    c=HH(c,d,a,b,x[k+15],S33,0x1FA27CF8);\n    b=HH(b,c,d,a,x[k+2], S34,0xC4AC5665);\n    a=II(a,b,c,d,x[k], S41,0xF4292244);\n    d=II(d,a,b,c,x[k+7], S42,0x432AFF97);\n    c=II(c,d,a,b,x[k+14],S43,0xAB9423A7);\n    b=II(b,c,d,a,x[k+5], S44,0xFC93A039);\n    a=II(a,b,c,d,x[k+12],S41,0x655B59C3);\n    d=II(d,a,b,c,x[k+3], S42,0x8F0CCC92);\n    c=II(c,d,a,b,x[k+10],S43,0xFFEFF47D);\n    b=II(b,c,d,a,x[k+1], S44,0x85845DD1);\n    a=II(a,b,c,d,x[k+8], S41,0x6FA87E4F);\n    d=II(d,a,b,c,x[k+15],S42,0xFE2CE6E0);\n    c=II(c,d,a,b,x[k+6], S43,0xA3014314);\n    b=II(b,c,d,a,x[k+13],S44,0x4E0811A1);\n    a=II(a,b,c,d,x[k+4], S41,0xF7537E82);\n    d=II(d,a,b,c,x[k+11],S42,0xBD3AF235);\n    c=II(c,d,a,b,x[k+2], S43,0x2AD7D2BB);\n    b=II(b,c,d,a,x[k+9], S44,0xEB86D391);\n    a=addUnsigned(a,AA);\n    b=addUnsigned(b,BB);\n    c=addUnsigned(c,CC);\n    d=addUnsigned(d,DD);\n  }\n\n  let temp = wordToHex(a)+wordToHex(b)+wordToHex(c)+wordToHex(d);\n  return temp.toLowerCase();\n};\n\n/* // Uncomment this and run \"node MD5.js file.ext\"\nvar FS = require('fs');\nvar data = FS.readFileSync(process.argv[2]);\nvar md5 = module.exports(data);\nconsole.log('MD5 = ' + md5);\n// */\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n// Some code derived from libGLOV (C++), also MIT Licensed\n\n/* eslint no-bitwise:off */\n\n// Upon read, throw an exception if there is any data read error (e.g. read off of end of packet)\n\n// TODO: Maybe: Have 2 offsets, one for writing (data_len?), one for reading (buf_offs?),\n//   then there should be many fewer ?pak.readable branches\n//   that return different values under different circumstances, and maybe fewer .makeReadable() calls needed.\n\n\n// 3 bits of flags reserved for internal use\nconst PACKET_DEBUG = exports.PACKET_DEBUG = 1<<0;\nconst PACKET_RESERVED1 = exports.PACKET_RESERVED1 = 1<<1;\nconst PACKET_RESERVED2 = exports.PACKET_RESERVED2 = 1<<2;\nconst FLAG_PACKET_INTERNAL = PACKET_DEBUG | PACKET_RESERVED1 | PACKET_RESERVED2;\n\n// Internal, runtime-only (not serialized) flags < 8 bits\nconst PACKET_UNOWNED_BUFFER = 1 << 8;\n\n/* eslint-disable import/order */\nconst assert = require('assert');\nconst { max } = Math;\nconst { deprecate, isInteger, log2 } = require('./util.js');\n// const { isInteger, log2 } = require('../../build.dev/common/glov/util.js');\nconst { base64Encode, base64Decode } = require('./base64.js');\n\ndeprecate(exports, 'default_flags');\n\nconst FALSYS = [undefined, null, 0, false, '', NaN];\nconst PAK_BUF_DEFAULT_SIZE = 1024;\n\nconst UNDERRUN = 'PKTERR_UNDERRUN';\n\nconst POOL_PACKETS = 5000;\nconst POOL_TIMEOUT = 5000;\nconst POOL_BUF_BY_SIZE = [\n  0, // 2^0 : 1 - shouldn't be allocated ever?\n  10, // 2^1 : 2\n  10, // 2^2 : 4\n  20, // 2^3 : 8\n  20, // 2^4 : 16\n  20, // 2^5 : 32\n  20, // 2^6 : 64\n  20, // 2^7 : 128\n  20, // 2^8 : 256\n  20, // 2^9 : 512\n  5000, // 2^10 : 1024 - standard Packet size\n  20, // 2^11 : 2048\n  20, // 2^12 : 4096\n  20, // 2^13 : 8192\n  20, // 2^14 : 16384\n  20, // 2^15 : 32768\n  20, // 2^16 : 65536\n  10, // 2^17 : 131072\n  10, // 2^18 : 262144,\n];\n\nlet pak_pool = [];\nlet pak_debug_pool = [];\nlet buf_pool = POOL_BUF_BY_SIZE.map(() => []);\n\nfunction allocDataView(size) {\n  let pool_idx = log2(size);\n  assert(pool_idx);\n  if (pool_idx >= buf_pool.length) {\n    pool_idx = 0;\n  }\n  if (pool_idx) {\n    size = 1 << pool_idx;\n    if (buf_pool[pool_idx].length) {\n      // No reinit here, just a container\n      //console.log(`Buffer FROMPOOL:${size}/${pool_idx}`);\n      return buf_pool[pool_idx].pop();\n    }\n  } else {\n    // Enable this (and lower pool size) to track down big packets:\n    // console.log(`Allocating UNPOOLABLE buffer of size ${size} from ${new Error().stack}`);\n  }\n  //console.log(`Buffer ALLOC:${size}`);\n  let u8 = new Uint8Array(size);\n  let dv = new DataView(u8.buffer);\n  dv.u8 = u8;\n  if (pool_idx) {\n    dv.packet_pool_idx = pool_idx;\n  }\n  return dv;\n}\n\nfunction wrapU8AsDataView(u8) {\n  let dv = new DataView(u8.buffer, u8.byteOffset, u8.byteLength);\n  dv.u8 = u8;\n  return dv;\n}\n\nfunction utf8ByteLength(str) {\n  let len = str.length;\n  let ret = len;\n  for (let ii = 0; ii < len; ++ii) {\n    let c = str.charCodeAt(ii);\n    if (c > 0x7F) {\n      ++ret;\n      if (c > 0x07FF) {\n        ++ret;\n        if (c > 0xFFFF) {\n          ++ret;\n          if (c > 0x1FFFFF) {\n            ++ret;\n            if (c > 0x3FFFFFF) {\n              ++ret;\n            }\n          }\n        }\n      }\n    }\n  }\n  return ret;\n}\n\n// Assumes buffer will fit it\nfunction utf8WriteChar(buf, buf_offs, c) {\n  if (c > 0x10FFFF) {\n    // Limit to Unicode max code point. Note that this function currently\n    //   receives character codes, not code points, so will not actually\n    //   ever receive a value over 0xFFFF since JavaScript uses UTF-16\n    //   character codes.  See note on writeString below.\n    c = 0xFFFF;\n  }\n  if (c <= 0x7F) {\n    buf.u8[buf_offs++] = c;\n  } else if (c <= 0x07FF) {\n    buf.u8[buf_offs++] = (c >> 6) | 0xC0;\n    buf.u8[buf_offs++] = (c & 0x3F) | 0x80;\n  } else if (c <= 0xFFFF) {\n    buf.u8[buf_offs++] = (c >> 12) | 0xE0;\n    buf.u8[buf_offs++] = ((c >> 6) & 0x3F) | 0x80;\n    buf.u8[buf_offs++] = (c & 0x3F) | 0x80;\n  } else if (c <= 0x10FFFF) { // Note: technically can fit up to 0x1FFFFF here, but those code points are disallowed\n    buf.u8[buf_offs++] = (c >> 18) | 0xF0;\n    buf.u8[buf_offs++] = ((c >> 12) & 0x3F) | 0x80;\n    buf.u8[buf_offs++] = ((c >> 6) & 0x3F) | 0x80;\n    buf.u8[buf_offs++] = (c & 0x3F) | 0x80;\n  } else {\n    assert(false);\n  }\n  return buf_offs;\n}\n\nfunction poolBuf(dv) {\n  // if it's poolable (not part of another Buffer), pool it!\n  assert(dv);\n  assert(dv.u8);\n  let pool_idx = dv.packet_pool_idx;\n  if (pool_idx) {\n    let arr = buf_pool[pool_idx];\n    if (arr.length < POOL_BUF_BY_SIZE[pool_idx]) {\n      //console.log(`Buffer TOPOOL:${dv.byteLength}/${pool_idx}`);\n      arr.push(dv);\n    }\n  } else {\n    // console.log(`Buffer UNPOOLABLE:${dv.byteLength}`);\n  }\n}\n\nexport function packetBufPoolAlloc(size) {\n  return allocDataView(size);\n}\nexport function packetBufPoolFree(dv) {\n  poolBuf(dv);\n}\n\n\nlet default_flags = 0;\nexport function packetDefaultFlags() {\n  return default_flags;\n}\n\nexport function packetEnableDebug(enable) {\n  if (enable) {\n    default_flags |= PACKET_DEBUG;\n  }\n}\n\nfunction Packet(flags, init_size, pak_debug) {\n  this.reinit(flags, init_size, pak_debug);\n}\nPacket.prototype.reinit = function (flags, init_size, pak_debug) {\n  this.flags = flags || 0;\n  this.has_flags = false;\n  this.buf = null;\n  this.buf_len = 0;\n  this.buf_offs = 0;\n  this.bufs = null;\n  this.bsizes = null;\n  this.readable = false;\n  this.ref_count = 1;\n  this.pak_debug = pak_debug;\n  if (init_size) {\n    this.fit(init_size, true);\n    this.buf_len = init_size;\n  }\n};\nPacket.prototype.getRefCount = function () {\n  return this.ref_count;\n};\nPacket.prototype.ref = function () {\n  assert(this.ref_count); // must not already be pooled!\n  ++this.ref_count;\n};\nPacket.prototype.pool = function () {\n  assert(this.ref_count);\n  if (--this.ref_count) {\n    return;\n  }\n  // Do not clear on pool(), callers (readInt()) may still momentarily reference .buf, etc\n  if (this.flags & PACKET_UNOWNED_BUFFER) {\n    // doing nothing with buffers, still pooling the packet\n  } else {\n    if (this.buf) {\n      poolBuf(this.buf);\n    }\n    if (this.bufs) {\n      for (let ii = 0; ii < this.bufs.length; ++ii) {\n        poolBuf(this.bufs[ii]);\n      }\n    }\n  }\n  if (pak_pool.length < POOL_PACKETS) {\n    pak_pool.push(this);\n  }\n  if (this.pak_debug) {\n    this.pak_debug.poolDebug();\n  }\n};\n\nPacket.prototype.totalSize = function () {\n  let ret = 0;\n  if (this.readable) {\n    return this.buf_len;\n  }\n  if (this.bsizes) {\n    for (let ii = 0; ii < this.bsizes.length; ++ii) {\n      ret += this.bsizes[ii];\n    }\n  }\n  ret += this.buf_offs;\n  return ret;\n};\n\nPacket.prototype.setReadable = function () {\n  assert(this.buf);\n  assert(!this.bufs);\n  assert(!this.readable);\n  this.readable = true;\n};\n\nPacket.prototype.makeReadable = function () {\n  assert(this.buf);\n  assert(!this.readable); // otherwise just reset offset? or do nothing?\n  let total = this.totalSize(); // before this.readable = true\n  this.readable = true;\n  if (!this.bufs) {\n    this.buf_len = total;\n    this.buf_offs = 0;\n    return;\n  }\n  let buf = allocDataView(total);\n  let u8 = buf.u8;\n  let offs = 0;\n  for (let ii = 0; ii < this.bufs.length; ++ii) {\n    let bsize = this.bsizes[ii];\n    let dv = this.bufs[ii];\n    if (offs + dv.u8.length > total) {\n      // unused portion would overrun\n      assert.equal(dv.byteOffset, 0);\n      u8.set(new Uint8Array(dv.buffer, 0, bsize), offs);\n    } else {\n      u8.set(dv.u8, offs);\n    }\n    offs += bsize;\n    poolBuf(dv);\n  }\n  assert.equal(this.buf.byteOffset, 0); // Would handle it, but should never happen here, these are our pooled buffers?\n  u8.set(new Uint8Array(this.buf.buffer, this.buf.byteOffset, this.buf_offs), offs);\n  poolBuf(this.buf);\n  assert.equal(offs + this.buf_offs, total);\n  this.bufs = this.bsizes = null;\n  this.buf = buf;\n  this.buf_offs = 0;\n  this.buf_len = total; // buffer is actually buf.buffer.byteLength, but we can't read past `total`\n};\n\nPacket.prototype.flush = function () {\n  let { buf, buf_offs } = this;\n  if (!this.bufs) {\n    this.bufs = [buf];\n    this.bsizes = [buf_offs];\n  } else {\n    this.bufs.push(buf);\n    this.bsizes.push(buf_offs);\n  }\n  this.buf = null;\n  this.buf_len = 0;\n  this.buf_offs = 0;\n};\nPacket.prototype.fit = function (extra_bytes, no_advance) {\n  let { buf, buf_len, buf_offs } = this;\n  let new_offs = buf_offs + extra_bytes;\n  if (new_offs <= buf_len) {\n    if (!no_advance) {\n      this.buf_offs = new_offs;\n    }\n    return buf_offs;\n  }\n  assert(!this.readable); // Shouldn't happen on concatenated buffers\n  if (buf) {\n    this.flush();\n  }\n  this.buf_len = buf_len = max(PAK_BUF_DEFAULT_SIZE, extra_bytes);\n  this.buf = allocDataView(buf_len);\n  this.buf_offs = no_advance ? 0 : extra_bytes;\n  return 0;\n};\nPacket.prototype.advance = function (bytes) {\n  let offs = this.buf_offs;\n  let new_offs = offs + bytes;\n  this.buf_offs = new_offs;\n  if (new_offs > this.buf_len) {\n    throw new Error(UNDERRUN);\n  }\n  if (new_offs === this.buf_len) {\n    this.pool();\n  }\n  return offs;\n};\nPacket.prototype.ended = function () {\n  return this.buf_offs === this.buf_len;\n};\n\n// low-level write/read functions\nPacket.prototype.writeU8 = function (v) {\n  assert(v >= 0 && v < 256);\n  let offs = this.fit(1);\n  this.buf.u8[offs] = v;\n};\nPacket.prototype.readU8 = function () {\n  return this.buf.u8[this.advance(1)];\n};\n// Packed int, first byte:\n// 0-247 byte\n// 248 positive 16-bit\n// 249 negative 16-bit\n// 250 positive 32-bit\n// 251 negative 32-bit\n// 252 positive 64-bit\n// 253 negative 64-bit\n// 254 unused\n// 255 negative byte\nPacket.prototype.writeInt = function (v) {\n  assert(isInteger(v));\n  let offs = this.fit(9, true); // 9 is max size of a packed int\n  let buf = this.buf;\n  let neg = (v < 0) ? 1 : 0;\n  if (neg) {\n    v = -v;\n  }\n  if (v < 248) { // || neg && v < 256 would also decode right\n    if (neg) {\n      buf.u8[offs++] = 255;\n    }\n    buf.u8[offs++] = v;\n  } else {\n    if (v < 65536) {\n      buf.u8[offs++] = 248 + neg;\n      buf.setUint16(offs, v, true);\n      offs += 2;\n    } else if (v < 4294967296) {\n      buf.u8[offs++] = 250 + neg;\n      buf.setUint32(offs, v, true);\n      offs += 4;\n    } else {\n      buf.u8[offs++] = 252 + neg;\n      let low_bits = v >>> 0;\n      buf.setUint32(offs, low_bits, true);\n      offs += 4;\n      buf.setUint32(offs, (v - low_bits) / 4294967296, true);\n      offs += 4;\n    }\n  }\n  this.buf_offs = offs;\n};\nPacket.prototype.zeroInt = function () {\n  // Overwrite an existing int with a zero, keeping the same packed size\n  let b1 = this.buf.u8[this.buf_offs];\n  if (b1 < 248) {\n    this.buf.u8[this.buf_offs++] = 0;\n    return;\n  }\n  // Otherwise, leave header bit\n  this.buf_offs++;\n  let zeroes;\n  switch (b1) {\n    case 253:\n    case 252:\n      zeroes = 8;\n      break;\n    case 251:\n    case 250:\n      zeroes = 4;\n      break;\n    case 249:\n    case 248:\n      zeroes = 2;\n      break;\n    case 255:\n      zeroes = 1;\n      break;\n    default:\n      throw new Error('PKTERR_PACKED_INT');\n  }\n  while (zeroes) {\n    --zeroes;\n    this.buf.u8[this.buf_offs++] = 0;\n  }\n};\nPacket.prototype.readInt = function () {\n  let b1 = this.buf.u8[this.advance(1)];\n  if (b1 < 248) {\n    return b1;\n  }\n  let sign = 1;\n  switch (b1) {\n    case 249:\n      sign = -1;\n    case 248: // eslint-disable-line no-fallthrough\n      return sign * this.buf.getUint16(this.advance(2), true);\n    case 251:\n      sign = -1;\n    case 250: // eslint-disable-line no-fallthrough\n      return sign * this.buf.getUint32(this.advance(4), true);\n    case 253:\n      sign = -1;\n    case 252: { // eslint-disable-line no-fallthrough\n      let low_bits = this.buf.getUint32(this.advance(4), true);\n      let high_bits = this.buf.getUint32(this.advance(4), true);\n      return sign * (high_bits * 4294967296 + low_bits);\n    }\n    case 255:\n      return -this.buf.u8[this.advance(1)];\n    default:\n      throw new Error('PKTERR_PACKED_INT');\n  }\n};\nPacket.prototype.writeFloat = function (v) {\n  assert.equal(typeof v, 'number');\n  if (!v) {\n    this.buf.u8[this.fit(1)] = 0;\n    return;\n  }\n  let offs = this.fit(5, true);\n  this.buf.setFloat32(offs, v, true);\n  if (this.buf.u8[offs] <= 1) { // escape a 0 or 1 in the first byte\n    this.buf.u8[offs++] = 1;\n    this.buf.setFloat32(offs, v, true);\n  }\n  this.buf_offs = offs + 4;\n};\nPacket.prototype.readFloat = function () {\n  let offs = this.advance(1);\n  let b1 = this.buf.u8[offs];\n  if (!b1) {\n    return 0;\n  }\n  if (b1 === 1) {\n    return this.buf.getFloat32(this.advance(4), true);\n  }\n  this.advance(3);\n  return this.buf.getFloat32(offs, true);\n};\nPacket.prototype.writeU32 = function (v) {\n  assert.equal(typeof v, 'number');\n  this.buf.setUint32(this.fit(4), v, true);\n};\nPacket.prototype.readU32 = function () {\n  return this.buf.getUint32(this.advance(4), true);\n};\n// Note this is not quite serializing the same as UTF-8 when dealing with surrogate\n//   pairs, such as code point U+1F303 which is represented by character codes\n//   0xD83C, 0xDF03, and would technically be <f0 9f 8c 83> in UTF-8, but we\n//   serialize as two separate characters.  When deserialized in the same way,\n//   this reconstructs the same original string, without losing the ability to\n//   serialize some otherwise valid JavaScript strings (e.g. just one char\n//   code 0xD83C) like with Node.js's Buffer's utf8 implementation.\nPacket.prototype.writeString = function (v) {\n  assert.equal(typeof v, 'string'); // Could maybe do a toString() here if not\n  let byte_length = utf8ByteLength(v);\n  this.writeInt(byte_length); // Just 1 byte for small strings\n  if (!byte_length) {\n    return;\n  }\n  let offs = this.fit(byte_length);\n  let buf = this.buf;\n  for (let ii = 0; ii < v.length; ++ii) {\n    let c = v.charCodeAt(ii);\n    if (c <= 0x7F) {\n      buf.u8[offs++] = c;\n    } else {\n      offs = utf8WriteChar(buf, offs, c);\n    }\n  }\n};\n// Only called on multi-byte characters; Supplied the first byte for efficiency\nPacket.prototype.utf8ReadChar = function (c) {\n  let buf = this.buf;\n  if (c >= 0xC0 && c < 0xE0) {\n    return ((c & 0x1F) << 6) |\n      (buf.u8[this.buf_offs++] & 0x3F);\n  } else if (c >= 0xE0 && c < 0xF0) {\n    return ((c & 0x0F) << 12) |\n      ((buf.u8[this.buf_offs++] & 0x3F) << 6) |\n      (buf.u8[this.buf_offs++] & 0x3F);\n  } else if (c >= 0xF0 && c < 0xF8) {\n    return ((c & 0x0F) << 18) |\n      ((buf.u8[this.buf_offs++] & 0x3F) << 12) |\n      ((buf.u8[this.buf_offs++] & 0x3F) << 6) |\n      (buf.u8[this.buf_offs++] & 0x3F);\n  } else { // c >= 0x80 & c < 0xC0 or c >= 0xF8\n    // Illegal continuation character, or old-spec 5-byte/6-byte UTF-8 encoding\n    //   Regardless, was not generated by our utf8WriteChar().\n    return 0xFFFD;\n  }\n};\n\nlet string_assembly = [];\nPacket.prototype.readString = function () {\n  let byte_length = this.readInt();\n  if (!byte_length) {\n    return '';\n  }\n  if (this.buf_offs + byte_length > this.buf_len) {\n    throw new Error(UNDERRUN);\n  }\n\n  let { buf } = this;\n  let end_offset = this.buf_offs + byte_length;\n  let ret;\n  if (byte_length > 8192) {\n    ret = '';\n    while (this.buf_offs < end_offset) {\n      let c = buf.u8[this.buf_offs++];\n      if (c > 0x7F) {\n        c = this.utf8ReadChar(c);\n      }\n      ret += String.fromCharCode(c);\n    }\n  } else {\n    string_assembly.length = byte_length;\n    let ii = 0;\n    while (this.buf_offs < end_offset) {\n      let c = buf.u8[this.buf_offs++];\n      if (c > 0x7F) {\n        c = this.utf8ReadChar(c);\n      }\n      string_assembly[ii++] = c;\n    }\n    if (string_assembly.length !== ii) {\n      // truncate if multi-byte UTF8 produced single characters\n      string_assembly.length = ii;\n    }\n    ret = String.fromCharCode.apply(undefined, string_assembly);\n  }\n  if (this.buf_offs === this.buf_len) {\n    this.pool();\n  }\n  return ret;\n};\n// Much more efficient than writeString if the input is known to be ANSI-ish (all characters <= 255)\nPacket.prototype.writeAnsiString = function (v) {\n  assert.equal(typeof v, 'string'); // Could maybe do a toString() here if not\n  let byte_length = v.length;\n  this.writeInt(byte_length);\n  let offs = this.fit(byte_length);\n  let { buf } = this;\n  for (let ii = 0; ii < byte_length; ++ii) {\n    buf.u8[offs++] = v.charCodeAt(ii);\n  }\n};\nPacket.prototype.readAnsiString = function () {\n  let len = this.readInt();\n  if (!len) {\n    return '';\n  }\n  let offs = this.advance(len);\n  let { buf } = this;\n  string_assembly.length = len;\n  for (let ii = 0; ii < len; ++ii) {\n    string_assembly[ii] = buf.u8[offs++];\n  }\n  return String.fromCharCode.apply(undefined, string_assembly);\n};\n\n// high-level write/read functions\nPacket.prototype.writeJSON = function (v) {\n  if (!v) {\n    let idx = FALSYS.indexOf(v);\n    assert(idx !== -1);\n    this.writeU8(idx + 1);\n    return;\n  }\n  this.writeU8(0);\n  this.writeString(JSON.stringify(v));\n};\nPacket.prototype.readJSON = function () {\n  let byte = this.readU8();\n  if (byte) {\n    if (byte - 1 >= FALSYS.length) {\n      throw new Error('PKTERR_JSON_HEADER');\n    }\n    return FALSYS[byte - 1];\n  }\n  let str = this.readString();\n  return JSON.parse(str);\n};\n// Uint8Array or Buffer object?\nPacket.prototype.writeBuffer = function (v) {\n  this.writeInt(v.length);\n  if (v.length) {\n    let offs = this.fit(v.length);\n    this.buf.u8.set(v, offs);\n  }\n};\nconst null_buf = new Uint8Array(0);\nPacket.prototype.readBuffer = function (do_copy) {\n  let len = this.readInt();\n  if (!len) {\n    return null_buf;\n  }\n  let offs = this.advance(len);\n  if (do_copy) {\n    return this.buf.u8.slice(offs, offs + len);\n  } else {\n    let { buf } = this;\n    return new Uint8Array(buf.buffer, buf.byteOffset + offs, len);\n  }\n};\nPacket.prototype.writeBool = function (v) {\n  this.writeU8(v?1:0);\n};\nPacket.prototype.readBool = function () {\n  return Boolean(this.readU8());\n};\n\nPacket.prototype.append = function (pak) {\n  assert.equal(this.flags & FLAG_PACKET_INTERNAL, pak.flags & FLAG_PACKET_INTERNAL);\n  if (pak.bufs) {\n    for (let ii = 0; ii < pak.bufs.length; ++ii) {\n      let buf = pak.bufs[ii];\n      let bsize = pak.bsizes[ii];\n      let offs = this.fit(bsize);\n      if (bsize !== buf.byteLength) {\n        this.buf.u8.set(new Uint8Array(buf.buffer, buf.byteOffset, bsize), offs);\n      } else {\n        this.buf.u8.set(buf.u8, offs);\n      }\n    }\n  }\n  if (pak.buf) {\n    let buf = pak.buf;\n    let bsize = pak.readable ? pak.buf_len : pak.buf_offs;\n    let offs = this.fit(bsize);\n    if (bsize !== buf.byteLength) {\n      this.buf.u8.set(new Uint8Array(buf.buffer, buf.byteOffset, bsize), offs);\n    } else {\n      this.buf.u8.set(buf.u8, offs);\n    }\n  }\n};\n\nPacket.prototype.appendRemaining = function (pak) {\n  assert.equal(this.flags & FLAG_PACKET_INTERNAL, pak.flags & FLAG_PACKET_INTERNAL);\n  assert(pak.readable);\n  assert(!pak.bufs);\n  assert(pak.buf);\n  assert(pak.buf_offs <= pak.buf_len);\n  let bsize = pak.buf_len - pak.buf_offs;\n  if (bsize) {\n    let offs = this.fit(bsize);\n    this.buf.u8.set(new Uint8Array(pak.buf.buffer, pak.buf.byteOffset + pak.buf_offs, bsize), offs);\n  }\n  // everything consumed, pool it\n  pak.pool();\n};\n\nPacket.prototype.toJSON = function () {\n  let ret = {\n    f: this.flags,\n  };\n\n  if (this.bufs) {\n    ret.b = [];\n    for (let ii = 0; ii < this.bufs.length; ++ii) {\n      ret.b.push(base64Encode(this.bufs[ii], 0, this.bsizes[ii]));\n    }\n  }\n  if (this.buf) {\n    if (this.readable) {\n      ret.d = base64Encode(this.buf, 0, this.buf_len);\n    } else {\n      ret.d = base64Encode(this.buf, 0, this.buf_offs);\n    }\n  }\n  return ret;\n};\n\nPacket.prototype.setBuffer = function (buf, buf_len) {\n  assert(!this.buf);\n  assert(!this.bufs);\n  assert(this.flags & PACKET_UNOWNED_BUFFER); // Probably okay if not?\n  assert(buf instanceof Uint8Array);\n  this.buf = wrapU8AsDataView(buf);\n  this.buf_len = buf_len;\n  this.readable = true;\n};\n\nPacket.prototype.getBuffer = function () {\n  assert(this.buf);\n  assert(!this.bufs);\n  return this.buf.u8;\n};\n\nPacket.prototype.getBufferLen = function () {\n  assert(this.buf);\n  assert(!this.bufs);\n  return this.readable ? this.buf_len : this.buf_offs;\n};\n\nPacket.prototype.getOffset = function () {\n  if (this.readable) {\n    return this.buf_offs;\n  }\n  return this.totalSize();\n};\n\nPacket.prototype.seek = function (pos) {\n  assert(this.readable); // .makeReadable should be called so that it is a single buffer\n  assert(pos >= 0 && pos <= this.buf_len);\n  this.buf_offs = pos;\n};\n\nPacket.prototype.writeFlags = function () {\n  assert(!this.has_flags);\n  assert.equal(this.buf_offs, 0);\n  this.writeU8(this.flags);\n  this.has_flags = true;\n};\n\nPacket.prototype.updateFlags = function (flags) {\n  assert(this.has_flags);\n  assert(!(flags & FLAG_PACKET_INTERNAL));\n  this.flags = this.flags & FLAG_PACKET_INTERNAL | flags;\n  let buf = this.bufs ? this.bufs[0] : this.buf;\n  buf.u8[0] = this.flags;\n};\n\nPacket.prototype.readFlags = function () {\n  let read = this.readU8();\n  assert.equal(read, this.flags & 0xFF);\n  this.has_flags = true;\n  return this.flags;\n};\n\nPacket.prototype.getFlags = function () {\n  return this.flags;\n};\n\nPacket.prototype.getInternalFlags = function () {\n  return this.flags & FLAG_PACKET_INTERNAL;\n};\n\nPacket.prototype.contents = function () {\n  return `pak(${this.totalSize()}b)`;\n};\n\nfunction PacketDebug(flags, init_size) {\n  this.reinit(flags, init_size);\n}\nPacketDebug.prototype.reinit = function (flags, init_size) {\n  this.in_pool = false;\n  if (pak_pool.length) {\n    this.pak = pak_pool.pop();\n    this.pak.reinit(flags, init_size, this);\n  } else {\n    this.pak = new Packet(flags, init_size, this);\n  }\n  this.warned = false;\n  this.pool_timer = setTimeout(() => {\n    console.warn(`Packet not pooled after 5s: ${this.contents()}`);\n    this.warned = true;\n  }, POOL_TIMEOUT);\n};\nPacketDebug.prototype.poolDebug = function () {\n  if (this.warned) {\n    console.warn('Packet pooled after timeout');\n  } else {\n    clearTimeout(this.pool_timer);\n  }\n  assert(!this.in_pool);\n  this.in_pool = true; // Set this, as if pooled, even if discarded\n  if (pak_debug_pool.length < POOL_PACKETS) {\n    pak_debug_pool.push(this);\n  }\n};\nconst types = [null, 'U8', 'U32', 'Int', 'Float', 'String', 'AnsiString', 'JSON', 'Bool', 'Buffer'];\n// Functions (types) that read and write a debug byte\ntypes.forEach((type, idx) => {\n  if (!type) { // don't use debug ID 0\n    return;\n  }\n  let write = `write${type}`;\n  let read = `read${type}`;\n  let write_fn = Packet.prototype[write];\n  let read_fn = Packet.prototype[read];\n  PacketDebug.prototype[write] = function (v) {\n    this.pak.writeU8(idx);\n    write_fn.call(this.pak, v);\n  };\n  PacketDebug.prototype[read] = function (param) {\n    let found_idx = this.pak.readU8();\n    if (found_idx !== idx) {\n      assert(false, `PacketDebug error: Expected ${type}(${idx}), found ${types[found_idx]}(${found_idx})`);\n    }\n    return read_fn.call(this.pak, param);\n  };\n});\nPacketDebug.prototype.zeroInt = function () {\n  this.pak.writeU8(3); // types.indexof('Int')\n  this.pak.zeroInt();\n};\n// Functions that simply fall through\n[\n  'ended',\n  'getBuffer',\n  'getBufferLen',\n  'getFlags',\n  'getInternalFlags',\n  'getOffset',\n  'getRefCount',\n  'makeReadable',\n  'pool',\n  'readFlags', // *not* wrapped in debug headers\n  'ref',\n  'seek',\n  'setBuffer',\n  'setReadable',\n  'toJSON',\n  'totalSize',\n  'updateFlags',\n  'writeFlags', // *not* wrapped in debug headers\n].forEach((fname) => {\n  let fn = Packet.prototype[fname];\n  PacketDebug.prototype[fname] = function () {\n    return fn.apply(this.pak, arguments); // eslint-disable-line prefer-rest-params\n  };\n});\nPacketDebug.prototype.append = function (pak) {\n  assert(pak instanceof PacketDebug);\n  this.pak.append(pak.pak);\n};\nPacketDebug.prototype.appendRemaining = function (pak) {\n  assert(pak instanceof PacketDebug);\n  this.pak.appendRemaining(pak.pak);\n};\nfunction format(v) {\n  switch (typeof v) {\n    case 'object':\n      if (v instanceof Uint8Array) {\n        return `u8<${v.length}>`;\n      }\n      return JSON.stringify(v);\n    default:\n      return v;\n  }\n}\nPacketDebug.prototype.contents = function () {\n  let { pak } = this;\n  let cur_offs = pak.getOffset();\n  let read_len = cur_offs;\n  let ret = [`buf:${pak.buf_offs}/${pak.buf_len}`];\n  if (pak.bufs) {\n    // write packet, just combine and reset location when done\n    pak.makeReadable();\n    ret.push('bufs');\n  } else if (pak.buf) {\n    // read packet, or write packet that is a single buf\n    if (pak.readable) {\n      read_len = pak.buf_len;\n    }\n    pak.buf_offs = 0;\n  } else {\n    ret.push('empty');\n    read_len = -1;\n  }\n  let saved_ref_count = pak.ref_count;\n  pak.ref_count = 2; // prevent auto pooling, don't assert on ref() if unref'd.\n  try {\n    if (!saved_ref_count) {\n      ret.push('!ref_count=0!');\n    }\n    if (pak.has_flags) {\n      ret.push(`flags:${pak.readU8()}`);\n    }\n    while (pak.buf_offs < read_len) {\n      let type_idx = pak.readU8();\n      let type = types[type_idx];\n      if (!type) {\n        ret.push(`UnknownType:${type_idx}`);\n        break;\n      }\n      let val = pak[`read${type}`]();\n      ret.push(`${type}:${format(val)}`);\n    }\n  } catch (e) {\n    ret.push(`Error dumping packet contents: ${e}`);\n  }\n  pak.ref_count = saved_ref_count;\n  pak.buf_offs = cur_offs;\n  return ret.join(',');\n};\n\nfunction packetCreate(flags, init_size) {\n  if (flags === undefined) {\n    flags = default_flags;\n  }\n  let pool = (flags & PACKET_DEBUG) ? pak_debug_pool : pak_pool;\n  if (pool.length) {\n    let pak = pool.pop();\n    pak.reinit(flags, init_size);\n    return pak;\n  }\n  if (flags & PACKET_DEBUG) {\n    return new PacketDebug(flags, init_size);\n  }\n  return new Packet(flags, init_size);\n}\nexports.packetCreate = packetCreate;\n\nfunction packetFromBuffer(buf, buf_len, need_copy) {\n  let flags = buf[0];\n  assert.equal(typeof flags, 'number'); // `buf` should be a Buffer or Uint8Array, not a DataView like other funcs here\n  if (need_copy) {\n    assert(buf_len);\n    assert(buf.buffer instanceof ArrayBuffer);\n    let pak = packetCreate(flags, buf_len);\n    if (buf.byteLength !== buf_len) {\n      buf = Buffer.from(buf.buffer, 0, buf_len);\n    }\n    pak.getBuffer().set(buf);\n    pak.setReadable();\n    return pak;\n  } else {\n    // reference unowned/unpoolable buffer\n    assert(buf instanceof Uint8Array);\n    let pak = packetCreate(flags | PACKET_UNOWNED_BUFFER);\n    pak.setBuffer(buf, buf_len || buf.byteLength);\n    return pak;\n  }\n}\nexports.packetFromBuffer = packetFromBuffer;\n\nfunction packetFromJSON(js_obj) {\n  let pak = packetCreate(js_obj.f);\n\n  let payload = pak.pak || pak;\n\n  function decode(str) {\n    return base64Decode(str, allocDataView);\n  }\n  if (js_obj.b) {\n    payload.bsizes = [];\n    payload.bufs = [];\n    for (let ii = 0; ii < js_obj.b.length; ++ii) {\n      let buf = decode(js_obj.b[ii]);\n      payload.bufs.push(buf);\n      payload.bsizes.push(buf.decode_size);\n      delete buf.decode_size;\n    }\n  }\n  if (js_obj.d) {\n    payload.buf = decode(js_obj.d);\n    payload.buf_len = payload.buf.decode_size;\n    delete payload.buf.decode_size;\n    payload.buf_offs = 0;\n  }\n\n  return pak;\n}\nexports.packetFromJSON = packetFromJSON;\n\nfunction isPacket(thing) {\n  return thing instanceof Packet || thing instanceof PacketDebug;\n}\nexports.isPacket = isPacket;\n","const BUCKET_TIME = 10000;\nconst NUM_BUCKETS = 5;\n\nlet counters = { time_start: Date.now() };\nlet hist = [counters];\nlet countdown = BUCKET_TIME;\n\nexport function perfCounterAdd(key) {\n  counters[key] = (counters[key] || 0) + 1;\n}\n\nexport function perfCounterAddValue(key, value) {\n  counters[key] = (counters[key] || 0) + value;\n}\n\nexport function perfCounterTick(dt, log) {\n  countdown -= dt;\n  if (countdown <= 0) {\n    countdown = BUCKET_TIME;\n    if (hist.length === NUM_BUCKETS) {\n      hist.splice(0, 1);\n    }\n    let now = Date.now();\n    counters.time_end = now;\n    if (log) {\n      log(counters);\n    }\n    counters = {};\n    counters.time_start = now;\n    hist.push(counters);\n  }\n}\n\nexport function perfCounterHistory() {\n  return hist;\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint prefer-rest-params:off, no-underscore-dangle:off */\n\nconst assert = require('assert');\n\nfunction EventEmitter() {\n  this._listeners = {};\n}\n\nmodule.exports = EventEmitter;\n// Also \"export\" `EventEmitter` so you can do `import { EventEmitter } from 'tiny-events.js'` but\n//   not pollute the prototype (would show up for all classes that `extend EventEmitter`).\nObject.defineProperty(module.exports, 'EventEmitter', {\n  value: EventEmitter,\n  enumerable: false,\n});\n\nfunction addListener(ee, type, fn, once) {\n  assert(typeof fn === 'function');\n  let arr = ee._listeners[type];\n  if (!arr) {\n    arr = ee._listeners[type] = [];\n  }\n  arr.push({\n    once,\n    fn,\n  });\n}\n\nEventEmitter.prototype.hasListener = function (type, fn) {\n  let arr = this._listeners[type];\n  if (!arr) {\n    return false;\n  }\n  for (let ii = 0; ii < arr.length; ++ii) {\n    if (arr[ii].fn === fn) {\n      return true;\n    }\n  }\n  return false;\n};\n\nEventEmitter.prototype.on = function (type, fn) {\n  addListener(this, type, fn, 0);\n  return this;\n};\n\nEventEmitter.prototype.once = function (type, fn) {\n  addListener(this, type, fn, 1);\n  return this;\n};\n\nEventEmitter.prototype.removeListener = function (type, fn) {\n  let arr = this._listeners[type];\n  assert(arr);\n  for (let ii = 0; ii < arr.length; ++ii) {\n    if (arr[ii].fn === fn) {\n      arr.splice(ii, 1);\n      return this;\n    }\n  }\n  assert(false); // expected to find the listener!\n  return this;\n};\n\nfunction filterNotOnce(elem) {\n  return !elem.once;\n}\n\nEventEmitter.prototype.emit = function (type, ...args) {\n  let arr = this._listeners[type];\n  if (!arr) {\n    return false;\n  }\n\n  let any = false;\n  let any_once = false;\n  for (let ii = 0; ii < arr.length; ++ii) {\n    let elem = arr[ii];\n    any = true;\n    elem.fn(...args);\n    if (elem.once) {\n      any_once = true;\n    }\n  }\n  if (any_once) {\n    this._listeners[type] = arr.filter(filterNotOnce);\n  }\n\n  return any;\n};\n\n// Aliases\n// EventEmitter.prototype.addListener = EventEmitter.prototype.on;\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nconst assert = require('assert');\nconst { abs, floor, min, max, random, round, pow, sqrt } = Math;\n\nexport function nop() {\n  // empty\n}\n\nexport function identity(a) {\n  return a;\n}\n\nexport function once(fn) {\n  let called = false;\n  return function (...args) {\n    if (called) {\n      return;\n    }\n    called = true;\n    fn(...args);\n  };\n}\n\nexport function empty(obj) {\n  for (let key in obj) {\n    return false;\n  }\n  return true;\n}\n\nexport function easeInOut(v, a) {\n  let va = pow(v, a);\n  return va / (va + pow(1 - v, a));\n}\n\nexport function easeIn(v, a) {\n  return 2 * easeInOut(0.5 * v, a);\n}\n\nexport function easeOut(v, a) {\n  return 2 * easeInOut(0.5 + 0.5 * v, a) - 1;\n}\n\nexport function clone(obj) {\n  if (!obj) { // handle undefined\n    return obj;\n  }\n  return JSON.parse(JSON.stringify(obj));\n}\n\nexport function merge(dest, src) {\n  for (let f in src) {\n    dest[f] = src[f];\n  }\n  return dest;\n}\n\nexport function has(obj, field) {\n  return Object.prototype.hasOwnProperty.call(obj, field);\n}\n\nexport function defaults(dest, src) {\n  for (let f in src) {\n    if (!has(dest, f)) {\n      dest[f] = src[f];\n    }\n  }\n  return dest;\n}\n\nexport function defaultsDeep(dest, src) {\n  for (let f in src) {\n    if (!has(dest, f)) {\n      dest[f] = src[f];\n    } else if (typeof dest[f] === 'object') {\n      defaultsDeep(dest[f], src[f]);\n    }\n  }\n  return dest;\n}\n\nexport function cloneShallow(src) {\n  return merge({}, src);\n}\n\nexport function deepEqual(a, b) {\n  if (Array.isArray(a)) {\n    if (!Array.isArray(b)) {\n      return false;\n    }\n    if (a.length !== b.length) {\n      return false;\n    }\n    for (let ii = 0; ii < a.length; ++ii) {\n      if (!deepEqual(a[ii], b[ii])) {\n        return false;\n      }\n    }\n    return true;\n  } else if (typeof a === 'object') {\n    if (typeof b !== 'object') {\n      return false;\n    }\n    if (!a || !b) { // at least one is null\n      return !a && !b; // equal if both are null\n    }\n    for (let key in a) {\n      // b must have key, or both a[key] and b[key] are undefined\n      if (!deepEqual(a[key], b[key])) {\n        return false;\n      }\n    }\n    for (let key in b) {\n      // if b has key and it's defined, a must also be defined (and would have checked equality above)\n      if (b[key] !== undefined && a[key] === undefined) {\n        return false;\n      }\n    }\n    return true;\n  }\n  return a === b;\n}\n\nexport function deepAdd(dest, src) {\n  assert(dest && src);\n  for (let key in src) {\n    let value = src[key];\n    if (typeof value === 'object') {\n      let dest_sub = dest[key] = dest[key] || {};\n      assert.equal(typeof dest_sub, 'object');\n      deepAdd(dest_sub, value);\n    } else {\n      dest[key] = (dest[key] || 0) + value;\n    }\n  }\n}\n\nexport function clamp(v, mn, mx) {\n  return min(max(mn, v), mx);\n}\n\nexport function lerp(a, v0, v1) {\n  return (1 - a) * v0 + a * v1;\n}\n\nexport function mix(v0, v1, a) { // GLSL semantics\n  return (1 - a) * v0 + a * v1;\n}\n\nexport function map01(number,in_min, in_max) {\n  return (number - in_min) / (in_max - in_min);\n}\n\nexport function sign(a) {\n  return a < 0 ? -1 : a > 0 ? 1 : 0;\n}\n\nexport function mod(a, n) {\n  return ((a % n) + n) % n;\n}\n\n// log2 rounded up to nearest integer\nexport function log2(val) {\n  for (let ii=1, jj=0; ; ii <<= 1, ++jj) {\n    if (ii >= val) {\n      return jj;\n    }\n  }\n}\n\nexport function ridx(arr, idx) {\n  arr[idx] = arr[arr.length - 1];\n  arr.pop();\n}\n\nexport function round100(a) {\n  return round(a * 100) / 100;\n}\n\nexport function round1000(a) {\n  return round(a * 1000) / 1000;\n}\n\nexport function fract(a) {\n  return a - floor(a);\n}\n\nexport function nearSame(a, b, tol) {\n  return abs(b - a) <= tol;\n}\n\nexport function titleCase(str) {\n  return str.split(' ').map((word) => `${word[0].toUpperCase()}${word.slice(1)}`)\n    .join(' ');\n}\n\nconst EPSILON = 0.00001;\n\n// http://local.wasp.uwa.edu.au/~pbourke/geometry/sphereline/\nexport function lineCircleIntersect(p1, p2, pCircle, radius) {\n  let dp = [\n    p2[0] - p1[0],\n    p2[1] - p1[1]\n  ];\n  let a = dp[0] * dp[0] + dp[1] * dp[1];\n  let b = 2 * (dp[0] * (p1[0] - pCircle[0]) + dp[1] * (p1[1] - pCircle[1]));\n  let c = pCircle[0] * pCircle[0] + pCircle[1] * pCircle[1];\n  c += p1[0] * p1[0] + p1[1] * p1[1];\n  c -= 2 * (pCircle[0] * p1[0] + pCircle[1] * p1[1]);\n  c -= radius * radius;\n  let bb4ac = b * b - 4 * a * c;\n  if (abs(a) < EPSILON || bb4ac < 0) {\n    return false;\n  }\n\n  let mu1 = (-b + sqrt(bb4ac)) / (2 * a);\n  let mu2 = (-b - sqrt(bb4ac)) / (2 * a);\n  if (mu1 >= 0 && mu1 <= 1 || mu2 >= 0 && mu2 <= 1) {\n    return true;\n  }\n\n  return false;\n}\n\n// line segment intercept math by Paul Bourke http://paulbourke.net/geometry/pointlineplane/\nexport function lineLineIntersect(p1, p2, p3, p4) {\n  let denominator = ((p4[1] - p3[1]) * (p2[0] - p1[0]) - (p4[0] - p3[0]) * (p2[1] - p1[1]));\n  let numa = ((p4[0] - p3[0]) * (p1[1] - p3[1]) - (p4[1] - p3[1]) * (p1[0] - p3[0]));\n  let numb = ((p2[0] - p1[0]) * (p1[1] - p3[1]) - (p2[1] - p1[1]) * (p1[0] - p3[0]));\n\n  if (denominator === 0) {\n    // lines are parallel, or 0-length line\n    if (!numa && !numb) {\n      // lines are coincident\n      return true;\n    }\n    return false;\n  }\n\n  let ua = numa / denominator;\n  let ub = numb / denominator;\n\n  // is the intersection along the segments\n  if (ua < 0 || ua > 1 || ub < 0 || ub > 1) {\n    return false;\n  }\n\n  return true;\n  // let x = p1[0] + ua * (p2[0] - p1[0]);\n  // let y = p1[1] + ua * (p2[1] - p1[1]);\n  // return [x, y];\n}\n\n// let setPrototypeOf = Object.setPrototypeOf ?\n//   Object.setPrototypeOf.bind() :\n//   function _setPrototypeOf(o, p) {\n//     o.__proto__ = p; // eslint-disable-line no-proto\n//     return o;\n//   };\nexport function inherits(ctor, superCtor) {\n  // From Node.js\n  assert(typeof superCtor === 'function');\n  let ctor_proto_orig = ctor.prototype;\n  // not needed? ctor.super_ = superCtor; // eslint-disable-line no-underscore-dangle\n  // second parameter also not actually needed, just defines new Foo().constructor === Foo?\n  ctor.prototype = Object.create(superCtor.prototype, {\n    constructor: {\n      value: ctor,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  // If anything had been added to the prototype (only in the case of late/double\n  //   inheritance), add it\n  for (let key in ctor_proto_orig) {\n    ctor.prototype[key] = ctor_proto_orig[key];\n  }\n  // Also inherit static methods\n  // Could use setPrototypeOf (fewer ordering issues) if needed, but has strong performance warnings\n  // setPrototypeOf(ctor, superCtor);\n  for (let key in superCtor) {\n    ctor[key] = superCtor[key];\n  }\n}\n\nexport function isPowerOfTwo(n) {\n  return ((n & (n - 1)) === 0);\n}\n\nexport function nextHighestPowerOfTwo(x) {\n  --x;\n  for (let i = 1; i < 32; i <<= 1) {\n    x |= x >> i;\n  }\n  return x + 1;\n}\n\nexport function logdata(data) {\n  if (data === undefined) {\n    return '';\n  }\n  let r = JSON.stringify(data);\n  if (r.length < 120) {\n    return r;\n  }\n  return `${r.slice(0, 120-3)}...(${r.length})`;\n}\n\nexport function isInteger(v) {\n  return typeof v === 'number' && isFinite(v) && floor(v) === v;\n}\n\nexport function toNumber(v) {\n  return Number(v);\n}\n\nexport function randomNot(not_value, max_value) {\n  let new_value;\n  do {\n    new_value = floor(random() * max_value);\n  } while (new_value === not_value);\n  return new_value;\n}\n\nexport function toArray(array_like) {\n  return Array.prototype.slice.call(array_like);\n}\n\nexport function arrayToSet(array) {\n  let ret = Object.create(null);\n  for (let ii = 0; ii < array.length; ++ii) {\n    ret[array[ii]] = true;\n  }\n  return ret;\n}\n\n// Makes a prototype-less object that can safely be used as a set to query for user-supplied strings\nexport function objectToSet(obj) {\n  return merge(Object.create(null), obj);\n}\n\nexport function matchAll(str, re) {\n  let ret = [];\n  let m;\n  do {\n    m = re.exec(str);\n    if (m) {\n      ret.push(m[1]);\n    }\n  } while (m);\n  return ret;\n}\n\nexport function callEach(arr, pre_clear, ...args) {\n  if (arr && arr.length) {\n    for (let ii = 0; ii < arr.length; ++ii) {\n      arr[ii](...args);\n    }\n  }\n}\n\n// The characters cause problems with lower level systems (Google Firestore)\n// that presumably try to convert to UTF-16.\n// const utf16_surrogates = /[\\uD800-\\uDFFF]/g;\n\n// \"Bad\" whitespace characters not caught by .trim()\n// Found by running:\n//   require('somefont.json').char_infos.filter(a=>String.fromCharCode(a.c).trim()).filter(a=>!a.w).map(a=a.c)\n// const bad_whitespace = /[\\x00-\\x1F\\x7F\\u1D54\\u1D55\\u2000-\\u200F\\u205F-\\u206F\\uFE00]/g;\n\n// eslint-disable-next-line no-control-regex, no-misleading-character-class\nconst sanitize_regex = /[\\uD800-\\uDFFF\\x00-\\x1F\\x7F\\u1D54\\u1D55\\u2000-\\u200F\\u205F-\\u206F\\uFE00]/g;\nexport function sanitize(str) {\n  return (str || '').replace(sanitize_regex, '');\n}\n\nexport function plural(number, label) {\n  return `${label}${number === 1 ? '' : 's'}`;\n}\n\nexport function secondsToFriendlyString(seconds, force_include_seconds) {\n  let days = floor(seconds / (60*60*24));\n  seconds -= days * 60*60*24;\n  let hours = floor(seconds / (60*60));\n  seconds -= hours * 60*60;\n  let minutes = floor(seconds / 60);\n  seconds -= minutes * 60;\n  let resp = [];\n  if (days) {\n    let years = floor(days / 365.25);\n    if (years) {\n      days -= floor(years * 365.25);\n      resp.push(`${years} ${plural(years, 'year')}`);\n    }\n    resp.push(`${days} ${plural(days, 'day')}`);\n  }\n  if (hours) {\n    resp.push(`${hours} ${plural(hours, 'hour')}`);\n  }\n  if (minutes || !resp.length) {\n    resp.push(`${minutes} ${plural(minutes, 'minute')}`);\n  }\n  if (force_include_seconds) {\n    resp.push(`${seconds} ${plural(seconds, 'second')}`);\n  }\n  return resp.join(', ');\n}\n\nexport function secondsSince2020() {\n  // Seconds since Jan 1st, 2020\n  return floor(Date.now() / 1000) - 1577836800;\n}\n\nexport function dateToSafeLocaleString(date, date_only) {\n  // Uses toString as a fallback since some browsers do not properly detect default locale.\n  let date_text;\n  try {\n    date_text = date_only ? date.toLocaleDateString() : date.toLocaleString();\n  } catch (e) {\n    console.error(e, '(Using toString as fallback)');\n    date_text = date_only ? date.toDateString() : date.toString();\n  }\n  return date_text;\n}\n\nexport function msToTimeString(duration, opts) {\n  opts = opts || {};\n  let ms = duration % 1000;\n  let s;\n  let m;\n  let h;\n  s = duration - ms;\n  s %= (60 * 1000);\n  m = (duration - ms - s);\n  m %= (60 * 60 * 1000);\n  h = duration - ms - s - m;\n  h /= 60 * 60 * 1000;\n  m /= 60 * 1000;\n  s /= 1000;\n\n  return `${\n    h ? `${h}:` : ''}${\n    h && m < 10 ? '0': ''}${m}:${\n    s < 10 ? '0' : ''}${s}${\n    opts.hide_ms ? '' : `.${ms < 10 ? '00' : ms < 100 ? '0' : ''}${ms}`\n  }`;\n}\n\nlet sw = {}; // Stop words map\nsw.am = sw.an = sw.and = sw.as = sw.at = sw.be = sw.by = sw.el =\n  sw.for = sw.in = sw.is = sw.la = sw.las = sw.los = sw.of = sw.on =\n  sw.or = sw.the = sw.that = sw.this = sw.to = sw.with = true;\n/**\n * Removes single char and stop words from the string array.\n * @param {string[]} string_array Array of strings to filter out single char\n * @returns {string[]} Filter string array with single char and stop words removed\n */\nexport function cleanupStringArray(string_array) {\n  return string_array.filter((s) => (s.length > 1) && (s.length <= 32) && !sw[s]);\n}\n\n/**\n * Return an array of the string splits after transforming to lowercase and trimming whitespaces on each of the split.\n * Punctuations and symbols are also filtered.\n * Also removes single char and stopwords via cleanupStringArray.\n * @param {string[]} string String to use to form the string split result\n * @param {string} pattern String pattern to divide the string on\n * @returns {string[]} String split result\n */\nexport function cleanStringSplit(string, pattern) {\n  // remove punctuations and symbols; e.g., 'In!@$%^&*()_+sane Wo`{}[]|/?\\'\"rld;:<>s,.' = 'Insane Worlds'\n  const base = sanitize(string).replace(/[.,/\\\\@#!$%^&*;:<>{}|?=\\-+_`'\"~[\\]()]/g,'').replace(/\\s{1,}/g,' ');\n  return cleanupStringArray(base.toLowerCase().split(pattern).map((s) => s.trim()));\n}\n\nexport function eatPossiblePromise(p) {\n  // On some browsers, some APIs return Promises where they did not before,\n  //   wrap in this to discard any exceptions / rejections from these.\n  //   For example, pointerLockEnter, throws \"Uncaught UnknownError\" on Chrome on\n  //   Android, as well as triggering pointerlockerror.\n  if (p && p.catch) {\n    p.catch(nop);\n  }\n}\n\nexport function errorString(e) { // function errorString(e : Error | object | string) : string {\n  let msg = String(e);\n  if (msg === '[object Object]') {\n    try {\n      msg = JSON.stringify(e);\n    } catch (ignored) {\n      // ignored\n    }\n  }\n  if (e && e.stack && e.message) {\n    // Error object or similar\n    // Just grabbing the message, but could do something with the stack similar to error handler in bootstrap.js\n    msg = String(e.message);\n  }\n  msg = msg.slice(0, 600); // Not too huge\n  return msg;\n}\n\nexport function deprecate(exports, field, replacement) {\n  Object.defineProperty(exports, field, {\n    get: function () {\n      assert(false, `${field} is deprecated, use ${replacement} instead`);\n      return undefined;\n    }\n  });\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// Like assert(0), but return the value, so the throw can be disabled if the\n// calling code handles failure.  Can replace `verify(foo)` with `(foo)` at\n// build time in production builds.\n\nlet should_throw = true;\n\nfunction verify<T>(exp: T | undefined | null | false, msg?: string): T {\n  if (!exp && should_throw) {\n    throw new Error(`Assertion failed${msg ? `: ${msg}` : ''}`);\n  }\n  return exp as T;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-namespace\nnamespace verify {\n  export const ok = verify;\n\n  export function equal<T>(a: T, b: T): boolean {\n    if (a === b) {\n      return true;\n    }\n    if (should_throw) {\n      throw new Error(`Assertion failed: \"${a}\"===\"${b}\"`);\n    }\n    return false;\n  }\n\n  export function dothrow(doit: boolean): void {\n    should_throw = doit;\n  }\n}\n\nexport = verify;\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// Vector math functions required by the rest of the engine taken piecemeal from\n// gl-matrix and related, as well as some generic math utilities\nconst mat3Create = require('gl-mat3/create');\nconst mat4Create = require('gl-mat4/create');\n\nconst { abs, acos, max, min, floor, pow, round, sqrt } = Math;\n\nexport type Mat3 = Float32Array |\n  [number, number, number,\n   number, number, number,\n   number, number, number];\nexport type Mat4 = Float32Array |\n  [number, number, number, number,\n   number, number, number, number,\n   number, number, number, number,\n   number, number, number, number];\n\nexport type Vec4 = [number, number, number, number, ...number[]] | Float32Array | Int32Array;\nexport type Vec3 = [number, number, number, ...number[]] | Float32Array | Int32Array;\nexport type Vec2 = [number, number, ...number[]] | Float32Array | Int32Array;\nexport type Vec1 = [number, ...number[]] | Float32Array | Int32Array;\n\nexport type ROVec4 = Readonly<Vec4>;\nexport type ROVec3 = Readonly<Vec3>;\nexport type ROVec2 = Readonly<Vec2>;\nexport type ROVec1 = Readonly<Vec1>;\n\nexport const mat3 = mat3Create as () => Mat3;\nexport const mat4 = mat4Create as () => Mat4;\n\nexport function vec1(v: number): Vec1 {\n  return new Float32Array([v || 0]);\n}\nexport const rovec1:(v: number) => ROVec1 = vec1;\n\nexport function vec2(): Vec2;\nexport function vec2(a: number, b: number): Vec2;\nexport function vec2(a?: number, b?: number): Vec2 {\n  let r = new Float32Array(2);\n  if (a || b) {\n    r[0] = a as number;\n    r[1] = b as number;\n  }\n  return r;\n}\nexport const rovec2:(a: number, b: number) => ROVec2 = vec2;\n\nexport function ivec2(): Vec2;\nexport function ivec2(a: number, b: number): Vec2;\nexport function ivec2(a?: number, b?: number): Vec2 {\n  let r = new Int32Array(2);\n  if (a || b) {\n    r[0] = a as number;\n    r[1] = b as number;\n  }\n  return r;\n}\nexport const roivec2:(a: number, b: number) => ROVec2 = ivec2;\n\nexport function vec3(): Vec3;\nexport function vec3(a: number, b: number, c: number): Vec3;\nexport function vec3(a?: number, b?: number, c?: number): Vec3 {\n  let r = new Float32Array(3);\n  if (a || b || c) {\n    r[0] = a as number;\n    r[1] = b as number;\n    r[2] = c as number;\n  }\n  return r;\n}\nexport const rovec3:(a: number, b: number, c: number) => ROVec3 = vec3;\n\nexport function ivec3(): Vec3;\nexport function ivec3(a: number, b: number, c: number): Vec3;\nexport function ivec3(a?: number, b?: number, c?: number): Vec3 {\n  let r = new Int32Array(3);\n  if (a || b || c) {\n    r[0] = a as number;\n    r[1] = b as number;\n    r[2] = c as number;\n  }\n  return r;\n}\nexport const roivec3:(a: number, b: number, c: number) => ROVec3 = ivec3;\n\nexport function vec4(): Vec4;\nexport function vec4(a: number, b: number, c: number, d: number): Vec4;\nexport function vec4(a?: number, b?: number, c?: number, d?: number): Vec4 {\n  let r = new Float32Array(4);\n  if (a || b || c || d) {\n    r[0] = a as number;\n    r[1] = b as number;\n    r[2] = c as number;\n    r[3] = d as number;\n  }\n  return r;\n}\nexport const rovec4:(a: number, b: number, c: number, d: number) => ROVec4 = vec4;\n\nfunction frozenVec4(a: number, b: number, c: number, d: number): ROVec4 {\n  // if (debug) {\n  //   return Object.freeze([a,b,c,d]); // Not a vec4, but lets us catch bugs\n  // }\n  return rovec4(a,b,c,d);\n}\n\nexport const unit_vec = frozenVec4(1,1,1,1);\nexport const half_vec = frozenVec4(0.5,0.5,0.5,0.5);\nexport const zero_vec = frozenVec4(0,0,0,0);\nexport const identity_mat3 = mat3();\nexport const identity_mat4 = mat4();\nexport const xaxis = frozenVec4(1,0,0,0);\nexport const yaxis = frozenVec4(0,1,0,0);\nexport const zaxis = frozenVec4(0,0,1,0);\n\n\nexport function v2abs(out: Vec2, a: ROVec2): Vec2 {\n  out[0] = abs(a[0]);\n  out[1] = abs(a[1]);\n  return out;\n}\n\nexport function v2add(out: Vec2, a: ROVec2, b: ROVec2): Vec2 {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  return out;\n}\n\nexport function v2addScale(out: Vec2, a: ROVec2, b: ROVec2, s: number): Vec2 {\n  out[0] = a[0] + b[0] * s;\n  out[1] = a[1] + b[1] * s;\n  return out;\n}\n\nexport function v2angle(a: ROVec2, b: ROVec2): number {\n  let mag = sqrt(\n    (a[0] * a[0] + a[1] * a[1]) *\n    (b[0] * b[0] + b[1] * b[1])\n  );\n  return acos(\n    min(max(\n      mag && ((a[0] * b[0] + a[1] * b[1]) / mag),\n      -1),1\n    )\n  );\n}\n\nexport function v2copy(out: Vec2, a: ROVec2): Vec2 {\n  out[0] = a[0];\n  out[1] = a[1];\n  return out;\n}\n\nexport function v2dist(a: ROVec2, b: ROVec2): number {\n  return sqrt((a[0] - b[0]) * (a[0] - b[0]) +\n    (a[1] - b[1]) * (a[1] - b[1]));\n}\n\nexport function v2distSq(a: ROVec2, b: ROVec2): number {\n  return (a[0] - b[0]) * (a[0] - b[0]) +\n    (a[1] - b[1]) * (a[1] - b[1]);\n}\n\nexport function v2div(out: Vec2, a: ROVec2, b: ROVec2): Vec2 {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  return out;\n}\n\nexport function v2dot(a: ROVec2, b: ROVec2): number {\n  return a[0] * b[0] + a[1] * b[1];\n}\n\nexport function v2floor(out: Vec2, a: ROVec2): Vec2 {\n  out[0] = floor(a[0]);\n  out[1] = floor(a[1]);\n  return out;\n}\n\nexport function v2iFloor(inout: Vec2): Vec2 {\n  inout[0] = floor(inout[0]);\n  inout[1] = floor(inout[1]);\n  return inout;\n}\n\nexport function v2lengthSq(a: ROVec2): number {\n  return a[0]*a[0] + a[1]*a[1];\n}\n\nexport function v2length(a: ROVec2): number {\n  return sqrt(v2lengthSq(a));\n}\n\nexport function v2lerp(out: Vec2, t: number, a: ROVec2, b: ROVec2): Vec2 {\n  let it = 1 - t;\n  out[0] = it * a[0] + t * b[0];\n  out[1] = it * a[1] + t * b[1];\n  return out;\n}\n\nexport function v2mul(out: Vec2, a: ROVec2, b: ROVec2): Vec2 {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  return out;\n}\n\nexport function v2normalize(out: Vec2, a: ROVec2): Vec2 {\n  let len = a[0]*a[0] + a[1]*a[1];\n  if (len > 0) {\n    len = 1 / sqrt(len);\n    out[0] = a[0] * len;\n    out[1] = a[1] * len;\n  }\n  return out;\n}\n\nexport function v2iNormalize(inout: Vec2): Vec2 {\n  let len = inout[0]*inout[0] + inout[1]*inout[1];\n  if (len > 0) {\n    len = 1 / sqrt(len);\n    inout[0] *= len;\n    inout[1] *= len;\n  }\n  return inout;\n}\n\nexport function v2round(out: Vec2, a: ROVec2): Vec2 {\n  out[0] = round(a[0]);\n  out[1] = round(a[1]);\n  return out;\n}\n\nexport function v2iRound(inout: Vec2): Vec2 {\n  inout[0] = round(inout[0]);\n  inout[1] = round(inout[1]);\n  return inout;\n}\n\nexport function v2same(a: ROVec2, b: ROVec2): boolean {\n  return a[0] === b[0] && a[1] === b[1];\n}\n\nexport function v2scale(out: Vec2, a: ROVec2, s: number): Vec2 {\n  out[0] = a[0] * s;\n  out[1] = a[1] * s;\n  return out;\n}\n\nexport function v2set(out: Vec2, a: number, b: number): Vec2 {\n  out[0] = a;\n  out[1] = b;\n  return out;\n}\n\nexport function v2sub(out: Vec2, a: ROVec2, b: ROVec2): Vec2 {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  return out;\n}\n\n\nexport function v3add(out: Vec3, a: ROVec3, b: ROVec3): Vec3 {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  return out;\n}\n\nexport function v3iAdd(inout: Vec3, b: ROVec3): Vec3 {\n  inout[0] += b[0];\n  inout[1] += b[1];\n  inout[2] += b[2];\n  return inout;\n}\n\nexport function v3addScale(out: Vec3, a: ROVec3, b: ROVec3, s: number): Vec3 {\n  out[0] = a[0] + b[0] * s;\n  out[1] = a[1] + b[1] * s;\n  out[2] = a[2] + b[2] * s;\n  return out;\n}\n\nexport function v3angle(a: ROVec3, b: ROVec3): number {\n  let mag = sqrt(\n    (a[0] * a[0] + a[1] * a[1] + a[2] * a[2]) *\n    (b[0] * b[0] + b[1] * b[1] + b[2] * b[2])\n  );\n  return acos(\n    min(max(\n      mag && ((a[0] * b[0] + a[1] * b[1] + a[2] * b[2]) / mag),\n      -1),1\n    )\n  );\n}\n\nexport function v3copy(out: Vec3, a: ROVec3): Vec3 {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n\nexport function v3cross(out: Vec3, a: ROVec3, b: ROVec3): Vec3 {\n  let a0 = a[0];\n  let a1 = a[1];\n  let a2 = a[2];\n  let b0 = b[0];\n  let b1 = b[1];\n  let b2 = b[2];\n  out[0] = ((a1 * b2) - (a2 * b1));\n  out[1] = ((a2 * b0) - (a0 * b2));\n  out[2] = ((a0 * b1) - (a1 * b0));\n  return out;\n}\n\n// determinant of the matrix made by (columns?) [a, b, c];\nexport function v3determinant(a: ROVec3, b: ROVec3, c: Vec3): number {\n  // let a00 = a[0];\n  // let a01 = a[1];\n  // let a02 = a[2];\n  // let a10 = b[0];\n  // let a11 = b[1];\n  // let a12 = b[2];\n  // let a20 = c[0];\n  // let a21 = c[2];\n  // let a22 = c[2];\n  let a00 = a[0];\n  let a01 = b[0];\n  let a02 = c[0];\n  let a10 = a[1];\n  let a11 = b[1];\n  let a12 = c[1];\n  let a20 = a[2];\n  let a21 = b[2];\n  let a22 = c[2];\n\n  return a00 * (a22 * a11 - a12 * a21) + a01 * (-a22 * a10 + a12 * a20) + a02 * (a21 * a10 - a11 * a20);\n}\n\nexport function v3distSq(a: ROVec3, b: ROVec3): number {\n  return (a[0] - b[0]) * (a[0] - b[0]) +\n    (a[1] - b[1]) * (a[1] - b[1]) +\n    (a[2] - b[2]) * (a[2] - b[2]);\n}\n\nexport function v3dist(a: ROVec3, b: ROVec3): number {\n  return sqrt(v3distSq(a,b));\n}\n\nexport function v3div(out: Vec3, a: ROVec3, b: ROVec3): Vec3 {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  return out;\n}\n\nexport function v3dot(a: ROVec3, b: ROVec3): number {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n\nexport function v3iFloor(inout: Vec3): Vec3 {\n  inout[0] = floor(inout[0]);\n  inout[1] = floor(inout[1]);\n  inout[2] = floor(inout[2]);\n  return inout;\n}\n\nexport function v3floor(out: Vec3, a: ROVec3): Vec3 {\n  out[0] = floor(a[0]);\n  out[1] = floor(a[1]);\n  out[2] = floor(a[2]);\n  return out;\n}\n\nexport function v3lengthSq(a: ROVec3): number {\n  return a[0]*a[0] + a[1]*a[1] + a[2]*a[2];\n}\n\nexport function v3length(a: ROVec3): number {\n  return sqrt(v3lengthSq(a));\n}\n\nexport function v3lerp(out: Vec3, t: number, a: ROVec3, b: ROVec3): Vec3 {\n  let it = 1 - t;\n  out[0] = it * a[0] + t * b[0];\n  out[1] = it * a[1] + t * b[1];\n  out[2] = it * a[2] + t * b[2];\n  return out;\n}\n\nexport function v3iMax(inout: Vec3, b: ROVec3): Vec3 {\n  inout[0] = max(inout[0], b[0]);\n  inout[1] = max(inout[1], b[1]);\n  inout[2] = max(inout[2], b[2]);\n  return inout;\n}\n\nexport function v3iMin(inout: Vec3, b: ROVec3): Vec3 {\n  inout[0] = min(inout[0], b[0]);\n  inout[1] = min(inout[1], b[1]);\n  inout[2] = min(inout[2], b[2]);\n  return inout;\n}\n\nexport function v3mul(out: Vec3, a: ROVec3, b: ROVec3): Vec3 {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  return out;\n}\n\nexport function v3iMul(inout: Vec3, b: ROVec3): Vec3 {\n  inout[0] *= b[0];\n  inout[1] *= b[1];\n  inout[2] *= b[2];\n  return inout;\n}\n\nexport function v3mulMat4(out: Vec3, a: ROVec3, m: Mat4): Vec3 {\n  let x = a[0];\n  let y = a[1];\n  let z = a[2];\n  out[0] = x * m[0] + y * m[4] + z * m[8];\n  out[1] = x * m[1] + y * m[5] + z * m[9];\n  out[2] = x * m[2] + y * m[6] + z * m[10];\n  return out;\n}\n\n// Same as v3mulMat4, but assumes it's a vector with w=1\nexport function m4TransformVec3(out: Vec3, a: ROVec3, m: Mat4): Vec3 {\n  let x = a[0];\n  let y = a[1];\n  let z = a[2];\n  out[0] = x * m[0] + y * m[4] + z * m[8] + m[12];\n  out[1] = x * m[1] + y * m[5] + z * m[9] + m[13];\n  out[2] = x * m[2] + y * m[6] + z * m[10] + m[14];\n  return out;\n}\n\nexport function v3normalize(out: Vec3, a: ROVec3): Vec3 {\n  let len = a[0]*a[0] + a[1]*a[1] + a[2]*a[2];\n  if (len > 0) {\n    len = 1 / sqrt(len);\n    out[0] = a[0] * len;\n    out[1] = a[1] * len;\n    out[2] = a[2] * len;\n  }\n  return out;\n}\n\nexport function v3iNormalize(inout: Vec3): Vec3 {\n  let len = inout[0]*inout[0] + inout[1]*inout[1] + inout[2]*inout[2];\n  if (len > 0) {\n    len = 1 / sqrt(len);\n    inout[0] *= len;\n    inout[1] *= len;\n    inout[2] *= len;\n  }\n  return inout;\n}\n\n// Treats `a` as vec3 input with w assumed to be 1\n// out[0]/[1] have had perspective divide and converted to normalized 0-1 range\n// out[2] is distance\nexport function v3perspectiveProject(out: Vec3, a: ROVec3, m: Mat4): Vec3 {\n  let x = a[0];\n  let y = a[1];\n  let z = a[2];\n  let w = m[3] * x + m[7] * y + m[11] * z + m[15];\n  let invw = 0.5 / (w || 0.00001);\n  out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) * invw + 0.5;\n  out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) * -invw + 0.5;\n  out[2] = m[2] * x + m[6] * y + m[10] * z + m[14];\n  return out;\n}\n\nexport function v3pow(out: Vec3, a: ROVec3, exp: number) : Vec3 {\n  out[0] = pow(a[0], exp);\n  out[1] = pow(a[1], exp);\n  out[2] = pow(a[2], exp);\n  return out;\n}\n\nexport function v3round(out: Vec3, a: ROVec3): Vec3 {\n  out[0] = round(a[0]);\n  out[1] = round(a[1]);\n  out[2] = round(a[2]);\n  return out;\n}\n\nexport function v3iRound(inout: Vec3): Vec3 {\n  inout[0] = round(inout[0]);\n  inout[1] = round(inout[1]);\n  inout[2] = round(inout[2]);\n  return inout;\n}\n\nexport function v3same(a: ROVec3, b: ROVec3): boolean {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n}\n\nexport function v3scale(out: Vec3, a: ROVec3, s: number): Vec3 {\n  out[0] = a[0] * s;\n  out[1] = a[1] * s;\n  out[2] = a[2] * s;\n  return out;\n}\n\nexport function v3scaleFloor(out: Vec3, a: ROVec3, s: number): Vec3 {\n  out[0] = floor(a[0] * s);\n  out[1] = floor(a[1] * s);\n  out[2] = floor(a[2] * s);\n  return out;\n}\n\nexport function v3iScale(inout: Vec3, s: number): Vec3 {\n  inout[0] *= s;\n  inout[1] *= s;\n  inout[2] *= s;\n  return inout;\n}\n\nexport function v3set(out: Vec3, a: number, b: number, c: number): Vec3 {\n  out[0] = a;\n  out[1] = b;\n  out[2] = c;\n  return out;\n}\n\nexport function v3sub(out: Vec3, a: ROVec3, b: ROVec3): Vec3 {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  return out;\n}\n\nexport function v3iSub(inout: Vec3, b: ROVec3): Vec3 {\n  inout[0] -= b[0];\n  inout[1] -= b[1];\n  inout[2] -= b[2];\n  return inout;\n}\n\nexport function v3zero(out: Vec3): Vec3 {\n  out[0] = out[1] = out[2] = 0;\n  return out;\n}\n\n\nexport function v4add(out: Vec4, a: ROVec4, b: ROVec4): Vec4 {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  return out;\n}\n\nexport function v4clone(a: ROVec4): Vec4 {\n  return a.slice(0) as Vec4;\n}\n\nexport function v4copy(out: Vec4, a: ROVec4): Vec4 {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  return out;\n}\n\nexport function v4dot(a: ROVec4, b: ROVec4): number {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\n}\n\nexport function v4fromRGBA(rgba: number): Vec4 {\n  let r = rgba >>> 24;\n  let g = (rgba & 0x00FF0000) >> 16;\n  let b = (rgba & 0x0000FF00) >> 8;\n  let a = rgba & 0xFF;\n  return vec4(r/255, g/255, b/255, a/255);\n}\n\nexport function v4lerp(out: Vec4, t: number, a: ROVec4, b: ROVec4): Vec4 {\n  let it = 1 - t;\n  out[0] = it * a[0] + t * b[0];\n  out[1] = it * a[1] + t * b[1];\n  out[2] = it * a[2] + t * b[2];\n  out[3] = it * a[3] + t * b[3];\n  return out;\n}\n\nexport function v4mul(out: Vec4, a: ROVec4, b: ROVec4): Vec4 {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  out[3] = a[3] * b[3];\n  return out;\n}\n\nexport function v4mulAdd(out: Vec4, a: ROVec4, b: ROVec4, c: Vec4): Vec4 {\n  out[0] = a[0] * b[0] + c[0];\n  out[1] = a[1] * b[1] + c[1];\n  out[2] = a[2] * b[2] + c[2];\n  out[3] = a[3] * b[3] + c[3];\n  return out;\n}\n\nexport function v4same(a: ROVec4, b: ROVec4): boolean {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n}\n\nexport function v4scale(out: Vec4, a: ROVec4, s:number): Vec4 {\n  out[0] = a[0] * s;\n  out[1] = a[1] * s;\n  out[2] = a[2] * s;\n  out[3] = a[3] * s;\n  return out;\n}\n\nexport function v4set(out: Vec4, a: number, b: number, c: number, d: number): Vec4 {\n  out[0] = a;\n  out[1] = b;\n  out[2] = c;\n  out[3] = d;\n  return out;\n}\n\nexport function v4zero(out: Vec4): Vec4 {\n  out[0] = out[1] = out[2] = out[3] = 0;\n  return out;\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nexport let wsstats = { msgs: 0, bytes: 0 };\nexport let wsstats_out = { msgs: 0, bytes: 0 };\n\n/* eslint-disable import/order */\nconst ack = require('./ack.js');\nconst assert = require('assert');\nconst { ackHandleMessage, ackReadHeader, ackWrapPakStart, ackWrapPakPayload, ackWrapPakFinish } = ack;\nconst { random, round } = Math;\nconst { isPacket, packetCreate, packetDefaultFlags, packetFromBuffer } = require('./packet.js');\nconst { perfCounterAddValue } = require('./perfcounters.js');\n\nexport const CONNECTION_TIMEOUT = 60000;\nexport const PING_TIME = CONNECTION_TIMEOUT / 2;\n\n// Rough estimate, if over, will prevent resizing the packet\nconst PAK_HEADER_SIZE = 1 + // flags\n  1+16 + // message id\n  1+9; // resp_pak_id\n\nlet net_delay = 0;\nlet net_delay_rand = 0;\n\nfunction socketSendInternal(client, buf, pak) {\n  if (client.ws_server) {\n    client.socket.send(buf, pak.pool.bind(pak));\n  } else {\n    // Testing code to fake sending string packets for debugging\n    // Note: though we can successfully decode these string packets, ones seen\n    //   in the wild appear to have lost data and cannot be decoded in the same\n    //   way.\n    // let str = [];\n    // for (let ii = 0; ii < buf.length; ++ii) {\n    //   str.push(String.fromCharCode(buf[ii]));\n    // }\n    // client.socket.send(str.join(''));\n\n    client.socket.send(buf);\n    pak.pool();\n  }\n}\n\nexport function netDelaySet(delay, rand) {\n  if (delay === undefined) {\n    // development defaults\n    delay = 100;\n    rand = 50;\n  }\n  if (delay) {\n    console.log(`NetDelay: ON (${delay}+${rand})`);\n  } else {\n    console.log('NetDelay: Off');\n  }\n  net_delay = delay;\n  net_delay_rand = rand;\n}\n\nexport function netDelayGet() {\n  return [net_delay, net_delay_rand];\n}\n\nfunction NetDelayer(client, socket) {\n  this.client = client;\n  this.head = null;\n  this.tail = null;\n  this.tick = this.tickFn.bind(this);\n}\nNetDelayer.prototype.send = function (buf, pak) {\n  let now = Date.now();\n  let delay = round(net_delay + net_delay_rand * random());\n  let time = now + delay;\n  let elem = { buf, pak, time, next: null };\n  if (this.tail) {\n    this.tail.next = elem;\n    this.tail = elem;\n  } else {\n    this.head = this.tail = elem;\n    setTimeout(this.tick, delay);\n  }\n};\nNetDelayer.prototype.tickFn = function () {\n  let { client } = this;\n  if (client.net_delayer !== this) {\n    // we've been disconnected, just don't ever write these packets\n    while (this.head) {\n      let elem = this.head;\n      elem.pak.pool();\n      this.head = elem.next;\n    }\n    this.tail = null;\n    return;\n  }\n  // Send at least first, possibly more, then schedule tick if any left\n  let now = Date.now();\n  do {\n    // Pop it\n    let elem = this.head;\n    this.head = elem.next;\n    if (!this.head) {\n      this.tail = null;\n    }\n    // Send it\n    let { buf, pak } = elem;\n    socketSendInternal(client, buf, pak);\n  } while (this.head && this.head.time <= now);\n  if (this.head) {\n    setTimeout(this.tick, this.head.time - now);\n  }\n};\n\nexport function wsPakSendDest(client, pak) {\n  if (!client.connected || client.socket.readyState !== 1) {\n    // We only get to this particular location from wsserver.broadcast*, all\n    //   other paths will print the actual message and error earlier.\n    console.warn(`Attempting to send on a disconnected link (client_id:${client.id}), ignoring`);\n    pak.pool();\n    return;\n  }\n  let buf = pak.getBuffer(); // a Uint8Array\n  let buf_len = pak.getBufferLen();\n  if (buf_len !== buf.length) {\n    buf = new Uint8Array(buf.buffer, buf.byteOffset, buf_len);\n  }\n  perfCounterAddValue('net.send_bytes.total', buf.length);\n  wsstats_out.msgs++;\n  wsstats_out.bytes += buf.length;\n  if (net_delay) {\n    if (!client.net_delayer) {\n      client.net_delayer = new NetDelayer(client);\n    }\n    client.net_delayer.send(buf, pak);\n  } else {\n    socketSendInternal(client, buf, pak);\n  }\n  client.last_send_time = Date.now();\n}\n\nfunction wsPakSendFinish(pak, err, resp_func) {\n  let { client, msg } = pak.ws_data;\n  delete pak.ws_data;\n  let ack_resp_pkt_id = ackWrapPakFinish(pak, err, resp_func);\n\n  if (!client.connected || client.socket.readyState !== 1) { // WebSocket.OPEN\n    if (msg === 'channel_msg') { // client -> server channel message, attach additional debugging info\n      pak.seek(0);\n      pak.readFlags();\n      let header = ackReadHeader(pak);\n      let is_packet = isPacket(header.data);\n      let channel_id;\n      let submsg;\n      if (is_packet) {\n        pak.ref(); // deal with auto-pool of an empty packet\n        channel_id = pak.readAnsiString();\n        submsg = pak.readAnsiString();\n        if (!pak.ended()) {\n          pak.pool();\n        }\n      } else {\n        channel_id = header.data.channel_id;\n        submsg = header.data.msg;\n      }\n      msg = `channel_msg:${channel_id}:${submsg}`;\n    }\n    if (typeof msg !== 'number') {\n      (client.log ? client : console).log(`Attempting to send msg=${msg} on a disconnected link, ignoring`);\n      if (!client.log && client.onError && msg) {\n        // On the client, if we try to send a new packet while disconnected, this is an application error\n        client.onError(`Attempting to send msg=${msg} on a disconnected link`);\n      }\n    }\n\n    if (ack_resp_pkt_id) {\n      // Callback will never be dispatched through ack.js, remove the callback here\n      delete client.resp_cbs[ack_resp_pkt_id];\n    }\n    pak.pool();\n    return;\n  }\n\n  assert.equal(Boolean(resp_func && resp_func.expecting_response !== false), Boolean(ack_resp_pkt_id));\n\n  wsPakSendDest(client, pak);\n}\n\nfunction wsPakSend(err, resp_func) {\n  let pak = this; // eslint-disable-line @typescript-eslint/no-invalid-this\n  if (typeof err === 'function' && !resp_func) {\n    resp_func = err;\n    err = null;\n  }\n  wsPakSendFinish(pak, err, resp_func);\n}\n\nexport function wsPak(msg, ref_pak, client) {\n  assert(typeof msg === 'string' || typeof msg === 'number');\n\n  // Assume new packet needs to be comparable to old packet, in flags and size\n  let pak = packetCreate(ref_pak ? ref_pak.getInternalFlags() : packetDefaultFlags(),\n    ref_pak ? ref_pak.totalSize() + PAK_HEADER_SIZE : 0);\n  pak.writeFlags();\n\n  ackWrapPakStart(pak, client, msg);\n\n  pak.ws_data = {\n    msg,\n    client,\n  };\n  pak.send = wsPakSend;\n  return pak;\n}\n\nfunction sendMessageInternal(client, msg, err, data, resp_func) {\n  let is_packet = isPacket(data);\n  let pak = wsPak(msg, is_packet ? data : null, client);\n\n  if (!err) {\n    ackWrapPakPayload(pak, data);\n  }\n\n  pak.send(err, resp_func);\n}\n\nexport function sendMessage(msg, data, resp_func) {\n  sendMessageInternal(this, msg, null, data, resp_func); // eslint-disable-line @typescript-eslint/no-invalid-this\n}\n\nexport function wsHandleMessage(client, buf, filter) {\n  ++wsstats.msgs;\n  let now = Date.now();\n  let source = client.id ? `client ${client.id}` : 'server';\n  if (!(buf instanceof Uint8Array)) {\n    (client.log ? client : console).log(`Received incorrect WebSocket data type from ${source} (${typeof buf})`);\n    if (typeof buf === 'string') {\n      (client.log ? client : console).log(`Invalid WebSocket data: ${JSON.stringify(buf.slice(0, 120))}`);\n    }\n    if (client.ws_server) {\n      if (!client.has_warned_about_text) {\n        // Send an generic error (still as binary, since if they got this far, they\n        //   must have received the binary `cack` successfully.\n        client.has_warned_about_text = true;\n        client.send('error', 'Server received non-binary WebSocket data.  ' +\n          'Likely cause is a proxy, VPN or something else intercepting and modifying network traffic.');\n      }\n      return;\n    }\n    return void client.onError('Invalid data received');\n  }\n  wsstats.bytes += buf.length;\n  let pak = packetFromBuffer(buf, buf.length, false);\n  pak.readFlags();\n  client.last_receive_time = now;\n  client.idle_counter = 0;\n\n  return void ackHandleMessage(client, source, pak, function sendFunc(msg, err, data, resp_func) {\n    if (resp_func && !resp_func.expecting_response) {\n      resp_func = null;\n    }\n    sendMessageInternal(client, msg, err, data, resp_func);\n  }, function pakFunc(msg, ref_pak) {\n    return wsPak(msg, ref_pak, client);\n  }, function handleFunc(msg, data, resp_func) {\n    let handler = client.handlers[msg];\n    if (!handler) {\n      let error_msg = `No handler for message ${JSON.stringify(msg)} from ${source}`;\n      console.error(error_msg, isPacket(data) ? data.contents() : data);\n      if (client.onError) {\n        return client.onError(error_msg);\n      }\n      return resp_func(error_msg);\n    }\n    return handler(client, data, resp_func);\n  }, filter);\n}\n"]}