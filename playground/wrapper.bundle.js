(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){"use strict";module.exports=create;function create(){var out=new Float32Array(9);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out}},{}],2:[function(require,module,exports){"use strict";module.exports=fromMat4;function fromMat4(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[4];out[4]=a[5];out[5]=a[6];out[6]=a[8];out[7]=a[9];out[8]=a[10];return out}},{}],3:[function(require,module,exports){"use strict";module.exports=copy;function copy(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out}},{}],4:[function(require,module,exports){"use strict";module.exports=create;function create(){var out=new Float32Array(16);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}},{}],5:[function(require,module,exports){"use strict";module.exports=invert;function invert(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a02*b10-a01*b11-a03*b09)*det;out[2]=(a31*b05-a32*b04+a33*b03)*det;out[3]=(a22*b04-a21*b05-a23*b03)*det;out[4]=(a12*b08-a10*b11-a13*b07)*det;out[5]=(a00*b11-a02*b08+a03*b07)*det;out[6]=(a32*b02-a30*b05-a33*b01)*det;out[7]=(a20*b05-a22*b02+a23*b01)*det;out[8]=(a10*b10-a11*b08+a13*b06)*det;out[9]=(a01*b08-a00*b10-a03*b06)*det;out[10]=(a30*b04-a31*b02+a33*b00)*det;out[11]=(a21*b02-a20*b04-a23*b00)*det;out[12]=(a11*b07-a10*b09-a12*b06)*det;out[13]=(a00*b09-a01*b07+a02*b06)*det;out[14]=(a31*b01-a30*b03-a32*b00)*det;out[15]=(a20*b03-a21*b01+a22*b00)*det;return out}},{}],6:[function(require,module,exports){"use strict";module.exports=multiply;function multiply(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=b0*a00+b1*a10+b2*a20+b3*a30;out[1]=b0*a01+b1*a11+b2*a21+b3*a31;out[2]=b0*a02+b1*a12+b2*a22+b3*a32;out[3]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[4];b1=b[5];b2=b[6];b3=b[7];out[4]=b0*a00+b1*a10+b2*a20+b3*a30;out[5]=b0*a01+b1*a11+b2*a21+b3*a31;out[6]=b0*a02+b1*a12+b2*a22+b3*a32;out[7]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[8];b1=b[9];b2=b[10];b3=b[11];out[8]=b0*a00+b1*a10+b2*a20+b3*a30;out[9]=b0*a01+b1*a11+b2*a21+b3*a31;out[10]=b0*a02+b1*a12+b2*a22+b3*a32;out[11]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[12];b1=b[13];b2=b[14];b3=b[15];out[12]=b0*a00+b1*a10+b2*a20+b3*a30;out[13]=b0*a01+b1*a11+b2*a21+b3*a31;out[14]=b0*a02+b1*a12+b2*a22+b3*a32;out[15]=b0*a03+b1*a13+b2*a23+b3*a33;return out}},{}],7:[function(require,module,exports){"use strict";module.exports=perspective;function perspective(out,fovy,aspect,near,far){var f=1/Math.tan(fovy/2),nf=1/(near-far);out[0]=f/aspect;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=f;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=2*far*near*nf;out[15]=0;return out}},{}],8:[function(require,module,exports){"use strict";module.exports=transpose;function transpose(out,a){if(out===a){var a01=a[1],a02=a[2],a03=a[3],a12=a[6],a13=a[7],a23=a[11];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a01;out[6]=a[9];out[7]=a[13];out[8]=a02;out[9]=a12;out[11]=a[14];out[12]=a03;out[13]=a13;out[14]=a23}else{out[0]=a[0];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a[1];out[5]=a[5];out[6]=a[9];out[7]=a[13];out[8]=a[2];out[9]=a[6];out[10]=a[10];out[11]=a[14];out[12]=a[3];out[13]=a[7];out[14]=a[11];out[15]=a[15]}return out}},{}],9:[function(require,module,exports){"use strict";exports.virtualToCanvas=virtualToCanvas;exports.set=set;exports.setAspectFixed=setAspectFixed;exports.setAspectFixed2=setAspectFixed2;exports.zoom=zoom;exports.setNormalized=setNormalized;exports.x0=x0;exports.y0=y0;exports.x1=x1;exports.y1=y1;exports.w=w;exports.h=h;exports.xScale=xScale;exports.yScale=yScale;exports.htmlPos=htmlPos;exports.htmlSize=htmlSize;exports.physicalToVirtual=physicalToVirtual;exports.physicalDeltaToVirtual=physicalDeltaToVirtual;exports.virtualToPhysical=virtualToPhysical;exports.tick=tick;exports.startup=startup;var engine=require("./engine.js");var round=Math.round;var data=exports.data=new Float32Array(9);var screen_width=void 0;var screen_height=void 0;var render_width=void 0;var render_height=void 0;var render_viewport_w=exports.render_viewport_w=void 0;var render_viewport_h=exports.render_viewport_h=void 0;var render_offset_x=exports.render_offset_x=void 0;var render_offset_y=exports.render_offset_y=void 0;function reapply(){if(render_width){data[4]=render_width/(data[2]-data[0]);data[5]=render_height/(data[3]-data[1]);data[7]=(data[2]-data[0])/render_viewport_w;data[8]=(data[3]-data[1])/render_viewport_h}else{data[4]=screen_width/(data[2]-data[0]);data[5]=screen_height/(data[3]-data[1])}}function virtualToCanvas(dst,src){dst[0]=(src[0]-data[0])*data[4];dst[1]=(src[1]-data[1])*data[5]}function set(x0,y0,x1,y1){data[0]=x0;data[1]=y0;data[2]=x1;data[3]=y1;reapply()}function setAspectFixed(w,h){var pa=engine.render_width?1:engine.pixel_aspect;var inv_aspect=h/pa/w;var inv_desired_aspect=void 0;if(render_width){inv_desired_aspect=render_height/render_width}else{inv_desired_aspect=screen_height/screen_width}if(inv_aspect>inv_desired_aspect){var margin=(h/pa/inv_desired_aspect-w)/2;set(-margin,0,w+margin,h)}else{var _margin=(w*pa*inv_desired_aspect-h)/2;set(0,-_margin,w,h+_margin)}}function setAspectFixed2(w,h){var pa=engine.render_width?1:engine.pixel_aspect;var inv_aspect=h/pa/w;var inv_desired_aspect=void 0;if(render_width){inv_desired_aspect=render_height/render_width}else{inv_desired_aspect=screen_height/screen_width}if(inv_aspect>inv_desired_aspect){var margin=h/pa/inv_desired_aspect-w;set(0,0,w+margin,h)}else{var _margin2=w*pa*inv_desired_aspect-h;set(0,0,w,h+_margin2)}}function zoom(x,y,factor){var inv_factor=1/factor;set(x-(x-data[0])*inv_factor,y-(y-data[1])*inv_factor,x+(data[2]-x)*inv_factor,y+(data[3]-y)*inv_factor)}function setNormalized(){set(0,0,1,1)}function x0(){return data[0]}function y0(){return data[1]}function x1(){return data[2]}function y1(){return data[3]}function w(){return data[2]-data[0]}function h(){return data[3]-data[1]}function xScale(){return data[4]}function yScale(){return data[5]}function htmlPos(x,y){if(render_width){return[100*(((x-data[0])/data[7]+render_offset_x)/screen_width),100*(((y-data[1])/data[8]+render_offset_y)/screen_height)]}else{return[100*(x-data[0])/(data[2]-data[0]),100*(y-data[1])/(data[3]-data[1])]}}function htmlSize(w,h){if(render_width){return[100*w/data[7]/screen_width,100*h/data[8]/screen_height]}else{return[100*w/(data[2]-data[0]),100*h/(data[3]-data[1])]}}function physicalToVirtual(dst,src){if(render_width){dst[0]=(src[0]*data[6]-render_offset_x)*data[7]+data[0];dst[1]=(src[1]*data[6]-render_offset_y)*data[8]+data[1]}else{dst[0]=src[0]*data[6]/data[4]+data[0];dst[1]=src[1]*data[6]/data[5]+data[1]}}function physicalDeltaToVirtual(dst,src){if(render_width){dst[0]=src[0]*data[6]*data[7];dst[1]=src[1]*data[6]*data[8]}else{dst[0]=src[0]*data[6]/data[4];dst[1]=src[1]*data[6]/data[5]}}function virtualToPhysical(dst,src){if(render_width){dst[0]=(render_offset_x+(src[0]-data[0])/data[7])/data[6];dst[1]=(render_offset_y+(src[1]-data[1])/data[8])/data[6]}else{dst[0]=(src[0]-data[0])*data[4]/data[6];dst[1]=(src[1]-data[1])*data[5]/data[6]}}function tick(){data[6]=window.devicePixelRatio||1;screen_width=engine.width;screen_height=engine.height;var viewport=[0,0,screen_width,screen_height];if(engine.render_width){render_width=engine.render_width;render_height=engine.render_height;var pa=engine.pixel_aspect;var inv_aspect=render_height/pa/render_width;var inv_desired_aspect=screen_height/screen_width;if(inv_aspect>inv_desired_aspect){var margin=(render_height/inv_desired_aspect-render_width*pa)/2*screen_height/render_height;exports.render_offset_x=render_offset_x=round(margin);exports.render_offset_y=render_offset_y=0;exports.render_viewport_w=render_viewport_w=round(screen_width-margin*2);exports.render_viewport_h=render_viewport_h=screen_height}else{var _margin3=(render_width*inv_desired_aspect-render_height/pa)/2*screen_width/render_width;exports.render_offset_x=render_offset_x=0;exports.render_offset_y=render_offset_y=round(_margin3);exports.render_viewport_w=render_viewport_w=screen_width;exports.render_viewport_h=render_viewport_h=round(screen_height-_margin3*2)}viewport[2]=render_width;viewport[3]=render_height}else{render_width=render_height=0;exports.render_offset_x=render_offset_x=0;exports.render_offset_y=render_offset_y=0}reapply();engine.setViewport(viewport)}function startup(){set(0,0,engine.width,engine.height);tick()}},{"./engine.js":12}],10:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.create=create;var glov_input=require("./input.js");var glov_ui=require("./ui.js");var camera2d=require("./camera2d.js");var _require=require("./ui.js"),focuslog=_require.focuslog;var GlovUIEditBox=function(){function GlovUIEditBox(params){this.x=0;this.y=0;this.z=Z.UI;this.w=glov_ui.button_width;this.type="text";this.text="";this.placeholder="";this.initial_focus=false;this.applyParams(params);this.got_focus_in=false;this.got_focus_out=false;this.elem=null;this.input=null;this.submitted=false}_createClass(GlovUIEditBox,[{key:"applyParams",value:function applyParams(params){if(!params){return}for(var f in params){this[f]=params[f]}}},{key:"getText",value:function getText(){return this.text}},{key:"setText",value:function setText(new_text){if(this.input){this.input.value=new_text}this.text=new_text}},{key:"focus",value:function focus(){glov_ui.focusSteal(this)}},{key:"updateFocus",value:function updateFocus(){if(this.got_focus_out){if(glov_ui.isFocusedPeek(this)){glov_input.keyDownEdge(glov_input.KEYS.TAB);if(glov_input.keyDown(glov_input.KEYS.SHIFT)){glov_ui.focusPrev(this)}else{glov_ui.focusNext(this)}}this.got_focus_out=false}if(this.got_focus_in){glov_input.keyDownEdge(glov_input.KEYS.TAB);glov_ui.focusSteal(this);this.got_focus_in=false}var focused=glov_ui.focusCheck(this);if(focused&&this.input&&document.activeElement!==this.input){this.input.focus()}if(!focused&&this.input&&document.activeElement===this.input){this.input.blur()}if(focused&&glov_input.keyDownEdge(glov_input.KEYS.ESC)){if(this.text){this.setText("")}else{glov_ui.focusCanvas()}}return focused}},{key:"run",value:function run(params){var _this=this;this.applyParams(params);var focused=this.updateFocus();glov_ui.this_frame_edit_boxes.push(this);var elem=glov_ui.getElem();if(elem!==this.elem){if(elem){elem.textContent="";var form=document.createElement("form");var input=document.createElement("input");input.setAttribute("type",this.type);input.setAttribute("placeholder",this.placeholder);input.setAttribute("tabindex",2);input.addEventListener("focusin",function(ev){focuslog("EditBox:focusin",_this);_this.got_focus_in=true;ev.preventDefault()},true);input.addEventListener("focusout",function(ev){focuslog("EditBox:focusout",_this);_this.got_focus_out=true;ev.preventDefault()},true);form.addEventListener("submit",function(ev){ev.preventDefault();_this.submitted=true},true);form.appendChild(input);var span=document.createElement("span");span.setAttribute("tabindex",3);form.appendChild(span);elem.appendChild(form);input.value=this.text;this.input=input;if(this.initial_focus){input.focus()}}else{this.input=null}this.submitted=false;this.elem=elem}else{if(this.input){this.text=this.input.value}}if(elem){var pos=camera2d.htmlPos(this.x,this.y);elem.style.left=pos[0]+"%";elem.style.top=pos[1]+"%";var size=camera2d.htmlSize(this.w,this.h);elem.style.width=size[0]+"%"}if(focused){glov_input.eatAllKeyboardInput()}if(this.submitted){this.submitted=false;return this.SUBMIT}return null}},{key:"unrun",value:function unrun(){this.elem=null;this.input=null}}]);return GlovUIEditBox}();GlovUIEditBox.prototype.SUBMIT="submit";function create(params){return new GlovUIEditBox(params)}},{"./camera2d.js":9,"./input.js":15,"./ui.js":27}],11:[function(require,module,exports){"use strict";exports.grayScaleMatrix=grayScaleMatrix;exports.sepiaMatrix=sepiaMatrix;exports.negativeMatrix=negativeMatrix;exports.saturationMatrix=saturationMatrix;exports.hueMatrix=hueMatrix;exports.brightnessAddMatrix=brightnessAddMatrix;exports.brightnessScaleMatrix=brightnessScaleMatrix;exports.additiveMatrix=additiveMatrix;exports.contrastMatrix=contrastMatrix;exports.applyCopy=applyCopy;exports.applyPixelyExpand=applyPixelyExpand;exports.applyGaussianBlur=applyGaussianBlur;exports.applyColorMatrix=applyColorMatrix;var engine=require("./engine.js");var geom=require("./geom.js");var shaders=require("./shaders.js");var textures=require("./textures.js");var _require=require("./vmath.js"),vec2=_require.vec2,vec4=_require.vec4,v4set=_require.v4set;var shader_data={vp_copy:{vp:"#pragma WebGL\nprecision highp float;\n\nvarying vec2 interp_texcoord;\nattribute vec2 POSITION;\n\nuniform vec2 copy_uv_scale;\nuniform vec4 clip_space;\n\nvoid main()\n{\n  interp_texcoord = POSITION * copy_uv_scale;\n  gl_Position = vec4(POSITION * clip_space.xy + clip_space.zw, 0, 1);\n}"},copy:{fp:"#pragma WebGL\n\nprecision highp float;\nprecision highp int;\n\nvarying vec2 interp_texcoord;\n\nuniform sampler2D inputTexture0;\nvoid main()\n{\n  gl_FragColor = texture2D(inputTexture0, interp_texcoord);\n}\n"},pixely_expand:{fp:"// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n#pragma WebGL\n\nprecision mediump float;\nprecision mediump int;\n\nvarying highp vec2 interp_texcoord;\nuniform sampler2D inputTexture0; // source\nuniform sampler2D inputTexture1; // hblur\nuniform sampler2D inputTexture2; // hblur+vblur\nuniform vec4 orig_pixel_size;\n\n// 1D Gaussian.\nfloat Gaus(float pos, float scale) {\n  return exp2(scale*pos*pos);\n}\n\nconst float SHADE = 0.75;\nconst float EASING = 1.25;\n\n#define DO_WARP\n#ifdef DO_WARP\n// Display warp.\n// 0.0 = none\n// 1.0/8.0 = extreme\nconst vec2 WARP=vec2(1.0/32.0,1.0/24.0);\n\n// Distortion of scanlines, and end of screen alpha.\nvec2 Warp(vec2 pos){\n  pos=pos*2.0-1.0;\n  pos*=vec2(1.0+(pos.y*pos.y)*WARP.x,1.0+(pos.x*pos.x)*WARP.y);\n  return pos*0.5+0.5;\n}\n#else\n#define Warp(v) v\n#endif\n\nfloat easeInOut(float v) {\n  float va = pow(v, EASING);\n  return va / (va + pow((1.0 - v), EASING));\n}\n\nfloat easeIn(float v) {\n  return 2.0 * easeInOut(0.5 * v);\n}\n\nfloat easeOut(float v) {\n  return 2.0 * easeInOut(0.5 + 0.5 * v) - 1.0;\n}\n\nvoid main()\n{\n  vec2 texcoords = Warp(interp_texcoord);\n  vec2 intcoords = (floor(texcoords.xy * orig_pixel_size.xy) + 0.5) * orig_pixel_size.zw;\n  vec2 deltacoords = (texcoords.xy - intcoords) * orig_pixel_size.xy; // -0.5 ... 0.5\n  // for horizontal sampling, map [-0.5 .. -A .. A .. 0.5] -> [-0.5 .. 0 .. 0 .. 0.5];\n  float A = 0.25;\n  float Ainv = (0.5 - A) * 2.0;\n  float uoffs = clamp((abs(deltacoords.x) - A) / Ainv, 0.0, 1.0) * orig_pixel_size.z;\n  uoffs *= sign(deltacoords.x);\n  vec2 sample_coords = vec2(intcoords.x + uoffs, intcoords.y);\n  // sample_coords = intcoords;\n  vec3 color = texture2D(inputTexture1, sample_coords).rgb;\n  vec3 color_scanline = texture2D(inputTexture2, texcoords.xy + vec2(0.0, 0.5 * orig_pixel_size.w)).rgb * SHADE;\n  // color_scanline = vec3(0);\n\n  // float mask = Gaus(deltacoords.y, -12.0);\n  float mask = easeOut(2.0*(0.5 - abs(deltacoords.y)));\n  // float mask = abs(deltacoords.y) > 0.25 ? 0.0 : 1.0;\n  color = mix(color_scanline, color, mask);\n  // color = vec3(mask);\n\n#ifdef DO_WARP\n  // vignette\n  float dist = min(1.0, 100.0 * min(0.5 - abs(texcoords.x - 0.5), 0.5 - abs(texcoords.y - 0.5)));\n  color *= dist;\n#endif\n\n  gl_FragColor = vec4(color, 1.0);\n  // gl_FragColor = vec4(color_scanline, 1.0);\n  // gl_FragColor = vec4(sample_coords, 0.0, 1.0);\n}\n"},gaussian_blur:{fp:"#pragma WebGL\n\nprecision highp float;\nprecision highp int;\n\nvarying vec2 interp_texcoord;\n\nvec4 _ret_0;\nvec4 _TMP2;\nvec4 _TMP1;\nvec2 _c0022;\nvec2 _c0024;\nuniform vec2 sampleRadius;\nuniform sampler2D inputTexture0;\nuniform float Gauss[9];\n\nvoid main()\n{\n  vec2 uv = interp_texcoord;\n  vec2 step = sampleRadius;\n  gl_FragColor =\n    ((texture2D(inputTexture0, uv - step * 3.0) + texture2D(inputTexture0, uv + step * 3.0)) * 0.085625 +\n    (texture2D(inputTexture0, uv - step * 2.0) + texture2D(inputTexture0, uv + step * 2.0)) * 0.12375 +\n    (texture2D(inputTexture0, uv - step * 1.0) + texture2D(inputTexture0, uv + step * 1.0)) * 0.234375 +\n    texture2D(inputTexture0, uv) * 0.3125) * 0.83333333333333333333333333333333;\n}\n"},color_matrix:{fp:"#pragma WebGL\n\nprecision highp float;\n\nvarying vec2 interp_texcoord;\n\nuniform vec4 colorMatrix[3];\nuniform sampler2D tex0;\n\nvoid main()\n{\n  vec4 _color;\n  vec4 _mutc;\n  _color = texture2D(tex0, interp_texcoord);\n  _mutc = _color;\n  _mutc.w = 1.0;\n  vec3 _r0019;\n  _r0019.x = dot(colorMatrix[0], _mutc);\n  _r0019.y = dot(colorMatrix[1], _mutc);\n  _r0019.z = dot(colorMatrix[2], _mutc);\n  _mutc.xyz = _r0019;\n  _mutc.w = _color.w;\n  gl_FragColor = _mutc;\n}"}};function getShader(key){var elem=shader_data[key];if(!elem.shader){if(elem.fp){elem.shader=shaders.create(gl.FRAGMENT_SHADER,elem.fp)}else{elem.shader=shaders.create(gl.VERTEX_SHADER,elem.vp)}}return elem.shader}var inited=false;var clip_space=vec4(2,2,-1,-1);var copy_uv_scale=vec2(1,1);var shader_params_default={clip_space:clip_space,copy_uv_scale:copy_uv_scale};var shader_params_color_matrix=void 0;var shader_params_gaussian_blur=void 0;var shader_params_pixely_expand=void 0;var quad_geom=void 0;function startup(){inited=true;quad_geom=geom.create([[shaders.semantic.POSITION,gl.FLOAT,2,false]],new Float32Array([0,0,1,0,1,1,0,1]),null,geom.QUADS);shader_params_color_matrix={clip_space:clip_space,copy_uv_scale:copy_uv_scale,colorMatrix:new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0])};shader_params_gaussian_blur={clip_space:clip_space,copy_uv_scale:copy_uv_scale,sampleRadius:vec2(1,1),Gauss:new Float32Array([.93,.8,.7,.6,.5,.4,.3,.2,.1])};shader_params_pixely_expand={clip_space:clip_space,copy_uv_scale:copy_uv_scale,orig_pixel_size:vec4()}}function grayScaleMatrix(dst){dst[0]=.2126;dst[1]=.2126;dst[2]=.2126;dst[3]=.7152;dst[4]=.7152;dst[5]=.7152;dst[6]=.0722;dst[7]=.0722;dst[8]=.0722;dst[9]=dst[10]=dst[11]=0}function sepiaMatrix(dst){dst[0]=.393;dst[1]=.349;dst[2]=.272;dst[3]=.769;dst[4]=.686;dst[5]=.534;dst[6]=.189;dst[7]=.168;dst[8]=.131;dst[9]=dst[10]=dst[11]=0}function negativeMatrix(dst){dst[0]=dst[4]=dst[8]=-1;dst[1]=dst[2]=dst[3]=dst[5]=dst[6]=dst[7]=0;dst[9]=dst[10]=dst[11]=1}function saturationMatrix(dst,saturationScale){var is=1-saturationScale;dst[0]=is*.2126+saturationScale;dst[1]=is*.2126;dst[2]=is*.2126;dst[3]=is*.7152;dst[4]=is*.7152+saturationScale;dst[5]=is*.7152;dst[6]=is*.0722;dst[7]=is*.0722;dst[8]=is*.0722+saturationScale;dst[9]=dst[10]=dst[11]=0}function hueMatrix(dst,angle){var c=Math.cos(angle);var s=Math.sin(angle);dst[0]=.7874*c+-.3712362230889293*s+.2126;dst[1]=-.2126*c+.20611404610069642*s+.2126;dst[2]=-.2126*c+-.9485864922785551*s+.2126;dst[3]=-.7152*c+-.4962902913954023*s+.7152;dst[4]=.2848*c+.08105997779422341*s+.7152;dst[5]=-.7152*c+.6584102469838492*s+.7152;dst[6]=-.0722*c+.8675265144843316*s+.0722;dst[7]=-.0722*c+-.28717402389491986*s+.0722;dst[8]=.9278*c+.290176245294706*s+.0722;dst[9]=dst[10]=dst[11]=0}function brightnessAddMatrix(dst,brightnessOffset){dst[0]=dst[4]=dst[8]=1;dst[1]=dst[2]=dst[3]=dst[5]=dst[6]=dst[7]=0;dst[9]=dst[10]=dst[11]=brightnessOffset}function brightnessScaleMatrix(dst,scale){dst[0]=dst[4]=dst[8]=scale;dst[1]=dst[2]=dst[3]=dst[5]=dst[6]=dst[7]=0;dst[9]=dst[10]=dst[11]=0}function additiveMatrix(dst,additiveRGB){dst[0]=dst[4]=dst[8]=1;dst[1]=dst[2]=dst[3]=dst[5]=dst[6]=dst[7]=0;dst[9]=additiveRGB[0];dst[10]=additiveRGB[1];dst[11]=additiveRGB[2]}function contrastMatrix(dst,contrastScale){dst[0]=dst[4]=dst[8]=contrastScale;dst[1]=dst[2]=dst[3]=dst[5]=dst[6]=dst[7]=0;dst[9]=dst[10]=dst[11]=.5*(1-contrastScale)}function applyEffect(effect,view_w,view_h){var viewport=engine.viewport;var target_w=viewport[2];var target_h=viewport[3];view_w=view_w||target_w;view_h=view_h||target_h;clip_space[0]=2*view_w/target_w;clip_space[1]=2*view_h/target_h;shaders.bind(getShader("vp_copy"),getShader(effect.shader),effect.params);textures.bindArray(effect.texs);quad_geom.draw()}function applyCopy(params){if(!inited){startup()}applyEffect({shader:"copy",params:shader_params_default,texs:[params.source]})}function applyPixelyExpand(params){if(!inited){startup()}var source=params.source;source.setSamplerState({filter_min:gl.LINEAR,filter_mag:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE});var resx=source.width;var resy=source.height;var sampleRadius=(params.hblur||.25)/resx;shader_params_gaussian_blur.sampleRadius[0]=sampleRadius;shader_params_gaussian_blur.sampleRadius[1]=0;applyEffect({shader:"gaussian_blur",params:shader_params_gaussian_blur,texs:[source]},resx,resy);var hblur=engine.captureFramebuffer(null,resx,resy,true,false);sampleRadius=(params.vblur||.75)/resy;shader_params_gaussian_blur.sampleRadius[0]=0;shader_params_gaussian_blur.sampleRadius[1]=sampleRadius;applyEffect({shader:"gaussian_blur",params:shader_params_gaussian_blur,texs:[hblur]},resx,resy);var vblur=engine.captureFramebuffer(null,resx,resy,true,false);v4set(shader_params_pixely_expand.orig_pixel_size,source.width,source.height,1/source.width,1/source.height);engine.setViewport(params.final_viewport);if(params.clear_color){gl.clearColor(params.clear_color[0],params.clear_color[1],params.clear_color[2],params.clear_color[3]);gl.clear(gl.COLOR_BUFFER_BIT)}applyEffect({shader:"pixely_expand",params:shader_params_pixely_expand,texs:[source,hblur,vblur]})}function applyGaussianBlur(params){if(!inited){startup()}var source=params.source;source.setSamplerState({filter_min:gl.LINEAR,filter_mag:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE});var max_size=params.max_size||512;var min_size=params.min_size||128;var inputTexture0=source;var viewport=engine.viewport;var res=max_size;while(res>viewport[2]||res>viewport[3]){res/=2}while(res>min_size){applyEffect({shader:"copy",params:shader_params_default,texs:[inputTexture0]},res,res);inputTexture0=engine.captureFramebuffer(null,res,res,true,false);res/=2}var sampleRadius=(params.blur||1)/res;shader_params_gaussian_blur.sampleRadius[0]=sampleRadius;shader_params_gaussian_blur.sampleRadius[1]=0;applyEffect({shader:"gaussian_blur",params:shader_params_gaussian_blur,texs:[inputTexture0]},res,res);var blur=engine.captureFramebuffer(null,res,res,true,false);shader_params_gaussian_blur.sampleRadius[0]=0;shader_params_gaussian_blur.sampleRadius[1]=sampleRadius;applyEffect({shader:"gaussian_blur",params:shader_params_gaussian_blur,texs:[blur]});return true}function applyColorMatrix(params){if(!inited){startup()}var source=params.source;source.setSamplerState({filter_min:gl.LINEAR,filter_mag:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE});var matrix=params.colorMatrix;var mout=shader_params_color_matrix.colorMatrix;mout[0]=matrix[0];mout[1]=matrix[3];mout[2]=matrix[6];mout[3]=matrix[9];mout[4]=matrix[1];mout[5]=matrix[4];mout[6]=matrix[7];mout[7]=matrix[10];mout[8]=matrix[2];mout[9]=matrix[5];mout[10]=matrix[8];mout[11]=matrix[11];applyEffect({shader:"color_matrix",params:shader_params_color_matrix,texs:[source]});return true}},{"./engine.js":12,"./geom.js":14,"./shaders.js":20,"./textures.js":25,"./vmath.js":29}],12:[function(require,module,exports){"use strict";exports.setGlobalMatrices=setGlobalMatrices;exports.updateMatrices=updateMatrices;exports.postprocessingAllow=postprocessingAllow;exports.getFrameTimestamp=getFrameTimestamp;exports.getFrameIndex=getFrameIndex;exports.getFrameDt=getFrameDt;exports.getFrameDtActual=getFrameDtActual;exports.setState=setState;exports.addTickFunc=addTickFunc;exports.setViewport=setViewport;exports.getTemporaryTexture=getTemporaryTexture;exports.captureFramebuffer=captureFramebuffer;exports.startup=startup;var assert=require("assert");var camera2d=require("./camera2d.js");var effects=require("./effects.js");var glov_font=require("./font.js");var font_info_palanquin32=require("../img/font/palanquin32.json");var geom=require("./geom.js");var input=require("./input.js");var local_storage=require("./local_storage.js");var mat3FromMat4=require("gl-mat3/fromMat4");var mat4Copy=require("gl-mat4/copy");var mat4Invert=require("gl-mat4/invert");var mat4Mul=require("gl-mat4/multiply");var mat4Transpose=require("gl-mat4/transpose");var mat4Perspective=require("gl-mat4/perspective");var asin=Math.asin,cos=Math.cos,min=Math.min,max=Math.max,PI=Math.PI,sin=Math.sin,sqrt=Math.sqrt;var shaders=require("./shaders.js");var sprites=require("./sprites.js");var textures=require("./textures.js");var glov_transition=require("./transition.js");var glov_ui=require("./ui.js");var _require=require("./vmath.js"),mat3=_require.mat3,mat4=_require.mat4,vec3=_require.vec3,vec4=_require.vec4,v3mulMat4=_require.v3mulMat4,v3normalize=_require.v3normalize,v4copy=_require.v4copy;var canvas=void 0;var glov_particles=exports.glov_particles=void 0;var sound_manager=exports.sound_manager=void 0;var width=exports.width=void 0;var height=exports.height=void 0;var pixel_aspect=exports.pixel_aspect=1;var clear_bits=void 0;var game_width=exports.game_width=void 0;var game_height=exports.game_height=void 0;var render_width=exports.render_width=void 0;var render_height=exports.render_height=void 0;var defines=exports.defines={};var ZFAR=exports.ZFAR=1e4;var fov_y=exports.fov_y=45*PI/180;var fov_x=exports.fov_x=1;var mat_projection=exports.mat_projection=mat4();var mat_view=exports.mat_view=mat4();var mat_m=mat4();var mat_vp=mat4();var mat_mv=mat4();var mat_mvp=mat4();var mat_mv_inv_transform=mat3();var light_diffuse=exports.light_diffuse=vec3(.75,.75,.75);var light_dir_vs=vec3(0,0,0);var light_ambient=vec3(.25,.25,.25);var light_dir_ws=exports.light_dir_ws=vec3(-1,-2,-3);var font=exports.font=void 0;var app_state=exports.app_state=null;var pico8_colors=exports.pico8_colors=[vec4(0,0,0,1),vec4(.114,.169,.326,1),vec4(.494,.145,.326,1),vec4(0,.529,.328,1),vec4(.671,.322,.212,1),vec4(.373,.341,.31,1),vec4(.761,.765,.78,1),vec4(1,.945,.91,1),vec4(1,0,.302,1),vec4(1,.639,0,1),vec4(1,.925,.153,1),vec4(0,.894,.212,1),vec4(.161,.678,1,1),vec4(.514,.463,.612,1),vec4(1,.467,.659,1),vec4(1,.8,.667,1)];var fps_style=exports.fps_style=glov_font.style({outline_width:2,outline_color:128,color:4294967295});function setGlobalMatrices(_mat_view){mat4Copy(mat_view,_mat_view);mat4Mul(mat_vp,mat_projection,mat_view);v3normalize(light_dir_ws,light_dir_ws);v3mulMat4(light_dir_vs,light_dir_ws,mat_view)}var mat_temp=mat4();function updateMatrices(mat_model){mat4Copy(mat_m,mat_model);mat4Mul(mat_mv,mat_view,mat_model);mat4Mul(mat_mvp,mat_projection,mat_mv);mat4Invert(mat_temp,mat_mv);mat4Transpose(mat_temp,mat_temp);mat3FromMat4(mat_mv_inv_transform,mat_temp)}var postprocessing_reset_version="2";var postprocessing=exports.postprocessing=local_storage.get("glov_no_postprocessing")!==postprocessing_reset_version;function postprocessingAllow(allow){local_storage.set("glov_no_postprocessing",allow?undefined:postprocessing_reset_version);exports.postprocessing=postprocessing=allow}var global_timer=0;function getFrameTimestamp(){return global_timer}var global_frame_index=0;function getFrameIndex(){return global_frame_index}var this_frame_time=0;function getFrameDt(){return this_frame_time}var this_frame_time_actual=0;function getFrameDtActual(){return this_frame_time_actual}var after_loading_state=null;var is_loading=exports.is_loading=true;function setState(new_state){if(is_loading){after_loading_state=new_state}else{exports.app_state=app_state=new_state}}var mspf=1e3;var mspf_update_time=Date.now();var mspf_frame_count=0;var show_fps=true;var do_borders=true;var do_viewport_postprocess=false;var need_repos=0;var app_tick_functions=[];function addTickFunc(cb){app_tick_functions.push(cb)}var temporary_textures={};function resetEffects(){for(var key in temporary_textures){var temp=temporary_textures[key];while(temp.list.length>temp.idx){temp.list.pop().destroy()}if(!temp.idx){delete temporary_textures[key]}else{temp.idx=0}}}var viewport=exports.viewport=vec4(0,0,1,1);function setViewport(xywh){v4copy(viewport,xywh);gl.viewport(xywh[0],xywh[1],xywh[2],xywh[3])}function getTemporaryTexture(w,h){var key=w?w+"_"+h:"screen";var temp=temporary_textures[key];if(!temp){temp=temporary_textures[key]={list:[],idx:0}}if(temp.idx>=temp.list.length){var _tex=textures.createForCapture();temp.list.push(_tex)}var tex=temp.list[temp.idx++];tex.override_sampler=null;return tex}function captureFramebuffer(tex,w,h,do_filter_linear,do_wrap){if(!w&&render_width){w=render_width;h=render_height}if(!tex){tex=getTemporaryTexture(w,h)}if(w){tex.copyTexImage(viewport[0],viewport[1],w,h)}else{tex.copyTexImage(0,0,width,height)}tex.setSamplerState({filter_min:do_filter_linear?gl.LINEAR:gl.NEAREST,filter_mag:do_filter_linear?gl.LINEAR:gl.NEAREST,wrap_s:do_wrap?gl.REPEAT:gl.CLAMP_TO_EDGE,wrap_t:do_wrap?gl.REPEAT:gl.CLAMP_TO_EDGE});return tex}var last_tick=Date.now();function tick(){var now=Date.now();requestAnimationFrame(tick);this_frame_time_actual=now-last_tick;var dt=min(max(this_frame_time_actual,1),250);this_frame_time=dt;last_tick=now;global_timer+=dt;++global_frame_index;++mspf_frame_count;if(now-mspf_update_time>1e3){mspf=(now-mspf_update_time)/mspf_frame_count;mspf_frame_count=0;mspf_update_time=now}if(document.hidden||document.webkitHidden){resetEffects();return}exports.width=width=canvas.width;exports.height=height=canvas.height;var rise=width/height*sin(fov_y/2)/cos(fov_y/2);exports.fov_x=fov_x=2*asin(rise/sqrt(rise*rise+1));mat4Perspective(mat_projection,fov_y,width/height,.7,ZFAR);gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);gl.enable(gl.BLEND);gl.enable(gl.DEPTH_TEST);textures.bind(0,textures.textures.error);camera2d.tick();camera2d.setAspectFixed(game_width,game_height);sound_manager.tick(dt);input.tick();glov_ui.tick(dt);if(need_repos){--need_repos;var ul=[];camera2d.virtualToPhysical(ul,[0,0]);var lr=[];camera2d.virtualToPhysical(lr,[game_width-1,game_height-1]);var viewport2=[ul[0],ul[1],lr[0],lr[1]];var view_height=viewport2[3]-viewport2[1];var font_size=Math.min(256,Math.max(2,Math.floor(view_height/800*16)));document.getElementById("fullscreen").style["font-size"]=font_size+"px"}if(do_borders){glov_ui.drawRect(camera2d.x0(),camera2d.y0(),camera2d.x1(),0,Z.BORDERS,pico8_colors[0]);glov_ui.drawRect(camera2d.x0(),game_height,camera2d.x1(),camera2d.y1(),Z.BORDERS,pico8_colors[0]);glov_ui.drawRect(camera2d.x0(),0,0,game_height,Z.BORDERS,pico8_colors[0]);glov_ui.drawRect(game_width,0,camera2d.x1(),game_height,Z.BORDERS,pico8_colors[0])}for(var ii=0;ii<app_tick_functions.length;++ii){app_tick_functions[ii](dt)}if(app_state){app_state(dt)}if(show_fps){camera2d.setAspectFixed(game_width,game_height);font.drawSizedAligned(fps_style,camera2d.x0(),camera2d.y0(),Z.FPSMETER,glov_ui.font_height,glov_font.ALIGN.HRIGHT,camera2d.w(),0,"FPS: "+(1e3/mspf).toFixed(1)+" ("+mspf.toFixed(0)+"ms/f)")}glov_particles.tick(dt);glov_transition.render(dt);gl.viewport(viewport[0],viewport[1],viewport[2],viewport[3]);gl.clear(clear_bits);sprites.draw();glov_ui.endFrame();if(render_width){var source=captureFramebuffer();var clear_color=[0,0,0,1];var final_viewport=[camera2d.render_offset_x,camera2d.render_offset_y,camera2d.render_viewport_w,camera2d.render_viewport_h];if(do_viewport_postprocess){effects.applyPixelyExpand({source:source,final_viewport:final_viewport,clear_color:clear_color})}else{if(clear_color){gl.clearColor(clear_color[0],clear_color[1],clear_color[2],clear_color[3]);gl.clear(gl.COLOR_BUFFER_BIT)}setViewport(final_viewport);effects.applyCopy({source:source})}}input.endFrame();resetEffects()}function startup(params){window.TurbulenzEngine=null;window.assert=assert;canvas=params.canvas;assert(gl);canvas.focus();exports.game_width=game_width=params.game_width||1280;exports.game_height=game_height=params.game_height||960;if(params.pixely==="strict"){exports.render_width=render_width=game_width;exports.render_height=render_height=game_height;if(params.viewport_postprocess){do_viewport_postprocess=true}}else{exports.render_width=render_width=undefined;exports.render_height=render_height=undefined}exports.pixel_aspect=pixel_aspect=params.pixel_aspect||1;gl.depthFunc(gl.LEQUAL);gl.enable(gl.CULL_FACE);gl.cullFace(gl.BACK);gl.clearColor(0,.1,.2,1);var m=document.location.search.match(/D=(?:[\0-%'-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+/g);if(m){m.forEach(function(v){defines[v.slice(2)]=true})}textures.startup();geom.startup();shaders.startup({light_diffuse:light_diffuse,light_dir_vs:light_dir_vs,ambient:light_ambient,mat_m:mat_m,mat_vp:mat_vp,mvp:mat_mvp,mv_inv_trans:mat_mv_inv_transform,view:mat_view,projection:mat_projection});camera2d.startup();sprites.startup();input.startup(canvas);clear_bits=gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT;exports.glov_particles=glov_particles=require("./particles.js").create();if(params.pixely&&params.pixely!=="off"){textures.defaultFilters(gl.NEAREST,gl.NEAREST)}else{textures.defaultFilters(gl.LINEAR,gl.LINEAR)}exports.sound_manager=sound_manager=require("./sound_manager.js").create();var font_info_04b03x2=require("../img/font/04b03_8x2.json");var font_info_04b03x1=require("../img/font/04b03_8x1.json");if(params.font){exports.font=font=glov_font.create(params.font.info,params.font.texture)}else if(params.pixely==="strict"){exports.font=font=glov_font.create(font_info_04b03x1,"font/04b03_8x1")}else if(params.pixely){exports.font=font=glov_font.create(font_info_04b03x2,"font/04b03_8x2")}else{exports.font=font=glov_font.create(font_info_palanquin32,"font/palanquin32")}glov_ui.startup(font,params.ui_sprites);glov_ui.bindSounds(sound_manager,{button_click:"button_click",rollover:"rollover"});camera2d.setAspectFixed(game_width,game_height);function onResize(){need_repos=10}window.addEventListener("resize",onResize,false);onResize();if(params.state){setState(params.state)}if(params.do_borders!==undefined){do_borders=params.do_borders}if(params.show_fps!==undefined){show_fps=params.show_fps}requestAnimationFrame(tick)}function loading(){var load_count=textures.load_count+sound_manager.loading();document.getElementById("loading_text").innerText="Loading ("+load_count+")...";if(!load_count){var elem=document.getElementById("loading");elem.style.visibility="hidden";exports.is_loading=is_loading=false;exports.app_state=app_state=after_loading_state}}exports.app_state=app_state=loading;window.glov_engine=exports},{"../img/font/04b03_8x1.json":30,"../img/font/04b03_8x2.json":31,"../img/font/palanquin32.json":32,"./camera2d.js":9,"./effects.js":11,"./font.js":13,"./geom.js":14,"./input.js":15,"./local_storage.js":16,"./particles.js":18,"./shaders.js":20,"./sound_manager.js":22,"./sprites.js":24,"./textures.js":25,"./transition.js":26,"./ui.js":27,"./vmath.js":29,assert:35,"gl-mat3/fromMat4":2,"gl-mat4/copy":3,"gl-mat4/invert":5,"gl-mat4/multiply":6,"gl-mat4/perspective":7,"gl-mat4/transpose":8}],13:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.intColorFromVec4Color=intColorFromVec4Color;exports.vec4ColorFromIntColor=vec4ColorFromIntColor;exports.style=style;exports.styleColored=styleColored;exports.styleAlpha=styleAlpha;exports.create=create;function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var assert=require("assert");var camera2d=require("./camera2d.js");var floor=Math.floor,max=Math.max,round=Math.round;var shaders=require("./shaders.js");var sprites=require("./sprites.js");var textures=require("./textures.js");var _require=require("./vmath.js"),clamp=_require.clamp,vec4=_require.vec4,v4clone=_require.v4clone,v4scale=_require.v4scale;var COLOR_MODE=exports.COLOR_MODE={SINGLE:0,GRADIENT:1};var ALIGN=exports.ALIGN={HLEFT:0,HCENTER:1,HRIGHT:2,HMASK:3,VTOP:0<<2,VCENTER:1<<2,VBOTTOM:2<<2,VMASK:3<<2,HFIT:1<<4,HWRAP:1<<5,HCENTERFIT:1|1<<4,HVCENTER:1|1<<2,HVCENTERFIT:1|1<<2|1<<4};function GlovFontDefaultStyle(){}GlovFontDefaultStyle.prototype.outline_width=0;GlovFontDefaultStyle.prototype.outline_color=0;GlovFontDefaultStyle.prototype.glow_xoffs=0;GlovFontDefaultStyle.prototype.glow_yoffs=0;GlovFontDefaultStyle.prototype.glow_inner=0;GlovFontDefaultStyle.prototype.glow_outer=0;GlovFontDefaultStyle.prototype.glow_color=0;GlovFontDefaultStyle.prototype.color=4294967295;GlovFontDefaultStyle.prototype.colorUR=0;GlovFontDefaultStyle.prototype.colorLR=0;GlovFontDefaultStyle.prototype.colorLL=0;GlovFontDefaultStyle.prototype.color_mode=COLOR_MODE.SINGLE;var GlovFontStyle=function(_GlovFontDefaultStyle){_inherits(GlovFontStyle,_GlovFontDefaultStyle);function GlovFontStyle(){return _possibleConstructorReturn(this,(GlovFontStyle.__proto__||Object.getPrototypeOf(GlovFontStyle)).apply(this,arguments))}return GlovFontStyle}(GlovFontDefaultStyle);var font_shaders=exports.font_shaders={};function intColorFromVec4Color(v){return(v[0]*255|0)<<24|(v[1]*255|0)<<16|(v[2]*255|0)<<8|(v[3]*255|0)}function vec4ColorFromIntColor(v,c){v[0]=(c>>24&255)/255;v[1]=(c>>16&255)/255;v[2]=(c>>8&255)/255;v[3]=(c&255)/255}function buildVec4ColorFromIntColor(c){return vec4((c>>24&255)/255,(c>>16&255)/255,(c>>8&255)/255,(c&255)/255)}var glov_font_default_style=exports.glov_font_default_style=new GlovFontStyle;function style(font_style,fields){var ret=new GlovFontStyle;if(font_style){for(var f in font_style){ret[f]=font_style[f]}}for(var _f in fields){ret[_f]=fields[_f]}return ret}function styleColored(font_style,color){return style(font_style,{color:color})}function colorAlpha(color,alpha){alpha=clamp(round((color&255)*alpha),0,255);return color&4294967040|alpha}function styleAlpha(font_style,alpha){return style(font_style,{color:colorAlpha((font_style||glov_font_default_style).color,alpha),outline_color:colorAlpha((font_style||glov_font_default_style).outline_color,alpha),glow_color:colorAlpha((font_style||glov_font_default_style).glow_color,alpha)})}var tech_params=null;var tech_params_dirty=false;var temp_color=null;function createTechniqueParameters(){if(tech_params){return}tech_params={param0:vec4(),outlineColor:vec4(),glowColor:vec4(),glowParams:vec4(),tex0:null};if(!temp_color){temp_color=vec4()}}function techParamsSet(param,value){var tpv=tech_params[param];if(!tech_params_dirty){if(tpv[0]!==value[0]||tpv[1]!==value[1]||tpv[2]!==value[2]||tpv[3]!==value[3]){tech_params={param0:v4clone(tech_params.param0),outlineColor:v4clone(tech_params.outlineColor),glowColor:v4clone(tech_params.glowColor),glowParams:v4clone(tech_params.glowParams)};tech_params_dirty=true;tpv=tech_params[param]}else{return}}if(tech_params_dirty){tpv[0]=value[0];tpv[1]=value[1];tpv[2]=value[2];tpv[3]=value[3]}}function techParamsGet(){tech_params_dirty=false;return tech_params}var GlovFont=function(){function GlovFont(font_info,texture_name){assert(font_info.font_size!==0);this.texture=textures.load({url:"img/"+texture_name+".png",filter_min:font_info.noFilter?gl.NEAREST:gl.LINEAR,filter_mag:font_info.noFilter?gl.NEAREST:gl.LINEAR});this.textures=[this.texture];this.font_info=font_info;this.shader=font_shaders.font_aa;for(var ii=0;ii<font_info.char_infos.length;++ii){var char_info=font_info.char_infos[ii];char_info.scale=1/(char_info.sc||1)}this.char_infos=[];for(var _ii=0;_ii<font_info.char_infos.length;++_ii){var _char_info=font_info.char_infos[_ii];this.char_infos[font_info.char_infos[_ii].c]=_char_info;_char_info.xpad=_char_info.xpad||0;_char_info.yoffs=_char_info.yoffs||0}this.replacement_character=this.infoFromChar(65533);if(!this.replacement_character){this.replacement_character=this.infoFromChar(63)}this.default_style=new GlovFontStyle;this.applied_style=new GlovFontStyle;createTechniqueParameters()}_createClass(GlovFont,[{key:"drawSizedColor",value:function drawSizedColor(style,x,y,z,size,color,text){return this.drawSized(styleColored(style,color),x,y,z,size,text)}},{key:"drawSized",value:function drawSized(style,x,y,z,size,text){return this.drawScaled(style,x,y,z,size/this.font_info.font_size,size/this.font_info.font_size,text)}},{key:"drawSizedAligned",value:function drawSizedAligned(style,_x,_y,z,size,align,w,h,text){var x_size=size;var y_size=size;var width=this.getStringWidth(style,x_size,text);if(align&ALIGN.HFIT&&width>w){var scale=w/width;x_size*=scale;width=w;if(scale<.5){if((align&ALIGN.VMASK)!==ALIGN.VCENTER&&(align&ALIGN.VMASK)!==ALIGN.VBOTTOM){_y+=(y_size-y_size*scale*2)/2}y_size*=scale*2}}var height=y_size;var x=void 0;var y=void 0;switch(align&ALIGN.HMASK){case ALIGN.HCENTER:x=_x+(w-width)/2;if(this.font_info.noFilter){x|=0}break;case ALIGN.HRIGHT:x=_x+w-width;break;case ALIGN.HLEFT:x=_x;break;default:x=_x}switch(align&ALIGN.VMASK){case ALIGN.VCENTER:y=_y+(h-height)/2;if(this.font_info.noFilter){y|=0}break;case ALIGN.VBOTTOM:y=_y+h-height;break;case ALIGN.VTOP:y=_y;break;default:y=_y}return this.drawScaled(style,x,y,z,x_size/this.font_info.font_size,y_size/this.font_info.font_size,text)}},{key:"drawSizedColorWrapped",value:function drawSizedColorWrapped(style,x,y,z,w,indent,size,color,text){return this.drawScaledWrapped(styleColored(style,color),x,y,z,w,indent,size/this.font_info.font_size,size/this.font_info.font_size,text)}},{key:"drawSizedWrapped",value:function drawSizedWrapped(style,x,y,z,w,indent,size,text){return this.drawScaledWrapped(style,x,y,z,w,indent,size/this.font_info.font_size,size/this.font_info.font_size,text)}},{key:"wrapLines",value:function wrapLines(w,indent,size,text,word_cb){return this.wrapLinesScaled(w,indent,size/this.font_info.font_size,text,word_cb)}},{key:"infoFromChar",value:function infoFromChar(c){var ret=this.char_infos[c];if(ret){return ret}if(c>127){return this.replacement_character}return null}},{key:"getCharacterWidth",value:function getCharacterWidth(style,x_size,c){assert(typeof c==="number");this.applyStyle(style);var char_info=this.infoFromChar(c);var xsc=x_size/this.font_info.font_size;var x_advance=this.calcXAdvance(xsc);if(char_info){return(char_info.w+char_info.xpad)*xsc*char_info.scale+x_advance}return 0}},{key:"getStringWidth",value:function getStringWidth(style,x_size,text){this.applyStyle(style);var ret=0;var xsc=x_size/this.font_info.font_size;var x_advance=this.calcXAdvance(xsc);for(var ii=0;ii<text.length;++ii){var c=text.charCodeAt(ii);var char_info=this.infoFromChar(c);if(!char_info){char_info=this.infoFromChar(13)}if(char_info){ret+=(char_info.w+char_info.xpad)*xsc*char_info.scale+x_advance}}return ret}},{key:"wrapLinesScaled",value:function wrapLinesScaled(w,indent,xsc,text,word_cb){var len=text.length;var s=0;var word_start=0;var word_x0=0;var x=word_x0;var linenum=0;var space_info=this.infoFromChar(32);var space_size=(space_info?space_info.w+space_info.xpad:this.font_info.font_size)*xsc;var hard_wrap=false;var x_advance=this.calcXAdvance(xsc);do{var c=s<len?text.charCodeAt(s):0;var newx=x;var char_w=void 0;if(c===9){var tabsize=xsc*this.font_info.font_size*4;newx=(floor(x/tabsize)+1)*tabsize;char_w=tabsize}else{var char_info=this.infoFromChar(c);if(!char_info){char_info=this.infoFromChar(10)}if(char_info){char_w=(char_info.w+char_info.xpad)*xsc*char_info.scale+x_advance;newx=x+char_w}}if(newx>=w&&hard_wrap){if(word_cb){word_cb(word_x0,linenum,text.slice(word_start,s))}word_start=s;word_x0=indent;x=word_x0+char_w;linenum++}else{x=newx}if(!(c===32||c===0||c===10)){s++;c=s<len?text.charCodeAt(s):0}if(c===32||c===0||c===10){hard_wrap=false;if(x>w){var word_width=x-word_x0;if(word_width>w){hard_wrap=true;s=word_start;x=word_x0;continue}else{word_x0=indent;x=word_x0+word_width;linenum++}}if(word_cb){word_cb(word_x0,linenum,text.slice(word_start,s))}word_start=s+1;if(c===10){x=indent;linenum++}else{x+=space_size}word_x0=x;if(c===32||c===10){s++}}}while(s<len);++linenum;return linenum}},{key:"drawScaledWrapped",value:function drawScaledWrapped(style,x,y,z,w,indent,xsc,ysc,text){var _this2=this;if(text===null||text===undefined){text="(null)"}this.applyStyle(style);var num_lines=this.wrapLinesScaled(w,indent,xsc,text,function(xoffs,linenum,word){var y2=y+_this2.font_info.font_size*ysc*linenum;var x2=x+xoffs;_this2.drawScaled(style,x2,y2,z,xsc,ysc,word)});return num_lines*this.font_info.font_size*ysc}},{key:"calcXAdvance",value:function calcXAdvance(xsc){var font_texel_scale=this.font_info.font_size/32;var x_advance=xsc*font_texel_scale*max(this.applied_style.outline_width-2,0);x_advance=max(x_advance,xsc*font_texel_scale*max(this.applied_style.glow_outer-this.applied_style.glow_xoffs-3,0));return x_advance}},{key:"drawScaled",value:function drawScaled(style,_x,y,z,xsc,ysc,text){var x=_x;var font_info=this.font_info;y+=(font_info.y_offset||0)*ysc;var tex=this.texture;var texs=this.textures;if(text===null||text===undefined){text="(null)"}var len=text.length;if(xsc===0||ysc===0){return 0}this.applyStyle(style);var avg_scale_font=(xsc+ysc)*.5;var camera_xscale=camera2d.data[4];var camera_yscale=camera2d.data[5];var avg_scale_combined=(xsc*camera_xscale+ysc*camera_yscale)*.5;var x_advance=this.calcXAdvance(xsc);var font_texel_scale=font_info.font_size/32;var tile_state=0;var applied_style=this.applied_style;var delta_per_source_pixel=.5/font_info.spread;var delta_per_dest_pixel=delta_per_source_pixel/avg_scale_combined;var value=vec4(1/delta_per_dest_pixel,-.5/delta_per_dest_pixel+.5,-.5/delta_per_dest_pixel+.5+applied_style.outline_width*font_texel_scale*avg_scale_combined,0);if(value[2]>0){value[2]=0}var padding1=max(1,applied_style.outline_width*font_texel_scale*avg_scale_combined);var padding4=vec4();var outer_scaled=applied_style.glow_outer*font_texel_scale;padding4[0]=max(outer_scaled*xsc-applied_style.glow_xoffs*font_texel_scale*xsc,padding1);padding4[2]=max(outer_scaled*xsc+applied_style.glow_xoffs*font_texel_scale*xsc,padding1);padding4[1]=max(outer_scaled*ysc-applied_style.glow_yoffs*font_texel_scale*ysc,padding1);padding4[3]=max(outer_scaled*ysc+applied_style.glow_yoffs*font_texel_scale*ysc,padding1);techParamsSet("param0",value);var value2=vec4(0,0,1/((applied_style.glow_outer-applied_style.glow_inner)*delta_per_source_pixel*font_texel_scale),-(.5-applied_style.glow_outer*delta_per_source_pixel*font_texel_scale)/((applied_style.glow_outer-applied_style.glow_inner)*delta_per_source_pixel*font_texel_scale));if(value2[3]>0){value2[3]=0}var padding_in_font_space=vec4();v4scale(padding_in_font_space,padding4,1/avg_scale_font);for(var ii=0;ii<4;++ii){if(padding_in_font_space[ii]>font_info.spread){var sc=font_info.spread/padding_in_font_space[ii];padding4[ii]*=sc;padding_in_font_space[ii]*=sc}}var z_advance=applied_style.glow_xoffs<0?-1e-4:1e-4;var rel_x_scale=xsc/avg_scale_font;var rel_y_scale=ysc/avg_scale_font;for(var i=0;i<len;i++){var c=text.charCodeAt(i);if(c===9){var tabsize=xsc*font_info.font_size*4;x=(((x-_x)/tabsize|0)+1)*tabsize+_x}else{var char_info=this.infoFromChar(c);if(!char_info){char_info=this.infoFromChar(13)}if(char_info){var char_scale=char_info.scale;var xsc2=xsc*char_scale;var ysc2=ysc*char_scale;var pad_scale=1/char_scale;var tile_width=tex.width;var tile_height=tex.height;if(char_scale!==tile_state){value2[0]=-applied_style.glow_xoffs*font_texel_scale*pad_scale/tile_width;value2[1]=-applied_style.glow_yoffs*font_texel_scale*pad_scale/tile_height;techParamsSet("glowParams",value2)}var u0=(char_info.x0-padding_in_font_space[0]*pad_scale)/tile_width;var u1=(char_info.x0+char_info.w+padding_in_font_space[2]*pad_scale)/tile_width;var v0=(char_info.y0-padding_in_font_space[1]*pad_scale)/tile_height;var v1=(char_info.y0+char_info.h+padding_in_font_space[3]*pad_scale)/tile_height;var w=char_info.w*xsc2+(padding4[0]+padding4[2])*rel_x_scale;var h=char_info.h*ysc2+(padding4[1]+padding4[3])*rel_y_scale;sprites.queueraw(texs,x-rel_x_scale*padding4[0],y-rel_y_scale*padding4[2]+char_info.yoffs*ysc2,z+z_advance*i,w,h,u0,v0,u1,v1,buildVec4ColorFromIntColor(applied_style.color),this.shader,techParamsGet());x+=(char_info.w+char_info.xpad)*xsc2+x_advance}}}return x-_x}},{key:"determineShader",value:function determineShader(){var outline=this.applied_style.outline_width&&this.applied_style.outline_color&255;var glow=this.applied_style.glow_outer>0&&this.applied_style.glow_color&255;if(outline){if(glow){this.shader=font_shaders.font_aa_outline_glow}else{this.shader=font_shaders.font_aa_outline}}else if(glow){this.shader=font_shaders.font_aa_glow}else{this.shader=font_shaders.font_aa}}},{key:"applyStyle",value:function applyStyle(style){if(!style){style=this.default_style}vec4ColorFromIntColor(temp_color,style.outline_color);techParamsSet("outlineColor",temp_color);vec4ColorFromIntColor(temp_color,style.glow_color);techParamsSet("glowColor",temp_color);this.applied_style.outline_width=style.outline_width;this.applied_style.outline_color=style.outline_color;this.applied_style.glow_xoffs=style.glow_xoffs;this.applied_style.glow_yoffs=style.glow_yoffs;this.applied_style.glow_inner=style.glow_inner;this.applied_style.glow_outer=style.glow_outer;this.applied_style.glow_color=style.glow_color;this.applied_style.color=style.color;this.applied_style.colorUR=style.colorUR;this.applied_style.colorLR=style.colorLR;this.applied_style.colorLL=style.colorLL;this.applied_style.color_mode=style.color_mode;if(this.applied_style.color_mode===COLOR_MODE.SINGLE){this.applied_style.colorUR=this.applied_style.colorLL=this.applied_style.colorLR=this.applied_style.color}this.determineShader()}}]);return GlovFont}();function fontShadersInit(){if(font_shaders.font_aa){return}font_shaders.font_aa=shaders.create(gl.FRAGMENT_SHADER,"precision lowp float;\n\nvarying vec2 interp_texcoord;\nvarying lowp vec4 interp_color;\nvec4 _ret_0;\nuniform sampler2D tex0;\nuniform vec4 param0;\nvoid main()\n{\n  float texture0 = texture2D(tex0,interp_texcoord).r;\n  float res = clamp(texture0 * param0.x + param0.y, 0.0, 1.0);\n  gl_FragColor = vec4(interp_color.rgb, interp_color.a * res);\n}\n");font_shaders.font_aa_glow=shaders.create(gl.FRAGMENT_SHADER,"precision lowp float;\n\nvarying vec2 interp_texcoord;\nvarying lowp vec4 interp_color;\nvec4 _ret_0;\nuniform sampler2D tex0;\nuniform vec4 param0;\nuniform vec4 glowColor;\nuniform vec4 glowParams;\nvoid main()\n{\n  float texture0=texture2D(tex0,interp_texcoord).r;\n  // Glow\n  vec2 glowCoord = interp_texcoord + glowParams.xy;\n  float textureGlow = texture2D(tex0, glowCoord).r;\n  float t = clamp(textureGlow * glowParams.z + glowParams.w, 0.0, 1.0);\n  vec4 outcolor = vec4(glowColor.xyz, t * glowColor.w);\n  // Main body\n  t = clamp(texture0 * param0.x + param0.y, 0.0, 1.0);\n  gl_FragColor = mix(outcolor, interp_color, t);\n}\n");font_shaders.font_aa_outline=shaders.create(gl.FRAGMENT_SHADER,"precision lowp float;\n\nvarying highp vec2 interp_texcoord;\nvarying lowp vec4 interp_color;\nvec4 _ret_0;\nuniform sampler2D tex0;\nuniform vec4 param0;\nuniform vec4 outlineColor;\nvoid main()\n{\n  float texture0=texture2D(tex0,interp_texcoord).r;\n  // Outline\n  vec4 outcolor = vec4(outlineColor.xyz, 0);\n  outcolor.w = clamp(texture0 * param0.x + param0.z, 0.0, 1.0);\n  outcolor.w = outcolor.w * outlineColor.w;\n  // outcolor = mix(outcolor, outlineColor, outcolor.w); // Makes a blackish border\n  // Main body\n  float t = clamp(texture0 * param0.x + param0.y, 0.0, 1.0);\n  gl_FragColor = mix(outcolor, interp_color, t);\n}\n");font_shaders.font_aa_outline_glow=shaders.create(gl.FRAGMENT_SHADER,"precision lowp float;\n\nvarying highp vec2 interp_texcoord;\nvarying lowp vec4 interp_color;\nvec4 _ret_0;\nuniform sampler2D tex0;\nuniform vec4 param0;\nuniform vec4 outlineColor;\nuniform vec4 glowColor;\nuniform vec4 glowParams;\nvoid main()\n{\n  float texture0=texture2D(tex0,interp_texcoord).r;\n  // Glow\n  vec2 glowCoord = interp_texcoord + glowParams.xy;\n  float textureGlow = texture2D(tex0, glowCoord).r;\n  float t = clamp(textureGlow * glowParams.z + glowParams.w, 0.0, 1.0);\n  vec4 outcolor = vec4(glowColor.xyz, t * glowColor.w);\n  // vec4outclor = t * glowColor.xyz;\n  // Outline\n  t = clamp(texture0 * param0.x + param0.z, 0.0, 1.0);\n  t = t * outlineColor.w;\n  outcolor = mix(outcolor, outlineColor, t);\n  // Main body\n  t = clamp(texture0 * param0.x + param0.y, 0.0, 1.0);\n  gl_FragColor = mix(outcolor, interp_color, t);\n}\n")}function create(){fontShadersInit();for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return new(Function.prototype.bind.apply(GlovFont,[null].concat(args)))}},{"./camera2d.js":9,"./shaders.js":20,"./sprites.js":24,"./textures.js":25,"./vmath.js":29,assert:35}],14:[function(require,module,exports){"use strict";exports.create=create;exports.startup=startup;var assert=require("assert");var ceil=Math.ceil,max=Math.max;var QUADS=exports.QUADS=7;var gl_byte_size={5120:1,5121:1,5122:2,5123:2,5126:4};var bound_geom=void 0;var bound_array_buf=null;var bound_index_buf=null;var quad_index_buf=void 0;var quad_index_buf_len=0;function deleteBuffer(handle){if(!handle){return}if(bound_array_buf===handle){gl.bindBuffer(gl.ARRAY_BUFFER,null);bound_array_buf=null}if(bound_index_buf===handle){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null);bound_index_buf=null}gl.deleteBuffer(handle)}var attrib_enabled=0;function enableVertexAttribArray(bits){if(bits===attrib_enabled){return}var disable_mask=attrib_enabled&~bits;var enable_mask=~attrib_enabled&bits;attrib_enabled=bits;if(disable_mask){var n=0;do{if(disable_mask&1){gl.disableVertexAttribArray(n)}n++;disable_mask>>=1}while(disable_mask)}if(enable_mask){var _n=0;do{if(enable_mask&1){gl.enableVertexAttribArray(_n)}_n++;enable_mask>>=1}while(enable_mask)}}function getQuadIndexBuf(quad_count){assert(quad_count<=16384);if(quad_count*6>quad_index_buf_len){if(!quad_index_buf){quad_index_buf=gl.createBuffer()}quad_index_buf_len=max(ceil(quad_index_buf_len*1.5),quad_count*6);if(bound_index_buf!==quad_index_buf){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,quad_index_buf);bound_index_buf=quad_index_buf}var arr=new Uint16Array(quad_index_buf_len);var vidx=0;for(var ii=0;ii<quad_index_buf_len;){arr[ii++]=vidx+1;arr[ii++]=vidx+3;arr[ii++]=vidx++;arr[ii++]=vidx++;arr[ii++]=vidx++;arr[ii++]=vidx++}gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,arr,gl.STATIC_DRAW)}return quad_index_buf}function Geom(_format,verts,idxs,mode){this.mode=mode||gl.TRIANGLES;this.format=_format;this.stride=0;this.elem_count=0;this.used_attribs=0;for(var ii=0;ii<_format.length;++ii){var fmt=_format[ii];var sem=fmt[0];var gltype=fmt[1];var count=fmt[2];this.used_attribs|=1<<sem;var byte_size=gl_byte_size[gltype];assert(byte_size);fmt[3]=fmt[3]||false;fmt[4]=byte_size;this.stride+=count*byte_size;this.elem_count+=count}this.vert_count=verts.length/this.elem_count;if(verts.length){this.vbo=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.vbo);bound_array_buf=this.vbo;gl.bufferData(gl.ARRAY_BUFFER,verts,gl.STATIC_DRAW)}this.orig_mode=mode;if(idxs){this.ibo=gl.createBuffer();this.ibo_owned=true;this.ibo_size=idxs.length;gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.ibo);bound_index_buf=this.ibo;gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,idxs,gl.STATIC_DRAW)}else if(mode===QUADS){assert(this.vert_count%4===0);var quad_count=this.vert_count/4;this.ibo=getQuadIndexBuf(quad_count);this.ibo_owned=false;this.ibo_size=quad_count*6;this.mode=gl.TRIANGLES}else{this.ibo=null;this.ibo_owned=false}}Geom.prototype.update=function(verts,num_verts){assert(this.orig_mode===QUADS);if(num_verts>this.vert_count){if(bound_geom===this){bound_geom=null}deleteBuffer(this.vbo);this.vert_count=verts.length/this.elem_count;this.vbo=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.vbo);bound_array_buf=this.vbo;gl.bufferData(gl.ARRAY_BUFFER,verts,gl.DYNAMIC_DRAW)}else{if(bound_array_buf!==this.vbo){gl.bindBuffer(gl.ARRAY_BUFFER,this.vbo);bound_array_buf=this.vbo}gl.bufferSubData(gl.ARRAY_BUFFER,0,verts.subarray(0,num_verts*this.elem_count))}var quad_count=num_verts/4;this.ibo=getQuadIndexBuf(quad_count);this.ibo_size=quad_count*6};Geom.prototype.dispose=function(){if(this.ibo_owned){deleteBuffer(this.ibo)}this.ibo=null;deleteBuffer(this.vbo);this.vbo=null};var bound_attribs=function(){var r=[];for(var ii=0;ii<16;++ii){r.push({vbo:null,offset:0})}return r}();Geom.prototype.bind=function(){if(bound_geom!==this){bound_geom=this;var vbo=this.vbo;var offset=0;for(var ii=0;ii<this.format.length;++ii){var fmt=this.format[ii];var count=fmt[2];var byte_size=fmt[4];if(bound_attribs[ii].vbo===vbo){}else{if(bound_array_buf!==vbo){gl.bindBuffer(gl.ARRAY_BUFFER,vbo);bound_array_buf=vbo}var sem=fmt[0];var gltype=fmt[1];var normalized=fmt[3];gl.vertexAttribPointer(sem,count,gltype,normalized,this.stride,offset);bound_attribs[ii].vbo=bound_array_buf}offset+=count*byte_size}enableVertexAttribArray(this.used_attribs);if(this.ibo&&bound_index_buf!==this.ibo){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.ibo);bound_index_buf=this.ibo}}};Geom.prototype.draw=function(){this.bind();assert(this.ibo);gl.drawElements(this.mode,this.ibo_size,gl.UNSIGNED_SHORT,0)};function create(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return new(Function.prototype.bind.apply(Geom,[null].concat(args)))}function startup(){}},{assert:35}],15:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.pointerLocked=pointerLocked;exports.pointerLockEnter=pointerLockEnter;exports.pointerLockExit=pointerLockExit;exports.startup=startup;exports.tick=tick;exports.endFrame=endFrame;exports.eatAllInput=eatAllInput;exports.eatAllKeyboardInput=eatAllKeyboardInput;exports.mousePos=mousePos;exports.mouseWheel=mouseWheel;exports.mouseOver=mouseOver;exports.mouseDown=mouseDown;exports.mousePosIsTouch=mousePosIsTouch;exports.isTouchDown=isTouchDown;exports.numTouches=numTouches;exports.keyDown=keyDown;exports.keyDownEdge=keyDownEdge;exports.keyUpEdge=keyUpEdge;exports.padGetAxes=padGetAxes;exports.padButtonDown=padButtonDown;exports.padButtonDownEdge=padButtonDownEdge;exports.padButtonUpEdge=padButtonUpEdge;exports.mouseUpEdge=mouseUpEdge;exports.mouseDownEdge=mouseDownEdge;exports.drag=drag;var assert=require("assert");var camera2d=require("./camera2d.js");var local_storage=require("./local_storage.js");var glov_engine=require("./engine.js");var abs=Math.abs,min=Math.min,sqrt=Math.sqrt;var _require=require("./vmath.js"),vec2=_require.vec2,v2add=_require.v2add,v2copy=_require.v2copy,v2lengthSq=_require.v2lengthSq,v2set=_require.v2set,v2scale=_require.v2scale,v2sub=_require.v2sub;var UP_EDGE=0;var DOWN_EDGE=1;var DOWN=2;var TOUCH_AS_MOUSE=true;var MAP_ANALOG_TO_DPAD=true;var ANY=exports.ANY=-2;var POINTERLOCK=exports.POINTERLOCK=-1;var KEYS=exports.KEYS={BACKSPACE:8,TAB:9,ENTER:13,RETURN:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INS:45,DEL:46};(function(){for(var ii=1;ii<=12;++ii){KEYS["F"+ii]=111+ii}for(var _ii=48;_ii<=90;++_ii){KEYS[String.fromCharCode(_ii)]=_ii}})();var pad_codes=exports.pad_codes={A:0,SELECT:0,B:1,CANCEL:1,X:2,Y:3,LB:4,LEFT_BUMPER:4,RB:5,RIGHT_BUMPER:5,LT:6,LEFT_TRIGGER:6,RT:7,RIGHT_TRIGGER:7,BACK:8,START:9,LEFT_STICK:10,RIGHT_STICK:11,UP:12,DOWN:13,LEFT:14,RIGHT:15,ANALOG_UP:20,ANALOG_LEFT:21,ANALOG_DOWN:22,ANALOG_RIGHT:23};var canvas=void 0;var key_state={};var pad_states=[];var gamepad_data=[];var mouse_pos=vec2();var last_mouse_pos=vec2();var mouse_pos_is_touch=false;var mouse_over_captured=false;var mouse_down=[];var mouse_wheel=0;var input_eaten_kb=false;var input_eaten_mouse=false;var touches={};var touch_mode=exports.touch_mode=local_storage.getJSON("touch_mode",false);function TouchData(pos,touch,button){this.delta=vec2();this.total=0;this.cur_pos=pos.slice(0);this.start_pos=pos.slice(0);this.release=false;this.touch=touch;this.button=button;this.start_time=Date.now();this.dispatched=false;this.state=DOWN_EDGE}function pointerLocked(){return document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement}var pointerlock_touch_id="m"+POINTERLOCK;function pointerLockEnter(){var touch_data=touches[pointerlock_touch_id];if(touch_data){v2copy(touch_data.start_pos,mouse_pos);touch_data.release=false}else{touch_data=touches[pointerlock_touch_id]=new TouchData(mouse_pos,false,POINTERLOCK);touch_data.state=DOWN}return canvas.requestPointerLock&&canvas.requestPointerLock()}function pointerLockExit(){var touch_data=touches[pointerlock_touch_id];if(touch_data){v2copy(touch_data.cur_pos,mouse_pos);touch_data.state=null;touch_data.release=true}document.exitPointerLock()}function ignored(event){event.preventDefault();event.stopPropagation()}function onKeyUp(event){var code=event.keyCode;if(event.target.tagName!=="INPUT"){event.stopPropagation();event.preventDefault()}if(code===KEYS.ESC&&pointerLocked()){pointerLockExit()}key_state[code]=UP_EDGE}function onKeyDown(event){var code=event.keyCode;if(code!==KEYS.F12&&code!==KEYS.F5&&code!==KEYS.F6&&event.target.tagName!=="INPUT"){event.stopPropagation();event.preventDefault()}key_state[code]=DOWN_EDGE}var temp_delta=vec2();function onMouseMove(event,no_stop){if(touch_mode){local_storage.setJSON("touch_mode",false);exports.touch_mode=touch_mode=false}if(event.target.tagName!=="INPUT"&&!no_stop){event.preventDefault();event.stopPropagation()}if(event.offsetX!==undefined){mouse_pos[0]=event.offsetX;mouse_pos[1]=event.offsetY}else{mouse_pos[0]=event.layerX;mouse_pos[1]=event.layerY}mouse_pos_is_touch=false;var any_movement=false;if(pointerLocked()){if(event.movementX||event.movementY){v2set(temp_delta,event.movementX,event.movementY);any_movement=true}}else{v2sub(temp_delta,mouse_pos,last_mouse_pos);if(temp_delta[0]||temp_delta[1]){any_movement=true}}if(any_movement){for(var button=POINTERLOCK;button<mouse_down.length;++button){if(mouse_down[button]||button===POINTERLOCK&&pointerLocked()){var touch_data=touches["m"+button];if(touch_data){v2add(touch_data.delta,touch_data.delta,temp_delta);touch_data.total+=abs(temp_delta[0])+abs(temp_delta[1]);v2copy(touch_data.cur_pos,mouse_pos)}}}}v2copy(last_mouse_pos,mouse_pos)}function onMouseDown(event){onMouseMove(event);glov_engine.sound_manager.resume();var button=event.button;mouse_down[button]=mouse_pos.slice(0);var touch_id="m"+button;if(touches[touch_id]){v2copy(touches[touch_id].start_pos,mouse_pos);touches[touch_id].release=false}else{touches[touch_id]=new TouchData(mouse_pos,false,button)}}function onMouseUp(event){onMouseMove(event);var no_click=event.target.tagName==="INPUT";var button=event.button;if(mouse_down[button]){var touch_id="m"+button;var touch_data=touches[touch_id];if(touch_data){v2copy(touch_data.cur_pos,mouse_pos);if(!no_click){touch_data.state=UP_EDGE}touch_data.release=true}delete mouse_down[button]}}function onWheel(event){onMouseMove(event,true);if(event.wheelDelta>0){mouse_wheel++}else if(event.wheelDelta<0){mouse_wheel--}}var touch_pos=vec2();function onTouchChange(event){glov_engine.sound_manager.resume();if(!touch_mode){local_storage.set("touch_mode",true);exports.touch_mode=touch_mode=true}if(event.cancelable!==false){event.preventDefault()}var ct=event.touches;var seen={};var new_count=ct.length;var old_count=new_count;for(var ii=0;ii<new_count;++ii){var touch=ct[ii];var last_touch=touches[touch.identifier];v2set(touch_pos,touch.clientX,touch.clientY);if(!last_touch){last_touch=touches[touch.identifier]=new TouchData(touch_pos,true,0);--old_count}else{v2sub(temp_delta,touch_pos,last_touch.cur_pos);v2add(last_touch.delta,last_touch.delta,temp_delta);last_touch.total+=abs(temp_delta[0])+abs(temp_delta[1]);v2copy(last_touch.cur_pos,touch_pos)}seen[touch.identifier]=true;if(TOUCH_AS_MOUSE&&new_count===1){v2copy(mouse_pos,touch_pos);mouse_pos_is_touch=true}}var released_touch=void 0;for(var id in touches){if(!seen[id]){var _touch=touches[id];if(_touch.touch){++old_count;released_touch=_touch;_touch.state=UP_EDGE;_touch.release=true}}}if(TOUCH_AS_MOUSE){if(old_count===1&&new_count===0){delete mouse_down[0];v2copy(mouse_pos,released_touch.cur_pos);mouse_pos_is_touch=true}else if(new_count===1){var _touch2=ct[0];if(!old_count){mouse_down[0]=vec2(_touch2.clientX,_touch2.clientY)}v2set(mouse_pos,_touch2.clientX,_touch2.clientY);mouse_pos_is_touch=true}else if(new_count>1){delete mouse_down[0]}}}function startup(_canvas){canvas=_canvas;var passive_param=false;try{var opts=Object.defineProperty({},"passive",{get:function get(){passive_param={passive:false};return false}});window.addEventListener("test",null,opts);window.removeEventListener("test",null,opts)}catch(e){passive_param=false}canvas.requestPointerLock=canvas.requestPointerLock||canvas.mozRequestPointerLock||canvas.webkitRequestPointerLock;document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||function(){};window.addEventListener("keydown",onKeyDown,false);window.addEventListener("keyup",onKeyUp,false);window.addEventListener("click",ignored,false);window.addEventListener("contextmenu",ignored,false);window.addEventListener("mousemove",onMouseMove,false);window.addEventListener("mousedown",onMouseDown,false);window.addEventListener("mouseup",onMouseUp,false);window.addEventListener("DOMMouseScroll",onWheel,false);window.addEventListener("mousewheel",onWheel,false);canvas.addEventListener("touchstart",onTouchChange,passive_param);canvas.addEventListener("touchmove",onTouchChange,passive_param);canvas.addEventListener("touchend",onTouchChange,passive_param);canvas.addEventListener("touchcancel",onTouchChange,passive_param)}var DEADZONE=.26;var DEADZONE_SQ=DEADZONE*DEADZONE;var NUM_STICKS=2;var PAD_THRESHOLD=.25;function getGamepadData(idx){var gpd=gamepad_data[idx];if(!gpd){gpd=gamepad_data[idx]={timestamp:0,sticks:new Array(NUM_STICKS)};for(var ii=0;ii<NUM_STICKS;++ii){gpd.sticks[ii]=vec2()}pad_states[idx]={}}return gpd}function updatePadState(ps,b,c){if(b&&!ps[c]){ps[c]=DOWN_EDGE}else if(!b&&ps[c]){ps[c]=UP_EDGE}}function gamepadUpdate(){var gamepads=navigator.gamepads||navigator.webkitGamepads||navigator.getGamepads&&navigator.getGamepads()||navigator.webkitGetGamepads&&navigator.webkitGetGamepads();if(gamepads){var numGamePads=gamepads.length;for(var ii=0;ii<numGamePads;ii++){var gamepad=gamepads[ii];if(!gamepad){continue}var gpd=getGamepadData(ii);var ps=pad_states[ii];if(gpd.timestamp<gamepad.timestamp){var buttons=gamepad.buttons;gpd.timestamp=gamepad.timestamp;var numButtons=buttons.length;for(var n=0;n<numButtons;n++){var value=buttons[n];if((typeof value==="undefined"?"undefined":_typeof(value))==="object"){value=value.value}value=value>.5;updatePadState(ps,value,n)}}var axes=gamepad.axes;if(axes.length>=NUM_STICKS*2){for(var _n=0;_n<NUM_STICKS;++_n){var pair=gpd.sticks[_n];v2set(pair,axes[_n*2],-axes[_n*2+1]);var magnitude=v2lengthSq(pair);if(magnitude>DEADZONE_SQ){magnitude=sqrt(magnitude);v2scale(pair,pair,1/magnitude);magnitude=min(magnitude,1);magnitude=(magnitude-DEADZONE)/(1-DEADZONE);v2scale(pair,pair,magnitude)}else{v2set(pair,0,0)}}updatePadState(ps,gpd.sticks[0][0]<-PAD_THRESHOLD,pad_codes.ANALOG_LEFT);updatePadState(ps,gpd.sticks[0][0]>PAD_THRESHOLD,pad_codes.ANALOG_RIGHT);updatePadState(ps,gpd.sticks[0][1]<-PAD_THRESHOLD,pad_codes.ANALOG_DOWN);updatePadState(ps,gpd.sticks[0][1]>PAD_THRESHOLD,pad_codes.ANALOG_UP)}}}}function tick(){mouse_over_captured=false;gamepadUpdate();if(touches[pointerlock_touch_id]&&!pointerLocked()){pointerLockExit()}}function endFrameTickMap(map){Object.keys(map).forEach(function(keycode){switch(map[keycode]){case DOWN_EDGE:map[keycode]=DOWN;break;case UP_EDGE:delete map[keycode];break;default:}})}function endFrame(){endFrameTickMap(key_state);pad_states.forEach(endFrameTickMap);for(var touch_id in touches){var touch_data=touches[touch_id];if(touch_data.release){delete touches[touch_id]}else{touch_data.delta[0]=touch_data.delta[1]=0;touch_data.dispatched=false;if(touch_data.state===DOWN_EDGE){touch_data.state=DOWN}else{assert(touch_data.state!==UP_EDGE)}}}mouse_wheel=0;input_eaten_kb=false;input_eaten_mouse=false}function eatAllInput(){endFrame();mouse_over_captured=true;input_eaten_kb=true;input_eaten_mouse=true}function eatAllKeyboardInput(){var touches_save=touches;var over_save=mouse_over_captured;var eaten_mouse_save=input_eaten_mouse;eatAllInput();touches=touches_save;mouse_over_captured=over_save;input_eaten_mouse=eaten_mouse_save}function mousePos(dst){dst=dst||vec2();camera2d.physicalToVirtual(dst,mouse_pos);return dst}function mouseWheel(){var ret=mouse_wheel;mouse_wheel=0;return ret}function mousePosParam(param){param=param||{};return{x:param.x===undefined?camera2d.x0():param.x,y:param.y===undefined?camera2d.y0():param.y,w:param.w===undefined?camera2d.w():param.w,h:param.h===undefined?camera2d.h():param.h,button:param.button===undefined?ANY:param.button}}var check_pos=vec2();function checkPos(pos,param){camera2d.physicalToVirtual(check_pos,pos);return check_pos[0]>=param.x&&(param.w===Infinity||check_pos[0]<param.x+param.w)&&check_pos[1]>=param.y&&(param.h===Infinity||check_pos[1]<param.y+param.h)}function mouseOver(param){if(mouse_over_captured){return false}var pos_param=mousePosParam(param);for(var id in touches){var touch=touches[id];if(checkPos(touch.cur_pos,pos_param)){if(touch.state===DOWN_EDGE){touch.state=DOWN}else if(touch.state===UP_EDGE){touch.state=null}}}if(checkPos(mouse_pos,pos_param)){mouse_over_captured=true;return true}return false}function mouseDown(button){if(button===ANY){return mouseDown(0)||mouseDown(2)}button=button||0;return!input_eaten_mouse&&mouse_down[button]}function mousePosIsTouch(){return mouse_pos_is_touch}function isTouchDown(param){if(input_eaten_mouse){return false}var pos_param=mousePosParam(param);for(var id in touches){var touch=touches[id];if(checkPos(touch.cur_pos,pos_param)){return check_pos.slice(0)}}return false}function numTouches(){return Object.keys(touches).length}function keyDown(keycode){if(input_eaten_kb){return false}return Boolean(key_state[keycode])}function keyDownEdge(keycode){if(key_state[keycode]===DOWN_EDGE){key_state[keycode]=DOWN;return true}return false}function keyUpEdge(keycode){if(key_state[keycode]===UP_EDGE){delete key_state[keycode];return true}return false}function padGetAxes(out,stickindex,padindex){assert(stickindex>=0&&stickindex<NUM_STICKS);if(padindex===undefined){var sub=vec2();v2set(out,0,0);for(var ii=0;ii<gamepad_data.length;++ii){padGetAxes(sub,stickindex,ii);v2add(out,sub)}return}var sticks=getGamepadData(padindex).sticks;v2copy(out,sticks[stickindex])}function padButtonDownInternal(ps,padcode){return Boolean(ps[padcode])}function padButtonDownEdgeInternal(ps,padcode){if(ps[padcode]===DOWN_EDGE){ps[padcode]=DOWN;return true}return false}function padButtonUpEdgeInternal(ps,padcode){if(ps[padcode]===UP_EDGE){delete ps[padcode];return true}return false}var ANALOG_MAP=function(){if(!MAP_ANALOG_TO_DPAD){return{}}var r={};r[pad_codes.LEFT]=pad_codes.ANALOG_LEFT;r[pad_codes.RIGHT]=pad_codes.ANALOG_RIGHT;r[pad_codes.UP]=pad_codes.ANALOG_UP;r[pad_codes.DOWN]=pad_codes.ANALOG_DOWN;return r}();function padButtonShared(fn,padcode,padindex){assert(padcode!==undefined);if(padindex===undefined){for(var ii=0;ii<pad_states.length;++ii){if(padButtonShared(fn,padcode,ii)){return true}}return false}if(input_eaten_mouse){return false}var ps=pad_states[padindex];if(!ps){return false}if(ANALOG_MAP[padcode]&&fn(ps,ANALOG_MAP[padcode])){return true}return fn(ps,padcode)}function padButtonDown(padcode,padindex){return padButtonShared(padButtonDownInternal,padcode,padindex)}function padButtonDownEdge(padcode,padindex){return padButtonShared(padButtonDownEdgeInternal,padcode,padindex)}function padButtonUpEdge(padcode,padindex){return padButtonShared(padButtonUpEdgeInternal,padcode,padindex)}var start_pos=vec2();var cur_pos=vec2();var delta=vec2();function mouseUpEdge(param){param=param||{};var pos_param=mousePosParam(param);var button=pos_param.button;var max_click_dist=param.max_dist||50;for(var touch_id in touches){var touch_data=touches[touch_id];if(touch_data.state!==UP_EDGE||!(button===ANY||button===touch_data.button)||touch_data.total>max_click_dist){continue}if(checkPos(touch_data.cur_pos,pos_param)){touch_data.state=null;return{button:touch_data.button,pos:check_pos.slice(0),start_time:touch_data.start_time}}}return false}exports.click=mouseUpEdge;function mouseDownEdge(param){param=param||{};var pos_param=mousePosParam(param);var button=pos_param.button;for(var touch_id in touches){var touch_data=touches[touch_id];if(touch_data.state!==DOWN_EDGE||!(button===ANY||button===touch_data.button)){continue}if(checkPos(touch_data.cur_pos,pos_param)){touch_data.state=DOWN;return{button:touch_data.button,pos:check_pos.slice(0),start_time:touch_data.start_time}}}return false}function drag(param){param=param||{};var pos_param=mousePosParam(param);var button=pos_param.button;for(var touch_id in touches){var touch_data=touches[touch_id];if(!(button===ANY||button===touch_data.button)||touch_data.dispatched){continue}if(checkPos(touch_data.start_pos,pos_param)){if(!param.peek){touch_data.dispatched=true}camera2d.physicalToVirtual(start_pos,touch_data.start_pos);camera2d.physicalToVirtual(cur_pos,touch_data.cur_pos);camera2d.physicalDeltaToVirtual(delta,[touch_data.total/2,touch_data.total/2]);var total=delta[0]+delta[1];camera2d.physicalDeltaToVirtual(delta,touch_data.delta);return{cur_pos:cur_pos,start_pos:start_pos,delta:delta,total:total,button:touch_data.button,touch:touch_data.touch,start_time:touch_data.start_time}}}return null}},{"./camera2d.js":9,"./engine.js":12,"./local_storage.js":16,"./vmath.js":29,assert:35}],16:[function(require,module,exports){"use strict";exports.get=get;exports.set=set;exports.setJSON=setJSON;exports.getJSON=getJSON;exports.storage_prefix="demo";var local_storage_sim={};var lsd=function(){try{localStorage.test="test";return localStorage}catch(e){return local_storage_sim}}();function get(key){key=exports.storage_prefix+"_"+key;var ret=lsd[key];if(ret==="undefined"){ret=undefined}return ret}function set(key,value){key=exports.storage_prefix+"_"+key;if(value===undefined||value===null){delete lsd[key]}else{lsd[key]=value}}function setJSON(key,value){set(key,JSON.stringify(value))}function getJSON(key,def){var value=get(key);try{return JSON.parse(value)}catch(e){}return def}},{}],17:[function(require,module,exports){"use strict";exports.mat43=mat43;exports.m43identity=m43identity;exports.m43mul=m43mul;function mat43(){var r=new Float32Array(12);r[0]=r[4]=r[8]=1;return r}function m43identity(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;out[9]=0;out[10]=0;out[11]=0}function m43mul(out,a,b){var a0=a[0];var a1=a[1];var a2=a[2];var a3=a[3];var a4=a[4];var a5=a[5];var a6=a[6];var a7=a[7];var a8=a[8];var a9=a[9];var a10=a[10];var a11=a[11];var b0=b[0];var b1=b[1];var b2=b[2];var b3=b[3];var b4=b[4];var b5=b[5];var b6=b[6];var b7=b[7];var b8=b[8];out[0]=b0*a0+b3*a1+b6*a2;out[1]=b1*a0+b4*a1+b7*a2;out[2]=b2*a0+b5*a1+b8*a2;out[3]=b0*a3+b3*a4+b6*a5;out[4]=b1*a3+b4*a4+b7*a5;out[5]=b2*a3+b5*a4+b8*a5;out[6]=b0*a6+b3*a7+b6*a8;out[7]=b1*a6+b4*a7+b7*a8;out[8]=b2*a6+b5*a7+b8*a8;out[9]=b0*a9+b3*a10+b6*a11+b[9];out[10]=b1*a9+b4*a10+b7*a11+b[10];out[11]=b2*a9+b5*a10+b8*a11+b[11];return out}},{}],18:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.preloadParticleData=preloadParticleData;exports.create=create;var assert=require("assert");var sprites=require("./sprites.js");var textures=require("./textures.js");var _require=require("./vmath.js"),vec2=_require.vec2,v2copy=_require.v2copy,v2lerp=_require.v2lerp,v2mul=_require.v2mul;var _require2=require("./vmath.js"),vec3=_require2.vec3,vec4=_require2.vec4,v3add=_require2.v3add,v4copy=_require2.v4copy,v4lerp=_require2.v4lerp,v4mul=_require2.v4mul;var blend_map={alpha:sprites.BLEND_ALPHA,additive:sprites.BLEND_ADDITIVE};function preloadParticleData(particle_data){for(var key in particle_data.defs){var def=particle_data.defs[key];for(var part_name in def.particles){var part_def=def.particles[part_name];textures.load({url:"img/"+part_def.texture+".png"})}}}function normalizeValue(v){if(v instanceof Float32Array&&v.length>=2){return v}else if(typeof v==="number"){return vec2(v,0)}else if(Array.isArray(v)||v instanceof Float32Array){return vec2(v[0]||0,v[1]||0)}else{return assert(false)}}function normalizeValueVec(vec,length){assert(length);assert(Array.isArray(vec));var ret=new Array(length);for(var ii=0;ii<length;++ii){ret[ii]=normalizeValue(vec[ii])}return ret}function normalizeParticle(def,particle_manager){if(!def.normalized){var norm=def.normalized={blend:blend_map[def.blend]||sprites.BLEND_ALPHA,texture:textures.load({url:def.texture?"img/"+def.texture+".png":"img/glov/util_circle.png"}),color:normalizeValueVec(def.color||[1,1,1,1],4),color_track:null,size:normalizeValueVec(def.size||[1,1],2),size_track:null,accel:normalizeValueVec(def.accel||[0,0,0],3),rot:normalizeValue(def.rot||0),rot_vel:normalizeValue(def.rot||0),lifespan:normalizeValue(def.lifespan||1e3),kill_time_accel:normalizeValue(def.kill_time_accel||1)};assert(norm.kill_time_accel[0]>=1);if(def.color_track&&def.color_track.length){assert(def.color_track.length>1);norm.color_track=[];for(var ii=0;ii<def.color_track.length;++ii){var e=def.color_track[ii];assert(typeof e.t==="number");var arr=new Float32Array(5);arr[0]=e.v[0];arr[1]=e.v[1];arr[2]=e.v[2];arr[3]=e.v[3];arr[4]=e.t;norm.color_track.push(arr)}}if(def.size_track&&def.size_track.length){assert(def.size_track.length>1);norm.size_track=[];for(var _ii=0;_ii<def.size_track.length;++_ii){var _e=def.size_track[_ii];assert(typeof _e.t==="number");var _arr=new Float32Array(3);_arr[0]=_e.v[0];_arr[1]=_e.v[1];_arr[2]=_e.t;norm.size_track.push(_arr)}}}return def.normalized}function findParticle(particles,name){assert(particles[name]!==undefined);return particles[name]}function normalizeEmitter(def,part_map){if(!def.normalized){def.normalized={part_idx:findParticle(part_map,def.particle),pos:normalizeValueVec(def.pos||[0,0,0],3),vel:normalizeValueVec(def.vel||[0,0,0],3),emit_rate:normalizeValue(def.emit_rate||10),emit_time:normalizeValueVec(def.emit_time||[0,Infinity],2),emit_initial:normalizeValue(def.emit_initial||1)};var min=def.normalized.emit_rate[0];var max=def.normalized.emit_rate[0]+def.normalized.emit_rate[1];def.normalized.emit_rate[0]=1e3/max;def.normalized.emit_rate[1]=1e3/min;assert(def.normalized.emit_rate[0]>1)}return def.normalized}function normalizeDef(def,particle_manager){if(!def.normalized){var norm=def.normalized={system_lifespan:normalizeValue(def.system_lifespan||Infinity),particles:[],emitters:[]};var part_map={};for(var key in def.particles){part_map[key]=norm.particles.length;norm.particles.push(normalizeParticle(def.particles[key],particle_manager))}for(var _key in def.emitters){norm.emitters.push(normalizeEmitter(def.emitters[_key],part_map))}}return def.normalized}function instValue(v){return v[0]+Math.random()*v[1]}function instValueVec(v){var ret=new Float32Array(v.length);for(var ii=0;ii<v.length;++ii){ret[ii]=instValue(v[ii])}return ret}var temp_color=vec4();var temp_color2=vec4();var temp_size=vec2();var temp_size2=vec2();var ParticleSystem=function(){function ParticleSystem(parent,def_in,pos){assert(pos.length===3);this.parent=parent;this.def=normalizeDef(def_in,parent);this.system_lifespan=instValue(this.def.system_lifespan);assert(this.system_lifespan>0);this.age=0;this.kill_hard=false;this.kill_soft=false;this.pos=vec3(pos[0],pos[1],pos[2]);this.part_sets=[];for(var ii=0;ii<this.def.particles.length;++ii){var def=this.def.particles[ii];var part_set={def:def,parts:[]};this.part_sets.push(part_set)}this.emitters=[];for(var _ii2=0;_ii2<this.def.emitters.length;++_ii2){var _def=this.def.emitters[_ii2];var emitter={def:_def,emit_time:instValueVec(_def.emit_time),countdown:0,started:false,stopped:false};this.emitters.push(emitter)}this.tick(0)}_createClass(ParticleSystem,[{key:"tickParticle",value:function tickParticle(part,dt){var def=part.def;part.age+=dt;var age_norm=part.age/part.lifespan;if(age_norm>=1){return true}var dts=dt/1e3;part.pos[0]+=part.vel[0]*dts;part.pos[1]+=part.vel[1]*dts;part.pos[2]+=part.vel[2]*dts;part.vel[0]+=part.accel[0]*dts;part.vel[1]+=part.accel[1]*dts;part.vel[2]+=part.accel[2]*dts;v4copy(temp_color,part.color,temp_color);if(def.color_track){if(age_norm<def.color_track[0][4]){v4mul(temp_color,temp_color,def.color_track[0])}else if(age_norm>=def.color_track[def.color_track.length-1][4]){v4mul(temp_color,temp_color,def.color_track[def.color_track.length-1])}else{for(var ii=0;ii<def.color_track.length-1;++ii){if(age_norm>=def.color_track[ii][4]&&age_norm<def.color_track[ii+1][4]){var weight=(age_norm-def.color_track[ii][4])/(def.color_track[ii+1][4]-def.color_track[ii][4]);v4lerp(temp_color2,weight,def.color_track[ii],def.color_track[ii+1]);v4mul(temp_color,temp_color,temp_color2);break}}}}v2copy(temp_size,part.size);if(def.size_track){if(age_norm<def.size_track[0][4]){v2mul(temp_size,temp_size,def.size_track[0])}else if(age_norm>=def.size_track[def.size_track.length-1][4]){v2mul(temp_size,temp_size,def.size_track[def.size_track.length-1])}else{for(var _ii3=0;_ii3<def.size_track.length-1;++_ii3){if(age_norm>=def.size_track[_ii3][4]&&age_norm<def.size_track[_ii3+1][4]){var _weight=(age_norm-def.size_track[_ii3][4])/(def.size_track[_ii3+1][4]-def.size_track[_ii3][4]);v2lerp(temp_size2,_weight,def.size_track[_ii3],def.size_track[_ii3+1]);v2mul(temp_size,temp_size,temp_size2);break}}}}var w=part.size[0];var h=part.size[1];var x=part.pos[0]-w/2;var y=part.pos[1]-h/2;var z=part.pos[2];sprites.queueraw4([def.texture],x,y,x,y+h,x+w,y+h,x+w,y,z,0,0,1,1,temp_color,null,null,def.blend);return false}},{key:"tickPartSet",value:function tickPartSet(dt_orig,part_set){var parts=part_set.parts;for(var ii=parts.length-1;ii>=0;--ii){var part=parts[ii];var dt=this.kill_soft?dt_orig*part.kill_time_accel:dt_orig;if(this.tickParticle(part,dt)){parts[ii]=parts[parts.length-1];parts.pop()}}}},{key:"emitParticle",value:function emitParticle(init_dt,emitter){var emitter_def=emitter.def;var part_set=this.part_sets[emitter_def.part_idx];var def=part_set.def;var pos=instValueVec(emitter_def.pos,3);v3add(pos,pos,this.pos);var part={def:def,pos:pos,color:instValueVec(def.color,4),size:instValueVec(def.size,4),vel:instValueVec(emitter_def.vel,3),accel:instValueVec(def.accel,3),rot:instValue(def.rot),rot_vel:instValue(def.rot_vel),lifespan:instValue(def.lifespan),kill_time_accel:instValue(def.kill_time_accel),age:0};if(!this.tickParticle(part,init_dt)){part_set.parts.push(part)}}},{key:"tickEmitter",value:function tickEmitter(dt,emitter){var def=emitter.def;if(!emitter.started&&this.age>=emitter.emit_time[0]){emitter.started=true;dt=this.age-emitter.emit_time[0];var num=instValue(def.emit_initial);for(var ii=0;ii<num;++ii){this.emitParticle(dt,emitter)}emitter.countdown=instValue(def.emit_rate)}if(emitter.started&&!emitter.stopped){var remaining_dt=dt;var emit_dt=dt;if(this.age>=emitter.emit_time[1]){emitter.stopped=true;emit_dt-=this.age-emitter.emit_time[1]}while(emit_dt>=emitter.countdown){emit_dt-=emitter.countdown;remaining_dt-=emitter.countdown;emitter.countdown=instValue(def.emit_rate);this.emitParticle(remaining_dt,emitter)}emitter.countdown-=emit_dt}}},{key:"tick",value:function tick(dt){if(this.kill_hard){return true}for(var ii=this.part_sets.length-1;ii>=0;--ii){this.tickPartSet(dt,this.part_sets[ii])}this.age+=dt;for(var _ii4=0;_ii4<this.emitters.length;++_ii4){this.tickEmitter(dt,this.emitters[_ii4])}return this.age>=this.system_lifespan}}]);return ParticleSystem}();var ParticleManager=function(){function ParticleManager(){this.systems=[]}_createClass(ParticleManager,[{key:"createSystem",value:function createSystem(def,pos){var system=new ParticleSystem(this,def,pos);this.systems.push(system);return system}},{key:"tick",value:function tick(dt){for(var ii=this.systems.length-1;ii>=0;--ii){if(this.systems[ii].tick(dt)){this.systems[ii]=this.systems[this.systems.length-1];this.systems.pop()}}}}]);return ParticleManager}();function create(){for(var _len=arguments.length,args=Array(_len),_key2=0;_key2<_len;_key2++){args[_key2]=arguments[_key2]}return new(Function.prototype.bind.apply(ParticleManager,[null].concat(args)))}},{"./sprites.js":24,"./textures.js":25,"./vmath.js":29,assert:35}],19:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.create=create;var assert=require("assert");var glov_engine=require("./engine.js");var glov_input=require("./input.js");var glov_font=require("./font.js");var glov_ui=require("./ui.js");var _require=require("./vmath.js"),vec4=_require.vec4;var glov_markup=null;var min=Math.min,max=Math.max,sin=Math.sin;var _require2=require("../../common/util.js"),cloneShallow=_require2.cloneShallow,merge=_require2.merge,nearSame=_require2.nearSame;var font=void 0;var selbox_font_style_default=glov_font.style(null,{color:3755991039});var selbox_font_style_selected=glov_font.style(null,{color:4294967295});var selbox_font_style_down=glov_font.style(null,{color:255});var selbox_font_style_disabled=glov_font.style(null,{color:2155905279});var default_display=exports.default_display={style_default:selbox_font_style_default,style_selected:selbox_font_style_selected,style_disabled:selbox_font_style_disabled,style_down:selbox_font_style_down,no_background:false,no_buttons:false,centered:false,bounce:true,tab_stop:0,xpad:8,use_markup:false};var color_gray50=vec4(.313,.313,.313,1);var color_grayD0=vec4(.816,.816,.816,1);var color_white=vec4(1,1,1,1);var SELBOX_BOUNCE_TIME=80;var GlovMenuItem=exports.GlovMenuItem=function GlovMenuItem(params){params=params||{};if(params instanceof GlovMenuItem){for(var field in params){this[field]=params[field]}return}if(typeof params==="string"){params={name:params}}this.name=params.name||"NO_NAME";this.state=params.state||null;this.cb=params.cb||null;this.value=null;this.value_min=0;this.value_max=0;this.value_inc=0;this.tag=params.tag||null;this.exit=Boolean(params.exit);this.prompt_int=Boolean(params.prompt_int);this.prompt_string=Boolean(params.prompt_string);this.no_sound=Boolean(params.no_sound);this.slider=Boolean(params.slider);this.no_controller_exit=Boolean(params.no_controller_exit);this.plus_minus=Boolean(params.plus_minus);this.disabled=Boolean(params.disabled);this.centered=Boolean(params.centered)};var GlovSelectionBox=function(){function GlovSelectionBox(params){this.x=0;this.y=0;this.z=Z.UI;this.width=glov_ui.button_width;this.items=[];this.is_dropdown=false;this.transient_focus=false;this.disabled=false;this.display=cloneShallow(default_display);this.scroll_height=0;this.font_height=glov_ui.font_height;this.entry_height=glov_ui.button_height;this.auto_reset=true;this.applyParams(params);this.dropdown_visible=false;this.selected=0;this.was_clicked=false;this.was_right_clicked=false;this.is_focused=false;this.dummy_focus_check={selbox_dummy:1};this.mouse_mode=false;this.last_mousex=0;this.last_mousey=0;this.bounce_time=0;this.expected_frame_index=0}_createClass(GlovSelectionBox,[{key:"applyParams",value:function applyParams(params){if(!params){return}for(var f in params){if(f==="items"){this.items=params.items.map(function(item){return new GlovMenuItem(item)})}else if(f==="display"){merge(this.display,params[f])}else{this[f]=params[f]}}}},{key:"isSelected",value:function isSelected(tag_or_index){if(typeof tag_or_index==="number"){return this.selected===tag_or_index}return this.items[this.selected].tag===tag_or_index}},{key:"getHeight",value:function getHeight(){var display=this.display,entry_height=this.entry_height;if(this.is_dropdown){return entry_height+2}var list_height=this.items.length*entry_height;var do_scroll=this.scroll_height&&this.items.length*entry_height>this.scroll_height;if(do_scroll){list_height=this.scroll_height}list_height+=2;if(!display.no_background){list_height+=4}return list_height+3}},{key:"run",value:function run(params){this.applyParams(params);var x=this.x,y=this.y,z=this.z,width=this.width,font_height=this.font_height,entry_height=this.entry_height,auto_reset=this.auto_reset;var KEYS=glov_input.KEYS,pad_codes=glov_input.pad_codes;if(auto_reset&&this.expected_frame_index!==glov_engine.getFrameIndex()){for(var ii=0;ii<this.items.length;++ii){if(!this.items[ii].disabled){this.selected=ii;break}}}var y0=y;var yret=void 0;var display=this.display;this.was_clicked=false;this.was_right_clicked=false;var pos_changed=false;var was_focused=this.is_focused;var gained_focus_forward=false;if(!this.disabled&&!this.is_focused){gained_focus_forward=glov_ui.focusCheck(this.dummy_focus_check);if(gained_focus_forward){glov_ui.focusSteal(this)}}var old_sel=this.selected;var num_non_disabled_selections=0;var eff_sel=-1;for(var _ii=0;_ii<this.items.length;++_ii){var item=this.items[_ii];if(!item.disabled){if(eff_sel===-1&&this.selected<=_ii){eff_sel=num_non_disabled_selections}num_non_disabled_selections++}}if(eff_sel===-1){eff_sel=0}var focused=this.is_focused=this.disabled?false:glov_ui.focusCheck(this);var gained_focus=focused&&!was_focused;if(this.transient_focus&&gained_focus){if(gained_focus_forward){eff_sel=0}else{eff_sel=num_non_disabled_selections-1}pos_changed=true}if(!this.is_dropdown&&!display.no_background){var bg_height=this.getHeight();if(focused){glov_ui.drawRect(x,y,x+width,y+bg_height-2,z,color_white);y+=2;x+=2;width-=4;glov_ui.drawRect(x,y,x+width,y+bg_height-6,z+.1,color_gray50);y+=2;x+=2;width-=4}else{glov_ui.drawRect(x,y,x+width,y+bg_height-2,z,color_gray50);y+=4;x+=4;width-=8}}var page_size=(this.scroll_height-1)/entry_height;if(focused){if(glov_input.keyDownEdge(KEYS.PAGEDOWN)||(glov_input.padButtonDown(pad_codes.RIGHT_TRIGGER)||glov_input.padButtonDown(pad_codes.LEFT_TRIGGER))&&glov_input.padButtonDownEdge(pad_codes.DOWN)){eff_sel+=page_size;eff_sel=min(eff_sel,num_non_disabled_selections-1);this.mouse_mode=false;pos_changed=true}if(glov_input.keyDownEdge(KEYS.PAGEUP)||(glov_input.padButtonDown(pad_codes.RIGHT_TRIGGER)||glov_input.padButtonDown(pad_codes.LEFT_TRIGGER))&&glov_input.padButtonDownEdge(pad_codes.UP)){eff_sel-=page_size;eff_sel=max(eff_sel,0);this.mouse_mode=false;pos_changed=true}if(glov_input.keyDownEdge(KEYS.DOWN)||glov_input.keyDownEdge(KEYS.S)||glov_input.padButtonDownEdge(pad_codes.DOWN)){eff_sel++;this.mouse_mode=false;pos_changed=true}if(glov_input.keyDownEdge(KEYS.UP)||glov_input.keyDownEdge(KEYS.W)||glov_input.padButtonDownEdge(pad_codes.UP)){eff_sel--;this.mouse_mode=false;pos_changed=true}if(glov_input.keyDownEdge(KEYS.HOME)){eff_sel=0;this.mouse_mode=false;pos_changed=true}if(glov_input.keyDownEdge(KEYS.END)){eff_sel=num_non_disabled_selections-1;this.mouse_mode=false;pos_changed=true}}var sel_changed=false;if(eff_sel<0){if(this.transient_focus){eff_sel=0;sel_changed=true;glov_ui.focusPrev(this)}else{eff_sel=num_non_disabled_selections-1}}if(eff_sel>=num_non_disabled_selections&&num_non_disabled_selections){if(this.transient_focus){eff_sel=num_non_disabled_selections-1;sel_changed=true;glov_ui.focusNext(this)}else{eff_sel=0}}for(var _ii2=0;_ii2<this.items.length;++_ii2){var _item=this.items[_ii2];if(!_item.disabled){if(!eff_sel){this.selected=_ii2;break}--eff_sel}}var pad=8;if(this.is_dropdown){var color0=color_white;if(!this.disabled&&glov_input.click({x:x,y:y,w:width,h:entry_height})){glov_ui.focusSteal(this);this.dropdown_visible=!this.dropdown_visible;color0=color_grayD0}else if(!this.disabled&&glov_input.mouseOver({x:x,y:y,w:width,h:entry_height})){glov_ui.setMouseOver(this);color0=color_grayD0}glov_ui.drawHBox({x:x,y:y,z:z+1,w:width,h:entry_height},glov_ui.sprites.menu_header,color0);font.drawSizedAligned(focused?glov_ui.font_style_focused:glov_ui.font_style_normal,x+display.xpad,y,z+2,font_height,glov_font.ALIGN.HFIT|glov_font.ALIGN.VCENTER,width-display.xpad*2,entry_height,this.items[this.selected].name);y+=entry_height;yret=y+2;z+=1e3}if(!this.is_dropdown||this.dropdown_visible){var do_scroll=this.scroll_height&&this.items.length*entry_height>this.scroll_height;var y_save=y;var x_save=x;var scroll_pos=0;var eff_width=width;if(do_scroll){if(pos_changed){var buffer=min(1.5*entry_height,(this.scroll_height-entry_height)/2);var min_scroll_pos=max(0,this.selected*entry_height-buffer);var old_scroll_pos=this.sa.scroll_pos;if(min_scroll_pos<this.sa.scroll_pos){this.sa.scroll_pos=min_scroll_pos}var max_scroll_pos=min(this.items.length*entry_height,(this.selected+1)*entry_height+buffer)-this.scroll_height;if(max_scroll_pos>this.sa.scroll_pos){this.sa.scroll_pos=max_scroll_pos}this.sa.overscroll=old_scroll_pos-this.sa.scroll_pos}this.sa.begin(x,y,z,width,this.scroll_height,color_white);scroll_pos=this.sa.scroll_pos+this.sa.overscroll;y=0;x=0}for(var i=0;i<this.items.length;i++){var _item2=this.items[i];var entry_disabled=_item2.disabled;var image_set=null;if(!this.disabled&&!entry_disabled&&glov_input.click({x:x,y:y,w:width,h:entry_height})){glov_ui.focusSteal(this);this.was_clicked=true;this.mouse_mode=true;this.selected=i}if(!this.disabled&&!entry_disabled&&glov_input.click({x:x,y:y,w:width,h:entry_height})){glov_ui.focusSteal(this);this.was_right_clicked=true;this.mouse_mode=true;this.selected=i}var is_mouseover=false;if(!this.disabled&&!entry_disabled&&glov_input.mouseOver({x:x,y:y,w:width,h:entry_height})){var mpos=glov_input.mousePos();is_mouseover=true;if(focused||this.transient_focus){if(this.expected_frame_index===glov_engine.getFrameIndex()&&(mpos[0]!==this.last_mousex||!nearSame(mpos[1]-scroll_pos,this.last_mousey,1.25))){this.mouse_mode=true;this.selected=i}this.last_mousex=mpos[0];this.last_mousey=mpos[1]-scroll_pos}}var style=void 0;var show_selection=!this.disabled&&(!(this.transient_focus&&!this.is_focused)||is_mouseover);var bounce=false;if(this.selected===i&&show_selection){style=display.style_selected||selbox_font_style_selected;image_set=glov_ui.sprites.menu_selected;if(is_mouseover&&glov_input.mouseDown()){if(glov_ui.sprites.menu_down){image_set=glov_ui.sprites.menu_down}else{style=display.style_down||selbox_font_style_down}}if(display.bounce&&!this.is_dropdown){var ms=glov_engine.getFrameDt();if(this.selected!==old_sel){bounce=true;this.bounce_time=SELBOX_BOUNCE_TIME}else if(ms>=this.bounce_time){this.bounce_time=0}else{bounce=true;this.bounce_time-=ms}}}else if(entry_disabled){style=display.style_disabled||selbox_font_style_disabled;image_set=glov_ui.sprites.menu_entry}else{style=display.style_default||selbox_font_style_default;image_set=glov_ui.sprites.menu_entry}var yoffs=0;var bounce_amt=0;if(bounce){bounce_amt=sin(this.bounce_time*20/SELBOX_BOUNCE_TIME/10);yoffs=-4*bounce_amt*entry_height/32}if(!display.no_buttons){glov_ui.drawHBox({x:x,y:y+yoffs,z:z+1,w:eff_width,h:entry_height},image_set,color_white)}var did_tab=false;var text_y=y+yoffs;if(display.tab_stop){var str=_item2.name;var tab_idx=str.indexOf("\t");if(tab_idx!==-1){did_tab=true;var pre=str.slice(0,tab_idx);var post=str.slice(tab_idx+1);var x1=x+display.xpad;var x2=x+display.xpad+display.tab_stop+pad;var w1=display.tab_stop;var w2=eff_width-display.tab_stop-display.xpad*2-pad;if(display.use_markup){var md={};md.align=glov_font.ALIGN.HFIT;md.x_size=md.y_size=font_height;md.w=w1;md.h=1;md.style=style;glov_markup.print(md,x1,text_y,z+2,pre);md.w=w2;glov_markup.print(md,x2,text_y,z+2,post)}else{font.drawSizedAligned(style,x1,text_y,z+2,font_height,glov_font.ALIGN.HFIT|glov_font.ALIGN.VCENTER,w1,entry_height,pre);font.drawSizedAligned(style,x2,text_y,z+2,font_height,glov_font.ALIGN.HFIT|glov_font.ALIGN.VCENTER,w2,entry_height,post)}}}if(!did_tab){var _md={};_md.align=(_item2.centered||display.centered?glov_font.ALIGN.HCENTERFIT:glov_font.ALIGN.HFIT)|glov_font.ALIGN.VCENTER;_md.x_size=_md.y_size=font_height;_md.w=eff_width-display.xpad*2;_md.h=entry_height;_md.style=style;var xx=x+display.xpad;var zz=z+2;if(display.use_markup){glov_markup.print(_md,xx,text_y,zz,_item2.name)}else{font.drawSizedAligned(_md.style,xx,text_y,zz,_md.x_size,_md.align,_md.w,_md.h,_item2.name)}}y+=entry_height}if(do_scroll){this.sa.end(y);y=y_save+this.scroll_height;x=x_save}if(this.was_clicked&&this.is_dropdown){this.dropdown_visible=false}}if(this.selected!==old_sel||sel_changed){glov_ui.playUISound("rollover")}this.expected_frame_index=glov_engine.getFrameIndex()+1;x=10;y+=5;if(!this.is_dropdown){yret=y}assert(yret-y0===this.getHeight());return yret-y0}}]);return GlovSelectionBox}();function create(){if(!font){font=glov_ui.font}for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return new(Function.prototype.bind.apply(GlovSelectionBox,[null].concat(args)))}},{"../../common/util.js":37,"./engine.js":12,"./font.js":13,"./input.js":15,"./ui.js":27,"./vmath.js":29,assert:35}],20:[function(require,module,exports){"use strict";exports.create=create;exports.bind=bind;exports.startup=startup;var assert=require("assert");var engine=require("./engine.js");var last_id=0;var bound_prog=null;var semantic=exports.semantic={ATTR0:0,POSITION:0,ATTR1:1,COLOR:1,COLOR_0:1,ATTR2:2,TEXCOORD:2,TEXCOORD_0:2,ATTR3:3,NORMAL:3,ATTR4:4,TEXCOORD_1:4};function findAll(str,re){var ret=[];var m=void 0;do{m=re.exec(str);if(m){ret.push(m[1])}}while(m);return ret}var globals=void 0;var defines=void 0;var error_fp=void 0;var error_vp=void 0;var vp_attr_regex=/attribute (?:[\0-\x1F!-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+ ((?:[\0-\x1F!-:<-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+);/g;var uniform_regex=/uniform (?:(?:low|medium|high)p )?((?:vec|mat)[0-9] (?:[\0-\x1F!-:<-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+);/g;var sampler_regex=/uniform sampler2D ((?:[\0-\x1F!-:<-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+);/g;var type_size={vec2:2*1,vec3:3*1,vec4:4*1,mat3:3*3,mat4:4*4};function Shader(type,text){text=""+defines+text;this.shader=gl.createShader(type);if(type===gl.VERTEX_SHADER){this.programs={};this.attributes=findAll(text,vp_attr_regex);this.attributes.forEach(function(v){return assert(semantic[v]!==undefined)})}else{this.id=++last_id;this.samplers=findAll(text,sampler_regex);var found=[];this.samplers.forEach(function(v){var num=Number(v.slice(-1));assert(!isNaN(num));assert(!found[num]);found[num]=true})}this.uniforms=findAll(text,uniform_regex);this.uniforms.forEach(function(v){var type_name=v.split(" ")[0];assert(type_size[type_name])});gl.shaderSource(this.shader,text);gl.compileShader(this.shader);if(!gl.getShaderParameter(this.shader,gl.COMPILE_STATUS)){console.error("Shader compile error: "+gl.getShaderInfoLog(this.shader))}}function create(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return new(Function.prototype.bind.apply(Shader,[null].concat(args)))}function uniformSetValue(unif){switch(unif.width){case 2:gl.uniform2fv(unif.location,unif.value);break;case 3:gl.uniform3fv(unif.location,unif.value);break;case 4:gl.uniform4fv(unif.location,unif.value);break;case 9:gl.uniformMatrix3fv(unif.location,false,unif.value);break;case 16:gl.uniformMatrix4fv(unif.location,false,unif.value);break}}function link(vp,fp){var prog=vp.programs[fp.id]={handle:gl.createProgram(),uniforms:null};gl.attachShader(prog.handle,vp.shader);gl.attachShader(prog.handle,fp.shader);for(var ii=0;ii<vp.attributes.length;++ii){gl.bindAttribLocation(prog.handle,semantic[vp.attributes[ii]],vp.attributes[ii])}gl.linkProgram(prog.handle);prog.valid=gl.getProgramParameter(prog.handle,gl.LINK_STATUS);if(!prog.valid){console.error("Shader link error: "+gl.getProgramInfoLog(prog.handle))}gl.useProgram(prog.handle);bound_prog=prog;var uniforms=vp.uniforms.slice(0);for(var _ii=0;_ii<fp.uniforms.length;++_ii){var name=fp.uniforms[_ii];if(uniforms.indexOf(name)===-1){uniforms.push(name)}}prog.uniforms=uniforms.map(function(v){v=v.split(" ");var type=v[0];var name=v[1];var count=1;var m=name.match(/((?:[\0-Z\\-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)\[([0-9]+)\]/);if(m){name=m[1];count=Number(m[2])}var location=gl.getUniformLocation(prog.handle,name);if(location===null){return null}var width=type_size[type];var size=width*count;var glob=globals[name];var value=new Float32Array(size);var unif={name:name,size:size,width:width,count:count,value:value,location:location,glob:glob};uniformSetValue(unif);return unif}).filter(function(v){return v});for(var _ii2=0;_ii2<fp.samplers.length;++_ii2){var _name=fp.samplers[_ii2];var num=Number(_name.slice(-1));var location=gl.getUniformLocation(prog.handle,_name);if(location!==null){gl.uniform1i(location,num)}}return prog}function bind(vp,fp,params){var prog=vp.programs[fp.id];if(!prog){prog=link(vp,fp)}if(!prog.valid){prog=link(vp,error_fp);if(!prog.valid){prog=link(error_vp,error_fp)}}if(prog!==bound_prog){bound_prog=prog;gl.useProgram(prog.handle)}for(var ii=0;ii<prog.uniforms.length;++ii){var unif=prog.uniforms[ii];var value=params[unif.name]||unif.glob;if(!value){continue}var diff=false;for(var jj=0;jj<unif.size;++jj){if(value[jj]!==unif.value[jj]){diff=true;break}}if(diff){for(var _jj=0;_jj<unif.size;++_jj){unif.value[_jj]=value[_jj]}uniformSetValue(unif)}}}function startup(_globals){defines=Object.keys(engine.defines).map(function(v){return"#define "+v+"\n"}).join("");globals=_globals;error_fp=create(gl.FRAGMENT_SHADER,"#pragma WebGL\n\nvoid main(void) {\n  gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n}\n");error_vp=create(gl.VERTEX_SHADER,"// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n#pragma WebGL\nattribute vec2 POSITION;\nvoid main() {\n  gl_Position = vec4(POSITION.xy * vec2(2.0 / 1024.0, -2.04 / 1024.0) + vec2(-1.0, 1.0), 0.0, 1.0);\n}\n")}},{"./engine.js":12,assert:35}],21:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.create=create;var assert=require("assert");var camera2d=require("./camera2d.js");var glov_engine=require("./engine.js");var glov_input=require("./input.js");var selection_box=require("./selection_box.js");var glov_ui=require("./ui.js");var _require=require("./vmath.js"),clamp=_require.clamp,vec4=_require.vec4;var KEYS=glov_input.KEYS;var pad_codes=void 0;var color101010C8=vec4(16/255,16/255,16/255,200/255);var GlovSimpleMenu=function(){function GlovSimpleMenu(params){params=params||{};this.sel_box=selection_box.create(params);this.edit_index=-1;this.selected=-1}_createClass(GlovSimpleMenu,[{key:"focus",value:function focus(){glov_ui.focusSteal(this.sel_box)}},{key:"execItem",value:function execItem(index,delta){var items=this.sel_box.items;assert(index>=0&&index<items.length);var menu_item=items[index];var force=false;if(delta===2){delta=1;force=true}if(menu_item.cb){menu_item.cb()}if(!menu_item.state){if(menu_item.value!==null&&(menu_item.prompt_int||menu_item.prompt_string)){this.internal.edit_index=index}else if(menu_item.value!==null){if(glov_input.keyDown(KEYS.SHIFT)&&!force){delta=-1}menu_item.value+=delta*menu_item.value_inc;if(menu_item.slider||menu_item.plus_minus){menu_item.value=clamp(menu_item.value,menu_item.value_min,menu_item.value_max)}else{if(menu_item.value<menu_item.value_min){menu_item.value=menu_item.value_max}if(menu_item.value>menu_item.value_max){menu_item.value=menu_item.value_min}}}else{}}else{glov_engine.setState(menu_item.state)}}},{key:"run",value:function run(params){var sel_box=this.sel_box;sel_box.applyParams(params);var items=sel_box.items,x=sel_box.x,z=sel_box.z;var y0=sel_box.y;var exit_index=-1;for(var i=0;i<items.length;++i){if(items[i].exit){exit_index=i}}var selbox_enabled=true;if(this.edit_index>=0&&this.edit_index<items.length){selbox_enabled=false;glov_ui.drawRect(camera2d.x0(),camera2d.y0(),camera2d.x1(),camera2d.y1(),z+2,color101010C8)}sel_box.disabled=!selbox_enabled;var display=sel_box.display;for(var ii=0;ii<items.length;ii++){var menu_item=items[ii];if(menu_item.slider){var slider=menu_item.internal.slider;if(!slider){}slider.no_notches=true;slider.disabled=menu_item.disabled;var slider_width=160;var slider_x=x+sel_box.width-slider_width-12;var v=menu_item.value-menu_item.value_min;var color=display.style_default.color;if(slider.disabled){color=display.style_disabled.color}v=slider.run({x:slider_x,y:y0+ii*24+2,z:z+3,w:slider_width,color:color,value:v,max:menu_item.value_max-menu_item.value_min});menu_item.value=v+menu_item.value_min;if(slider.rollover||slider.grabbed){if(sel_box.selected!==ii){sel_box.selected=ii;glov_ui.playUISound("select")}}}else if(menu_item.plus_minus){assert(typeof menu_item.value==="number","plus_minus items require a numerical value");assert(menu_item.value_inc,"plus_minus items require a value increment");var buttons_width=60;var pad=6;var button_width=(buttons_width-pad)/2;var button_x=x+sel_box.width-buttons_width;var delta=0;if(glov_ui.buttonText({no_focus:true,x:button_x,y:y0+ii*24+2,z:z+3,w:button_width,h:glov_ui.button_height*.66,text:"-"})){delta=-1}var minus_over=glov_ui.button_mouseover;if(glov_ui.buttonText({no_focus:true,x:button_x+pad+button_width,y:y0+ii*24+2,z:z+3,w:button_width,h:glov_ui.button_height*.66,text:"+"})){delta=1}var plus_over=glov_ui.button_mouseover;if(delta){menu_item.value+=delta*menu_item.value_inc;menu_item.value=clamp(menu_item.value,menu_item.value_min,menu_item.value_max)}if(minus_over||plus_over){if(sel_box.selected!==ii){sel_box.selected=ii;glov_ui.playUISound("select")}}}}var y=y0;y+=sel_box.run();var selected=-1;if(exit_index!==-1&&(glov_input.keyDownEdge(KEYS.ESC)||!items[exit_index].no_controller_exit&&glov_input.padButtonDownEdge(pad_codes.CANCEL))){this.execItem(exit_index,1);selected=exit_index}var allow_left_right=items[sel_box.selected].value!==null;if(sel_box.was_clicked||sel_box.is_focused&&(glov_input.keyDownEdge(KEYS.SPACE)||glov_input.keyDownEdge(KEYS.ENTER)||glov_input.padButtonDownEdge(pad_codes.SELECT))){this.execItem(sel_box.selected,1);selected=sel_box.selected}if(sel_box.is_focused&&allow_left_right&&(glov_input.keyDownEdge(KEYS.RIGHT)||glov_input.keyDownEdge(KEYS.D)||glov_input.padButtonDownEdge(pad_codes.RIGHT))){this.execItem(sel_box.selected,2);selected=sel_box.selected}if(sel_box.wasRightClicked||sel_box.is_focused&&allow_left_right&&(glov_input.keyDownEdge(KEYS.LEFT)||glov_input.keyDownEdge(KEYS.A)||glov_input.padButtonDownEdge(pad_codes.LEFT))){this.execItem(sel_box.selected,-1);selected=sel_box.selected}this.selected=selected;if(selected!==-1&&!items[selected].no_sound){if(items[selected].exit){glov_ui.playUISound("cancel")}else{glov_ui.playUISound("select")}}return y-y0}},{key:"isSelected",value:function isSelected(tag_or_index){if(this.selected===-1){return false}if(tag_or_index===undefined){return this.sel_box.items[this.selected].tag||true}return this.sel_box.isSelected(tag_or_index)}},{key:"getSelectedIndex",value:function getSelectedIndex(){return this.selected}},{key:"getSelectedItem",value:function getSelectedItem(){return this.sel_box.items[this.selected]}}]);return GlovSimpleMenu}();function create(){if(!pad_codes){pad_codes=glov_input.pad_codes}for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return new(Function.prototype.bind.apply(GlovSimpleMenu,[null].concat(args)))}},{"./camera2d.js":9,"./engine.js":12,"./input.js":15,"./selection_box.js":19,"./ui.js":27,"./vmath.js":29,assert:35}],22:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.create=create;var DEFAULT_FADE_RATE=.001;var sounds={};var num_loading=0;var SoundManager=function(){function SoundManager(listenerTransform){if(!listenerTransform){listenerTransform=new Float32Array([1,0,-0,0,0,1,0,-1,0,0,0,0])}var soundDeviceParameters={linearDistance:false};this.soundDevice=WebGLSoundDevice.create(soundDeviceParameters);this.soundDevice.listenerTransform=listenerTransform;this.auto_oggs=false;this.auto_mp3s=false;this.sound_on=true;this.music_on=true;this.channels=[];for(var ii=0;ii<16;++ii){this.channels[ii]=this.soundDevice.createSource({position:[0,0,0],relative:false,pitch:1})}this.channel=0;this.last_played={};this.global_timer=0;this.fade_rate=DEFAULT_FADE_RATE;this.current_loop=null;this.music=[];for(var _ii=0;_ii<2;++_ii){this.music.push({source:this.soundDevice.createSource({position:[0,0,0],relative:false,pitch:1,looping:true}),current_volume:0,target_volume:0})}}_createClass(SoundManager,[{key:"loadSound",value:function loadSound(base,cb){var _this=this;if(Array.isArray(base)){for(var ii=0;ii<base.length;++ii){this.loadSound(base[ii],cb)}return}var key=base;var m=base.match(/^((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)\.(mp3|ogg|wav)$/);var preferred_ext=void 0;if(m){base=m[1];preferred_ext=m[2]}var src="sounds/"+base;var tryLoad=function tryLoad(ext){++num_loading;_this.soundDevice.createSound({src:src+ext,onload:function onload(sound){--num_loading;if(sound){sounds[key]=sound;if(cb){return cb()}}else{if(ext===".ogg"||ext===".mp3"){tryLoad(".wav")}}return null}})};if(this.soundDevice.isSupported("FILEFORMAT_OGG")&&(this.auto_oggs||preferred_ext==="ogg")){tryLoad(".ogg")}else if(this.soundDevice.isSupported("FILEFORMAT_MP3")&&(this.auto_mp3s||preferred_ext==="mp3")){tryLoad(".mp3")}else{tryLoad(".wav")}}},{key:"tick",value:function tick(dt){this.global_timer+=dt;var max_fade=dt*this.fade_rate;for(var ii=0;ii<this.music.length;++ii){var target=this.music_on?this.music[ii].target_volume:0;if(this.music[ii].current_volume!==target){var delta=target-this.music[ii].current_volume;var fade_amt=Math.min(Math.abs(delta),max_fade);if(delta<0){this.music[ii].current_volume=Math.max(target,this.music[ii].current_volume-fade_amt)}else{this.music[ii].current_volume=Math.min(target,this.music[ii].current_volume+fade_amt)}this.music[ii].source.gain=this.music[ii].current_volume}}}},{key:"resume",value:function resume(){this.soundDevice.resume()}},{key:"play",value:function play(soundname,volume){volume=volume||1;if(!this.sound_on){return null}if(!sounds[soundname]){return null}var last_played_time=this.last_played[soundname]||-9e9;if(this.global_timer-last_played_time<45){return null}var channel=this.channels[this.channel++];channel.play(sounds[soundname]);channel.gain=volume;this.last_played[soundname]=this.global_timer;if(this.channel===this.channels.length){this.channel=0}return{stop:function stop(){channel.stop()}}}},{key:"playMusic",value:function playMusic(soundname,volume,transition){var _this2=this;if(!this.music_on){return}if(volume===undefined){volume=1}transition=transition||SoundManager.DEFAULT;this.loadSound(soundname,function(){if(!sounds[soundname]){return}if(_this2.current_loop===soundname){_this2.music[0].target_volume=volume;if(!transition){_this2.music[0].source.gain=_this2.music[0].current_volume=volume}return}if(_this2.music[0].current_volume){if(transition&SoundManager.FADE_OUT){var temp=_this2.music[1];_this2.music[1]=_this2.music[0];_this2.music[0]=temp;_this2.music[1].target_volume=0}}_this2.current_loop=soundname;_this2.music[0].target_volume=volume;if(transition&SoundManager.FADE_IN){_this2.music[0].source.gain=_this2.music[0].current_volume=0}else{_this2.music[0].source.gain=_this2.music[0].current_volume=volume}_this2.music[0].source.play(sounds[soundname],0,true)})}},{key:"loading",value:function loading(){return num_loading}}]);return SoundManager}();SoundManager.DEFAULT=SoundManager.prototype.DEFAULT=0;SoundManager.FADE_OUT=SoundManager.prototype.FADE_OUT=1;SoundManager.FADE_IN=SoundManager.prototype.FADE_IN=2;SoundManager.FADE=SoundManager.prototype.FADE=SoundManager.prototype.FADE_OUT+SoundManager.prototype.FADE_IN;function create(listenerTransform){return new SoundManager(listenerTransform)}},{}],23:[function(require,module,exports){"use strict";exports.create=create;function GlovSpriteAnimation(params){this.frame=0;this.time=0;this.state=null;this.anim=null;this.anim_idx=0;if(params instanceof GlovSpriteAnimation){this.data=params.data;this.setState(params.state)}else{this.data=params;for(var key in this.data){var anim=this.data[key];if(typeof anim.frames==="number"){anim.frames=[anim.frames]}if(typeof anim.times==="number"){var arr=new Array(anim.frames.length);for(var ii=0;ii<anim.frames.length;++ii){arr[ii]=anim.times}anim.times=arr}if(anim.loop===undefined){anim.loop=true}}}}function create(params){return new GlovSpriteAnimation(params)}GlovSpriteAnimation.prototype.clone=function(){return new GlovSpriteAnimation(this)};GlovSpriteAnimation.prototype.setState=function(state,force){if(state===this.state&&!force){return}this.state=state;this.anim=this.data[state];this.time=0;this.anim_idx=0;this.frame=this.anim.frames[this.anim_idx]};GlovSpriteAnimation.prototype.update=function(dt){if(!this.anim){return}this.time+=dt;if(this.time>this.anim.times[this.anim_idx]){this.time-=this.anim.times[this.anim_idx];this.anim_idx=this.anim_idx+1;if(this.anim_idx===this.anim.frames.length){if(this.anim.loop){this.anim_idx=this.anim_idx%this.anim.frames.length}else{this.anim=null;return}}this.frame=this.anim.frames[this.anim_idx];if(this.time>=this.anim.times[this.anim_idx]){this.time=this.anim.times[this.anim_idx]-1}}};GlovSpriteAnimation.prototype.getFrame=function(dt){if(dt!==undefined){this.update(dt)}return this.frame}},{}],24:[function(require,module,exports){"use strict";exports.queuefn=queuefn;exports.queueraw4=queueraw4;exports.queueraw=queueraw;exports.queuesprite=queuesprite;exports.clip=clip;exports.draw=draw;exports.create=create;exports.startup=startup;var assert=require("assert");var camera2d=require("./camera2d.js");var engine=require("./engine.js");var geom=require("./geom.js");var cos=Math.cos,max=Math.max,min=Math.min,round=Math.round,sin=Math.sin;var textures=require("./textures.js");var shaders=require("./shaders.js");var _require=require("./vmath.js"),vec2=_require.vec2,vec4=_require.vec4;var _require2=require("./vmath.js"),nextHighestPowerOfTwo=_require2.nextHighestPowerOfTwo;var BLEND_ALPHA=exports.BLEND_ALPHA=0;var BLEND_ADDITIVE=exports.BLEND_ADDITIVE=1;var sprite_vshader=void 0;var sprite_fshader=void 0;var sprite_dual_fshader=void 0;var clip_space=vec4();var sprite_shader_params={clip_space:clip_space};var last_uid=0;var sprite_queue=[];var sprite_freelist=[];function SpriteData(){this.data=new Float32Array(16);this.texs=null;this.shader=null;this.shader_params=null;this.x=0;this.y=0;this.z=0;this.blend=0;this.uid=0}function spriteDataAlloc(){if(sprite_freelist.length){return sprite_freelist.pop()}return new SpriteData}function cmpSprite(a,b){if(a.z!==b.z){return a.z-b.z}if(a.y!==b.y){return a.y-b.y}if(a.x!==b.x){return a.x-b.x}return a.uid-b.uid}function queuefn(z,fn){sprite_queue.push({fn:fn,x:0,y:0,z:z,uid:++last_uid})}function queueraw4(texs,x0,y0,x1,y1,x2,y2,x3,y3,z,u0,v0,u1,v1,color,shader,shader_params,blend){var elem=spriteDataAlloc();var data=elem.data;data[0]=(x0-camera2d.data[0])*camera2d.data[4];data[1]=(y0-camera2d.data[1])*camera2d.data[5];data[2]=(x1-camera2d.data[0])*camera2d.data[4];data[3]=(y1-camera2d.data[1])*camera2d.data[5];data[4]=(x2-camera2d.data[0])*camera2d.data[4];data[5]=(y2-camera2d.data[1])*camera2d.data[5];data[6]=(x3-camera2d.data[0])*camera2d.data[4];data[7]=(y3-camera2d.data[1])*camera2d.data[5];data[8]=color[0];data[9]=color[1];data[10]=color[2];data[11]=color[3];data[12]=u0;data[13]=v0;data[14]=u1;data[15]=v1;elem.texs=texs;elem.x=data[0];elem.y=data[1];elem.z=z;elem.shader=shader||null;if(shader_params){shader_params.clip_space=sprite_shader_params.clip_space;elem.shader_params=shader_params}else{elem.shader_params=null}elem.blend=blend||0;elem.uid=++last_uid;sprite_queue.push(elem);return elem}function queueraw(texs,x,y,z,w,h,u0,v0,u1,v1,color,shader,shader_params,blend){return queueraw4(texs,x,y,x,y+h,x+w,y+h,x+w,y,z,u0,v0,u1,v1,color,shader,shader_params,blend)}function queuesprite(sprite,x,y,z,w,h,rot,uvs,color,shader,shader_params){var elem=spriteDataAlloc();elem.texs=sprite.texs;elem.x=x=(x-camera2d.data[0])*camera2d.data[4];elem.y=y=(y-camera2d.data[1])*camera2d.data[5];elem.z=z;w*=camera2d.data[4];h*=camera2d.data[5];color=color||sprite.color;var data=elem.data;if(!rot){var x1=x-sprite.origin[0]*w;var y1=y-sprite.origin[1]*h;var x2=x1+w;var y2=y1+h;data[0]=x1;data[1]=y1;data[2]=x1;data[3]=y2;data[4]=x2;data[5]=y2;data[6]=x2;data[7]=y1}else{var dx=sprite.origin[0]*w;var dy=sprite.origin[1]*h;var cosr=cos(rot);var sinr=sin(rot);var _x=x-cosr*dx+sinr*dy;var _y=y-sinr*dx-cosr*dy;var ch=cosr*h;var cw=cosr*w;var sh=sinr*h;var sw=sinr*w;data[0]=_x;data[1]=_y;data[2]=_x-sh;data[3]=_y+ch;data[4]=_x+cw-sh;data[5]=_y+sw+ch;data[6]=_x+cw;data[7]=_y+sw}data[8]=color[0];data[9]=color[1];data[10]=color[2];data[11]=color[3];var bias=0;var tex=elem.texs[0];if(true){var zoom_level=max((uvs[2]-uvs[0])*tex.width/w,(uvs[3]-uvs[1])*tex.height/h);if(zoom_level<1){if(tex.filter_mag===gl.LINEAR){bias=.5}}else if(zoom_level>1){var mipped_texels=zoom_level/2;bias=.5+mipped_texels}}data[12]=uvs[0]+bias/tex.width;data[13]=uvs[1]+bias/tex.height;data[14]=uvs[2]-bias/tex.width;data[15]=uvs[3]-bias/tex.height;elem.uid=++last_uid;elem.shader=shader||null;elem.blend=0;if(shader_params){shader_params.clip_space=sprite_shader_params.clip_space;elem.shader_params=shader_params}else{elem.shader_params=null}sprite_queue.push(elem)}function clip(z_start,z_end,x,y,w,h){var xy=vec2();camera2d.virtualToCanvas(xy,[x,y]);var wh=vec2();camera2d.virtualToCanvas(wh,[x+w,y+h]);xy[0]=round(xy[0]);xy[1]=round(xy[1]);wh[0]=round(wh[0])-xy[0];wh[1]=round(wh[1])-xy[1];var gd_h=engine.render_height||engine.height;var scissor=[xy[0],gd_h-(xy[1]+wh[1]),wh[0],wh[1]];queuefn(z_start-.01,function(){gl.enable(gl.SCISSOR_TEST);gl.scissor(scissor[0],scissor[1],scissor[2],scissor[3])});queuefn(z_end-.01,function(){gl.disable(gl.SCISSOR_TEST)})}function diffTextures(texsa,texsb){if(texsa.length!==texsb.length){return true}for(var ii=0;ii<texsa.length;++ii){if(texsa[ii]!==texsb[ii]){return true}}return false}var batch_state=void 0;var sprite_geom=void 0;var sprite_buffer=void 0;var sprite_buffer_len=0;var sprite_buffer_batch_start=0;var sprite_buffer_idx=0;var last_blend_mode=void 0;var last_bound_shader=void 0;var MAX_VERT_COUNT=65536;var batches=[];function commit(){if(sprite_buffer_idx===sprite_buffer_batch_start){return}batches.push({state:batch_state,start:sprite_buffer_batch_start,end:sprite_buffer_idx});sprite_buffer_batch_start=sprite_buffer_idx}function commitAndFlush(){commit();if(!batches.length){return}assert(sprite_buffer_idx);sprite_geom.update(sprite_buffer,sprite_buffer_idx);sprite_geom.bind();for(var ii=0;ii<batches.length;++ii){var batch=batches[ii];var state=batch.state,start=batch.start,end=batch.end;if(last_bound_shader!==state.shader||state.shader_params){shaders.bind(sprite_vshader,state.shader||sprite_fshader,state.shader_params||sprite_shader_params);last_bound_shader=state.shader}if(last_blend_mode!==state.blend){last_blend_mode=state.blend;if(last_blend_mode===BLEND_ADDITIVE){gl.blendFunc(gl.SRC_ALPHA,gl.ONE)}else{gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)}}textures.bindArray(state.texs);gl.drawElements(sprite_geom.mode,(end-start)*3/2,gl.UNSIGNED_SHORT,start*3)}batches.length=0;sprite_buffer_idx=0;sprite_buffer_batch_start=0}function bufferSpriteData(data){var index=sprite_buffer_idx*8;sprite_buffer_idx+=4;var c1=data[8];var c2=data[9];var c3=data[10];var c4=data[11];var u1=data[12];var v1=data[13];var u2=data[14];var v2=data[15];sprite_buffer[index]=data[0];sprite_buffer[index+1]=data[1];sprite_buffer[index+2]=c1;sprite_buffer[index+3]=c2;sprite_buffer[index+4]=c3;sprite_buffer[index+5]=c4;sprite_buffer[index+6]=u1;sprite_buffer[index+7]=v1;sprite_buffer[index+8]=data[2];sprite_buffer[index+9]=data[3];sprite_buffer[index+10]=c1;sprite_buffer[index+11]=c2;sprite_buffer[index+12]=c3;sprite_buffer[index+13]=c4;sprite_buffer[index+14]=u1;sprite_buffer[index+15]=v2;sprite_buffer[index+16]=data[4];sprite_buffer[index+17]=data[5];sprite_buffer[index+18]=c1;sprite_buffer[index+19]=c2;sprite_buffer[index+20]=c3;sprite_buffer[index+21]=c4;sprite_buffer[index+22]=u2;sprite_buffer[index+23]=v2;sprite_buffer[index+24]=data[6];sprite_buffer[index+25]=data[7];sprite_buffer[index+26]=c1;sprite_buffer[index+27]=c2;sprite_buffer[index+28]=c3;sprite_buffer[index+29]=c4;sprite_buffer[index+30]=u2;sprite_buffer[index+31]=v1}function draw(){if(!sprite_queue.length){return}gl.disable(gl.DEPTH_TEST);gl.depthMask(false);gl.enable(gl.BLEND);clip_space[0]=2/engine.viewport[2];clip_space[1]=-2/engine.viewport[3];last_blend_mode=-1;last_bound_shader=-1;if(!sprite_geom){sprite_geom=geom.create([[shaders.semantic.POSITION,gl.FLOAT,2,false],[shaders.semantic.COLOR,gl.FLOAT,4,false],[shaders.semantic.TEXCOORD,gl.FLOAT,2,false]],[],null,geom.QUADS);sprite_buffer=new Float32Array(1024);sprite_buffer_len=sprite_buffer.length/8}sprite_queue.sort(cmpSprite);batch_state=null;assert(sprite_buffer_idx===0);assert(sprite_buffer_batch_start===0);assert(batches.length===0);for(var ii=0;ii<sprite_queue.length;++ii){var elem=sprite_queue[ii];if(elem.fn){commitAndFlush();batch_state=null;elem.fn()}else{if(!batch_state||diffTextures(elem.texs,batch_state.texs)||elem.shader!==batch_state.shader||elem.shader_params!==batch_state.shader_params||elem.blend!==batch_state.blend){commit();batch_state=elem}if(sprite_buffer_idx+4>sprite_buffer_len){commitAndFlush();if(sprite_buffer_len!==MAX_VERT_COUNT){var new_length=min(sprite_buffer_len*1.25+3&~3,MAX_VERT_COUNT);sprite_buffer_len=new_length;sprite_buffer=new Float32Array(new_length*8)}}bufferSpriteData(elem.data);sprite_freelist.push(elem)}}commitAndFlush();sprite_queue.length=0;if(last_blend_mode!==BLEND_ALPHA){gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)}}function buildRects(ws,hs){var rects=[];var total_w=0;for(var ii=0;ii<ws.length;++ii){total_w+=ws[ii]}var total_h=0;for(var _ii=0;_ii<hs.length;++_ii){total_h+=hs[_ii]}var tex_w=nextHighestPowerOfTwo(total_w);var tex_h=nextHighestPowerOfTwo(total_h);var wh=[];for(var _ii2=0;_ii2<ws.length;++_ii2){wh.push(ws[_ii2]/total_h)}var y=0;for(var jj=0;jj<hs.length;++jj){var x=0;for(var _ii3=0;_ii3<ws.length;++_ii3){var r=vec4(x/tex_w,y/tex_h,(x+ws[_ii3])/tex_w,(y+hs[jj])/tex_h);rects.push(r);x+=ws[_ii3]}y+=hs[jj]}return{widths:ws,heights:hs,wh:wh,rects:rects,total_w:total_w,total_h:total_h}}function Sprite(params){if(params.texs){this.texs=params.texs}else{this.texs=[];if(params.tex){this.texs.push(params.tex)}else if(params.layers){assert(params.name);this.texs=[];for(var ii=0;ii<params.layers;++ii){this.texs.push(textures.load({url:"img/"+params.name+"_"+ii+".png",filter_min:params.filter_min,filter_mag:params.filter_mag,wrap_s:params.wrap_s,wrap_t:params.wrap_t}))}}else if(params.name){this.texs.push(textures.load({url:"img/"+params.name+".png",filter_min:params.filter_min,filter_mag:params.filter_mag,wrap_s:params.wrap_s,wrap_t:params.wrap_t}))}else{assert(params.url);this.texs.push(textures.load(params))}}this.origin=params.origin||vec2(0,0);this.size=params.size||vec2(1,1);this.color=params.color||vec4(1,1,1,1);this.uvs=params.uvs||vec4(0,0,1,1);if(params.ws){this.uidata=buildRects(params.ws,params.hs)}}Sprite.prototype.draw=function(params){if(params.w===0||params.h===0){return}var w=(params.w||1)*this.size[0];var h=(params.h||1)*this.size[1];var uvs=typeof params.frame==="number"?this.uidata.rects[params.frame]:params.uvs||this.uvs;queuesprite(this,params.x,params.y,params.z,w,h,params.rot,uvs,params.color||this.color,params.shader,params.shader_params)};Sprite.prototype.drawDualTint=function(params){params.shader=sprite_dual_fshader;params.shader_params={color1:params.color1};this.draw(params)};function create(params){return new Sprite(params)}function startup(){clip_space[2]=-1;clip_space[3]=1;sprite_vshader=shaders.create(gl.VERTEX_SHADER,"// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n#pragma WebGL\nprecision highp float;\n\n// per-vertex input\nattribute vec2 POSITION;\nattribute vec4 COLOR;\nattribute vec2 TEXCOORD;\n\n// output\nvarying lowp vec4 interp_color;\nvarying vec2 interp_texcoord;\n\n// global parameters\nuniform vec4 clip_space;\n\nvoid main()\n{\n  interp_texcoord = TEXCOORD;\n  interp_color = COLOR;\n  gl_Position = vec4(POSITION.xy * clip_space.xy + clip_space.zw, 0.0, 1.0);\n}\n");sprite_fshader=shaders.create(gl.FRAGMENT_SHADER,"#pragma WebGL\n\nprecision lowp float;\n\nuniform sampler2D tex0;\n\nvarying lowp vec4 interp_color;\nvarying vec2 interp_texcoord;\n\nvoid main(void) {\n  vec4 tex = texture2D(tex0, interp_texcoord);\n  gl_FragColor = tex * interp_color;\n}\n");sprite_dual_fshader=shaders.create(gl.FRAGMENT_SHADER,"#pragma WebGL\n\nprecision lowp float;\n\nuniform sampler2D tex0;\nuniform sampler2D tex1;\nuniform lowp vec4 color1;\n\nvarying lowp vec4 interp_color;\nvarying vec2 interp_texcoord;\n\nvoid main(void) {\n  vec4 tex0 = texture2D(tex0,interp_texcoord);\n  vec2 tex1 = texture2D(tex1,interp_texcoord).rg;\n  float value = dot(tex0.rgb, vec3(0.2, 0.5, 0.3));\n  vec3 valueR = value * interp_color.rgb;\n  vec3 valueG = value * color1.rgb;\n  vec3 value3 = mix(tex0.rgb, valueG, tex1.g);\n  value3 = mix(value3, valueR, tex1.r);\n  gl_FragColor = vec4(value3, tex0.a * interp_color.a);\n}\n")}},{"./camera2d.js":9,"./engine.js":12,"./geom.js":14,"./shaders.js":20,"./textures.js":25,"./vmath.js":29,assert:35}],25:[function(require,module,exports){"use strict";exports.defaultFilters=defaultFilters;exports.bind=bind;exports.bindArray=bindArray;exports.createForCapture=createForCapture;exports.load=load;exports.findTexForReplacement=findTexForReplacement;exports.startup=startup;var assert=require("assert");var textures=exports.textures={};var load_count=exports.load_count=0;var aniso=4;var max_aniso=0;var aniso_enum=void 0;var default_filter_min=void 0;var default_filter_mag=void 0;var format=exports.format={R8:{count:1},RGB8:{count:3},RGBA8:{count:4}};function defaultFilters(min,mag){default_filter_min=min;default_filter_mag=mag}var _require=require("./vmath.js"),isPowerOfTwo=_require.isPowerOfTwo,nextHighestPowerOfTwo=_require.nextHighestPowerOfTwo;var bound_unit=null;var bound_tex=[];var handle_loading=void 0;var handle_error=void 0;function setUnit(unit){if(unit!==bound_unit){gl.activeTexture(gl.TEXTURE0+unit);bound_unit=unit}}function bindHandle(unit,target,handle){if(bound_tex[unit]!==handle){setUnit(unit);gl.bindTexture(target,handle);bound_tex[unit]=handle}}function unbindHandle(target,handle){for(var unit=0;unit<bound_tex.length;++unit){if(bound_tex[unit]===handle){setUnit(unit);gl.bindTexture(target,null);bound_tex[unit]=null}}}function bind(unit,tex){bindHandle(unit,tex.target,tex.eff_handle)}function bindArray(texs){for(var ii=0;ii<texs.length;++ii){var tex=texs[ii];var handle=tex.eff_handle;if(bound_tex[ii]!==handle){if(ii!==bound_unit){gl.activeTexture(gl.TEXTURE0+ii);bound_unit=ii}gl.bindTexture(tex.target,handle);bound_tex[ii]=handle}}}function Texture(params){this.loaded=false;this.load_fail=false;this.target=gl.TEXTURE_2D;this.handle=gl.createTexture();this.eff_handle=handle_loading;this.setSamplerState(params);this.format=params.format||format.RGBA8;if(params.data){this.updateData(params.width,params.height,params.data)}else if(params.url){this.loadURL(params.url)}}Texture.prototype.setSamplerState=function(params){var target=this.target;setUnit(0);bound_tex[0]=null;bindHandle(0,target,this.handle);this.filter_min=params.filter_min||default_filter_min;this.filter_mag=params.filter_mag||default_filter_mag;gl.texParameteri(target,gl.TEXTURE_MIN_FILTER,this.filter_min);gl.texParameteri(target,gl.TEXTURE_MAG_FILTER,this.filter_mag);gl.texParameteri(target,gl.TEXTURE_WRAP_S,params.wrap_s||gl.REPEAT);gl.texParameteri(target,gl.TEXTURE_WRAP_T,params.wrap_t||gl.REPEAT);this.mipmaps=this.filter_min>=9984&&this.filter_min<=9987;if(max_aniso){if(this.mipmaps&&params.filter_mag!==gl.NEAREST){gl.texParameterf(gl.TEXTURE_2D,aniso_enum,aniso)}else{gl.texParameterf(gl.TEXTURE_2D,aniso_enum,1)}}};Texture.prototype.updateData=function updateData(w,h,data){setUnit(0);bound_tex[0]=null;bindHandle(0,this.target,this.handle);this.width=w;this.height=h;if(data instanceof Uint8Array){gl.texImage2D(this.target,0,this.format.internal_type,w,h,0,this.format.internal_type,this.format.gl_type,data)}else{assert(data instanceof Image);if(!isPowerOfTwo(w)||!isPowerOfTwo(h)){this.width=nextHighestPowerOfTwo(w);this.height=nextHighestPowerOfTwo(h);gl.texImage2D(this.target,0,this.format.internal_type,this.width,this.height,0,this.format.internal_type,this.format.gl_type,null);if(w!==this.width){gl.texSubImage2D(this.target,0,1,0,this.format.internal_type,this.format.gl_type,data)}if(h!==this.height){gl.texSubImage2D(this.target,0,0,1,this.format.internal_type,this.format.gl_type,data)}gl.texSubImage2D(this.target,0,0,0,this.format.internal_type,this.format.gl_type,data)}else{gl.texImage2D(this.target,0,this.format.internal_type,this.format.internal_type,this.format.gl_type,data)}}if(this.mipmaps){gl.generateMipmap(this.target)}this.eff_handle=this.handle;this.loaded=true};Texture.prototype.loadURL=function loadURL(url){var tex=this;var img=new Image;exports.load_count=load_count+=1;var did_done=false;function done(){if(!did_done){did_done=true;exports.load_count=load_count-=1}}img.onload=function(){done();tex.format=format.RGBA8;tex.updateData(img.width,img.height,img)};function fail(){done();tex.eff_handle=handle_error;tex.load_fail=true}img.onerror=fail;img.crossOrigin="anonymous";img.src=url};Texture.prototype.copyTexImage=function(x,y,w,h){assert(w&&h);bindHandle(0,this.target,this.handle);gl.copyTexImage2D(this.target,0,gl.RGB,x,y,w,h,0);this.width=w;this.height=h};Texture.prototype.destroy=function(){delete textures[this.name];unbindHandle(this.target,this.handle);gl.deleteTexture(this.handle)};function create(params){return new Texture(params)}function createForCapture(){var texture=create({filter_min:gl.NEAREST,filter_mag:gl.NEAREST,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE,format:gl.RGB8});texture.loaded=true;texture.eff_handle=texture.handle;texture.name="screen_temporary_tex";return texture}function load(params){var key=params.name||params.url;assert(key);if(textures[key]){return textures[key]}var texture=create(params);texture.name=key;textures[key]=texture;return texture}function cname(key){var idx=key.lastIndexOf("/");if(idx!==-1){key=key.slice(idx+1)}idx=key.lastIndexOf(".");if(idx!==-1){key=key.slice(0,idx)}return key.toLowerCase()}function findTexForReplacement(search_key){search_key=cname(search_key);for(var key in textures){var compare_key=cname(key);if(compare_key===search_key){return textures[key]}}return null}function startup(){default_filter_min=gl.LINEAR_MIPMAP_LINEAR;default_filter_mag=gl.LINEAR;format.R8.internal_type=gl.LUMINANCE;format.R8.gl_type=gl.UNSIGNED_BYTE;format.RGB8.internal_type=gl.RGB;format.RGB8.gl_type=gl.UNSIGNED_BYTE;format.RGBA8.internal_type=gl.RGBA;format.RGBA8.gl_type=gl.UNSIGNED_BYTE;var ext_anisotropic=gl.getExtension("EXT_texture_filter_anisotropic")||gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic");if(ext_anisotropic){aniso_enum=ext_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT;aniso=max_aniso=gl.getParameter(ext_anisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}handle_error=load({name:"error",width:2,height:2,format:format.RGBA8,filter_mag:gl.NEAREST,data:new Uint8Array([255,20,147,255,255,0,0,255,255,255,255,255,255,20,147,255])}).handle;handle_loading=load({name:"loading",width:2,height:2,format:format.RGBA8,data:new Uint8Array([127,127,127,255,0,0,0,255,64,64,64,255,127,127,127,255])}).handle;load({name:"white",width:2,height:2,format:format.RGBA8,data:new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255])})}},{"./vmath.js":29,assert:35}],26:[function(require,module,exports){"use strict";exports.queue=queue;exports.render=render;exports.fade=fade;exports.splitScreen=splitScreen;exports.pixelate=pixelate;exports.randomTransition=randomTransition;var assert=require("assert");var camera2d=require("./camera2d.js");var glov_engine=require("./engine.js");var sprites=require("./sprites.js");var shaders=require("./shaders.js");var textures=require("./textures.js");var glov_ui=require("./ui.js");var _require=require("../../common/util.js"),easeOut=_require.easeOut;var _require2=require("./vmath.js"),unit_vec=_require2.unit_vec,vec4=_require2.vec4;var floor=Math.floor,min=Math.min,pow=Math.pow,random=Math.random;var transitions=[];var IMMEDIATE=exports.IMMEDIATE="immediate";var REMOVE=exports.REMOVE="remove";var CONTINUE=exports.CONTINUE="continue";var shader_data={transition_pixelate:{fp:"#pragma WebGL\n\nprecision lowp float;\n\nvarying highp vec2 interp_texcoord;\n\nuniform sampler2D tex0;\nuniform vec4 param0;\nuniform vec4 param1;\n\nvoid main(void)\n{\n  vec2 interp_uvs = interp_texcoord;\n  // TODO: for best look, should generate an appropriate mipmap and sample from that/just render it w/ nearest neighbor\n  // result = texture2D(tex0, min(floor(interp_uvs.xy * param0.xy + 0.5) * param0.zw - param1.xy, param1.zw) );\n\n  // Unlike ARBfp version, shift RGB channels separately (3x slowdown)\n  vec4 texture0r = texture2D(tex0, min(floor(interp_uvs.xy * param0.xy + vec2(0.58, 0.5)) * param0.zw - param1.xy, param1.zw) );\n  vec4 texture0g = texture2D(tex0, min(floor(interp_uvs.xy * param0.xy + vec2(0.5, 0.48)) * param0.zw - param1.xy, param1.zw) );\n  vec4 texture0b = texture2D(tex0, min(floor(interp_uvs.xy * param0.xy + vec2(0.42, 0.5)) * param0.zw - param1.xy, param1.zw) );\n  gl_FragColor = vec4(texture0r.r, texture0g.g, texture0b.b, 1);\n}\n"}};function getShader(key){var elem=shader_data[key];if(!elem.shader){elem.shader=shaders.create(gl.FRAGMENT_SHADER,elem.fp)}return elem.shader}var GlovTransition=function GlovTransition(z,func){this.z=z;this.capture=null;this.func=func;this.accum_time=0};function transitionCapture(trans){assert(!trans.capture);trans.capture=textures.createForCapture();glov_engine.captureFramebuffer(trans.capture)}function queue(z,fn){var immediate=false;if(z===IMMEDIATE){immediate=true;z=Z.TRANSITION_FINAL}for(var ii=0;ii<transitions.length;++ii){var _trans=transitions[ii];if(_trans.z===z){assert(_trans.capture);if(!_trans.capture){return false}}}var trans=new GlovTransition(z,fn);transitions.push(trans);if(immediate){transitionCapture(trans)}return true}function destroyTexture(tex){tex.destroy()}function render(dt){dt=min(dt,100);for(var trans_idx=0;trans_idx<transitions.length;++trans_idx){var trans=transitions[trans_idx];trans.accum_time+=dt;if(!trans.capture){sprites.queuefn(trans.z+Z.TRANSITION_RANGE,transitionCapture.bind(null,trans))}else if(trans.capture){var force_end=trans_idx<transitions.length-1;var ret=trans.func(trans.z,trans.capture,trans.accum_time,force_end);if(ret===REMOVE){setTimeout(destroyTexture.bind(null,trans.capture),0);transitions.splice(trans_idx,1);trans_idx--}}}}function glovTransitionFadeFunc(fade_time,z,initial,ms_since_start,force_end){var progress=min(ms_since_start/fade_time,1);var alpha=1-easeOut(progress,2);var color=vec4(1,1,1,alpha);camera2d.setNormalized();sprites.queueraw4([initial],0,0,0,1,1,1,1,0,z,0,1,1,0,color);if(force_end||progress===1){return REMOVE}return CONTINUE}function glovTransitionSplitScreenFunc(time,border_width,slide_window,z,tex,ms_since_start,force_end){var border_color=vec4(1,1,1,1);var progress=easeOut(min(ms_since_start/time,1),2);camera2d.setNormalized();var uvs=[[0,1],[1,0]];var xoffs=progress;var v_half=uvs[0][1]+(uvs[1][1]-uvs[0][1])/2;if(slide_window){sprites.queueraw([tex],0,0,z,1-xoffs,1/2,0,uvs[0][1],uvs[1][0]*(1-progress),v_half,unit_vec);sprites.queueraw([tex],0+xoffs,1/2,z,1-xoffs,1/2,uvs[1][0]*progress,v_half,uvs[1][0],uvs[1][1],unit_vec)}else{sprites.queueraw([tex],0-xoffs,0,z,1,1/2,uvs[0][0],uvs[0][1],uvs[1][0],v_half,unit_vec);sprites.queueraw([tex],0+xoffs,1/2,z,1,1/2,uvs[0][0],v_half,uvs[1][0],uvs[1][1],unit_vec)}var border_grow_progress=min(progress*4,1);border_color[3]=border_grow_progress;border_width*=border_grow_progress;glov_ui.drawRect(0,.5-border_width,1-xoffs,.5,z+1,border_color);glov_ui.drawRect(1-xoffs-border_width,0,1-xoffs,.5,z+1,border_color);glov_ui.drawRect(xoffs,.5,1,.5+border_width,z+1,border_color);glov_ui.drawRect(xoffs,.5,xoffs+border_width,1,z+1,border_color);if(force_end||progress===1){return REMOVE}return CONTINUE}var render_scale=1;var transition_pixelate_texture=void 0;function transitionPixelateCapture(){if(!transition_pixelate_texture){transition_pixelate_texture=textures.createForCapture()}glov_engine.captureFramebuffer(transition_pixelate_texture)}function glovTransitionPixelateFunc(time,z,tex,ms_since_start,force_end){var gd_width=glov_engine.width;var progress=min(ms_since_start/time,1);camera2d.setNormalized();if(progress>.5){sprites.queuefn(z,transitionPixelateCapture);if(transition_pixelate_texture){tex=transition_pixelate_texture}}var partial_progress=(progress>.5?1-progress:progress)*2;var pixel_scale=pow(2,floor(partial_progress*8.9))/1024*gd_width*render_scale;var param0=vec4(tex.width/pixel_scale,tex.height/pixel_scale,pixel_scale/tex.width,pixel_scale/tex.height);var param1=vec4(.5/tex.width,.5/tex.height,(tex.texSizeX-1)/tex.width,(tex.texSizeY-1)/tex.height);sprites.queueraw([tex],0,0,z+1,1,1,0,1,1,0,unit_vec,getShader("transition_pixelate"),{param0:param0,param1:param1});if(force_end||progress===1){setTimeout(destroyTexture.bind(null,transition_pixelate_texture),0);transition_pixelate_texture=null;return REMOVE}return CONTINUE}function fade(fade_time){return glovTransitionFadeFunc.bind(null,fade_time)}function splitScreen(time,border_width,slide_window){border_width/=camera2d.w();return glovTransitionSplitScreenFunc.bind(null,time,border_width,slide_window)}function pixelate(fade_time){return glovTransitionPixelateFunc.bind(null,fade_time)}function randomTransition(fade_time_scale){fade_time_scale=fade_time_scale||1;var idx=floor(random()*3);switch(idx){case 0:return fade(500*fade_time_scale);case 1:return splitScreen(250*fade_time_scale,2,false);case 2:return pixelate(750*fade_time_scale);default:assert(0)}return null}},{"../../common/util.js":37,"./camera2d.js":9,"./engine.js":12,"./shaders.js":20,"./sprites.js":24,"./textures.js":25,"./ui.js":27,"./vmath.js":29,assert:35}],27:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.focuslog=focuslog;exports.makeColorSet=makeColorSet;exports.startup=startup;exports.getElem=getElem;exports.bindSounds=bindSounds;exports.drawHBox=drawHBox;exports.drawBox=drawBox;exports.playUISound=playUISound;exports.setMouseOver=setMouseOver;exports.focusSteal=focusSteal;exports.focusCanvas=focusCanvas;exports.isFocusedPeek=isFocusedPeek;exports.isFocused=isFocused;exports.focusNext=focusNext;exports.focusPrev=focusPrev;exports.focusCheck=focusCheck;exports.panel=panel;exports.drawTooltip=drawTooltip;exports.buttonShared=buttonShared;exports.buttonTextDraw=buttonTextDraw;exports.buttonText=buttonText;exports.buttonImage=buttonImage;exports.print=print;exports.modalDialog=modalDialog;exports.createEditBox=createEditBox;exports.tick=tick;exports.endFrame=endFrame;exports.menuUp=menuUp;exports.drawRect=drawRect;exports.drawCircle=drawCircle;exports.drawHollowCircle=drawHollowCircle;exports.drawLine=drawLine;exports.drawCone=drawCone;exports.scaleSizes=scaleSizes;exports.setFontHeight=setFontHeight;window.Z=window.Z||{};Z.BORDERS=Z.BORDERS||90;Z.UI=Z.UI||100;Z.MODAL=Z.MODAL||1e3;Z.TOOLTIP=Z.TOOLTIP||2e3;Z.DEBUG=Z.DEBUG||9800;Z.TRANSITION_FINAL=Z.TRANSITION_FINAL||9900;Z.TRANSITION_RANGE=Z.TRANSITION_RANGE||10;Z.FPSMETER=Z.FPSMETER||1e4;var assert=require("assert");var camera2d=require("./camera2d.js");var glov_edit_box=require("./edit_box.js");var effects=require("./effects.js");var glov_engine=require("./engine.js");var glov_font=require("./font.js");var glov_input=require("./input.js");var abs=Math.abs,max=Math.max,min=Math.min,round=Math.round,sqrt=Math.sqrt;var glov_sprites=require("./sprites.js");var textures=require("./textures.js");var _require=require("../../common/util.js"),clone=_require.clone,merge=_require.merge;var _require2=require("./mat43.js"),mat43=_require2.mat43,m43identity=_require2.m43identity,m43mul=_require2.m43mul;var _require3=require("./vmath.js"),clamp=_require3.clamp,lerp=_require3.lerp,vec2=_require3.vec2,vec4=_require3.vec4,v4scale=_require3.v4scale;var MODAL_DARKEN=.75;var KEYS=void 0;var pad_codes=void 0;var menu_fade_params_default={blur:[.125,.865],saturation:[.5,.1],brightness:[1,1-MODAL_DARKEN],fallback_darken:vec4(0,0,0,MODAL_DARKEN),z:Z.MODAL};function focuslog(){}function makeColorSet(color){var ret={regular:vec4(),rollover:vec4(),down:vec4(),disabled:vec4()};v4scale(ret.regular,color,1);v4scale(ret.rollover,color,.8);v4scale(ret.down,color,.7);v4scale(ret.disabled,color,.4);for(var field in ret){ret[field][3]=color[3]}return ret}function doBlurEffect(factor,params){factor=lerp(factor,params.blur[0],params.blur[1]);if(factor){effects.applyGaussianBlur({source:glov_engine.captureFramebuffer(),blur:factor})}}var desaturate_xform=mat43();var desaturate_tmp=mat43();function doDesaturateEffect(factor,params){var saturation=lerp(factor,params.saturation[0],params.saturation[1]);var brightness=lerp(factor,params.brightness[0],params.brightness[1]);if(saturation===1&&brightness===1){return}m43identity(desaturate_xform);effects.saturationMatrix(desaturate_tmp,saturation);m43mul(desaturate_xform,desaturate_xform,desaturate_tmp);effects.brightnessScaleMatrix(desaturate_tmp,brightness);m43mul(desaturate_xform,desaturate_xform,desaturate_tmp);effects.applyColorMatrix({colorMatrix:desaturate_xform,source:glov_engine.captureFramebuffer()})}var button_height=exports.button_height=32;var font_height=exports.font_height=24;var button_width=exports.button_width=200;var button_img_size=exports.button_img_size=button_height;var modal_width=exports.modal_width=600;var modal_y0=exports.modal_y0=200;var modal_title_scale=exports.modal_title_scale=1.2;var pad=exports.pad=16;var panel_pixel_scale=exports.panel_pixel_scale=32/13;var tooltip_width=exports.tooltip_width=400;var tooltip_pad=exports.tooltip_pad=8;var font_style_focused=exports.font_style_focused=glov_font.style(null,{color:255,outline_width:2,outline_color:4294967295});var font_style_normal=exports.font_style_normal=glov_font.styleColored(null,255);var font=exports.font=void 0;var sprites=exports.sprites={};var color_button=exports.color_button=makeColorSet([1,1,1,1]);var color_panel=exports.color_panel=vec4(1,1,.75,1);var modal_font_style=exports.modal_font_style=glov_font.styleColored(null,255);var sounds={};var button_mouseover=exports.button_mouseover=false;var button_focused=exports.button_focused=false;var touch_changed_focus=exports.touch_changed_focus=false;var last_frame_button_mouseover=false;var frame_button_mouseover=false;var modal_dialog=null;var modal_stealing_focus=false;var menu_up=exports.menu_up=false;var menu_fade_params=merge({},menu_fade_params_default);var menu_up_time=0;exports.this_frame_edit_boxes=[];var last_frame_edit_boxes=[];var dom_elems=[];var dom_elems_issued=0;var button_keys=void 0;var focused_last_frame=void 0;var focused_this_frame=void 0;var focused_key_not=void 0;var focused_key=void 0;var focused_key_prev1=void 0;var focused_key_prev2=void 0;function startup(_font,ui_sprites){ui_sprites=ui_sprites||{};exports.font=font=_font;KEYS=glov_input.KEYS;pad_codes=glov_input.pad_codes;function loadUISprite(name,ws,hs,only_override){var override=ui_sprites[name];if(override){sprites[name]=glov_sprites.create({name:override[0],ws:override[1],hs:override[2]})}else if(!only_override){sprites[name]=glov_sprites.create({name:"ui/"+name,ws:ws,hs:hs})}}loadUISprite("button",[4,5,4],[13]);sprites.button_regular=sprites.button;loadUISprite("button_rollover",[4,5,4],[13],true);loadUISprite("button_down",[4,5,4],[13]);loadUISprite("button_disabled",[4,5,4],[13]);loadUISprite("panel",[3,2,3],[3,10,3]);loadUISprite("menu_entry",[4,5,4],[13]);loadUISprite("menu_selected",[4,5,4],[13]);loadUISprite("menu_down",[4,5,4],[13]);loadUISprite("menu_header",[4,5,12],[13]);sprites.white=glov_sprites.create({url:"white"});button_keys={ok:{key:[],pad:[pad_codes.X]},cancel:{key:[KEYS.ESC],pad:[pad_codes.B,pad_codes.Y]}};button_keys.yes=clone(button_keys.ok);button_keys.yes.key.push(KEYS.Y);button_keys.no=clone(button_keys.cancel);button_keys.no.key.push(KEYS.N)}var dynamic_text_elem=void 0;function getElem(){if(modal_dialog){return null}if(dom_elems_issued>=dom_elems.length){var _elem=document.createElement("div");_elem.setAttribute("class","glovui_dynamic");if(!dynamic_text_elem){dynamic_text_elem=document.getElementById("dynamic_text")}dynamic_text_elem.appendChild(_elem);dom_elems.push(_elem)}var elem=dom_elems[dom_elems_issued];dom_elems_issued++;return elem}var sound_manager=void 0;function bindSounds(_sound_manager,_sounds){sound_manager=_sound_manager;sounds=_sounds;for(var key in sounds){sound_manager.loadSound(sounds[key])}}function drawHBox(coords,s,color){var uidata=s.uidata;var ws=[uidata.wh[0]*coords.h,0,uidata.wh[2]*coords.h];var x=coords.x;ws[1]=max(0,coords.w-ws[0]-ws[2]);for(var ii=0;ii<ws.length;++ii){var my_w=ws[ii];s.draw({x:x,y:coords.y,z:coords.z,color:color,w:my_w,h:coords.h,uvs:uidata.rects[ii]});x+=my_w}}function drawBox(coords,s,pixel_scale,color){var uidata=s.uidata;var scale=pixel_scale;var ws=[uidata.widths[0]*scale,0,uidata.widths[2]*scale];ws[1]=max(0,coords.w-ws[0]-ws[2]);var hs=[uidata.heights[0]*scale,0,uidata.heights[2]*scale];hs[1]=max(0,coords.h-hs[0]-hs[2]);var x=coords.x;for(var ii=0;ii<ws.length;++ii){var my_w=ws[ii];if(my_w){var y=coords.y;for(var jj=0;jj<hs.length;++jj){var my_h=hs[jj];if(my_h){s.draw({x:x,y:y,z:coords.z,color:color,w:my_w,h:my_h,uvs:uidata.rects[jj*3+ii]});y+=my_h}}x+=my_w}}}function playUISound(name){if(name==="select"){name="button_click"}if(sounds[name]&&sound_manager){sound_manager.play(sounds[name])}}function setMouseOver(key){if(last_frame_button_mouseover!==key&&frame_button_mouseover!==key){playUISound("rollover")}frame_button_mouseover=key;exports.button_mouseover=button_mouseover=true}function focusSteal(key){if(key!==focused_key){focuslog("focusSteal ",key)}focused_this_frame=true;focused_key=key}function focusCanvas(){focusSteal("canvas")}function isFocusedPeek(key){return focused_key===key}function isFocused(key){if(key!==focused_key_prev2){focused_key_prev1=focused_key_prev2;focused_key_prev2=key}if(key===focused_key||key!==focused_key_not&&!focused_this_frame&&!focused_last_frame){if(key!==focused_key){focuslog("isFocused->focusSteal")}focusSteal(key);return true}return false}function focusNext(key){focuslog("focusNext ",key);playUISound("rollover");focused_key=null;focused_last_frame=focused_this_frame=false;focused_key_not=key;glov_input.eatAllInput()}function focusPrev(key){focuslog("focusPrev ",key);playUISound("rollover");if(key===focused_key_prev2){focusSteal(focused_key_prev1)}else{focusSteal(focused_key_prev2)}glov_input.eatAllInput()}function focusCheck(key){if(modal_stealing_focus){return false}var focused=isFocused(key);if(focused){if(glov_input.keyDownEdge(KEYS.TAB)){if(glov_input.keyDown(KEYS.SHIFT)){focusPrev(key)}else{focusNext(key);focused=false}}if(glov_input.padButtonDownEdge(pad_codes.RIGHT_BUMPER)){focusNext(key);focused=false}if(glov_input.padButtonDownEdge(pad_codes.LEFT_BUMPER)){focusPrev(key)}}return focused}function panel(param){assert(typeof param.x==="number");assert(typeof param.y==="number");assert(typeof param.w==="number");assert(typeof param.h==="number");param.z=param.z||Z.UI-1;var color=param.color||color_panel;drawBox(param,sprites.panel,panel_pixel_scale,color);glov_input.click(param);glov_input.mouseOver(param)}function drawTooltip(param){assert(typeof param.x==="number");assert(typeof param.y==="number");assert(typeof param.tooltip==="string");var tooltip_w=param.tooltip_width||tooltip_width;var x=param.x;if(x+tooltip_w>camera2d.x1()){x=camera2d.x1()-tooltip_w}var z=param.z||Z.TOOLTIP;var tooltip_y0=param.y;var eff_tooltip_pad=param.tooltip_pad||tooltip_pad;var y=tooltip_y0+eff_tooltip_pad;y+=font.drawSizedWrapped(modal_font_style,x+eff_tooltip_pad,y,z+1,tooltip_w-eff_tooltip_pad*2,0,font_height,param.tooltip);y+=eff_tooltip_pad;panel({x:x,y:tooltip_y0,z:z,w:tooltip_w,h:y-tooltip_y0})}function buttonShared(param){var state="regular";var ret=false;var key=param.key||param.x+"_"+param.y;var focused=!param.disabled&&!param.no_focus&&focusCheck(key);exports.button_mouseover=button_mouseover=false;if(param.disabled){glov_input.mouseOver(param);state="disabled"}else if(glov_input.click(param)){if(!param.no_touch_mouseover||!glov_input.mousePosIsTouch()){setMouseOver(key)}if(param.touch_twice&&glov_input.mousePosIsTouch()&&!focused){exports.touch_changed_focus=touch_changed_focus=true}else{ret=true}if(!param.no_focus){focusSteal(key);focused=true}}else if(glov_input.mouseOver(param)){if(param.no_touch_mouseover&&glov_input.mousePosIsTouch()){}else if(param.touch_twice&&!focused&&glov_input.mousePosIsTouch()){}else{setMouseOver(key);state=glov_input.mouseDown()?"down":"rollover"}}exports.button_focused=button_focused=focused;if(focused){if(glov_input.keyDownEdge(KEYS.SPACE)||glov_input.keyDownEdge(KEYS.RETURN)||glov_input.padButtonDownEdge(pad_codes.A)){ret=true}}if(ret){state="down";playUISound("button_click")}if(button_mouseover&&param.tooltip){drawTooltip({x:param.x,y:param.tooltip_above?param.y-font_height*2-16:param.y+param.h+2,tooltip:param.tooltip,tooltip_width:param.tooltip_width})}return{ret:ret,state:state,focused:focused}}function buttonTextDraw(param,state,focused){var colors=param.colors||color_button;var color=colors[state];var sprite_name="button_"+state;var sprite=sprites[sprite_name];if(sprite){color=colors.regular}else{sprite=sprites.button}drawHBox(param,sprite,color);font.drawSizedAligned(focused?font_style_focused:font_style_normal,param.x,param.y,param.z+.1,param.font_height,glov_font.ALIGN.HCENTERFIT|glov_font.ALIGN.VCENTER,param.w,param.h,param.text)}function buttonText(param){assert(typeof param.x==="number");assert(typeof param.y==="number");assert(typeof param.text==="string");param.z=param.z||Z.UI;param.w=param.w||button_width;param.h=param.h||button_height;param.font_height=param.font_height||font_height;var _buttonShared=buttonShared(param),ret=_buttonShared.ret,state=_buttonShared.state,focused=_buttonShared.focused;buttonTextDraw(param,state,focused);return ret}function buttonImage(param){assert(typeof param.x==="number");assert(typeof param.y==="number");assert(param.img&&param.img.draw);param.z=param.z||Z.UI;param.w=param.w||button_img_size;param.h=param.h||param.w||button_img_size;param.shrink=param.shrink||.75;var uvs=param.img_rect||(typeof param.frame==="number"?param.img.uidata.rects[param.frame]:null);var _buttonShared2=buttonShared(param),ret=_buttonShared2.ret,state=_buttonShared2.state;var colors=param.colors||color_button;var color=colors[state];drawHBox(param,sprites.button,color);var img_w=param.img.size[0];var img_h=param.img.size[1];var img_origin=param.img.origin;var img_scale=min(param.w*param.shrink/img_w,param.h*param.shrink/img_h);img_w*=img_scale;img_h*=img_scale;var draw_param={x:param.x+(param.w-img_w)/2+img_origin[0]*img_w,y:param.y+(param.h-img_h)/2+img_origin[1]*img_h,z:param.z+.1,color:color,color1:param.color1,w:img_scale,h:img_scale,uvs:uvs,rot:param.rotation};if(param.color1){param.img.drawDualTint(draw_param)}else{param.img.draw(draw_param)}return ret}function print(style,x,y,z,text){return font.drawSized(style,x,y,z,font_height,text)}function modalDialog(params){assert(!params.title||typeof params.title==="string");assert(!params.text||typeof params.text==="string");assert(_typeof(params.buttons)==="object");assert(Object.keys(params.buttons).length);modal_dialog=params}function modalDialogRun(){var eff_button_width=modal_dialog.button_width||round(button_width/2);var game_width=camera2d.x1()-camera2d.x0();var text_w=modal_width-pad*2;var x0=camera2d.x0()+round((game_width-modal_width)/2);var x=x0+pad;var y0=modal_y0;var y=y0+pad;var eff_font_height=modal_dialog.font_height||font_height;if(modal_dialog.title){y+=font.drawSizedWrapped(modal_font_style,x,y,Z.MODAL,text_w,0,eff_font_height*modal_title_scale,modal_dialog.title);y+=round(pad*1.5)}if(modal_dialog.text){y+=font.drawSizedWrapped(modal_font_style,x,y,Z.MODAL,text_w,0,eff_font_height,modal_dialog.text);y+=pad}var buttons=modal_dialog.buttons;var keys=Object.keys(buttons);x=x0+modal_width-pad-eff_button_width-(pad+eff_button_width)*(keys.length-1);for(var ii=0;ii<keys.length;++ii){var key=keys[ii];var eff_button_keys=button_keys[key.toLowerCase()];var pressed=false;if(eff_button_keys){for(var jj=0;jj<eff_button_keys.key.length;++jj){pressed=pressed||glov_input.keyDownEdge(eff_button_keys.key[jj])}for(var _jj=0;_jj<eff_button_keys.pad.length;++_jj){pressed=pressed||glov_input.padButtonDownEdge(eff_button_keys.pad[_jj])}}if(pressed){playUISound("button_click")}if(buttonText({x:x,y:y,z:Z.MODAL,w:eff_button_width,h:button_height,text:key})||pressed){modal_dialog=null;if(buttons[key]){buttons[key]()}}x+=pad+eff_button_width}y+=button_height;y+=pad*2;panel({x:x0,y:y0,z:Z.MODAL-1,w:modal_width,h:y-y0});glov_input.eatAllInput();modal_stealing_focus=true}function createEditBox(params){return glov_edit_box.create(params)}var bad_frames=0;function tick(dt){last_frame_button_mouseover=frame_button_mouseover;frame_button_mouseover=false;focused_last_frame=focused_this_frame;focused_this_frame=false;focused_key_not=null;modal_stealing_focus=false;exports.touch_changed_focus=touch_changed_focus=false;for(var ii=0;ii<last_frame_edit_boxes.length;++ii){var edit_box=last_frame_edit_boxes[ii];var idx=exports.this_frame_edit_boxes.indexOf(edit_box);if(idx===-1){edit_box.unrun()}}last_frame_edit_boxes=exports.this_frame_edit_boxes;exports.this_frame_edit_boxes=[];while(dom_elems_issued<dom_elems.length){var elem=dom_elems.pop();dynamic_text_elem.removeChild(elem)}dom_elems_issued=0;var pp_this_frame=false;if(modal_dialog||menu_up){var params=menu_fade_params;if(!menu_up){params=menu_fade_params_default}menu_up_time+=dt;if(glov_engine.postprocessing){var factor=min(menu_up_time/500,1);glov_sprites.queuefn(params.z-2,doBlurEffect.bind(null,factor,params));glov_sprites.queuefn(params.z-1,doDesaturateEffect.bind(null,factor,params));pp_this_frame=true}else{sprites.white.draw({x:camera2d.x0(),y:camera2d.y0(),z:params.z-2,color:params.fallback_darken,w:camera2d.x1()-camera2d.x0(),h:camera2d.y1()-camera2d.y0()})}}else{menu_up_time=0}exports.menu_up=menu_up=false;if(!glov_engine.is_loading&&glov_engine.this_frame_time>250&&pp_this_frame){bad_frames++;if(bad_frames>=3){glov_engine.postprocessingAllow(false)}}else if(bad_frames){bad_frames=0}if(modal_dialog){modalDialogRun()}}function endFrame(){if(glov_input.click({x:-Infinity,y:-Infinity,w:Infinity,h:Infinity})){focusSteal("canvas")}}function menuUp(params){merge(menu_fade_params,menu_fade_params_default);if(params){merge(menu_fade_params,params)}exports.menu_up=menu_up=true;modal_stealing_focus=true;glov_input.eatAllInput()}function drawRect(x0,y0,x1,y1,z,color){var mx=min(x0,x1);var my=min(y0,y1);var Mx=max(x0,x1);var My=max(y0,y1);sprites.white.draw({x:mx,y:my,z:z,color:color,w:Mx-mx,h:My-my})}function spreadTechParams(spread){spread=min(max(spread,0),.99);var tech_params={param0:vec4(0,0,0,0)};tech_params.param0[0]=1/(1-spread);tech_params.param0[1]=-.5*tech_params.param0[0]+.5;return tech_params}function drawCircleInternal(sprite,x,y,z,r,spread,tu1,tv1,tu2,tv2,color){var x0=x-r*2+r*4*tu1;var x1=x-r*2+r*4*tu2;var y0=y-r*2+r*4*tv1;var y1=y-r*2+r*4*tv2;glov_sprites.queueraw(sprite.texs,x0,y0,z,x1-x0,y1-y0,tu1,tv1,tu2,tv2,color,glov_font.font_shaders.font_aa,spreadTechParams(spread))}function drawCircle(x,y,z,r,spread,color){if(!sprites.circle){var CIRCLE_SIZE=32;var data=new Uint8Array(CIRCLE_SIZE*CIRCLE_SIZE);var midp=(CIRCLE_SIZE-1)/2;for(var i=0;i<CIRCLE_SIZE;i++){for(var j=0;j<CIRCLE_SIZE;j++){var d=sqrt((i-midp)*(i-midp)+(j-midp)*(j-midp))/midp;var v=clamp(1-d,0,1);data[i+j*CIRCLE_SIZE]=v*255}}sprites.circle=glov_sprites.create({url:"circle",width:CIRCLE_SIZE,height:CIRCLE_SIZE,format:textures.format.R8,data:data,filter_min:gl.LINEAR,filter_max:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE,origin:vec2(.5,.5)})}drawCircleInternal(sprites.circle,x,y,z,r,spread,0,0,1,1,color)}function drawHollowCircle(x,y,z,r,spread,color){if(!sprites.hollow_circle){var CIRCLE_SIZE=128;var LINE_W=2;var data=new Uint8Array(CIRCLE_SIZE*CIRCLE_SIZE);var midp=(CIRCLE_SIZE-1)/2;for(var i=0;i<CIRCLE_SIZE;i++){for(var j=0;j<CIRCLE_SIZE;j++){var d=sqrt((i-midp)*(i-midp)+(j-midp)*(j-midp))/midp;var v=clamp(1-d,0,1);if(v>.5){v=1-v}v+=LINE_W/CIRCLE_SIZE;data[i+j*CIRCLE_SIZE]=v*255}}sprites.hollow_circle=glov_sprites.create({url:"hollow_circle",width:CIRCLE_SIZE,height:CIRCLE_SIZE,format:textures.format.R8,data:data,filter_min:gl.LINEAR,filter_max:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE,origin:vec2(.5,.5)})}drawCircleInternal(sprites.hollow_circle,x,y,z,r,spread,0,0,1,1,color)}function drawLine(x0,y0,x1,y1,z,w,spread,color){if(!sprites.line){var LINE_SIZE=32;var data=new Uint8Array(LINE_SIZE*LINE_SIZE);var midp=(LINE_SIZE-1)/2;for(var i=0;i<LINE_SIZE;i++){for(var j=0;j<LINE_SIZE;j++){var d=abs((i-midp)/midp);var v=clamp(1-d,0,1);data[i+j*LINE_SIZE]=v*255}}sprites.line=glov_sprites.create({url:"line",width:LINE_SIZE,height:LINE_SIZE,format:textures.format.R8,data:data,filter_min:gl.LINEAR,filter_max:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE,origin:vec2(.5,.5)})}var dx=x1-x0;var dy=y1-y0;var length=Math.sqrt(dx*dx+dy*dy);dx/=length;dy/=length;var tangx=-dy*w;var tangy=dx*w;glov_sprites.queueraw4(sprites.line.texs,x0+tangx,y0+tangy,x1+tangx,y1+tangy,x1-tangx,y1-tangy,x0-tangx,y0-tangy,z,0,0,1,1,color,glov_font.font_shaders.font_aa,spreadTechParams(spread))}function drawCone(x0,y0,x1,y1,z,w0,w1,spread,color){if(!sprites.cone){var CONE_SIZE=32;var data=new Uint8Array(CONE_SIZE*CONE_SIZE);var midp=(CONE_SIZE-1)/2;for(var i=0;i<CONE_SIZE;i++){for(var j=0;j<CONE_SIZE;j++){var _dx=0;var _dy=0;var d=0;if(i>midp){_dx=(i-midp)/midp;_dy=abs(j-midp)/midp;var dCircle=sqrt(_dx*_dx+_dy*_dy);d=_dx*dCircle}var v=clamp(1-d,0,1);data[i+j*CONE_SIZE]=v*255}}sprites.cone=glov_sprites.create({url:"cone",width:CONE_SIZE,height:CONE_SIZE,format:textures.format.R8,data:data,filter_min:gl.LINEAR,filter_max:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE,origin:vec2(.5,.5)})}var dx=x1-x0;var dy=y1-y0;var length=Math.sqrt(dx*dx+dy*dy);dx/=length;dy/=length;var tangx=-dy;var tangy=dx;glov_sprites.queueraw4(sprites.cone.texs,x0-tangx*w0,y0-tangy*w0,x0+tangx*w0,y0+tangy*w0,x1+tangx*w1,y1+tangy*w1,x1-tangx*w1,y1-tangy*w1,z,0,0,1,1,color,glov_font.font_shaders.font_aa,spreadTechParams(spread))}function scaleSizes(scale){exports.button_height=button_height=round(32*scale);exports.font_height=font_height=round(24*scale);exports.button_width=button_width=round(200*scale);exports.button_img_size=button_img_size=button_height;exports.modal_width=modal_width=round(600*scale);exports.modal_y0=modal_y0=round(200*scale);exports.modal_title_scale=modal_title_scale=1.2;exports.pad=pad=round(16*scale);exports.tooltip_width=tooltip_width=round(400*scale);exports.tooltip_pad=tooltip_pad=round(8*scale);exports.panel_pixel_scale=panel_pixel_scale=button_height/13}function setFontHeight(_font_height){exports.font_height=font_height=_font_height}scaleSizes(1)},{"../../common/util.js":37,"./camera2d.js":9,"./edit_box.js":10,"./effects.js":11,"./engine.js":12,"./font.js":13,"./input.js":15,"./mat43.js":17,"./sprites.js":24,"./textures.js":25,"./vmath.js":29,assert:35}],28:[function(require,module,exports){"use strict";exports.run=run;exports.runFontTest=runFontTest;var assert=require("assert");var glov_engine=require("./engine.js");var glov_font=require("./font.js");var glov_input=require("./input.js");var glov_simple_menu=require("./simple_menu.js");var glov_selection_box=require("./selection_box.js");var glov_ui=require("./ui.js");var ceil=Math.ceil,random=Math.random;var demo_menu=void 0;var demo_menu_up=false;var demo_result=void 0;var font_style=void 0;var inited=void 0;var edit_box1=void 0;var edit_box2=void 0;var test_select1=void 0;var test_select2=void 0;function init(x,y,column_width){edit_box1=glov_ui.createEditBox({x:x+column_width,y:y,w:column_width-8});edit_box2=glov_ui.createEditBox({x:x+column_width+column_width,y:y,w:column_width-8});demo_menu=glov_simple_menu.create({items:["Option 1",{name:"Option 2",tag:"opt2"},{name:"Option C",cb:function cb(){demo_result="Callback the third"}}]});font_style=glov_font.style(null,{outline_width:1,outline_color:2147483903,glow_xoffs:3.25,glow_yoffs:3.25,glow_inner:-2.5,glow_outer:5,glow_color:255});test_select1=glov_selection_box.create({items:["Apples","Bananas","Chameleon"],z:Z.UI,width:column_width-8});test_select2=glov_selection_box.create({items:["Apples","Bananas","Chameleon"],is_dropdown:true,z:Z.UI,width:column_width-8})}function run(x,y,z){z=z||Z.UI;var line_height=glov_ui.button_height+2;var column_width=glov_ui.button_width+8;if(inited!==x+"_"+y+"_"+column_width){init(x,y,column_width);inited=x+"_"+y+"_"+column_width}if(demo_menu_up){demo_result="";demo_menu.run({x:x+glov_ui.button_width,y:y+line_height,z:Z.MODAL});if(demo_menu.isSelected()){if(demo_menu.isSelected("opt2")){demo_result="Selected the second option"}if(!demo_result){demo_result="Menu selected: "+demo_menu.getSelectedItem().name}demo_menu_up=false}glov_ui.menuUp();glov_input.eatAllInput()}var pad=8;var w=glov_ui.print(font_style,x+column_width+4,y+40,z,"Edit Box Text: "+edit_box1.text+"+"+edit_box2.text);w=Math.max(w,glov_ui.print(font_style,x+column_width,y+40+glov_ui.font_height+pad,z,"Result: "+demo_result));glov_ui.panel({x:x+column_width+4-pad,y:y+40-pad,z:z-1,w:w+pad*2,h:glov_ui.font_height*2+pad*3});if(glov_ui.buttonText({x:x,y:y,z:z,text:"Modal Dialog",tooltip:"Shows a modal dialog"})){demo_result="";glov_ui.modalDialog({title:"Modal Dialog",text:"This is a modal dialog!",buttons:{OK:function OK(){demo_result="OK pushed!"},Cancel:null}})}y+=line_height;if(edit_box1.run()===edit_box1.SUBMIT){glov_ui.modalDialog({title:"Modal Dialog",text:"Edit box submitted with text "+edit_box1.text,buttons:{OK:null}})}if(edit_box2.run()===edit_box2.SUBMIT){edit_box2.setText("")}if(glov_ui.buttonText({x:x,y:y,z:z,text:"Menu",tooltip:"Shows a menu"})){demo_menu_up=true}y+=line_height;if(glov_ui.buttonText({x:x,y:y,z:z,text:"Disabled",tooltip:"A disabled button",disabled:true})){assert(false)}y+=line_height;y+=test_select1.run({x:x,y:y,z:z});y+=test_select2.run({x:x,y:y,z:z})}function runFontTest(x,y){var COLOR_RED=4278190335;var COLOR_GREEN=16711935;var COLOR_WHITE=4294967295;var COLOR_INVISIBLE=0;var z=Z.UI;var font=glov_engine.font;var font_size=glov_ui.font_height*2;font.drawSized(null,x,y,z,font_size,"Default "+font_size+" "+random().toFixed(7));y+=font_size;font.drawSized(null,x,y,z,font_size/2,"Default "+font_size/2+" Lorem ipsum dolor sit amet");y+=ceil(font_size/2);font.drawSized(null,x,y,z,font_size/4,"Default "+font_size/4+" The quick brown fox jumped over the lazy dog rutabaga Alfalfa");y+=ceil(font_size/4);var font_style_outline={outline_width:1,outline_color:COLOR_RED,glow_xoffs:0,glow_yoffs:0,glow_inner:0,glow_outer:0,glow_color:COLOR_INVISIBLE,color:COLOR_WHITE};font.drawSized(font_style_outline,x,y,z,font_size,"Outline");y+=font_size;var font_style_glow={outline_width:0,outline_color:COLOR_INVISIBLE,glow_xoffs:0,glow_yoffs:0,glow_inner:-1,glow_outer:4,glow_color:COLOR_GREEN,color:COLOR_WHITE};font.drawSized(font_style_glow,x,y,z,font_size,"Glow");y+=font_size;var font_style_shadow={outline_width:0,outline_color:COLOR_INVISIBLE,glow_xoffs:3.25,glow_yoffs:3.25,glow_inner:-2.5,glow_outer:5,glow_color:COLOR_GREEN,color:COLOR_WHITE};font.drawSized(font_style_shadow,x,y,z,font_size,"Glow (Shadow) O0O");y+=font_size;var font_style_both={outline_width:1,outline_color:COLOR_RED,glow_xoffs:0,glow_yoffs:0,glow_inner:0,glow_outer:6,glow_color:COLOR_GREEN,color:COLOR_WHITE};font.drawSized(font_style_both,x,y,z,font_size,"Both 0O0");y+=font_size;var font_size2=32;var font_style_both2={outline_width:1.75,outline_color:COLOR_RED,glow_xoffs:.25,glow_yoffs:.25,glow_inner:0,glow_outer:5,glow_color:2139062271,color:COLOR_WHITE};font.drawSizedAligned(font_style_both2,x,y,z,font_size2,glov_font.ALIGN.HFIT,glov_ui.button_width*2,0,"ALIGN.HFIT The quick brown fox jumps over the lazy dog");y+=font_size2;font.drawSizedAligned(font_style_both2,x,y,z,font_size2,glov_font.ALIGN.HFIT,140,0,"0 Players (+1 Easy Bots)");y+=font_size2;var test="glow";if(test==="outline"){var font_style_outline2={outline_width:1,outline_color:COLOR_RED,glow_xoffs:0,glow_yoffs:0,glow_inner:0,glow_outer:0,glow_color:COLOR_INVISIBLE,color:COLOR_WHITE};for(var ii=1;ii<=4;ii++){font_style_outline2.outline_width=ii*2;font.drawSizedAligned(font_style_outline2,x,y,z,font_size2,glov_font.ALIGN.HLEFT,400,0,"Outline thickness "+ii*2);y+=font_size2}}else if(test==="glow"){var font_style_glow2={outline_width:0,outline_color:COLOR_INVISIBLE,glow_xoffs:0,glow_yoffs:0,glow_inner:0,glow_outer:8,glow_color:COLOR_RED,color:COLOR_WHITE};for(var _ii=1;_ii<=4;_ii++){font_style_glow2.glow_outer=_ii*2;font.drawSizedAligned(font_style_glow2,x,y,z,font_size2,glov_font.ALIGN.HLEFT,400,0,"Glow outer "+_ii*2);y+=font_size2}}else if(test==="wrap"){y+=font.drawSizedWrapped(null,x,y,z,400,24,font_size2,4294967295,"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor"+" incididunt utlaboreetdoloremagnaaliqua.")}}},{"./engine.js":12,"./font.js":13,"./input.js":15,"./selection_box.js":19,"./simple_menu.js":21,"./ui.js":27,assert:35}],29:[function(require,module,exports){"use strict";exports.clamp=clamp;exports.lerp=lerp;exports.isPowerOfTwo=isPowerOfTwo;exports.nextHighestPowerOfTwo=nextHighestPowerOfTwo;exports.vec2=vec2;exports.vec3=vec3;exports.vec4=vec4;exports.v2abs=v2abs;exports.v2add=v2add;exports.v2addScale=v2addScale;exports.v2copy=v2copy;exports.v2distSq=v2distSq;exports.v2lengthSq=v2lengthSq;exports.v2lerp=v2lerp;exports.v2mul=v2mul;exports.v2normalize=v2normalize;exports.v2scale=v2scale;exports.v2set=v2set;exports.v2sub=v2sub;exports.v3add=v3add;exports.v3addScale=v3addScale;exports.v3copy=v3copy;exports.v3cross=v3cross;exports.v3determinant=v3determinant;exports.v3dot=v3dot;exports.v3distSq=v3distSq;exports.v3div=v3div;exports.v3floor=v3floor;exports.v3lengthSq=v3lengthSq;exports.v3mulMat4=v3mulMat4;exports.v3normalize=v3normalize;exports.v3scale=v3scale;exports.v3sub=v3sub;exports.v3zero=v3zero;exports.v4clone=v4clone;exports.v4copy=v4copy;exports.v4lerp=v4lerp;exports.v4mul=v4mul;exports.v4mulAdd=v4mulAdd;exports.v4scale=v4scale;exports.v4set=v4set;exports.v4zero=v4zero;exports.mat3=require("gl-mat3/create");exports.mat4=require("gl-mat4/create");var abs=Math.abs,floor=Math.floor,max=Math.max,min=Math.min,sqrt=Math.sqrt;function clamp(a,mn,mx){return max(mn,min(mx,a))}function lerp(a,v0,v1){return(1-a)*v0+a*v1}function isPowerOfTwo(n){return(n&n-1)===0}function nextHighestPowerOfTwo(x){--x;for(var i=1;i<32;i<<=1){x|=x>>i}return x+1}function vec2(a,b){var r=new Float32Array(2);if(a||b){r[0]=a;r[1]=b}return r}function vec3(a,b,c){var r=new Float32Array(3);if(a||b||c){r[0]=a;r[1]=b;r[2]=c}return r}function vec4(a,b,c,d){var r=new Float32Array(4);if(a||b||c||d){r[0]=a;r[1]=b;r[2]=c;r[3]=d}return r}var unit_vec=exports.unit_vec=vec4(1,1,1,1);var zero_vec=exports.zero_vec=vec4();var identity_mat3=exports.identity_mat3=exports.mat3();var identity_mat4=exports.identity_mat4=exports.mat4();var xaxis=exports.xaxis=vec4(1,0,0,0);var yaxis=exports.yaxis=vec4(0,1,0,0);var zaxis=exports.zaxis=vec4(0,0,1,0);function v2abs(out,a){out[0]=abs(a[0]);out[1]=abs(a[1]);return out}function v2add(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];return out}function v2addScale(out,a,b,s){out[0]=a[0]+b[0]*s;out[1]=a[1]+b[1]*s;return out}function v2copy(out,a){out[0]=a[0];out[1]=a[1];return out}function v2distSq(a,b){return(a[0]-b[0])*(a[0]-b[0])+(a[1]-b[1])*(a[1]-b[1])}function v2lengthSq(a){return a[0]*a[0]+a[1]*a[1]}function v2lerp(out,t,a,b){var it=1-t;out[0]=it*a[0]+t*b[0];out[1]=it*a[1]+t*b[1];return out}function v2mul(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];return out}function v2normalize(out,a){var len=a[0]*a[0]+a[1]*a[1];if(len>0){len=1/sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len}return out}function v2scale(out,a,s){out[0]=a[0]*s;out[1]=a[1]*s;return out}function v2set(out,a,b){out[0]=a;out[1]=b;return out}function v2sub(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];return out}function v3add(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];return out}function v3addScale(out,a,b,s){out[0]=a[0]+b[0]*s;out[1]=a[1]+b[1]*s;out[2]=a[2]+b[2]*s;return out}function v3copy(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];return out}function v3cross(out,a,b){var a0=a[0];var a1=a[1];var a2=a[2];var b0=b[0];var b1=b[1];var b2=b[2];out[0]=a1*b2-a2*b1;out[1]=a2*b0-a0*b2;out[2]=a0*b1-a1*b0;return out}function v3determinant(a,b,c){var a00=a[0];var a01=b[0];var a02=c[0];var a10=a[1];var a11=b[1];var a12=c[1];var a20=a[2];var a21=b[2];var a22=c[2];return a00*(a22*a11-a12*a21)+a01*(-a22*a10+a12*a20)+a02*(a21*a10-a11*a20)}function v3dot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function v3distSq(a,b){return(a[0]-b[0])*(a[0]-b[0])+(a[1]-b[1])*(a[1]-b[1])+(a[2]-b[2])*(a[2]-b[2])}function v3div(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];out[2]=a[2]/b[2];return out}function v3floor(out,a){out[0]=floor(a[0]);out[1]=floor(a[1]);out[2]=floor(a[2]);return out}function v3lengthSq(a){return a[0]*a[0]+a[1]*a[1]+a[2]*a[2]}function v3mulMat4(out,a,m){var x=a[0];var y=a[1];var z=a[2];out[0]=x*m[0]+y*m[4]+z*m[8];out[1]=x*m[1]+y*m[5]+z*m[9];out[2]=x*m[2]+y*m[6]+z*m[10];return out}function v3normalize(out,a){var len=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];if(len>0){len=1/sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len;out[2]=a[2]*len}return out}function v3scale(out,a,s){out[0]=a[0]*s;out[1]=a[1]*s;out[2]=a[2]*s;return out}function v3sub(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];return out}function v3zero(out){out[0]=out[1]=out[2]=0;return out}function v4clone(a){return a.slice(0)}function v4copy(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out}function v4lerp(out,t,a,b){var it=1-t;out[0]=it*a[0]+t*b[0];out[1]=it*a[1]+t*b[1];out[2]=it*a[2]+t*b[2];out[3]=it*a[3]+t*b[3];return out}function v4mul(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];out[2]=a[2]*b[2];out[3]=a[3]*b[3];return out}function v4mulAdd(out,a,b,c){out[0]=a[0]*b[0]+c[0];out[1]=a[1]*b[1]+c[1];out[2]=a[2]*b[2]+c[2];out[3]=a[3]*b[3]+c[3];return out}function v4scale(out,a,s){out[0]=a[0]*s;out[1]=a[1]*s;out[2]=a[2]*s;out[3]=a[3]*s;return out}function v4set(out,a,b,c,d){out[0]=a;out[1]=b;out[2]=c;out[3]=d;return out}function v4zero(out){out[0]=out[1]=out[2]=out[3]=0;return out}},{"gl-mat3/create":1,"gl-mat4/create":4}],30:[function(require,module,exports){module.exports={font_size:8,imageW:128,imageH:128,spread:2,noFilter:1,channels:1,char_infos:[{c:32,x0:61,y0:63,xpad:3,w:1,h:1},{c:33,x0:92,y0:2,yoffs:1,xpad:1,w:1,h:5},{c:34,x0:16,y0:63,yoffs:1,xpad:1,w:3,h:2},{c:35,x0:98,y0:2,yoffs:1,xpad:1,w:5,h:5},{c:36,x0:38,y0:2,yoffs:1,xpad:1,w:4,h:6},{c:37,x0:108,y0:2,yoffs:1,xpad:1,w:5,h:5},{c:38,x0:118,y0:2,yoffs:1,xpad:1,w:5,h:5},{c:39,x0:24,y0:63,yoffs:1,xpad:1,w:1,h:2},{c:40,x0:2,y0:14,yoffs:1,xpad:1,w:2,h:5},{c:41,x0:9,y0:14,yoffs:1,xpad:1,w:2,h:5},{c:42,x0:109,y0:54,yoffs:1,xpad:1,w:3,h:3},{c:43,x0:117,y0:54,yoffs:2,xpad:1,w:3,h:3},{c:44,x0:30,y0:63,yoffs:5,xpad:1,w:2,h:2},{c:45,x0:67,y0:63,yoffs:3,xpad:1,w:3,h:1},{c:46,x0:75,y0:63,yoffs:5,xpad:1,w:1,h:1},{c:47,x0:16,y0:14,yoffs:1,xpad:1,w:5,h:5},{c:48,x0:26,y0:14,yoffs:1,xpad:1,w:4,h:5},{c:49,x0:35,y0:14,yoffs:1,xpad:1,w:2,h:5},{c:50,x0:42,y0:14,yoffs:1,xpad:1,w:4,h:5},{c:51,x0:51,y0:14,yoffs:1,xpad:1,w:4,h:5},{c:52,x0:60,y0:14,yoffs:1,xpad:1,w:4,h:5},{c:53,x0:69,y0:14,yoffs:1,xpad:1,w:4,h:5},{c:54,x0:78,y0:14,yoffs:1,xpad:1,w:4,h:5},{c:55,x0:87,y0:14,yoffs:1,xpad:1,w:4,h:5},{c:56,x0:96,y0:14,yoffs:1,xpad:1,w:4,h:5},{c:57,x0:105,y0:14,yoffs:1,xpad:1,w:4,h:5},{c:58,x0:2,y0:63,yoffs:2,xpad:1,w:1,h:3},{c:59,x0:115,y0:44,yoffs:2,xpad:1,w:1,h:4},{c:60,x0:114,y0:14,yoffs:1,xpad:1,w:3,h:5},{c:61,x0:8,y0:63,yoffs:2,xpad:1,w:3,h:3},{c:62,x0:122,y0:14,yoffs:1,xpad:1,w:3,h:5},{c:63,x0:2,y0:24,yoffs:1,xpad:1,w:4,h:5},{c:64,x0:11,y0:24,yoffs:1,xpad:1,w:5,h:5},{c:65,x0:21,y0:24,yoffs:1,xpad:1,w:4,h:5},{c:66,x0:30,y0:24,yoffs:1,xpad:1,w:4,h:5},{c:67,x0:39,y0:24,yoffs:1,xpad:1,w:3,h:5},{c:68,x0:47,y0:24,yoffs:1,xpad:1,w:4,h:5},{c:69,x0:56,y0:24,yoffs:1,xpad:1,w:3,h:5},{c:70,x0:64,y0:24,yoffs:1,xpad:1,w:3,h:5},{c:71,x0:72,y0:24,yoffs:1,xpad:1,w:4,h:5},{c:72,x0:81,y0:24,yoffs:1,xpad:1,w:4,h:5},{c:73,x0:90,y0:24,yoffs:1,xpad:1,w:3,h:5},{c:74,x0:98,y0:24,yoffs:1,xpad:1,w:4,h:5},{c:75,x0:107,y0:24,yoffs:1,xpad:1,w:4,h:5},{c:76,x0:116,y0:24,yoffs:1,xpad:1,w:3,h:5},{c:77,x0:2,y0:34,yoffs:1,xpad:1,w:5,h:5},{c:78,x0:12,y0:34,yoffs:1,xpad:1,w:4,h:5},{c:79,x0:21,y0:34,yoffs:1,xpad:1,w:4,h:5},{c:80,x0:30,y0:34,yoffs:1,xpad:1,w:4,h:5},{c:81,x0:47,y0:2,yoffs:1,xpad:1,w:4,h:6},{c:82,x0:39,y0:34,yoffs:1,xpad:1,w:4,h:5},{c:83,x0:48,y0:34,yoffs:1,xpad:1,w:4,h:5},{c:84,x0:57,y0:34,yoffs:1,xpad:1,w:3,h:5},{c:85,x0:65,y0:34,yoffs:1,xpad:1,w:4,h:5},{c:86,x0:74,y0:34,yoffs:1,xpad:1,w:4,h:5},{c:87,x0:83,y0:34,yoffs:1,xpad:1,w:5,h:5},{c:88,x0:93,y0:34,yoffs:1,xpad:1,w:4,h:5},{c:89,x0:102,y0:34,yoffs:1,xpad:1,w:4,h:5},{c:90,x0:111,y0:34,yoffs:1,xpad:1,w:3,h:5},{c:91,x0:119,y0:34,yoffs:1,xpad:1,w:2,h:5},{c:92,x0:2,y0:44,yoffs:1,xpad:1,w:5,h:5},{c:93,x0:12,y0:44,yoffs:1,xpad:1,w:2,h:5},{c:94,x0:37,y0:63,yoffs:1,xpad:1,w:3,h:2},{c:95,x0:81,y0:63,yoffs:5,xpad:1,w:4,h:1},{c:96,x0:45,y0:63,yoffs:1,xpad:1,w:2,h:2},{c:97,x0:121,y0:44,yoffs:2,xpad:1,w:4,h:4},{c:98,x0:19,y0:44,yoffs:1,xpad:1,w:4,h:5},{c:99,x0:2,y0:54,yoffs:2,xpad:1,w:3,h:4},{c:100,x0:28,y0:44,yoffs:1,xpad:1,w:4,h:5},{c:101,x0:10,y0:54,yoffs:2,xpad:1,w:4,h:4},{c:102,x0:37,y0:44,yoffs:1,xpad:1,w:3,h:5},{c:103,x0:56,y0:2,yoffs:2,xpad:1,w:4,h:6},{c:104,x0:45,y0:44,yoffs:1,xpad:1,w:4,h:5},{c:105,x0:54,y0:44,yoffs:1,xpad:1,w:1,h:5},{c:106,x0:2,y0:2,yoffs:1,xpad:1,w:2,h:7},{c:107,x0:60,y0:44,yoffs:1,xpad:1,w:4,h:5},{c:108,x0:69,y0:44,yoffs:1,xpad:1,w:1,h:5},{c:109,x0:19,y0:54,yoffs:2,xpad:1,w:5,h:4},{c:110,x0:29,y0:54,yoffs:2,xpad:1,w:4,h:4},{c:111,x0:38,y0:54,yoffs:2,xpad:1,w:4,h:4},{c:112,x0:65,y0:2,yoffs:2,xpad:1,w:4,h:6},{c:113,x0:74,y0:2,yoffs:2,xpad:1,w:4,h:6},{c:114,x0:47,y0:54,yoffs:2,xpad:1,w:3,h:4},{c:115,x0:55,y0:54,yoffs:2,xpad:1,w:4,h:4},{c:116,x0:75,y0:44,yoffs:1,xpad:1,w:3,h:5},{c:117,x0:64,y0:54,yoffs:2,xpad:1,w:4,h:4},{c:118,x0:73,y0:54,yoffs:2,xpad:1,w:4,h:4},{c:119,x0:82,y0:54,yoffs:2,xpad:1,w:5,h:4},{c:120,x0:92,y0:54,yoffs:2,xpad:1,w:3,h:4},{c:121,x0:83,y0:2,yoffs:2,xpad:1,w:4,h:6},{c:122,x0:100,y0:54,yoffs:2,xpad:1,w:4,h:4},{c:123,x0:83,y0:44,yoffs:1,xpad:1,w:3,h:5},{c:124,x0:91,y0:44,yoffs:1,xpad:1,w:1,h:5},{c:125,x0:97,y0:44,yoffs:1,xpad:1,w:3,h:5},{c:126,x0:52,y0:63,yoffs:1,xpad:1,w:4,h:2},{c:160,x0:90,y0:63,xpad:3,w:1,h:1},{c:65533,x0:105,y0:44,yoffs:2,xpad:1,w:5,h:5},{c:128263,x0:9,y0:2,yoffs:1,xpad:1,w:10,h:7},{c:128264,x0:24,y0:2,yoffs:1,xpad:1,w:9,h:7}]}},{}],31:[function(require,module,exports){module.exports={font_size:16,imageW:1024,imageH:64,spread:2,noFilter:1,channels:1,char_infos:[{c:32,x0:172,y0:21,xpad:7,w:1,h:1},{c:33,x0:137,y0:2,yoffs:3,xpad:2,w:2,h:10},{c:34,x0:81,y0:21,yoffs:3,xpad:2,w:6,h:4},{c:35,x0:144,y0:2,yoffs:3,xpad:2,w:10,h:10},{c:36,x0:59,y0:2,yoffs:3,xpad:2,w:8,h:12},{c:37,x0:159,y0:2,yoffs:3,xpad:2,w:10,h:10},{c:38,x0:174,y0:2,yoffs:3,xpad:2,w:10,h:10},{c:39,x0:92,y0:21,yoffs:3,xpad:2,w:2,h:4},{c:40,x0:189,y0:2,yoffs:3,xpad:2,w:4,h:10},{c:41,x0:198,y0:2,yoffs:3,xpad:2,w:4,h:10},{c:42,x0:41,y0:21,yoffs:3,xpad:2,w:6,h:6},{c:43,x0:52,y0:21,yoffs:5,xpad:2,w:6,h:6},{c:44,x0:99,y0:21,yoffs:11,xpad:2,w:4,h:4},{c:45,x0:141,y0:21,yoffs:7,xpad:2,w:6,h:2},{c:46,x0:152,y0:21,yoffs:11,xpad:2,w:2,h:2},{c:47,x0:207,y0:2,yoffs:3,xpad:2,w:10,h:10},{c:48,x0:222,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:49,x0:235,y0:2,yoffs:3,xpad:2,w:4,h:10},{c:50,x0:244,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:51,x0:257,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:52,x0:270,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:53,x0:283,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:54,x0:296,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:55,x0:309,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:56,x0:322,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:57,x0:335,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:58,x0:63,y0:21,yoffs:5,xpad:2,w:2,h:6},{c:59,x0:877,y0:2,yoffs:5,xpad:2,w:2,h:8},{c:60,x0:348,y0:2,yoffs:3,xpad:2,w:6,h:10},{c:61,x0:70,y0:21,yoffs:5,xpad:2,w:6,h:6},{c:62,x0:359,y0:2,yoffs:3,xpad:2,w:6,h:10},{c:63,x0:370,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:64,x0:383,y0:2,yoffs:3,xpad:2,w:10,h:10},{c:65,x0:398,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:66,x0:411,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:67,x0:424,y0:2,yoffs:3,xpad:2,w:6,h:10},{c:68,x0:435,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:69,x0:448,y0:2,yoffs:3,xpad:2,w:6,h:10},{c:70,x0:459,y0:2,yoffs:3,xpad:2,w:6,h:10},{c:71,x0:470,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:72,x0:483,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:73,x0:496,y0:2,yoffs:3,xpad:2,w:6,h:10},{c:74,x0:507,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:75,x0:520,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:76,x0:533,y0:2,yoffs:3,xpad:2,w:6,h:10},{c:77,x0:544,y0:2,yoffs:3,xpad:2,w:10,h:10},{c:78,x0:559,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:79,x0:572,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:80,x0:585,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:81,x0:72,y0:2,yoffs:3,xpad:2,w:8,h:12},{c:82,x0:598,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:83,x0:611,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:84,x0:624,y0:2,yoffs:3,xpad:2,w:6,h:10},{c:85,x0:635,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:86,x0:648,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:87,x0:661,y0:2,yoffs:3,xpad:2,w:10,h:10},{c:88,x0:676,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:89,x0:689,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:90,x0:702,y0:2,yoffs:3,xpad:2,w:6,h:10},{c:91,x0:713,y0:2,yoffs:3,xpad:2,w:4,h:10},{c:92,x0:722,y0:2,yoffs:3,xpad:2,w:10,h:10},{c:93,x0:737,y0:2,yoffs:3,xpad:2,w:4,h:10},{c:94,x0:108,y0:21,yoffs:3,xpad:2,w:6,h:4},{c:95,x0:159,y0:21,yoffs:11,xpad:2,w:8,h:2},{c:96,x0:119,y0:21,yoffs:3,xpad:2,w:4,h:4},{c:97,x0:884,y0:2,yoffs:5,xpad:2,w:8,h:8},{c:98,x0:746,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:99,x0:897,y0:2,yoffs:5,xpad:2,w:6,h:8},{c:100,x0:759,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:101,x0:908,y0:2,yoffs:5,xpad:2,w:8,h:8},{c:102,x0:772,y0:2,yoffs:3,xpad:2,w:6,h:10},{c:103,x0:85,y0:2,yoffs:5,xpad:2,w:8,h:12},{c:104,x0:783,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:105,x0:796,y0:2,yoffs:3,xpad:2,w:2,h:10},{c:106,x0:2,y0:2,yoffs:3,xpad:2,w:4,h:14},{c:107,x0:803,y0:2,yoffs:3,xpad:2,w:8,h:10},{c:108,x0:816,y0:2,yoffs:3,xpad:2,w:2,h:10},{c:109,x0:921,y0:2,yoffs:5,xpad:2,w:10,h:8},{c:110,x0:936,y0:2,yoffs:5,xpad:2,w:8,h:8},{c:111,x0:949,y0:2,yoffs:5,xpad:2,w:8,h:8},{c:112,x0:98,y0:2,yoffs:5,xpad:2,w:8,h:12},{c:113,x0:111,y0:2,yoffs:5,xpad:2,w:8,h:12},{c:114,x0:962,y0:2,yoffs:5,xpad:2,w:6,h:8},{c:115,x0:973,y0:2,yoffs:5,xpad:2,w:8,h:8},{c:116,x0:823,y0:2,yoffs:3,xpad:2,w:6,h:10},{c:117,x0:986,y0:2,yoffs:5,xpad:2,w:8,h:8},{c:118,x0:999,y0:2,yoffs:5,xpad:2,w:8,h:8},{c:119,x0:2,y0:21,yoffs:5,xpad:2,w:10,h:8},{c:120,x0:17,y0:21,yoffs:5,xpad:2,w:6,h:8},{c:121,x0:124,y0:2,yoffs:5,xpad:2,w:8,h:12},{c:122,x0:28,y0:21,yoffs:5,xpad:2,w:8,h:8},{c:123,x0:834,y0:2,yoffs:3,xpad:2,w:6,h:10},{c:124,x0:845,y0:2,yoffs:3,xpad:2,w:2,h:10},{c:125,x0:852,y0:2,yoffs:3,xpad:2,w:6,h:10},{c:126,x0:128,y0:21,yoffs:3,xpad:2,w:8,h:4},{c:160,x0:178,y0:21,xpad:7,w:1,h:1},{c:65533,x0:863,y0:2,yoffs:3,xpad:1,w:9,h:10},{c:128263,x0:11,y0:2,yoffs:1,xpad:1,w:19,h:14},{c:128264,x0:35,y0:2,yoffs:1,xpad:1,w:19,h:14}]}},{}],32:[function(require,module,exports){module.exports={font_size:32,imageW:1024,imageH:512,spread:8,channels:1,char_infos:[{c:13,x0:37,y0:377,w:1,h:1},{c:32,x0:55,y0:377,xpad:6.10156,w:1,h:1},{c:33,x0:216,y0:228,yoffs:4,xpad:1.13281,w:6,h:22},{c:34,x0:617,y0:345,yoffs:4,w:10,h:8},{c:35,x0:467,y0:307,yoffs:10,w:16,h:17},{c:36,x0:191,y0:8,yoffs:1,xpad:1.32031,w:15,h:29},{c:37,x0:673,y0:147,yoffs:4,xpad:.773438,w:26,h:23},{c:38,x0:716,y0:147,yoffs:4,xpad:.570313,w:20,h:23},{c:39,x0:644,y0:345,yoffs:4,w:5,h:8},{c:40,x0:753,y0:147,yoffs:5,w:8,h:23},{c:41,x0:778,y0:147,yoffs:5,xpad:.890625,w:7,h:23},{c:42,x0:469,y0:345,yoffs:2,w:11,h:11},{c:43,x0:500,y0:307,yoffs:9,xpad:.414063,w:15,h:17},{c:44,x0:666,y0:345,yoffs:22,w:5,h:8},{c:45,x0:993,y0:345,yoffs:16,w:9,h:3},{c:46,x0:897,y0:345,yoffs:22,w:5,h:4},{c:47,x0:802,y0:147,yoffs:4,w:13,h:23},{c:48,x0:239,y0:228,yoffs:5,xpad:.671875,w:17,h:22},{c:49,x0:208,y0:268,yoffs:5,xpad:5.67188,w:12,h:21},{c:50,x0:237,y0:268,yoffs:5,xpad:1.67188,w:16,h:21},{c:51,x0:273,y0:228,yoffs:5,xpad:1.67188,w:16,h:22},{c:52,x0:270,y0:268,yoffs:5,xpad:.671875,w:17,h:21},{c:53,x0:306,y0:228,yoffs:5,xpad:1.67188,w:16,h:22},{c:54,x0:339,y0:228,yoffs:5,xpad:.671875,w:17,h:22},{c:55,x0:304,y0:268,yoffs:5,xpad:1.67188,w:16,h:21},{c:56,x0:373,y0:228,yoffs:5,xpad:.671875,w:17,h:22},{c:57,x0:407,y0:228,yoffs:5,xpad:.671875,w:17,h:22},{c:58,x0:225,y0:345,yoffs:12,w:5,h:14},{c:59,x0:445,y0:307,yoffs:12,w:5,h:18},{c:60,x0:970,y0:307,yoffs:11,xpad:.90625,w:9,h:15},{c:61,x0:585,y0:345,yoffs:14,w:15,h:9},{c:62,x0:996,y0:307,yoffs:11,w:10,h:15},{c:63,x0:441,y0:228,yoffs:4,xpad:.195313,w:12,h:22},{c:64,x0:832,y0:147,yoffs:7,xpad:1.21094,w:23,h:23},{c:65,x0:337,y0:268,yoffs:5,w:19,h:21},{c:66,x0:373,y0:268,yoffs:5,xpad:.882813,w:18,h:21},{c:67,x0:470,y0:228,yoffs:5,xpad:.945313,w:17,h:22},{c:68,x0:408,y0:268,yoffs:5,xpad:1.01563,w:20,h:21},{c:69,x0:445,y0:268,yoffs:5,xpad:.617188,w:16,h:21},{c:70,x0:478,y0:268,yoffs:5,w:15,h:21},{c:71,x0:504,y0:228,yoffs:5,xpad:1.75,w:18,h:22},{c:72,x0:510,y0:268,yoffs:5,xpad:2.53906,w:18,h:21},{c:73,x0:545,y0:268,yoffs:5,xpad:2.54688,w:6,h:21},{c:74,x0:539,y0:228,yoffs:5,xpad:2.75781,w:6,h:22},{c:75,x0:568,y0:268,yoffs:5,w:19,h:21},{c:76,x0:604,y0:268,yoffs:5,w:16,h:21},{c:77,x0:637,y0:268,yoffs:5,xpad:2.27344,w:21,h:21},{c:78,x0:675,y0:268,yoffs:5,xpad:2.74219,w:19,h:21},{c:79,x0:872,y0:147,yoffs:4,xpad:1.22656,w:21,h:23},{c:80,x0:711,y0:268,yoffs:5,xpad:.828125,w:17,h:21},{c:81,x0:910,y0:147,yoffs:4,xpad:1.22656,w:21,h:23},{c:82,x0:745,y0:268,yoffs:5,w:19,h:21},{c:83,x0:948,y0:147,yoffs:4,xpad:1.32031,w:15,h:23},{c:84,x0:781,y0:268,yoffs:5,w:17,h:21},{c:85,x0:562,y0:228,yoffs:5,xpad:2.04688,w:19,h:22},{c:86,x0:815,y0:268,yoffs:5,w:19,h:21},{c:87,x0:851,y0:268,yoffs:5,w:30,h:21},{c:88,x0:598,y0:228,yoffs:5,w:20,h:22},{c:89,x0:898,y0:268,yoffs:5,w:18,h:21},{c:90,x0:933,y0:268,yoffs:5,xpad:.226563,w:17,h:21},{c:91,x0:831,y0:102,yoffs:4,w:9,h:25},{c:92,x0:980,y0:147,yoffs:4,w:13,h:23},{c:93,x0:857,y0:102,yoffs:4,xpad:1.70313,w:7,h:25},{c:94,x0:688,y0:345,yoffs:14,xpad:.1875,w:13,h:8},{c:95,x0:8,y0:377,yoffs:23,xpad:.4375,w:12,h:3},{c:96,x0:798,y0:345,yoffs:3,w:6,h:6},{c:97,x0:532,y0:307,yoffs:10,xpad:1.29688,w:14,h:17},{c:98,x0:8,y0:188,yoffs:4,xpad:.890625,w:16,h:23},{c:99,x0:563,y0:307,yoffs:10,xpad:.273438,w:14,h:17},{c:100,x0:41,y0:188,yoffs:4,xpad:2.07031,w:15,h:23},{c:101,x0:594,y0:307,yoffs:10,xpad:1.04688,w:15,h:17},{c:102,x0:635,y0:228,yoffs:4,w:10,h:22},{c:103,x0:73,y0:188,yoffs:10,xpad:2.07031,w:15,h:23},{c:104,x0:662,y0:228,yoffs:4,xpad:1.10156,w:16,h:22},{c:105,x0:967,y0:268,yoffs:5,xpad:1.34375,w:6,h:21},{c:106,x0:42,y0:56,yoffs:5,xpad:1.07031,w:7,h:28},{c:107,x0:695,y0:228,yoffs:4,xpad:.171875,w:15,h:22},{c:108,x0:727,y0:228,yoffs:4,xpad:1.46875,w:6,h:22},{c:109,x0:836,y0:307,yoffs:10,xpad:1.14063,w:25,h:16},{c:110,x0:878,y0:307,yoffs:10,xpad:2.03906,w:15,h:16},{c:111,x0:626,y0:307,yoffs:10,xpad:.828125,w:16,h:17},{c:112,x0:105,y0:188,yoffs:10,xpad:.890625,w:16,h:23},{c:113,x0:138,y0:188,yoffs:10,xpad:2.07031,w:15,h:23},{c:114,x0:8,y0:345,yoffs:11,xpad:.203125,w:10,h:15},{c:115,x0:659,y0:307,yoffs:10,xpad:.28125,w:13,h:17},{c:116,x0:381,y0:307,yoffs:7,xpad:.234375,w:10,h:20},{c:117,x0:910,y0:307,yoffs:11,xpad:1.64844,w:15,h:16},{c:118,x0:35,y0:345,yoffs:11,w:15,h:15},{c:119,x0:67,y0:345,yoffs:11,w:23,h:15},{c:120,x0:107,y0:345,yoffs:11,w:16,h:15},{c:121,x0:750,y0:228,yoffs:11,w:15,h:22},{c:122,x0:140,y0:345,yoffs:11,xpad:.851563,w:13,h:15},{c:123,x0:782,y0:228,yoffs:6,w:9,h:22},{c:124,x0:170,y0:188,yoffs:4,xpad:2.10156,w:6,h:23},{c:125,x0:808,y0:228,yoffs:6,xpad:.460938,w:8,h:22},{c:126,x0:868,y0:345,yoffs:16,xpad:.3125,w:12,h:5},{c:144,x0:718,y0:345,yoffs:-5,w:14,h:8},{c:160,x0:73,y0:377,xpad:6.10156,w:1,h:1},{c:161,x0:833,y0:228,yoffs:4,xpad:1.13281,w:6,h:22},{c:162,x0:193,y0:188,yoffs:7,xpad:.273438,w:14,h:23},{c:163,x0:990,y0:268,yoffs:5,xpad:.304688,w:14,h:21},{c:164,x0:408,y0:307,yoffs:9,xpad:.328125,w:20,h:20},{c:165,x0:8,y0:307,yoffs:5,w:18,h:21},{c:166,x0:224,y0:188,yoffs:4,xpad:2.10156,w:6,h:23},{c:167,x0:66,y0:56,yoffs:2,xpad:1.25,w:17,h:28},{c:168,x0:919,y0:345,yoffs:4,xpad:.453125,w:9,h:4},{c:169,x0:247,y0:188,yoffs:4,xpad:.625,w:25,h:23},{c:170,x0:375,y0:345,yoffs:4,xpad:.296875,w:10,h:12},{c:171,x0:497,y0:345,yoffs:13,xpad:.140625,w:11,h:11},{c:172,x0:553,y0:345,yoffs:13,xpad:.382813,w:15,h:10},{c:173,x0:91,y0:377,xpad:2.94531,w:1,h:1},{c:174,x0:43,y0:307,yoffs:1,xpad:.3125,w:22,h:21},{c:175,x0:945,y0:345,yoffs:4,w:9,h:4},{c:176,x0:773,y0:345,yoffs:4,w:8,h:7},{c:177,x0:689,y0:307,yoffs:9,w:14,h:17},{c:178,x0:247,y0:345,yoffs:2,xpad:.890625,w:11,h:14},{c:179,x0:942,y0:307,yoffs:2,xpad:1.52344,w:11,h:16},{c:180,x0:821,y0:345,yoffs:3,w:6,h:6},{c:181,x0:856,y0:228,yoffs:11,xpad:1.85938,w:15,h:22},{c:182,x0:82,y0:307,yoffs:5,xpad:.5,w:26,h:21},{c:183,x0:971,y0:345,yoffs:16,w:5,h:4},{c:184,x0:749,y0:345,yoffs:25,xpad:.0703125,w:7,h:8},{c:185,x0:275,y0:345,yoffs:2,xpad:.6875,w:10,h:14},{c:186,x0:402,y0:345,yoffs:4,xpad:.625,w:11,h:12},{c:187,x0:525,y0:345,yoffs:13,xpad:.140625,w:11,h:11},{c:188,x0:223,y0:8,yoffs:2,xpad:.0546875,w:25,h:29},{c:189,x0:100,y0:56,yoffs:2,xpad:1.22656,w:25,h:28},{c:190,x0:265,y0:8,yoffs:2,xpad:.109375,w:26,h:29},{c:191,x0:888,y0:228,yoffs:6,xpad:.09375,w:13,h:22},{c:192,x0:142,y0:56,yoffs:-2,w:19,h:28},{c:193,x0:178,y0:56,yoffs:-2,w:19,h:28},{c:194,x0:214,y0:56,yoffs:-2,w:19,h:28},{c:195,x0:612,y0:102,w:19,h:26},{c:196,x0:216,y0:102,yoffs:-1,w:19,h:27},{c:197,x0:250,y0:56,yoffs:-2,w:19,h:28},{c:198,x0:125,y0:307,yoffs:5,xpad:.28125,w:27,h:21},{c:199,x0:286,y0:56,yoffs:5,xpad:.945313,w:17,h:28},{c:200,x0:320,y0:56,yoffs:-2,xpad:.617188,w:16,h:28},{c:201,x0:353,y0:56,yoffs:-2,xpad:.617188,w:16,h:28},{c:202,x0:386,y0:56,yoffs:-2,xpad:.617188,w:16,h:28},{c:203,x0:252,y0:102,yoffs:-1,xpad:.617188,w:16,h:27},{c:204,x0:419,y0:56,yoffs:-2,xpad:1.54688,w:7,h:28},{c:205,x0:443,y0:56,yoffs:-2,xpad:.546875,w:8,h:28},{c:206,x0:468,y0:56,yoffs:-2,w:11,h:28},{c:207,x0:285,y0:102,yoffs:-1,w:9,h:27},{c:208,x0:169,y0:307,yoffs:5,xpad:1.22656,w:20,h:21},{c:209,x0:648,y0:102,xpad:2.74219,w:19,h:26},{c:210,x0:308,y0:8,yoffs:-2,xpad:1.22656,w:21,h:29},{c:211,x0:346,y0:8,yoffs:-2,xpad:1.22656,w:21,h:29},{c:212,x0:384,y0:8,yoffs:-2,xpad:1.22656,w:21,h:29},{c:213,x0:311,y0:102,xpad:1.22656,w:21,h:27},{c:214,x0:496,y0:56,yoffs:-1,xpad:1.22656,w:21,h:28},{c:215,x0:170,y0:345,yoffs:11,xpad:.359375,w:15,h:15},{c:216,x0:289,y0:188,yoffs:4,xpad:1.22656,w:21,h:23},{c:217,x0:422,y0:8,yoffs:-2,xpad:2.04688,w:19,h:29},{c:218,x0:458,y0:8,yoffs:-2,xpad:2.04688,w:19,h:29},{c:219,x0:494,y0:8,yoffs:-2,xpad:2.04688,w:19,h:29},{c:220,x0:534,y0:56,yoffs:-1,xpad:2.04688,w:19,h:28},{c:221,x0:570,y0:56,yoffs:-2,w:18,h:28},{c:222,x0:206,y0:307,yoffs:5,xpad:1.00781,w:17,h:21},{c:223,x0:240,y0:307,yoffs:5,xpad:1.30469,w:17,h:21},{c:224,x0:973,y0:102,yoffs:3,xpad:1.29688,w:14,h:24},{c:225,x0:8,y0:147,yoffs:3,xpad:1.29688,w:14,h:24},{c:226,x0:39,y0:147,yoffs:3,xpad:1.29688,w:14,h:24},{c:227,x0:327,y0:188,yoffs:4,xpad:1.29688,w:14,h:23},{c:228,x0:358,y0:188,yoffs:4,xpad:1.29688,w:14,h:23},{c:229,x0:881,y0:102,yoffs:2,xpad:1.29688,w:14,h:25},{c:230,x0:720,y0:307,yoffs:10,xpad:.960938,w:24,h:17},{c:231,x0:389,y0:188,yoffs:10,xpad:.273438,w:14,h:23},{c:232,x0:70,y0:147,yoffs:3,xpad:1.04688,w:15,h:24},{c:233,x0:102,y0:147,yoffs:3,xpad:1.04688,w:15,h:24},{c:234,x0:134,y0:147,yoffs:3,xpad:1.04688,w:15,h:24},{c:235,x0:420,y0:188,yoffs:4,xpad:1.04688,w:15,h:23},{c:236,x0:452,y0:188,yoffs:3,xpad:1.34375,w:6,h:23},{c:237,x0:475,y0:188,yoffs:3,w:8,h:23},{c:238,x0:500,y0:188,yoffs:3,w:11,h:23},{c:239,x0:918,y0:228,yoffs:4,w:9,h:22},{c:240,x0:528,y0:188,yoffs:4,xpad:1.53125,w:15,h:23},{c:241,x0:944,y0:228,yoffs:4,xpad:2.03906,w:15,h:22},{c:242,x0:166,y0:147,yoffs:3,xpad:.828125,w:16,h:24},{c:243,x0:199,y0:147,yoffs:3,xpad:.828125,w:16,h:24},{c:244,x0:232,y0:147,yoffs:3,xpad:.828125,w:16,h:24},{c:245,x0:560,y0:188,yoffs:4,xpad:.828125,w:16,h:23},{c:246,x0:593,y0:188,yoffs:4,xpad:.828125,w:16,h:23},{c:247,x0:302,y0:345,yoffs:11,xpad:.453125,w:14,h:14},{c:248,x0:761,y0:307,yoffs:10,xpad:.828125,w:16,h:17},{c:249,x0:265,y0:147,yoffs:3,xpad:1.64844,w:15,h:24},{c:250,x0:297,y0:147,yoffs:3,xpad:1.64844,w:15,h:24},{c:251,x0:329,y0:147,yoffs:3,xpad:1.64844,w:15,h:24},{c:252,x0:626,y0:188,yoffs:4,xpad:1.64844,w:15,h:23},{c:253,x0:40,y0:8,yoffs:3,w:15,h:30},{c:254,x0:530,y0:8,yoffs:4,xpad:.890625,w:16,h:29},{c:255,x0:563,y0:8,yoffs:4,w:15,h:29},{c:256,x0:684,y0:102,w:19,h:26},{c:257,x0:658,y0:188,yoffs:4,xpad:1.29688,w:14,h:23},{c:258,x0:349,y0:102,yoffs:-1,w:19,h:27},{c:259,x0:361,y0:147,yoffs:3,xpad:1.29688,w:14,h:24},{c:260,x0:605,y0:56,yoffs:5,w:21,h:28},{c:261,x0:689,y0:188,yoffs:10,w:16,h:23},{c:262,x0:595,y0:8,yoffs:-2,xpad:.945313,w:17,h:29},{c:263,x0:392,y0:147,yoffs:3,xpad:.273438,w:14,h:24},{c:268,x0:629,y0:8,yoffs:-2,xpad:.945313,w:17,h:29},{c:269,x0:423,y0:147,yoffs:3,xpad:.273438,w:14,h:24},{c:270,x0:643,y0:56,yoffs:-2,xpad:1.01563,w:20,h:28},{c:271,x0:722,y0:188,yoffs:4,w:22,h:23},{c:272,x0:274,y0:307,yoffs:5,xpad:1.22656,w:20,h:21},{c:273,x0:761,y0:188,yoffs:4,xpad:.0703125,w:17,h:23},{c:274,x0:720,y0:102,xpad:.617188,w:16,h:26},{c:275,x0:795,y0:188,yoffs:4,xpad:1.04688,w:15,h:23},{c:278,x0:385,y0:102,yoffs:-1,xpad:.617188,w:16,h:27},{c:279,x0:827,y0:188,yoffs:4,xpad:1.04688,w:15,h:23},{c:280,x0:680,y0:56,yoffs:5,xpad:.617188,w:16,h:28},{c:281,x0:859,y0:188,yoffs:10,xpad:1.04688,w:15,h:23},{c:282,x0:713,y0:56,yoffs:-2,xpad:.617188,w:16,h:28},{c:283,x0:454,y0:147,yoffs:3,xpad:1.04688,w:15,h:24},{c:286,x0:746,y0:56,yoffs:-1,xpad:1.75,w:18,h:28},{c:287,x0:72,y0:8,yoffs:3,xpad:2.07031,w:15,h:30},{c:290,x0:781,y0:56,yoffs:5,xpad:1.75,w:18,h:28},{c:291,x0:8,y0:8,yoffs:2,xpad:2.07031,w:15,h:31},{c:298,x0:753,y0:102,w:9,h:26},{c:299,x0:976,y0:228,yoffs:4,w:9,h:22},{c:302,x0:816,y0:56,yoffs:5,xpad:.546875,w:8,h:28},{c:303,x0:841,y0:56,yoffs:5,w:8,h:28},{c:304,x0:418,y0:102,yoffs:-1,xpad:1.54688,w:7,h:27},{c:305,x0:202,y0:345,yoffs:11,xpad:1.34375,w:6,h:15},{c:310,x0:663,y0:8,yoffs:5,w:19,h:29},{c:311,x0:104,y0:8,yoffs:4,xpad:.171875,w:15,h:30},{c:313,x0:866,y0:56,yoffs:-2,w:16,h:28},{c:314,x0:779,y0:102,w:8,h:26},{c:315,x0:699,y0:8,yoffs:5,w:16,h:29},{c:316,x0:136,y0:8,yoffs:4,xpad:1.46875,w:6,h:30},{c:317,x0:8,y0:268,yoffs:4,w:16,h:22},{c:318,x0:41,y0:268,yoffs:4,w:12,h:22},{c:321,x0:311,y0:307,yoffs:5,xpad:.046875,w:16,h:21},{c:322,x0:70,y0:268,yoffs:4,w:11,h:22},{c:323,x0:899,y0:56,yoffs:-2,xpad:2.74219,w:19,h:28},{c:324,x0:891,y0:188,yoffs:3,xpad:2.03906,w:15,h:23},{c:325,x0:732,y0:8,yoffs:5,xpad:2.74219,w:19,h:29},{c:326,x0:486,y0:147,yoffs:10,xpad:2.03906,w:15,h:24},{c:327,x0:935,y0:56,yoffs:-2,xpad:2.74219,w:19,h:28},{c:328,x0:923,y0:188,yoffs:3,xpad:2.03906,w:15,h:23},{c:332,x0:442,y0:102,xpad:1.22656,w:21,h:27},{c:333,x0:955,y0:188,yoffs:4,xpad:.828125,w:16,h:23},{c:336,x0:768,y0:8,yoffs:-2,xpad:1.22656,w:21,h:29},{c:337,x0:518,y0:147,yoffs:3,xpad:.828125,w:16,h:24},{c:338,x0:98,y0:268,yoffs:5,xpad:.390625,w:29,h:22},{c:339,x0:794,y0:307,yoffs:10,xpad:.65625,w:25,h:17},{c:340,x0:971,y0:56,yoffs:-2,w:19,h:28},{c:341,x0:988,y0:188,yoffs:3,xpad:.203125,w:10,h:23},{c:342,x0:806,y0:8,yoffs:5,w:19,h:29},{c:343,x0:8,y0:228,yoffs:11,xpad:.203125,w:10,h:23},{c:344,x0:8,y0:102,yoffs:-2,w:19,h:28},{c:345,x0:35,y0:228,yoffs:3,xpad:.203125,w:10,h:23},{c:346,x0:842,y0:8,yoffs:-2,xpad:1.32031,w:15,h:29},{c:347,x0:551,y0:147,yoffs:3,xpad:.28125,w:13,h:24},{c:350,x0:874,y0:8,yoffs:4,xpad:1.32031,w:15,h:29},{c:351,x0:62,y0:228,yoffs:10,xpad:.28125,w:13,h:23},{c:352,x0:906,y0:8,yoffs:-2,xpad:1.32031,w:15,h:29},{c:353,x0:581,y0:147,yoffs:3,xpad:.28125,w:13,h:24},{c:354,x0:44,y0:102,yoffs:5,w:17,h:28},{c:355,x0:804,y0:102,yoffs:7,xpad:.234375,w:10,h:26},{c:356,x0:78,y0:102,yoffs:-2,w:17,h:28},{c:357,x0:92,y0:228,yoffs:4,w:15,h:23},{c:362,x0:480,y0:102,xpad:2.04688,w:19,h:27},{c:363,x0:124,y0:228,yoffs:4,xpad:1.64844,w:15,h:23},{c:366,x0:938,y0:8,yoffs:-2,xpad:2.04688,w:19,h:29},{c:367,x0:912,y0:102,yoffs:2,xpad:1.64844,w:15,h:25},{c:368,x0:974,y0:8,yoffs:-2,xpad:2.04688,w:19,h:29},{c:369,x0:611,y0:147,yoffs:3,xpad:1.64844,w:15,h:24},{c:370,x0:112,y0:102,yoffs:5,xpad:2.04688,w:19,h:28},{c:371,x0:144,y0:268,yoffs:11,w:17,h:22},{c:376,x0:516,y0:102,yoffs:-1,w:18,h:27},{c:377,x0:148,y0:102,yoffs:-2,xpad:.226563,w:17,h:28},{c:378,x0:156,y0:228,yoffs:3,xpad:.851563,w:13,h:23},{c:379,x0:551,y0:102,yoffs:-1,xpad:.226563,w:17,h:27},{c:380,x0:178,y0:268,yoffs:4,xpad:.851563,w:13,h:22},{c:381,x0:182,y0:102,yoffs:-2,xpad:.226563,w:17,h:28},{c:382,x0:186,y0:228,yoffs:3,xpad:.851563,w:13,h:23},{c:402,x0:944,y0:102,yoffs:4,w:12,h:25},{c:536,x0:159,y0:8,yoffs:4,xpad:1.32031,w:15,h:30},{c:537,x0:643,y0:147,yoffs:10,xpad:.28125,w:13,h:24},{c:538,x0:8,y0:56,yoffs:5,w:17,h:29},{c:539,x0:585,y0:102,yoffs:7,xpad:.234375,w:10,h:27},{c:8226,x0:844,y0:345,yoffs:13,xpad:.28125,w:7,h:6},{c:8482,x0:430,y0:345,yoffs:5,xpad:.882813,w:22,h:12},{c:8734,x0:333,y0:345,yoffs:11,xpad:.6875,w:25,h:14},{c:65533,x0:344,y0:307,yoffs:5,w:20,h:21}]}},{}],33:[function(require,module,exports){"use strict";exports.main=main;var glov_engine=require("./glov/engine.js");var glov_font=require("./glov/font.js");var glov_input=require("./glov/input.js");var glov_local_storage=require("./glov/local_storage.js");var glov_particles=require("./glov/particles.js");var glov_sprites=require("./glov/sprites.js");var glov_sprite_animation=require("./glov/sprite_animation.js");var glov_transition=require("./glov/transition.js");var glov_ui=require("./glov/ui.js");var glov_ui_test=require("./glov/ui_test.js");var particle_data=require("./particle_data.js");var _require=require("./glov/vmath.js"),vec2=_require.vec2,vec4=_require.vec4,v4clone=_require.v4clone,v4copy=_require.v4copy;glov_local_storage.storage_prefix="glovjs-playground";window.Z=window.Z||{};Z.BACKGROUND=0;Z.SPRITES=10;Z.PARTICLES=20;Z.UI_TEST=200;var game_width=exports.game_width=320;var game_height=exports.game_height=240;var sprites=exports.sprites={};var flags={};function flagGet(key,dflt){if(flags[key]===undefined){flags[key]=glov_local_storage.getJSON("flag_"+key,dflt)||false}return flags[key]}function flagToggle(key){flags[key]=!flagGet(key);glov_local_storage.setJSON("flag_"+key,flags[key])}function flagSet(key,value){flags[key]=value;glov_local_storage.setJSON("flag_"+key,flags[key])}var color_white=vec4(1,1,1,1);function perfTestSprites(){if(!sprites.test){sprites.test=[glov_sprites.create({name:"test",size:vec2(1,1),origin:vec2(.5,.5)}),glov_sprites.create({url:"img/test.png?1",size:vec2(1,1),origin:vec2(.5,.5)})]}var mode=2;var count=[8e4,4e4,2e4,6e4,6e4][mode];if(mode===3||mode===4){for(var ii=0;ii<count;){var subc=Math.floor(500+Math.random()*100);var idx=mode<=1?0:Math.round(Math.random());var sprite=sprites.test[idx];var z=Math.random();for(var jj=0;jj<subc;++jj){if(mode===4){glov_sprites.queuesprite(sprite,Math.random()*game_width,Math.random()*game_height,z,6*sprite.size[0],6*sprite.size[1],0,sprite.uvs,color_white)}else{sprites.test[idx].draw({x:Math.random()*game_width,y:Math.random()*game_height,z:z,w:6,h:6})}}ii+=subc}}else{for(var _ii=0;_ii<count;++_ii){var _idx=mode<=1?0:Math.round(Math.random());sprites.test[_idx].draw({x:Math.random()*game_width,y:Math.random()*game_height,z:mode===0?_ii:Math.random(),w:6,h:6})}}}function main(canvas){glov_engine.startup({canvas:canvas,game_width:game_width,game_height:game_height,pixely:flagGet("pixely","on"),viewport_postprocess:true});var sound_manager=glov_engine.sound_manager;glov_ui.scaleSizes(13/32);glov_ui.setFontHeight(8);var createSprite=glov_sprites.create;var createAnimation=glov_sprite_animation.create;var color_red=vec4(1,0,0,1);var color_yellow=vec4(1,1,0,1);var KEYS=glov_input.KEYS;var pad_codes=glov_input.pad_codes;var sprite_size=64;function initGraphics(){glov_particles.preloadParticleData(particle_data);sound_manager.loadSound("test");sprites.white=createSprite({url:"white"});sprites.test_tint=createSprite({name:"tinted",ws:[16,16,16,16],hs:[16,16,16],size:vec2(sprite_size,sprite_size),layers:2,origin:vec2(.5,.5)});sprites.animation=createAnimation({idle_left:{frames:[0,1],times:[200,500]},idle_right:{frames:[3,2],times:[200,500]}});sprites.animation.setState("idle_left");sprites.game_bg=createSprite({url:"white",size:vec2(game_width,game_height)})}var last_particles=0;function test(dt){if(!test.color_sprite){test.color_sprite=v4clone(color_white);test.character={x:Math.random()*(game_width-sprite_size)+sprite_size*.5,y:Math.random()*(game_height-sprite_size)+sprite_size*.5}}if(flagGet("ui_test")){glov_ui_test.run(10,10,Z.UI_TEST)}if(flagGet("font_test")){glov_ui_test.runFontTest(105,85)}test.character.dx=0;test.character.dy=0;if(glov_input.keyDown(KEYS.LEFT)||glov_input.keyDown(KEYS.A)||glov_input.padButtonDown(pad_codes.LEFT)){test.character.dx=-1;sprites.animation.setState("idle_left")}else if(glov_input.keyDown(KEYS.RIGHT)||glov_input.keyDown(KEYS.D)||glov_input.padButtonDown(pad_codes.RIGHT)){test.character.dx=1;sprites.animation.setState("idle_right")}if(glov_input.keyDown(KEYS.UP)||glov_input.keyDown(KEYS.W)||glov_input.padButtonDown(pad_codes.UP)){test.character.dy=-1}else if(glov_input.keyDown(KEYS.DOWN)||glov_input.keyDown(KEYS.S)||glov_input.padButtonDown(pad_codes.DOWN)){test.character.dy=1}test.character.x+=test.character.dx*dt*.05;test.character.y+=test.character.dy*dt*.05;var bounds={x:test.character.x-sprite_size/2,y:test.character.y-sprite_size/2,w:sprite_size,h:sprite_size};if(glov_input.mouseDown()&&glov_input.mouseOver(bounds)){v4copy(test.color_sprite,color_yellow)}else if(glov_input.click(bounds)){v4copy(test.color_sprite,test.color_sprite[2]===0?color_white:color_red);sound_manager.play("test")}else if(glov_input.mouseOver(bounds)){v4copy(test.color_sprite,color_white);test.color_sprite[3]=.5}else{v4copy(test.color_sprite,color_white);test.color_sprite[3]=1}sprites.game_bg.draw({x:0,y:0,z:Z.BACKGROUND,color:[0,.72,1,1]});sprites.test_tint.drawDualTint({x:test.character.x,y:test.character.y,z:Z.SPRITES,color:[1,1,0,1],color1:[1,0,1,1],frame:sprites.animation.getFrame(dt)});var font_test_idx=0;glov_ui.print(glov_font.styleColored(null,255),test.character.x,test.character.y+ ++font_test_idx*20,Z.SPRITES,"TEXT!");var font_style=glov_font.style(null,{outline_width:1,outline_color:2147483903,glow_xoffs:3.25,glow_yoffs:3.25,glow_inner:-2.5,glow_outer:5,glow_color:255});glov_ui.print(font_style,test.character.x,test.character.y+ ++font_test_idx*glov_ui.font_height,Z.SPRITES,"Outline and Drop Shadow");var x=glov_ui.button_height;var button_spacing=glov_ui.button_height+2;var y=game_height-10-button_spacing*5;if(glov_ui.buttonText({x:x,y:y,text:"Pixely: "+(flagGet("pixely")||"Off"),tooltip:"Toggles pixely or regular mode (requires reload)"})){if(flagGet("pixely")==="strict"){flagSet("pixely",false)}else if(flagGet("pixely")==="on"){flagSet("pixely","strict")}else{flagSet("pixely","on")}document.location=String(document.location)}y+=button_spacing;if(glov_ui.buttonText({x:x,y:y,text:"Music: "+(flagGet("music")?"ON":"OFF"),tooltip:"Toggles playing a looping background music track"})){flagToggle("music");if(flagGet("music")){sound_manager.playMusic("music_test.mp3",1,sound_manager.FADE_IN)}else{sound_manager.playMusic("music_test.mp3",0,sound_manager.FADE_OUT)}}y+=button_spacing;if(glov_ui.buttonText({x:x,y:y,text:"Font Test: "+(flagGet("font_test")?"ON":"OFF"),tooltip:"Toggles visibility of general Font tests"})){flagToggle("font_test");glov_transition.queue(Z.TRANSITION_FINAL,glov_transition.randomTransition())}y+=button_spacing;if(glov_ui.buttonText({x:x,y:y,text:"UI Test: "+(flagGet("ui_test")?"ON":"OFF"),tooltip:"Toggles visibility of general UI tests"})){flagToggle("ui_test")}y+=button_spacing;if(glov_ui.buttonText({x:x,y:y,text:"Particles: "+(flagGet("particles",true)?"ON":"OFF"),tooltip:"Toggles particles"})){flagToggle("particles")}if(flagGet("particles")){if(glov_engine.getFrameTimestamp()-last_particles>1e3){last_particles=glov_engine.getFrameTimestamp();glov_engine.glov_particles.createSystem(particle_data.defs.explosion,[100+Math.random()*120,100+Math.random()*140,Z.PARTICLES])}}if(flagGet("perf_test")){perfTestSprites()}}function testInit(dt){glov_engine.setState(test);if(flagGet("music")){sound_manager.playMusic("music_test.mp3")}test(dt)}initGraphics();glov_engine.setState(testInit)}},{"./glov/engine.js":12,"./glov/font.js":13,"./glov/input.js":15,"./glov/local_storage.js":16,"./glov/particles.js":18,"./glov/sprite_animation.js":23,"./glov/sprites.js":24,"./glov/transition.js":26,"./glov/ui.js":27,"./glov/ui_test.js":28,"./glov/vmath.js":29,"./particle_data.js":34}],34:[function(require,module,exports){"use strict";var defs=exports.defs={};defs.explosion={particles:{part0:{blend:"alpha",texture:"particles/circle64",color:[1,1,1,1],color_track:[{t:0,v:[1,1,1,0]},{t:.2,v:[1,1,1,1]},{t:.4,v:[1,1,.5,.5]},{t:1,v:[1,0,0,0]}],size:[[48,8],[48,8]],size_track:[{t:0,v:[1,1]},{t:.2,v:[2,2]},{t:.4,v:[1,1]},{t:1,v:[1.5,1.5]}],accel:[0,0,0],rot:[0,360],rot_vel:[10,2],lifespan:[2500,0],kill_time_accel:5}},emitters:{part0:{particle:"part0",pos:[[-16,32],[-16,32],0],vel:[0,0,0],emit_rate:[15,0],emit_time:[0,1e3],emit_initial:10,max_parts:Infinity}},system_lifespan:2500}},{}],35:[function(require,module,exports){"use strict";function ok(exp,msg){if(exp){return}throw new Error("Assertion failed"+(msg?": "+msg:""))}module.exports=ok;module.exports.ok=ok;function equal(a,b){if(a===b){return}throw new Error('Assertion failed: "'+a+'"==="'+b+'"')}module.exports.equal=equal},{}],36:[function(require,module,exports){"use strict";(function(){var debug=document.getElementById("debug");window.onerror=function(e,file,line){debug.innerText=e+"\n  at "+file+"("+line+")"};window.debugmsg=function(msg,clear){if(clear){debug.innerText=msg}else{debug.innerText+=msg+"\n"}}})();window.onload=function(){var main=require("./main.js");var canvas=document.getElementById("canvas");function resizeCanvas(){var css_to_real=window.devicePixelRatio||1;window.pixel_scale=css_to_real;canvas.width=Math.round(canvas.clientWidth*css_to_real);canvas.height=Math.round(canvas.clientHeight*css_to_real)}window.addEventListener("resize",resizeCanvas,false);resizeCanvas();var contextNames=["webgl","experimental-webgl"];for(var i=0;i<contextNames.length;i+=1){try{window.gl=canvas.getContext(contextNames[i])}catch(e){}if(window.gl){return main.main(canvas)}}window.alert("Sorry, but your browser does not support WebGL or does not have it enabled.");document.getElementById("loading").style.visibility="hidden"}},{"./main.js":33}],37:[function(require,module,exports){"use strict";exports.easeInOut=easeInOut;exports.easeIn=easeIn;exports.easeOut=easeOut;exports.clone=clone;exports.merge=merge;exports.defaults=defaults;exports.cloneShallow=cloneShallow;exports.clamp=clamp;exports.lerp=lerp;exports.mix=mix;exports.sign=sign;exports.round100=round100;exports.round1000=round1000;exports.fract=fract;exports.nearSame=nearSame;exports.titleCase=titleCase;exports.lineCircleIntersect=lineCircleIntersect;var abs=Math.abs,floor=Math.floor,min=Math.min,max=Math.max,round=Math.round,pow=Math.pow,sqrt=Math.sqrt;function easeInOut(v,a){var va=pow(v,a);return va/(va+pow(1-v,a))}function easeIn(v,a){return 2*easeInOut(.5*v,a)}function easeOut(v,a){return 2*easeInOut(.5+.5*v,a)-1}function clone(obj){return JSON.parse(JSON.stringify(obj))}function merge(dest,src){for(var f in src){dest[f]=src[f]}return dest}function defaults(dest,src){for(var f in src){if(!Object.prototype.hasOwnProperty.call(dest,f)){dest[f]=src[f]}}return dest}function cloneShallow(src){return merge({},src)}function clamp(v,mn,mx){return min(max(mn,v),mx)}function lerp(a,v0,v1){return(1-a)*v0+a*v1}function mix(v0,v1,a){return(1-a)*v0+a*v1}function sign(a){return a<0?-1:a>0?1:0}function round100(a){return round(a*100)/100}function round1000(a){return round(a*1e3)/1e3}function fract(a){return a-floor(a)}function nearSame(a,b,tol){return abs(b-a)<=tol}function titleCase(str){return str.split(" ").map(function(word){return""+word[0].toUpperCase()+word.slice(1)}).join(" ")}var EPSILON=1e-5;function lineCircleIntersect(p1,p2,pCircle,radius){var dp=[p2[0]-p1[0],p2[1]-p1[1]];var a=dp[0]*dp[0]+dp[1]*dp[1];var b=2*(dp[0]*(p1[0]-pCircle[0])+dp[1]*(p1[1]-pCircle[1]));var c=pCircle[0]*pCircle[0]+pCircle[1]*pCircle[1];c+=p1[0]*p1[0]+p1[1]*p1[1];c-=2*(pCircle[0]*p1[0]+pCircle[1]*p1[1]);c-=radius*radius;var bb4ac=b*b-4*a*c;if(abs(a)<EPSILON||bb4ac<0){return false}var mu1=(-b+sqrt(bb4ac))/(2*a);var mu2=(-b-sqrt(bb4ac))/(2*a);if(mu1>=0&&mu1<=1||mu2>=0&&mu2<=1){return true}return false}},{}]},{},[36]);
//# sourceMappingURL=wrapper.bundle.js.map
